<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Configuring the Sun Java System Directory Server on a Trusted Extensions System - Solaris Trusted Extensions Installation and Configuration</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-05-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">Solaris Trusted Extensions Installation and Configuration</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="txldap-18.html">Previous</a>
             </td>
             <td align="right">
                 <a href="txconf-37.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-4.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="ovw-1.html">1.&nbsp;&nbsp;Security Planning for Trusted Extensions</a></p>
<p class="toc level1 tocsp"><a href="tmap-1.html">2.&nbsp;&nbsp;Installation and Configuration Roadmap for Trusted Extensions</a></p>
<p class="toc level1 tocsp"><a href="startinst-1.html">3.&nbsp;&nbsp;Installing Solaris Trusted Extensions Software  (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="txconf-1.html">4.&nbsp;&nbsp;Configuring Trusted Extensions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="txldap-1.html">5.&nbsp;&nbsp;Configuring LDAP for Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="txldap-16.html">Configuring an LDAP Server on a Trusted Extensions Host (Task Map)</a></p>
<p class="toc level2"><a href="txldap-18.html">Configuring an LDAP Proxy Server on a Trusted Extensions Host (Task Map)</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Configuring the Sun Java System Directory Server on a Trusted Extensions System</a></p>
<p class="toc level3"><a href="#txldap-3">Collect Information for the Directory Server for LDAP</a></p>
<p class="toc level3"><a href="#txldap-4">Install the Sun Java System Directory Server</a></p>
<p class="toc level3"><a href="#txldap-12">Protect Access Logs for the Sun Java System Directory Server</a></p>
<p class="toc level3"><a href="#txldap-14">Protect Error Logs for the Sun Java System Directory Server</a></p>
<p class="toc level3"><a href="#txldap-10">Configure a Multilevel Port for the Sun Java System Directory Server</a></p>
<p class="toc level3"><a href="#txldap-2">Populate the Sun Java System Directory Server</a></p>
</div>
<p class="toc level2 tocsp"><a href="txconf-37.html">Creating a Trusted Extensions Proxy for an Existing Sun Java System Directory Server</a></p>
<p class="toc level3"><a href="txconf-37.html#txldap-6">Create an LDAP Proxy Server</a></p>
<p class="toc level2 tocsp"><a href="confsys-10.html">Configuring the Solaris Management Console for LDAP (Task Map)</a></p>
<p class="toc level3"><a href="confsys-10.html#txldap-11">Register LDAP Credentials With the Solaris Management Console</a></p>
<p class="toc level3"><a href="confsys-10.html#txldap-19">Enable an LDAP Client to Administer LDAP</a></p>
<p class="toc level3"><a href="confsys-10.html#txldap-7">Edit the LDAP Toolbox in the Solaris Management Console</a></p>
<p class="toc level3"><a href="confsys-10.html#txldap-9">Verify That the Solaris Management Console Contains Trusted Extensions Information</a></p>
<p class="toc level1 tocsp"><a href="headl-1.html">6.&nbsp;&nbsp;Configuring a Headless System With Trusted Extensions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="appol-1.html">A.&nbsp;&nbsp;Site Security Policy</a></p>
<p class="toc level1 tocsp"><a href="aptxconf-1.html">B.&nbsp;&nbsp;Using CDE Actions to Install Zones in Trusted Extensions</a></p>
<p class="toc level1 tocsp"><a href="checklist-1.html">C.&nbsp;&nbsp;Configuration Checklist for Trusted Extensions</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="txconf-8"></a><h3>Configuring the Sun Java System Directory Server on a Trusted Extensions System</h3>
<a name="indexterm-234"></a><a name="indexterm-235"></a><a name="indexterm-236"></a><a name="indexterm-237"></a><a name="indexterm-238"></a><a name="indexterm-239"></a><p>The LDAP naming service is the supported naming service for Trusted Extensions. If
your site is not yet running the LDAP naming service, configure a
Sun Java System Directory Server (Directory Server) on a system that is configured
with Trusted Extensions. If your site is already running a Directory Server, then
you need to add the Trusted Extensions databases to the server. To access
the Directory Server, you then set up an LDAP proxy on a Trusted
Extensions system.</p>
<hr><p><b>Note - </b>If you do not use this LDAP server as an NFS server
or as a server for Sun Ray<sup>TM</sup> clients, then you do not need
to install any labeled zones on this server.</p>
<hr>


<a name="txldap-3"></a><h4>Collect Information for the Directory Server for LDAP</h4><a name="indexterm-240"></a><a name="indexterm-241"></a><ul>
<li><b>Determine the values for the following items.</b><p>The items are listed in the order of their appearance in the Sun
Java Enterprise System Install Wizard.</p><table><col width="31.24*"><col width="68.76*"><tr><th align="left" valign="top" scope="column"><p>Install Wizard Prompt</p></th>
<th align="left" valign="top" scope="column"><p>Action or Information</p></th>
</tr>
<tr><td colspan="2" align="left" valign="top" scope="row"><p>Sun Java System Directory Server
<i>version</i></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Administrator User ID</p></td>
<td align="left" valign="top" scope="row"><p>The default value is <tt>admin</tt>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Administrator Password</p></td>
<td align="left" valign="top" scope="row"><p>Create a password, such as
<tt>admin123</tt>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Directory Manager DN</p></td>
<td align="left" valign="top" scope="row"><p>The default value is <tt>cn=Directory Manager</tt>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Directory Manager Password</p></td>
<td align="left" valign="top" scope="row"><p>Create a password, such
as <tt>dirmgr89</tt>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Directory Server Root</p></td>
<td align="left" valign="top" scope="row"><p>The default value is <tt>/var/Sun/mps</tt>. This path is also used
later if the proxy software is installed.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Server Identifier</p></td>
<td align="left" valign="top" scope="row"><p>The default value is the
local system.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Server Port</p></td>
<td align="left" valign="top" scope="row"><p>If you plan to use the Directory Server to provide
standard LDAP naming services to client systems, use the default value, <tt>389</tt>.</p><p>If you
plan to use the Directory Server to support a subsequent installation of a
proxy server, enter a nonstandard port, such as <tt>10389</tt>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Suffix</p></td>
<td align="left" valign="top" scope="row"><p>Include your domain component,
as in <tt>dc=example-domain,dc=com</tt>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Administration Domain</p></td>
<td align="left" valign="top" scope="row"><p>Construct to correspond to the Suffix, as in, <tt>example-domain.com</tt>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>System
User</p></td>
<td align="left" valign="top" scope="row"><p>The default value is <tt>root</tt>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>System Group</p></td>
<td align="left" valign="top" scope="row"><p>The default value is <tt>root</tt>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Data Storage Location</p></td>
<td align="left" valign="top" scope="row"><p>The
default value is <tt>Store configuration data on this server</tt>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Data Storage Location</p></td>
<td align="left" valign="top" scope="row"><p>The default value is <tt>Store user data and group data on this server</tt>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Administration Port</p></td>
<td align="left" valign="top" scope="row"><p>The default
value is the Server Port. A suggested convention for changing the default is
<tt>software-version TIMES 1000</tt>. For software version 5.2, this convention would result in port <tt>5200</tt>.</p></td>
</tr>
</table></li></ul>

<a name="txldap-4"></a><h4>Install the Sun Java System Directory Server</h4><a name="indexterm-242"></a><a name="indexterm-243"></a><p>The Directory Server packages are available from the <a href="http://www.sun.com/software/solaris">Sun Software Gateway web site</a>. </p><ol>
<li><b>Find the Sun Java System Directory Server packages on the Sun web
site.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>On the <a href="http://www.sun.com/software/solaris">Sun Software Gateway</a> page, click the Get It tab.</b></li>
<li><b>Click the checkbox for the Sun Java Identity Management Suite.</b></li>
<li><b>Click the Submit button.</b></li>
<li><b>If you are not registered, register.</b></li>
<li><b>Log in to download the software.</b></li>
<li><b>Click the Download Center at the upper left of the screen.</b></li>
<li><b>Under Identity Management, download the most recent software that is appropriate for your
platform.</b></li></ol></li>
<li><b>In the <tt>/etc/hosts</tt> file, add the FQDN to your system's hostname entry.</b><p>The FQDN is the Fully Qualified Domain Name. This name is a combination
of the host name and the administration domain, as in:</p><pre>192.168.5.5 myhost myhost.example-domain.com</pre></li>
<li><b>Install the Directory Server packages.</b><p>Answer the questions by using the information from <a href="#txldap-3">Collect Information for the Directory Server for LDAP</a>.</p></li>
<li><b>Ensure that the Directory Server starts at every boot.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Add an <tt>init.d</tt> script.</b><p>In the following example, change the <tt>SERVER_ROOT</tt> and <tt>SERVER_INSTANCE</tt> variables to match your
installation.</p><pre>/etc/init.d/ldap.directory-myhost
---------------------------------------
#!/sbin/sh

SERVER_ROOT=/var/Sun/mps
SERVER_INSTANCE=myhost

case "$1" in
start)
${SERVER_ROOT}/slapd-${SERVER_INSTANCE}/start-slapd
;;
stop)

${SERVER_ROOT}/slapd-${SERVER_INSTANCE}/stop-slapd
;;
*)

echo "Usage: $0 { start | stop }"
exit 1
esac
exit 0</pre></li>
<li><b>Link the <tt>init.d</tt> script to the <tt>rc2.d</tt> directory.</b><pre>/usr/bin/ln \
/etc/init.d/ldap.directory-myhost \
/etc/rc2.d/S70ldap.directory-myhost</pre></li></ol></li>
<li><b>Verify your installation.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Examine your installation directory.</b><p>A subdirectory that is named <tt>slapd-</tt><i>server-hostname</i> must exist.</p></li>
<li><b>Start the Directory Server.</b><pre># <i>installation-directory</i>/slapd-<i>server-hostname</i>/restart-slapd</pre></li>
<li><b>Verify that the <tt>slapd</tt> process exists.</b><pre># <tt><b>ps -ef | grep slapd</b></tt>
./ns-slapd -D <i>installation-directory</i>/slapd-<i>server-instance</i> -i
<i>installation-directory</i>/slapd-<i>server-instance</i>/</pre></li></ol></li></ol><h6>Troubleshooting</h6><p>For strategies to solve LDAP configuration problems, see <a href="http://docs.sun.com/doc/819-3194/setupproblems-1?a=view">Chapter 13, LDAP Troubleshooting (Reference), in <i>System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</i></a>.</p>

<a name="txldap-12"></a><h4>Protect Access Logs for the Sun Java System Directory Server</h4><a name="indexterm-244"></a><p>The LDIF script that this procedure creates sets up the following rules for
access logs:</p>
<ul><li><p>Log events at log level 256 and create buffered logs (default).</p></li>
<li><p>Rotate logs daily.</p></li>
<li><p>Keep a maximum of 100 log files, and each file is at most 500 MBytes.</p></li>
<li><p>Expire log files that are older than 3 months.</p></li>
<li><p>Delete oldest logs if less than 500 MBytes free disk space is available.</p></li>
<li><p>All log files use a maximum of 20,000 MBytes of disk space.</p></li></ul>
<ol>
<li><b>Create a script to manage access logs.</b><p>Create a <tt>/var/tmp/logs-access.ldif</tt> file with the following content:</p><pre>dn: cn=config
changetype: modify
replace: nsslapd-accesslog-logging-enabled
nsslapd-accesslog-logging-enabled: on
-
replace: nsslapd-accesslog-level
nsslapd-accesslog-level: 256
-
replace: nsslapd-accesslog-logbuffering
nsslapd-accesslog-logbuffering: on
-
replace: nsslapd-accesslog-logrotationtime
nsslapd-accesslog-logrotationtime: 1
-
replace: nsslapd-accesslog-logrotationtimeunit
nsslapd-accesslog-logrotationtimeunit: day
-
replace: nsslapd-accesslog-maxlogsize
nsslapd-accesslog-maxlogsize: 500
-
replace: nsslapd-accesslog-maxlogsperdir
nsslapd-accesslog-maxlogsperdir: 100
-
replace: nsslapd-accesslog-logexpirationtime
nsslapd-accesslog-logexpirationtime: 3
-
replace: nsslapd-accesslog-logexpirationtimeunit
nsslapd-accesslog-logexpirationtimeunit: month
-
replace: nsslapd-accesslog-logmaxdiskspace
nsslapd-accesslog-logmaxdiskspace: 20000
-
replace: nsslapd-accesslog-logminfreediskspace
nsslapd-accesslog-logminfreediskspace: 500</pre></li>
<li><b>Run the script.</b><pre># <tt><b>ldapmodify -h localhost -D 'cn=directory manager' \ -f /var/tmp/logs-access.ldif</b></tt></pre></li>
<li><b>Type the password.</b><pre>Enter bind password: Type the appropriate password
modifying entry cn=config</pre></li></ol>

<a name="txldap-14"></a><h4>Protect Error Logs for the Sun Java System Directory Server</h4><a name="indexterm-245"></a><p>The LDIF script that this procedure creates sets up the following rules for
the error logs:</p>
<ul><li><p>Rotate logs weekly.</p></li>
<li><p>Keep a maximum of 30 log files, and each file is at most 500 MBytes.</p></li>
<li><p>Expire log files that are older than 3 months.</p></li>
<li><p>Delete oldest logs if less than 500 MBytes free disk space is available.</p></li>
<li><p>All log files use a maximum of 20,000 MBytes of disk space.</p></li></ul>
<ol>
<li><b>Create a script to manage error logs.</b><p>Create a <tt>/var/tmp/logs-error.ldif</tt> file with the following content:</p><pre>dn: cn=config
changetype: modify
replace: nsslapd-errorlog-logging-enabled
nsslapd-errorlog-logging-enabled: on
-
replace: nsslapd-errorlog-logexpirationtime
nsslapd-errorlog-logexpirationtime: 3
-
replace: nsslapd-errorlog-logexpirationtimeunit
nsslapd-errorlog-logexpirationtimeunit: month
-
replace: nsslapd-errorlog-logrotationtime
nsslapd-errorlog-logrotationtime: 1
-
replace: nsslapd-errorlog-logrotationtimeunit
nsslapd-errorlog-logrotationtimeunit: week
-
replace: nsslapd-errorlog-maxlogsize
nsslapd-errorlog-maxlogsize: 500
-
replace: nsslapd-errorlog-maxlogsperdir
nsslapd-errorlog-maxlogsperdir: 30
-
replace: nsslapd-errorlog-logmaxdiskspace
nsslapd-errorlog-logmaxdiskspace: 20000
-
replace: nsslapd-errorlog-logminfreediskspace
nsslapd-errorlog-logminfreediskspace: 500</pre></li>
<li><b>Run the script.</b><pre># <tt><b>ldapmodify -h localhost -D 'cn=directory manager' -f /var/tmp/logs-error.ldif</b></tt></pre></li>
<li><b>Answer the prompts.</b><pre>Enter bind password: Type the appropriate password
modifying entry cn=config</pre></li></ol>

<a name="txldap-10"></a><h4>Configure a Multilevel Port for the Sun Java System Directory Server</h4><a name="indexterm-246"></a><p>To work in Trusted Extensions, the server port of the Directory Server
must be configured as a multilevel port (MLP) in the global zone.</p><ol>
<li><b>Start the Solaris Management Console.</b><pre># <tt><b>/usr/sbin/smc &amp;</b></tt></pre></li>
<li><b>Select the This Computer (<i>this-host</i>: <tt>Scope=Files, Policy=TSOL</tt>) toolbox.</b></li>
<li><b>Click System Configuration, then click Computers and Networks.</b><p>You are prompted for your password.</p></li>
<li><b>Type the appropriate password.</b></li>
<li><b>Double-click Trusted Network Zones.</b></li>
<li><b>Double-click the global zone.</b></li>
<li><b>Add a multilevel port for the TCP protocol:</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Click Add for the Multilevel Ports for Zone's IP Addresses.</b></li>
<li><b>Type 389 for the port number, and click OK.</b></li></ol></li>
<li><b>Add a multilevel port for the UDP protocol:</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Click Add for the Multilevel Ports for Zone's IP Addresses.</b></li>
<li><b>Type 389 for the port number.</b></li>
<li><b>Choose the udp protocol, and click OK.</b></li></ol></li>
<li><b>Click OK to save the settings.</b></li>
<li><b>Update the kernel.</b><pre># <tt><b>tnctl -fz /etc/security/tsol/tnzonecfg</b></tt></pre></li></ol>

<a name="txldap-2"></a><h4>Populate the Sun Java System Directory Server</h4><a name="indexterm-247"></a><p>Several LDAP databases have been created or modified to hold Trusted Extensions
data about label configuration, users, and remote systems. In this procedure, you populate the
Directory Server databases with Trusted Extensions information.</p><ol>
<li><b><a name="indexterm-248"></a>Create a staging area for files that you plan to use to populate
the naming service databases.</b><pre># <tt><b>mkdir -p /setup/files</b></tt></pre></li>
<li><b>Copy the sample <tt>/etc</tt> files into the staging area.</b><pre># <tt><b>cd /etc</b></tt>
# <tt><b>cp aliases group networks netmasks protocols /setup/files</b></tt>
# <tt><b>cp rpc services auto_master /setup/files</b></tt>

# <tt><b>cd /etc/security</b></tt>
# <tt><b>cp auth_attr prof_attr exec_attr /setup/files/</b></tt>
#
# <tt><b>cd /etc/security/tsol</b></tt>
# <tt><b>cp tnrhdb tnrhtp /setup/files</b></tt></pre><p>If you are running the Solaris&nbsp;10&nbsp;11/06 release without patches, copy the <tt>ipnodes</tt>
file.</p><pre># <tt><b>cd /etc/inet</b></tt>
# <tt><b>cp ipnodes /setup/files</b></tt></pre></li>
<li><b>Remove the <tt>+auto_master</tt> entry from the <tt>/setup/files/auto_master</tt> file.</b></li>
<li><b>Remove the <tt>?:::::?</tt> entry from the <tt>/setup/files/auth_attr</tt> file.</b></li>
<li><b>Remove the <tt>::::</tt> entry from the <tt>/setup/files/prof_attr</tt> file.</b></li>
<li><b>Create the zone automaps in the staging area.</b><p>In the following list of automaps, the first of each pair of
lines shows the name of the file. The second line of each pair
shows the file contents. The zone names identify labels from the default <tt>label_encodings</tt>
file that is included with the Trusted Extensions software.</p>
<ul><li><p>Substitute your zone names for the zone names in these lines.</p></li>
<li><p><i>myNFSserver</i> identifies the NFS server for the home directories.</p></li></ul>
<pre>/setup/files/auto_home_public
 * <i>myNFSserver</i>_FQDN:/zone/public/root/export/home/&amp;

/setup/files/auto_home_internal
 * <i>myNFSserve</i>r_FQDN:/zone/internal/root/export/home/&amp;

/setup/files/auto_home_needtoknow
 * <i>myNFSserver</i>_FQDN:/zone/needtoknow/root/export/home/&amp;

/setup/files/auto_home_restricted
 * <i>myNFSserver</i>_FQDN:/zone/restricted/root/export/home/&amp;</pre></li>
<li><b>Add every system on the network to the <tt>/setup/files/tnrhdb</tt> file. </b><p>No wildcard mechanism can be used here. The IP address of every system
to be contacted, including the IP addresses of labeled zones, <b>must</b> be
in this file.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>Open the trusted editor and edit <tt>/setup/files/tnrhdb</tt>.</b></li>
<li><b>Add every IP address on a labeled system in the Trusted Extensions
domain.</b><p>Labeled systems are of type <tt>cipso</tt>. Also, the name of the security template
for labeled systems is <tt>cipso</tt>. Therefore, in the default configuration, a <tt>cipso</tt> entry is
similar to the following:</p><pre>192.168.25.2:cipso</pre>
<hr><p><b>Note - </b>This list includes the IP addresses of global zones and labeled zones.</p>
<hr>
</li>
<li><b>Add every unlabeled system with which the domain can communicate.</b><p>Unlabeled systems are of type <tt>unlabeled</tt>. The name of the security template for
unlabeled systems is <tt>admin_low</tt>. Therefore, in the default configuration, an entry for an
unlabeled system is similar to the following:</p><pre>192.168.35.2:admin_low</pre></li>
<li><b>Save the file, and exit the editor.</b></li>
<li><b>Check the syntax of the file.</b><pre># <tt><b>tnchkdb -h /setup/files/tnrhdb</b></tt></pre></li>
<li><b>Fix any errors before continuing.</b></li></ol></li>
<li><b>Copy the <tt>/setup/files/tnrhdb</tt> file to the <tt>/etc/security/tsol/tnrhdb</tt> file.</b></li>
<li><a name="nisp-step-64"></a><b>Use the <tt>ldapaddent</tt> command to populate every file in the staging area.</b><pre># <tt><b>/usr/sbin/ldapaddent -D "cn=directory manager" \ -w dirmgr123 -a simple -f /setup/files/hosts hosts</b></tt></pre></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="txldap-18.html">Previous</a>
             </td>
             <td align="right">
                 <a href="txconf-37.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

