<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Creating Labeled Zones - Solaris Trusted Extensions Installation and Configuration</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-05-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">Solaris Trusted Extensions Installation and Configuration</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="txconf-60.html">Previous</a>
             </td>
             <td align="right">
                 <a href="txconf-14.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-4.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="ovw-1.html">1.&nbsp;&nbsp;Security Planning for Trusted Extensions</a></p>
<p class="toc level1 tocsp"><a href="tmap-1.html">2.&nbsp;&nbsp;Installation and Configuration Roadmap for Trusted Extensions</a></p>
<p class="toc level1 tocsp"><a href="startinst-1.html">3.&nbsp;&nbsp;Installing Solaris Trusted Extensions Software  (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="txconf-1.html">4.&nbsp;&nbsp;Configuring Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="txconf-60.html">Setting Up the Global Zone in Trusted Extensions</a></p>
<p class="toc level3"><a href="txconf-60.html#confsys-17">Check and Install Your Label Encodings File</a></p>
<p class="toc level3"><a href="txconf-60.html#txconf-35">Enable IPv6 Networking in Trusted Extensions</a></p>
<p class="toc level3"><a href="txconf-60.html#txconf-42">Create ZFS Pool for Cloning Zones</a></p>
<p class="toc level3"><a href="txconf-60.html#confsys-3">Reboot and Log In to Trusted Extensions</a></p>
<p class="toc level3"><a href="txconf-60.html#confsys-21">Initialize the Solaris Management Console Server in Trusted Extensions</a></p>
<p class="toc level3"><a href="txconf-60.html#txldap-8">Make the Global Zone an LDAP Client in Trusted Extensions</a></p>
<div class="onpage">
<p class="toc level2 tocsp"><a href="">Creating Labeled Zones</a></p>
<p class="toc level3"><a href="#txconf-80">Run the <tt>txzonemgr</tt> Script</a></p>
<p class="toc level3"><a href="#txconf-netint-1">Configure the Network Interfaces in Trusted Extensions</a></p>
<p class="toc level3"><a href="#txconf-11">Name and Label the Zone</a></p>
<p class="toc level3"><a href="#txconf-install-1">Install the Labeled Zone</a></p>
<p class="toc level3"><a href="#txconf-76">Boot the Labeled Zone</a></p>
<p class="toc level3"><a href="#txconf-74">Verify the Status of the Zone</a></p>
<p class="toc level3"><a href="#txconf-48">Customize the Labeled Zone</a></p>
<p class="toc level3"><a href="#txconf-54">Create Another Zone in Trusted Extensions</a></p>
<p class="toc level3"><a href="#txconf-84">Add a Network Interface to an Existing Labeled Zone</a></p>
</div>
<p class="toc level2 tocsp"><a href="txconf-14.html">Creating Roles and Users in Trusted Extensions</a></p>
<p class="toc level3"><a href="txconf-14.html#txconf-23">Create the Security Administrator Role in Trusted Extensions</a></p>
<p class="toc level3"><a href="txconf-14.html#txconf-25">Create Users Who Can Assume Roles in Trusted Extensions</a></p>
<p class="toc level3"><a href="txconf-14.html#txconf-29">Verify That the Trusted Extensions Roles Work</a></p>
<p class="toc level3"><a href="txconf-14.html#txconf-34">Enable Users to Log In to a Labeled Zone</a></p>
<p class="toc level2 tocsp"><a href="txconf-50.html">Creating Home Directories in Trusted Extensions</a></p>
<p class="toc level3"><a href="txconf-50.html#txconf-52">Create the Home Directory Server in Trusted Extensions</a></p>
<p class="toc level3"><a href="txconf-50.html#txconf-56">Enable Users to Access Their Home Directories in Trusted Extensions</a></p>
<p class="toc level2 tocsp"><a href="txconf-64.html">Adding Users and Hosts to an Existing Trusted Network</a></p>
<p class="toc level3"><a href="txconf-64.html#txconf-65">Add an NIS User to the LDAP Server</a></p>
<p class="toc level2 tocsp"><a href="txconf-trouble-1.html">Troubleshooting Your Trusted Extensions Configuration</a></p>
<p class="toc level2"><a href="txconf-18.html">Additional Trusted Extensions Configuration Tasks</a></p>
<p class="toc level3"><a href="txconf-18.html#basic-52">How to Copy Files to Portable Media in Trusted Extensions</a></p>
<p class="toc level3"><a href="txconf-18.html#basic-25">How to Copy Files From Portable Media in Trusted Extensions</a></p>
<p class="toc level3"><a href="txconf-18.html#txconf-72">How to Remove Trusted Extensions From the System</a></p>
<p class="toc level1 tocsp"><a href="txldap-1.html">5.&nbsp;&nbsp;Configuring LDAP for Trusted Extensions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="headl-1.html">6.&nbsp;&nbsp;Configuring a Headless System With Trusted Extensions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="appol-1.html">A.&nbsp;&nbsp;Site Security Policy</a></p>
<p class="toc level1 tocsp"><a href="aptxconf-1.html">B.&nbsp;&nbsp;Using CDE Actions to Install Zones in Trusted Extensions</a></p>
<p class="toc level1 tocsp"><a href="checklist-1.html">C.&nbsp;&nbsp;Configuration Checklist for Trusted Extensions</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="txconf-20"></a><h3>Creating Labeled Zones</h3>
<a name="indexterm-123"></a><a name="indexterm-124"></a><a name="indexterm-125"></a><a name="indexterm-126"></a><a name="indexterm-127"></a><p>The <tt>txzonemgr</tt> script steps you through all the following tasks that configure labeled
zones.</p>
<hr><p><b>Caution - </b>You must be running the Solaris&nbsp;10&nbsp;8/07 release of Trusted Extensions to use the
<tt>txzonemgr</tt> procedures. Or, you must install all patches for this release.</p>
<hr>
<p>The instructions in this section configure labeled zones on a system that has
been assigned at most two IP addresses. For other configurations, see the configuration
options in <a href="tmap-2.html">Task Map: Preparing For and Installing Trusted Extensions</a>.</p><table><col width="22.20*"><col width="45.03*"><col width="31.76*"><tr><th align="left" valign="top" scope="column"><p>Task</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
<th align="left" valign="top" scope="column"><p>For Instructions</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>1. Run the <tt>txzonemgr</tt> script.</p></td>
<td align="left" valign="top" scope="row"><p>The <tt>txzonemgr</tt> script creates a
GUI that presents the appropriate tasks as you configure your zones.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#txconf-80">Run the <tt>txzonemgr</tt> Script</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>2. Manage network
interfaces in the global zone.</p></td>
<td align="left" valign="top" scope="row"><p>Configure interfaces in the global zone, or create
logical interfaces and configure them in the global zone.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#txconf-netint-1">Configure the Network Interfaces in Trusted Extensions</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>3. Name and label the
zone.</p></td>
<td align="left" valign="top" scope="row"><p>Name the zone with a version of its label, and assign the
label.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#txconf-11">Name and Label the Zone</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>4. Install and boot the zone.</p></td>
<td align="left" valign="top" scope="row"><p>Install the packages in the zone. Configure
services in the zone. A Zone Terminal Console enables you to view the
activity in the zone.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#txconf-install-1">Install the Labeled Zone</a></p><p><a href="#txconf-76">Boot the Labeled Zone</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>5. Verify the status of the zone.</p></td>
<td align="left" valign="top" scope="row"><p>Verify that the
labeled zone is running, and that the zone can communicate with the global
zone.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#txconf-74">Verify the Status of the Zone</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>6. Customize the zone.</p></td>
<td align="left" valign="top" scope="row"><p>Remove unwanted services from the zone.</p><p>If the zone is
going to be used to create other zones, remove information that is specific
to this zone only.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#txconf-48">Customize the Labeled Zone</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>7. Create the rest of the zones.</p></td>
<td align="left" valign="top" scope="row"><p>Use the method
that you have chosen to create your second zone. For a discussion of
zone creation methods, see <a href="ovw-36.html#ovw-11">Planning for Zones in Trusted Extensions</a>.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#txconf-54">Create Another Zone in Trusted Extensions</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>8. (Optional) Add zone-specific network interfaces.</p></td>
<td align="left" valign="top" scope="row"><p>To effect network
isolation, add one or more network interfaces to a labeled zone. Typically, this
configuration is used to isolate labeled subnets.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#txconf-84">Add a Network Interface to an Existing Labeled Zone</a></p></td>
</tr>
</table>

<a name="txconf-80"></a><h4>Run the <tt>txzonemgr</tt> Script</h4><a name="indexterm-128"></a><a name="indexterm-129"></a><a name="indexterm-130"></a><a name="indexterm-131"></a><p>This script steps you through the tasks to properly configure, install, initialize, and
boot labeled zones. In the script, you name each zone, associate the name
with a label, install the packages to create a virtual OS, and
then boot the zone to start services in that zone. The script includes
copy zone and clone zone tasks. You can also halt a zone, change
the state of a zone, and add zone-specific network interfaces.</p><p>This script presents a dynamically-determined menu that displays only valid choices for the
current circumstances. For instance, if the status of a zone is configured, the
Install zone menu item is not displayed. Tasks that are completed do not
display in the list.</p><h6>Before You Begin</h6><p>You are superuser.</p><p>If you plan to clone zones, you have completed the preparation for
cloning zones. If you plan to use your own security templates, you have
created the templates.</p><ol>
<li><b>Open a terminal window in the global zone.</b></li>
<li><b>Run the <tt>txzonemgr</tt> script.</b><pre># <tt><b>/usr/sbin/txzonemgr</b></tt></pre><p>The script opens the  <tt>Labeled Zone Manager</tt> dialog box. This <tt>zenity</tt> dialog box prompts
you for the appropriate tasks, depending on the current state of your installation.</p><p>To perform a task, you select the menu item, then press the Return
key or click OK. When you are prompted for text, type the text
then press the Return key or click OK.</p></li></ol>

<a name="txconf-netint-1"></a><h4>Configure the Network Interfaces in Trusted Extensions</h4>
<hr><p><b>Note - </b>If you are configuring your system to use DHCP or to prevent
networks from contacting the global zone, refer to the laptop instructions in the
Trusted Extensions section of <a href="http://opensolaris.org/os/community/security">OpenSolaris Community: Security web page</a>.</p>
<hr>
<p>In this task, you configure the networking in the global zone. You
must create exactly one <tt>all-zones</tt> interface. An <tt>all-zones</tt> interface is shared by the
labeled zones and the global zone. The shared interface is used to route
traffic between the labeled zones and the global zone. To configure this interface,
do one of the following:</p>
<ul><li><p>Create a logical interface from a physical interface, then share the physical interface.</p><p>This configuration is the simplest to administer. Choose this configuration when your system has been assigned two IP addresses. In this procedure, the logical interface becomes the global zone's specific address, and the physical interface is shared between the global zone and the labeled zones.</p></li>
<li><p>Share a physical interface</p><p>Choose this configuration when your system has been assigned one IP address. In this configuration, the physical interface is shared between the global zone and the labeled zones.</p></li>
<li><p>Share a virtual network interface, <tt>vni0</tt></p><p>Choose this configuration when you are configuring DHCP, or when each subnetwork is at a different label. For a sample procedure, refer to the laptop instructions in the Trusted Extensions section of <a href="http://opensolaris.org/os/community/security">OpenSolaris Community: Security web page</a>.</p></li></ul>
<p>To add zone-specific network interfaces, finish and verify zone creation before adding the
interfaces. For the procedure, see <a href="#txconf-84">Add a Network Interface to an Existing Labeled Zone</a>.</p><h6>Before You Begin</h6><p>You are superuser in the global zone.</p><p>The Labeled Zone Manager is displayed. To open this GUI, see <a href="#txconf-80">Run the <tt>txzonemgr</tt> Script</a>.</p><ol>
<li><b>In the Labeled Zone Manager, select Manage Network Interfaces and click OK.</b><p>A list of interfaces is displayed.</p>
<hr><p><b>Note - </b>In this example, the physical interface was assigned a host name and an
IP address during installation.</p>
<hr>
</li>
<li><b>Select the physical interface.</b><p>A system with one interface displays a menu similar to the following. The
annotation is added for assistance:</p><pre>vni0                        DownVirtual Network Interface
eri0 global 10.10.9.9 cipso Up Physical Interface</pre><ol style="list-style-type: lower-alpha">
				 
<li><b>Select the <tt>eri0</tt> interface.</b></li>
<li><b>Click OK</b></li></ol></li>
<li><b>Select the appropriate task for this network interface.</b><p>You are offered three options:</p><pre>View Template Assign a label to the interface
Share Enable the global zone and labeled zones to use this interface
Create Logical Interface Create an interface to use for sharing</pre><ul>
<li><b>If your system has one IP address,  go to <a href="#txconf-1ip-1">Step&nbsp;4</a>.</b></li>
<li><b>If your system has two IP addresses, go to <a href="#txconf-2ip-1">Step&nbsp;6</a>.</b></li></ul></li>
<li><a name="txconf-1ip-1"></a><b>On a system with one IP address, share the physical interface.</b><p>In this configuration, the host's IP address applies to all zones. Therefore, the
host's address is the <tt>all-zones</tt> address. This host cannot be used as a
multilevel server. For example, users cannot share files from this system. The system
cannot be an LDAP proxy server, an NFS home directory server, or a
print server.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>Select Share and click OK.</b></li>
<li><b>At the prompt, accept the host name.</b></li>
<li><b>Dismiss the dialog box that displays the netmask.</b><pre>eri0  all-zones  10.10.9.8  cipso  Up</pre></li></ol></li>
<li><b>Skip the next step.</b><p>You are successful when the physical interface is an <tt>all-zones</tt> interface.</p></li>
<li><a name="txconf-2ip-1"></a><b>On a system with two IP addresses, create a logical interface.</b><p>Then, share the physical interface.</p><p>This is the simplest Trusted Extensions network configuration. In this configuration, the main
IP address can be used by other systems to reach any zone
on this system, and the logical interface is zone-specific to the global zone.
The global zone can be used as a multilevel server.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>Select Create Logical Interface and click OK.</b><p>Dismiss the dialog box that confirms the creation of a new logical interface.</p></li>
<li><b>Select Set IP address and click OK.</b></li>
<li><b>At the prompt, specify the host name for the logical interface and click
OK.</b><p>For example, specify <tt>machine1-services</tt> as the host name for the logical interface. The
name indicates that this host offers multilevel services.</p></li>
<li><b>At the prompt, specify the IP address for the logical interface and click
OK.</b><p>For example, specify <tt>10.10.9.2</tt> as the IP address for the logical interface.</p></li>
<li><b>Select the logical interface again and click OK.</b></li>
<li><b>Select Bring Up and click OK.</b><p>The interface is displayed as <tt>Up</tt>.</p><pre>eri0    global       10.10.9.1   cipso   Up
eri0:1  global       10.10.9.2   cipso   Up</pre></li>
<li><b>Share the physical interface.</b><ol style="list-style-type: lower-roman">
<li><b>Select the physical interface and click OK.</b></li>
<li><b>Select Share and click OK.</b><pre>eri0    all-zones    10.10.9.1   cipso   Up
eri0:1  global       10.10.9.2   cipso   Up</pre></li></ol></li></ol><p>You are successful when at least one interface is an <tt>all-zones</tt> interface.</p></li></ol><a name="txconf-38"></a>Example&nbsp;4-2 Viewing the <tt>/etc/hosts</tt> File on a System With a Shared Logical Interface<p>On a system where the global zone has a unique interface and
labeled zones share a second interface with the global zone, the <tt>/etc/hosts</tt> file appears
similar to the following:</p><pre># <tt><b>cat /etc/hosts</b></tt>
...
127.0.0.1  localhost
192.168.0.11 machine1 loghost
192.168.0.12 machine1-services </pre><p>In the default configuration, the <tt>tnrhdb</tt> file appears similar to the following:</p><pre># <tt><b>cat /etc/security/tsol/tnrhdb</b></tt>
...
127.0.0.1:cipso
192.168.0.11:cipso
192.168.0.12:cipso
0.0.0.0:admin_low</pre><p>If the <tt>all-zones</tt> interface is not in the <tt>tnrhdb</tt> file, the interface
defaults to <tt>cipso</tt>.</p><a name="txconf-oneip-1"></a>Example&nbsp;4-3 Displaying the Shared Interface on a Trusted Extensions System With One IP Address<a name="indexterm-132"></a><a name="indexterm-133"></a><p>In this example, the administrator is not planning to use the system as
a multilevel server. To conserve IP addresses, the global zone is configured to
share its IP address with every labeled zone.</p><p>The administrator selects Share for the <tt>hme0</tt> interface on the system. The software
configures all zones to have logical NICs. These logical NICs share a single
physical NIC in the global zone.</p><p>The administrator runs the <tt><b>ifconfig -a</b></tt> command to verify that the physical interface <tt>hme0</tt>
on network interface <tt>192.168.0.11</tt> is shared. The value <tt>all-zones</tt> is displayed:</p><pre> lo0: flags=2001000849&lt;UP,LOOPBACK,RUNNING,MULTICAST,IPv4,VIRTUAL> mtu 8232 index 1
         inet 127.0.0.1 netmask ff000000
 hme0: flags=1000843&lt;BROADCAST,RUNNING,MULTICAST,IPv4> mtu 1500 index 2
         all-zones
         inet 192.168.0.11 netmask fffffe00 broadcast 192.168.0.255</pre><p>The administrator also examines the contents of the <tt>/etc/hostname.hme0</tt> file:</p><pre>192.168.0.11 all-zones</pre>

<a name="txconf-11"></a><h4>Name and Label the Zone</h4><a name="indexterm-134"></a><a name="indexterm-135"></a><a name="indexterm-136"></a><a name="indexterm-137"></a><a name="indexterm-138"></a><a name="indexterm-139"></a><p>You do not have to create a zone for every label in
your <tt>label_encodings</tt> file, but you can. The administrative GUIs enumerate the labels that
can have zones created for them on this system.</p><h6>Before You Begin</h6><p>You are superuser in the global zone. The Labeled Zone Manager dialog box
is displayed. To open this GUI, see <a href="#txconf-80">Run the <tt>txzonemgr</tt> Script</a>. You have configured the
network interfaces in the global zone.</p><p>You have created any security templates that you need. A security template defines,
among other attributes, the label range that can be assigned to a network
interface. The default security templates might satisfy your needs.</p>
<ul><li><p>For an overview of security templates, see <a href="http://docs.sun.com/doc/819-7309/tnetov-40?a=view">Network Security Attributes in Trusted Extensions in <i>Solaris Trusted Extensions Administrator&rsquo;s Procedures</i></a>.</p></li>
<li><p>To use the Solaris Management Console to create security templates, see <a href="http://docs.sun.com/doc/819-7309/managetnet-3?a=view">Configuring Trusted Network Databases (Task Map) in <i>Solaris Trusted Extensions Administrator&rsquo;s Procedures</i></a>.</p></li></ul>
<ol>
<li><b><a name="indexterm-140"></a><a name="indexterm-141"></a>In the Labeled Zone Manager, select Create a new zone and click OK.</b><p>You are prompted for a name.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>Type the name for the zone.</b>
<hr><p><b>Tip - </b>Give the zone a name that is similar to the zone's label.
For example, the name of a zone whose label is <tt>CONFIDENTIAL: RESTRICTED</tt> would be <tt>restricted</tt>.</p>
<hr>
<p>For example, the default <tt>label_encodings</tt> file contains the following labels:</p><pre>PUBLIC
CONFIDENTIAL: INTERNAL USE ONLY
CONFIDENTIAL: NEED TO KNOW
CONFIDENTIAL: RESTRICTED
SANDBOX: PLAYGROUND
MAX LABEL</pre><p>Although you could create one zone per label, consider creating the following zones:</p>
<ul><li><p>On a system for all users, create one zone for the <tt>PUBLIC</tt> label and three zones for the <tt>CONFIDENTIAL</tt> labels.</p></li>
<li><p>On a system for developers, create a zone for the <tt>SANDBOX: PLAYGROUND</tt> label. Because <tt>SANDBOX: PLAYGROUND</tt> is defined as a disjoint label for developers, only systems that developers use need a zone for this label.</p></li>
<li><p>Do not create a zone for the <tt>MAX LABEL</tt> label, which is defined to be a clearance.</p></li></ul>
</li>
<li><b>Click OK.</b><p>The dialog box displays <i>zone-name</i><tt>:configured</tt> above a list of tasks.</p></li></ol></li>
<li><b>To label the zone, choose one of the following:</b><ul>
<li><b>If you are using a customized <tt>label_encodings</tt> file, label the zone by using
the Trusted Network Zones tool.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Open the Trusted Network Zones tool in the Solaris Management Console.</b><ol style="list-style-type: lower-roman">
<li><b><a name="indexterm-142"></a><a name="indexterm-143"></a><a name="indexterm-144"></a><a name="indexterm-145"></a>Start the Solaris Management Console.</b><pre># <tt><b>/usr/sbin/smc &amp;</b></tt></pre></li>
<li><b>Open the Trusted Extensions toolbox for the local system.</b><ol style="list-style-type: lower-roman">
<li><b>Choose Console &rarr; Open Toolbox.</b></li>
<li><b>Select the toolbox that is named This Computer (<i>this-host</i>: <tt>Scope=Files, Policy=TSOL</tt>).</b></li>
<li><b>Click Open.</b></li></ol></li>
<li><b>Under System Configuration, navigate to Computers and Networks.</b><p>Provide a password when prompted.</p></li>
<li><b>Double-click the Trusted Network Zones  tool.</b></li></ol></li>
<li><b>For each zone, associate the appropriate label with the zone name.</b><ol style="list-style-type: lower-roman">
<li><b>Choose Action  &rarr; Add Zone Configuration.</b><p>The dialog box displays the name of a zone that does not have
an assigned label.</p></li>
<li><b>Look at the zone name, then click Edit.</b></li>
<li><b>In the Label Builder, click the appropriate label for the zone name.</b><p>If you click the wrong label, click the label again to deselect it,
then click the correct label.</p></li>
<li><b>Save the assignment.</b><p>Click OK in the Label Builder, then click OK in the Trusted Network
Zones Properties dialog box.</p></li></ol><p>You are finished when every zone that you want is listed in
the panel, or the Add Zone Configuration menu item opens a dialog box
that does not have a value for Zone Name.</p></li></ol></li>
<li><b>If you are using the default <tt>label_encodings</tt> file, use the Labeled Zone Manager.</b><p>Click Select Label menu item and OK to display the list of available
labels.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>Select the label for the zone.</b><p>For a zone that is named <tt>public</tt>, you would select the label <tt>PUBLIC</tt>
from the list.</p></li>
<li><b>Click OK.</b><p>A list of tasks is displayed.</p></li></ol></li></ul></li></ol>

<a name="txconf-install-1"></a><h4>Install the Labeled Zone</h4><a name="indexterm-146"></a><a name="indexterm-147"></a><h6>Before You Begin</h6><p>You are superuser in the global zone. The zone is installed, and
has an assigned a network interface. </p><p>The Labeled Zone Manager dialog box is displayed with the subtitle <i>zone-name</i><tt>:configured</tt>.
To open this GUI, see <a href="#txconf-80">Run the <tt>txzonemgr</tt> Script</a>.</p><ol>
<li><a name="txconf-scratch-1"></a><b>From the Labeled Zone Manager, select Install and click OK.</b>
<hr><p><b>Caution - </b>This process takes some time to finish. Do not perform other tasks while
this task is completing.</p>
<hr>
<p>The system copies packages from the global zone to the non-global zone. This
task installs a labeled virtual operating system in the zone. To continue the
example, this task installs the <tt>public</tt> zone. The GUI displays output similar to
the following.</p><pre># Labeled Zone Manager: Installing <i>zone-name</i> zone
Preparing to install zone &lt;<i>zonename</i>>
Creating list of files to copy from the global zone
Copying &lt;<i>total</i>> files to the zone
Initializing zone product registry
Determining zone package initialization order.
Preparing to initialize &lt;<i>subtotal</i>> packages on the zone.
Initializing package &lt;<i>number</i>> of &lt;<i>subtotal</i>>: percent complete: <i>percent</i>

Initialized &lt;<i>subtotal</i>> packages on zone.
Zone &lt;<i>zonename</i>> is initialized.
The file /zone/internal/root/var/sadm/system/logs/install_log 
contains a log of the zone installation.</pre><p>When the installation is complete, you are prompted for the name of the
host. A name is supplied.</p></li>
<li><b>Accept the name of the host.</b><p>The dialog box displays <i>zone-name</i><tt>:installed</tt> above a list of tasks.</p></li></ol><h6>Troubleshooting</h6><p><a name="indexterm-148"></a><a name="indexterm-149"></a>If warnings that are similar to the following are displayed: <tt>Installation of these packages generated errors: SUNW</tt><i>pkgname</i>, read the
install log and finish installing the packages.</p>

<a name="txconf-76"></a><h4>Boot the Labeled Zone</h4><a name="indexterm-150"></a><a name="indexterm-151"></a><a name="indexterm-152"></a><h6>Before You Begin</h6><p>You are superuser in the global zone. The zone is installed, and
has an assigned a network interface. </p><p>The Labeled Zone Manager dialog box is displayed with the subtitle <i>zone-name</i><tt>:installed</tt>.
To open this GUI, see <a href="#txconf-80">Run the <tt>txzonemgr</tt> Script</a>.</p><ol>
<li><b>In the Labeled Zone manager, select Zone Console and click OK.</b><p>A separate console window appears for the current labeled zone.</p></li>
<li><b>Select Boot.</b><p><a name="indexterm-153"></a><a name="indexterm-154"></a><a name="indexterm-155"></a>The Zone Terminal Console tracks the progress of booting the zone. If the
zone is created from scratch, messages that are similar to the following appear
in the console:</p><pre>[Connected to zone 'public' console]

[NOTICE: Zone booting up]
...
Hostname: <i>zone-name</i>
Loading smf(5) service descriptions: <i>number</i>/<i>total</i>
Creating new rsa public/private host key pair
Creating new dsa public/private host key pair

rebooting system due to change(s) in /etc/default/init

[NOTICE: Zone rebooting]</pre>
<hr><p><b>Caution - </b>Do not perform other tasks while this task is completing.</p>
<hr>
</li></ol><h6>Troubleshooting</h6><p>Sometimes, error messages are displayed and the zone does not reboot. In the
Zone Terminal Console, press the Return key. If you are prompted to type
<tt>y</tt> to reboot, type <tt>y</tt> and press the Return key. The zone reboots.</p><h6>Next Steps</h6><p>If this zone was copied or cloned from another zone, continue with
<a href="#txconf-74">Verify the Status of the Zone</a>.</p><p>If this zone is the first zone, continue with <a href="#txconf-48">Customize the Labeled Zone</a>.</p>

<a name="txconf-74"></a><h4>Verify the Status of the Zone</h4><a name="indexterm-156"></a><a name="indexterm-157"></a>
<hr><p><b>Note - </b>The X server runs in the global zone. Each labeled zone must
be able to connect with the global zone to use the X server.
Therefore, zone networking must work before a zone can be used. For background
information, see <a href="ovw-36.html#ovw-12">Planning for Multilevel Access</a>.</p>
<hr>
<ol>
<li><b>Verify that the zone has been completely started.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>In the <i>zone-name</i>: Zone Terminal Console, log in as root.</b><pre><i>hostname</i> console login: <tt><b>root</b></tt>
Password: Type root password</pre></li>
<li><b>In the Zone Terminal Console, verify that critical services are running.</b><pre># <tt><b>svcs -xv</b></tt>
svc:/application/print/server:default (LP print server)
 State: disabled since Tue Oct 10 10:10:10 2006
Reason: Disabled by an administrator.
   See: http://sun.com/msg/SMF-8000-05
   See: lpsched(1M)
...</pre><p>The <tt>sendmail</tt> and <tt>print</tt> services are not critical services.</p></li>
<li><b>Verify that the zone has a valid IP address.</b><pre># <tt><b>ifconfig -a</b></tt></pre><p>For example, the following output shows an IP address for the <tt>hme0</tt>
interface.</p><pre># ...
 <tt><b>hme0</b></tt>: flags=1000843&lt;BROADCAST,RUNNING,MULTICAST,IPv4> mtu 1500 index 2
         <tt><b>all-zones</b></tt>
         inet <tt><b>192.168.0.11</b></tt> netmask fffffe00 broadcast 192.168.0.255</pre></li>
<li>(Optional) <b>Verify that the zone can communicate with the global zone.</b><ol style="list-style-type: lower-roman">
<li><b>Set the <tt>DISPLAY</tt> variable to point to the X server</b><pre># DISPLAY=<i>global-zone-hostname</i>:<i>n</i>.<i>n</i>
# export DISPLAY</pre></li>
<li><b>From the terminal window, display a GUI.</b><p>For example, display a clock.</p><pre># <tt><b>/usr/openwin/bin/xclock</b></tt></pre><p>If the clock at the label of the zone does not appear,
the zone networking has not been configured correctly. For debugging suggestions, see <a href="txconf-trouble-1.html#labeledzonecannotaccessxserver">Labeled Zone Is Unable to Access the X Server</a>.</p></li>
<li><b>Close the GUI before continuing.</b></li></ol></li></ol></li>
<li><a name="txconf-console-1"></a><b>From the global zone, check the status of the labeled zones.</b><pre># <tt><b>zoneadm list -v</b></tt>
ID NAME         STATUS         PATH                BRAND   IP
 0 global       running        /                   native  shared
 3 internal     running        /zone/internal      native  shared
 4 needtoknow   running        /zone/needtoknow    native  shared
 5 restricted   running        /zone/restricted    native  shared
 </pre></li></ol>

<a name="txconf-48"></a><h4>Customize the Labeled Zone</h4><a name="indexterm-158"></a><p>If you are going to clone zones or copy zones, this procedure
configures a zone to be a template for other zones. In addition, this
procedure configures a zone that has not been created from a template for
use.</p><h6>Before You Begin</h6><p>You are superuser in the global zone. You have completed <a href="#txconf-74">Verify the Status of the Zone</a>.</p><ol>
<li><b>In the Zone Terminal Console, disable services that are unnecessary in a labeled
zone.</b><p>If you are copying or cloning this zone, the services that you disable
are disabled in the new zones. The services that are online on your
system depend on the service manifest for the zone. Use the <tt>netservices limited</tt> command
to turn off services that labeled zones do not need.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>Remove many unnecessary services.</b><pre># <tt><b>netservices limited</b></tt></pre></li>
<li><b>List the remaining services.</b><pre># <tt><b>svcs</b></tt>
...
STATE        STIME      FMRI
online       13:05:00   svc:/application/graphical-login/cde-login:default
...</pre></li>
<li><b>Disable graphical login.</b><pre># <tt><b>svcadm disable svc:/application/graphical-login/cde-login</b></tt>
# <tt><b>svcs cde-login</b></tt>
STATE        STIME      FMRI
disabled     13:06:22   svc:/application/graphical-login/cde-login:default</pre></li></ol><p>For information about the service management framework, see the <a href="http://docs.sun.com/doc/819-2252/smf-5?a=view"><tt>smf</tt>(5)</a> man page.</p></li>
<li><b><a name="indexterm-159"></a>In the Labeled Zone Manager, select Halt to halt the zone.</b></li>
<li><b>Before continuing, verify that the zone is shut down.</b><p>In the <i>zone-name</i>: Zone Terminal Console, the following message indicates that the zone is
shut down.</p><pre>[ NOTICE: Zone halted]</pre><p>If you are not copying or cloning this zone, create the remaining
zones in the way that you created this first zone. Otherwise, continue with
the next step.</p></li>
<li><b>If you are using this zone as a template for other zones,
do the following:</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Remove the <tt>auto_home_</tt><i>zone-name</i> file.</b><p>In a terminal window in the global zone, remove this file from the
<i>zone-name</i> zone.</p><pre># cd /zone/<i>zone-name</i>/root/etc
# ls auto_home*
auto_home  auto_home_<i>zone-name</i>
# rm auto_home_<i>zone-name</i></pre><p>For example, if the <tt>public</tt> zone is the template for cloning other zones,
remove the <tt>auto_home_public</tt> file:</p><pre># <tt><b>cd /zone/public/root/etc</b></tt>
# <tt><b>rm auto_home_public</b></tt></pre></li>
<li><b>If you plan to clone this zone, create the ZFS snapshot in
the next step, then continue with <a href="#txconf-54">Create Another Zone in Trusted Extensions</a>.</b></li>
<li><b>If you plan to copy this zone, complete <a href="#txconf-verboot-1">Step&nbsp;6</a>, then continue with
<a href="#txconf-54">Create Another Zone in Trusted Extensions</a>.</b></li></ol></li>
<li><a name="txconf-snap-1"></a><b>To create a zone template for cloning the remaining zones, select Create Snapshot
and click OK.</b>
<hr><p><b>Caution - </b>The zone for the snapshot must be in a ZFS file system.
You created a ZFS file system for the zone in <a href="txconf-60.html#txconf-42">Create ZFS Pool for Cloning Zones</a>.</p>
<hr>
</li>
<li><a name="txconf-verboot-1"></a><b>To verify that the customized zone is still usable, select Boot from the
Labeled Zone Manager.</b><p><a name="indexterm-160"></a><a name="indexterm-161"></a><a name="indexterm-162"></a>The Zone Terminal Console tracks the progress of booting the zone. Messages that
are similar to the following appear in the console:</p><pre>[Connected to zone 'public' console]

[NOTICE: Zone booting up]
...
Hostname: <i>zonename</i></pre><p>Press the Return key for a login prompt. You can log in
as root.</p></li></ol>

<a name="txconf-54"></a><h4>Create Another Zone in Trusted Extensions</h4><a name="indexterm-163"></a><a name="indexterm-164"></a><p>You have three options:</p>
<ul><li><p>You can copy the first zone.</p></li>
<li><p>You can repeat the steps that you used to create the first zone.</p></li>
<li><p>You can clone the first zone.</p></li></ul>
<h6>Before You Begin</h6><p>You have completed <a href="#txconf-48">Customize the Labeled Zone</a>.</p><p>The Labeled Zone Manager dialog box is displayed. To open this GUI, see
<a href="#txconf-80">Run the <tt>txzonemgr</tt> Script</a>.</p><ol>
<li><a name="txconf-create2-2"></a><b>Name and label the zone.</b><p>For details, see <a href="#txconf-11">Name and Label the Zone</a>.</p></li>
<li><b>Continue with your zone creation strategy by choosing one of the following methods:
</b><p>You will repeat these steps for every new zone.</p><ul>
<li><b>Create every zone from scratch.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Complete <a href="#txconf-install-1">Install the Labeled Zone</a>.</b></li>
<li><b>Complete <a href="#txconf-76">Boot the Labeled Zone</a>.</b></li>
<li><b>Complete <a href="#txconf-74">Verify the Status of the Zone</a>.</b></li>
<li><b>Complete <a href="#txconf-48">Customize the Labeled Zone</a>.</b></li></ol></li>
<li><b>Copy the zone that you just labeled.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>In the Labeled Zone Manager, select Copy and click OK.</b></li>
<li><b>Select the zone template and click OK.</b><p>A window displays the copying process. When the process completes, the zone is
installed.</p><p>If the Labeled Zone Manager displays <i>zone-name</i><tt>:configured</tt>, continue with the next step.
Otherwise, continue with <a href="#txconf-step-zconsole">Step&nbsp;e</a>.</p></li>
<li><b>Select the menu item Select another zone, and click OK.</b></li>
<li><b>Select the newly installed zone and click OK.</b></li>
<li><a name="txconf-step-zconsole"></a><b>Complete <a href="#txconf-76">Boot the Labeled Zone</a>.</b></li>
<li><b>Complete <a href="#txconf-74">Verify the Status of the Zone</a>.</b></li></ol></li>
<li><b>Clone the zone that you just labeled.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>In the Labeled Zone Manager, select Clone and click OK.</b></li>
<li><b>Select a ZFS snapshot from the list and click OK.</b><p>For example, if you created a snapshot from <tt>public</tt>, select the <tt>zone/public@snapshot</tt>.</p><p>When the cloning process completes, the zone is installed. If the Labeled Zone
Manager displays <i>zone-name</i><tt>:configured</tt>, continue with the next step. Otherwise, continue with <a href="#txconf-step-zconsole1">Step&nbsp;e</a>.</p></li>
<li><b>Select the menu item Select another zone, and click OK.</b></li>
<li><b>Select the newly installed zone and click OK.</b></li>
<li><a name="txconf-step-zconsole1"></a><b>Complete <a href="#txconf-76">Boot the Labeled Zone</a>.</b></li>
<li><b>Complete <a href="#txconf-74">Verify the Status of the Zone</a>.</b></li></ol></li></ul></li></ol><h6>Next Steps</h6>
<ul><li><p>When you have completed <a href="#txconf-74">Verify the Status of the Zone</a> for every zone, and you want each zone to be on a separate physical network, continue with <a href="#txconf-84">Add a Network Interface to an Existing Labeled Zone</a>.</p></li>
<li><p>If you have not yet created roles, continue with <a href="txconf-14.html">Creating Roles and Users in Trusted Extensions</a>.</p></li>
<li><p>If you have already created roles, continue with <a href="txconf-50.html">Creating Home Directories in Trusted Extensions</a>.</p></li></ul>


<a name="txconf-84"></a><h4>Add a Network Interface to an Existing Labeled Zone</h4><a name="indexterm-165"></a><a name="indexterm-166"></a><a name="indexterm-167"></a><p>This procedure adds zone-specific network interfaces to existing labeled zones. This configuration supports
environments where each zone is connected to a separate physical network.</p>
<hr><p><b>Note - </b>The global zone must configure an IP address for every subnet in which
a non-global zone address is configured.</p>
<hr>
<h6>Before You Begin</h6><p>You are superuser in the global zone. You have successfully completed <a href="#txconf-74">Verify the Status of the Zone</a>.</p><ol>
<li><b>In the global zone, type the IP addresses and hostnames for the additional
network interfaces into the <tt>/etc/hosts</tt> file.</b><p>Use a standard naming convention, such as adding <i>-zone-name</i> to the name of
the host.</p><pre>## /etc/hosts in global zone
10.10.8.2   <i>hostname-zone-name1</i>
10.10.8.3   <i>hostname-global-name1</i>
10.10.9.2   <i>hostname-zone-name2</i>
10.10.9.3   <i>hostname-global-name2</i></pre></li>
<li><b>For the network for each interface, add entries to the <tt>/etc/netmasks</tt> file.</b><pre>## /etc/netmasks in global zone
10.10.8.0 255.255.255.0
10.10.9.0 255.255.255.0</pre><p>For more information, see the <a href="http://docs.sun.com/doc/819-2251/netmasks-4?a=view"><tt>netmasks</tt>(4)</a> man page.</p></li>
<li><b>In the global zone, plumb the zone-specific physical interfaces.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Identify the physical interfaces that are already plumbed.</b><pre># <tt><b>ifconfig -a</b></tt></pre></li>
<li><b>Configure the global zone addresses on each interface.</b><pre># ifconfig <i>interface-nameN1</i> plumb
# ifconfig <i>interface-nameN1</i> 10.10.8.3 up
# ifconfig <i>interface-nameN2</i> plumb
# ifconfig <i>interface-nameN2</i> 10.10.9.3 up</pre></li>
<li><b>For each global zone address, create a <tt>hostname.</tt><i>interface-nameN</i> file.</b><pre># /etc/hostname.<i>interface-nameN1</i>
10.10.8.3
# /etc/hostname.<i>interface-nameN2</i>
10.10.9.3</pre></li></ol><p>The global zone addresses are configured immediately upon system startup. The zone-specific addresses
are configured when the zone is booted.</p></li>
<li><b>Assign a security template to each zone-specific network interface.</b><p>If the gateway to the network is not configured with labels, assign the
<tt>admin_low</tt> security template. If the gateway to the network is labeled, assign a
<tt>cipso</tt> security template. </p><p>You can create security templates of host type <tt>cipso</tt> that reflect the label
of every network. For the procedures to create and assign the templates, see
<a href="http://docs.sun.com/doc/819-7309/managetnet-3?a=view">Configuring Trusted Network Databases (Task Map) in <i>Solaris Trusted Extensions Administrator&rsquo;s Procedures</i></a>.</p></li>
<li><b>Halt every labeled zone to which you plan to add a zone-specific interface.</b><pre># zoneadm -z <i>zone-name</i> halt</pre></li>
<li><b>Start the Labeled Zone Manager.</b><pre># <tt><b>/usr/sbin/txzonemgr</b></tt></pre></li>
<li><b>For each zone where you want to add a zone-specific interface, do the
following:</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Select the zone.</b></li>
<li><b>Select Add Network.</b></li>
<li><b>Name the network interface.</b></li>
<li><b>Type the IP address of the interface.</b></li></ol></li>
<li><b>In the Labeled Zone Manager for every completed zone, select Zone Console.</b></li>
<li><b>Select Boot.</b></li>
<li><b>In the Zone Console, verify that the interfaces have been created.</b><pre># <tt><b>ifconfig -a</b></tt></pre></li>
<li><b>Verify that the zone has a route to the gateway for the
subnet.</b><pre># <tt><b>netstat -rn</b></tt></pre></li></ol><h6>Troubleshooting</h6><p>To debug zone configuration, see the following:</p>
<ul><li><p><a href="http://docs.sun.com/doc/819-2450/gclkx?a=view">Chapter 28, Troubleshooting Miscellaneous Solaris Zones Problems, in <i>System Administration Guide: Solaris Containers-Resource Management and Solaris Zones</i></a></p></li>
<li><p><a href="txconf-trouble-1.html">Troubleshooting Your Trusted Extensions Configuration</a></p></li>
<li><p><a href="http://docs.sun.com/doc/819-7309/managetnet-2?a=view">Troubleshooting the Trusted Network (Task Map) in <i>Solaris Trusted Extensions Administrator&rsquo;s Procedures</i></a></p></li></ul>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="txconf-60.html">Previous</a>
             </td>
             <td align="right">
                 <a href="txconf-14.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

