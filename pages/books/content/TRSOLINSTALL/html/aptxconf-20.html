<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Creating Labeled Zones by Using CDE Actions (Task Map) - Solaris Trusted Extensions Installation and Configuration</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-05-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">Solaris Trusted Extensions Installation and Configuration</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="aptxconf-40.html">Previous</a>
             </td>
             <td align="right">
                 <a href="checklist-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-4.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="ovw-1.html">1.&nbsp;&nbsp;Security Planning for Trusted Extensions</a></p>
<p class="toc level1 tocsp"><a href="tmap-1.html">2.&nbsp;&nbsp;Installation and Configuration Roadmap for Trusted Extensions</a></p>
<p class="toc level1 tocsp"><a href="startinst-1.html">3.&nbsp;&nbsp;Installing Solaris Trusted Extensions Software  (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="txconf-1.html">4.&nbsp;&nbsp;Configuring Trusted Extensions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="txldap-1.html">5.&nbsp;&nbsp;Configuring LDAP for Trusted Extensions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="headl-1.html">6.&nbsp;&nbsp;Configuring a Headless System With Trusted Extensions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="appol-1.html">A.&nbsp;&nbsp;Site Security Policy</a></p>
<p class="toc level1 tocsp"><a href="aptxconf-1.html">B.&nbsp;&nbsp;Using CDE Actions to Install Zones in Trusted Extensions</a></p>
<p class="toc level2"><a href="aptxconf-62.html">Associating Network Interfaces With Zones by Using CDE Actions (Task Map)</a></p>
<p class="toc level3"><a href="aptxconf-62.html#aptxconf-57">Specify Two IP Addresses for the System by Using a CDE Action</a></p>
<p class="toc level3"><a href="aptxconf-62.html#aptxconf-32">Specify One IP Address for the System by Using a CDE Action</a></p>
<p class="toc level2 tocsp"><a href="aptxconf-40.html">Preparing to Create Zones by Using CDE Actions (Task Map)</a></p>
<p class="toc level3"><a href="aptxconf-40.html#aptxconf-11">Specify Zone Names and Zone Labels by Using a CDE Action</a></p>
<div class="onpage">
<p class="toc level2 tocsp"><a href="">Creating Labeled Zones by Using CDE Actions (Task Map)</a></p>
<p class="toc level3"><a href="#aptxconf-24">Install, Initialize, and Boot a Labeled Zone by Using CDE Actions</a></p>
<p class="toc level3"><a href="#aptxconf-48">Customize a Booted Zone in Trusted Extensions</a></p>
<p class="toc level3"><a href="#aptxconf-54">Use the Copy Zone Method in Trusted Extensions</a></p>
<p class="toc level3"><a href="#aptxconf-53">Use the Clone Zone Method in Trusted Extensions</a></p>
</div>
<p class="toc level1 tocsp"><a href="checklist-1.html">C.&nbsp;&nbsp;Configuration Checklist for Trusted Extensions</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="aptxconf-20"></a><h3>Creating Labeled Zones by Using CDE Actions (Task Map)</h3>
<a name="indexterm-315"></a><a name="indexterm-316"></a><p><a name="indexterm-317"></a><a name="indexterm-318"></a>One zone can be created for every entry in the Trusted Network Zone
Configuration database. You made the entries in <a href="aptxconf-40.html#aptxconf-11">Specify Zone Names and Zone Labels by Using a CDE Action</a>, by running the Configure Zone
action.</p><p>The Trusted_Extensions folder in the Application Manager contains the following actions that create
labeled zones:</p>
<ul><li><p>Configure Zone &ndash; Creates a zone configuration file for every zone name</p></li>
<li><p>Install Zone &ndash; Adds the correct packages and file systems to the zone</p></li>
<li><p>Zone Terminal Console &ndash; Provides a window for viewing events in a zone</p></li>
<li><p>Initialize Zone for LDAP &ndash; Makes the zone an LDAP client and prepares the zone for booting</p></li>
<li><p>Start Zone &ndash; Boots the zone, then starts all the service management framework (SMF) services</p></li>
<li><p>Shut Down Zone &ndash; Changes the state of the zone from Started to Halted</p></li></ul>
<p>The tasks are completed in the following order.</p><table><col width="21.52*"><col width="38.69*"><col width="38.78*"><tr><th align="left" valign="top" scope="column"><p>Task</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
<th align="left" valign="top" scope="column"><p>For Instructions</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>1. Install and boot
one zone.</p></td>
<td align="left" valign="top" scope="row"><p>Create the first labeled zone. Install the packages, make the zone
an LDAP client, and start all services in the zone.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#aptxconf-24">Install, Initialize, and Boot a Labeled Zone by Using CDE Actions</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>2. Customize the zone.</p></td>
<td align="left" valign="top" scope="row"><p>Remove
unwanted services. If you plan to copy or clone the zone, remove zone-specific
information.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#aptxconf-48">Customize a Booted Zone in Trusted Extensions</a></p></td>
</tr>
<tr><td rowspan="4" align="left" valign="top" scope="row"><p>3. Create the other zones.</p></td>
<td colspan="2" align="left" valign="top" scope="row"><p>Use one of the following methods to create
the other zones. You chose the method in <a href="startinst-6.html#startinst-13">Make System and Security Decisions Before Installing Trusted Extensions</a>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Create each zone from scratch.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#aptxconf-24">Install, Initialize, and Boot a Labeled Zone by Using CDE Actions</a></p><p><a href="#aptxconf-48">Customize a Booted Zone in Trusted Extensions</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Copy
the first labeled zone to another label. Repeat for all zones.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#aptxconf-54">Use the Copy Zone Method in Trusted Extensions</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Use a
ZFS snapshot to clone the other zones from the first labeled zone.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#aptxconf-53">Use the Clone Zone Method in Trusted Extensions</a></p></td>
</tr>
</table>

<a name="aptxconf-24"></a><h4>Install, Initialize, and Boot a Labeled Zone by Using CDE Actions</h4><a name="indexterm-319"></a><a name="indexterm-320"></a><a name="indexterm-321"></a><a name="indexterm-322"></a><a name="indexterm-323"></a><a name="indexterm-324"></a><p>Because zone creation involves copying an entire operating system, the process is time-consuming.
A faster process is to create one zone, make the zone a template
for other zones, and then copy or clone that zone template.</p><h6>Before You Begin</h6><p>You have completed <a href="aptxconf-40.html#aptxconf-11">Specify Zone Names and Zone Labels by Using a CDE Action</a>.</p><p>If you are using LDAP as your naming service, you have completed
<a href="txconf-60.html#txldap-8">Make the Global Zone an LDAP Client in Trusted Extensions</a>.</p><p>If you are going to clone zones, you have completed <a href="txconf-60.html#txconf-42">Create ZFS Pool for Cloning Zones</a>. In
the following procedure, you install the zone that you prepared.</p><ol>
<li><a name="aptxconf-step-install1"></a><b><a name="indexterm-325"></a><a name="indexterm-326"></a>In the Trusted_Extensions folder, double-click the Install Zone action.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Type the name of the zone that you are installing.</b><p>This action creates a labeled virtual operating system. This step takes some time to
finish. Do not do other tasks on the system while Install Zone
is running.</p><pre># <i>zone-name</i>: Install Zone
Preparing to install zone &lt;<i>zone-name</i>>
Creating list of files to copy from the global zone
Copying &lt;<i>total</i>> files to the zone
Initializing zone product registry
Determining zone package initialization order.
Preparing to initialize &lt;<i>subtotal</i>> packages on the zone.
Initializing package &lt;<i>number</i>> of &lt;<i>subtotal</i>>: percent complete: <i>percent</i>

Initialized &lt;<i>subtotal</i>> packages on zone.
Zone &lt;<i>zone-name</i>> is initialized.
The file /zone/internal/root/var/sadm/system/logs/install_log 
contains a log of the zone installation.

*** Select Close or Exit from the window menu to close this window ***</pre></li>
<li><b>Open a console to monitor events in the installed zone.</b><ol style="list-style-type: lower-roman">
<li><b><a name="indexterm-327"></a><a name="indexterm-328"></a>Double-click the Zone Terminal Console action.</b></li>
<li><b>Type the name of the zone that was just installed.</b></li></ol></li></ol></li>
<li><b><a name="indexterm-329"></a><a name="indexterm-330"></a><a name="indexterm-331"></a><a name="indexterm-332"></a>Initialize the zone.</b><ul>
<li><b>If you are using LDAP, double-click the Initialize Zone for LDAP action.</b><pre>Zone name:              Type the name of the installed zone
Host name for the zone: Type the host name for this zone</pre><p>For example, on a system with a shared logical interface, the values would
be similar to the following:</p><pre>Zone name:              <tt><b>public</b></tt>
Host name for the zone: <tt><b>machine1-zones</b></tt></pre><p>This action makes the labeled zone an LDAP client of the same
LDAP server that serves the global zone. The action is complete when the
following information appears:</p><pre><i>zone-name</i> zone will be  LDAP client of <i>IP-address</i>
<i>zone-name</i> is ready for booting
Zone label is <i>LABEL</i>

*** Select Close or Exit from the window menu to close this window ***</pre></li>
<li><b>If you are not using LDAP, initialize the zone manually by doing one
of the following steps.</b><p>The manual procedure in Trusted Extensions is identical to the procedure for the
Solaris OS. If the system has at least one <tt>all-zones</tt> interface, then
the hostname for all the zones must match the global zone's hostname. In
general, the answers to the questions during zone initialization are the same as
the answers for the global zone.</p><p>Supply the host information by doing one of the following:</p><ul>
<li><b>After you start the zone in <a href="#aptxconf-step-start1">Step&nbsp;3</a>, answer the questions in the
Zone Terminal Console about system characteristics.</b><p>Your answers are used to populate the <tt>sysidcfg</tt> file in the zone.</p></li>
<li><b>Place a custom <tt>sysidcfg</tt> file in the zone's <tt>/etc</tt> directory before booting
the zone in <a href="#aptxconf-step-start1">Step&nbsp;3</a>.</b></li></ul></li></ul></li>
<li><a name="aptxconf-step-start1"></a><b><a name="indexterm-333"></a><a name="indexterm-334"></a><a name="indexterm-335"></a><a name="indexterm-336"></a><a name="indexterm-337"></a><a name="indexterm-338"></a>Double-click the Start Zone action.</b><p>Answer the prompt.</p><pre>Zone name: Type the name of the zone that you are configuring</pre><p>This action boots the zone, then starts all the services that run
in the zone. For details about the services, see the <a href="http://docs.sun.com/doc/819-2252/smf-5?a=view"><tt>smf</tt>(5)</a> man page.</p><p><a name="indexterm-339"></a><a name="indexterm-340"></a><a name="indexterm-341"></a>The Zone Terminal Console tracks the progress of booting the zone. Messages that
are similar to the following appear in the console:</p><pre>[Connected to zone 'public' console]

[NOTICE: Zone booting up]
...
Hostname: <i>zonename</i>
Loading smf(5) service descriptions: <i>number</i>/<i>total</i>
Creating new rsa public/private host key pair
Creating new dsa public/private host key pair

rebooting system due to change(s) in /etc/default/init

[NOTICE: Zone rebooting]</pre></li>
<li><b>Monitor the console output.</b><p>Before continuing with <a href="#aptxconf-48">Customize a Booted Zone in Trusted Extensions</a>, make sure that the zone has rebooted. The following
console login prompt indicates that the zone has rebooted.</p><pre><i>hostname</i> console login:</pre></li></ol><h6>Troubleshooting</h6><p><a name="indexterm-342"></a><a name="indexterm-343"></a>For Install Zone: If warnings that are similar to the following are displayed:
<tt>Installation of these packages generated errors: SUNW</tt><i>pkgname</i>, read the install log and finish installing the packages.</p>

<a name="aptxconf-48"></a><h4>Customize a Booted Zone in Trusted Extensions</h4><p>If you are going to clone zones, this procedure configures a zone
to be a template for other zones. In addition, this procedure configures the zone
for use.</p><ol>
<li><b>Ensure that the zone has been completely started.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>In the <i>zone-name</i>: Zone Terminal Console, log in as root.</b><pre><i>hostname</i> console login: <tt><b>root</b></tt>
Password: Type root password</pre></li>
<li><b>Check that the zone is running.</b><p>The status <tt>running</tt> indicates that at least one process is running in
the zone.</p><pre># <tt><b>zoneadm list -v</b></tt>
ID NAME        STATUS         PATH
 2 public      running        /</pre></li>
<li><b>Check that the zone can communicate with the global zone.</b><p>The X server runs in the global zone. Each labeled zone must
be able to connect with the global zone to use this service. Therefore,
zone networking must work before the zone can be used. For assistance, see
<a href="txconf-trouble-1.html#labeledzonecannotaccessxserver">Labeled Zone Is Unable to Access the X Server</a>.</p></li></ol></li>
<li><b>In the Zone Terminal Console, disable services that are unnecessary in a labeled
zone.</b><p>If you are copying or cloning this zone, the services that you disable
are disabled in the new zones. The services that are online on your
system depend on the service manifest for the zone. Use the <tt>netservices limited</tt> command
to turn off services that labeled zones do not need.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>Remove many unnecessary services.</b><pre># <tt><b>netservices limited</b></tt></pre></li>
<li><b>List the remaining services.</b><pre># <tt><b>svcs</b></tt>
...
STATE        STIME      FMRI
online       13:05:00   svc:/application/graphical-login/cde-login:default
...</pre></li>
<li><b>Disable graphical login.</b><pre># <tt><b>svcadm disable svc:/application/graphical-login/cde-login</b></tt>
# <tt><b>svcs cde-login</b></tt>
STATE        STIME      FMRI
disabled     13:06:22   svc:/application/graphical-login/cde-login:default</pre></li></ol><p>For information about the service management framework, see the <a href="http://docs.sun.com/doc/819-2252/smf-5?a=view"><tt>smf</tt>(5)</a> man page.</p></li>
<li><b><a name="indexterm-344"></a><a name="indexterm-345"></a><a name="indexterm-346"></a>Shut down the zone.</b><p>Choose one of the following ways:</p><ul>
<li><b>Run the Shut Down Zone action.</b><p>Provide the name of the zone.</p></li>
<li><b>In a terminal window in the global zone, use the <tt>zlogin</tt> command.</b><pre># zlogin <i>zone-name</i> init 0</pre><p>For more information, see the <a href="http://docs.sun.com/doc/819-2239/zlogin-1?a=view"><tt>zlogin</tt>(1)</a> man page.</p></li></ul></li>
<li><b>Verify that the zone is shut down.</b><p>In the <i>zone-name</i>: Zone Terminal Console, the following message indicates that the zone
is shut down:</p><pre>[ NOTICE: Zone halted]</pre><p>If you are not copying or cloning this zone, create the remaining
zones in the way that you created this first zone.</p></li>
<li><b>If you are using this zone as a template for other zones,
do the following:</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Remove the <tt>auto_home_</tt><i>zone-name</i> file.</b><p>In a terminal window in the global zone, remove this file from the
<i>zone-name</i> zone.</p><pre>cd /zone/<i>zone-name</i>/root/etc
# ls auto_home*
auto_home  auto_home_<i>zone-name</i>
# rm auto_home_<i>zone-name</i></pre><p>For example, if the <tt>public</tt> zone were the basis for cloning other zones,
remove its <tt>auto_home</tt> file:</p><pre># <tt><b>cd /zone/public/root/etc</b></tt>
# <tt><b>rm auto_home_public</b></tt></pre></li></ol></li></ol><h6>Next Steps</h6>
<ul><li><p>If you are copying a zone, go to <a href="#aptxconf-54">Use the Copy Zone Method in Trusted Extensions</a>.</p></li>
<li><p>If you are cloning a zone, go to <a href="#aptxconf-53">Use the Clone Zone Method in Trusted Extensions</a>.</p></li></ul>


<a name="aptxconf-54"></a><h4>Use the Copy Zone Method in Trusted Extensions</h4><a name="indexterm-347"></a><a name="indexterm-348"></a><h6>Before You Begin</h6>
<ul><li><p>You have completed <a href="aptxconf-40.html#aptxconf-11">Specify Zone Names and Zone Labels by Using a CDE Action</a>.</p></li>
<li><p>You have customized a zone that is the template for cloning in <a href="">Creating Labeled Zones by Using CDE Actions (Task Map)</a>.</p></li>
<li><p>You are not currently running the zone that is your template for cloning.</p></li>
<li><p>The Trusted_Extensions folder is displayed.</p></li></ul>
<ol>
<li><a name="aptxconf-copyz-1"></a><b>For every zone that you want to create, double-click the Copy Zone action.</b><p>Answer the prompts.</p><pre>New Zone Name:     Type name of target zone
From Zone Name:    Type name of source zone</pre>
<hr><p><b>Caution - </b>Do not perform other tasks while this task is completing.</p>
<hr>
</li>
<li><b>When the zones are created, check the status of every zone.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Double-click the Zone Terminal Console action.</b></li>
<li><b>Log in to each zone.</b></li>
<li><b>Complete <a href="txconf-20.html#txconf-74">Verify the Status of the Zone</a>.</b></li></ol></li></ol>

<a name="aptxconf-53"></a><h4>Use the Clone Zone Method in Trusted Extensions</h4><a name="indexterm-349"></a><a name="indexterm-350"></a><h6>Before You Begin</h6>
<ul><li><p>You have completed <a href="aptxconf-40.html#aptxconf-11">Specify Zone Names and Zone Labels by Using a CDE Action</a>.</p></li>
<li><p>You have completed <a href="txconf-60.html#txconf-42">Create ZFS Pool for Cloning Zones</a>.</p></li>
<li><p>You have created the zone template by completing <a href="txconf-60.html#txconf-42">Create ZFS Pool for Cloning Zones</a>.</p></li>
<li><p>You have customized a zone that is your template for cloning in <a href="">Creating Labeled Zones by Using CDE Actions (Task Map)</a>.</p></li>
<li><p>The zone that is your template for cloning is shut down.</p></li>
<li><p>The Trusted_Extensions folder is displayed.</p></li></ul>
<ol>
<li><b>Create a Solaris ZFS snapshot of the zone template.</b><pre># cd /
# zfs snapshot zone/<i>zone-name</i>@snapshot</pre><p>You use this snapshot to clone the remaining zones. For a configured zone
that is named <tt>public</tt>, the snapshot command is the following:</p><pre># <tt><b>zfs snapshot zone/public@snapshot</b></tt></pre></li>
<li><a name="aptxconf-clone-1"></a><b>For every zone that you want to create, double-click the Clone Zone action.</b><p>Answer the prompts.</p><pre>New Zone Name:      Type name of source zone
ZFS Snapshot:         Type name of snapshot</pre></li>
<li><b>Read the information in the dialog box.</b><pre>Zone label is &lt;<i>LABEL</i>>
<i>zone-name</i> is ready for booting

*** Select Close or Exit from the window menu to close this window ***</pre></li>
<li><b>For each zone, run the Start Zone action.</b><p>Start each zone before running the action for another zone.</p></li>
<li><b>After the zones are created, check the status of every zone.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Double-click the Zone Terminal Console action.</b></li>
<li><b>Complete <a href="txconf-20.html#txconf-74">Verify the Status of the Zone</a>.</b></li></ol></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="aptxconf-40.html">Previous</a>
             </td>
             <td align="right">
                 <a href="checklist-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

