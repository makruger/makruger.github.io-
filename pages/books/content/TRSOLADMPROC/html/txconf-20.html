<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Creating Labeled Zones - Solaris Trusted Extensions Administrator's Procedures</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2009-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">Solaris Trusted Extensions Administrator's Procedures</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="txconf-60.html">Previous</a>
             </td>
             <td align="right">
                 <a href="txconf-98.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-4.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="trp-part-1.html">Part&nbsp;I&nbsp;Initial Configuration of Trusted Extensions</a></p>
<p class="toc level2"><a href="ovw-1.html">1.&nbsp;&nbsp;Security Planning for Trusted Extensions</a></p>
<p class="toc level2"><a href="tmap-1.html">2.&nbsp;&nbsp;Configuration Roadmap for Trusted Extensions</a></p>
<p class="toc level2"><a href="startinst-1.html">3.&nbsp;&nbsp;Adding Solaris Trusted Extensions Software to the Solaris OS (Tasks)</a></p>
<p class="toc level2"><a href="txconf-1.html">4.&nbsp;&nbsp;Configuring Trusted Extensions (Tasks)</a></p>
<p class="toc level3"><a href="txconf-60.html">Setting Up the Global Zone in Trusted Extensions</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Creating Labeled Zones</a></p>
</div>
<p class="toc level3"><a href="txconf-98.html">Adding Network Interfaces and Routing to Labeled Zones</a></p>
<p class="toc level3"><a href="txconf-14.html">Creating Roles and Users in Trusted Extensions</a></p>
<p class="toc level3"><a href="txconf-50.html">Creating Home Directories in Trusted Extensions</a></p>
<p class="toc level3"><a href="txconf-64.html">Adding Users and Hosts to an Existing Trusted Network</a></p>
<p class="toc level3"><a href="txconf-trouble-1.html">Troubleshooting Your Trusted Extensions Configuration</a></p>
<p class="toc level3"><a href="txconf-18.html">Additional Trusted Extensions Configuration Tasks</a></p>
<p class="toc level2 tocsp"><a href="txldap-1.html">5.&nbsp;&nbsp;Configuring LDAP for Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="headl-1.html">6.&nbsp;&nbsp;Configuring a Headless System With Trusted Extensions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="trp-part-2.html">Part&nbsp;II&nbsp;Administration of Trusted Extensions</a></p>
<p class="toc level2"><a href="txintro-1.html">7.&nbsp;&nbsp;Trusted Extensions Administration Concepts</a></p>
<p class="toc level2"><a href="txtool-1.html">8.&nbsp;&nbsp;Trusted Extensions Administration Tools</a></p>
<p class="toc level2"><a href="roles-1.html">9.&nbsp;&nbsp;Getting Started as a Trusted Extensions Administrator (Tasks)</a></p>
<p class="toc level2"><a href="secreq-1.html">10.&nbsp;&nbsp;Security Requirements on a Trusted Extensions System (Overview)</a></p>
<p class="toc level2"><a href="commontasks-1.html">11.&nbsp;&nbsp;Administering Security Requirements in Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="useraccts-1.html">12.&nbsp;&nbsp;Users, Rights, and Roles in Trusted Extensions (Overview)</a></p>
<p class="toc level2"><a href="manageusers-1.html">13.&nbsp;&nbsp;Managing Users, Rights, and Roles in Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="remotead-1.html">14.&nbsp;&nbsp;Remote Administration in Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="manageldap-1.html">15.&nbsp;&nbsp;Trusted Extensions and LDAP (Overview)</a></p>
<p class="toc level2"><a href="managezones-1.html">16.&nbsp;&nbsp;Managing Zones in Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="managefiles-1.html">17.&nbsp;&nbsp;Managing and Mounting Files in Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="txnet-1.html">18.&nbsp;&nbsp;Trusted Networking (Overview)</a></p>
<p class="toc level2"><a href="managetnet-1.html">19.&nbsp;&nbsp;Managing Networks in Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="managemail-1.html">20.&nbsp;&nbsp;Multilevel Mail in Trusted Extensions (Overview)</a></p>
<p class="toc level2"><a href="manageprint-1.html">21.&nbsp;&nbsp;Managing Labeled Printing (Tasks)</a></p>
<p class="toc level2"><a href="gentextid-15538.html">22.&nbsp;&nbsp;Devices in Trusted Extensions (Overview)</a></p>
<p class="toc level2"><a href="managedev-1.html">23.&nbsp;&nbsp;Managing Devices for Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="audtask-1.html">24.&nbsp;&nbsp;Trusted Extensions Auditing (Overview)</a></p>
<p class="toc level2"><a href="softmgt-1.html">25.&nbsp;&nbsp;Software Management in Trusted Extensions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="appol-1.html">A.&nbsp;&nbsp;Site Security Policy</a></p>
<p class="toc level2"><a href="appol-12.html">Creating and Managing a Security Policy</a></p>
<p class="toc level2"><a href="appol-11.html">Site Security Policy and Trusted Extensions</a></p>
<p class="toc level2"><a href="appol-2.html">Computer Security Recommendations</a></p>
<p class="toc level2"><a href="appol-3.html">Physical Security Recommendations</a></p>
<p class="toc level2"><a href="appol-4.html">Personnel Security Recommendations</a></p>
<p class="toc level2"><a href="appol-5.html">Common Security Violations</a></p>
<p class="toc level2"><a href="appol-6.html">Additional Security References</a></p>
<p class="toc level1 tocsp"><a href="aptxconf-1.html">B.&nbsp;&nbsp;Using CDE Actions to Install Zones in Trusted Extensions</a></p>
<p class="toc level2"><a href="aptxconf-62.html">Associating Network Interfaces With Zones by Using CDE Actions (Task Map)</a></p>
<p class="toc level2"><a href="aptxconf-40.html">Preparing to Create Zones by Using CDE Actions (Task Map)</a></p>
<p class="toc level2"><a href="aptxconf-20.html">Creating Labeled Zones by Using CDE Actions (Task Map)</a></p>
<p class="toc level1 tocsp"><a href="checklist-1.html">C.&nbsp;&nbsp;Configuration Checklist for Trusted Extensions</a></p>
<p class="toc level2"><a href="checklist-2.html">Checklist for Configuring Trusted Extensions</a></p>
<p class="toc level1 tocsp"><a href="txapp-1.html">D.&nbsp;&nbsp;Quick Reference to Trusted Extensions Administration</a></p>
<p class="toc level2"><a href="txapp-2.html">Administrative Interfaces in Trusted Extensions</a></p>
<p class="toc level2"><a href="txapp-3.html">Solaris Interfaces Extended by Trusted Extensions</a></p>
<p class="toc level2"><a href="txapp-4.html">Tighter Security Defaults in Trusted Extensions</a></p>
<p class="toc level2"><a href="txapp-5.html">Limited Options in Trusted Extensions</a></p>
<p class="toc level1 tocsp"><a href="txmp-1.html">E.&nbsp;&nbsp;List of Trusted Extensions Man Pages</a></p>
<p class="toc level2"><a href="txmp-2.html">Trusted Extensions Man Pages in Alphabetical Order</a></p>
<p class="toc level2"><a href="txmp-3.html">Solaris Man Pages That Are Modified by Trusted Extensions</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="txconf-20"></a><h3>Creating Labeled Zones</h3>
<a name="indexterm-133"></a><a name="indexterm-134"></a><a name="indexterm-135"></a><a name="indexterm-136"></a><a name="indexterm-137"></a><a name="indexterm-138"></a><a name="indexterm-139"></a><p>The <tt>txzonemgr</tt> script steps you through all the following tasks that configure labeled
zones.</p><p>The instructions in this section configure labeled zones on a system that has
been assigned at most two IP addresses. For other configurations, see the configuration
options in <a href="tmap-2.html">Task Map: Preparing For and Enabling Trusted Extensions</a>.</p><table><col width="22%"><col width="45%"><col width="31%"><tr><th align="left" valign="top" scope="column"><p>Task</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
<th align="left" valign="top" scope="column"><p>For Instructions</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>1. Run the <tt>txzonemgr</tt> script.</p></td>
<td align="left" valign="top" scope="row"><p>The <tt>txzonemgr</tt> script creates a
GUI that presents the appropriate tasks as you configure your zones.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#txconf-80">Run the <tt>txzonemgr</tt> Script</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>2. Manage network
interfaces in the global zone.</p></td>
<td align="left" valign="top" scope="row"><p>Configure interfaces in the global zone, or create
logical interfaces and configure them in the global zone.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#txconf-netint-1">Configure the Network Interfaces in Trusted Extensions</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>3. Name and label the
zone.</p></td>
<td align="left" valign="top" scope="row"><p>Name the zone with a version of its label, and assign the
label.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#txconf-11">Name and Label the Zone</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>4. Install and boot the zone.</p></td>
<td align="left" valign="top" scope="row"><p>Install the packages in the zone. Configure
services in the zone. A Zone Terminal Console enables you to view the
activity in the zone.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#txconf-install-1">Install the Labeled Zone</a></p><p><a href="#txconf-76">Boot the Labeled Zone</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>5. Verify the status of the zone.</p></td>
<td align="left" valign="top" scope="row"><p>Verify that the
labeled zone is running, and that the zone can communicate with the global
zone.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#txconf-74">Verify the Status of the Zone</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>6. Customize the zone.</p></td>
<td align="left" valign="top" scope="row"><p>Remove unwanted services from the zone.</p><p>If the zone is
going to be used to create other zones, remove information that is specific
to this zone only.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#txconf-48">Customize the Labeled Zone</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>7. Create the rest of the zones.</p></td>
<td align="left" valign="top" scope="row"><p>Use the method
that you have chosen to create your second zone. For a discussion of
zone creation methods, see <a href="ovw-36.html#ovw-11">Planning for Zones in Trusted Extensions</a>.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#txconf-54">Copy or Clone a Zone in Trusted Extensions</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>8. (Optional) Add zone-specific network interfaces.</p></td>
<td align="left" valign="top" scope="row"><p>To effect network
isolation, add one or more network interfaces to a labeled zone. Typically, such
configurations are used to isolate labeled subnets.</p></td>
<td align="left" valign="top" scope="row"><p><a href="txconf-98.html">Adding Network Interfaces and Routing to Labeled Zones</a></p></td>
</tr>
</table>

<a name="txconf-80"></a><h4>Run the <tt>txzonemgr</tt> Script</h4><a name="indexterm-140"></a><a name="indexterm-141"></a><a name="indexterm-142"></a><a name="indexterm-143"></a><a name="indexterm-144"></a><p>This script steps you through the tasks to properly configure, install, initialize, and
boot labeled zones. In the script, you name each zone, associate the name
with a label, install the packages to create a virtual OS, and
then boot the zone to start services in that zone. The script includes
copy zone and clone zone tasks. You can also halt a zone, change
the state of a zone, and add zone-specific network interfaces.</p><p>This script presents a dynamically-determined menu that displays only valid choices for the
current circumstances. For instance, if the status of a zone is configured, the
Install zone menu item is not displayed. Tasks that are completed do not
display in the list.</p><h6>Before You Begin</h6><p>You are superuser.</p><p>If you plan to clone zones, you have completed the preparation for
cloning zones. If you plan to use your own security templates, you have
created the templates.</p><ol>
<li><b>Open a terminal window in the global zone.</b></li>
<li><b>Run the <tt>txzonemgr</tt> script.</b><pre># <tt><b>/usr/sbin/txzonemgr</b></tt></pre><p>The script opens the  <tt>Labeled Zone Manager</tt> dialog box. This <tt>zenity</tt> dialog box prompts
you for the appropriate tasks, depending on the current state of your installation.</p><p>To perform a task, you select the menu item, then press the
Return key or click OK. When you are prompted for text, type the
text then press the Return key or click OK.</p>
<hr><p><b>Tip - </b>To view the current state of zone completion, click Return to Main Menu
in the Labeled Zone Manager.</p>
<hr>
</li></ol>

<a name="txconf-netint-1"></a><h4>Configure the Network Interfaces in Trusted Extensions</h4><a name="indexterm-145"></a><a name="indexterm-146"></a>
<hr><p><b>Note - </b>If you are configuring your system to use DHCP, refer to the
laptop instructions in the Trusted Extensions section of <a href="http://opensolaris.org/os/community/security">OpenSolaris Community: Security web page</a>.</p><p>In the Solaris Express Community Edition, if you are configuring a system where
each labeled zone is on its own subnet, you can skip this step
and continue with <a href="#txconf-11">Name and Label the Zone</a>. You add the network interfaces for each labeled zone
in <a href="txconf-98.html#txconf-84">Add a Network Interface to Route an Existing Labeled Zone</a>, after you have finished installing and customizing the zones.</p>
<hr>
<p>In this task, you configure the networking in the global zone. You
must create exactly one <tt>all-zones</tt> interface. An <tt>all-zones</tt> interface is shared by the labeled
zones and the global zone. The shared interface is used to route traffic
between the labeled zones and the global zone. To configure this interface, do
one of the following:</p>
<ul><li><p>Create a logical interface from a physical interface, then share the physical interface.</p><p>This configuration is the simplest to administer. Choose this configuration when your system has been assigned two IP addresses. In this procedure, the logical interface becomes the global zone's specific address, and the physical interface is shared between the global zone and the labeled zones.</p></li>
<li><p>Share a physical interface</p><p>Choose this configuration when your system has been assigned one IP address. In this configuration, the physical interface is shared between the global zone and the labeled zones.</p></li>
<li><p>Share a virtual network interface, <tt>vni0</tt></p><p>Choose this configuration when you are configuring DHCP, or when each subnetwork is at a different label. For a sample procedure, refer to the laptop instructions in the Trusted Extensions section of <a href="http://opensolaris.org/os/community/security">OpenSolaris Community: Security web page</a>.</p><p>In the Solaris Express Community Edition, the loopback interface in Trusted Extensions is created as an all-zones interface. Therefore, you do not need to create a <tt>vni0</tt> shared interface.</p></li></ul>
<p>To add zone-specific network interfaces, finish and verify zone creation before adding the
interfaces. For the procedure, see <a href="txconf-98.html#txconf-84">Add a Network Interface to Route an Existing Labeled Zone</a>.</p><h6>Before You Begin</h6><p>You are superuser in the global zone.</p><p>The Labeled Zone Manager is displayed. To open this GUI, see <a href="#txconf-80">Run the <tt>txzonemgr</tt> Script</a>.</p><ol>
<li><b>In the Labeled Zone Manager, select Manage Network Interfaces and click OK.</b><p>A list of interfaces is displayed.</p>
<hr><p><b>Note - </b>In this example, the physical interface was assigned a host name and an
IP address during installation.</p>
<hr>
</li>
<li><b>Select the physical interface.</b><p>A system with one interface displays a menu similar to the following. The
annotation is added for assistance:</p><pre>vni0                        DownVirtual Network Interface
eri0 global 10.10.9.9 cipso Up Physical Interface</pre><ol style="list-style-type: lower-alpha">
<li><b>Select the <tt>eri0</tt> interface.</b></li>
<li><b>Click OK</b></li></ol></li>
<li><b>Select the appropriate task for this network interface.</b><p>You are offered three options:</p><pre>View Template Assign a label to the interface
Share Enable the global zone and labeled zones to use this interface
Create Logical Interface Create an interface to use for sharing</pre><ul>
<li><b>If your system has one IP address, go to <a href="#txconf-1ip-1">Step&nbsp;4</a>.</b></li>
<li><b>If your system has two IP addresses, go to <a href="#txconf-2ip-1">Step&nbsp;5</a>.</b></li></ul></li>
<li><a name="txconf-1ip-1"></a><b>On a system with one IP address, share the physical interface.</b><p>In this configuration, the host's IP address applies to all zones. Therefore, the
host's address is the <tt>all-zones</tt> address. This host cannot be used as a
multilevel server. For example, users cannot share files from this system. The system
cannot be an LDAP proxy server, an NFS home directory server, or a
print server.</p><ol style="list-style-type: lower-alpha">
<li><b>Select Share and click OK.</b></li>
<li><b>Click OK in the dialog box that displays the shared interface.</b><pre>eri0  all-zones  10.10.9.8  cipso  Up</pre><p>You are successful when the physical interface is an <tt>all-zones</tt> interface. Continue with
<a href="#txconf-11">Name and Label the Zone</a>.</p></li></ol></li>
<li><a name="txconf-2ip-1"></a><b>On a system with two IP addresses, create a logical interface.</b><p>Then, share the physical interface.</p><p>This is the simplest Trusted Extensions network configuration. In this configuration, the main
IP address can be used by other systems to reach any zone
on this system, and the logical interface is zone-specific to the global zone.
The global zone can be used as a multilevel server.</p><ol style="list-style-type: lower-alpha">
<li><b>Select Create Logical Interface and click OK.</b><p>Dismiss the dialog box that confirms the creation of a new logical interface.</p></li>
<li><b>Select Set IP address and click OK.</b></li>
<li><b>At the prompt, specify the host name for the logical interface and click
OK.</b><p>For example, specify <tt>machine1-services</tt> as the host name for the logical interface. The
name indicates that this host offers multilevel services.</p></li>
<li><b>At the prompt, specify the IP address for the logical interface and click
OK.</b><p>For example, specify <tt>10.10.9.2</tt> as the IP address for the logical interface.</p></li>
<li><b>Select the logical interface again and click OK.</b></li>
<li><b>Select Bring Up and click OK.</b><p>The interface is displayed as <tt>Up</tt>.</p><pre>eri0    global       10.10.9.1   cipso   Up
eri0:1  global       10.10.9.2   cipso   Up</pre></li>
<li><b>Share the physical interface.</b><ol style="list-style-type: lower-roman">
<li><b>Select the physical interface and click OK.</b></li>
<li><b>Select Share and click OK.</b><pre>eri0    all-zones    10.10.9.1   cipso   Up
eri0:1  global       10.10.9.2   cipso   Up</pre></li></ol></li></ol><p>You are successful when at least one interface is an <tt>all-zones</tt> interface.</p></li></ol><a name="txconf-38"></a><h6>Example&nbsp;4-3 Viewing the <tt>/etc/hosts</tt> File on a System With a Shared Logical Interface</h6><p>On a system where the global zone has a unique interface and
labeled zones share a second interface with the global zone, the <tt>/etc/hosts</tt> file appears
similar to the following:</p><pre># <tt><b>cat /etc/hosts</b></tt>
...
127.0.0.1  localhost
192.168.0.11 machine1 loghost
192.168.0.12 machine1-services </pre><p>In the default configuration, the <tt>tnrhdb</tt> file appears similar to the following:</p><pre># <tt><b>cat /etc/security/tsol/tnrhdb</b></tt>
...
127.0.0.1:cipso
192.168.0.11:cipso
192.168.0.12:cipso
0.0.0.0:admin_low</pre><p>If the <tt>all-zones</tt> interface is not in the <tt>tnrhdb</tt> file, the interface
defaults to <tt>cipso</tt>.</p><a name="txconf-oneip-1"></a><h6>Example&nbsp;4-4 Displaying the Shared Interface on a Trusted Extensions System With One IP Address</h6><a name="indexterm-147"></a><a name="indexterm-148"></a><p>In this example, the administrator is not planning to use the system as
a multilevel server. To conserve IP addresses, the global zone is configured to
share its IP address with every labeled zone.</p><p>The administrator selects Share for the <tt>hme0</tt> interface on the system. The software
configures all zones to have logical NICs. These logical NICs share a single
physical NIC in the global zone.</p><p>The administrator runs the <tt><b>ifconfig -a</b></tt> command to verify that the physical interface <tt>hme0</tt>
on network interface <tt>192.168.0.11</tt> is shared. The value <tt>all-zones</tt> is displayed:</p><pre> lo0: flags=2001000849&lt;UP,LOOPBACK,RUNNING,MULTICAST,IPv4,VIRTUAL&gt; mtu 8232 index 1
         inet 127.0.0.1 netmask ff000000
 hme0: flags=1000843&lt;BROADCAST,RUNNING,MULTICAST,IPv4&gt; mtu 1500 index 2
         all-zones
         inet 192.168.0.11 netmask fffffe00 broadcast 192.168.0.255</pre><p>In the Solaris Express Community Edition, the loopback interface in Trusted Extensions is
created as an all-zones interface.</p><pre> lo0: flags=2001000849&lt;UP,LOOPBACK,RUNNING,MULTICAST,IPv4,VIRTUAL&gt; mtu 8232 index 1
         all-zones
         inet 127.0.0.1 netmask ff000000
 hme0: flags=1000843&lt;BROADCAST,RUNNING,MULTICAST,IPv4&gt; mtu 1500 index 2
         all-zones
         inet 192.168.0.11 netmask fffffe00 broadcast 192.168.0.255</pre><p>The administrator also examines the contents of the <tt>/etc/hostname.hme0</tt> file:</p><pre>192.168.0.11 all-zones</pre>

<a name="txconf-11"></a><h4>Name and Label the Zone</h4><a name="indexterm-149"></a><a name="indexterm-150"></a><a name="indexterm-151"></a><a name="indexterm-152"></a><a name="indexterm-153"></a><a name="indexterm-154"></a><p>You do not have to create a zone for every label in
your <tt>label_encodings</tt> file, but you can. The administrative GUIs enumerate the labels that
can have zones created for them on this system.</p><h6>Before You Begin</h6><p>You are superuser in the global zone. The Labeled Zone Manager dialog box
is displayed. To open this GUI, see <a href="#txconf-80">Run the <tt>txzonemgr</tt> Script</a>. You have configured the
network interfaces in the global zone.</p><p>You have created any security templates that you need. A security template defines,
among other attributes, the label range that can be assigned to a network
interface. The default security templates might satisfy your needs.</p>
<ul><li><p>For an overview of security templates, see <a href="tnetov-40.html">Network Security Attributes in Trusted Extensions</a>.</p></li>
<li><p>To use the Solaris Management Console to create security templates, see <a href="managetnet-3.html">Configuring Trusted Network Databases (Task Map)</a>.</p></li></ul>
<ol>
<li><b><a name="indexterm-155"></a><a name="indexterm-156"></a>In the Labeled Zone Manager, select Create a new zone and click OK.</b><p>You are prompted for a name.</p><ol style="list-style-type: lower-alpha">
<li><b>Type the name for the zone.</b>
<hr><p><b>Tip - </b>Give the zone a name that is similar to the zone's label.
For example, the name of a zone whose label is <tt>CONFIDENTIAL: RESTRICTED</tt> would be <tt>restricted</tt>.</p>
<hr>
<p>For example, the default <tt>label_encodings</tt> file contains the following labels:</p><pre>PUBLIC
CONFIDENTIAL: INTERNAL USE ONLY
CONFIDENTIAL: NEED TO KNOW
CONFIDENTIAL: RESTRICTED
SANDBOX: PLAYGROUND
MAX LABEL</pre><p>Although you could create one zone per label, consider creating the following zones:</p>
<ul><li><p>On a system for all users, create one zone for the <tt>PUBLIC</tt> label and three zones for the <tt>CONFIDENTIAL</tt> labels.</p></li>
<li><p>On a system for developers, create a zone for the <tt>SANDBOX: PLAYGROUND</tt> label. Because <tt>SANDBOX: PLAYGROUND</tt> is defined as a disjoint label for developers, only systems that developers use need a zone for this label.</p></li>
<li><p>Do not create a zone for the <tt>MAX LABEL</tt> label, which is defined to be a clearance.</p></li></ul>
</li>
<li><b>Click OK.</b><p>The dialog box displays <i>zone-name</i><tt>:configured</tt> above a list of tasks.</p></li></ol></li>
<li><b>To label the zone, choose one of the following:</b><ul>
<li><b>If you are using a customized <tt>label_encodings</tt> file, label the zone by using
the Trusted Network Zones tool.</b><ol style="list-style-type: lower-alpha">
<li><b>Open the Trusted Network Zones tool in the Solaris Management Console.</b><ol style="list-style-type: lower-roman">
<li><b><a name="indexterm-157"></a><a name="indexterm-158"></a><a name="indexterm-159"></a><a name="indexterm-160"></a>Start the Solaris Management Console.</b><pre># <tt><b>/usr/sbin/smc &amp;</b></tt></pre></li>
<li><b>Open the Trusted Extensions toolbox for the local system.</b><ol style="list-style-type: lower-roman">
<li><b>Choose Console &rarr; Open Toolbox.</b></li>
<li><b>Select the toolbox that is named This Computer (<i>this-host</i>: <tt>Scope=Files, Policy=TSOL</tt>).</b></li>
<li><b>Click Open.</b></li></ol></li>
<li><b>Under System Configuration, navigate to Computers and Networks.</b><p>Provide a password when prompted.</p></li>
<li><b>Double-click the Trusted Network Zones  tool.</b></li></ol></li>
<li><b>For each zone, associate the appropriate label with the zone name.</b><ol style="list-style-type: lower-roman">
<li><b>Choose Action  &rarr; Add Zone Configuration.</b><p>The dialog box displays the name of a zone that does not have
an assigned label.</p></li>
<li><b>Look at the zone name, then click Edit.</b></li>
<li><b>In the Label Builder, click the appropriate label for the zone name.</b><p>If you click the wrong label, click the label again to deselect it,
then click the correct label.</p></li>
<li><b>Save the assignment.</b><p>Click OK in the Label Builder, then click OK in the Trusted Network
Zones Properties dialog box.</p></li></ol><p>You are finished when every zone that you want is listed in
the panel, or the Add Zone Configuration menu item opens a dialog box
that does not have a value for Zone Name.</p></li></ol></li>
<li><b>If you are using the default <tt>label_encodings</tt> file, use the Labeled Zone Manager.</b><p>Click Select Label menu item and OK to display the list of available
labels.</p><ol style="list-style-type: lower-alpha">
<li><b>Select the label for the zone.</b><p>For a zone that is named <tt>public</tt>, you would select the label <tt>PUBLIC</tt>
from the list.</p></li>
<li><b>Click OK.</b><p>A list of tasks is displayed.</p></li></ol></li></ul></li></ol>

<a name="txconf-install-1"></a><h4>Install the Labeled Zone</h4><a name="indexterm-161"></a><a name="indexterm-162"></a><h6>Before You Begin</h6><p>You are superuser in the global zone. The zone is configured, and
has an assigned network interface.</p><p>The Labeled Zone Manager dialog box is displayed with the subtitle <i>zone-name</i><tt>:configured</tt>.
To open this GUI, see <a href="#txconf-80">Run the <tt>txzonemgr</tt> Script</a>.</p><ol>
<li><a name="txconf-scratch-1"></a><b>From the Labeled Zone Manager, select Install and click OK.</b>
<hr><p><b>Caution - </b>This process takes some time to finish. Do not perform other tasks while
this task is completing.</p>
<hr>
<p>The system copies packages from the global zone to the non-global zone. This
task installs a labeled virtual operating system in the zone. To continue the
example, this task installs the <tt>public</tt> zone. The GUI displays output similar to
the following.</p><pre># Labeled Zone Manager: Installing <i>zone-name</i> zone
Preparing to install zone &lt;<i>zonename</i>&gt;
Creating list of files to copy from the global zone
Copying &lt;<i>total</i>&gt; files to the zone
Initializing zone product registry
Determining zone package initialization order.
Preparing to initialize &lt;<i>subtotal</i>&gt; packages on the zone.
Initializing package &lt;<i>number</i>&gt; of &lt;<i>subtotal</i>&gt;: percent complete: <i>percent</i>

Initialized &lt;<i>subtotal</i>&gt; packages on zone.
Zone &lt;<i>zonename</i>&gt; is initialized.
The file /zone/internal/root/var/sadm/system/logs/install_log 
contains a log of the zone installation.</pre>
<hr><p><b>Note - </b>Messages such as <tt>cannot create ZFS dataset zone/<i>zonename</i>: dataset already exists</tt> are informational. The zone uses the existing dataset.</p>
<hr>
<p>When the installation is complete, you are prompted for the name of the
host. A name is supplied.</p></li>
<li><b>Accept the name of the host.</b><p>The dialog box displays <i>zone-name</i><tt>:installed</tt> above a list of tasks.</p></li></ol><h6>Troubleshooting</h6><p><a name="indexterm-163"></a><a name="indexterm-164"></a>If warnings that are similar to the following are displayed: <tt>Installation of these packages generated errors: SUNW</tt><i>pkgname</i>, read the
install log and finish installing the packages.</p>

<a name="txconf-76"></a><h4>Boot the Labeled Zone</h4><a name="indexterm-165"></a><a name="indexterm-166"></a><a name="indexterm-167"></a><h6>Before You Begin</h6><p>You are superuser in the global zone. The zone is installed, and
has an assigned a network interface. </p><p>The Labeled Zone Manager dialog box is displayed with the subtitle <i>zone-name</i><tt>:installed</tt>.
To open this GUI, see <a href="#txconf-80">Run the <tt>txzonemgr</tt> Script</a>.</p><ol>
<li><b>In the Labeled Zone manager, select Zone Console and click OK.</b><p>A separate console window appears for the current labeled zone.</p></li>
<li><b>Select Boot.</b><p><a name="indexterm-168"></a><a name="indexterm-169"></a><a name="indexterm-170"></a>The Zone Terminal Console tracks the progress of booting the zone. If the
zone is created from scratch, messages that are similar to the following appear
in the console:</p><pre>[Connected to zone 'public' console]

[NOTICE: Zone booting up]
...
Hostname: <i>zone-name</i>
Loading smf(5) service descriptions: <i>number</i>/<i>total</i>
Creating new rsa public/private host key pair
Creating new dsa public/private host key pair

rebooting system due to change(s) in /etc/default/init

[NOTICE: Zone rebooting]</pre>
<hr><p><b>Caution - </b>Do not perform other tasks while this task is completing.</p>
<hr>
</li></ol><h6>Troubleshooting</h6><p>Sometimes, error messages are displayed and the zone does not reboot. In the
Zone Terminal Console, press the Return key. If you are prompted to type
<tt>y</tt> to reboot, type <tt>y</tt> and press the Return key. The zone reboots.</p><h6>Next Steps</h6><p>If this zone was copied or cloned from another zone, continue with
<a href="#txconf-74">Verify the Status of the Zone</a>.</p><p>If this zone is the first zone, continue with <a href="#txconf-48">Customize the Labeled Zone</a>.</p>

<a name="txconf-74"></a><h4>Verify the Status of the Zone</h4><a name="indexterm-171"></a><a name="indexterm-172"></a>
<hr><p><b>Note - </b>The X server runs in the global zone. Each labeled zone must
be able to connect with the global zone to use the X server.
Therefore, zone networking must work before a zone can be used. For background
information, see <a href="ovw-36.html#ovw-12">Planning for Multilevel Access</a>.</p>
<hr>
<ol>
<li><b>Verify that the zone has been completely started.</b><ol style="list-style-type: lower-alpha">
<li><b>In the <i>zone-name</i>: Zone Terminal Console, log in as root.</b><pre><i>hostname</i> console login: <tt><b>root</b></tt>
Password: Type root password</pre></li>
<li><b>In the Zone Terminal Console, verify that critical services are running.</b><pre># <tt><b>svcs -xv</b></tt>
svc:/application/print/server:default (LP print server)
 State: disabled since Tue Oct 10 10:10:10 2006
Reason: Disabled by an administrator.
   See: http://sun.com/msg/SMF-8000-05
   See: lpsched(1M)
...</pre><p>The <tt>sendmail</tt> and <tt>print</tt> services are not critical services.</p></li>
<li><b>Verify that the zone has a valid IP address.</b><pre># <tt><b>ifconfig -a</b></tt></pre><p>For example, the following output shows an IP address for the <tt>hme0</tt>
interface.</p><pre># ...
 <tt><b>hme0</b></tt>: flags=1000843&lt;BROADCAST,RUNNING,MULTICAST,IPv4&gt; mtu 1500 index 2
         <tt><b>all-zones</b></tt>
         inet <tt><b>192.168.0.11</b></tt> netmask fffffe00 broadcast 192.168.0.255</pre></li>
<li>(Optional) <b>Verify that the zone can communicate with the global zone.</b><ol style="list-style-type: lower-roman">
<li><b>Set the <tt>DISPLAY</tt> variable to point to the X server</b><pre># DISPLAY=<i>global-zone-hostname</i>:<i>n</i>.<i>n</i>
# export DISPLAY</pre></li>
<li><b>From the terminal window, display a GUI.</b><p>For example, display a clock.</p><pre># <tt><b>/usr/openwin/bin/xclock</b></tt></pre><p>If the clock at the label of the zone does not appear,
the zone networking has not been configured correctly. For debugging suggestions, see <a href="txconf-trouble-1.html#labeledzonecannotaccessxserver">Labeled Zone Is Unable to Access the X Server</a>.</p></li>
<li><b>Close the GUI before continuing.</b></li></ol></li></ol></li>
<li><a name="txconf-console-1"></a><b>From the global zone, check the status of the labeled zones.</b><pre># <tt><b>zoneadm list -v</b></tt>
ID NAME         STATUS         PATH                BRAND   IP
 0 global       running        /                   native  shared
 3 internal     running        /zone/internal      native  shared
 4 needtoknow   running        /zone/needtoknow    native  shared
 5 restricted   running        /zone/restricted    native  shared</pre></li></ol><h6>Next Steps</h6><p>You have completed configuring the labeled zone. To add zone-specific network interfaces to
the zones or to establish default routing per labeled zone, continue with <a href="txconf-98.html">Adding Network Interfaces and Routing to Labeled Zones</a>.
Otherwise, continue with <a href="txconf-14.html">Creating Roles and Users in Trusted Extensions</a>.</p>

<a name="txconf-48"></a><h4>Customize the Labeled Zone</h4><a name="indexterm-173"></a><p>If you are going to clone zones or copy zones, this procedure
configures a zone to be a template for other zones. In addition, this
procedure configures a zone that has not been created from a template for
use.</p><h6>Before You Begin</h6><p>You are superuser in the global zone. You have completed <a href="#txconf-74">Verify the Status of the Zone</a>.</p><ol>
<li><b>In the Zone Terminal Console, disable services that are unnecessary in a labeled
zone.</b><p>If you are copying or cloning this zone, the services that you disable
are disabled in the new zones. The services that are online on your
system depend on the service manifest for the zone. Use the <tt>netservices limited</tt> command
to turn off services that labeled zones do not need.</p><ol style="list-style-type: lower-alpha">
<li><b>Remove many unnecessary services.</b><pre># <tt><b>netservices limited</b></tt></pre></li>
<li><b>List the remaining services.</b><pre># <tt><b>svcs</b></tt>
...
STATE        STIME      FMRI
online       13:05:00   svc:/application/graphical-login/cde-login:default
...</pre></li>
<li><b>Disable graphical login.</b><pre># <tt><b>svcadm disable svc:/application/graphical-login/cde-login</b></tt>
# <tt><b>svcs cde-login</b></tt>
STATE        STIME      FMRI
disabled     13:06:22   svc:/application/graphical-login/cde-login:default</pre></li></ol><p>For information about the service management framework, see the <a href="http://docs.sun.com/doc/819-2252/smf-5?a=view"><tt>smf</tt>(5)</a> man page.</p></li>
<li><b><a name="indexterm-174"></a>In the Labeled Zone Manager, select Halt to halt the zone.</b></li>
<li><b>Before continuing, verify that the zone is shut down.</b><p>In the <i>zone-name</i>: Zone Terminal Console, the following message indicates that the zone is
shut down.</p><pre>[ NOTICE: Zone halted]</pre><p>If you are not copying or cloning this zone, create the remaining
zones in the way that you created this first zone. Otherwise, continue with
the next step.</p></li>
<li><b>If you are using this zone as a template for other zones,
do the following:</b><ol style="list-style-type: lower-alpha">
<li><b>Remove the <tt>auto_home_</tt><i>zone-name</i> file.</b><p>In a terminal window in the global zone, remove this file from the
<i>zone-name</i> zone.</p><pre># cd /zone/<i>zone-name</i>/root/etc
# ls auto_home*
auto_home  auto_home_<i>zone-name</i>
# rm auto_home_<i>zone-name</i></pre><p>For example, if the <tt>public</tt> zone is the template for cloning other zones,
remove the <tt>auto_home_public</tt> file:</p><pre># <tt><b>cd /zone/public/root/etc</b></tt>
# <tt><b>rm auto_home_public</b></tt></pre></li>
<li><b>If you plan to clone this zone, create the ZFS snapshot in
the next step, then continue with <a href="#txconf-54">Copy or Clone a Zone in Trusted Extensions</a>.</b></li>
<li><b>If you plan to copy this zone, complete <a href="#txconf-verboot-1">Step&nbsp;6</a>, then continue with
<a href="#txconf-54">Copy or Clone a Zone in Trusted Extensions</a>.</b></li></ol></li>
<li><a name="txconf-snap-1"></a><b>To create a zone template for cloning the remaining zones, select Create Snapshot
and click OK.</b>
<hr><p><b>Caution - </b>The zone for the snapshot must be in a ZFS file system.
You created a ZFS file system for the zone in <a href="txconf-60.html#txconf-42">Create ZFS Pool for Cloning Zones</a>.</p>
<hr>
</li>
<li><a name="txconf-verboot-1"></a><b>To verify that the customized zone is still usable, select Boot from the
Labeled Zone Manager.</b><p><a name="indexterm-175"></a><a name="indexterm-176"></a><a name="indexterm-177"></a>The Zone Terminal Console tracks the progress of booting the zone. Messages that
are similar to the following appear in the console:</p><pre>[Connected to zone 'public' console]

[NOTICE: Zone booting up]
...
Hostname: <i>zonename</i></pre><p>Press the Return key for a login prompt. You can log in
as root.</p></li></ol>

<a name="txconf-54"></a><h4>Copy or Clone a Zone in Trusted Extensions</h4><a name="indexterm-178"></a><a name="indexterm-179"></a><h6>Before You Begin</h6><p>You have completed <a href="#txconf-48">Customize the Labeled Zone</a>.</p><p>The Labeled Zone Manager dialog box is displayed. To open this GUI, see
<a href="#txconf-80">Run the <tt>txzonemgr</tt> Script</a>.</p><ol>
<li><a name="txconf-create2-2"></a><b>Create the zone.</b><p>For details, see <a href="#txconf-11">Name and Label the Zone</a>.</p></li>
<li><b>Continue with your zone creation strategy by choosing one of the following methods:
</b><p>You will repeat these steps for every new zone.</p><ul>
<li><b>Copy the zone that you just labeled.</b><ol style="list-style-type: lower-alpha">
<li><b>In the Labeled Zone Manager, select Copy and click OK.</b></li>
<li><b>Select the zone template and click OK.</b><p>A window displays the copying process. When the process completes, the zone is
installed.</p><p>If the Labeled Zone Manager displays <i>zone-name</i><tt>:configured</tt>, continue with the next step.
Otherwise, continue with <a href="#txconf-step-zconsole">Step&nbsp;e</a>.</p></li>
<li><b>Select the menu item Select another zone, and click OK.</b></li>
<li><b>Select the newly installed zone and click OK.</b></li>
<li><a name="txconf-step-zconsole"></a><b>Complete <a href="#txconf-76">Boot the Labeled Zone</a>.</b></li>
<li><b>Complete <a href="#txconf-74">Verify the Status of the Zone</a>.</b></li></ol></li>
<li><b>Clone the zone that you just labeled.</b><ol style="list-style-type: lower-alpha">
<li><b>In the Labeled Zone Manager, select Clone and click OK.</b></li>
<li><b>Select a ZFS snapshot from the list and click OK.</b><p>For example, if you created a snapshot from <tt>public</tt>, select the <tt>zone/public@snapshot</tt>.</p><p>When the cloning process completes, the zone is installed. Continue with <a href="#txconf-step-zconsole1">Step&nbsp;c</a>.</p></li>
<li><a name="txconf-step-zconsole1"></a><b>Open a Zone Console and boot the zone.</b><p>For instructions, see <a href="#txconf-76">Boot the Labeled Zone</a>.</p></li>
<li><b>Complete <a href="#txconf-74">Verify the Status of the Zone</a>.</b></li></ol></li></ul></li></ol><h6>Next Steps</h6>
<ul><li><p>When you have completed <a href="#txconf-74">Verify the Status of the Zone</a> for every zone, and you want each zone to be on a separate physical network, continue with <a href="txconf-98.html#txconf-84">Add a Network Interface to Route an Existing Labeled Zone</a>.</p></li>
<li><p>If you have not yet created roles, continue with <a href="txconf-14.html">Creating Roles and Users in Trusted Extensions</a>.</p></li>
<li><p>If you have already created roles, continue with <a href="txconf-50.html">Creating Home Directories in Trusted Extensions</a>.</p></li></ul>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="txconf-60.html">Previous</a>
             </td>
             <td align="right">
                 <a href="txconf-98.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

