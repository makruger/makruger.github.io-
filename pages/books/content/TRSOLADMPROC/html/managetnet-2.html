<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Troubleshooting the Trusted Network (Task Map) - Solaris Trusted Extensions Administrator's Procedures</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2009-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">Solaris Trusted Extensions Administrator's Procedures</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="managetnet-14.html">Previous</a>
             </td>
             <td align="right">
                 <a href="managemail-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-4.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="trp-part-1.html">Part&nbsp;I&nbsp;Initial Configuration of Trusted Extensions</a></p>
<p class="toc level2"><a href="ovw-1.html">1.&nbsp;&nbsp;Security Planning for Trusted Extensions</a></p>
<p class="toc level2"><a href="tmap-1.html">2.&nbsp;&nbsp;Configuration Roadmap for Trusted Extensions</a></p>
<p class="toc level2"><a href="startinst-1.html">3.&nbsp;&nbsp;Adding Solaris Trusted Extensions Software to the Solaris OS (Tasks)</a></p>
<p class="toc level2"><a href="txconf-1.html">4.&nbsp;&nbsp;Configuring Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="txldap-1.html">5.&nbsp;&nbsp;Configuring LDAP for Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="headl-1.html">6.&nbsp;&nbsp;Configuring a Headless System With Trusted Extensions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="trp-part-2.html">Part&nbsp;II&nbsp;Administration of Trusted Extensions</a></p>
<p class="toc level2"><a href="txintro-1.html">7.&nbsp;&nbsp;Trusted Extensions Administration Concepts</a></p>
<p class="toc level2"><a href="txtool-1.html">8.&nbsp;&nbsp;Trusted Extensions Administration Tools</a></p>
<p class="toc level2"><a href="roles-1.html">9.&nbsp;&nbsp;Getting Started as a Trusted Extensions Administrator (Tasks)</a></p>
<p class="toc level2"><a href="secreq-1.html">10.&nbsp;&nbsp;Security Requirements on a Trusted Extensions System (Overview)</a></p>
<p class="toc level2"><a href="commontasks-1.html">11.&nbsp;&nbsp;Administering Security Requirements in Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="useraccts-1.html">12.&nbsp;&nbsp;Users, Rights, and Roles in Trusted Extensions (Overview)</a></p>
<p class="toc level2"><a href="manageusers-1.html">13.&nbsp;&nbsp;Managing Users, Rights, and Roles in Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="remotead-1.html">14.&nbsp;&nbsp;Remote Administration in Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="manageldap-1.html">15.&nbsp;&nbsp;Trusted Extensions and LDAP (Overview)</a></p>
<p class="toc level2"><a href="managezones-1.html">16.&nbsp;&nbsp;Managing Zones in Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="managefiles-1.html">17.&nbsp;&nbsp;Managing and Mounting Files in Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="txnet-1.html">18.&nbsp;&nbsp;Trusted Networking (Overview)</a></p>
<p class="toc level2"><a href="managetnet-1.html">19.&nbsp;&nbsp;Managing Networks in Trusted Extensions (Tasks)</a></p>
<p class="toc level3"><a href="managetnet-6.html">Managing the Trusted Network (Task Map)</a></p>
<p class="toc level3"><a href="managetnet-3.html">Configuring Trusted Network Databases (Task Map)</a></p>
<p class="toc level3"><a href="managetnet-14.html">Configuring Routes and Checking Network Information in Trusted Extensions (Task Map)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Troubleshooting the Trusted Network (Task Map)</a></p>
</div>
<p class="toc level2 tocsp"><a href="managemail-1.html">20.&nbsp;&nbsp;Multilevel Mail in Trusted Extensions (Overview)</a></p>
<p class="toc level2"><a href="manageprint-1.html">21.&nbsp;&nbsp;Managing Labeled Printing (Tasks)</a></p>
<p class="toc level2"><a href="gentextid-15538.html">22.&nbsp;&nbsp;Devices in Trusted Extensions (Overview)</a></p>
<p class="toc level2"><a href="managedev-1.html">23.&nbsp;&nbsp;Managing Devices for Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="audtask-1.html">24.&nbsp;&nbsp;Trusted Extensions Auditing (Overview)</a></p>
<p class="toc level2"><a href="softmgt-1.html">25.&nbsp;&nbsp;Software Management in Trusted Extensions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="appol-1.html">A.&nbsp;&nbsp;Site Security Policy</a></p>
<p class="toc level2"><a href="appol-12.html">Creating and Managing a Security Policy</a></p>
<p class="toc level2"><a href="appol-11.html">Site Security Policy and Trusted Extensions</a></p>
<p class="toc level2"><a href="appol-2.html">Computer Security Recommendations</a></p>
<p class="toc level2"><a href="appol-3.html">Physical Security Recommendations</a></p>
<p class="toc level2"><a href="appol-4.html">Personnel Security Recommendations</a></p>
<p class="toc level2"><a href="appol-5.html">Common Security Violations</a></p>
<p class="toc level2"><a href="appol-6.html">Additional Security References</a></p>
<p class="toc level1 tocsp"><a href="aptxconf-1.html">B.&nbsp;&nbsp;Using CDE Actions to Install Zones in Trusted Extensions</a></p>
<p class="toc level2"><a href="aptxconf-62.html">Associating Network Interfaces With Zones by Using CDE Actions (Task Map)</a></p>
<p class="toc level2"><a href="aptxconf-40.html">Preparing to Create Zones by Using CDE Actions (Task Map)</a></p>
<p class="toc level2"><a href="aptxconf-20.html">Creating Labeled Zones by Using CDE Actions (Task Map)</a></p>
<p class="toc level1 tocsp"><a href="checklist-1.html">C.&nbsp;&nbsp;Configuration Checklist for Trusted Extensions</a></p>
<p class="toc level2"><a href="checklist-2.html">Checklist for Configuring Trusted Extensions</a></p>
<p class="toc level1 tocsp"><a href="txapp-1.html">D.&nbsp;&nbsp;Quick Reference to Trusted Extensions Administration</a></p>
<p class="toc level2"><a href="txapp-2.html">Administrative Interfaces in Trusted Extensions</a></p>
<p class="toc level2"><a href="txapp-3.html">Solaris Interfaces Extended by Trusted Extensions</a></p>
<p class="toc level2"><a href="txapp-4.html">Tighter Security Defaults in Trusted Extensions</a></p>
<p class="toc level2"><a href="txapp-5.html">Limited Options in Trusted Extensions</a></p>
<p class="toc level1 tocsp"><a href="txmp-1.html">E.&nbsp;&nbsp;List of Trusted Extensions Man Pages</a></p>
<p class="toc level2"><a href="txmp-2.html">Trusted Extensions Man Pages in Alphabetical Order</a></p>
<p class="toc level2"><a href="txmp-3.html">Solaris Man Pages That Are Modified by Trusted Extensions</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="managetnet-2"></a><h3>Troubleshooting the Trusted Network (Task Map)</h3>
<a name="indexterm-1049"></a><a name="indexterm-1050"></a><a name="indexterm-1051"></a><p>The following task map describes tasks to debug your network.</p><table><col width="33%"><col width="33%"><col width="33%"><tr><th align="left" valign="top" scope="column"><p>Task</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
<th align="left" valign="top" scope="column"><p>For Instructions</p></th>
</tr>
<tr><td rowspan="2" align="left" valign="top" scope="row"><p>Determine why
two hosts cannot communicate.</p></td>
<td align="left" valign="top" scope="row"><p>Checks that the interfaces on a single system are
up.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#txconf-10">How to Verify That a Host's Interfaces Are Up</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Uses debugging tools when two hosts cannot communicate  with each other.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#managetnet-19">How to Debug the Trusted Extensions Network</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Determine why
an LDAP client cannot reach the LDAP server.</p></td>
<td align="left" valign="top" scope="row"><p>Troubleshoots the loss of connection
between an LDAP server and a client.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#manageldap-4">How to Debug a Client Connection to the LDAP Server</a></p></td>
</tr>
</table>

<a name="txconf-10"></a><h4>How to Verify That a Host's Interfaces Are Up</h4><a name="indexterm-1052"></a><a name="indexterm-1053"></a><a name="indexterm-1054"></a><p>Use this procedure if your system does not communicate with other hosts as
expected.</p><h6>Before You Begin</h6><p>You must be in the global zone in a role that can
check network settings. The Security Administrator role and the System Administrator role can
check these settings.</p><ol>
<li><b>Verify that the system's network interface is up.</b><p>The following output shows that the system has two network interfaces, <tt>hme0</tt> and
<tt>hme0:3</tt>. Neither interface is up.</p><pre># <tt><b>ifconfig -a</b></tt>
...
hme0: flags=1000843&lt;BROADCAST,RUNNING,MULTICAST,IPv4&gt; mtu 1500 index 2
         inet 192.168.0.11 netmask ffffff00 broadcast 192.168.0.255
hme0:3 flags=1000843&lt;BROADCAST,RUNNING,MULTICAST,IPv4&gt; mtu 1500 index 2
         inet 192.168.0.12 netmask ffffff00 broadcast 192.168.0.255</pre></li>
<li><b>If the interface is not up, bring it up and then verify
that it is up.</b><p>The following output shows that both interfaces are up.</p><pre># <tt><b>ifconfig hme0 up</b></tt>
# <tt><b>ifconfig -a</b></tt>
...
hme0: flags=1000843&lt;<tt><b>UP</b></tt>,BROADCAST,RUNNING,MULTICAST,...
hme0:3 flags=1000843&lt;<tt><b>UP</b></tt>,BROADCAST,RUNNING,MULTICAST,..</pre></li></ol>

<a name="managetnet-19"></a><h4>How to Debug the Trusted Extensions Network</h4><a name="indexterm-1055"></a><p><a name="indexterm-1056"></a><a name="indexterm-1057"></a><a name="indexterm-1058"></a>To debug two hosts that should be communicating but are not, you can
use Trusted Extensions and Solaris debugging tools. For example, Solaris network debugging commands
such as <tt>snoop</tt> and <tt>netstat</tt> are available. For details, see the <a href="http://docs.sun.com/doc/819-2240/snoop-1m?a=view"><tt>snoop</tt>(1M)</a> and
<a href="http://docs.sun.com/doc/819-2240/netstat-1m?a=view"><tt>netstat</tt>(1M)</a> man pages. For commands that are specific to Trusted Extensions, see <a href="txtool-4.html#txtool-tbl-4">Table&nbsp;8-4</a>.</p>
<ul><li><p>For problems with contacting labeled zones, see <a href="managezones-6.html">Managing Zones (Task Map)</a>.</p></li>
<li><p>For debugging NFS mounts, see <a href="managefiles-6.html#managefiles-20">How to Troubleshoot Mount Failures in Trusted Extensions</a>.</p></li>
<li><p>For debugging LDAP communications, see <a href="#manageldap-4">How to Debug a Client Connection to the LDAP Server</a>.</p></li></ul>
<h6>Before You Begin</h6><p>You must be in the global zone in a role that can
check network settings. The Security Administrator role or the System Administrator role can
check these settings.</p><ol>
<li><b>To troubleshoot the <tt>tnd</tt> daemon, change the polling interval and collect debugging information.</b><p>For details, see the <a href="http://docs.sun.com/doc/819-2240/tnd-1m?a=view"><tt>tnd</tt>(1M)</a> man page.</p></li>
<li><b>Check that the hosts that cannot communicate are using the same naming service.</b><ol style="list-style-type: lower-alpha">
<li><b>On each host, check the <tt>nsswitch.conf</tt> file.</b><ol style="list-style-type: lower-roman">
<li><b>Check the values for the Trusted Extensions databases in the <tt>nsswitch.conf</tt> file.</b><p>For example, at a site that uses LDAP to administer the network, the
entries are similar to the following:</p><pre># Trusted Extensions
tnrhtp: files ldap
tnrhdb: files ldap</pre></li>
<li><b>If the values are different, correct the <tt>nsswitch.conf</tt> file.</b><p><a name="indexterm-1059"></a><a name="indexterm-1060"></a>To modify these entries, the system administrator uses the Name Service Switch action.
For details, see <a href="roles-4.html#commontasks-42">How to Start CDE Administrative Actions in Trusted Extensions</a>. This action preserves the required DAC and MAC file
permissions.</p></li></ol></li>
<li><b>Check that the LDAP naming service is configured.</b><pre>$ ldaplist -l</pre></li>
<li><b>Check that both hosts are in the LDAP naming service.</b><pre>$ ldaplist -l hosts | grep <i>hostname</i></pre></li></ol></li>
<li><b>Check that each host is defined correctly.</b><ol style="list-style-type: lower-alpha">
<li><b>Use the Solaris Management Console to verify the definitions.</b>
<ul><li><p>In the Security Templates tool, check that each host is assigned to a security template that is compatible with the security template of the other host.</p></li>
<li><p>For an an unlabeled system, check that the default label assignment is correct.</p></li>
<li><p>In the Trusted Network Zones tool, check that the multilevel ports (MLPs) are correctly configured.</p></li></ul>
</li>
<li><b>Use the command line to check that the network information in the kernel
is current.</b><p>Check that the assignment in each host's kernel cache matches the assignment on
the network, and on the other host.</p><p><a name="indexterm-1061"></a>To get security information for the source, destination, and gateway hosts in the
transmission, use the <tt>tninfo</tt> command.</p><ul>
<li><b>Display the IP address and the assigned security template for a given host.</b><pre>$ tninfo -h <i>hostname</i>
IP Address: <i>IP-address</i>
Template: <i>template-name</i></pre></li>
<li><b>Display a template definition.</b><pre>$ tninfo -t <i>template-name</i>
template: <i>template-name</i>
host_type: <i>one of</i> CIPSO <i>or</i> UNLABELED
doi: 1
min_sl: <i>minimum-label</i>
hex: <i>minimum-hex-label</i>
max_sl: <i>maximum-label</i>
hex: <i>maximum-hex-label</i></pre></li>
<li><b>Display the MLPs for a zone.</b><pre>$ tninfo -m <i>zone-name</i>
private: <i>ports-that-are-specific-to-this-zone-only</i>
shared: <i>ports-that-the-zone-shares-with-other-zones</i></pre></li></ul></li></ol></li>
<li><b>Fix any incorrect information.</b>
<ul><li><p>To change or check network security information, use the Solaris Management Console tools. For details, see <a href="managetnet-3.html#managetnet-15">How to Open the Trusted Networking Tools</a></p></li>
<li><p>To update the kernel cache, restart the <tt>tnctl</tt> service on the host whose information is out of date. Allow some time for this process to complete. Then, refresh the <tt>tnd</tt> service. If the refresh fails, try restarting the <tt>tnd</tt> service. For details, see <a href="managetnet-14.html#managetnet-36">How to Synchronize the Kernel Cache With Trusted Network Databases</a>.</p><p>Rebooting clears the kernel cache. At boot time, the cache is populated with database information. The <tt>nsswitch.conf</tt> file determines whether local databases or LDAP databases are used to populate the kernel.</p></li></ul>
</li>
<li><b>Collect transmission information to help you in debugging.</b><ul>
<li><b>Verify your routing configuration.</b><p>Use the <tt>get</tt> subcommand to the <tt>route</tt> command.</p><pre>$ route get [ip] -secattr sl=<i>label</i>,doi=<i>integer</i></pre><p>For details, see the <a href="http://docs.sun.com/doc/819-2240/route-1m?a=view"><tt>route</tt>(1M)</a> man page.</p></li>
<li><b>View the label information in packets.</b><p>Use the <tt>snoop -v</tt> command.</p><p>The <tt>-v</tt> option displays the details of packet headers, including label information. This
command provides a lot of detail, so you might want to restrict the
packets that the command examines. For details, see the <a href="http://docs.sun.com/doc/819-2240/snoop-1m?a=view"><tt>snoop</tt>(1M)</a> man page.</p></li>
<li><b>View the routing table entries and the security attributes on sockets.</b><p>Use the <tt>-R</tt> option with the <tt>netstat -a|-r</tt> command.</p><p>The <tt>-aR</tt> option displays extended security attributes for sockets. The <tt>-rR</tt> option displays
routing table entries. For details, see the <a href="http://docs.sun.com/doc/819-2240/netstat-1m?a=view"><tt>netstat</tt>(1M)</a> man page.</p></li></ul></li></ol>

<a name="manageldap-4"></a><h4>How to Debug a Client Connection to the LDAP Server</h4><a name="indexterm-1062"></a><a name="indexterm-1063"></a><p>Misconfiguration of the client entry on the LDAP server can prevent the client
from communicating with the server. Similarly, misconfiguration of files on the client can
prevent communication. Check the following entries and files when attempting to debug a
client-server communication problem.</p><h6>Before You Begin</h6><p>You must be in the Security Administrator role in the global zone
on the LDAP client.</p><ol>
<li><b><a name="indexterm-1064"></a>Check that the remote host template for the LDAP server and for the
gateway to the LDAP server are correct.</b><pre># tninfo -h <i>LDAP-server</i>
# route get <i>LDAP-server</i>
# tninfo -h <i>gateway-to-LDAP-server</i></pre><p>If a remote host template assignment is incorrect, assign the host to the
correct template by using the Security Templates tool in the Solaris Management
Console.</p></li>
<li><b>Check and correct the <tt>/etc/hosts</tt> file.</b><p>Your system, the interfaces for the labeled zones on your system, the gateway
to the LDAP server, and the LDAP server must be listed in
the file. You might have more entries.</p><p>Look for duplicate entries. Remove any entries that are labeled zones on other
systems. For example, if <tt>Lserver</tt> is the name of your LDAP server, and
<tt>LServer-zones</tt> is the shared interface for the labeled zones, remove <tt>LServer-zones</tt> from <tt>/etc/hosts</tt>.</p></li>
<li><b>If you are using DNS, check and correct the entries in the
<tt>resolv.conf</tt> file.</b><pre># more resolv.conf
search <i>list of domains</i>
domain <i>domain-name</i>
nameserver <i>IP-address</i>

...
nameserver <i>IP-address</i></pre></li>
<li><b>Check that the <tt>tnrhdb</tt> and <tt>tnrhtp</tt> entries in the <tt>nsswitch.conf</tt> file are accurate.</b></li>
<li><b>Check that the client is correctly configured on the server.</b><pre># ldaplist -l tnrhdb <i>client-IP-address</i></pre></li>
<li><b>Check that the interfaces for your labeled zones are correctly configured on the
LDAP server.</b><pre># ldaplist -l tnrhdb <i>client-zone-IP-address</i></pre></li>
<li><b>Verify that you can <tt>ping</tt> the LDAP server from all currently running zones.</b><pre># ldapclient list
...
NS_LDAP_SERVERS= <i>LDAP-server-address</i>
# zlogin <i>zone-name1</i> ping <i>LDAP-server-address</i>
<i>LDAP-server-address</i> is alive
# zlogin <i>zone-name2</i> ping <i>LDAP-server-address</i>
<i>LDAP-server-address</i> is alive
...</pre></li>
<li><b>Configure LDAP and reboot.</b><ol style="list-style-type: lower-alpha">
<li><b>Run the Create LDAP Client action.</b><p>This action re-establishes the global zone as a client of the LDAP server.</p></li>
<li><b>In every labeled zone, re-establish the zone as a client of the LDAP
server.</b><pre># zlogin <i>zone-name1</i>
# ldapclient init \
-a profileName=<i>profileName</i> \
-a domainName=<i>domain</i> \
-a proxyDN=<i>proxyDN</i> \
-a proxyPassword=<i>password</i> <i>LDAP-Server-IP-Address</i>
# exit
# zlogin <i>zone-name2</i> ...</pre></li>
<li><b>Halt all zones, lock the file systems, and reboot.</b><p>If you are using Solaris ZFS, halt the zones and lock the file
systems before rebooting. If you are not using ZFS, you can reboot without
halting the zones and locking the file systems.</p><pre># zoneadm list
# zoneadm -z <i>zone-name</i> halt
# lockfs -fa
# reboot</pre></li></ol></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="managetnet-14.html">Previous</a>
             </td>
             <td align="right">
                 <a href="managemail-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

