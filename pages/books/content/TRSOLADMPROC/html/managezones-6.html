<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Managing Zones (Task Map) - Solaris Trusted Extensions Administrator's Procedures</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2009-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">Solaris Trusted Extensions Administrator's Procedures</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="managezones-4.html">Previous</a>
             </td>
             <td align="right">
                 <a href="managefiles-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-4.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="trp-part-1.html">Part&nbsp;I&nbsp;Initial Configuration of Trusted Extensions</a></p>
<p class="toc level2"><a href="ovw-1.html">1.&nbsp;&nbsp;Security Planning for Trusted Extensions</a></p>
<p class="toc level2"><a href="tmap-1.html">2.&nbsp;&nbsp;Configuration Roadmap for Trusted Extensions</a></p>
<p class="toc level2"><a href="startinst-1.html">3.&nbsp;&nbsp;Adding Solaris Trusted Extensions Software to the Solaris OS (Tasks)</a></p>
<p class="toc level2"><a href="txconf-1.html">4.&nbsp;&nbsp;Configuring Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="txldap-1.html">5.&nbsp;&nbsp;Configuring LDAP for Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="headl-1.html">6.&nbsp;&nbsp;Configuring a Headless System With Trusted Extensions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="trp-part-2.html">Part&nbsp;II&nbsp;Administration of Trusted Extensions</a></p>
<p class="toc level2"><a href="txintro-1.html">7.&nbsp;&nbsp;Trusted Extensions Administration Concepts</a></p>
<p class="toc level2"><a href="txtool-1.html">8.&nbsp;&nbsp;Trusted Extensions Administration Tools</a></p>
<p class="toc level2"><a href="roles-1.html">9.&nbsp;&nbsp;Getting Started as a Trusted Extensions Administrator (Tasks)</a></p>
<p class="toc level2"><a href="secreq-1.html">10.&nbsp;&nbsp;Security Requirements on a Trusted Extensions System (Overview)</a></p>
<p class="toc level2"><a href="commontasks-1.html">11.&nbsp;&nbsp;Administering Security Requirements in Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="useraccts-1.html">12.&nbsp;&nbsp;Users, Rights, and Roles in Trusted Extensions (Overview)</a></p>
<p class="toc level2"><a href="manageusers-1.html">13.&nbsp;&nbsp;Managing Users, Rights, and Roles in Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="remotead-1.html">14.&nbsp;&nbsp;Remote Administration in Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="manageldap-1.html">15.&nbsp;&nbsp;Trusted Extensions and LDAP (Overview)</a></p>
<p class="toc level2"><a href="managezones-1.html">16.&nbsp;&nbsp;Managing Zones in Trusted Extensions (Tasks)</a></p>
<p class="toc level3"><a href="managezones-16.html">Zones in Trusted Extensions</a></p>
<p class="toc level3"><a href="managezones-12.html">Global Zone Processes and Labeled Zones</a></p>
<p class="toc level3"><a href="managezones-4.html">Zone Administration Utilities in Trusted Extensions</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Managing Zones (Task Map)</a></p>
</div>
<p class="toc level2 tocsp"><a href="managefiles-1.html">17.&nbsp;&nbsp;Managing and Mounting Files in Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="txnet-1.html">18.&nbsp;&nbsp;Trusted Networking (Overview)</a></p>
<p class="toc level2"><a href="managetnet-1.html">19.&nbsp;&nbsp;Managing Networks in Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="managemail-1.html">20.&nbsp;&nbsp;Multilevel Mail in Trusted Extensions (Overview)</a></p>
<p class="toc level2"><a href="manageprint-1.html">21.&nbsp;&nbsp;Managing Labeled Printing (Tasks)</a></p>
<p class="toc level2"><a href="gentextid-15538.html">22.&nbsp;&nbsp;Devices in Trusted Extensions (Overview)</a></p>
<p class="toc level2"><a href="managedev-1.html">23.&nbsp;&nbsp;Managing Devices for Trusted Extensions (Tasks)</a></p>
<p class="toc level2"><a href="audtask-1.html">24.&nbsp;&nbsp;Trusted Extensions Auditing (Overview)</a></p>
<p class="toc level2"><a href="softmgt-1.html">25.&nbsp;&nbsp;Software Management in Trusted Extensions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="appol-1.html">A.&nbsp;&nbsp;Site Security Policy</a></p>
<p class="toc level2"><a href="appol-12.html">Creating and Managing a Security Policy</a></p>
<p class="toc level2"><a href="appol-11.html">Site Security Policy and Trusted Extensions</a></p>
<p class="toc level2"><a href="appol-2.html">Computer Security Recommendations</a></p>
<p class="toc level2"><a href="appol-3.html">Physical Security Recommendations</a></p>
<p class="toc level2"><a href="appol-4.html">Personnel Security Recommendations</a></p>
<p class="toc level2"><a href="appol-5.html">Common Security Violations</a></p>
<p class="toc level2"><a href="appol-6.html">Additional Security References</a></p>
<p class="toc level1 tocsp"><a href="aptxconf-1.html">B.&nbsp;&nbsp;Using CDE Actions to Install Zones in Trusted Extensions</a></p>
<p class="toc level2"><a href="aptxconf-62.html">Associating Network Interfaces With Zones by Using CDE Actions (Task Map)</a></p>
<p class="toc level2"><a href="aptxconf-40.html">Preparing to Create Zones by Using CDE Actions (Task Map)</a></p>
<p class="toc level2"><a href="aptxconf-20.html">Creating Labeled Zones by Using CDE Actions (Task Map)</a></p>
<p class="toc level1 tocsp"><a href="checklist-1.html">C.&nbsp;&nbsp;Configuration Checklist for Trusted Extensions</a></p>
<p class="toc level2"><a href="checklist-2.html">Checklist for Configuring Trusted Extensions</a></p>
<p class="toc level1 tocsp"><a href="txapp-1.html">D.&nbsp;&nbsp;Quick Reference to Trusted Extensions Administration</a></p>
<p class="toc level2"><a href="txapp-2.html">Administrative Interfaces in Trusted Extensions</a></p>
<p class="toc level2"><a href="txapp-3.html">Solaris Interfaces Extended by Trusted Extensions</a></p>
<p class="toc level2"><a href="txapp-4.html">Tighter Security Defaults in Trusted Extensions</a></p>
<p class="toc level2"><a href="txapp-5.html">Limited Options in Trusted Extensions</a></p>
<p class="toc level1 tocsp"><a href="txmp-1.html">E.&nbsp;&nbsp;List of Trusted Extensions Man Pages</a></p>
<p class="toc level2"><a href="txmp-2.html">Trusted Extensions Man Pages in Alphabetical Order</a></p>
<p class="toc level2"><a href="txmp-3.html">Solaris Man Pages That Are Modified by Trusted Extensions</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="managezones-6"></a><h3>Managing Zones (Task Map)</h3>
<a name="indexterm-866"></a><a name="indexterm-867"></a><a name="indexterm-868"></a><a name="indexterm-869"></a><p>The following task map describes zone management tasks that are specific to Trusted
Extensions. The map also points to common procedures that are performed in Trusted
Extensions just as they are performed on a Solaris system.</p><table><col width="33%"><col width="33%"><col width="33%"><tr><th align="left" valign="top" scope="column"><p>Task</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
<th align="left" valign="top" scope="column"><p>For Instructions</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>View all
zones.</p></td>
<td align="left" valign="top" scope="row"><p>At any label, views the zones that are dominated by the current
zone.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#managetnet-12">How to Display Ready or Running Zones</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>View mounted directories.</p></td>
<td align="left" valign="top" scope="row"><p>At any label, views the directories that are dominated by
the current label.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#managetnet-11">How to Display the Labels of Mounted Files</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Enable regular users to view an <tt>/etc</tt> file.</p></td>
<td align="left" valign="top" scope="row"><p>Loopback mounts a directory
or file from the global zone that is not visible by default in
a labeled zone.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#managezones-10">How to Loopback Mount a File That Is Usually Not Visible in a Labeled Zone</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Prevent regular users from viewing a lower-level home directory from a
higher label.</p></td>
<td align="left" valign="top" scope="row"><p>By default, lower-level directories are visible from higher-level zones. When you disable
the mounting of one lower-level zone, you disable all mounts of lower-level zones.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#managezones-3">How to Disable the Mounting of Lower-Level Files</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Configure
a zone to enable the changing of the labels on files.</p></td>
<td align="left" valign="top" scope="row"><p>Labeled zones
have limited privileges. By default, labeled zones do not have the privilege that
enables an authorized user to relabel a file. You modify the zone configuration
to add the privilege.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#managezones-8">How to Enable Files to be Relabeled From a Labeled Zone</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Move a file or directory into or out of
a labeled zone.</p></td>
<td align="left" valign="top" scope="row"><p>Changes a file or directory's level of security by changing
its label.</p></td>
<td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-7313/ugtour-23?a=view">How to Move Files Between Labels in Trusted CDE in <i>Solaris Trusted Extensions User&rsquo;s Guide</i></a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Attach a ZFS dataset to a labeled zone and share it.</p></td>
<td align="left" valign="top" scope="row"><p>Mounts
a ZFS dataset with read/write permissions in a labeled zone and shares the
dataset read-only with a higher zone.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#managezones-22">How to Share a ZFS Dataset From a Labeled Zone</a>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Configure a new zone.</p></td>
<td align="left" valign="top" scope="row"><p>Creates a zone at
a label that is not currently being used to label a zone on
this system.</p></td>
<td align="left" valign="top" scope="row"><p>See <a href="txconf-20.html#txconf-11">Name and Label the Zone</a>.</p><p>Then, follow the procedure that the initial setup team used
to create the other zones. For the steps, see <a href="txconf-20.html">Creating Labeled Zones</a>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Create a multilevel port
for an application.</p></td>
<td align="left" valign="top" scope="row"><p>Multilevel ports are useful for programs that require a multilevel
feed into a labeled zone.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#managezones-28">How to Configure a Multilevel Port for NFSv3 Over <tt>udp</tt></a></p><p><a href="#managezones-5">How to Create a Multilevel Port for a Zone</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Troubleshoot NFS mount and access problems.</p></td>
<td align="left" valign="top" scope="row"><p>Debugs general access issues
for mounts and possibly for zones.</p></td>
<td align="left" valign="top" scope="row"><p><a href="managefiles-6.html#managefiles-20">How to Troubleshoot Mount Failures in Trusted Extensions</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Remove a labeled zone.</p></td>
<td align="left" valign="top" scope="row"><p>Completely removes a labeled
zone from the system.</p></td>
<td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2450/z.inst.task-44?a=view">How to Remove a Non-Global Zone in <i>System Administration Guide: Virtualization Using the Solaris Operating System</i></a></p></td>
</tr>
</table>

<a name="managetnet-12"></a><h4>How to Display Ready or Running Zones</h4><p><a name="indexterm-870"></a><a name="indexterm-871"></a>This procedure creates a shell script that displays the labels of the current
zone and all zones that the current zone dominates.</p><h6>Before You Begin</h6><p>You must be in the System Administrator role in the global zone.</p><ol>
<li><b>Use the trusted editor to create the <tt>getzonelabels</tt> script.</b><p>For details, see <a href="roles-4.html#roles-10">How to Edit Administrative Files in Trusted Extensions</a>.</p><p>Provide the pathname to the script, such as <tt>/usr/local/scripts/getzonelabels</tt>.</p></li>
<li><b><a name="indexterm-872"></a><a name="indexterm-873"></a><a name="indexterm-874"></a><a name="indexterm-875"></a>Add the following content, and save the file:</b><pre>#!/bin/sh
#
echo "NAME\t\tSTATUS\t\tLABEL"
echo "====\t\t======\t\t====="
myzone=`zonename`
for i in `/usr/sbin/zoneadm list -p` ; do
        zone=`echo $i | cut -d ":" -f2`
        status=`echo $i | cut -d ":" -f3`
        path=`echo $i | cut -d ":" -f4`
        if [ $zone != global ]; then
                if [ $myzone = global ]; then
                        path=$path/root/tmp
                else
                        path=$path/export/home
                fi
        fi
        label=`/usr/bin/getlabel -s $path |cut -d ":" -f2-9`
        if [ `echo $zone|wc -m` -lt 8 ]; then
                echo "$zone\t\t$status\t$label"
        else
                echo "$zone\t$status\t$label"
        fi
done</pre></li>
<li><b>Test the script in the global zone.</b><pre># <tt><b>getzonelabels</b></tt>
NAME            STATUS          LABEL
====            ======          =====
global          running         ADMIN_HIGH
needtoknow      running         CONFIDENTIAL : NEED TO KNOW
restricted      ready           CONFIDENTIAL : RESTRICTED
internal        running         CONFIDENTIAL : INTERNAL
public          running         PUBLIC</pre><p>When run from the global zone, the script displays the labels of
all ready or running zones. Here is the global zone output for the
zones that were created from the default <tt>label_encodings</tt> file:</p></li></ol><a name="managetnet-21"></a><h6>Example&nbsp;16-1 Displaying the Labels of All Ready or Running Zones</h6><p>In the following example, a user runs the <tt>getzonelabels</tt> script in the <tt>internal</tt>
zone.</p><pre># <tt><b>getzonelabels</b></tt>
NAME            STATUS          LABEL
====            ======          =====
internal        running         CONFIDENTIAL : INTERNAL
public          running         PUBLIC</pre>

<a name="managetnet-11"></a><h4>How to Display the Labels of Mounted Files</h4><a name="indexterm-876"></a><p>This procedure creates a shell script that displays the mounted file systems of
the current zone. When run from the global zone, the script displays the
labels of all mounted file systems in every zone.</p><h6>Before You Begin</h6><p>You must be in the System Administrator role in the global zone.</p><ol>
<li><b>Use the trusted editor to create the <tt>getmounts</tt> script.</b><p>For details, see <a href="roles-4.html#roles-10">How to Edit Administrative Files in Trusted Extensions</a>.</p><p>Provide the pathname to the script, such as <tt>/usr/local/scripts/getmounts</tt>.</p></li>
<li><b><a name="indexterm-877"></a><a name="indexterm-878"></a><a name="indexterm-879"></a><a name="indexterm-880"></a>Add the following content and save the file:</b><pre>#!/bin/sh
#
for i in `/usr/sbin/mount -p | cut -d " " -f3` ; do
        /usr/bin/getlabel $i
done</pre></li>
<li><b>Test the script in the global zone.</b><pre># <tt><b>/usr/local/scripts/getmounts</b></tt>
/:      ADMIN_LOW
/dev:   ADMIN_LOW
/kernel:        ADMIN_LOW
/lib:   ADMIN_LOW
/opt:   ADMIN_LOW
/platform:      ADMIN_LOW
/sbin:  ADMIN_LOW
/usr:   ADMIN_LOW
/var/tsol/doors:        ADMIN_LOW
/zone/needtoknow/export/home:   CONFIDENTIAL : NEED TO KNOW
/zone/internal/export/home:     CONFIDENTIAL : INTERNAL USE ONLY
/zone/restricted/export/home:   CONFIDENTIAL : RESTRICTED
/proc:  ADMIN_LOW
/system/contract:       ADMIN_LOW
/etc/svc/volatile:      ADMIN_LOW
/etc/mnttab:    ADMIN_LOW
/dev/fd:        ADMIN_LOW
/tmp:           ADMIN_LOW
/var/run:       ADMIN_LOW
/zone/public/export/home:  PUBLIC
/root:          ADMIN_LOW</pre></li></ol><a name="managezones-19"></a><h6>Example&nbsp;16-2 Displaying the Labels of File Systems in the <tt>restricted</tt> Zone</h6><a name="indexterm-881"></a><a name="indexterm-882"></a><a name="indexterm-883"></a><p>When run from a labeled zone by a regular user, the <tt>getmounts</tt>
script displays the labels of all the mounted file systems in that zone.
On a system where zones are created for every label in the default
<tt>label_encodings</tt> file, the following is the output from the <tt>restricted</tt> zone:</p><pre># <tt><b>/usr/local/scripts/getmounts</b></tt>
/:      CONFIDENTIAL : RESTRICTED
/dev:   CONFIDENTIAL : RESTRICTED
/kernel:        ADMIN_LOW
/lib:   ADMIN_LOW
/opt:   ADMIN_LOW
/platform:      ADMIN_LOW
/sbin:  ADMIN_LOW
/usr:   ADMIN_LOW
/var/tsol/doors:        ADMIN_LOW
/zone/needtoknow/export/home:   CONFIDENTIAL : NEED TO KNOW
/zone/internal/export/home:     CONFIDENTIAL : INTERNAL USE ONLY
/proc:  CONFIDENTIAL : RESTRICTED
/system/contract:       CONFIDENTIAL : RESTRICTED
/etc/svc/volatile:      CONFIDENTIAL : RESTRICTED
/etc/mnttab:    CONFIDENTIAL : RESTRICTED
/dev/fd:        CONFIDENTIAL : RESTRICTED
/tmp:   CONFIDENTIAL : RESTRICTED
/var/run:       CONFIDENTIAL : RESTRICTED
/zone/public/export/home:       PUBLIC
/home/gfaden:   CONFIDENTIAL : RESTRICTED</pre>

<a name="managezones-10"></a><h4>How to Loopback Mount a File That Is Usually Not Visible in a Labeled Zone</h4><p><a name="indexterm-884"></a><a name="indexterm-885"></a>This procedure enables a user in a specified labeled zone to view files
that are not exported from the global zone by default.</p><h6>Before You Begin</h6><p>You must be in the System Administrator role in the global zone.</p><ol>
<li><b>Halt the zone whose configuration you want to change.</b><pre># zoneadm -z <i>zone-name</i> halt</pre></li>
<li><b>Loopback mount a file or directory.</b><p>For example, enable ordinary users to view a file in the <tt>/etc</tt> directory.</p><pre># zonecfg -z <i>zone-name</i>
 add filesystem
 set special=/etc/<i>filename</i>
 set directory=/etc/<i>filename</i>
 set type=lofs
 add options [ro,nodevices,nosetuid]
 end
 exit</pre>
<hr><p><b>Note - </b>Certain files are not used by the system, so that loopback mounting them
has no effect. For example, the <tt>/etc/dfs/dfstab</tt> file in a labeled zone is
not checked by Trusted Extensions software. For more information, see <a href="managefiles-18.html">Sharing Files From a Labeled Zone</a>.</p>
<hr>
</li>
<li><b>Start the zone.</b><pre># zoneadm -z <i>zone-name</i> boot</pre></li></ol><a name="managezones-14"></a><h6>Example&nbsp;16-3 Loopback Mounting the <tt>/etc/passwd</tt> file</h6><p>In this example, the security administrator wants to enable testers and programmers to
check that their local passwords are set. After the <tt>sandbox</tt> zone is
halted, it is configured to loopback mount the <tt>passwd</tt> file. Then, the
zone is restarted.</p><pre># <tt><b>zoneadm -z sandbox halt</b></tt>
# <tt><b>zonecfg -z sandbox add filesystem set special=/etc/passwd set directory=/etc/passwd set type=lofs add options [ro,nodevices,nosetuid] end exit</b></tt>
# <tt><b>zoneadm -z sandbox boot</b></tt></pre>

<a name="managezones-3"></a><h4>How to Disable the Mounting of Lower-Level Files</h4><a name="indexterm-886"></a><a name="indexterm-887"></a><a name="indexterm-888"></a><a name="indexterm-889"></a><a name="indexterm-890"></a><p>By default, users can view lower-level files. Remove the <tt>net_mac_aware</tt> privilege to
prevent the viewing of all lower-level files from a particular zone. For a
description of the <tt>net_mac_aware</tt> privilege, see the <a href="http://docs.sun.com/doc/819-2252/privileges-5?a=view"><tt>privileges</tt>(5)</a> man page.</p><h6>Before You Begin</h6><p>You must be in the System Administrator role in the global zone.</p><ol>
<li><b>Halt the zone whose configuration you want to change.</b><pre># zoneadm -z <i>zone-name</i> halt</pre></li>
<li><b>Configure the zone to prevent the viewing of lower-level files.</b><p>Remove the <tt>net_mac_aware</tt> privilege from the zone.</p><pre># zonecfg -z <i>zone-name</i>
 set limitpriv=default,!net_mac_aware
 exit</pre></li>
<li><b>Restart the zone.</b><pre># zoneadm -z <i>zone-name</i> boot</pre></li></ol><a name="managezones-11"></a><h6>Example&nbsp;16-4 Preventing Users From Viewing Lower-Level Files</h6><p>In this example, the security administrator wants to prevent users on one system
from being confused. Therefore, users can only view files at the label at
which the users are working. So, the security administrator prevents the viewing of
all lower-level files. On this system, users cannot see publicly available files unless
they are working at the <tt>PUBLIC</tt> label. Also, users can only NFS mount
files at the label of the zones.</p><pre># <tt><b>zoneadm -z restricted halt</b></tt>
# <tt><b>zonecfg -z restricted set limitpriv=default,!net_mac_aware exit</b></tt>
# <tt><b>zoneadm -z restricted boot</b></tt></pre><pre># <tt><b>zoneadm -z needtoknow halt</b></tt>
# <tt><b>zonecfg -z needtoknow set limitpriv=default,!net_mac_aware exit</b></tt>
# <tt><b>zoneadm -z needtoknow boot</b></tt></pre><pre># <tt><b>zoneadm -z internal halt</b></tt>
# <tt><b>zonecfg -z internal set limitpriv=default,!net_mac_aware exit</b></tt>
# <tt><b>zoneadm -z internal boot</b></tt></pre><p>Because <tt>PUBLIC</tt> is the lowest label, the security administrator does not run the
commands for the <tt>PUBLIC</tt> zone.</p>

<a name="managezones-22"></a><h4>How to Share a ZFS Dataset From a Labeled Zone</h4><a name="indexterm-891"></a><a name="indexterm-892"></a><a name="indexterm-893"></a><a name="indexterm-894"></a><a name="indexterm-895"></a><p>In this procedure, you mount a ZFS dataset with read/write permissions in a
labeled zone. Because all commands are executed in the global zone, the global
zone administrator controls the addition of ZFS datasets to labeled zones.</p><p>At a minimum, the labeled zone must be in the <tt>ready</tt> state to
share a dataset. The zone can be in the <tt>running</tt>  state.</p><h6>Before You Begin</h6><p>To configure the zone with the dataset, you first halt the zone.</p><ol>
<li><b>Create the ZFS dataset.</b><pre># zfs create <i>datasetdir/subdir</i></pre><p>The name of the dataset can include a directory, such as <tt>zone/data</tt>.</p></li>
<li><b>In the global zone, halt the labeled zone.</b><pre># zoneadm -z <i>labeled-zone-name</i> halt</pre></li>
<li><b>Set the mount point of the dataset.</b><pre># zfs set mountpoint=legacy <i>datasetdir/subdir</i></pre><p>Setting the ZFS <tt>mountpoint</tt> property sets the label of the mount point when
the mount point corresponds to a labeled zone.</p></li>
<li><b>Add the dataset to the zone as a file system.</b><pre># zonecfg -z <i>labeled-zone-name</i>
# zonecfg:<i>labeled-zone-name</i>&gt; add fs
# zonecfg:<i>labeled-zone-name</i>:dataset&gt; set dir=/<i>subdir</i>
# zonecfg:<i>labeled-zone-name</i>:dataset&gt; set special=<i>datasetdir/subdir</i>
# zonecfg:<i>labeled-zone-name</i>:dataset&gt; set type=zfs
# zonecfg:<i>labeled-zone-name</i>:dataset&gt; end
# zonecfg:<i>labeled-zone-name</i>&gt; exit</pre><p>By adding the dataset as a file system, the dataset is mounted
at <tt>/data</tt> in the zone before the <tt>dfstab</tt> file is interpreted. This step
ensures that the dataset is not mounted before the zone is booted. Specifically,
the zone boots, the dataset is mounted, then the <tt>dfstab</tt> file is interpreted.</p></li>
<li><b>Share the dataset.</b><p>Add an entry for the dataset file system to the <tt>/zone/</tt><i>labeled-zone-name</i><tt>/etc/dfs/dfstab</tt> file. This
entry also uses the <tt>/</tt><i>subdir</i> pathname.</p><pre>share  -F nfs  -d "<i>dataset-comment</i>"  /<i>subdir</i></pre></li>
<li><b>Boot the labeled zone.</b><pre># <tt><b>zoneadm -z </tt><i>labeled-zone-name</i><tt> boot</b></tt></pre><p>When the zone is booted, the dataset is mounted automatically as a
read/write mount point in the <i>labeled-zone-name</i> zone with the label of the <i>labeled-zone-name</i> zone.</p></li></ol><a name="managezones-23"></a><h6>Example&nbsp;16-5 Sharing and Mounting a ZFS Dataset From Labeled Zones</h6><a name="indexterm-896"></a><a name="indexterm-897"></a><p>In this example, the administrator adds a ZFS dataset to the <tt>needtoknow</tt>
zone and shares the dataset. The dataset, <tt>zone/data</tt>, is currently assigned to the
<tt>/mnt</tt> mount point. Users in the <tt>restricted</tt> zone can view the dataset.</p><p>First, the administrator halts the zone.</p><pre># <tt><b>zoneadm -z needtoknow halt</b></tt></pre><p>Because the dataset is currently assigned to a different mount point, the administrator
removes the previous assignment, then sets the new mount point.</p><pre># <tt><b>zfs set zoned=off zone/data</b></tt>
# <tt><b>zfs set mountpoint=legacy zone/data</b></tt></pre><p>Next, in the <tt>zonecfg</tt> interactive interface, the administrator explicitly adds the dataset to
the <tt>needtoknow</tt> zone.</p><pre># <tt><b>zonecfg -z needtoknow</b></tt>
# <tt><b>zonecfg:needtoknow&gt; add fs</b></tt>
# <tt><b>zonecfg:needtoknow:dataset&gt; set dir=/data</b></tt>
# <tt><b>zonecfg:needtoknow:dataset&gt; set special=zone/data</b></tt>
# <tt><b>zonecfg:needtoknow:dataset&gt; set type=zfs</b></tt>
# <tt><b>zonecfg:needtoknow:dataset&gt; end</b></tt>
# <tt><b>zonecfg:needtoknow&gt; exit</b></tt></pre><p>Next, the administrator modifies the <tt>/zone/needtoknow/etc/dfs/dfstab</tt> file to share the dataset, then
boots the <tt>needtoknow</tt> zone.</p><pre><tt><b>## Global zone dfstab file for needtoknow zone</b></tt>
<tt><b>share -F nfs -d "App Data on ZFS" /data</b></tt></pre><pre># <tt><b>zoneadm -z needtoknow boot</b></tt></pre><p>The dataset is now accessible.</p><p>Users in the the <tt>restricted</tt> zone, which dominates the <tt>needtoknow</tt> zone, can view
the mounted dataset by changing to the <tt>/data</tt> directory. They use the full path
to the mounted dataset from the perspective of the global zone. In this
example, <tt>machine1</tt> is the host name of the system that includes the labeled
zone. The administrator assigned this host name to a non-shared IP address.</p><pre># <tt><b>cd /net/machine1/zone/needtoknow/root/data</b></tt></pre><h6>Troubleshooting</h6><p><a name="indexterm-898"></a>If the attempt to reach the dataset from the higher label returns the
error <tt>not found</tt> or <tt>No such file or directory</tt>, the administrator must restart the automounter service by running
the <tt>svcadm restart autofs</tt> command.</p>

<a name="managezones-8"></a><h4>How to Enable Files to be Relabeled From a Labeled Zone</h4><p><a name="indexterm-899"></a>This procedure is a prerequisite for a user to be able to
relabel files.</p><h6>Before You Begin</h6><p>You must be in the Security Administrator role in the global zone.</p><ol>
<li><b>Halt the zone whose configuration you want to change.</b><pre># zoneadm -z <i>zone-name</i> halt</pre></li>
<li><b>Configure the zone to enable relabeling.</b><p>Add the appropriate privileges to the zone. The windows privileges enable users to
use drag-and-drop and cut-and-paste operations.</p><ul>
<li><b>To enable downgrades, add the <tt>file_downgrade_sl</tt> privilege to the zone.</b><pre># zonecfg -z <i>zone-name</i>
 set limitpriv=default,win_dac_read,win_mac_read,win_dac_write,
 win_mac_write,win_selection,file_downgrade_sl
 exit</pre></li>
<li><b>To enable upgrades, add the <tt>sys_trans_label</tt> and <tt>file_upgrade_sl</tt> privileges to the zone.</b><pre># zonecfg -z <i>zone-name</i>
 set limitpriv=default,win_dac_read,win_mac_read,win_dac_write,
 win_mac_write,win_selection,sys_trans_label,file_upgrade_sl
 exit</pre></li>
<li><b>To enable both upgrades and downgrades, add all three privileges to the zone.</b><pre># zonecfg -z <i>zone-name</i>
 set limitpriv=default,win_dac_read,win_mac_read,win_dac_write,
 win_mac_write,win_selection,sys_trans_label,file_downgrade_sl,
 file_upgrade_sl
 exit</pre></li></ul></li>
<li><b>Restart the zone.</b><pre># zoneadm -z <i>zone-name</i> boot</pre><p>For the user and process requirements that permit relabeling, see the <a href="http://docs.sun.com/doc/819-2248/setflabel-3tsol?a=view"><tt>setflabel</tt>(3TSOL)</a>
man page. To authorize a user to relabel files, see <a href="usermgr-13.html#manageusers-16">How to Enable a User to Change the Security Level of Data</a>.</p></li></ol><a name="managezones-7"></a><h6>Example&nbsp;16-6 Enabling Upgrades From the <tt>internal</tt> Zone</h6><p>In this example, the security administrator wants to enable authorized users on a
system to upgrade files. By enabling users to upgrade information, the administrator enables
them to protect the information at a higher level of security. In the
global zone, the administrator runs the following zone administration commands.</p><pre># <tt><b>zoneadm -z internal halt</b></tt>
# <tt><b>zonecfg -z internal set limitpriv=default,sys_trans_label,file_upgrade_sl exit</b></tt>
# <tt><b>zoneadm -z internal boot</b></tt></pre><p>Authorized users can now upgrade <tt>internal</tt> information to <tt>restricted</tt> from the <tt>internal</tt> zone.</p><a name="managezones-9"></a><h6>Example&nbsp;16-7 Enabling Downgrades From the <tt>restricted</tt> Zone</h6><p>In this example, the security administrator wants to enable authorized users on a
system to downgrade files. Because the administrator does not add windows privileges to
the zone, authorized users cannot use the File Manager to relabel files. To
relabel files, users use the <tt>setlabel</tt> command.</p><p>By enabling users to downgrade information, the administrator permits users at a lower
level of security to access the files. In the global zone, the administrator
runs the following zone administration commands.</p><pre># <tt><b>zoneadm -z restricted halt</b></tt>
# <tt><b>zonecfg -z restricted set limitpriv=default,file_downgrade_sl exit</b></tt>
# <tt><b>zoneadm -z restricted boot</b></tt></pre><p>Authorized users can now downgrade <tt>restricted</tt> information to <tt>internal</tt> or <tt>public</tt> from the
<tt>restricted</tt> zone by using the <tt>setlabel</tt> command.</p>

<a name="managezones-28"></a><h4>How to Configure a Multilevel Port for NFSv3 Over <tt>udp</tt></h4><p><a name="indexterm-900"></a><a name="indexterm-901"></a><a name="indexterm-902"></a>This procedure is used to enable NFSv3 read-down mounts over <tt>udp</tt>. The Solaris Management
Console is used to add the MLP.</p><h6>Before You Begin</h6><p>You must be in the Security Administrator role in the global zone.</p><ol>
<li><b>Start the Solaris Management Console.</b><p>For details, see <a href="roles-4.html#roles-15">How to Administer the Local System With the Solaris Management Console</a>.</p></li>
<li><b>Choose the Files toolbox.</b><p>The title of the toolbox includes <tt>Scope=Files, Policy=TSOL</tt>.</p></li>
<li><b>Configure the zone and the MLP.</b><ol style="list-style-type: lower-alpha">
<li><b>Navigate to the Trusted Network Zones tool.</b></li>
<li><b>Double-click the global zone.</b></li>
<li><b>Add a multilevel port for the UDP protocol:</b><ol style="list-style-type: lower-roman">
<li><b>Click Add for the Multilevel Ports for Zone's IP Addresses.</b></li>
<li><b>Type 2049 for the port number, and click OK.</b></li></ol></li>
<li><b>Click OK to save the settings.</b></li></ol></li>
<li><b>Close the Solaris Management Console.</b></li>
<li><b>Update the kernel.</b><pre># <tt><b>tnctl -fz /etc/security/tsol/tnzonecfg</b></tt></pre></li></ol>

<a name="managezones-5"></a><h4>How to Create a Multilevel Port for a Zone</h4><p><a name="indexterm-903"></a><a name="indexterm-904"></a><a name="indexterm-905"></a>This procedure is used when an application that runs in a labeled zone
requires a multilevel port (MLP) to communicate with the zone. In this procedure,
a web proxy communicates with the zone. The Solaris Management Console is
used to add the MLP.</p><h6>Before You Begin</h6><p>You must be in the Security Administrator role in the global zone.
The labeled zone must exist. For details, see <a href="txconf-20.html">Creating Labeled Zones</a>.</p><ol>
<li><b>Start the Solaris Management Console.</b><p>For details, see <a href="roles-4.html#roles-15">How to Administer the Local System With the Solaris Management Console</a>.</p></li>
<li><b>Choose the Files toolbox.</b><p>The title of the toolbox includes <tt>Scope=Files, Policy=TSOL</tt>.</p></li>
<li><b>Add the proxy host and the webservices host to the list of
computers.</b><ol style="list-style-type: lower-alpha">
<li><b>Under System Configuration, navigate to the Computers and Networks tool.</b></li>
<li><b>In the Computers tool, click the Action menu and choose Add Computer.</b></li>
<li><b>Add the host name and IP address for the proxy host.</b></li>
<li><b>Save the changes.</b></li>
<li><b>Add the host name and IP address for the webservice host.</b></li>
<li><b>Save the changes.</b></li></ol></li>
<li><b>Configure the zone and the MLP.</b><ol style="list-style-type: lower-alpha">
<li><b>Navigate to the Trusted Network Zones tool.</b></li>
<li><b>Select the labeled zone.</b></li>
<li><b>In the MLP Configuration for Local IP Addresses section, specify the appropriate port/protocol
field.</b></li>
<li><b>Save the changes.</b></li></ol></li>
<li><b>For the zone, customize a template by completing the following steps:</b><ol style="list-style-type: lower-alpha">
<li><b>Navigate to the Security Templates tool.</b><p>Click the Action menu and choose Add Template.</p></li>
<li><b>Use the host name for the template name.</b></li>
<li><b>Specify CIPSO for the Host Type.</b></li>
<li><b>Use the label of the zone for the Minimum Label and for
the Maximum Label.</b></li>
<li><b>Assign the zone label to the Security Label Set.</b></li>
<li><b>Select the Hosts Explicitly Assigned tab.</b></li>
<li><b>In the Add an Entry section, add the IP address that is
associated with the zone.</b></li>
<li><b>Save the changes.</b></li></ol></li>
<li><b>Close the Solaris Management Console.</b></li>
<li><b>Start the zones.</b><pre># zoneadm -z <i>zone-name</i> boot</pre></li>
<li><b>In the global zone, add routes for the new addresses.</b><p>For example, if the zones have a shared IP address, do the following:</p><pre># route add <i>proxy</i> <i>labeled-zones-IP-address</i>
# route add <i>webservice</i> <i>labeled-zones-IP-address</i></pre></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="managezones-4.html">Previous</a>
             </td>
             <td align="right">
                 <a href="managefiles-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

