<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Creating and Upgrading a Boot Environment When Non-Global Zones Are Installed (Tasks) - Solaris Express Installation Guide:  Solaris Live Upgrade and Upgrade Planning</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-05-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">Solaris Express Installation Guide:  Solaris Live Upgrade and Upgrade Planning</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="gdxkz.html">Previous</a>
             </td>
             <td align="right">
                 <a href="gdzlg.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="esqbt.html">Part&nbsp;I&nbsp;Upgrading With Solaris Live Upgrade</a></p>
<p class="toc level2"><a href="intro-1.html">1.&nbsp;&nbsp;Where to Find Solaris Installation Planning Information</a></p>
<p class="toc level2"><a href="luoverview-1.html">2.&nbsp;&nbsp;Solaris Live Upgrade (Overview)</a></p>
<p class="toc level2"><a href="luplanning-1.html">3.&nbsp;&nbsp;Solaris Live Upgrade (Planning)</a></p>
<p class="toc level2"><a href="lucreate-1.html">4.&nbsp;&nbsp;Using Solaris Live Upgrade to Create a Boot Environment (Tasks)</a></p>
<p class="toc level2"><a href="liveupgrade-1.html">5.&nbsp;&nbsp;Upgrading With Solaris Live Upgrade (Tasks)</a></p>
<p class="toc level2"><a href="luupgrade-85.html">6.&nbsp;&nbsp;Failure Recovery: Falling Back to the Original Boot Environment (Tasks)</a></p>
<p class="toc level2"><a href="lumaintainence-1.html">7.&nbsp;&nbsp;Maintaining Solaris Live Upgrade Boot Environments (Tasks)</a></p>
<p class="toc level2"><a href="grub-101.html">8.&nbsp;&nbsp;x86: Locating the GRUB Menu's <tt>menu.lst</tt> File (Tasks)</a></p>
<p class="toc level2"><a href="gdzlc.html">9.&nbsp;&nbsp;Upgrading the Solaris OS on a System With Non-Global  Zones Installed</a></p>
<p class="toc level3"><a href="gdxkz.html">Upgrading With Solaris Live Upgrade and Installed Non-Global Zones (Overview)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Creating and Upgrading a Boot Environment When Non-Global Zones Are Installed (Tasks)</a></p>
<p class="toc level4"><a href="#gdzpq">Upgrading With Solaris Live Upgrade When Non-Global Zones Are Installed on a System (Tasks)</a></p>
</div>
<p class="toc level3 tocsp"><a href="gdzlg.html">Upgrading a System With Non-Global  Zones Installed (Example)</a></p>
<p class="toc level3"><a href="geayk.html">Administering Boot Environments That Contain Non-Global Zones</a></p>
<p class="toc level4"><a href="geayk.html#gebjm">To View the Configuration of a Boot Environment's Non-Global Zone File Systems</a></p>
<p class="toc level4"><a href="geayk.html#gedjg">To Compare Boot Environments for a System With Non-Global Zones Installed</a></p>
<p class="toc level2 tocsp"><a href="luexample-1.html">10.&nbsp;&nbsp;Solaris Live Upgrade (Examples)</a></p>
<p class="toc level2"><a href="lureference-1.html">11.&nbsp;&nbsp;Solaris Live Upgrade (Command Reference)</a></p>
<p class="toc level1 tocsp"><a href="esqcb.html">Part&nbsp;II&nbsp;Appendices</a></p>
<p class="toc level2"><a href="troubleshooting-9.html">A.&nbsp;&nbsp;Troubleshooting (Tasks)</a></p>
<p class="toc level2"><a href="package-9.html">B.&nbsp;&nbsp;Additional SVR4 Packaging Requirements (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="gdxla"></a><h3>Creating and Upgrading a Boot Environment When Non-Global Zones Are Installed (Tasks)</h3>
<p><a name="indexterm-96"></a><a name="indexterm-97"></a>The following sections provide information about creating a boot environment when non-global zones are
installed and a procedure for upgrading when non-global zones are installed.</p>
<ul><li><p><a href="">Creating and Upgrading a Boot Environment When Non-Global Zones Are Installed (Tasks)</a></p></li>
<li><p><a href="#gdzpq">Upgrading With Solaris Live Upgrade When Non-Global Zones Are Installed on a System (Tasks)</a></p><p>For an example with abbreviated steps, see <a href="gdzlg.html">Upgrading a System With Non-Global  Zones Installed (Example)</a>.</p></li></ul>


<a name="geptq"></a><h4>Creating a Boot Environment When a Non-Global Zone Is on a Separate File System</h4>
<p><a name="indexterm-98"></a><a name="indexterm-99"></a>Creating a new boot environment from the currently running boot environment remains the same
as in previous releases with one exception. You can specify a destination disk
slice for a shared file system within a non-global zone. This exception occurs
under the following conditions:</p>
<ul><li><p>If on the current boot environment the <tt>zonecfg add fs</tt> command was used to create a separate file system for a non-global zone</p></li>
<li><p>If this separate file system resides on a shared file system, such as <tt>/zone/root/export</tt></p></li></ul>
<p>To prevent this separate file system from being shared in the new
boot environment, the <tt>lucreate</tt> command enables specifying a destination slice for a separate file
system for a non-global zone. The argument to the <tt>-m</tt> option has a
new optional field, <i>zonename</i>. This new field places the non-global zone's separate file
system on a separate slice in the new boot environment. For more information
about setting up a non-global zone with a separate file system, see <a href="http://docs.sun.com/doc/819-2240/zonecfg-1m?a=view"><tt>zonecfg</tt>(1M)</a>.</p>
<hr><p><b>Note - </b>By default, any file system other than the critical file systems (root (<tt>/</tt>),
<tt>/usr</tt>, and <tt>/opt</tt> file systems) is shared between the current and new boot
environments. Updating shared files in the active boot environment also updates data in
the inactive boot environment. For example, the <tt>/export</tt> file system is a shared file
system. If you use the <tt>-m</tt> option and the <i>zonename</i> option, the
non-global zone's file system is copied to a separate slice and data is
not shared. This option prevents non-global zone file systems that were created with
the <tt>zonecfg add fs</tt> command from being shared between the boot environments. </p>
<hr>


<a name="gdzpq"></a><h4>Upgrading With Solaris Live Upgrade When Non-Global Zones Are Installed on a System (Tasks)</h4><p>The following procedure provides detailed instructions for upgrading with Solaris Live Upgrade for
a system with non-global zones installed.</p><ol>
<li><b>Remove existing Solaris Live Upgrade packages.</b><p>The three Solaris Live Upgrade packages, <tt>SUNWluu</tt>, <tt>SUNWlur</tt>, and <tt>SUNWlucfg</tt>, comprise the software
needed to upgrade by using Solaris Live Upgrade. These packages include existing software, new
features, and bug fixes. If you do not remove the existing packages and
install the new packages on your system before using Solaris Live Upgrade, 
upgrading to the target release fails.</p>
<hr><p><b>Note - </b>The <tt>SUNWlucfg</tt> package is introduced in Solaris Express 5/07 build 52. If you
are upgrading from build 52 or later, you must remove this package along
with the other two packages. Then install the three packages from the target
release.</p>
<hr>
<pre># <tt><b>pkgrm SUNWlucfg SUNWluu SUNWlur</b></tt></pre></li>
<li><b>Install the Solaris Live Upgrade packages.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Insert the Solaris DVD or CD.</b><p>This media contains the packages for the release to which you are upgrading.</p></li>
<li><b>Install the packages in the following order from the installation media or network
installation image.</b><pre># <tt><b>pkagadd -d </tt><i>path_to_packages</i><tt> SUNWlucfg SUNWlur SUNWluu</b></tt></pre><p> In the following example, the packages are installed from the installation media.</p>
<ul><li><p><b>For SPARC based systems</b>:</p><pre># <tt><b>pkgadd -d /media/cdrom/s0/Solaris_11/Product SUNWlucfg SUNWlur SUNWluu</b></tt></pre></li>
<li><p><b>For x86 based systems</b>:</p><pre># <tt><b>pkgadd -d /media/cdrom/Solaris_11/Product SUNWlucfg SUNWlur SUNWluu</b></tt></pre></li></ul>
</li></ol></li>
<li><a name="gdzpn"></a><b>Verify that the packages have been installed successfully.</b><pre># <tt><b>pkgchk -v SUNWlucfg SUNWlur SUNWluu</b></tt></pre></li>
<li><a name="gdzrj"></a><b>Create the new boot environment.</b><pre># <tt><b>lucreate [-A '</tt><i>BE_description</i><tt>'] [-c </tt><i>BE_name</i><tt>] \ -m </tt><i>mountpoint:device[,metadevice]:fs_options</i><tt>[:</tt><i>zonename</i><tt>] [-m ...] -n </tt><i>BE_name</i><tt></b></tt></pre><dl><dt><tt>-n</tt> <i>BE_name</i></dt>
<dd><p>The name of the boot environment to be created. <i>BE_name</i> must be unique on the system.</p></dd>
<dt><tt>-A</tt> '<i>BE_description</i>'</dt>
<dd><p>(Optional) Enables the creation of a boot environment description that is associated with the boot environment name (BE_name). The description can be any length and can contain any characters.</p></dd>
<dt><tt>-c</tt> <i>BE_name</i></dt>
<dd><p>Assigns the name <i>BE_name</i> to the active boot environment. This option is not required and is only used when the first boot environment is created. If you run <tt>lucreate</tt> for the first time and you omit the <tt>-c</tt> option, the software creates a default name for you. </p></dd>
<dt><tt>-m</tt> <i>mountpoint:device[,metadevice]:fs_options</i>[:<i>zonename</i>] [<tt>-m</tt> ...]</dt>
<dd><p>Specifies the file systems' configuration of the new boot environment in the <tt>vfstab</tt>. The file systems that are specified as arguments to <tt>-m</tt> can be on the same disk or they can be spread across multiple disks. Use this option as many times as needed to create the number of file systems that are needed. </p>
<ul><li><p><i>mountpoint</i> can be any valid mount point or &ndash; (hyphen), indicating a swap partition.</p></li>
<li><p><i>device</i> field can be one of the following:</p>
<ul><li><p>The name of a disk device, of the form <tt>/dev/dsk/c</tt><i>w</i><tt>t</tt><i>x</i><tt>d</tt><i>y</i><tt>s</tt><i>z</i><tt></tt></p></li>
<li><p>The name of a Solaris Volume Manager volume, of the form /dev/md/dsk/d<i>num</i></p></li>
<li><p>The name of a Veritas Volume Manager volume, of the form /dev/md/vxfs/dsk/d<i>num</i></p></li>
<li><p>The keyword <tt>merged</tt>, indicating that the file system at the specified mount point is to be merged with its parent</p></li></ul>
</li>
<li><p><i>fs_options</i> field can be one of the following: </p>
<ul><li><p><tt>ufs</tt>, which indicates a UFS file system.</p></li>
<li><p><tt>vxfs</tt>, which indicates a Veritas file system.</p></li>
<li><p><tt>swap</tt>, which indicates a swap file system. The swap mount point must be a &ndash; (hyphen).</p></li>
<li><p>For file systems that are logical devices (mirrors), several keywords specify actions to be applied to the file systems. These keywords can create a logical device, change the configuration of a logical device, or delete a logical device. For a description of these keywords, see <a href="chapter-33.html#lucreate-1000">To Create a Boot Environment With RAID-1 Volumes (Mirrors)</a>.</p></li></ul>
</li>
<li><p><i>zonename</i> specifies that a non-global zone's separate file system be placed on a separate slice. This option is used when the zone's separate file system is in a shared file system such as <tt>/zone1/root/export</tt>. This option copies the zone's separate file system to a new slice and prevents this file system from being shared. The separate file system was created with the <tt>zonecfg add fs</tt> command.</p></li></ul>
</dd>
</dl>
<p>In the following example, a new boot environment named <tt>newbe</tt> is created. 
The root (<tt>/)</tt> file system is placed on <tt>c0t1d0s4</tt>. All non-global zones
in the current boot environment are copied to the new boot environment. 
The non-global zone named <tt>zone1</tt> is given a separate mount point on <tt>c0t1d0s1</tt>.</p>
<hr><p><b>Note - </b>By default, any file system other than the critical file systems (root (<tt>/</tt>),
<tt>/usr</tt>, and <tt>/opt</tt> file systems) is shared between the current and new boot
environments. The <tt>/export</tt> file system is a shared file system. If you
use the <tt>-m</tt> option, the non-global zone's file system is placed on a
separate slice and data is not shared. This option prevents zone file systems
that were created with the <tt>zonecfg add fs</tt> command from being shared between the boot environments.
 See <a href="http://docs.sun.com/doc/819-2240/zonecfg-1m?a=view"><tt>zonecfg</tt>(1M)</a> for details.</p>
<hr>
<pre># <tt><b>lucreate -n newbe -m /:/dev/dsk/c0t1d0s4:ufs</b></tt> <tt><b>-m /export:/dev/dsk/c0t1d0s1:ufs:zone1</b></tt></pre></li>
<li><b>Upgrade the boot environment.</b><p> The operating system image to be used for the upgrade is taken
from the network.</p><pre># <tt><b>luupgrade -u -n </tt><i>BE_name</i><tt> -s </tt><i>os_image_path</i><tt></b></tt></pre><dl><dt><tt>-u</tt></dt>
<dd><p>Upgrades an operating system image on a boot environment</p></dd>
<dt><tt>-n</tt> <i>BE_name</i></dt>
<dd><p>Specifies the name of the boot environment that is to be upgraded</p></dd>
<dt><tt>-s</tt> <i>os_image_path</i></dt>
<dd><p>Specifies the path name of a directory that contains an operating system image</p></dd>
</dl>
<p>In this example, the new boot environment, <tt>newbe</tt>, is upgraded from a network
installation image.</p><pre># <tt><b>luupgrade -n newbe -u -s /net/server/export/Solaris_11/combined.solaris_wos</b></tt></pre></li>
<li><b>(Optional) Verify that the boot environment is bootable.</b><p>The <tt>lustatus</tt> command reports if the boot environment creation is complete and bootable.</p><pre># <tt><b>lustatus</b></tt>
boot environment   Is        Active  Active     Can        Copy
Name               Complete  Now     OnReboot   Delete     Status
------------------------------------------------------------------------
c0t1d0s0            yes      yes      yes       no      -
newbe               yes       no       no       yes     -</pre></li>
<li><b>Activate the new boot environment.</b><pre># <tt><b>luactivate </tt><i>BE_name</i><tt></b></tt></pre><p><i>BE_name</i> specifies the name of the boot environment that is to be activated.</p>
<hr><p><b>Note - </b>For an x86 based system, the <tt>luactivate</tt> command is required when booting a
boot environment for the first time. Subsequent activations can be made by selecting
the boot environment from the GRUB menu. For step-by-step instructions, see <a href="luupgrade-84.html#gamog">x86: Activating a Boot Environment With the GRUB Menu</a>.</p>
<hr>
<p>To successfully activate a boot environment, that boot environment must meet several conditions.
For more information, see <a href="luupgrade-84.html">Activating a Boot Environment</a>.</p></li>
<li><b>Reboot.</b><pre># <tt><b>init 6</b></tt></pre>
<hr><p><b>Caution - </b>Use only the <tt>init</tt> or <tt>shutdown</tt> commands to reboot. If you use the
<tt>reboot</tt>, <tt>halt</tt>, or <tt>uadmin</tt> commands, the system does not switch boot environments. The most
recently active boot environment is booted again.</p>
<hr>
<p>The boot environments have switched and the new boot environment is now the
current boot environment.</p></li>
<li><b>(Optional) Fall back to a different boot environment.</b><p> If the new boot environment is not viable or you want to
switch to another boot environment, see <a href="luupgrade-85.html">Chapter&nbsp;6, Failure Recovery: Falling Back to the Original Boot Environment (Tasks)</a>.</p></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="gdxkz.html">Previous</a>
             </td>
             <td align="right">
                 <a href="gdzlg.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

