<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>x86: Falling Back to the Original Boot Environment - Solaris Express Installation Guide:  Solaris Live Upgrade and Upgrade Planning</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-05-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">Solaris Express Installation Guide:  Solaris Live Upgrade and Upgrade Planning</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="gampw.html">Previous</a>
             </td>
             <td align="right">
                 <a href="lumaintainence-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="esqbt.html">Part&nbsp;I&nbsp;Upgrading With Solaris Live Upgrade</a></p>
<p class="toc level2"><a href="intro-1.html">1.&nbsp;&nbsp;Where to Find Solaris Installation Planning Information</a></p>
<p class="toc level2"><a href="luoverview-1.html">2.&nbsp;&nbsp;Solaris Live Upgrade (Overview)</a></p>
<p class="toc level2"><a href="luplanning-1.html">3.&nbsp;&nbsp;Solaris Live Upgrade (Planning)</a></p>
<p class="toc level2"><a href="lucreate-1.html">4.&nbsp;&nbsp;Using Solaris Live Upgrade to Create a Boot Environment (Tasks)</a></p>
<p class="toc level2"><a href="liveupgrade-1.html">5.&nbsp;&nbsp;Upgrading With Solaris Live Upgrade (Tasks)</a></p>
<p class="toc level2"><a href="luupgrade-85.html">6.&nbsp;&nbsp;Failure Recovery: Falling Back to the Original Boot Environment (Tasks)</a></p>
<p class="toc level3"><a href="gampw.html">SPARC: Falling Back to the Original Boot Environment</a></p>
<p class="toc level4"><a href="gampw.html#luupgrade-112">SPARC: To Fall Back Despite Successful New Boot Environment Activation</a></p>
<p class="toc level4"><a href="gampw.html#upgrade-64">SPARC: To Fall Back From a Failed Boot Environment Activation</a></p>
<p class="toc level4"><a href="gampw.html#luupgrade-98">SPARC: To Fall Back to the Original Boot Environment by Using a DVD, CD, or Net Installation Image</a></p>
<div class="onpage">
<p class="toc level3 tocsp"><a href="">x86: Falling Back to the Original Boot Environment</a></p>
<p class="toc level4"><a href="#gaciv">x86: To Fall Back Despite Successful New Boot Environment Activation With the GRUB Menu</a></p>
<p class="toc level4"><a href="#luupgrade-199">x86: To Fall Back From a Failed Boot Environment Activation With the GRUB Menu</a></p>
<p class="toc level4"><a href="#gbdew">x86: To Fall Back From a Failed Boot Environment Activation With the GRUB Menu and the DVD or CD</a></p>
</div>
<p class="toc level2 tocsp"><a href="lumaintainence-1.html">7.&nbsp;&nbsp;Maintaining Solaris Live Upgrade Boot Environments (Tasks)</a></p>
<p class="toc level2"><a href="grub-101.html">8.&nbsp;&nbsp;x86: Locating the GRUB Menu's <tt>menu.lst</tt> File (Tasks)</a></p>
<p class="toc level2"><a href="gdzlc.html">9.&nbsp;&nbsp;Upgrading the Solaris OS on a System With Non-Global  Zones Installed</a></p>
<p class="toc level2"><a href="luexample-1.html">10.&nbsp;&nbsp;Solaris Live Upgrade (Examples)</a></p>
<p class="toc level2"><a href="lureference-1.html">11.&nbsp;&nbsp;Solaris Live Upgrade (Command Reference)</a></p>
<p class="toc level1 tocsp"><a href="esqcb.html">Part&nbsp;II&nbsp;Appendices</a></p>
<p class="toc level2"><a href="troubleshooting-9.html">A.&nbsp;&nbsp;Troubleshooting (Tasks)</a></p>
<p class="toc level2"><a href="package-9.html">B.&nbsp;&nbsp;Additional SVR4 Packaging Requirements (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="gampc"></a><h3>x86: Falling Back to the Original Boot Environment</h3>
<p>To fall back to the original boot environment, choose the procedure the best
fits your circumstances.</p>
<ul><li><p><a href="#gaciv">x86: To Fall Back Despite Successful New Boot Environment Activation With the GRUB Menu</a></p></li>
<li><p><a href="#luupgrade-199">x86: To Fall Back From a Failed Boot Environment Activation With the GRUB Menu</a></p></li>
<li><p><a href="#gbdew">x86: To Fall Back From a Failed Boot Environment Activation With the GRUB Menu and the DVD or CD</a></p></li></ul>


<a name="gaciv"></a><h4>x86: To Fall Back Despite Successful New Boot Environment Activation With the GRUB Menu</h4><p>Use this procedure when you have successfully activated your new boot environment, but
are dissatisfied with the results. You can quickly switch back to the original
boot environment by using the GRUB menu.</p>
<hr><p><b>Note - </b>The boot environments that are being switched must be GRUB boot environments that
were created with GRUB software. If a boot environment was created with the
<b>Solaris 8, 9, or 10 3/05 release</b>, the boot environment is not a GRUB boot environment.</p>
<hr>
<ol>
<li><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Reboot the system.</b><pre># <tt><b>init 6</b></tt></pre><p>The GRUB menu is displayed. The Solaris OS is the original boot
environment. The <tt>second_disk</tt> boot environment was successfully activated and appears on the GRUB menu.
The <tt>failsafe</tt> entries are for recovery if for some reason the primary entry
does not boot.</p><pre>GNU GRUB version 0.95 (616K lower / 4127168K upper memory)
+-------------------------------------------------------------------+
|Solaris                                                            |
|Solaris failsafe                                                   |
|second_disk                                                        |
|second_disk failsafe                                               |
+-------------------------------------------------------------------+
Use the ^ and v keys to select which entry is highlighted. Press
enter to boot the selected OS, 'e' to edit the commands before
booting, or 'c' for a command-line.</pre></li>
<li><b>To boot to the original boot environment, use the arrow key to select
the original boot environment and press Return.</b></li></ol><a name="galuj"></a>Example&nbsp;6-1 To Fall Back Despite Successful New Boot Environment Activation<pre># <tt><b>su</b></tt>
# <tt><b>init 6</b></tt></pre><pre>GNU GRUB version 0.95 (616K lower / 4127168K upper memory)
+-------------------------------------------------------------------+
|Solaris                                                            |
|Solaris  failsafe                                                  |
|second_disk                                                        |
|second_disk failsafe                                               |
+-------------------------------------------------------------------+
Use the ^ and v keys to select which entry is highlighted. Press
enter to boot the selected OS, 'e' to edit the commands before
booting, or 'c' for a command-line.</pre><p>Select the original boot environment, <tt>Solaris</tt>.</p>

<a name="luupgrade-199"></a><h4>x86: To Fall Back From a Failed Boot Environment Activation With the GRUB Menu</h4><p>If you experience a failure while booting, use the following procedure to fall
back to the original boot environment. In this example, the GRUB menu is
displayed correctly, but the new boot environment is not bootable. The device is
<tt>/dev/dsk/c0t4d0s0</tt>. The original boot environment, <tt>c0t4d0s0</tt>, becomes the active boot environment.</p>
<hr><p><b>Caution - </b><b>For the Solaris 10 3/05 release</b>, the recommended action to fall back if the previous boot environment and
new boot environment were on different disks included changing the hard disk boot order
in the BIOS. <b>Starting with the Solaris 10 1/06 release</b>, changing the BIOS disk order is unnecessary and
is strongly discouraged. Changing the BIOS disk order might invalidate the GRUB menu
and cause the boot environment to become unbootable. If the BIOS disk order
is changed, reverting the order back to the original settings restores system functionality.</p>
<hr>
<ol>
<li><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><a name="luupgrade-step-191"></a><b>To display the GRUB menu, reboot the system.</b><pre># <tt><b>init 6</b></tt></pre><p>The GRUB menu is displayed.</p><pre>GNU GRUB version 0.95 (616K lower / 4127168K upper memory)
+-------------------------------------------------------------------+
|Solaris                                                            |
|Solaris failsafe                                                   |
|second_disk                                                        |
|second_disk failsafe                                               |
+-------------------------------------------------------------------+
Use the ^ and v keys to select which entry is highlighted. Press
enter to boot the selected OS, 'e' to edit the commands before
booting, or 'c' for a command-line.</pre></li>
<li><b>From the GRUB menu, select the original boot environment. The boot environment must
have been created with GRUB software. A boot environment that was created before
the <b>Solaris 10 1/06 release</b> is not a GRUB boot environment. If you do not have
a bootable GRUB boot environment, then skip to this procedure, <a href="#gbdew">x86: To Fall Back From a Failed Boot Environment Activation With the GRUB Menu and the DVD or CD</a>.</b></li>
<li><a name="upgrade-step-1239"></a><b>Boot to single user mode by editing the Grub menu.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>To edit the GRUB main menu, type <tt><b>e</b></tt>. </b><p>The GRUB edit menu is displayed.</p><pre>root (hd0,2,a)
kernel$ /platform/i86pc/kernel/<i>$ISADIR</i>/unix
module$ /platform/i86pc/<i>$ISADIR</i>/boot_archive</pre>
<hr><p><b>Note - </b><b>Starting with the 5/07 Developer release,</b> GRUB has enhanced support for directly booting the <tt>unix</tt> kernel. The new keyword,
<tt>$ISADIR</tt>, resolves to <tt>amd64</tt> for 64-bit hardware and to null for 32-bit hardware.
See <a href="http://docs.sun.com/doc/819-2394/gazva?a=view">GRUB Menu Commands for Installation in <i>Solaris Express Installation Guide: Network-Based Installations</i></a>.</p>
<hr>
</li>
<li><b>Select the original boot environment's kernel entry by using the arrow keys. </b></li>
<li><b>To edit the boot entry, type <tt><b>e</b></tt>. </b><p>The kernel entry is displayed in the GRUB edit menu.</p><pre>grub edit>kernel$ /boot/platform/i86pc/kernel/unix</pre></li>
<li><b>Type <tt><b>-s</b></tt> and press Enter. </b><p>The following example notes the placement of the <tt>-s</tt> option.</p><pre>grub edit>kernel$ /boot/platform/i86pc/kernel/unix <tt><b>-s</b></tt></pre></li>
<li><b>To begin the booting process in single user mode, type b. </b></li></ol></li>
<li><a name="upgrade-step-238"></a><b>If necessary, check the integrity of the root (<tt>/</tt>) file system for the
fallback boot environment.</b><pre># <tt><b>fsck</b></tt> <i>mount_ point</i></pre><dl><dt><i>mount_point</i></dt>
<dd><p>A root (<tt>/</tt>) file system that is known and reliable</p></dd>
</dl>
</li>
<li><a name="upgrade-step-167"></a><b>Mount the original boot environment root slice to some directory (such as <tt>/mnt</tt>):
 </b><pre># <tt><b>mount</b></tt> <i>device_name</i> <tt><b>/mnt</b></tt></pre><dl><dt><i>device_name</i></dt>
<dd><p>Specifies the location of the root (<tt>/</tt>) file system on the disk device of the boot environment you want to fall back to. The device name is entered in the form of <tt>/dev/dsk/c</tt><i>w</i><tt>t</tt><i>x</i><tt>d</tt><i>y</i><tt>s</tt><i>z</i>.</p></dd>
</dl>
</li>
<li><a name="upgrade-step-209"></a><b>From the active boot environment root slice, type:</b><pre># <tt><b>/mnt/sbin/luactivate</b></tt></pre><p><tt>luactivate</tt> activates the previous working boot environment and indicates the result.</p></li>
<li><a name="upgrade-step-237"></a><b>Unmount <tt>/mnt</tt>.</b><pre># <tt><b>umount /mnt</b></tt></pre></li>
<li><a name="upgrade-step-211"></a><b>Reboot. </b><pre># <tt><b>init 6</b></tt></pre><p>The previous working boot environment becomes the active boot environment.</p></li></ol>

<a name="gbdew"></a><h4>x86: To Fall Back From a Failed Boot Environment Activation With the GRUB Menu and the DVD or CD</h4><p>If you experience a failure while booting, use the following procedure to fall
back to the original boot environment. In this example, the new boot environment
was not bootable. Also, the GRUB menu does not display. The device is
<tt>/dev/dsk/c0t4d0s0</tt>. The original boot environment, <tt>c0t4d0s0</tt>, becomes the active boot environment.</p>
<hr><p><b>Caution - </b><b>For the Solaris 10 3/05 release</b>, the recommended action to fall back if the previous boot environment and
new boot environment were on different disks included changing the hard disk boot order
in the BIOS. <b>Starting with the Solaris 10 1/06 release</b>, changing the BIOS disk order is unnecessary and
is strongly discouraged. Changing the BIOS disk order might invalidate the GRUB menu
and cause the boot environment to become unbootable. If the BIOS disk order
is changed, reverting the order back to the original settings restores system functionality.</p>
<hr>
<ol>
<li><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><a name="gbdez"></a><b>Insert the Solaris Operating System for x86 Platforms DVD or Solaris Software
for x86 Platforms - 1 CD.</b></li>
<li><b>Boot from the DVD or CD.</b><pre># <tt><b>init 6</b></tt></pre><p>The GRUB menu is displayed.</p>
<ul><li><p>For an installation with CD media:</p><pre>GNU GRUB version 0.95 (631K lower / 2095488K upper memory)
+-------------------------------------------------------------------+
|Solaris Express 5/07 <i>image_directory</i>                                 |
|Solaris Express 5/07 Serial Console tty                              |
|Solaris Express 5/07 Serial Console ttyb (for lx50, v60x and v65     |
+-------------------------------------------------------------------+
Use the ^ and v keys to select which entry is highlighted. Press
enter to boot the selected OS, 'e' to edit the commands before
booting, or 'c' for a command-line.</pre></li>
<li><p>For an installation with a DVD media:</p><pre>GNU GRUB version 0.95 (631K lower / 2095488K upper memory)
+-------------------------------------------------------------------+
|Solaris Express 5/07 Developer Edition <i>image_directory</i>              |
|Solaris Express 5/07                                                 |
|Solaris Express 5/07 Serial Console ttya                             |
|Solaris Express 5/07 Serial Console ttyb (for lx50, v60x and v65)    |
+-------------------------------------------------------------------+
Use the ^ and v keys to select which entry is highlighted. Press
enter to boot the selected OS, 'e' to edit the commands before
booting, or 'c' for a command-line.</pre></li></ul>
</li>
<li><b>Wait for the default option to boot or choose any option displayed.</b><p>The installation screen is displayed.</p>
<ul><li><p>For CD media you see the following screen.</p><pre>+-------------------------------------------------------------------+

|Select the type of installation you want to perform:                |
|                                                                    |
|         1 Solaris Interactive                                      |
|         2 Custom JumpStart                                         |
|         3 Solaris Interactive Text (Desktop session)               |
|         4 Solaris Interactive Text (Console session)               |
|         5 Apply driver updates                                     |
|         6 Single user shell                                        |
|                                                                    |
|        Enter the number of your choice followed by the &lt;ENTER> key.|
|        Alternatively, enter custom boot arguments directly.        |
|
|         If you wait 30 seconds without typing anything,            |
|         an interactive installation will be started.               |
+----------------------------------------------------------------- --+</pre></li>
<li><p>For DVD media, you see the following screen.</p></li></ul>
<pre>+--------------------------------------------------------------------+
|Select the type of installation you want to perform:                |
|                                                                    |
|        1 Solaris Interactive GUI                                   |
|        2 Apply driver updates                                      |
|        3 Single user shell                                         |
|Enter the number of your choice followed by the &lt;ENTER> key.        |
|Alternatively, enter custom boot arguments directly.                |
|                                                                    |
|    If you wait 30 seconds without typing anything,                 |
|     an interactive installation will be started.                   |
+--------------------------------------------------------------------+</pre></li>
<li><b>Choose the &ldquo;Single user shell&rdquo; option.</b><p>The following message is displayed.</p><pre>Do you wish to automatically update the boot archive? y /n</pre></li>
<li><b>Type: n</b><pre>Starting shell...
#</pre><p>You are now in single user mode.</p></li>
<li><a name="gbdem"></a><b>If necessary, check the integrity of the root (<tt>/</tt>) file system for
the fallback boot environment.</b><pre># <tt><b>fsck</b></tt> <i>mount_ point</i></pre><dl><dt><i>mount_point</i></dt>
<dd><p>A root (<tt>/</tt>) file system that is known and reliable</p></dd>
</dl>
</li>
<li><a name="gbdfk"></a><b>Mount the original boot environment root slice to some directory (such as <tt>/mnt</tt>):
 </b><pre># <tt><b>mount</b></tt> <i>device_name</i> <tt><b>/mnt</b></tt></pre><dl><dt><i>device_name</i></dt>
<dd><p>Specifies the location of the root (<tt>/</tt>) file system on the disk device of the boot environment you want to fall back to. The device name is entered in the form of <tt>/dev/dsk/c</tt><i>w</i><tt>t</tt><i>x</i><tt>d</tt><i>y</i><tt>s</tt><i>z</i>.</p></dd>
</dl>
</li>
<li><a name="gbdfd"></a><b>From the active boot environment root slice, type:</b><pre># <tt><b>/mnt/sbin/luactivate</b></tt>
Do you want to fallback to activate boot environment c0t4d0s0
(yes or no)? <tt><b>yes</b></tt></pre><p><tt>luactivate</tt> activates the previous working boot environment and indicates the result.</p></li>
<li><a name="gbden"></a><b>Unmount <tt>/mnt</tt>.</b><pre># <tt><b>umount</b></tt> <i>device_name</i></pre><dl><dt><i>device_name</i></dt>
<dd><p>Specifies the location of the root (<tt>/</tt>) file system on the disk device of the boot environment you want to fall back to. The device name is entered in the form of <tt>/dev/dsk/c</tt><i>w</i><tt>t</tt><i>x</i><tt>d</tt><i>y</i><tt>s</tt><i>z</i>.</p></dd>
</dl>
</li>
<li><a name="gbdfh"></a><b>Reboot. </b><pre># <tt><b>init 6</b></tt></pre><p>The previous working boot environment becomes the active boot environment.</p></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="gampw.html">Previous</a>
             </td>
             <td align="right">
                 <a href="lumaintainence-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

