<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Example of Upgrading With Solaris Live Upgrade - Solaris Express Installation Guide:  Solaris Live Upgrade and Upgrade Planning</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-05-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">Solaris Express Installation Guide:  Solaris Live Upgrade and Upgrade Planning</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="luexample-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="luexample-90.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="esqbt.html">Part&nbsp;I&nbsp;Upgrading With Solaris Live Upgrade</a></p>
<p class="toc level2"><a href="intro-1.html">1.&nbsp;&nbsp;Where to Find Solaris Installation Planning Information</a></p>
<p class="toc level2"><a href="luoverview-1.html">2.&nbsp;&nbsp;Solaris Live Upgrade (Overview)</a></p>
<p class="toc level2"><a href="luplanning-1.html">3.&nbsp;&nbsp;Solaris Live Upgrade (Planning)</a></p>
<p class="toc level2"><a href="lucreate-1.html">4.&nbsp;&nbsp;Using Solaris Live Upgrade to Create a Boot Environment (Tasks)</a></p>
<p class="toc level2"><a href="liveupgrade-1.html">5.&nbsp;&nbsp;Upgrading With Solaris Live Upgrade (Tasks)</a></p>
<p class="toc level2"><a href="luupgrade-85.html">6.&nbsp;&nbsp;Failure Recovery: Falling Back to the Original Boot Environment (Tasks)</a></p>
<p class="toc level2"><a href="lumaintainence-1.html">7.&nbsp;&nbsp;Maintaining Solaris Live Upgrade Boot Environments (Tasks)</a></p>
<p class="toc level2"><a href="grub-101.html">8.&nbsp;&nbsp;x86: Locating the GRUB Menu's <tt>menu.lst</tt> File (Tasks)</a></p>
<p class="toc level2"><a href="gdzlc.html">9.&nbsp;&nbsp;Upgrading the Solaris OS on a System With Non-Global  Zones Installed</a></p>
<p class="toc level2"><a href="luexample-1.html">10.&nbsp;&nbsp;Solaris Live Upgrade (Examples)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Example of Upgrading With Solaris Live Upgrade</a></p>
</div>
<p class="toc level3"><a href="luexample-90.html">Example of Detaching and Upgrading One Side of a RAID-1 Volume (Mirror)</a></p>
<p class="toc level3"><a href="luexample-51.html">Example of Migrating From an Existing Volume to a Solaris Volume Manager RAID-1 Volume</a></p>
<p class="toc level3"><a href="luexample-28.html">Example of Creating an Empty Boot Environment and Installing a Solaris Flash Archive</a></p>
<p class="toc level2 tocsp"><a href="lureference-1.html">11.&nbsp;&nbsp;Solaris Live Upgrade (Command Reference)</a></p>
<p class="toc level1 tocsp"><a href="esqcb.html">Part&nbsp;II&nbsp;Appendices</a></p>
<p class="toc level2"><a href="troubleshooting-9.html">A.&nbsp;&nbsp;Troubleshooting (Tasks)</a></p>
<p class="toc level2"><a href="package-9.html">B.&nbsp;&nbsp;Additional SVR4 Packaging Requirements (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="luexample-100"></a><h3>Example of Upgrading With Solaris Live Upgrade</h3>
<p><a name="indexterm-114"></a><a name="indexterm-115"></a>In this example, a new boot environment is created by using the <tt>lucreate</tt>
command on a system that is running the Solaris 9 release. The new
boot environment is upgraded to the Solaris Express 5/07 release by using the
<tt>luupgrade</tt> command. The upgraded boot environment is activated by using the <tt>luactivate</tt> command. An
example of falling back to the original boot environment is also given.</p>

<a name="luexample-3"></a><h4>To Install Solaris Live Upgrade on the Active Boot Environment</h4>

<hr><p><b>Note - </b>This procedure assumes that the system is running removable media services. If you
have questions about removable media services that manage discs, refer to <a href="http://docs.sun.com/doc/819-2723"><i>System Administration Guide: Devices and File Systems</i></a> for detailed
information.</p>
<hr>

<ol><li><p>Insert the Solaris Operating System DVD or Solaris Software - 2 CD. </p></li>
<li><p>Follow the step for the media you are using.</p>
<ul><li><p>If you are using the Solaris Operating System DVD, change the directory to the installer and run the installer.</p>
<ul><li><p><b>For SPARC based systems</b>:</p><pre># <tt><b>cd /media/cdroms0/Solaris_11/Tools/Installers</b></tt>
# <tt><b>./liveupgrade20</b></tt></pre></li>
<li><p><b>For x86 based systems</b>:</p><pre># <tt><b>cd /media/cdrom/Solaris_11/Tools/Installers</b></tt>
# <tt><b>./liveupgrade20</b></tt></pre></li></ul>
<p>The Solaris installation program GUI is displayed.</p></li>
<li><p>If you are using the Solaris Software - 2 CD, run the installer. </p><pre>% <tt><b>./installer</b></tt></pre><p>The Solaris installation program GUI is displayed.</p></li></ul>
</li>
<li><p>From the Select Type of Install panel, click Custom.</p></li>
<li><p>On the Locale Selection panel, click the language to be installed.</p></li>
<li><p>Choose the software to install.</p>
<ul><li><p>For DVD, on the Component Selection panel, click Next to install the packages.</p></li>
<li><p>For CD, on the Product Selection panel, click Default Install for Solaris Live Upgrade and click the other product choices to deselect this software.</p></li></ul>
</li>
<li><p>Follow the directions on the Solaris installation program panels to install the software.</p></li></ol>


<a name="luexample-2"></a><h4>To Create a Boot Environment</h4>
<p>The source boot environment is named <tt>c0t4d0s0</tt> by using the <tt>-c</tt> option. Naming
the source boot environment is  required only when the first boot environment
is created. For more information about naming using the <tt>-c</tt> option, see the
description in &ldquo;To Create a Boot Environment for the First Time&rdquo; <a href="chapter-33.html#lucreate-step-2200">Step&nbsp;2</a>.</p><p>The new boot environment is named <tt>c0t15d0s0</tt>. The <tt>-A</tt> option creates a
description that is associated with the boot environment name. </p><p>The root (<tt>/</tt>) file system is copied to the new boot environment. Also,
a new swap slice is created rather than sharing the source boot environment's
swap slice.</p><pre># <tt><b>lucreate -A 'BE_description' -c /dev/dsk/c0t4d0s0 -m /:/dev/dsk/c0t15d0s0:ufs</b></tt>\
<tt><b>-m -:/dev/dsk/c0t15d0s1:swap -n /dev/dsk/c0t15d0s0</b></tt></pre>

<a name="luexample-4"></a><h4>To Upgrade the Inactive Boot Environment</h4>
<p>The inactive boot environment is named <tt>c0t15d0s0</tt>. The operating system image to be
used for the upgrade is taken from the network.</p><pre># <tt><b>luupgrade -n c0t15d0s0 -u -s /net/ins-svr/export/Solaris_11 \ combined.solaris_wos</b></tt></pre>

<a name="luexample-7"></a><h4>To Check if Boot Environment Is Bootable</h4>
<p>The <tt>lustatus</tt> command reports if the boot environment creation is complete. <tt>lustatus</tt> also
shows if the boot environment is bootable.</p><pre># <tt><b>lustatus</b></tt>
boot environment   Is        Active  Active     Can        Copy
Name               Complete  Now     OnReboot   Delete     Status
------------------------------------------------------------------------
c0t4d0s0           yes       yes      yes      no      -
c0t15d0s0          yes       no       no       yes     -</pre>

<a name="luexample-5"></a><h4>To Activate the Inactive Boot Environment</h4>
<p>The <tt>c0t15d0s0</tt> boot environment is made bootable with the <tt>luactivate</tt> command. The system
is then rebooted and <tt>c0t15d0s0</tt> becomes the active boot environment. The <tt>c0t4d0s0</tt>
boot environment is now inactive.</p><pre># <tt><b>luactivate c0t15d0s0</b></tt>
# <tt><b>init 6</b></tt></pre>

<a name="luexample-6"></a><h4>(Optional) To Fall Back to the Source Boot Environment</h4>
<p>The following procedures for falling back depend on your new boot environment activation
situation:</p>
<ul><li><p>For SPARC based systems:</p>
<ul><li><p>The activation is successful, but you want to return to the original boot environment. See <a href="#luexample-15">Example&nbsp;10-1</a>.</p></li>
<li><p>The activation fails and you can boot back to the original boot environment. See <a href="#luexample-16">Example&nbsp;10-2</a>.</p></li>
<li><p>The activation fails and you must boot back to the original boot environment by using media or a net installation image. See <a href="#luexample-17">Example&nbsp;10-3</a>.</p></li></ul>
</li>
<li><p>For x86 based systems, <b>starting with the Solaris 10 1/06 release</b> and when you use the GRUB menu:</p>
<ul><li><p>The activation fails, the GRUB menu is displayed correctly, but the new boot environment is not bootable. See <a href="#gbdcm">Example&nbsp;10-4</a></p></li>
<li><p>The activation fails and the GRUB menu does not display. See <a href="#gaemf">Example&nbsp;10-5</a>.</p></li></ul>
</li></ul>
<a name="luexample-15"></a>Example&nbsp;10-1 SPARC: To Fall Back Despite Successful Boot Environment Creation<p>In this example, the original <tt>c0t4d0s0</tt> boot environment is reinstated as the active
boot environment although it was activated successfully. The device name is <tt>first_disk</tt>.</p><pre># <tt><b>/sbin/luactivate first_disk</b></tt> 
# <tt><b>init 6</b></tt></pre><a name="luexample-16"></a>Example&nbsp;10-2 SPARC: To Fall Back From a Failed Boot Environment Activation<p>In this example, the new boot environment was not bootable. You must return
to the OK prompt before booting from the original boot environment, <tt>c0t4d0s0</tt>,
in single-user mode. </p><pre>OK <tt><b>boot net -s</b></tt>
# <tt><b>/sbin/luactivate first_disk</b></tt>
Do you want to fallback to activate boot environment c0t4d0s0 
(yes or no)? <tt><b>yes</b></tt>
# <tt><b>init 6</b></tt></pre><p>The original boot environment, <tt>c0t4d0s0</tt>, becomes the active boot environment.</p><a name="luexample-17"></a>Example&nbsp;10-3 SPARC: To Fall Back to the Original Boot Environment by Using a DVD, CD, or Net Installation Image<p>In this example, the new boot environment was not bootable. You cannot boot
from the original boot environment and must use media or a net
installation image. The device is <tt>/dev/dsk/c0t4d0s0</tt>. The original boot environment, <tt>c0t4d0s0</tt>, becomes the active
boot environment.</p><pre>OK <tt><b>boot net -s</b></tt>
# <tt><b>fsck /dev/dsk/c0t4d0s0</b></tt>
# <tt><b>mount /dev/dsk/c0t4d0s0 /mnt</b></tt> 
# <tt><b>/mnt/sbin/luactivate</b></tt>
Do you want to fallback to activate boot environment c0t4d0s0 
(yes or no)? <tt><b>yes</b></tt>
# <tt><b>umount /mnt</b></tt> 
# <tt><b>init 6</b></tt></pre><a name="gbdcm"></a>Example&nbsp;10-4 x86: To Fall Back to the Original Boot Environment By Using the GRUB Menu<p><b>Starting with the Solaris 10 1/06 release</b>, the following example provides the steps to fall back by using the
GRUB menu.</p><p>In this example, the GRUB menu is displayed correctly, but the new
boot environment is not bootable. To enable a fallback, the original boot environment is
booted in single-user mode. </p>
<ol><li><p>Become superuser or assume an equivalent role.</p></li>
<li><p>To display the GRUB menu, reboot the system.</p><pre># <tt><b>init 6</b></tt></pre><p>The GRUB menu is displayed.</p><pre>GNU GRUB version 0.95 (616K lower / 4127168K upper memory)
+-------------------------------------------------------------------+
|Solaris                                                            |
|Solaris failsafe                                                   |
|second_disk                                                        |
|second_disk failsafe                                               |
+-------------------------------------------------------------------+
Use the ^ and v keys to select which entry is highlighted. Press
enter to boot the selected OS, 'e' to edit the commands before
booting, or 'c' for a command-line.</pre></li>
<li><p>From the GRUB menu, select the original boot environment. The boot environment must have been created with GRUB software. A boot environment that was created before the <b>Solaris 10 1/06 release</b> is not a GRUB boot environment. If you do not have a bootable GRUB boot environment, then skip to <a href="#gaemf">Example&nbsp;10-5</a>.</p></li>
<li><p>Edit the GRUB menu by typing: <tt><b>e</b></tt>.</p></li>
<li><p>Select <tt>kernel /boot/platform/i86pc/kernel/unix</tt> by using the arrow keys and type <b>e</b>. The grub edit menu is displayed.</p><pre>grub edit>kernel$ /boot/platform/i86pc/kernel/unix</pre></li>
<li><p>Boot to single user mode, by typing <tt><b>-s</b></tt>.</p><pre>grub edit>kernel$ /boot/platform/i86pc/kernel/unix <tt><b>-s</b></tt></pre></li>
<li><p>Boot and mount the boot environment. Then activate it.</p></li></ol>
<pre># <tt><b>b</b></tt>
# <tt><b>fsck /dev/dsk/c0t4d0s0</b></tt>
# <tt><b>mount /dev/dsk/c0t4d0s0 /mnt</b></tt> 
# <tt><b>/mnt/sbin/luactivate</b></tt>
Do you want to fallback to activate boot environment c0t4d0s0
(yes or no)? <tt><b>yes</b></tt>
# <tt><b>umount /mnt</b></tt>
# <tt><b>init 6</b></tt></pre><a name="gaemf"></a>Example&nbsp;10-5 x86: To Fall Back to the Original Boot Environment With the GRUB Menu by Using the DVD or CD<p><b>Starting with the Solaris 10 1/06 release</b>, the following example provides the steps to fall back by using the
DVD or CD.</p><p>In this example, the new boot environment was not bootable. Also, the GRUB
menu does not display. To enable a fallback, the original boot environment is
booted in single-user mode.</p>
<ol><li><p>Insert the Solaris Operating System for x86 Platforms DVD or Solaris Software for x86 Platforms - 1 CD.</p></li>
<li><p>Become superuser or assume an equivalent role.</p></li>
<li><p>Boot from the DVD or CD.</p><pre># <tt><b>init 6</b></tt></pre><p>The GRUB menu is displayed.</p>
<ul><li><p>For an installation with CD media:</p><pre>GNU GRUB version 0.95 (631K lower / 2095488K upper memory)
+-------------------------------------------------------------------+
|Solaris Express 5/07 <i>image_directory</i>                                      |
|Solaris Express 5/07 Serial Console tty                                 |
|Solaris Express 5/07 Serial Console ttyb (for lx50, v60x and v65)       |
+-------------------------------------------------------------------+
Use the ^ and v keys to select which entry is highlighted. Press
enter to boot the selected OS, 'e' to edit the commands before
booting, or 'c' for a command-line.</pre></li>
<li><p>For an installation with a DVD media:</p><pre>GNU GRUB version 0.95 (631K lower / 2095488K upper memory)
+-------------------------------------------------------------------+
|Solaris Express 5/07 Developer Edition <i>image_directory</i>                    |
|Solaris Express 5/07                                                    |
|Solaris Express 5/07 Serial Console ttya                                |
|Solaris Express 5/07 Serial Console ttyb (for lx50, v60x and v65)       |
+-------------------------------------------------------------------+
Use the ^ and v keys to select which entry is highlighted. Press
enter to boot the selected OS, 'e' to edit the commands before
booting, or 'c' for a command-line.</pre></li></ul>
</li>
<li><p>Wait for the default option to boot or choose any option displayed.</p><p>The installation screen is displayed.</p>
<ul><li><p>For CD media you see the following screen.</p><pre>+-------------------------------------------------------------------+

|Select the type of installation you want to perform:                |
|                                                                    |
|         1 Solaris Interactive                                      |
|         2 Custom JumpStart                                         |
|         3 Solaris Interactive Text (Desktop session)               |
|         4 Solaris Interactive Text (Console session)               |
|         5 Apply driver updates                                     |
|         6 Single user shell                                        |
|                                                                    |
|        Enter the number of your choice followed by the &lt;ENTER> key.|
|        Alternatively, enter custom boot arguments directly.        |
|
|         If you wait 30 seconds without typing anything,            |
|         an interactive installation will be started.               |
+----------------------------------------------------------------- --+</pre></li>
<li><p>For DVD media, you see the following screen.</p></li></ul>
<pre>+--------------------------------------------------------------------+
|Select the type of installation you want to perform:                |
|                                                                    |
|        1 Solaris Interactive GUI                                   |
|        2 Apply driver updates                                      |
|        3 Single user shell                                         |
|Enter the number of your choice followed by the &lt;ENTER> key.        |
|Alternatively, enter custom boot arguments directly.                |
|                                                                    |
|    If you wait 30 seconds without typing anything,                 |
|     an interactive installation will be started.                   |
+--------------------------------------------------------------------+</pre></li>
<li><p>Choose the &ldquo;Single user shell&rdquo; option.</p><p>The following message is displayed.</p><pre>Do you wish to automatically update the boot archive? y /n</pre></li>
<li><p>Type: n</p><pre>Starting shell...
#</pre><p>You are now in single user mode.</p></li>
<li><p>Mount the boot environment. Then activate and reboot.</p><pre># <tt><b>fsck /dev/dsk/c0t4d0s0</b></tt>
# <tt><b>mount /dev/dsk/c0t4d0s0 /mnt</b></tt> 
# <tt><b>/mnt/sbin/luactivate</b></tt>
Do you want to fallback to activate boot environment c0t4d0s0
(yes or no)? <tt><b>yes</b></tt>
# <tt><b>umount /mnt</b></tt>
# <tt><b>init 6</b></tt></pre></li></ol>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="luexample-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="luexample-90.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

