<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Creating Installation Scripts - Application Packaging Developer's Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-09-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">Application Packaging Developer's Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ch3enhancepkg-31830.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ch6advtech-108.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-10.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="ch1designpkg-51728.html">1.&nbsp;&nbsp;Designing  a Package</a></p>
<p class="toc level1 tocsp"><a href="ch2buildpkg-22939.html">2.&nbsp;&nbsp;Building a Package</a></p>
<p class="toc level1 tocsp"><a href="ch3enhancepkg-11350.html">3.&nbsp;&nbsp;Enhancing the Functionality of a Package (Tasks)</a></p>
<p class="toc level2"><a href="ch3enhancepkg-1.html">Creating Information Files and Installation Scripts (Task Map)</a></p>
<p class="toc level2"><a href="ch3enhancepkg-31830.html">Creating Information Files</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Creating Installation Scripts</a></p>
</div>
<p class="toc level2"><a href="ch6advtech-108.html">Creating Signed Packages</a></p>
<p class="toc level1 tocsp"><a href="ch4verifypkg-18395.html">4.&nbsp;&nbsp;Verifying and Transferring a Package</a></p>
<p class="toc level1 tocsp"><a href="ch5pkgcasestudies-80583.html">5.&nbsp;&nbsp;Case Studies of Package Creation</a></p>
<p class="toc level1 tocsp"><a href="ch6advtech-96543.html">6.&nbsp;&nbsp;Advanced Techniques for Creating Packages</a></p>
<p class="toc level1 tocsp"><a href="gloss-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="ch3enhancepkg-10289"></a><h3>Creating Installation Scripts</h3>
<p><a name="ch3enhancepkg-ix25"></a><a name="indexterm-103"></a><a name="indexterm-104"></a>This section discusses optional package installation scripts. The <tt>pkgadd</tt> command automatically performs all the
actions necessary to install a package using the package information files as input.
You do <b>not</b> have to supply any package installation scripts. However, if you
want to create customized installation procedures for your package, you can do so
with installation scripts. Installation scripts: </p>
<ul><li><p>Must be executable by the Bourne shell (<tt>sh</tt>)</p></li>
<li><p>Must contain Bourne shell commands and text</p></li>
<li><p>Do not need to contain the <tt>#!/bin/sh</tt> shell identifier</p></li>
<li><p>Need not be an executable file</p></li></ul>
<p>There are four types of installation scripts with which you can perform customized
actions:</p>
<ul><li><p><a name="ch3enhancepkg-ix26"></a><a name="ch3enhancepkg-ix27"></a><a name="indexterm-105"></a>The <tt>request</tt> script </p><p>The <tt>request</tt> script solicits data from the administrator who is installing a package for assigning or redefining environment variables.</p></li>
<li><p><a name="indexterm-106"></a>The <tt>checkinstall</tt> script</p><p>The <tt>checkinstall</tt> script examines the target system for needed data, can set or modify package environment variables, and determines whether the installation proceeds. </p>
<hr><p><b>Note - </b>The <tt>checkinstall</tt> script is available starting with the Solaris 2.5 and compatible releases.</p>
<hr>
</li>
<li><p><a name="ch3enhancepkg-ix28"></a>Procedure scripts </p><p><a name="indexterm-107"></a>Procedure scripts identify a procedure to be invoked before or after the installation or removal of a package. The four procedure scripts are <tt>preinstall</tt>, <tt>postinstall</tt>, <tt>preremove</tt>, and <tt>postremove</tt>.</p></li>
<li><p><a name="ch3enhancepkg-ix30"></a>Class action scripts </p><p><a name="indexterm-108"></a>Class action scripts define an action or set of actions that should be applied to a class of files during installation or removal. You can define your own classes. Alternatively, you can use one of the four standard classes (<tt>sed</tt>, <tt>awk</tt>, <tt>build</tt>, and <tt>preserve</tt>). </p></li></ul>


<a name="ch3enhancepkg-20"></a><h4>Script Processing During Package Installation</h4>
<p><a name="indexterm-109"></a><a name="ch3enhancepkg-ix32"></a>The type of scripts you use depends on when the action of
the script is needed during the installation process. As a package is installed, the
<tt>pkgadd</tt> command performs the following steps:</p>
<ol><li><p>Executes the <tt>request</tt> script</p><p><a name="indexterm-110"></a>This step is the only point at which your package can solicit input from the administrator who is installing the package. </p></li>
<li><p>Executes the <tt>checkinstall</tt> script</p><p><a name="indexterm-111"></a>The <tt>checkinstall</tt> script gathers file system data and can create or alter environment variable definitions to control the subsequent installation. For more information on package environment variables, see <a href="ch2buildpkg-13952.html">Package Environment Variables</a>.</p></li>
<li><p><a name="indexterm-112"></a>Executes the <tt>preinstall</tt> script</p></li>
<li><p>Installs package objects, for each class to be installed</p><p><a name="indexterm-113"></a>Installation of these files occurs class by class, and class action scripts are executed accordingly. The list of classes operated on and the order in which they should be installed is initially defined with the <tt>CLASSES</tt> parameter in your <tt>pkginfo</tt> file. However, your <tt>request</tt> script or <tt>checkinstall</tt> script can change the value of the <tt>CLASSES</tt> parameter. For more information on how classes are processed during installation, see <a href="#ch3enhancepkg-34">How Classes Are Processed During Package Installation</a>.</p>
<ol><li><p>Creates symbolic links, devices, named pipes, and required directories</p></li>
<li><p>Installs the regular files (file types <tt>e</tt>, <tt>v</tt>, <tt>f</tt>), based on their class</p><p><a name="indexterm-114"></a>The class action script is passed only regular files to install. All other package objects are created automatically from information in the <tt>pkgmap</tt> file.</p></li>
<li><p>Creates all hard links</p></li></ol>
</li>
<li><p><a name="indexterm-115"></a>Executes the <tt>postinstall</tt> script</p></li></ol>


<a name="ch3enhancepkg-21"></a><h4>Script Processing During Package Removal</h4>
<p><a name="indexterm-116"></a>When a package is being removed, the <tt>pkgrm</tt> command performs these steps: </p>
<ol><li><p><a name="indexterm-117"></a>Executes the <tt>preremove</tt> script</p></li>
<li><p>Removes the package objects, for each class</p><p><a name="indexterm-118"></a><a name="indexterm-119"></a>Removal also occurs class by class. Removal scripts are processed in the reverse order of installation, based on the sequence defined in the <tt>CLASSES</tt> parameter. For more information on how classes are processed during installation, see <a href="#ch3enhancepkg-34">How Classes Are Processed During Package Installation</a>.</p>
<ol><li><p>Removes hard links</p></li>
<li><p>Removes regular files</p></li>
<li><p>Removes symbolic links, devices, and named pipes</p></li></ol>
</li>
<li><p><a name="indexterm-120"></a>Executes the <tt>postremove</tt> script </p></li></ol>
<p><a name="indexterm-121"></a>The <tt>request</tt> script is not processed at the time of package removal. However,
the script's output is retained in the installed package and made available to
removal scripts. The <tt>request</tt> script's output is a list of environment variables.</p>

<a name="ch3enhancepkg-22"></a><h4>Package Environment Variables Available to Scripts</h4>
<p><a name="indexterm-122"></a><a name="indexterm-123"></a><a name="indexterm-124"></a><a name="indexterm-125"></a><a name="ch3enhancepkg-ix34"></a><a name="ch3enhancepkg-ix35"></a>The following groups of environment variables are available to all installation scripts. Some of
the environment variables can be modified by a <tt>request</tt> script or a <tt>checkinstall</tt>
script. </p>
<ul><li><p>The <tt>request</tt> script or the <tt>checkinstall</tt> script can set or modify any of the standard parameters in the <tt>pkginfo</tt> file, except for the required parameters. The standard installation parameters are described in detail in the <a href="http://docs.sun.com/doc/816-5174/pkginfo-4?a=view"><tt>pkginfo</tt>(4)</a> man page.</p>
<hr><p><b>Note - </b>The <tt>BASEDIR</tt> parameter can only be modified starting with the Solaris 2.5 release and compatible releases.</p>
<hr>
</li>
<li><p>You can define your own installation environment variables by assigning values to them in the <tt>pkginfo</tt> file. Such environment variables must be alphanumeric with initial capital letters. Any of these environment variables can be changed by a <tt>request</tt> script or a <tt>checkinstall</tt> script.</p></li>
<li><p>Both a <tt>request</tt> script and a <tt>checkinstall</tt> script can define new environment variables by assigning values to them and putting them in the installation environment. </p></li>
<li><p>The following table lists environment variables that are available to all installation scripts through the environment. None of these environment variables can be modified by a script. </p><table><col width="29%"><col width="70%"><tr><th align="left" valign="top" scope="column"><p>Environment Variable</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>CLIENT_BASEDIR</tt> </p></td>
<td align="left" valign="top" scope="row"><p>The base directory with respect to the target system. While <tt>BASEDIR</tt> is the variable to use if you are referring to a specific package object from the install system (most likely a server), <tt>CLIENT_BASEDIR</tt> is the path to include in files placed on the client system. <tt>CLIENT_BASEDIR</tt> exists if <tt>BASEDIR</tt> exists and is identical to <tt>BASEDIR</tt> if there is no <tt>PKG_INSTALL_ROOT</tt>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>INST_DATADIR</tt> </p></td>
<td align="left" valign="top" scope="row"><p>The directory where the package now being read is located. If the package is being read from a tape, this variable will be the location of a temporary directory where the package has been transferred into directory format. In other words, assuming there is no extension to the package name (for example, <tt>SUNWstuff.d</tt>), the <tt>request</tt> script for the current package would be found at <tt>$INST_DATADIR/$PKG/install</tt>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>PATH</tt> </p></td>
<td align="left" valign="top" scope="row"><p>The search list used by <tt>sh</tt> to find commands on script invocation. <tt>PATH</tt> is usually set to <tt>/sbin:/usr/sbin:/usr/bin:/usr/sadm/install/bin</tt>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>PKGINST</tt></p></td>
<td align="left" valign="top" scope="row"><p>The instance identifier of the package being installed. If another instance of the package is not already installed, the value is the package abbreviation (for example, <tt>SUNWcadap</tt>). Otherwise, the value is the package abbreviation followed by a suffix, such as <tt>SUNWcadap.4</tt>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>PKGSAV</tt></p></td>
<td align="left" valign="top" scope="row"><p>The directory where files can be saved for use by removal scripts or where previously saved files can be found. Available only in the Solaris 2.5 release and compatible releases.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>PKG_CLIENT_OS</tt></p></td>
<td align="left" valign="top" scope="row"><p>The operating system of the client where the package is being installed. The value of this variable is <tt>Solaris</tt>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>PKG_CLIENT_VERSION</tt></p></td>
<td align="left" valign="top" scope="row"><p>The Solaris version in <tt>x.y</tt> format.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>PKG_CLIENT_REVISION</tt></p></td>
<td align="left" valign="top" scope="row"><p>The Solaris build revision.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>PKG_INSTALL_ROOT</tt></p></td>
<td align="left" valign="top" scope="row"><p>The root file system on the target system where the package is being installed. This variable exists only if the <tt>pkgadd</tt> and <tt>pkgrm</tt> commands were invoked with the <tt>-R</tt> option. This conditional existence facilitates its use in procedure scripts in the form <tt>${PKG_INSTALL_ROOT}/</tt><i>somepath</i>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>PKG_NO_UNIFIED</tt></p></td>
<td align="left" valign="top" scope="row"><p>An environment variable that gets set if the <tt>pkgadd</tt> and <tt>pkgrm</tt> commands were invoked with the <tt>-M</tt> and <tt>-R</tt> options. This environment variable is passed to any package installation script or package command that is part of the package environment.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>UPDATE</tt></p></td>
<td align="left" valign="top" scope="row"><p>This environment variable does not exist under most installation environments. If this variable does exist (with the value <tt>yes</tt>), it means one of two things. Either a package with the same name, version, and architecture is already installed on the system. Or this package is overwriting an installed package of the same name at the direction of the administrator. In these events, the original base directory is always used.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"></td>
</tr>
</table></li></ul>


<a name="ch3enhancepkg-23"></a><h4>Obtaining Package Information for a Script</h4>
<p><a name="indexterm-126"></a>Two commands can be used from scripts to solicit information about a package:
</p>
<ul><li><p><a name="indexterm-127"></a>The <tt>pkginfo</tt> command returns information about software packages, such as the instance identifier and package name. </p></li>
<li><p><a name="ch3enhancepkg-ix37"></a>The <tt>pkgparam</tt> command returns values for requested environment variables. </p><p>See the <a href="http://docs.sun.com/doc/816-5165/pkginfo-1?a=view"><tt>pkginfo</tt>(1)</a> man page, the <a href="http://docs.sun.com/doc/816-5165/pkgparam-1?a=view"><tt>pkgparam</tt>(1)</a> man page, and <a href="ch4verifypkg-18395.html">Chapter&nbsp;4, Verifying and Transferring a Package</a> for more information. </p></li></ul>


<a name="ch3enhancepkg-24"></a><h4>Exit Codes for Scripts</h4>
<p><a name="ch3enhancepkg-ix38"></a><a name="indexterm-128"></a>Each script must exit with one of the exit codes shown in the
following table.</p><a name="ch3enhancepkg-54572"></a><h6>Table&nbsp;3-2 Installation Script Exit Codes</h6><table><col width="11%"><col width="88%"><tr><th align="left" valign="top" scope="column"><p>Code</p></th>
<th align="left" valign="top" scope="column"><p>Meaning</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>0</p></td>
<td align="left" valign="top" scope="row"><p>Successful completion of script. </p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>1</p></td>
<td align="left" valign="top" scope="row"><p>Fatal error. Installation process is terminated at
this point. </p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>2 </p></td>
<td align="left" valign="top" scope="row"><p>Warning or possible error condition. Installation continues. A warning message
is displayed at the time of completion. </p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>3 </p></td>
<td align="left" valign="top" scope="row"><p>The <tt>pkgadd</tt> command is
cleanly halted. Only the <tt>checkinstall</tt> script returns this code.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>10 </p></td>
<td align="left" valign="top" scope="row"><p>System should be
rebooted when installation of all selected packages is completed. (This value should be
added to one of the single-digit exit codes.) </p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>20 </p></td>
<td align="left" valign="top" scope="row"><p>System should be rebooted
immediately upon completing installation of the current package. (This value should be added
to one of the single-digit exit codes.) </p></td>
</tr>
</table><p>See <a href="ch5pkgcasestudies-80583.html">Chapter&nbsp;5, Case Studies of Package Creation</a> for examples of exit codes that are returned by installation scripts.</p>
<hr><p><b>Note - </b>All installation scripts delivered with your package should have an entry in the
<tt>prototype</tt> file. The file type should be <tt>i</tt> (for package installation script). </p>
<hr>


<a name="ch3enhancepkg-21209"></a><h4>Writing a <tt>request</tt> Script</h4>
<p><a name="indexterm-129"></a>The <tt>request</tt> script is the only way your package can interact directly with
the administrator who is installing it. This script can be used, for example,
to ask the administrator if optional pieces of a package should be installed.</p><p>The output of a <tt>request</tt> script must be a list of environment variables
and their values. This list can include any of the parameters that you
created in the <tt>pkginfo</tt> file, and the <tt>CLASSES</tt> and <tt>BASEDIR</tt> parameters. The
list can also introduce environment variables that have not been defined elsewhere. However,
the <tt>pkginfo</tt> file should always provide default values when practical. For more information
on package environment variables, see <a href="ch2buildpkg-13952.html">Package Environment Variables</a>.</p><p><a name="indexterm-130"></a>When your <tt>request</tt> script assigns values to an environment variable, it must then
make those values available to the <tt>pkgadd</tt> command and other package scripts. </p>

<a name="ch3enhancepkg-45"></a><h5><tt>request</tt> Script Behaviors</h5>

<ul><li><p><a name="indexterm-131"></a>The <tt>request</tt> script cannot modify any files. This script only interacts with administrators who are installing the package and creates a list of environment variable assignments based upon that interaction. The <tt>request</tt> script runs as the non privileged user <tt>install</tt> if that user exists. Otherwise, the script is executed as <tt>root</tt>.</p></li>
<li><p>The <tt>pkgadd</tt> command calls the <tt>request</tt> script with one argument that names the script's response file. The response file stores the administrator's responses.</p></li>
<li><p>The <tt>request</tt> script is not executed during package removal. However, the environment variables assigned by the script are saved and are available during package removal.</p></li></ul>


<a name="ch3enhancepkg-25"></a><h5>Design Rules for <tt>request</tt> Scripts</h5>

<ul><li><p><a name="ch3enhancepkg-ix39"></a>There can be only one <tt>request</tt> script per package. The script must be named <tt>request</tt>. </p></li>
<li><p>The environment variable assignments should be added to the installation environment for use by the <tt>pkgadd</tt> command and other packaging scripts by writing them to the response file (known to the script as <tt>$1</tt>).</p></li>
<li><p>System environment variables and standard installation environment variables, except for the <tt>CLASSES</tt> and <tt>BASEDIR</tt> parameters, cannot be modified by a <tt>request</tt> script. Any of the other environment variables that you created can be changed. </p>
<hr><p><b>Note - </b>A <tt>request</tt> script can only modify the <tt>BASEDIR</tt> parameter starting with the Solaris 2.5 and compatible releases.</p>
<hr>
</li>
<li><p>Every environment variable that the <tt>request</tt> script may manipulate should be assigned a default value in the <tt>pkginfo</tt> file.</p></li>
<li><p>The format of the output list should be <i>PARAM=value</i>. For example: </p><pre>CLASSES=none class1</pre></li>
<li><p>The administrator's terminal is defined as standard input to the <tt>request</tt> script. </p></li>
<li><p>Do not perform any special analysis of the target system in a <tt>request</tt> script. It is risky to test the system for the presence of certain binaries or behaviors, and to set environment variables based upon that analysis. There is no guarantee that the <tt>request</tt> script will actually be executed at install time. The administrator who is installing the package may provide a response file that will insert the environment variables without ever calling the <tt>request</tt> script. If the <tt>request</tt> script is also evaluating the target file system, that evaluation may not happen. An analysis of the target system for special treatment is best left to the <tt>checkinstall</tt> script.</p></li></ul>

<hr><p><b>Note - </b><a name="indexterm-132"></a><a name="indexterm-133"></a>If the administrators who will be installing your package might use the JumpStart<sup>TM</sup>
product, then the installation of your package must not be interactive. Either you
should not provide a <tt>request</tt> script with your package, or you need
to communicate to the administrators that they should use the <tt>pkgask</tt> command prior
to installation. The <tt>pkgask</tt> command stores their responses to the <tt>request</tt> script. For
more information on the <tt>pkgask</tt> command, see the <a href="http://docs.sun.com/doc/816-5166/pkgask-1m?a=view"><tt>pkgask</tt>(1M)</a> man page.</p>
<hr>


<a name="ch3enhancepkg-119"></a><h4>How to Write a <tt>request</tt> Script</h4><ol>
<li><a name="ch3enhancepkg-step-49"></a><b><a name="indexterm-134"></a>Make the directory that contains your information files the current working directory.</b></li>
<li><a name="ch3enhancepkg-step-50"></a><b>Create a file named <tt>request</tt> with your favorite text editor.</b></li>
<li><a name="ch3enhancepkg-step-89"></a><b>Save your changes and quit the editor when you are done.</b></li>
<li><a name="ch3enhancepkg-step-99"></a><b>Complete one of the following tasks.</b>
<ul><li><p>If you want to create additional installation scripts, skip to the next task, <a href="#ch3enhancepkg-120">How to Gather File System Data</a>.</p></li>
<li><p>If you have not created your <tt>prototype</tt> file, complete the procedure <a href="ch2buildpkg-16803.html#ch2buildpkg-64">How to Create a <tt>prototype</tt> File by Using the <tt>pkgproto</tt> Command</a>. Skip to <a href="#ch3enhancepkg-step-52">Step&nbsp;5</a>.</p></li>
<li><p>If you have already created your <tt>prototype</tt> file, edit it and add an entry for the installation script you just created.</p></li></ul>
</li>
<li><a name="ch3enhancepkg-step-52"></a><b>Build your package.</b><p>See <a href="ch2buildpkg-17051.html#ch2buildpkg-66">How to Build a Package</a>, if needed.</p></li></ol><a name="ch3enhancepkg-56"></a><h6>Example&nbsp;3-5 Writing a <tt>request</tt> Script</h6><p><a name="indexterm-135"></a>When a <tt>request</tt> script assigns values to environment variables, it must make those
values available to the <tt>pkgadd</tt> command. This example shows a <tt>request</tt> script segment that
performs this task for the four environment variables: <tt>CLASSES</tt>, <tt>NCMPBIN</tt>, <tt>EMACS</tt>, and
<tt>NCMPMAN</tt>. Assume that these variables were defined in an interactive session with the administrator
earlier in the script.</p><pre># make environment variables available to installation
# service and any other packaging script we might have
 
cat &gt;$1 &lt;&lt;!
CLASSES=$CLASSES
NCMPBIN=$NCMPBIN
EMACS=$EMACS
NCMPMAN=$NCMPMAN
!</pre><h6>See Also</h6><p>After you build the package, install it to confirm that it installs correctly
and verify its integrity. <a href="ch4verifypkg-18395.html">Chapter&nbsp;4, Verifying and Transferring a Package</a> explains these tasks and provides step-by-step instructions on
how to transfer your verified package to a distribution medium.</p>

<a name="ch3enhancepkg-21872"></a><h4>Gathering File System Data With the <tt>checkinstall</tt> Script</h4>
<p><a name="indexterm-136"></a>The <tt>checkinstall</tt> script is executed shortly after the optional <tt>request</tt> script. The <tt>checkinstall</tt> script
runs as the user <tt>install</tt>, if such a user exists, or as the
user <tt>nobody</tt>. The <tt>checkinstall</tt> script does not have the authority to change
file system data. However, based on the information the script gathers, it can
create or modify environment variables in order to control the course of the
resulting installation. The script is also capable of cleanly halting the installation process.</p><p>The <tt>checkinstall</tt> script is intended to perform basic checks on a file system
that would not be normal for the <tt>pkgadd</tt> command. For example, this script
can be used to check ahead to determine if any files from the
current package are going to overwrite existing files, or manage general software dependencies.
The <tt>depend</tt> file only manages package-level dependencies.</p><p>Unlike the <tt>request</tt> script, the <tt>checkinstall</tt> script is executed whether or not a
response file is provided. The script's presence does not brand the package as
interactive. The <tt>checkinstall</tt> script can be used in situations where a <tt>request</tt> script
is forbidden or administrative interaction is not practical.</p>
<hr><p><b>Note - </b>The <tt>checkinstall</tt> script is available starting with the Solaris 2.5 and compatible releases.</p>
<hr>


<a name="ch3enhancepkg-91"></a><h5><tt>checkinstall</tt> Script Behaviors</h5>

<ul><li><p><a name="indexterm-137"></a>The <tt>checkinstall</tt> script cannot modify any files. This script only analyzes the state of the system and creates a list of environment variable assignments based upon that interaction. To enforce this restriction, the <tt>checkinstall</tt> script is executed as the non privileged user <tt>install</tt> if that user exists. Otherwise, this script is executed as the non privileged user <tt>nobody</tt>. The <tt>checkinstall</tt> script does not have superuser authority.</p></li>
<li><p>The <tt>pkgadd</tt> command calls the <tt>checkinstall</tt> script with one argument that names the script's response file. The script's response file is the file that stores the administrator's responses.</p></li>
<li><p>The <tt>checkinstall</tt> script is not executed during package removal. However, the environment variables assigned by the script are saved and are available during package removal.</p></li></ul>


<a name="ch3enhancepkg-92"></a><h5>Design Rules for <tt>checkinstall</tt> Scripts</h5>

<ul><li><p><a name="indexterm-138"></a>There can be only one <tt>checkinstall</tt> script per package. The script must be named <tt>checkinstall</tt>. </p></li>
<li><p>The environment variable assignments should be added to the installation environment for use by the <tt>pkgadd</tt> command and other packaging scripts by writing them to the response file (known to the script as <tt>$1</tt>).</p></li>
<li><p>System environment variables and standard installation environment variables, except for the <tt>CLASSES</tt> and <tt>BASEDIR</tt> parameters, cannot be modified by a <tt>checkinstall</tt> script. Any of the other environment variables that you created can be changed. </p></li>
<li><p>Every environment variable that the <tt>checkinstall</tt> script may manipulate should be assigned a default value in the <tt>pkginfo</tt> file.</p></li>
<li><p>The format of the output list should be <i>PARAM=value</i>. For example: </p><pre>CLASSES=none class1</pre></li>
<li><p>Administrator interaction is not permitted during execution of a <tt>checkinstall</tt> script. All administrator interaction is restricted to the <tt>request</tt> script.</p></li></ul>


<a name="ch3enhancepkg-120"></a><h4>How to Gather File System Data</h4><ol>
<li><a name="ch3enhancepkg-step-69"></a><b><a name="indexterm-139"></a>Make the directory that contains your information files the current working directory.</b></li>
<li><a name="ch3enhancepkg-step-70"></a><b>Create a file named <tt>checkinstall</tt> with your favorite text editor.</b></li>
<li><a name="ch3enhancepkg-step-90"></a><b>Save your changes and quit the editor when you are done.</b></li>
<li><a name="ch3enhancepkg-step-100"></a><b>Complete one of the following tasks.</b>
<ul><li><p>If you want to create additional installation scripts, skip to the next task, <a href="#ch3enhancepkg-121">How to Write Procedure Scripts</a>.</p></li>
<li><p>If you have not created your <tt>prototype</tt> file, complete the procedure <a href="ch2buildpkg-16803.html#ch2buildpkg-64">How to Create a <tt>prototype</tt> File by Using the <tt>pkgproto</tt> Command</a>. Skip to <a href="#ch3enhancepkg-step-72">Step&nbsp;5</a>.</p></li>
<li><p>If you have already created your <tt>prototype</tt> file, edit it and add an entry for the installation script you just created.</p></li></ul>
</li>
<li><a name="ch3enhancepkg-step-72"></a><b>Build your package.</b><p>See <a href="ch2buildpkg-17051.html#ch2buildpkg-66">How to Build a Package</a>, if needed.</p></li></ol><a name="ch3enhancepkg-93"></a><h6>Example&nbsp;3-6 Writing a <tt>checkinstall</tt> Script</h6><p><a name="indexterm-140"></a>This example <tt>checkinstall</tt> script checks to see if database software needed by the
<tt>SUNWcadap</tt> package is installed.</p><pre># checkinstall script for SUNWcadap
#
# This confirms the existence of the required specU database
 
# First find which database package has been installed.
pkginfo -q SUNWspcdA    # try the older one
 
if [ $? -ne 0 ]; then
   pkginfo -q SUNWspcdB    # now the latest
 
      if [ $? -ne 0 ]; then    # oops
            echo "No database package can be found. Please install the"
            echo "SpecU database package and try this installation again."
            exit 3        # Suspend
      else
            DBBASE="`pkgparam SUNWsbcdB BASEDIR`/db"    # new DB software
      fi
else
      DBBASE="`pkgparam SUNWspcdA BASEDIR`/db"    # old DB software
fi
 
# Now look for the database file we will need for this installation
if [ $DBBASE/specUlatte ]; then
      exit 0        # all OK
else
      echo "No database file can be found. Please create the database"
      echo "using your installed specU software and try this"
      echo "installation again."
      exit 3        # Suspend
fi
 </pre><h6>See Also</h6><p>After you build the package, install it to confirm that it installs correctly
and verify its integrity. <a href="ch4verifypkg-18395.html">Chapter&nbsp;4, Verifying and Transferring a Package</a> explains these tasks and provides step-by-step instructions on
how to transfer your verified package to a distribution medium.</p>

<a name="ch3enhancepkg-14637"></a><h4>Writing Procedure Scripts</h4>
<p><a name="indexterm-141"></a>The procedure scripts provide a set of instructions to be performed at particular
points in package installation or removal. The four procedure scripts must be named
one of the predefined names, depending on when the instructions are to be
executed. The scripts are executed without arguments.</p>
<ul><li><p><a name="indexterm-142"></a><a name="ch3enhancepkg-ix43"></a>The <tt>preinstall</tt> script  </p><p>Runs before class installation begins. No files should be installed by this script.</p></li>
<li><p><a name="ch3enhancepkg-ix45"></a>The <tt>postinstall</tt> script </p><p>Runs after all volumes have been installed.</p></li>
<li><p><a name="ch3enhancepkg-ix47"></a>The <tt>preremove</tt> script </p><p>Runs before class removal begins. No files should be removed by this script.</p></li>
<li><p><a name="ch3enhancepkg-ix49"></a>The <tt>postremove</tt> script </p><p>Runs after all classes have been removed.</p></li></ul>


<a name="ch3enhancepkg-46"></a><h5>Procedure Script Behaviors</h5>
<p><a name="ch3enhancepkg-ix51"></a>Procedure scripts are executed as <tt>uid=root</tt> and <tt>gid=other</tt>. </p>

<a name="ch3enhancepkg-28"></a><h5>Design Rules for Procedure Scripts</h5>

<ul><li><p><a name="indexterm-143"></a>Each script should be able to be executed more than once because it is executed once for each volume in a package. This means that executing a script any number of times with the same input produces the same results as executing the script only once. </p></li>
<li><p><a name="indexterm-144"></a><a name="indexterm-145"></a><a name="indexterm-146"></a><a name="indexterm-147"></a>Each procedure script that installs a package object not in the <tt>pkgmap</tt> file must use the <tt>installf</tt> command to notify the package database that it is adding or modifying a path name. After all additions or modifications are complete, this command should be invoked with the <tt>-f</tt> option. Only the <tt>postinstall</tt> and <tt>postremove</tt> scripts may install package objects in this way. See the <a href="http://docs.sun.com/doc/816-5166/installf-1m?a=view"><tt>installf</tt>(1M)</a> man page and <a href="ch5pkgcasestudies-80583.html">Chapter&nbsp;5, Case Studies of Package Creation</a> for more information.</p></li>
<li><p>Administrator interaction is not permitted during execution of a procedure script. All administrator interaction is restricted to the <tt>request</tt> script.</p></li>
<li><p><a name="indexterm-148"></a>Each procedure script that removes files not installed from the <tt>pkgmap</tt> file must use the <tt>removef</tt> command to notify the package database that it is removing a path name. After removal is complete, this command should be invoked with the <tt>-f</tt> option. See the <a href="http://docs.sun.com/doc/816-5166/removef-1m?a=view"><tt>removef</tt>(1M)</a> man page and <a href="ch5pkgcasestudies-80583.html">Chapter&nbsp;5, Case Studies of Package Creation</a> for details and examples.</p>
<hr><p><b>Note - </b>The <tt>installf</tt> and <tt>removef</tt> commands must be used because procedure scripts are not automatically associated with any path names listed in the <tt>pkgmap</tt> file. </p>
<hr>
</li></ul>


<a name="ch3enhancepkg-121"></a><h4>How to Write Procedure Scripts</h4><ol>
<li><a name="ch3enhancepkg-step-48"></a><b><a name="indexterm-149"></a>Make the directory that contains your information files the current working directory.</b></li>
<li><a name="ch3enhancepkg-step-53"></a><b>Create one or more procedure scripts with your favorite text editor.</b><p>A procedure script must be named one of the predefined names: <tt>preinstall</tt>, <tt>postinstall</tt>,
<tt>preremove</tt>, or <tt>postremove</tt>.</p></li>
<li><a name="ch3enhancepkg-step-54"></a><b>Save your changes and quit the editor.</b></li>
<li><a name="ch3enhancepkg-step-101"></a><b>Complete one of the following tasks.</b>
<ul><li><p>If you want to create class action scripts, skip to the next task, <a href="#ch3enhancepkg-122">How to Write Class Action Scripts</a>.</p></li>
<li><p>If you have not created your <tt>prototype</tt> file, complete the procedure <a href="ch2buildpkg-16803.html#ch2buildpkg-64">How to Create a <tt>prototype</tt> File by Using the <tt>pkgproto</tt> Command</a>. Skip to <a href="#ch3enhancepkg-step-55">Step&nbsp;5</a>.</p></li>
<li><p>If you have already created your <tt>prototype</tt> file, edit it and add an entry for each installation script you just created.</p></li></ul>
</li>
<li><a name="ch3enhancepkg-step-55"></a><b>Build your package.</b><p>See <a href="ch2buildpkg-17051.html#ch2buildpkg-66">How to Build a Package</a>, if needed.</p></li></ol><h6>See Also</h6><p>After you build the package, install it to confirm that it installs correctly
and verify its integrity. <a href="ch4verifypkg-18395.html">Chapter&nbsp;4, Verifying and Transferring a Package</a> explains these tasks and provides step-by-step instructions on
how to transfer your verified package to a distribution medium.</p>

<a name="ch3enhancepkg-37319"></a><h4>Writing Class Action Scripts</h4>


<a name="ch3enhancepkg-31"></a><h5>Defining Object Classes</h5>
<p><a name="ch3enhancepkg-ix53"></a><a name="ch3enhancepkg-ix54"></a><a name="indexterm-150"></a>Object classes allow a series of actions to be performed on a group
of package objects at installation or removal. You assign objects to a class
in the <tt>prototype</tt> file. All package objects must be given a class, although
the class of <tt>none</tt> is used by default for objects that require no
special action. </p><p>The installation parameter <tt>CLASSES</tt>, defined in the <tt>pkginfo</tt> file, is a list
of classes to be installed (including the <tt>none</tt> class). </p>
<hr><p><b>Note - </b><a name="indexterm-151"></a>Objects defined in the <tt>pkgmap</tt> file that belong to a class not listed in
this parameter in the <tt>pkginfo</tt> file will <b>not</b> be installed. </p>
<hr>
<p>The <tt>CLASSES</tt> list determines the order of installation. Class <tt>none</tt> is always installed
first, if present, and removed last. Since directories are the fundamental support structure
for all other file system objects, they should all be assigned to the
<tt>none</tt> class. Exceptions can be made, but as a general rule, the <tt>none</tt>
class is safest. This strategy ensures that the directories are created before the objects
they will contain. In addition, no attempt is made to delete a
directory before it has been emptied.</p>

<a name="ch3enhancepkg-34"></a><h5>How Classes Are Processed During Package Installation</h5>
<p><a name="ch3enhancepkg-ix59"></a><a name="ch3enhancepkg-ix60"></a><a name="ch3enhancepkg-ix61"></a>The following describes the system actions that occur when a class is installed.
The actions are repeated once for each volume of a package, as that
volume is being installed. </p>
<ol><li><p><a name="indexterm-152"></a><a name="ch3enhancepkg-ix62"></a>The <tt>pkgadd</tt> command creates a path name list. </p><p>The <tt>pkgadd</tt> command creates a list of path names upon which the action script operates. Each line of this list contains source and destination path names, separated by a space. The source path name indicates where the object to be installed resides on the installation volume. The destination path name indicates the location on the target system where the object should be installed. The contents of the list are restricted by the following criteria: </p>
<ul><li><p>The list contains only path names that belong to the associated class. </p></li>
<li><p><a name="indexterm-153"></a>If the attempt to create the package object fails, then directories, named pipes, character devices, block devices, and symbolic links are included in the list with the source path name set to <tt>/dev/null</tt>. Normally, these items are automatically created by the <tt>pkgadd</tt> command (if not already in existence) and given proper attributes (mode, owner, group) as defined in the <tt>pkgmap</tt> file.</p></li>
<li><p>Linked files where the file type is <tt>l</tt> are not included in the list under any circumstances. Hard links in the given class are created in item 4. </p></li></ul>
</li>
<li><p>If no class action script is provided for installation of a particular class, the path names in the generated list are copied from the volume to the appropriate target location.</p></li>
<li><p>A class action script is executed if one exists. </p><p>The class action script is invoked with standard input that contains the list generated in item 1. If this volume is the last volume of the package, or no more objects exist in this class, the script is executed with the single argument of <tt>ENDOFCLASS</tt>.</p>
<hr><p><b>Note - </b>Even if no regular files of this class exist in the package, the class action script is called at least once with an empty list and the <tt>ENDOFCLASS</tt> argument.</p>
<hr>
</li>
<li><p>The <tt>pkgadd</tt> command performs a content and attribute audit, and creates hard links. </p><p>After successfully executing items 2 or 3, the <tt>pkgadd</tt> command audits both content and attribute information for the list of path names. The <tt>pkgadd</tt> command creates the links associated with the class automatically. Detected attribute inconsistencies are corrected for all path names in the generated list.</p></li></ol>


<a name="ch3enhancepkg-35"></a><h5>How Classes Are Processed During Package Removal</h5>
<p><a name="indexterm-154"></a><a name="ch3enhancepkg-ix63"></a><a name="ch3enhancepkg-ix64"></a><a name="ch3enhancepkg-ix66"></a>Objects are removed class by class. Classes that exist for a package but
are not listed in the <tt>CLASSES</tt> parameter are removed first (for example, an
object installed with the <tt>installf</tt> command).  Classes listed in the <tt>CLASSES</tt> parameter
are removed in reverse order. The <tt>none</tt> class is always removed last. The
following describes the system actions that occur when a class is removed: </p>
<ol><li><p>The <tt>pkgrm</tt> command creates a path name list. </p><p>The <tt>pkgrm</tt> command creates a list of installed path names that belong to the indicated class. Path names referenced by another package are excluded from the list unless their file type is <tt>e</tt>. A file type of <tt>e</tt> means the file should be edited upon installation or removal. </p><p>If the package being removed had modified any files of type <tt>e</tt> during installation, it should remove just the lines it added. Do not delete a non-empty editable file. Remove the lines that the package added.</p></li>
<li><p>If no class action script exists, the path names are deleted. </p><p>If your package has no removal class action script for the class, all the path names in the list generated by the <tt>pkgrm</tt> command are deleted. </p>
<hr><p><b>Note - </b>Files with a file type of <tt>e</tt> (editable) are not assigned to a class and an associated class action script. These files are removed at this point, even if the path name is shared with other packages. </p>
<hr>
</li>
<li><p>If a class action script exists, the script is executed. </p><p>The <tt>pkgrm</tt> command invokes the class action script with standard input for the script that contains the list generated in item 1. </p></li>
<li><p>The <tt>pkgrm</tt> command performs an audit. </p><p>After successfully executing the class action script, the <tt>pkgrm</tt> command removes references to the path names from the package database unless a path name is referenced by another package. </p></li></ol>


<a name="ch3enhancepkg-32"></a><h5>The Class Action Script</h5>
<p><a name="ch3enhancepkg-ix55"></a>The class action script defines a set of actions to be executed during
installation or removal of a package. The actions are performed on a group
of path names based on their class definition. See <a href="ch5pkgcasestudies-80583.html">Chapter&nbsp;5, Case Studies of Package Creation</a> for examples
of class action scripts. </p><p>The name of a class action script is based on the class
on which it should operate and whether those operations should occur during package
installation or package removal. The two name formats are shown in the following
table: </p><table><col width="33%"><col width="66%"><tr><th align="left" valign="top" scope="column"><p>Name Format</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>i.</tt><i>class</i> </p></td>
<td align="left" valign="top" scope="row"><p>Operates on path names in the indicated class during
package installation</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p> <tt>r.</tt><i>class</i></p></td>
<td align="left" valign="top" scope="row"><p>Operates on path names in the indicated class during package
removal </p></td>
</tr>
</table><p><a name="indexterm-155"></a>For example, the name of the installation script for a class named <tt>manpage</tt>
would be <tt>i.manpage</tt>. The removal script would be named <tt>r.manpage</tt>.</p>
<hr><p><b>Note - </b>This file name format is not used for files that belong to
the <tt>sed</tt>, <tt>awk</tt>, or <tt>build</tt> system classes. For more information on these special
classes, see <a href="#ch3enhancepkg-36">The Special System Classes</a>.</p>
<hr>


<a name="ch3enhancepkg-73"></a><h5>Class Action Script Behaviors</h5>

<ul><li><p><a name="ch3enhancepkg-ix57"></a>Class action scripts are executed as <tt>uid=root</tt> and <tt>gid=other</tt>. </p></li>
<li><p>A script is executed for all files in the given class on the current volume. </p></li>
<li><p><a name="indexterm-156"></a>The <tt>pkgadd</tt> and <tt>pkgrm</tt> commands create a list of all objects listed in the <tt>pkgmap</tt> file that belong to the class. As a result, a class action script can act only upon path names defined in the <tt>pkgmap</tt> that belong to a particular class. </p></li>
<li><p>When a class action script is executed for the last time (that is, no more files belong to that class), the class action script is executed once with the keyword argument <tt>ENDOFCLASS</tt>.</p></li>
<li><p>Administrator interaction is not permitted during execution of a class action script.</p></li></ul>


<a name="ch3enhancepkg-33"></a><h5>Design Rules for Class Action Scripts</h5>

<ul><li><p><a name="indexterm-157"></a>If a package spans more than one volume, the class action script is executed once for each volume that contains at least one file that belongs to a class. Consequently, each script must be able to be executed more than once. This means that executing a script any number of times with the same input must produce the same results as executing the script only once. </p></li>
<li><p>When a file is part of a class that has a class action script, the script must install the file. The <tt>pkgadd</tt> command does not install files for which a class action script exists, although it does verify the installation.</p></li>
<li><p>A class action script should never add, remove, or modify a path name or system attribute that does not appear in the list generated by the <tt>pkgadd</tt> command. For more information on this list, see item 1 in <a href="#ch3enhancepkg-34">How Classes Are Processed During Package Installation</a>.</p></li>
<li><p>When your script sees the <tt>ENDOFCLASS</tt> argument, put post-processing actions such as clean up into your script.</p></li>
<li><p>All administrator interaction is restricted to the <tt>request</tt> script. Do not try to obtain information from the administrator by using a class action script.</p></li></ul>


<a name="ch3enhancepkg-36"></a><h5>The Special System Classes</h5>
<p><a name="ch3enhancepkg-ix67"></a><a name="ch3enhancepkg-ix68"></a>The system provides four special classes:</p>
<ul><li><p><a name="ch3enhancepkg-ix71"></a>The <tt>sed</tt> class</p><p>Provides a method for using <tt>sed</tt> instructions to edit files upon package installation and removal</p></li>
<li><p><a name="ch3enhancepkg-ix72"></a><a name="ch3enhancepkg-ix73"></a>The <tt>awk</tt> class </p><p>Provides a method for using <tt>awk</tt> instructions to edit files upon package installation and removal </p></li>
<li><p><a name="ch3enhancepkg-ix74"></a><a name="ch3enhancepkg-ix75"></a>The <tt>build</tt> class </p><p>Provides a method to dynamically construct or modify a file by using Bourne shell commands</p></li>
<li><p>The <tt>preserve</tt> class</p><p>Provides a method to preserve files that should not be overwritten by future package installations</p></li></ul>
<p>If several files in a package require special processing that can be fully
defined through <tt>sed</tt>, <tt>awk</tt>, or <tt>sh</tt> commands, installation is faster by using
the system classes rather than multiple classes and their corresponding class action scripts.</p>

<a name="ch3enhancepkg-37"></a><h5>The <tt>sed</tt> Class Script</h5>
<p><a name="ch3enhancepkg-ix76"></a>The <tt>sed</tt> class provides a method to modify an existing object on the
target system. The <tt>sed</tt> class action script executes automatically at installation if a
file that belongs to class <tt>sed</tt> exists. The name of the <tt>sed</tt>
class action script should be the same as the name of the
file on which the instructions are executed.</p><p>A <tt>sed</tt> class action script delivers <tt>sed</tt> instructions in the following format:</p><p>Two commands indicate when instructions should be executed. The <tt>sed</tt> instructions that
follow the <tt>!install</tt> command are executed during package installation. The <tt>sed</tt> instructions that follow
the <tt>!remove</tt> command are executed during package removal. The order in which these
commands are used in the file does not matter. </p><p>For more information on <tt>sed</tt> instructions, see the <a href="http://docs.sun.com/doc/816-5165/sed-1?a=view"><tt>sed</tt>(1)</a> man page. For
examples of <tt>sed</tt> class action scripts, see <a href="ch5pkgcasestudies-80583.html">Chapter&nbsp;5, Case Studies of Package Creation</a>.</p>

<a name="ch3enhancepkg-38"></a><h5>The <tt>awk</tt> Class Script</h5>
<p><a name="ch3enhancepkg-ix79"></a>The <tt>awk</tt> class provides a method to modify an existing object on the
target system. Modifications are delivered as <tt>awk</tt> instructions in an <tt>awk</tt> class action script.
</p><p>The <tt>awk</tt> class action script is executed automatically at installation if a file
that belongs to class <tt>awk</tt> exists. Such a file contains instructions for the
<tt>awk</tt> class script in the following format:</p><p>Two commands indicate when instructions should be executed. The <tt>awk</tt> instructions that
follow the <tt>!install</tt> command are executed during package installation. The instructions that follow
the <tt>!remove</tt> command are executed during package removal. These commands may be used
in any order. </p><p>The name of the <tt>awk</tt> class action script should be the same as
the name of the file on which the instructions are executed. </p><p>The file to be modified is used as input to the <tt>awk</tt>
command and the output of the script ultimately replaces the original object. Environment variables
may not be passed to the <tt>awk</tt> command with this syntax. </p><p>For more information on <tt>awk</tt> instructions, see the <a href="http://docs.sun.com/doc/816-5165/awk-1?a=view"><tt>awk</tt>(1)</a> man page. </p>

<a name="ch3enhancepkg-39"></a><h5>The <tt>build</tt> Class Script</h5>
<p><a name="ch3enhancepkg-ix82"></a>The <tt>build</tt> class creates or modifies a package object file by executing Bourne
shell instructions. These instructions are delivered as the package object. The instructions run automatically
at installation if the package object belongs to the <tt>build</tt> class. 
 </p><p>The name of the <tt>build</tt> class action script should be the same as
the name of the file on which the instructions are executed. The name
must also be executable by the <tt>sh</tt> command. The script's output becomes the
new version of the file as it is built or modified. If the
script produces no output, the file is not created or modified. Therefore, the
script can modify or create the file itself.</p><p>For example, if a package delivers a default file, <tt>/etc/randomtable</tt>, and if
the file does not already exist on the target system, the <tt>prototype</tt>
file entry might be as follows:</p><pre>e build /etc/randomtable ? ? ?</pre><p>The package object, <tt>/etc/randomtable</tt>, might look like the following:</p><pre>!install
# randomtable builder
if [ -f $PKG_INSTALL_ROOT/etc/randomtable ]; then
        echo "/etc/randomtable is already in place.";
        else
        echo "# /etc/randomtable" &gt; $PKG_INSTALL_ROOT/etc/randomtable
        echo "1121554    # first random number" &gt;&gt; $PKG_INSTALL_ROOT/etc/randomtable
fi
 
!remove
# randomtable deconstructor
if [ -f $PKG_INSTALL_ROOT/etc/randomtable ]; then
        # the file can be removed if it's unchanged
        if [ egrep "first random number" $PKG_INSTALL_ROOT/etc/randomtable ]; then
            rm $PKG_INSTALL_ROOT/etc/randomtable;
        fi
fi
 </pre><p>See <a href="ch5pkgcasestudies-80583.html">Chapter&nbsp;5, Case Studies of Package Creation</a> for another example using the <tt>build</tt> class.</p>

<a name="ch3enhancepkg-114"></a><h5>The <tt>preserve</tt> Class Script</h5>
<p>The <tt>preserve</tt> class preserves a package object file by determining whether or not
an existing file should be overwritten when the package is installed. Two possible
scenarios when using a <tt>preserve</tt> class script are:</p>
<ul><li><p>If the file to be installed does not already exist in the target directory, the file will be installed normally.</p></li>
<li><p>If the file to be installed exists in the target directory, a message describing that the file exists is displayed, and the file is not installed.</p></li></ul>
<p>Both scenario outcomes are considered successful by the <tt>preserve</tt> script. A failure occurs
only in the second scenario when the file is unable to be copied
to the target directory.</p><p>Starting with the Solaris 7 release, the <tt>i.preserve</tt> script and a copy of
this script, <tt>i.CONFIG.prsv</tt>, can be found in the <tt>/usr/sadm/install/scripts</tt> directory with the other class
action scripts. </p><p>Modify the script to include the filename or filenames you would like to
preserve.</p>

<a name="ch3enhancepkg-122"></a><h4>How to Write Class Action Scripts</h4><ol>
<li><a name="ch3enhancepkg-step-87"></a><b><a name="indexterm-158"></a>Make the directory that contains your information files the current working directory.</b></li>
<li><a name="ch3enhancepkg-step-88"></a><b>Assign the package objects in the <tt>prototype</tt> file the desired class names.</b><p>For example, assigning objects to an <tt>application</tt> and <tt>manpage</tt> class would look like the
following:</p><pre>f manpage /usr/share/man/manl/myappl.1l
f application /usr/bin/myappl</pre></li>
<li><a name="ch3enhancepkg-step-76"></a><b>Modify the <tt>CLASSES</tt> parameter in the <tt>pkginfo</tt> file to contain the class names
you want to use in your package. </b><p>For example, entries for the <tt>application</tt> and <tt>manpage</tt> classes would look like
the following:</p><pre>CLASSES=manpage application none</pre>
<hr><p><b>Note - </b>The <tt>none</tt> class is always installed first and removed last, regardless of where
it appears in the definition of the <tt>CLASSES</tt> parameter.</p>
<hr>
</li>
<li><a name="ch3enhancepkg-step-60"></a><b>If you are a creating a class action script for a file that
belongs to the <tt>sed</tt>, <tt>awk</tt>, or <tt>build</tt> class, make the directory that contains
the package object your current working directory.</b></li>
<li><a name="ch3enhancepkg-step-77"></a><b>Create the class action scripts or package objects (for files that belong to
the <tt>sed</tt>, <tt>awk</tt>, or <tt>build</tt> class). </b><p>For example, an installation script for a class named <tt>application</tt> would be named <tt>i.application</tt>
and a removal script would be named <tt>r.application</tt>.</p><p>Remember, when a file is part of a class that has a class
action script, the script must install the file. The <tt>pkgadd</tt> command does
not install files for which a class action script exists, although it does
verify the installation. And, if you define a class but do not deliver
a class action script, the only action taken for that class is to
copy components from the installation medium to the target system (the default <tt>pkgadd</tt>
behavior).</p></li>
<li><a name="ch3enhancepkg-step-104"></a><b>Complete <b>one</b> of the following tasks.</b>
<ul><li><p>If you have <b>not</b> created your <tt>prototype</tt> file, complete the procedure <a href="ch2buildpkg-16803.html#ch2buildpkg-64">How to Create a <tt>prototype</tt> File by Using the <tt>pkgproto</tt> Command</a>, and skip to <a href="#ch3enhancepkg-step-80">Step&nbsp;7</a>.</p></li>
<li><p>If you have already created your <tt>prototype</tt> file, edit it and add an entry for each installation script you just created.</p></li></ul>
</li>
<li><a name="ch3enhancepkg-step-80"></a><b>Build your package.</b><p>See <a href="ch2buildpkg-17051.html#ch2buildpkg-66">How to Build a Package</a>, if needed.</p></li></ol><h6>More Information<br>Where to Go Next</h6><p>After you build the package, install it to confirm that it installs correctly
and verify its integrity. <a href="ch4verifypkg-18395.html">Chapter&nbsp;4, Verifying and Transferring a Package</a> explains how to do this and provides step-by-step
instructions on how to transfer your verified package to a distribution medium.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ch3enhancepkg-31830.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ch6advtech-108.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

