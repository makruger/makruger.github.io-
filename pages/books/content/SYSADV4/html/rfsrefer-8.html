<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>NFS Daemons - System Administration Guide: Network Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Network Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="rfsrefer-6.html">Previous</a>
             </td>
             <td align="right">
                 <a href="rfsrefer-13.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="netservices-1.html">Part&nbsp;I&nbsp;Network Services Topics</a></p>
<p class="toc level2"><a href="nsov-1.html">1.&nbsp;&nbsp;Network Service (Overview)</a></p>
<p class="toc level2"><a href="nca-1.html">2.&nbsp;&nbsp;Managing Web Cache Servers</a></p>
<p class="toc level2"><a href="time-1.html">3.&nbsp;&nbsp;Time-Related Services</a></p>
<p class="toc level1 tocsp"><a href="rfstm-1.html">Part&nbsp;II&nbsp;Accessing Network File Systems Topics</a></p>
<p class="toc level2"><a href="rfsintro-2.html">4.&nbsp;&nbsp;Managing Network File Systems (Overview)</a></p>
<p class="toc level2"><a href="rfsadmin-8.html">5.&nbsp;&nbsp;Network File System Administration (Tasks)</a></p>
<p class="toc level2"><a href="rfsrefer-1.html">6.&nbsp;&nbsp;Accessing Network File Systems (Reference)</a></p>
<p class="toc level3"><a href="rfsrefer-6.html">NFS Files</a></p>
<div class="onpage">
<p class="toc level3"><a href="">NFS Daemons</a></p>
</div>
<p class="toc level3"><a href="rfsrefer-13.html">NFS Commands</a></p>
<p class="toc level3"><a href="rfsrefer-37.html">Commands for Troubleshooting NFS Problems</a></p>
<p class="toc level3"><a href="rfsrefer-154.html">NFS Over RDMA</a></p>
<p class="toc level3"><a href="rfsrefer-45.html">How the NFS Service Works</a></p>
<p class="toc level3"><a href="rfsrefer-66.html">Autofs Maps</a></p>
<p class="toc level3"><a href="rfsrefer-75.html">How Autofs Works</a></p>
<p class="toc level3"><a href="rfsrefer-98.html">Autofs Reference</a></p>
<p class="toc level1 tocsp"><a href="slptm.html">Part&nbsp;III&nbsp;SLP Topics</a></p>
<p class="toc level2"><a href="slparch-16.html">7.&nbsp;&nbsp;SLP (Overview)</a></p>
<p class="toc level2"><a href="slp.setup-10.html">8.&nbsp;&nbsp;Planning and Enabling SLP (Tasks)</a></p>
<p class="toc level2"><a href="ch.configuration-6.html">9.&nbsp;&nbsp;Administering SLP (Tasks)</a></p>
<p class="toc level2"><a href="legacy-7.html">10.&nbsp;&nbsp;Incorporating Legacy Services</a></p>
<p class="toc level2"><a href="slpreference.html">11.&nbsp;&nbsp;SLP (Reference)</a></p>
<p class="toc level1 tocsp"><a href="mailtm-1.html">Part&nbsp;IV&nbsp;Mail Services Topics</a></p>
<p class="toc level2"><a href="mailintro-1.html">12.&nbsp;&nbsp;Mail Services (Overview)</a></p>
<p class="toc level2"><a href="mailadmin-1.html">13.&nbsp;&nbsp;Mail Services (Tasks)</a></p>
<p class="toc level2"><a href="mailrefer-1.html">14.&nbsp;&nbsp;Mail Services (Reference)</a></p>
<p class="toc level1 tocsp"><a href="modemtm-1.html">Part&nbsp;V&nbsp;Serial Networking Topics</a></p>
<p class="toc level2"><a href="pppsvrconfig.intro-1.html">15.&nbsp;&nbsp;Solaris PPP 4.0 (Overview)</a></p>
<p class="toc level2"><a href="pppsvrconfig.p2plink-1.html">16.&nbsp;&nbsp;Planning for the PPP Link (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.dialin-1.html">17.&nbsp;&nbsp;Setting Up a Dial-up PPP Link (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.leased-1.html">18.&nbsp;&nbsp;Setting Up a Leased-Line PPP Link (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.auth-1.html">19.&nbsp;&nbsp;Setting Up PPP Authentication (Tasks)</a></p>
<p class="toc level2"><a href="ppp.pppoe-1.html">20.&nbsp;&nbsp;Setting Up a PPPoE Tunnel (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.troubleshoot-1.html">21.&nbsp;&nbsp;Fixing Common PPP Problems (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.reference-1.html">22.&nbsp;&nbsp;Solaris PPP 4.0 (Reference)</a></p>
<p class="toc level2"><a href="pppsvrconfig.convert.app-1.html">23.&nbsp;&nbsp;Migrating From Asynchronous Solaris PPP to Solaris PPP 4.0 (Tasks)</a></p>
<p class="toc level2"><a href="uucpov-1.html">24.&nbsp;&nbsp;UUCP (Overview)</a></p>
<p class="toc level2"><a href="uucptasks-1.html">25.&nbsp;&nbsp;Administering UUCP (Tasks)</a></p>
<p class="toc level2"><a href="uucpref-1.html">26.&nbsp;&nbsp;UUCP (Reference)</a></p>
<p class="toc level1 tocsp"><a href="wwrstm.html">Part&nbsp;VI&nbsp;Working With Remote Systems Topics</a></p>
<p class="toc level2"><a href="wwrsov.html">27.&nbsp;&nbsp;Working With Remote Systems (Overview)</a></p>
<p class="toc level2"><a href="wuftp-17.html">28.&nbsp;&nbsp;Administering the FTP Server (Tasks)</a></p>
<p class="toc level2"><a href="remotehowtoaccess-99941.html">29.&nbsp;&nbsp;Accessing Remote Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="netmonitortm-1.html">Part&nbsp;VII&nbsp;Monitoring Network Services Topics</a></p>
<p class="toc level2"><a href="netmonitor-1.html">30.&nbsp;&nbsp;Monitoring Network Performance (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="rfsrefer-8"></a><h3>NFS Daemons</h3>
<a name="indexterm-512"></a><p>To support NFS activities, several daemons are started when a system goes into
run level <tt>3</tt> or multiuser mode. The <tt>mountd</tt> and <tt>nfsd</tt> daemons are
run on systems that are servers. The automatic startup of the server daemons
depends on the existence of entries that are labeled with the NFS file-system
type in <tt>/etc/dfs/sharetab</tt>. To support NFS file locking, the <tt>lockd</tt> and <tt>statd</tt> daemons are
run on NFS clients and servers. However, unlike previous versions of NFS, in
NFS version 4, the daemons <tt>lockd</tt>, <tt>statd</tt>, <tt>mountd</tt>, and <tt>nfslogd</tt> are not
used.</p><p>This section describes the following daemons.</p>
<ul><li><p><a href="#rfsrefer-65"><tt>automountd</tt> Daemon</a></p></li>
<li><p><a href="#rfsrefer-9"><tt>lockd</tt> Daemon</a></p></li>
<li><p><a href="#rfsrefer-10"><tt>mountd</tt> Daemon</a></p></li>
<li><p><a href="#rfsrefer-144"><tt>nfs4cbd</tt> Daemon</a></p></li>
<li><p><a href="#rfsrefer-11"><tt>nfsd</tt> Daemon</a></p></li>
<li><p><a href="#rfsrefer-7"><tt>nfslogd</tt> Daemon</a></p></li>
<li><p><a href="#rfsrefer-118"><tt>nfsmapid</tt> Daemon</a></p></li>
<li><p><a href="#rfsrefer-12"><tt>statd</tt> Daemon</a></p></li></ul>


<a name="rfsrefer-65"></a><h4><tt>automountd</tt> Daemon</h4>
<a name="indexterm-513"></a><a name="indexterm-514"></a><p>This daemon handles the mounting and unmounting requests from the autofs service. The
syntax of the command is as follows:</p><p><tt>automountd</tt> <tt>[</tt> <tt>-Tnv</tt> <tt>]</tt> <tt>[</tt> <tt>-D</tt> <i>name</i>=<i>value</i> <tt>]</tt></p><p>The command behaves in the following ways:</p>
<ul><li><p><tt>-T</tt> enables tracing.</p></li>
<li><p><tt>-n</tt> disables browsing on all autofs nodes.</p></li>
<li><p><tt>-v</tt> selects to log all status messages to the console.</p></li>
<li><p><tt>-D</tt> <i>name</i>=<i>value</i> substitutes <i>value</i> for the automount map variable that is indicated by <i>name</i>.</p></li></ul>
<p>The default value for the automount map is <tt>/etc/auto_master</tt>. Use the <tt>-T</tt> option
for troubleshooting.</p>

<a name="rfsrefer-9"></a><h4><tt>lockd</tt> Daemon</h4>
<a name="indexterm-515"></a><a name="indexterm-516"></a><p>This daemon supports record-locking operations on NFS files. The <tt>lockd</tt> daemon manages
RPC connections between the client and the server for the Network Lock Manager
(NLM) protocol. The daemon is normally started without any options. You can use
three options with this command. See the <a href="http://docs.sun.com/doc/819-2240/lockd-1m?a=view"><tt>lockd</tt>(1M)</a> man page. These options
can either be used from the command line or by editing the appropriate
string in <tt>/etc/default/nfs</tt>. The following are descriptions of keywords that can be set in
the <tt>/etc/default/nfs</tt> file.</p>
<hr><p><b>Note - </b><a name="indexterm-517"></a><a name="indexterm-518"></a>Starting in the Solaris 10 release, the <tt>LOCKD_GRACE_PERIOD</tt> keyword and the <tt>-g</tt> option
have been deprecated. The deprecated keyword is replaced with the new keyword <tt>GRACE_PERIOD</tt>.
 If both keywords are set, the value for <tt>GRACE_PERIOD</tt> overrides the value for
<tt>LOCKD_GRACE_PERIOD</tt>.  See the description of <tt>GRACE_PERIOD</tt> that follows.</p>
<hr>
<p><a name="indexterm-519"></a>Like <tt>LOCKD_GRACE_PERIOD</tt>, <tt>GRACE_PERIOD</tt>=<i>graceperiod</i> in <tt>/etc/default/nfs</tt> sets the number of seconds after a server
reboot that the clients have to reclaim both NFS version 3 locks, provided
by NLM, and version 4 locks.  Thus, the value for <tt>GRACE_PERIOD</tt> controls
the length of the grace period for lock recovery, for both NFS version
3 and NFS version 4.</p><p><a name="indexterm-520"></a><a name="indexterm-521"></a>The <tt>LOCKD_RETRANSMIT_TIMEOUT</tt>=<i>timeout</i> parameter in <tt>/etc/default/nfs</tt> selects the number of seconds to wait before retransmitting
a lock request to the remote server. This option affects the NFS client-side
service. The default value for <i>timeout</i> is 15 seconds. Decreasing the <i>timeout</i> value
can improve response time for NFS clients on a &ldquo;noisy&rdquo; network. However, this change
can cause additional server load by increasing the frequency of lock requests. The
same parameter can be used from the command line by starting the daemon
with the <tt>-t</tt> <i>timeout</i> option.</p><p><a name="indexterm-522"></a><a name="indexterm-523"></a>The <tt>LOCKD_SERVERS</tt>=<i>nthreads</i> parameter in <tt>/etc/default/nfs</tt> specifies the maximum number of concurrent threads that the
server handles per connection. Base the value for <i>nthreads</i> on the load
that is expected on the NFS server. The default value is 20. Each
NFS client that uses TCP uses a single connection with the NFS server.
Therefore, each client can use a maximum of 20 concurrent threads on the
server.</p><p>All NFS clients that use UDP share a single connection with the
NFS server. Under these conditions, you might have to increase the number of
threads that are available for the UDP connection. A minimum calculation would be to
allow two threads for each UDP client. However, this number is specific to
the workload on the client, so two threads per client might not
be sufficient. The disadvantage to using more threads is that when the threads
are used, more memory is used on the NFS server. If the threads
are never used, however, increasing <i>nthreads</i> has no effect. The same parameter can be
used from the command line by starting the daemon with the <tt>nthreads</tt>
option.</p>

<a name="rfsrefer-10"></a><h4><tt>mountd</tt> Daemon</h4>
<a name="indexterm-524"></a><a name="indexterm-525"></a><p>This daemon handles file-system mount requests from remote systems and provides access control.
The <tt>mountd</tt> daemon checks <tt>/etc/dfs/sharetab</tt> to determine which file systems are available
for remote mounting and which systems are allowed to do the remote mounting.
You can use the <tt>-v</tt> option and the <tt>-r</tt> option with this
command. See the <a href="http://docs.sun.com/doc/819-2240/mountd-1m?a=view"><tt>mountd</tt>(1M)</a> man page.</p><p>The <tt>-v</tt> option runs the command in verbose mode. Every time an NFS
server determines the access that a client should be granted, a message is
printed on the console. The information that is generated can be useful when
trying to determine why a client cannot access a file system.</p><p>The <tt>-r</tt> option rejects all future mount requests from clients. This option does
not affect clients that already have a file system mounted.</p>
<hr><p><b>Note - </b>NFS version 4 does not use this daemon.</p>
<hr>


<a name="rfsrefer-144"></a><h4><tt>nfs4cbd</tt> Daemon</h4>
<a name="indexterm-526"></a><a name="indexterm-527"></a><p><tt>nfs4cbd</tt>, which is for the exclusive use of the NFS version 4 client,
manages the communication endpoints for the NFS version 4 callback program. The daemon
has no user-accessible interface. For more information, see the <a href="http://docs.sun.com/doc/819-2240/nfs4cbd-1m?a=view"><tt>nfs4cbd</tt>(1M)</a> man page.</p>

<a name="rfsrefer-11"></a><h4><tt>nfsd</tt> Daemon</h4>
<a name="indexterm-528"></a><a name="indexterm-529"></a><p>This daemon handles other client file-system requests. You can use several options with
this command. See the <a href="http://docs.sun.com/doc/819-2240/nfsd-1m?a=view"><tt>nfsd</tt>(1M)</a> man page for a complete listing. These options
can either be used from the command line or by editing the
appropriate string in <tt>/etc/default/nfs</tt>.</p><p>The <tt>NFSD_LISTEN_BACKLOG</tt>=<i>length</i> parameter in <tt>/etc/default/nfs</tt> sets the length of the connection queue over connection-oriented
transports for NFS and TCP. The default value is 32 entries. The same
selection can be made from the command line by starting <tt>nfsd</tt> with
the <tt>-l</tt> option.</p><p>The <tt>NFSD_MAX_CONNECTIONS</tt>=<i>#-conn</i> parameter in <tt>/etc/default/nfs</tt> selects the maximum number of connections per connection-oriented transport.
The default value for <b>#-conn</b> is unlimited. The same parameter can be used
from the command line by starting the daemon with the <tt>-c</tt> <i>#-conn</i> option.</p><p>The <tt>NFSD_SERVER</tt>=<i>nservers</i> parameter in <tt>/etc/default/nfs</tt> selects the maximum number of concurrent requests that a
server can handle. The default value for <i>nservers</i> is 16. The same selection
can be made from the command line by starting <tt>nfsd</tt> with the
<tt>nservers</tt> option.</p><p>Unlike older versions of this daemon, <tt>nfsd</tt> does not spawn multiple copies to
handle concurrent requests. Checking the process table with <tt>ps</tt> only shows one copy
of the daemon running.</p>

<a name="rfsrefer-7"></a><h4><tt>nfslogd</tt> Daemon</h4>
<a name="indexterm-530"></a><a name="indexterm-531"></a><p>This daemon provides operational logging. NFS operations that are logged against a server
are based on the configuration options that are defined in <tt>/etc/default/nfslogd</tt>. When
NFS server logging is enabled, records of all RPC operations on a selected
file system are written to a buffer file by the kernel. Then <tt>nfslogd</tt>
postprocesses these requests. The name service switch is used to help map UIDs
to logins and IP addresses to host names. The number is recorded if
no match can be found through the identified name services. </p><p>Mapping of file handles to path names is also handled by <tt>nfslogd</tt>. The
daemon tracks these mappings in a file-handle-to-path mapping table. One mapping table exists
for each tag that is identified in <tt>/etc/nfs/nfslogd</tt>. After post-processing, the records
are written to ASCII log files.</p>
<hr><p><b>Note - </b>NFS version 4 does not use this daemon.</p>
<hr>


<a name="rfsrefer-118"></a><h4><tt>nfsmapid</tt> Daemon</h4>
<a name="indexterm-532"></a><a name="indexterm-533"></a><p>Version 4 of the NFS protocol (RFC3530) changed the way user or
group  identifiers (UID or GID) are exchanged between the client and server.
The  protocol requires that a file's owner and group attributes be exchanged
between  an NFS version 4 client and an NFS version 4 server
as strings in the form of  <tt>user@nfsv4_domain</tt> or <tt>group@nfsv4_domain</tt>, respectively.</p><p>For example, user <tt>known_user</tt> has a UID 123456 on an NFS version 4
client whose fully qualified hostname is <tt>system.example.com</tt>. For the client to make
requests to the NFS version 4 server, the client must map the UID
123456 to <tt>known_user@example.com</tt> and then send this attribute to the NFS version 4
server. The NFS version 4 server expects to receive user and group file
attributes in the <tt>user_or_group@nfsv4_domain</tt> format. After the server receives <tt>known_user@example.com</tt> from the client,
the server maps the string to the local UID 123456, which is
understood by the underlying file system. This functionality assumes that every UID and GID
in the network is unique and that the NFS version 4 domains
on the client match the NFS version 4 domains on the server.</p>
<hr><p><b>Note - </b>If the server does not recognize the given user or group name, even
if  the NFS version 4 domains match, the server is unable
to map the user or group name to its unique ID, an integer
value. Under such circumstances, the server maps the inbound user or group name
to the <tt>nobody</tt> user. To prevent such occurrences, administrators should avoid making special
accounts that only exist on the NFS version 4 client.</p>
<hr>
<p>The NFS version 4 client and server are both capable of performing
integer-to-string  and string-to-integer conversions. For example, in response to a GETATTR operation, the
NFS version 4 server maps UIDs and GIDs obtained from the underlying file
system into their respective string representation and sends this information to the client.
Alternately, the client must also map UIDs and GIDs into string representations. For
example, in response to the <tt>chown</tt> command, the client maps the new UID
or GID to a string representation before sending a  SETATTR operation to
the server.</p><p>Note, however, that the client and server respond differently to unrecognized  strings:</p>
<ul><li><p>If the user does not exist on the server, even within the same NFS version 4 domain configuration, the server rejects the remote procedure call (RPC) and returns an error message to the client. This situation limits the operations that can be performed by the remote user.</p></li>
<li><p>If the user exists on both the client and server, but they have mismatched domains, the server rejects the attribute modifying operations (such as SETATTR) that require the server to map the inbound user string to an integer value that the underlying file system can understand. For NFS version 4 clients and servers to function properly, their NFS version 4 domains, the portion of the string after the <tt>@</tt> sign, should match.</p></li>
<li><p>If the NFS version 4 client does not recognize a user or group name from the server, the client is unable to map the string to its unique ID, an integer value. Under such circumstances, the client maps the inbound user or group string to the <tt>nobody</tt> user. This mapping to <tt>nobody</tt> creates varied problems for different applications. As for NFS version 4 functionality, operations that modify file attributes will fail.</p></li></ul>


<a name="epubq"></a><h5>Configuration Files and <tt>nfsmapid</tt></h5>
<a name="indexterm-534"></a><p>The following describes how the <tt>nfsmapid</tt> daemon uses the <tt>/etc/nsswitch.conf</tt> and <tt>/etc/resolv.conf</tt> files:</p>
<ul><li><p><tt>nfsmapid</tt> uses standard C library functions to request password and group information from back-end name services. These name services are controlled by the settings in the <tt>/etc/nsswitch.conf</tt> file. Any changes to the <tt>nsswitch.conf</tt> file affect <tt>nfsmapid</tt> operations. For more information about the <tt>nsswitch.conf</tt> file, see the <a href="http://docs.sun.com/doc/819-2251/nsswitch.conf-4?a=view"><tt>nsswitch.conf</tt>(4)</a> man page.</p></li>
<li><p>To ensure that the NFS version 4 clients are capable of mounting file systems from different domains, <tt>nfsmapid</tt> relies on the configuration of the DNS TXT resource record (RR), <tt>_nfsv4idmapdomain</tt>. For more information about configuring the <tt>_nfsv4idmapdomain</tt> resource record, see <a href="#epubp"><tt>nfsmapid</tt> and DNS TXT Records</a>. Also, note the following:</p>
<ul><li><p>The DNS TXT RR should be explicitly configured on the DNS server with the desired domain information.</p></li>
<li><p>The <tt>/etc/resolv.conf</tt> file should be configured with the desired parameters to enable the <tt>resolver</tt> to find the DNS server and search the TXT records for client and server NFS version 4 domains.</p></li></ul>
<p>For more information, see the following:</p>
<ul><li><p><a href="#epubt">Precedence Rules</a></p></li>
<li><p><a href="#gbvgf">Configuring the NFS Version 4 Default Domain</a></p></li>
<li><p><a href="http://docs.sun.com/doc/819-2251/resolv.conf-4?a=view"><tt>resolv.conf</tt>(4)</a> man page</p></li></ul>
</li></ul>


<a name="epubt"></a><h5>Precedence Rules</h5>
<a name="indexterm-535"></a><p>For <tt>nfsmapid</tt> to work properly, NFS version 4 clients and servers must have
the same domain. To ensure matching NFS version 4 domains, <tt>nfsmapid</tt> follows
these strict precedence rules:</p>
<ol><li><p>The daemon first checks the <tt>/etc/default/nfs</tt> file for a value that has been assigned to the NFSMAPID_DOMAIN keyword. If a value is found, the assigned value takes precedence over any other settings. The assigned value is appended to the outbound attribute strings and is compared against inbound attribute strings. For more information about keywords in the <tt>/etc/default/nfs</tt> file, see <a href="rfsrefer-6.html#rfsrefer-133">Keywords for the <tt>/etc/default/nfs</tt> File</a>. For procedural information, see <a href="rfsadmin-68.html">Setting Up NFS Services</a>.</p>
<hr><p><b>Note - </b>The use of the NFSMAPID_DOMAIN setting is not scalable and is not recommended for large deployments.</p>
<hr>
</li>
<li><p>If no value has been assigned to NFSMAPID_DOMAIN, then the daemon checks for a domain name from a DNS TXT RR. <tt>nfsmapid</tt> relies on directives in the <tt>/etc/resolv.conf</tt> file that are used by the set of routines in the <tt>resolver</tt>. The <tt>resolver</tt> searches through the configured DNS servers for the <tt>_nfsv4idmapdomain</tt> TXT RR. Note that the use of DNS TXT records is more scalable. For this reason, continued use of TXT records is much preferred over setting the keyword in the <tt>/etc/default/nfs</tt> file.</p></li>
<li><p>If no DNS TXT record provides a domain name, then by default the <tt>nfsmapid</tt> daemon uses the configured DNS domain.</p></li>
<li><p>If the <tt>/etc/resolv.conf</tt> file does not exist, <tt>nfsmapid</tt> obtains the NFS version 4 domain name by following the behavior of the <tt>domainname</tt> command. Specifically, if the <tt>/etc/defaultdomain</tt> file exists, <tt>nfsmapid</tt> uses the contents of that file for the NFS version 4 domain. If the <tt>/etc/defaultdomain</tt> file does not exist, <tt>nfsmapid</tt> uses the domain name that is provided by the network's configured naming service. For more information, see the <a href="http://docs.sun.com/doc/819-2240/domainname-1m?a=view"><tt>domainname</tt>(1M)</a> man page.</p></li></ol>


<a name="epubp"></a><h5><tt>nfsmapid</tt> and DNS TXT Records</h5>
<a name="indexterm-536"></a><p>The ubiquitous nature of DNS provides an efficient storage and distribution mechanism for
the NFS version 4 domain name. Additionally, because of the inherent scalability of
DNS, the use of DNS TXT resource records is the preferred method for
configuring the NFS version 4 domain name for large deployments. You should configure
the <tt>_nfsv4idmapdomain</tt> TXT record on enterprise-level DNS servers. Such configurations ensure that any
NFS version 4 client or server can find its NFS version 4 domain
by traversing the DNS tree.</p><p>The following is an example of a preferred entry for enabling the
DNS server to provide the NFS version 4 domain name:</p><pre>_nfsv4idmapdomain        IN        TXT            "foo.bar"</pre><p>In this example, the domain name to configure is the value that
is enclosed in  double-quotes. Note that no <tt>ttl</tt> field is specified and that
no domain is appended to <tt>_nfsv4idmapdomain</tt>, which is the value in the <tt>owner</tt>
field. This configuration enables the TXT record to use the zone's <tt>${ORIGIN}</tt> entry
from the Start-Of-Authority (SOA) record. For example, at different levels of the domain namespace,
the record could read as follows:</p><pre>_nfsv4idmapdomain.subnet.yourcorp.com.    IN    TXT    "foo.bar"
_nfsv4idmapdomain.yourcorp.com.           IN    TXT    "foo.bar"</pre><p>This configuration provides DNS clients with the added flexibility of using the <tt>resolv.conf</tt>
file to search up the DNS tree hierarchy. See the <a href="http://docs.sun.com/doc/819-2251/resolv.conf-4?a=view"><tt>resolv.conf</tt>(4)</a> man page.
This capability provides a higher probability of finding the TXT record. For even
more flexibility, lower level DNS sub-domains can define their own DNS TXT resource
 records (RRs). This capability enables lower level DNS sub-domains to override the
TXT record that is defined by the top level DNS domain.</p>
<hr><p><b>Note - </b>The domain that is specified by the TXT record can be an
arbitrary string that does not necessarily match the DNS domain for clients and
servers that use NFS version 4. You have the option of not sharing
NFS version 4 data with other DNS domains.</p>
<hr>


<a name="gcpfe"></a><h5>Checking for the NFS Version 4 Domain</h5>
<a name="indexterm-537"></a><p>Before assigning a value for your network's NFS version 4 domain, check to
see if an NFS version 4 domain has already been configured for
your network. The  following examples provide ways of identifying your network's NFS
version 4 domain.</p>
<ul><li><p>To identify the NFS version 4 domain from a DNS TXT RR, use either the <tt>nslookup</tt> or the <tt>dig</tt> command:</p><p>The following provides sample output for the <tt>nslookup</tt> command:</p><pre># <tt><b>nslookup -q=txt _nfsv4idmapdomain</b></tt>
Server:         10.255.255.255
Address:        10.255.255.255#53

_nfsv4idmapdomain.example.company.com text = "company.com"</pre><p>See this sample output for the <tt>dig</tt> command:</p><pre># <tt><b>dig +domain=</tt><i>example.company.com</i><tt> -t TXT _nfsv4idmapdomain</b></tt>
...
;; QUESTION SECTION:
;_nfsv4idmapdomain.example.company.com. IN    TXT

;; ANSWER SECTION:
_nfsv4idmapdomain.example.company.com. 21600 IN TXT   "company.com"

;; AUTHORITY SECTION:
...</pre><p>For information about setting up a DNS TXT RR, see <a href="#epubp"><tt>nfsmapid</tt> and DNS TXT Records</a>.</p></li>
<li><p>If your network is not setup with a NFS version 4 DNS TXT RR, use the following command to identify your NFS version 4 domain from the DNS domain name:</p><pre># <tt><b>egrep domain /etc/resolv.conf</b></tt>
domain example.company.com</pre></li>
<li><p>If the <tt>/etc/resolv.conf</tt> file is not configured to provide a DNS domain name for the client, use the following command to identify the domain from the network's NFS version 4 domain configuration:</p><pre># <tt><b>cat /var/run/nfs4_domain</b></tt>
company.com</pre></li>
<li><p>If you are using a different naming service, such as NIS, use the following command to identify the domain for the naming service configured for your network:</p><pre><tt><b># domainname</b></tt>
it.example.company.com</pre></li></ul>
<p>For more information, see the following man pages:</p>
<ul><li><p><a href="http://docs.sun.com/doc/819-2240/nslookup-1m?a=view"><tt>nslookup</tt>(1M)</a></p></li>
<li><p><a href="http://docs.sun.com/doc/819-2240/dig-1m?a=view"><tt>dig</tt>(1M)</a></p></li>
<li><p><a href="http://docs.sun.com/doc/819-2251/resolv.conf-4?a=view"><tt>resolv.conf</tt>(4)</a></p></li>
<li><p><a href="http://docs.sun.com/doc/819-2240/domainname-1m?a=view"><tt>domainname</tt>(1M)</a></p></li></ul>


<a name="gbvgf"></a><h5>Configuring the NFS Version 4 Default Domain</h5>
<a name="indexterm-538"></a><p>This section describes how the network obtains the desired default domain:</p>
<ul><li><p>For the Solaris Express 5/06 release, see <a href="#gbvgj">Configuring an NFS Version 4 Default Domain in the Solaris Express 5/06 Release</a>.</p></li>
<li><p>For the initial Solaris 10 release, see <a href="#gbvgu">Configuring an NFS Version 4 Default Domain in the Solaris 10 Release</a>.</p></li></ul>


<a name="gbvgj"></a><h5>Configuring an NFS Version 4 Default Domain in the Solaris Express 5/06 Release</h5>
<p>In the initial Solaris 10 release, the domain was defined during the first
system reboot after installing the OS. In the Solaris Express 5/06 release, the
NFS version 4 domain is defined during the installation of the OS.
To provide this functionality, the following features have been added: </p>
<ul><li><p>The <tt>sysidtool</tt> command includes the <tt>sysidnfs4</tt> program. This program runs during the installation process to determine whether an NFS version 4 domain has been configured for the network. See the man pages for <a href="http://docs.sun.com/doc/819-2240/sysidtool-1m?a=view"><tt>sysidtool</tt>(1M)</a> and <a href="http://docs.sun.com/doc/819-2240/sysidnfs4-1m?a=view"><tt>sysidnfs4</tt>(1M)</a>.</p></li>
<li><p>The <tt>sysidcfg</tt> file has a new keyword, <tt>nfs4_domain</tt>. This keyword can be used to define the NFS version 4 domain. Note that other keywords can also be defined in the <tt>sysidcfg</tt> file. See the <a href="http://docs.sun.com/doc/819-2251/sysidcfg-4?a=view"><tt>sysidcfg</tt>(4)</a> man page.</p></li></ul>
<p>The following describes how the functionality operates:</p>
<ol><li><p>The <tt>sysidnfs4</tt> program checks the <tt>/etc/.sysIDtool.state</tt> file to determine whether an NFS version 4 domain has been identified.</p>
<ul><li><p>If the <tt>.sysIDtool.state</tt> file shows that an NFS version 4 domain has been configured for the network, the <tt>sysidnfs4</tt> program makes no further checks. See the following example of a <tt>.sysIDtool.state</tt> file:</p><pre>1       # System previously configured?
1       # Bootparams succeeded?
1       # System is on a network?
1       # Extended network information gathered?
1       # Autobinder succeeded?
1       # Network has subnets?
1       # root password prompted for?
1       # locale and term prompted for?
1       # security policy in place
1       # NFSv4 domain configured
xterms</pre><p>The <tt>1</tt> that appears before <tt># NFSv4 domain configured</tt> confirms that the NFS version 4 domain has been configured.</p></li>
<li><p>If the <tt>.sysIDtool.state</tt> file shows that no NFS version 4 domain has been configured for the network, the <tt>sysidnfs4</tt> program must make further checks. See the following example of a <tt>.sysIDtool.state</tt> file:</p><pre>1       # System previously configured?
1       # Bootparams succeeded?
1       # System is on a network?
1       # Extended network information gathered?
1       # Autobinder succeeded?
1       # Network has subnets?
1       # root password prompted for?
1       # locale and term prompted for?
1       # security policy in place
0       # NFSv4 domain configured
xterms</pre><p>The <tt>0</tt> that appears before <tt># NFSv4 domain configured</tt> confirms that no NFS version 4 domain has been configured.</p></li></ul>
</li>
<li><p>If no NFS version 4 domain has been identified, the <tt>sysidnfs4</tt> program checks the <tt>nfs4_domain</tt> keyword in the <tt>sysidcfg</tt> file.</p>
<ul><li><p>If a value for <tt>nfs4_domain</tt> exists, that value is assigned to the NFSMAPID_DOMAIN keyword in the <tt>/etc/default/nfs</tt> file. Note that any value assigned to NFSMAPID_DOMAIN overrides the dynamic domain selection capability of the <tt>nfsmapid</tt> daemon. For more information about the dynamic domain selection capability of <tt>nfsmapid</tt>, see <a href="#epubt">Precedence Rules</a>.</p></li>
<li><p>If no value for <tt>nfs4_domain</tt> exists, the <tt>sysidnfs4</tt> program identifies the domain that <tt>nfsmapid</tt> derives from the operating system's configured name services. This derived value is presented as a default domain at an interactive prompt that gives you the option of accepting the default value or assigning a different NFS version 4 domain.</p></li></ul>
</li></ol>
<p>This functionality makes the following obsolete:</p>
<ul><li><p>The sample JumpStart<sup>TM</sup> script, <tt>set_nfs4_domain</tt>, which was provided in the initial Solaris 10 media distribution is no longer required and is discouraged.</p></li>
<li><p>The <tt>/etc/.NFS4inst_state.domain</tt> file, which was created by the previous implementation of the <tt>sysidnfs4</tt> program, is no longer required.</p></li></ul>

<hr><p><b>Note - </b>Because of the inherent ubiquitous and scalable nature of DNS, the use of
DNS TXT records for configuring the domain of large NFS version 4 deployments
continues to be preferred and strongly encouraged. See <a href="#epubp"><tt>nfsmapid</tt> and DNS TXT Records</a>.</p>
<hr>
<p>For specific information about the Solaris installation process, see the following:</p>
<ul><li><p><a href="http://docs.sun.com/doc/819-2393"><i>Solaris Express Installation Guide: Basic Installations</i></a></p></li>
<li><p><a href="http://docs.sun.com/doc/819-2394"><i>Solaris Express Installation Guide: Network-Based Installations</i></a></p></li></ul>


<a name="gbvgu"></a><h5>Configuring an NFS Version 4 Default Domain in the Solaris 10 Release</h5>
<p>In the initial Solaris 10 release of NFS version 4, if your
network includes multiple DNS domains, but only has a single UID and GID
namespace, all clients must use one value for NFSMAPID_DOMAIN.  For sites that
use DNS, <tt>nfsmapid</tt> resolves this issue by obtaining  the domain name
from the value that you assigned to <tt>_nfsv4idmapdomain</tt>.  For more information, see <a href="#epubp"><tt>nfsmapid</tt> and DNS TXT Records</a>. If
your  network is not configured to use DNS, during the first
system boot the Solaris OS uses the <a href="http://docs.sun.com/doc/819-2240/sysidconfig-1m?a=view"><tt>sysidconfig</tt>(1M)</a> utility to provide the 
following prompts for an NFS version 4 domain name:</p><pre>This system is configured with NFS version 4, which uses a 
domain name that is automatically derived from the system's 
name services. The derived domain name is sufficient for most 
configurations. In a few cases, mounts that cross different 
domains might cause files to be owned by <tt>nobody</tt> due to the 
lack of a common domain name.

Do you need to override the system's default NFS verion 4 domain 
name (yes/no)? [<i>no</i>]</pre><p>The default response is <tt>[no]</tt>. If you choose <tt>[no]</tt>, you see the
following:</p><pre>For more information about how the NFS version 4 default domain name is 
derived and its impact, refer to the man pages for <tt>nfsmapid(1M)</tt> and 
<tt>nfs(4)</tt>, and the System Administration Guide: Network Services.</pre><p>If you choose <tt>[yes]</tt>, you see this prompt:</p><pre>Enter the domain to be used as the NFS version 4 domain name.
NFS version 4 domain name []:</pre>
<hr><p><b>Note - </b>If a value for NFSMAPID_DOMAIN exists in <tt>/etc/default/nfs</tt>, the <tt>[domain_name]</tt> that you provide
overrides that value.</p>
<hr>


<a name="feoos"></a><h5>Additional Information About <tt>nfsmapid</tt></h5>
<a name="indexterm-539"></a><p>For more information about <tt>nfsmapid</tt>, see the following:</p>
<ul><li><p><a href="http://docs.sun.com/doc/819-2240/nfsmapid-1m?a=view"><tt>nfsmapid</tt>(1M)</a> man page</p></li>
<li><p><a href="http://docs.sun.com/doc/819-2251/nfs-4?a=view"><tt>nfs</tt>(4)</a> man page</p></li>
<li><p><a href="http://www.ietf.org/rfc/rfc1464.txt">http://www.ietf.org/rfc/rfc1464.txt</a></p></li>
<li><p><a href="rfsrefer-45.html#gande">ACLs and <tt>nfsmapid</tt> in NFS Version 4</a></p></li></ul>


<a name="rfsrefer-12"></a><h4><tt>statd</tt> Daemon</h4>
<a name="indexterm-540"></a><a name="indexterm-541"></a><p>This daemon works with <tt>lockd</tt> to provide crash and recovery functions for the
lock manager. The <tt>statd</tt> daemon tracks the clients that hold locks on an
NFS server. If a server crashes, on rebooting <tt>statd</tt> on the server contacts
<tt>statd</tt> on the client. The client <tt>statd</tt> can then attempt to reclaim any locks
on the server. The client <tt>statd</tt> also informs the server <tt>statd</tt> when a
client has crashed so that the client's locks on the server can be
cleared. You have no options to select with this daemon. For more information,
see the <a href="http://docs.sun.com/doc/819-2240/statd-1m?a=view"><tt>statd</tt>(1M)</a> man page. </p><p>In the Solaris 7 release, the way that <tt>statd</tt> tracks the clients has
been improved. In all earlier Solaris releases, <tt>statd</tt> created files in <tt>/var/statmon/sm</tt> for
each client by using the client's unqualified host name. This file naming caused
problems if you had two clients in different domains that shared a host
name, or if clients were not resident in the same domain as the
NFS server. Because the unqualified host name only lists the host name, without
any domain or IP-address information, the older version of <tt>statd</tt> had no way
to differentiate between these types of clients. To fix this problem, the Solaris
7 <tt>statd</tt> creates a symbolic link in <tt>/var/statmon/sm</tt> to the unqualified host name by
using the IP address of the client. The new link resembles the
following:</p><pre># ls -l /var/statmon/sm
lrwxrwxrwx   1 daemon          11 Apr 29 16:32 ipv4.192.168.255.255 -> myhost
lrwxrwxrwx   1 daemon          11 Apr 29 16:32 ipv6.fec0::56:a00:20ff:feb9:2734 -> v6host
--w-------   1 daemon          11 Apr 29 16:32 myhost
--w-------   1 daemon          11 Apr 29 16:32 v6host</pre><p>In this example, the client host name is <tt>myhost</tt> and the client's IP
address is <tt>192.168.255.255</tt>. If another host with the name <tt>myhost</tt> were mounting a
file system, two symbolic links would lead to the host name.</p>
<hr><p><b>Note - </b>NFS version 4 does not use this daemon.</p>
<hr>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="rfsrefer-6.html">Previous</a>
             </td>
             <td align="right">
                 <a href="rfsrefer-13.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

