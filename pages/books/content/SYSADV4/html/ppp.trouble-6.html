<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Solving PPP-Related and PPPoE-Related Problems - System Administration Guide: Network Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Network Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ppp.trouble-16.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ppp.trouble-25.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="netservices-1.html">Part&nbsp;I&nbsp;Network Services Topics</a></p>
<p class="toc level2"><a href="nsov-1.html">1.&nbsp;&nbsp;Network Service (Overview)</a></p>
<p class="toc level2"><a href="nca-1.html">2.&nbsp;&nbsp;Managing Web Cache Servers</a></p>
<p class="toc level2"><a href="time-1.html">3.&nbsp;&nbsp;Time-Related Services</a></p>
<p class="toc level1 tocsp"><a href="rfstm-1.html">Part&nbsp;II&nbsp;Accessing Network File Systems Topics</a></p>
<p class="toc level2"><a href="rfsintro-2.html">4.&nbsp;&nbsp;Managing Network File Systems (Overview)</a></p>
<p class="toc level2"><a href="rfsadmin-8.html">5.&nbsp;&nbsp;Network File System Administration (Tasks)</a></p>
<p class="toc level2"><a href="rfsrefer-1.html">6.&nbsp;&nbsp;Accessing Network File Systems (Reference)</a></p>
<p class="toc level1 tocsp"><a href="slptm.html">Part&nbsp;III&nbsp;SLP Topics</a></p>
<p class="toc level2"><a href="slparch-16.html">7.&nbsp;&nbsp;SLP (Overview)</a></p>
<p class="toc level2"><a href="slp.setup-10.html">8.&nbsp;&nbsp;Planning and Enabling SLP (Tasks)</a></p>
<p class="toc level2"><a href="ch.configuration-6.html">9.&nbsp;&nbsp;Administering SLP (Tasks)</a></p>
<p class="toc level2"><a href="legacy-7.html">10.&nbsp;&nbsp;Incorporating Legacy Services</a></p>
<p class="toc level2"><a href="slpreference.html">11.&nbsp;&nbsp;SLP (Reference)</a></p>
<p class="toc level1 tocsp"><a href="mailtm-1.html">Part&nbsp;IV&nbsp;Mail Services Topics</a></p>
<p class="toc level2"><a href="mailintro-1.html">12.&nbsp;&nbsp;Mail Services (Overview)</a></p>
<p class="toc level2"><a href="mailadmin-1.html">13.&nbsp;&nbsp;Mail Services (Tasks)</a></p>
<p class="toc level2"><a href="mailrefer-1.html">14.&nbsp;&nbsp;Mail Services (Reference)</a></p>
<p class="toc level1 tocsp"><a href="modemtm-1.html">Part&nbsp;V&nbsp;Serial Networking Topics</a></p>
<p class="toc level2"><a href="pppsvrconfig.intro-1.html">15.&nbsp;&nbsp;Solaris PPP 4.0 (Overview)</a></p>
<p class="toc level2"><a href="pppsvrconfig.p2plink-1.html">16.&nbsp;&nbsp;Planning for the PPP Link (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.dialin-1.html">17.&nbsp;&nbsp;Setting Up a Dial-up PPP Link (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.leased-1.html">18.&nbsp;&nbsp;Setting Up a Leased-Line PPP Link (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.auth-1.html">19.&nbsp;&nbsp;Setting Up PPP Authentication (Tasks)</a></p>
<p class="toc level2"><a href="ppp.pppoe-1.html">20.&nbsp;&nbsp;Setting Up a PPPoE Tunnel (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.troubleshoot-1.html">21.&nbsp;&nbsp;Fixing Common PPP Problems (Tasks)</a></p>
<p class="toc level3"><a href="pppsvrconfig.troubleshoot-2.html">Solving PPP Problems (Task Map)</a></p>
<p class="toc level3"><a href="ppp.trouble-16.html">Tools for Troubleshooting PPP</a></p>
<p class="toc level4"><a href="ppp.trouble-16.html#ppp.trouble-10">How to Obtain Diagnostic Information From <tt>pppd</tt></a></p>
<p class="toc level4"><a href="ppp.trouble-16.html#ppp.trouble-21">How to Turn on PPP Debugging</a></p>
<div class="onpage">
<p class="toc level3 tocsp"><a href="">Solving PPP-Related and PPPoE-Related Problems</a></p>
<p class="toc level4"><a href="#ppp.trouble-75">How to Diagnose Network Problems</a></p>
<p class="toc level4"><a href="#ppp.trouble-93">How to Diagnose and Fix Communications Problems</a></p>
<p class="toc level4"><a href="#ppp.trouble-100">How to Diagnose Problems With the PPP Configuration</a></p>
<p class="toc level4"><a href="#ppp.trouble-27">How to Diagnose Modem Problems</a></p>
<p class="toc level4"><a href="#ppp.trouble-44">How to Obtain Debugging Information for Chat Scripts</a></p>
<p class="toc level4"><a href="#ppp.trouble-35">How to Diagnose and Fix Serial-Line Speed Problems</a></p>
<p class="toc level4"><a href="#ppp.trouble-56">How to Obtain Diagnostic Information for PPPoE</a></p>
</div>
<p class="toc level3 tocsp"><a href="ppp.trouble-25.html">Fixing Leased-Line Problems</a></p>
<p class="toc level3"><a href="ppp.trouble-92.html">Diagnosing and Fixing Authentication Problems</a></p>
<p class="toc level2 tocsp"><a href="pppsvrconfig.reference-1.html">22.&nbsp;&nbsp;Solaris PPP 4.0 (Reference)</a></p>
<p class="toc level2"><a href="pppsvrconfig.convert.app-1.html">23.&nbsp;&nbsp;Migrating From Asynchronous Solaris PPP to Solaris PPP 4.0 (Tasks)</a></p>
<p class="toc level2"><a href="uucpov-1.html">24.&nbsp;&nbsp;UUCP (Overview)</a></p>
<p class="toc level2"><a href="uucptasks-1.html">25.&nbsp;&nbsp;Administering UUCP (Tasks)</a></p>
<p class="toc level2"><a href="uucpref-1.html">26.&nbsp;&nbsp;UUCP (Reference)</a></p>
<p class="toc level1 tocsp"><a href="wwrstm.html">Part&nbsp;VI&nbsp;Working With Remote Systems Topics</a></p>
<p class="toc level2"><a href="wwrsov.html">27.&nbsp;&nbsp;Working With Remote Systems (Overview)</a></p>
<p class="toc level2"><a href="wuftp-17.html">28.&nbsp;&nbsp;Administering the FTP Server (Tasks)</a></p>
<p class="toc level2"><a href="remotehowtoaccess-99941.html">29.&nbsp;&nbsp;Accessing Remote Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="netmonitortm-1.html">Part&nbsp;VII&nbsp;Monitoring Network Services Topics</a></p>
<p class="toc level2"><a href="netmonitor-1.html">30.&nbsp;&nbsp;Monitoring Network Performance (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="ppp.trouble-6"></a><h3>Solving PPP-Related and PPPoE-Related Problems</h3>
<p>Refer to the following sections for information about how to resolve PPP-related and PPPoE-related
problems.</p>
<ul><li><p><a href="#ppp.trouble-75">How to Diagnose Network Problems</a></p></li>
<li><p><a href="#ppp.trouble-108">Common Network Problems That Affect PPP</a></p></li>
<li><p><a href="#ppp.trouble-93">How to Diagnose and Fix Communications Problems</a></p></li>
<li><p><a href="#ppp.trouble-109">General Communications Problems That Affect PPP</a></p></li>
<li><p><a href="#ppp.trouble-100">How to Diagnose Problems With the PPP Configuration</a></p></li>
<li><p><a href="#ppp.trouble-110">Common PPP Configuration Problems</a></p></li>
<li><p><a href="#ppp.trouble-27">How to Diagnose Modem Problems</a></p></li>
<li><p><a href="#ppp.trouble-44">How to Obtain Debugging Information for Chat Scripts</a></p></li>
<li><p><a href="#ppp.trouble-111">Common Chat Script Problems</a></p></li>
<li><p><a href="#ppp.trouble-35">How to Diagnose and Fix Serial-Line Speed Problems</a></p></li>
<li><p><a href="#ppp.trouble-56">How to Obtain Diagnostic Information for PPPoE</a></p></li></ul>


<a name="ppp.trouble-75"></a><h4>How to Diagnose Network Problems</h4><p><a name="indexterm-1927"></a><a name="indexterm-1928"></a><a name="indexterm-1929"></a>If the PPP link becomes active but few hosts on the remote network are
reachable, a network problem could be indicated. The following procedure shows you how to
isolate and fix network problems that affect a PPP link. </p><ol>
<li><a name="ppp.trouble-step-89"></a><b>Become superuser on the local machine or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>. To configure a
role with the Primary Administrator profile, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><b>Shut down the problematic link.</b></li>
<li><a name="ppp.trouble-step-77"></a><b>Disable any optional protocols in the configuration files by adding the following options to your
PPP configuration:</b><pre>noccp novj nopcomp noaccomp default-asyncmap</pre><p>These options provide the simplest uncompressed PPP that is available. Try to invoke these
options as arguments to <tt>pppd</tt> on the command line. If you can reach the previously
unreachable hosts, add the options in either of the following places.</p>
<ul><li><p><tt>/etc/ppp/peers/</tt><i>peer-name</i>, after the <tt>call</tt> option</p></li>
<li><p><tt>/etc/ppp/options</tt>, ensuring that the options apply globally</p></li></ul>
</li>
<li><a name="ppp.trouble-step-78"></a><b>Call the remote peer. Then enable debugging features.</b><pre>% <tt><b>pppd debug call</b></tt> <i>peer-name</i></pre></li>
<li><b>Obtain verbose logs from the chat program by using the <tt>-v</tt> option of <tt>chat</tt>.</b><p>For example, use the following format in any PPP configuration file:</p><pre>connect 'chat -v -f <i>/etc/ppp/chatfile</i>'</pre><p><i>/etc/ppp/chatfile</i> represents the name of your chat file.</p></li>
<li><a name="ppp.trouble-step-79"></a><b>Try to re-create the problem by using Telnet or other applications to reach the remote
hosts.</b><p>Observe the debugging logs. If you still cannot reach remote hosts, the PPP problem might
be network-related.</p></li>
<li><a name="ppp.trouble-step-80"></a><b>Verify that the IP addresses of the remote hosts are registered Internet addresses.</b><p>Some organizations assign internal IP addresses that are known within the local network but
cannot be routed to the Internet. If the remote hosts are within your company,
you  must set up a name-to-address translation (NAT) server or proxy server to
reach the Internet. If the remote hosts are not within your company, you should report
the problem to the remote organization.</p></li>
<li><a name="ppp.trouble-step-81"></a><b>Examine the routing tables.</b><ol style="list-style-type: lower-alpha">
				 
<li><a name="ppp.trouble-step-82"></a><b>Check the routing tables on both the local machine and the peer.</b></li>
<li><a name="ppp.trouble-step-90"></a><b>Check the routing tables for any routers that are in the path from the
peer to the remote system.  Also check the routing tables for any routers on
the path back to the peer.</b><p>Ensure that the intermediate routers have not been misconfigured. Often the problem can be
found in the path back to the peer.</p></li></ol></li>
<li><a name="ppp.trouble-step-84"></a>(Optional) <b>If the machine is a router, check the optional features.</b><pre># <tt><b>ndd -set /dev/ip ip_forwarding 1</b></tt></pre><p>For more information about <tt>ndd</tt>, refer to the <a href="http://docs.sun.com/doc/819-2240/ndd-1m?a=view"><tt>ndd</tt>(1M)</a> man page.</p><p>In the Solaris 10 release, you can use <a href="http://docs.sun.com/doc/819-2240/routeadm-1m?a=view"><tt>routeadm</tt>(1M)</a>, instead of <tt>ndd</tt>(1M).</p><pre># <tt><b>routeadm -e ipv4-forwarding -u</b></tt></pre>
<hr><p><b>Note - </b>The <tt>ndd</tt> command is not persistent. The values set with this command are lost
when the system is rebooted. The <tt>routeadm</tt> command is persistent. The values set with
this command are maintained after the system is rebooted.</p>
<hr>
</li>
<li><a name="ppp.trouble-step-85"></a><b>Check the statistics that are obtained from <tt>netstat -s</tt> and similar tools.</b><p>For complete details about <tt>netstat</tt>, refer to the <a href="http://docs.sun.com/doc/819-2240/netstat-1m?a=view"><tt>netstat</tt>(1M)</a> man page.</p><ol style="list-style-type: lower-alpha">
				 
<li><a name="ppp.trouble-step-91"></a><b>Run statistics on the local machine.</b></li>
<li><a name="ppp.trouble-step-86"></a><b>Call the peer.</b></li>
<li><a name="ppp.trouble-step-87"></a><b>Observe the new statistics that are generated by <tt>netstat</tt> <tt>-s</tt>. For more information, refer to
<a href="#ppp.trouble-108">Common Network Problems That Affect PPP</a>.</b></li></ol></li>
<li><a name="ppp.trouble-step-88"></a><b>Check the DNS configuration.</b><p>A faulty name service configuration causes applications to fail because IP addresses cannot be resolved.</p></li></ol>

<a name="ppp.trouble-108"></a><h4>Common Network Problems That Affect PPP</h4>
<p><a name="indexterm-1930"></a>You can use the messages that are generated by <tt>netstat</tt>  <tt>-s</tt> to
fix the network problems that are shown in the following table. For related procedural
information, refer to <a href="#ppp.trouble-75">How to Diagnose Network Problems</a>.</p><a name="ppp.trouble-tbl-105"></a><h6>Table&nbsp;21-2 Common Network Problems That Affect PPP</h6><table><col width="33*"><col width="33*"><col width="33*"><tr><th align="left" valign="top" scope="column"><p>Message</p></th>
<th align="left" valign="top" scope="column"><p>Problem</p></th>
<th align="left" valign="top" scope="column"><p>Solution</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>IP packets not forwardable</tt></p></td>
<td align="left" valign="top" scope="row"><p>The local host is missing a route.</p></td>
<td align="left" valign="top" scope="row"><p>Add the missing route to
the local host's routing tables.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>ICMP input destination unreachable</tt></p></td>
<td align="left" valign="top" scope="row"><p>The local host is missing a route.</p></td>
<td align="left" valign="top" scope="row"><p>Add the missing route
to the local host's routing tables.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>ICMP time exceeded</tt></p></td>
<td align="left" valign="top" scope="row"><p>Two routers are forwarding the same destination address to
each other, causing the packet to bounce back and forth until the time-to-live (TTL) value
is exceeded.</p></td>
<td align="left" valign="top" scope="row"><p>Use <tt>traceroute</tt> to find the source of the routing loop, and then contact
the administrator of the router in error. For information about <tt>traceroute</tt>, refer to the <a href="http://docs.sun.com/doc/819-2240/traceroute-1m?a=view"><tt>traceroute</tt>(1M)</a>
man page.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>IP packets not forwardable</tt></p></td>
<td align="left" valign="top" scope="row"><p>The local host is missing a route.</p></td>
<td align="left" valign="top" scope="row"><p>Add the missing route to the local host's
routing table.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>ICMP input destination unreachable</tt></p></td>
<td align="left" valign="top" scope="row"><p>The local host is missing a route.</p></td>
<td align="left" valign="top" scope="row"><p>Add the missing route to the local
host's routing tables.</p></td>
</tr>
</table>

<a name="ppp.trouble-93"></a><h4>How to Diagnose and Fix Communications Problems</h4><p><a name="indexterm-1931"></a>Communications problems occur when the two peers cannot successfully establish a link. Sometimes these problems
are actually negotiation problems that are caused by incorrectly configured chat scripts. The following procedure
shows you how to clear communication problems. For clearing negotiation problems that are caused
by a faulty chat script, see <a href="#ppp.trouble-tbl-49">Table&nbsp;21-5</a>.</p><ol>
<li><a name="ppp.trouble-step-98"></a><b>Become superuser on the local machine or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>. To configure a
role with the Primary Administrator profile, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a></p></li>
<li><b>Call the peer.</b></li>
<li><a name="ppp.trouble-step-95"></a><b>Call the remote peer. Then enable debugging features.</b><pre>% <tt><b>pppd debug call</b></tt> <i>peer-name</i></pre><p>You might need to obtain debugging information from the peer in order to fix
certain communications problems.</p></li>
<li><a name="ppp.trouble-step-96"></a><b>Check the resulting logs for communication problems. For more information, refer to <a href="#ppp.trouble-109">General Communications Problems That Affect PPP</a>.</b></li></ol>

<a name="ppp.trouble-109"></a><h4>General Communications Problems That Affect PPP</h4>
<p><a name="indexterm-1932"></a>The following table describes symptoms that are related to log output from the procedure,
<a href="#ppp.trouble-93">How to Diagnose and Fix Communications Problems</a>.</p><a name="ppp.trouble-tbl-97"></a><h6>Table&nbsp;21-3 General Communications Problems That Affect PPP</h6><table><col width="24.07*"><col width="23.84*"><col width="51.10*"><tr><th align="left" valign="top" scope="column"><p>Symptom</p></th>
<th align="left" valign="top" scope="column"><p>Problem</p></th>
<th align="left" valign="top" scope="column"><p>Solution</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>too many Configure-Requests</tt></p></td>
<td align="left" valign="top" scope="row"><p>One peer cannot hear the other peer.</p></td>
<td align="left" valign="top" scope="row"><p>Check for the following problems:</p>
<ul><li><p>The machine or modem might have faulty cabling.</p></li>
<li><p>The modem configuration might have incorrect bit settings. Or, the configuration might have broken flow control.</p></li>
<li><p>The chat script might have failed. In this situation, see <a href="#ppp.trouble-tbl-49">Table&nbsp;21-5</a>.</p></li></ul>
</td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>The <tt>pppd debug</tt> output shows
that LCP starts, but higher-level protocols fail or show CRC errors.</p></td>
<td align="left" valign="top" scope="row"><p>The asynchronous control
character map (ACCM) is incorrectly set.</p></td>
<td align="left" valign="top" scope="row"><p>Use the <tt>default-async</tt> option to set the ACCM to
the standard default of FFFFFFFF. First, try to use <tt>default-async</tt> as an option
to <tt>pppd</tt> on the command line. If the problem clears, then add <tt>default-async</tt> to
<tt>/etc/ppp/options</tt> or to <tt>/etc/ppp/peers/</tt><i>peer-name</i> after the call option.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>The <tt>pppd debug</tt> output shows that IPCP
starts but terminates immediately.</p></td>
<td align="left" valign="top" scope="row"><p>IP addresses might be incorrectly configured.</p></td>
<td align="left" valign="top" scope="row">
<ol><li><p>Check the chat script to verify whether the script has incorrect IP addresses.</p></li>
<li><p>If the chat script is correct, request debug logs for the peer, and check IP addresses in the peer logs. </p></li></ol>
</td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>The link exhibits very poor performance.</p></td>
<td align="left" valign="top" scope="row"><p>The modem
might be incorrectly configured, with flow-control configuration errors, modem setup errors, and incorrectly configured DTE
rates.</p></td>
<td align="left" valign="top" scope="row"><p>Check the modem configuration.  Adjust the configuration if necessary.</p></td>
</tr>
</table>

<a name="ppp.trouble-100"></a><h4>How to Diagnose Problems With the PPP Configuration</h4><p><a name="indexterm-1933"></a><a name="indexterm-1934"></a>Some PPP problems can be traced to problems in the PPP configuration files. The
following procedure shows you how to isolate and fix general configuration problems.</p><ol>
<li><a name="ppp.trouble-step-106"></a><b>Become superuser on the local machine or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>. To configure a
role with the Primary Administrator profile, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><a name="ppp.trouble-step-102"></a><b>Call the remote peer. Then enable debugging features.</b><pre>% <tt><b>pppd debug call</b></tt> <i>peer-name</i></pre></li>
<li><a name="ppp.trouble-step-103"></a><b>Check the resulting log for the configuration problems. For more information, refer to <a href="#ppp.trouble-110">Common PPP Configuration Problems</a>.</b></li></ol>

<a name="ppp.trouble-110"></a><h4>Common PPP Configuration Problems</h4>
<p><a name="indexterm-1935"></a>The following table describes symptoms that are related to log output from the procedure,
<a href="#ppp.trouble-100">How to Diagnose Problems With the PPP Configuration</a>.</p><a name="ppp.trouble-tbl-104"></a><h6>Table&nbsp;21-4 Common PPP Configuration Problems</h6><table><col width="27.45*"><col width="27.45*"><col width="44.09*"><tr><th align="left" valign="top" scope="column"><p>Symptom</p></th>
<th align="left" valign="top" scope="column"><p>Problem</p></th>
<th align="left" valign="top" scope="column"><p>Solution</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>pppd debug</tt> output contains the error message, <tt>Could not determine remote IP address</tt>.</p></td>
<td align="left" valign="top" scope="row"><p>The <tt>/etc/ppp/peers/</tt><i>peer-name</i> file does not have an IP
address for the peer. The peer does not provide an IP address during link
negotiation.</p></td>
<td align="left" valign="top" scope="row"><p>Supply an IP address for the peer on the pppd command line or
in <tt>/etc/ppp/peers/</tt><i>peer-name</i> by using the following format:</p><p>:10.0.0.10</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>pppd debug</tt> output shows that CCP data compression has failed.
The output also indictes that the link is dropped.</p></td>
<td align="left" valign="top" scope="row"><p>The peers' PPP compression configurations might
be in conflict.  </p></td>
<td align="left" valign="top" scope="row"><p>Disable CCP compression by adding the <tt>noccp</tt> option to <tt>/etc/ppp/options</tt>
on one of the peers.</p></td>
</tr>
</table>

<a name="ppp.trouble-27"></a><h4>How to Diagnose Modem Problems</h4><p><a name="indexterm-1936"></a><a name="indexterm-1937"></a>Modems can be major problem areas for a dial-up link. The most common indicator
of problems with the modem configuration is no response from the peer. However, you
might have difficulties when determining if a link problem is indeed the result of modem
configuration problems. </p><p>For basic modem troubleshooting suggestions, refer to <a href="http://docs.sun.com/doc/819-2380/modsetup-58?a=view">Troubleshooting Terminal and Modem Problems in <i>System Administration Guide: Advanced Administration</i></a>. Modem manufacturers' documentation and web sites also
contain solutions for problems with their particular equipment. The following procedure helps determine whether a
faulty modem configuration causes link problems.</p><ol>
<li><a name="ppp.trouble-step-69"></a><b>Call the peer with debugging turned on, as explained in <a href="ppp.trouble-16.html#ppp.trouble-21">How to Turn on PPP Debugging</a>.</b></li>
<li><a name="ppp.trouble-step-29"></a><b>Display the resulting <tt>/var/log/pppdebug</tt> log to check for faulty modem configuration.</b></li>
<li><a name="ppp.trouble-step-32"></a><b>Use <tt>ping</tt> to send packets of various sizes over the link.</b><p>For complete details about <tt>ping</tt>, refer to the <a href="http://docs.sun.com/doc/819-2240/ping-1m?a=view"><tt>ping</tt>(1M)</a> man page.</p><p>If small packets are received but larger packets are dropped, modem problems are indicated.</p></li>
<li><a name="ppp.trouble-step-33"></a><b>Check for errors on interface <tt>sppp0</tt>:</b><pre>% <tt><b>netstat -ni</b></tt>
Name  Mtu  Net/Dest   Address      Ipkts    Ierrs Opkts    Oerrs Collis Queue 
lo0   8232 127.0.0.0  127.0.0.1    826808   0     826808   0     0      0     
hme0  1500 172.21.0.0 172.21.3.228 13800032 0     1648464  0     0      0     
<tt><b>sppp0 1500 10.0.0.2 10.0.0.1 210 0 128 0 0 0</b></tt></pre><p>If interface errors increase over time, the modem configuration might have problems.</p></li></ol><h6>Troubleshooting</h6><p>When you display the resulting <tt>/var/log/pppdebug</tt> log, the following symptoms in the output can
indicate a faulty modem configuration. The local machine can hear the peer, but the
peer cannot hear the local machine.</p>
<ul><li><p>No &ldquo;<tt>recvd</tt>&rdquo; messages have come from the peer.</p></li>
<li><p>The output contains LCP messages from the peer, but the link fails with <tt>too many LCP Configure Requests</tt> messages that are sent by the local machine.</p></li>
<li><p>The link terminates with a SIGHUP signal.</p></li></ul>


<a name="ppp.trouble-44"></a><h4>How to Obtain Debugging Information for Chat Scripts</h4><p><a name="indexterm-1938"></a>Use the following procedure for obtaining debugging information from <tt>chat</tt> and suggestions for clearing common
problems. For more information, refer to <a href="#ppp.trouble-111">Common Chat Script Problems</a>.</p><ol>
<li><a name="ppp.trouble-step-70"></a><b>Become superuser on the dial-out machine or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>. To configure
a role with the Primary Administrator profile, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><a name="ppp.trouble-step-46"></a><b>Edit the <tt>/etc/ppp/peers/</tt><i>peer-name</i> file for the peer to be called.</b></li>
<li><a name="ppp.trouble-step-47"></a><b>Add <tt>-v</tt> as an argument to the <tt>chat</tt> command that is specified in
<tt>connect</tt> option.</b><pre>connect "/usr/bin/chat <tt><b>-v</b></tt> -f /etc/ppp/<i>chat-script-name</i>"</pre></li>
<li><a name="ppp.trouble-step-48"></a><b>View chat script errors in the file <tt>/etc/ppp/connect-errors</tt>.</b><p>The following is the main error that occurs with <tt>chat</tt>.</p><pre>Oct 31 08:57:13 deino chat[107294]: [ID 702911 local2.info] expect (CONNECT)
Oct 31 08:57:58 deino chat[107294]: [ID 702911 local2.info] alarm
Oct 31 08:57:58 deino chat[107294]: [ID 702911 local2.info] Failed</pre><p>The example shows timeout while waiting for a <tt>(CONNECT)</tt>string. When <tt>chat</tt> fails, you get the
following message from <tt>pppd</tt>:</p><pre>Connect script failed</pre></li></ol>

<a name="ppp.trouble-111"></a><h4>Common Chat Script Problems</h4>
<p><a name="indexterm-1939"></a>Chat scripts are trouble-prone areas for dial-up links. The following table lists common chat
script errors and gives suggestions for fixing the errors. For procedural information, refer to <a href="#ppp.trouble-44">How to Obtain Debugging Information for Chat Scripts</a>.</p><a name="ppp.trouble-tbl-49"></a><h6>Table&nbsp;21-5 Common Chat Script Problems</h6><table><col width="29.36*"><col width="31.75*"><col width="37.90*"><tr><th align="left" valign="top" scope="column"><p>Symptom</p></th>
<th align="left" valign="top" scope="column"><p>Problem</p></th>
<th align="left" valign="top" scope="column"><p>Solution</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>pppd debug</tt>
output contains <tt>Connect script failed</tt> </p></td>
<td align="left" valign="top" scope="row"><p>Your chat script supplies a user name and ssword.</p><pre>ogin: <i>user-name</i>
ssword: <i>password</i></pre><p>However, the peer
that you intended to connect to does not prompt for this information.</p></td>
<td align="left" valign="top" scope="row">
<ol><li><p>Delete the login and password from the chat script.</p></li>
<li><p>Try to call the peer again.</p></li>
<li><p>If you still get the message, call the ISP. Ask the ISP for the correct login sequence.</p></li></ol>
</td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>The <tt>/usr/bin/chat -v</tt> log
contains <tt>"expect (login:)" alarm read timed out</tt></p></td>
<td align="left" valign="top" scope="row"><p>Your chat script supplies a user name and ssword.</p><pre>ogin: pppuser
ssword: \q\U</pre><p>However, the peer that
you intend to connect to does not prompt for this information.</p></td>
<td align="left" valign="top" scope="row">
<ol><li><p>Delete the login and password from the chat script.</p></li>
<li><p>Try to call the peer again.</p></li>
<li><p>If you still get the message, call the ISP. Ask the ISP for the correct login sequence.</p></li></ol>
</td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>pppd debug</tt> output contains <tt>possibly looped-back</tt> </p></td>
<td align="left" valign="top" scope="row"><p>The
local machine or its peer is hanging at the command line and not running
PPP. An incorrectly configured login name and password are in the chat script.</p></td>
<td align="left" valign="top" scope="row"><p></p>
<ol><li><p>Delete the login and password from the chat script.</p></li>
<li><p>Try to call the peer again.</p></li>
<li><p>If you still get the message, call the ISP. Ask for the correct login sequence.</p></li></ol>
</td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-1940"></a><tt>pppd debug</tt> output shows
that LCP activates, but the link terminates soon afterward.</p></td>
<td align="left" valign="top" scope="row"><p>The password in the chat
script might be incorrect.</p></td>
<td align="left" valign="top" scope="row"><p></p>
<ol><li><p>Ensure that you have the correct password for the local machine.</p></li>
<li><p>Check the password in the chat script. Fix the password  if incorrect.</p></li>
<li><p>Try to call the peer again.</p></li>
<li><p>If you still get the message, call the ISP. Ask the ISP for the correct login sequence.</p></li></ol>
</td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Text from the peer begins with a tilde (~).</p></td>
<td align="left" valign="top" scope="row"><p>Your chat script
supplies a user name and ssword.</p><pre>ogin: pppuser
ssword: \q\U</pre><p>However, the peer that  you intend to connect
to does not prompt for this information.</p></td>
<td align="left" valign="top" scope="row"><p></p>
<ol><li><p>Delete the login and password from the chat script.</p></li>
<li><p>Try to call the peer again.</p></li>
<li><p>If you still get the message, call the ISP. Request the correct login sequence.</p></li></ol>
</td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>The modem hangs.</p></td>
<td align="left" valign="top" scope="row"><p>Your chat script contains the following
line to force the local machine to wait for the <tt>CONNECT</tt> message from the
peer:</p><pre>CONNECT &rdquo;</pre></td>
<td align="left" valign="top" scope="row"><p>Use the following line when you want the chat script to wait for CONNECT
from the peer:</p><pre>CONNECT \c</pre><p>End the chat script with <tt>~ \c</tt>. </p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>pppd debug</tt> output contains <tt>LCP: timeout sending Config-Requests</tt></p></td>
<td align="left" valign="top" scope="row"><p>Your chat
script contains the following line to force the local machine to wait for the
<tt>CONNECT</tt> message from the peer:</p><pre>CONNECT &rdquo;</pre></td>
<td align="left" valign="top" scope="row"><p>Use the following line when you want the chat script
to wait for CONNECT from the peer:</p><pre>CONNECT \c</pre><p>End the chat script with <tt>~ \c</tt>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-1941"></a><tt>pppd debug</tt> output contains
<tt>Serial link is not 8-bit clean</tt></p></td>
<td align="left" valign="top" scope="row"><p>Your chat script contains the following line to force the local machine to wait
for the <tt>CONNECT</tt> message from the peer:</p><pre>CONNECT &rdquo;</pre></td>
<td align="left" valign="top" scope="row"><p>Use the following line when you want the
chat script to wait for CONNECT from the peer:</p><pre>CONNECT \c</pre><p>End the chat script with
<tt>~ \c</tt>. </p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>pppd debug</tt> output contains <tt> Loopback detected</tt></p></td>
<td align="left" valign="top" scope="row"><p>Your chat script contains the following line to force the
local machine to wait for the <tt>CONNECT</tt> message from the peer:</p><pre>CONNECT &rdquo;</pre></td>
<td align="left" valign="top" scope="row"><p>Use the following line
when you want the chat script to wait for CONNECT from the peer:</p><pre>CONNECT \c</pre><p>End the
chat script with <tt>~ \c</tt>. </p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>pppd debug</tt> output contains <tt>SIGHUP</tt></p></td>
<td align="left" valign="top" scope="row"><p>Your chat script contains the following line
to force the local machine to wait for the <tt>CONNECT</tt> message from the peer:</p><pre>CONNECT &rdquo;</pre></td>
<td align="left" valign="top" scope="row"><p>Use
the following line when you want the chat script to wait for CONNECT from
the peer:</p><pre>CONNECT \c</pre><p>End the chat script with <tt>~ \c</tt>. </p></td>
</tr>
</table>

<a name="ppp.trouble-35"></a><h4>How to Diagnose and Fix Serial-Line Speed Problems</h4><p><a name="indexterm-1942"></a><a name="indexterm-1943"></a><a name="indexterm-1944"></a>Dial-in servers can experience problems because of conflicting speed settings. The following procedure helps you
to isolate the cause of the link problem to conflicting serial-line speeds.</p><p>The following behaviors cause speed problems:</p>
<ul><li><p>You invoked PPP through a program such as <tt>/bin/login</tt> and specified the speed of the line.</p></li>
<li><p>You started PPP from <tt>mgetty</tt> and accidentally supplied the bit rate.</p></li></ul>
<p>pppd changes the speed that was originally set for the line to the speed
that was set by <tt>/bin/login</tt> or <tt>mgetty</tt>.  As a result, the line
fails.</p><ol>
<li><a name="ppp.trouble-step-71"></a><b>Log in to the dial-in server. Call the peer with debugging enabled.</b><p>If you need instructions, see <a href="ppp.trouble-16.html#ppp.trouble-21">How to Turn on PPP Debugging</a>.</p></li>
<li><a name="ppp.trouble-step-37"></a><b>Display the resulting <tt>/var/log/pppdebug</tt> log.</b><p>Check the output for the following message:</p><pre>LCP too many configure requests</pre><p>This message indicates that the speeds of serial lines that were configured for PPP
might potentially be in conflict.</p></li>
<li><a name="ppp.trouble-step-39"></a><b>Check if PPP is invoked through a program such as <tt>/bin/login</tt> and the line speed
that was set.</b><p>In such a situation, <tt>pppd</tt> changes the originally configured line speed to the speed
that is specified in <tt>/bin/login</tt>.</p></li>
<li><a name="ppp.trouble-step-40"></a><b>Check if a user started PPP from the <tt>mgetty</tt> command and accidentally specified a
bit rate.</b><p>This action also causes serial-line speeds to conflict.</p></li>
<li><a name="ppp.trouble-step-41"></a><b>Fix the conflicting serial-line speed problem as follows:</b><ol style="list-style-type: lower-alpha">
				 
<li><a name="ppp.trouble-step-72"></a><b>Lock the DTE rate on the modem.</b></li>
<li><a name="ppp.trouble-step-42"></a><b>Do not use autobaud.</b></li>
<li><a name="ppp.trouble-step-43"></a><b>Do not change the line speed after configuration.</b></li></ol></li></ol>

<a name="ppp.trouble-56"></a><h4>How to Obtain Diagnostic Information for PPPoE</h4><p><a name="indexterm-1945"></a><a name="indexterm-1946"></a>You can use PPP and standard UNIX utilities to identify problems with PPPoE. When
you suspect that PPPoE is the cause of problems on a link, use the
following diagnostic tools to obtain troubleshooting information.</p><ol>
<li><a name="ppp.trouble-step-73"></a><b>Become superuser on the machine that runs the PPPoE tunnel, either PPPoE client or PPPoE
access server.</b></li>
<li><a name="ppp.trouble-step-58"></a><b>Turn on debugging, as explained in the procedure <a href="ppp.trouble-16.html#ppp.trouble-21">How to Turn on PPP Debugging</a>.</b></li>
<li><a name="ppp.trouble-step-59"></a><b>View the contents of the log file <tt>/var/log/pppdebug</tt>.</b><p><a name="indexterm-1947"></a><a name="indexterm-1948"></a>The following example shows part of a log file that was generated for a
link with a PPPoE tunnel.</p><pre>Sep  6 16:28:45 enyo pppd[100563]: [ID 702911 daemon.info] Plugin 
  pppoe.so loaded.
Sep  6 16:28:45 enyo pppd[100563]: [ID 860527 daemon.notice] pppd 
  2.4.0b1 (Sun Microsystems, Inc.,
Sep  5 2001 10:42:05) started by troot, uid 0
Sep  6 16:28:46 enyo pppd[100563]: [ID 702911 daemon.debug] connect option:
   '/usr/lib/inet/pppoec 
-v hme0' started (pid 100564)
Sep  6 16:28:46 enyo pppd[100563]: [ID 702911 daemon.info] Serial connection established.
Sep  6 16:28:46 enyo pppd[100563]: [ID 702911 daemon.info] Using interface sppp0
Sep  6 16:28:46 enyo pppd[100563]: [ID 702911 daemon.notice] Connect: sppp0
   &lt;--> /dev/sppptun
Sep  6 16:28:46 enyo pppd[100563]: [ID 702911 daemon.debug] /etc/ppp/pap-secrets
  is apparently empty
Sep  6 16:28:46 enyo pppd[100563]: [ID 702911 daemon.debug] /etc/ppp/chap-secrets
  is apparently empty
Sep  6 16:28:46 enyo pppd[100563]: [ID 702911 daemon.debug] sent 
  [LCP ConfReq id=0xef &lt;mru 1492> 
asyncmap 0x0 &lt;magic 0x77d3e953>&lt;pcomp>&lt;acomp>
Sep  6 16:28:46 enyo pppd[100563]: [ID 702911 daemon.debug] rcvd 
  [LCP ConfReq id=0x2a &lt;mru 1402>
asyncmap 0x0 &lt;magic 0x9985f048>&lt;pcomp>&lt;acomp </pre><p><a name="indexterm-1949"></a>If the debugging output does not help you isolate the problem, continue with this
procedure.</p></li>
<li><a name="ppp.trouble-step-61"></a><b><a name="indexterm-1950"></a><a name="indexterm-1951"></a>Get diagnostic messages from PPPoE.</b><pre># pppd connect "/usr/lib/inet/pppoec -v <i>interface-name</i><tt><b>"</b></tt></pre><p><tt>pppoec</tt> sends diagnostic information to the <tt>stderr</tt>. If you run <tt>pppd</tt> in the foreground,
the output appears on the screen. If <tt>pppd</tt> runs in the background, the output
is sent to <tt>/etc/ppp/connect-errors</tt>. </p><p>The next example shows the messages that are generated as the PPPoE tunnel is
negotiated.</p><pre>Connect option: '/usr/lib/inet/pppoec -v hme0' started (pid 100564)
/usr/lib/inet/pppoec: PPPoE Event Open (1) in state Dead (0): action SendPADI (2)
/usr/lib/inet/pppoec: Sending PADI to ff:ff:ff:ff:ff:ff: 18 bytes
/usr/lib/inet/pppoec: PPPoE State change Dead (0) -> InitSent (1)
/usr/lib/inet/pppoec: Received Active Discovery Offer from 8:0:20:cd:c1:2/hme0:pppoed
/usr/lib/inet/pppoec: PPPoE Event rPADO+ (5) in state InitSent (1): action SendPADR+ (5)
/usr/lib/inet/pppoec: Sending PADR to 8:0:20:cd:c1:2: 22 bytes
/usr/lib/inet/pppoec: PPPoE State change InitSent (1) -> ReqSent (3)
/usr/lib/inet/pppoec: Received Active Discovery Session-confirmation from
   8:0:20:cd:c1:2/hme0:pppoed
/usr/lib/inet/pppoec: PPPoE Event rPADS (7) in state ReqSent (3): action Open (7)
/usr/lib/inet/pppoec: Connection open; session 0002 on hme0:pppoe
/usr/lib/inet/pppoec: PPPoE State change ReqSent (3) -> Convers (4)
/usr/lib/inet/pppoec: connected</pre><p>If the diagnostic messages do not help you isolate the problem, continue with this
procedure.</p></li>
<li><a name="ppp.trouble-step-63"></a><b><a name="indexterm-1952"></a>Run <tt>snoop</tt>.  Then save the trace to a file.</b><p>For information about <tt>snoop</tt>, refer to the <a href="http://docs.sun.com/doc/819-2240/snoop-1m?a=view"><tt>snoop</tt>(1M)</a> man page.</p><pre># snoop -o <i>pppoe-trace-file</i></pre></li>
<li><a name="ppp.trouble-step-64"></a><b><a name="indexterm-1953"></a><a name="indexterm-1954"></a>View the <tt>snoop</tt> trace file.</b><pre># snoop -i <i>pppoe-trace-file</i> -v pppoe</pre><pre>ETHER: ----- Ether Header -----
ETHER:
ETHER: Packet 1 arrived at 6:35:2.77
ETHER: Packet size = 32 bytes
ETHER: Destination = ff:ff:ff:ff:ff:ff, (broadcast)
ETHER: Source      = 8:0:20:78:f3:7c, Sun
ETHER: Ethertype = 8863 (PPPoE Discovery)
ETHER:
PPPoE: ----- PPP Over Ethernet -----
PPPoE:
PPPoE: Version = 1
PPPoE: Type = 1
PPPoE: Code = 9 (Active Discovery Initiation)
PPPoE: Session Id = 0
PPPoE: Length = 12 bytes
PPPoE:
PPPoE: ----- Service-Name -----
PPPoE: Tag Type = 257
PPPoE: Tag Length = 0 bytes
PPPoE:
PPPoE: ----- Host-Uniq -----
PPPoE: Tag Type = 259
PPPoE: Tag Length = 4 bytes
PPPoE: Data = Ox00000002
PPPoE:
.
.
.
ETHER: ----- Ether Header -----
ETHER:
ETHER: Packet 5 arrived at 6:35:2.87
ETHER: Packet size = 60 bytes
ETHER: Destination = 8:0:20:78:f3:7c, Sun)
ETHER: Source      = 0:2:fd:39:7f:7, 
ETHER: Ethertype = 8864 (PPPoE Session)
ETHER:
PPPoE: ----- PPP Over Ethernet -----
PPPoE:
PPPoE: Version = 1
PPPoE: Type = 1
PPPoE: Code = 0 (PPPoE Session)
PPPoE: Session Id = 24383
PPPoE: Length = 20 bytes
PPPoE:
PPP: ----- Point-to-Point Protocol -----
PPP:
PPP-LCP: ----- Link Control Protocol -----
PPP-LCP:
PPP-LCP: Code = 1 (Configure Request)
PPP-LCP: Identifier = 80
PPP-LCP: Length = 18</pre></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ppp.trouble-16.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ppp.trouble-25.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

