<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Administering the Caching of Web Pages (Tasks) - System Administration Guide: Network Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Network Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="nca-44.html">Previous</a>
             </td>
             <td align="right">
                 <a href="nca-27.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="netservices-1.html">Part&nbsp;I&nbsp;Network Services Topics</a></p>
<p class="toc level2"><a href="nsov-1.html">1.&nbsp;&nbsp;Network Service (Overview)</a></p>
<p class="toc level2"><a href="nca-1.html">2.&nbsp;&nbsp;Managing Web Cache Servers</a></p>
<p class="toc level3"><a href="nca-2.html">Network Cache and Accelerator (Overview)</a></p>
<p class="toc level3"><a href="gcbks.html">Web Servers Using the Secure Sockets Layer Protocol</a></p>
<p class="toc level3"><a href="nca-35.html">Managing Web Cache Servers (Task Map)</a></p>
<p class="toc level3"><a href="nca-44.html">Planning for NCA</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Administering the Caching of Web Pages (Tasks)</a></p>
<p class="toc level4"><a href="#nca-5">How to Enable Caching of Web Pages</a></p>
<p class="toc level4"><a href="#nca-13">How to Disable Caching of Web Pages</a></p>
<p class="toc level4"><a href="#nca-19">How to Enable or Disable NCA Logging</a></p>
<p class="toc level4"><a href="#nca-49">How to Add a New Port to the NCA Service</a></p>
<p class="toc level4"><a href="#gcbjy">How to Configure an Apache 2.0 Web Server to Use the SSL Kernel Proxy</a></p>
<p class="toc level4"><a href="#gcbwb">How to Configure a Sun Java System Web Server to Use the SSL Kernel Proxy</a></p>
</div>
<p class="toc level3 tocsp"><a href="nca-27.html">Caching Web Pages (Reference)</a></p>
<p class="toc level2 tocsp"><a href="time-1.html">3.&nbsp;&nbsp;Time-Related Services</a></p>
<p class="toc level1 tocsp"><a href="rfstm-1.html">Part&nbsp;II&nbsp;Accessing Network File Systems Topics</a></p>
<p class="toc level2"><a href="rfsintro-2.html">4.&nbsp;&nbsp;Managing Network File Systems (Overview)</a></p>
<p class="toc level2"><a href="rfsadmin-8.html">5.&nbsp;&nbsp;Network File System Administration (Tasks)</a></p>
<p class="toc level2"><a href="rfsrefer-1.html">6.&nbsp;&nbsp;Accessing Network File Systems (Reference)</a></p>
<p class="toc level1 tocsp"><a href="slptm.html">Part&nbsp;III&nbsp;SLP Topics</a></p>
<p class="toc level2"><a href="slparch-16.html">7.&nbsp;&nbsp;SLP (Overview)</a></p>
<p class="toc level2"><a href="slp.setup-10.html">8.&nbsp;&nbsp;Planning and Enabling SLP (Tasks)</a></p>
<p class="toc level2"><a href="ch.configuration-6.html">9.&nbsp;&nbsp;Administering SLP (Tasks)</a></p>
<p class="toc level2"><a href="legacy-7.html">10.&nbsp;&nbsp;Incorporating Legacy Services</a></p>
<p class="toc level2"><a href="slpreference.html">11.&nbsp;&nbsp;SLP (Reference)</a></p>
<p class="toc level1 tocsp"><a href="mailtm-1.html">Part&nbsp;IV&nbsp;Mail Services Topics</a></p>
<p class="toc level2"><a href="mailintro-1.html">12.&nbsp;&nbsp;Mail Services (Overview)</a></p>
<p class="toc level2"><a href="mailadmin-1.html">13.&nbsp;&nbsp;Mail Services (Tasks)</a></p>
<p class="toc level2"><a href="mailrefer-1.html">14.&nbsp;&nbsp;Mail Services (Reference)</a></p>
<p class="toc level1 tocsp"><a href="modemtm-1.html">Part&nbsp;V&nbsp;Serial Networking Topics</a></p>
<p class="toc level2"><a href="pppsvrconfig.intro-1.html">15.&nbsp;&nbsp;Solaris PPP 4.0 (Overview)</a></p>
<p class="toc level2"><a href="pppsvrconfig.p2plink-1.html">16.&nbsp;&nbsp;Planning for the PPP Link (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.dialin-1.html">17.&nbsp;&nbsp;Setting Up a Dial-up PPP Link (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.leased-1.html">18.&nbsp;&nbsp;Setting Up a Leased-Line PPP Link (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.auth-1.html">19.&nbsp;&nbsp;Setting Up PPP Authentication (Tasks)</a></p>
<p class="toc level2"><a href="ppp.pppoe-1.html">20.&nbsp;&nbsp;Setting Up a PPPoE Tunnel (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.troubleshoot-1.html">21.&nbsp;&nbsp;Fixing Common PPP Problems (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.reference-1.html">22.&nbsp;&nbsp;Solaris PPP 4.0 (Reference)</a></p>
<p class="toc level2"><a href="pppsvrconfig.convert.app-1.html">23.&nbsp;&nbsp;Migrating From Asynchronous Solaris PPP to Solaris PPP 4.0 (Tasks)</a></p>
<p class="toc level2"><a href="uucpov-1.html">24.&nbsp;&nbsp;UUCP (Overview)</a></p>
<p class="toc level2"><a href="uucptasks-1.html">25.&nbsp;&nbsp;Administering UUCP (Tasks)</a></p>
<p class="toc level2"><a href="uucpref-1.html">26.&nbsp;&nbsp;UUCP (Reference)</a></p>
<p class="toc level1 tocsp"><a href="wwrstm.html">Part&nbsp;VI&nbsp;Working With Remote Systems Topics</a></p>
<p class="toc level2"><a href="wwrsov.html">27.&nbsp;&nbsp;Working With Remote Systems (Overview)</a></p>
<p class="toc level2"><a href="wuftp-17.html">28.&nbsp;&nbsp;Administering the FTP Server (Tasks)</a></p>
<p class="toc level2"><a href="remotehowtoaccess-99941.html">29.&nbsp;&nbsp;Accessing Remote Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="netmonitortm-1.html">Part&nbsp;VII&nbsp;Monitoring Network Services Topics</a></p>
<p class="toc level2"><a href="netmonitor-1.html">30.&nbsp;&nbsp;Monitoring Network Performance (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="nca-4"></a><h3>Administering the Caching of Web Pages (Tasks)</h3>
<p>The following sections cover the procedures to enable or disable parts of the
service.</p>

<a name="nca-5"></a><h4>How to Enable Caching of Web Pages</h4><a name="indexterm-10"></a><a name="indexterm-11"></a><ol>
<li><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.
To configure a role with the Primary Administrator profile, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><a name="nca-step-8"></a><b>Register the interfaces.</b><p><a name="indexterm-12"></a>Type the names of each of the physical interfaces in the <tt>/etc/nca/nca.if</tt> file.
See the <a href="http://docs.sun.com/doc/819-2251/nca.if-4?a=view"><tt>nca.if</tt>(4)</a> man page for more information.</p><pre># <tt><b>cat /etc/nca/nca.if</b></tt>
hme0
hme1</pre><p>Each interface must have an accompanying <tt>hostname.</tt><i>interface-name</i><tt></tt> file and an entry in
<tt>/etc/hosts</tt> file for the contents of <tt>hostname.</tt><i>interface-name</i><tt></tt>. To start the NCA feature on
all interfaces, place an asterisk, <tt>*</tt>, in the <tt>nca.if</tt> file.</p></li>
<li><a name="nca-step-9"></a><b>Enable the <tt>ncakmod</tt> kernel module.</b><p>Change the <tt>status</tt> entry in <tt>/etc/nca/ncakmod.conf</tt> to <tt>enabled</tt>.</p><pre># <tt><b>cat /etc/nca/ncakmod.conf</b></tt>
#
# NCA Kernel Module Configuration File
#
status=<tt><b>enabled</b></tt>
httpd_door_path=/var/run/nca_httpd_1.door
nca_active=disabled</pre><p><a name="indexterm-13"></a>See the <a href="http://docs.sun.com/doc/819-2251/ncakmod.conf-4?a=view"><tt>ncakmod.conf</tt>(4)</a> man page for more information.</p></li>
<li><a name="nca-step-10"></a>(Optional) <b>Enable NCA logging.</b><p>Change the <tt>status</tt> entry in <tt>/etc/nca/ncalogd.conf</tt> to <tt>enabled</tt>.</p><pre># <tt><b>cat /etc/nca/ncalogd.conf</b></tt>
#
# NCA Logging Configuration File
#
status=<tt><b>enabled</b></tt>
logd_path_name="/var/nca/log"
logd_file_size=1000000</pre><p><a name="indexterm-14"></a>You can change the location of the log file by changing the path
that is indicated by the <tt>logd_path_name</tt> entry. The log file can be a
raw device or a file. See the following examples for samples of NCA
log file paths. See the <a href="http://docs.sun.com/doc/819-2251/ncalogd.conf-4?a=view"><tt>ncalogd.conf</tt>(4)</a> man page for more information about the
configuration file.</p></li>
<li><a name="nca-step-47"></a>(Optional) <b>Define ports for multiple instance support.</b><p>Add the port numbers in the <tt>/etc/nca/ncaport.conf</tt> file. This entry causes NCA to monitor
port 80 on all configured IP addresses.</p><pre># <tt><b>cat /etc/nca/ncaport.conf</b></tt>
#
# NCA Kernel Module Port Configuration File
#
  .
  .
<tt><b>ncaport=*/80</b></tt></pre></li>
<li><a name="nca-step-11"></a><b>For x86 only: Increase the virtual memory size.</b><p>Use the <tt>eeprom</tt> command to set the <tt>kernelbase</tt> of the system.</p><pre># <tt><b>eeprom kernelbase=0x90000000</b></tt>
# <tt><b>eeprom kernelbase</b></tt>
kernelbase=0x90000000</pre><p>The second command verifies that the parameter has been set.</p>
<hr><p><b>Note - </b>By setting the <tt>kernelbase</tt>, you reduce the amount of virtual memory that user
processes can use to less than 3 Gbytes. This restriction means that the
system is not ABI compliant. When the system boots, the console displays a
message that warns you about noncompliance. Most programs do not actually need the full
3&ndash;Gbyte virtual address space. If you have a program that needs more than
3 Gbytes, you need to run the program on a system that does
not have NCA enabled.</p>
<hr>
</li>
<li><a name="nca-step-12"></a><b>Reboot the server.</b></li></ol>Example&nbsp;2-1 Using a Raw Device as the NCA Log File<p>The <tt>logd_path_name</tt> string in <tt>ncalogd.conf</tt> can define a raw device as the
place to store the NCA log file. The advantage to using a raw
device is that the service can run faster because the overhead in accessing
a raw device is less. </p><p>The NCA service tests any raw device that is listed in the file
to ensure that no file system is in place. This test ensures that
no active file systems are accidentally written over.</p><p>To prevent this test from finding a file system, run the following command.
This command destroys part of the file system on any disk partition that
had been configured as a file system. In this example, <tt>/dev/rdsk/c0t0d0s7</tt> is
the raw device that has an old file system in place.</p><pre># <tt><b>dd if=/dev/zero of=/dev/rdsk/c0t0d0s7 bs=1024 count=1</b></tt></pre><p>After running <tt>dd</tt>, you can then add the raw device to the <tt>ncalogd.conf</tt>
file.</p><pre># <tt><b>cat /etc/nca/ncalogd.conf</b></tt>
#
# NCA Logging Configuration File
#
status=enabled
logd_path_name="<tt><b>/dev/rdsk/c0t0d0s7</b></tt>"
logd_file_size=1000000</pre>Example&nbsp;2-2 Using Multiple Files for NCA Logging<p>The <tt>logd_path_name</tt> string in <tt>ncalogd.conf</tt> can define multiple targets as the place
to store the NCA log file. The second file is used when the
first file is full. The following example shows how to select to write
to the <tt>/var/nca/log</tt> file first and then use a raw partition.</p><pre># <tt><b>cat /etc/nca/ncalogd.conf</b></tt>
#
# NCA Logging Configuration File
#
status=enabled
logd_path_name="<tt><b>/var/nca/log /dev/rdsk/c0t0d0s7</b></tt>"
logd_file_size=1000000</pre>

<a name="nca-13"></a><h4>How to Disable Caching of Web Pages</h4><a name="indexterm-15"></a><a name="indexterm-16"></a><ol>
<li><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.
To configure a role with the Primary Administrator profile, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><a name="nca-step-16"></a><b>Disable the <tt>ncakmod</tt> kernel module.</b><p>Change the <tt>status</tt> entry in <tt>/etc/nca/ncakmod.conf</tt> to <tt>disabled</tt>.</p><pre># <tt><b>cat /etc/nca/ncakmod.conf</b></tt>
# NCA Kernel Module Configuration File
#
status=<tt><b>disabled</b></tt>
httpd_door_path=/var/run/nca_httpd_1.door
nca_active=disabled</pre><p><a name="indexterm-17"></a>See the <a href="http://docs.sun.com/doc/819-2251/ncakmod.conf-4?a=view"><tt>ncakmod.conf</tt>(4)</a> man page for more information.</p></li>
<li><a name="nca-step-17"></a><b>Disable NCA logging.</b><p>Change the <tt>status</tt> entry in <tt>/etc/nca/ncalogd.conf</tt> to <tt>disabled</tt>.</p><pre># <tt><b>cat /etc/nca/ncalogd.conf</b></tt>
#
# NCA Logging Configuration File
#
status=<tt><b>disabled</b></tt>
logd_path_name="/var/nca/log"
logd_file_size=1000000</pre><p><a name="indexterm-18"></a>See the <a href="http://docs.sun.com/doc/819-2251/ncalogd.conf-4?a=view"><tt>ncalogd.conf</tt>(4)</a> man page for more information.</p></li>
<li><a name="nca-step-18"></a><b>Reboot the server.</b></li></ol>

<a name="nca-19"></a><h4>How to Enable or Disable NCA Logging</h4><p><a name="indexterm-19"></a><a name="indexterm-20"></a><a name="indexterm-21"></a>NCA logging can be turned on or turned off, as needed, after NCA
has been enabled. See <a href="#nca-5">How to Enable Caching of Web Pages</a> for more information.</p><ol>
<li><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.
To configure a role with the Primary Administrator profile, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><a name="nca-step-22"></a><b>Change NCA logging.</b><p>To permanently disable logging, you need to change the status in <tt>/etc/nca/ncalogd.conf</tt> to
<tt>disabled</tt> and reboot the system. See the <a href="http://docs.sun.com/doc/819-2251/ncalogd.conf-4?a=view"><tt>ncalogd.conf</tt>(4)</a> man page for more information.</p><ol style="list-style-type: lower-alpha">
				 
<li><a name="nca-step-23"></a><b>Stop logging.</b><pre># <tt><b>/etc/init.d/ncalogd stop</b></tt></pre></li>
<li><a name="nca-step-24"></a><b>Start logging.</b><pre># <tt><b>/etc/init.d/ncalogd start</b></tt></pre></li></ol></li></ol>

<a name="nca-36"></a><h4>How to Load the Socket Utility Library for NCA</h4>
<a name="indexterm-22"></a><p>Follow this process only if your web server does not provide native support
of the AF_NCA socket.</p><p>In the startup script for the web server, add a line that causes
the library to be preloaded. The line should resemble the following:</p><pre><tt><b>LD_PRELOAD=/usr/lib/ncad_addr.so /usr/bin/httpd</b></tt></pre>

<a name="nca-49"></a><h4>How to Add a New Port to the NCA Service</h4><ol>
<li><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.
To configure a role with the Primary Administrator profile, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><a name="nca-step-50"></a><b>Add a new port.</b><p>Add a new port entry to <tt>/etc/nca/ncaport.conf</tt>. This example adds port <tt>8888</tt> on IP
address <tt>192.168.84.71</tt>. See <a href="http://docs.sun.com/doc/819-2251/ncaport.conf-4?a=view"><tt>ncaport.conf</tt>(4)</a> for more information.</p><pre># <tt><b>cat /etc/nca/ncaport.conf</b></tt>
#
# NCA Kernel Module Port Configuration File
#
  .
  .
ncaport=*/80
<tt><b>ncaport=192.168.84.71/8888</b></tt></pre></li>
<li><a name="nca-step-51"></a><b>Start a new web instance.</b><p>An address needs to be in the file that contains the NCA port
configurations before a web server can use the address for NCA. If the
web server is running, it must be restarted after the new address is
defined.</p></li></ol>

<a name="gcbjy"></a><h4>How to Configure an Apache 2.0 Web Server to Use the SSL Kernel Proxy</h4><p>This procedure should be used to improve the performance of SSL packet process
on an Apache 2.0 web server.</p><h6>Before You Begin</h6><p>The following procedure requires that an Apache 2.0 web server has been installed
and configured. The Apache 2.0 web server is included in the Solaris 10
release.</p><p>To use the SSL kernel proxy, the server private key and the server
certificate need to exist in a single file. If only the <tt>SSLCertificateFile</tt>
parameter is specified in the <tt>ssl.conf</tt> file, then the specified file can
be used directly for kernel SSL. If the <tt>SSLCertificateKeyFile</tt> parameter is also specified, then
the certificate file and the private key file need to be combined. One
way to combine the certificate and the key file is to run the
following command:</p><pre># <tt><b>cat cert.pem key.pem >cert-and-key.pem</b></tt></pre><ol>
<li><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.
To configure a role with the Primary Administrator profile, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a> The <tt>ksslcfg</tt>
command is included in the <tt>Network Security</tt> profile.</p></li>
<li><b>Stop the web server.</b><p>This command will stop the web server on a system in which the
server is configured to run using SMF.</p><pre># <tt><b>svcadm disable svc:/network/http:apache2</b></tt></pre><p>If the service has not be converted yet, stop the service with this
command syntax: <tt>/usr/apache2/bin/apachectl stop</tt></p></li>
<li><b>Determine what parameters to use with the <tt>ksslcfg</tt> command.</b><p>All of the options are listed in the <tt>ksslcfg</tt>(1M) man page. The
parameters that you must have information for are:</p>
<ul><li><p><tt>key-format</tt> &ndash; Used with the <tt>-f</tt> option to define the certificate and key format. For the SSL kernel proxy the value should be either <tt>pem</tt> or <tt>pkcs12</tt>.</p></li>
<li><p><tt>key-and-certificate-file</tt> &ndash; Used with the <tt>-i</tt> option to set the location of the file that stores to server key and the certificate.</p></li>
<li><p><tt>password-file</tt> &ndash; Used with the <tt>-p</tt> option to select the location of the file that includes the password used to encrypt the private key. This password is used to allow unattended reboots. The permissions on the file should be <tt>0400</tt>.</p></li>
<li><p><tt>proxy-port</tt> &ndash; Used with the <tt>-x</tt> option to set the SSL proxy port. Select a different port than the standard port <tt>80</tt>.</p></li>
<li><p><tt>ssl-port</tt> &ndash; Selects the port of the server application. Normally this is set to <tt>443</tt>.</p></li></ul>

<hr><p><b>Note - </b>The <tt>ssl-port</tt> and the <tt>proxy-port</tt> values can not be configured for NCA
since these ports are used exclusively by the SSL kernel proxy. Usually, port
80 is used for NCA, port 8080 for the <tt>proxy-port</tt> and 443 for the
<tt>ssl-port</tt></p>
<hr>
</li>
<li><b>Create the service instance.</b><p>The <tt>ksslcfg</tt> command to specify the SSL proxy port and associated parameters.</p><pre>ksslcfg create -f <i>key-format</i> -i <i>key-and-certificate-file</i> -p <i>password-file</i> -x <i>proxy-port</i> <i>ssl-port</i></pre></li>
<li><b>Verify that the instance was created properly.</b><p>The service state reported by the following command should be &ldquo;online&rdquo;.</p><pre># <tt><b>svcs svc:/network/ssl/proxy</b></tt></pre></li>
<li><b>Configure the web server to listen on the SSL proxy port.</b><p>Edit the <tt>/etc/apache2/http.conf</tt> file and add a line to define the SSL proxy
port. If you use the servers IP address, then the web server will
only listen on that interface. The line should look like:</p><pre>Listen 0.0.0.0:<i>proxy-port</i></pre></li>
<li><b>Set an SMF dependency for the web server.</b><p>The web server should only be started after the SSL kernel proxy instance. The
following commands establish that dependency.</p><pre># <tt><b>svccfg -s svc:/network/http:apache2</b></tt>
svc:/network/http:apache2> <tt><b>addpg kssl dependency</b></tt>
svc:/network/http:apache2> <tt><b>setprop kssl/entities = fmri:svc:/network/ssl/proxy:kssl-INADDR_ANY-443</b></tt>
svc:/network/http:apache2> <tt><b>setprop kssl/grouping = astring: require_all</b></tt>
svc:/network/http:apache2> <tt><b>setprop kssl/restart_on = astring: refresh</b></tt>
svc:/network/http:apache2> <tt><b>setprop kssl/type = astring: service</b></tt>
svc:/network/http:apache2> <tt><b>end</b></tt></pre></li>
<li><b>Enable the web server.</b><pre># <tt><b>svcadm enable svc:/network/http:apache2</b></tt></pre><p>If the service is not started using SMF, use the following command: <tt>/usr/apache2/bin/apachectl startssl</tt></p></li></ol><a name="gcbwm"></a>Example&nbsp;2-3 Configuring an Apache 2.0 Web Server to Use the SSL Kernel Proxy<p>The following command creates an instance using the <tt>pem</tt> key format.</p><pre># <tt><b>ksslcfg create -f pem -i cert-and-key.pem -p file -x 8080 443</b></tt></pre>

<a name="gcbwb"></a><h4>How to Configure a Sun Java System Web Server to Use the SSL Kernel Proxy</h4><p>This procedure should be used to improve the performance of SSL packet process
on a Sun Java System Web Server. See the <i>Sun Java System Web Server 6.1 SP4 Administrator&rsquo;s Guide</i> for information about
this web server.</p><h6>Before You Begin</h6><p>The following procedure requires that a Sun Java System Web Server has been
installed and configured.</p><ol>
<li><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.
To configure a role with the Primary Administrator profile, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a> The <tt>ksslcfg</tt>
command is included in the <tt>Network Security</tt> profile.</p></li>
<li><b>Stop the web server.</b><p>Use the administrator web interface to stop the server. See <i>Starting and Stopping the Server</i> in the
<i>Sun Java System Web Server 6.1 SP4 Administrator&rsquo;s Guide</i>for more information.</p></li>
<li><b>Determine what parameters to use with the <tt>ksslcfg</tt> command.</b><p>All of the options are listed in the <tt>ksslcfg</tt>(1M) man page. The
parameters that you must have information for are:</p>
<ul><li><p><tt>key-format</tt> &ndash; Used with the <tt>-f</tt> option to define the certificate and key format.</p></li>
<li><p><tt>token-label</tt> &ndash; Used with the <tt>-T</tt> option to specify the PKCS#11 token.</p></li>
<li><p><tt>certificate-label</tt> &ndash; Used with the <tt>-C</tt> option to select the label in the certificate object in the PKCS#11 token</p></li>
<li><p><tt>password-file</tt> &ndash; Used with the <tt>-p</tt> option to select the location of the file that includes the password used to login the user to the PKCS#11 token used by the web server.. This password is used to allow unattended reboots. The permissions on the file should be <tt>0400</tt>.</p></li>
<li><p><tt>proxy-port</tt>&ndash; Used with the <tt>-x</tt> option to set the SSL proxy port. Select a different port than the standard port <tt>80</tt>.</p></li>
<li><p><tt>ssl-port</tt> &ndash; Defines the port of the server application. This value is set in the <tt>server.xml</tt> file. Normally this value is set to <tt>443</tt>.</p></li></ul>

<hr><p><b>Note - </b>The <tt>ssl-port</tt> and the <tt>proxy-port</tt> values can not be configured for NCA
since these ports are used exclusively by the SSL kernel proxy. Usually, port
80 is used for NCA, port 8080 for the <tt>proxy-port</tt> and 443 for the
<tt>ssl-port</tt></p>
<hr>
</li>
<li><b>Create the service instance.</b><p>The <tt>ksslcfg</tt> command to specify the SSL proxy port and associated parameters.</p><pre>ksslcfg create -f <i>key-format</i> -T <i>PKCS#11-token</i> -C <i>certificate-label</i> -p <i>password-file</i> -x <i>proxy-port</i> <i>ssl-port</i></pre></li>
<li><b>Verify that the instance was created properly.</b><p>The service state reported by the following command should be &ldquo;online&rdquo;.</p><pre># <tt><b>svcs svc:/network/ssl/proxy</b></tt></pre></li>
<li><b>Configure the web server to listen on the SSL proxy port.</b><p>See <i>Adding and Editing Listen Sockets</i> in the <i>Sun Java System Web Server 6.1 SP4 Administrator&rsquo;s Guide</i> for more information.</p></li>
<li><b>Start the web server.</b></li></ol><a name="gcbxf"></a>Example&nbsp;2-4 Configuring a Sun Java System Web Server to Use the SSL Kernel Proxy<p>The following command creates an instance using the <tt>pkcs11</tt> key format.</p><pre># <tt><b>ksslcfg create -f pkcs11 -T "NSS Internal PKCS #11 Module" -C "Server-Cert" -p file -x 8080 443</b></tt></pre>

<a name="gcdwj"></a><h4>Using the SSL Kernel Proxy in Zones</h4>
<p>The SSL Kernel Proxy works in zones with the following limitations:</p>
<ul><li><p>All of the kernel SSL administration must be done from the global zone. The global zone administrator needs access to the local zone certificate and key files. The local zone web server can be started once the service instance is configured using the <tt>ksslcfg</tt> command in the global zone.</p></li>
<li><p>A specific host name or IP address must be specified when running the <tt>ksslcfg</tt> command to configure the instance. In particular, the instance can not use INADDR_ANY.</p></li></ul>
<a name="gcdwx"></a>Example&nbsp;2-5 Configuring an Apache Web Server in a Local Zone to Use the SSL Kernel Proxy<p>In the local zone, first stop the web server. In the global zone
do all of the steps to configure the service. To create a
instance for a local zone called <tt>apache-zone</tt>, use the following command:</p><pre># <tt><b>ksslcfg create -f pem -i /zone/apache-zone/root/keypair.pem -p /zone/apache-zone/root/pass \ -x 8080 apache-zone 443</b></tt></pre><p>In the local zone, run the following command to enable the service instance:</p><pre># <tt><b>svcadm enable svc:/network/http:apache2</b></tt></pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="nca-44.html">Previous</a>
             </td>
             <td align="right">
                 <a href="nca-27.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

