<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Troubleshooting Procedures and Tips for Mail Services - System Administration Guide: Network Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Network Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="mailadmin-265.html">Previous</a>
             </td>
             <td align="right">
                 <a href="mailadmin-219.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="netservices-1.html">Part&nbsp;I&nbsp;Network Services Topics</a></p>
<p class="toc level2"><a href="nsov-1.html">1.&nbsp;&nbsp;Network Service (Overview)</a></p>
<p class="toc level2"><a href="nca-1.html">2.&nbsp;&nbsp;Managing Web Cache Servers</a></p>
<p class="toc level2"><a href="time-1.html">3.&nbsp;&nbsp;Time-Related Services</a></p>
<p class="toc level1 tocsp"><a href="rfstm-1.html">Part&nbsp;II&nbsp;Accessing Network File Systems Topics</a></p>
<p class="toc level2"><a href="rfsintro-2.html">4.&nbsp;&nbsp;Managing Network File Systems (Overview)</a></p>
<p class="toc level2"><a href="rfsadmin-8.html">5.&nbsp;&nbsp;Network File System Administration (Tasks)</a></p>
<p class="toc level2"><a href="rfsrefer-1.html">6.&nbsp;&nbsp;Accessing Network File Systems (Reference)</a></p>
<p class="toc level1 tocsp"><a href="slptm.html">Part&nbsp;III&nbsp;SLP Topics</a></p>
<p class="toc level2"><a href="slparch-16.html">7.&nbsp;&nbsp;SLP (Overview)</a></p>
<p class="toc level2"><a href="slp.setup-10.html">8.&nbsp;&nbsp;Planning and Enabling SLP (Tasks)</a></p>
<p class="toc level2"><a href="ch.configuration-6.html">9.&nbsp;&nbsp;Administering SLP (Tasks)</a></p>
<p class="toc level2"><a href="legacy-7.html">10.&nbsp;&nbsp;Incorporating Legacy Services</a></p>
<p class="toc level2"><a href="slpreference.html">11.&nbsp;&nbsp;SLP (Reference)</a></p>
<p class="toc level1 tocsp"><a href="mailtm-1.html">Part&nbsp;IV&nbsp;Mail Services Topics</a></p>
<p class="toc level2"><a href="mailintro-1.html">12.&nbsp;&nbsp;Mail Services (Overview)</a></p>
<p class="toc level2"><a href="mailadmin-1.html">13.&nbsp;&nbsp;Mail Services (Tasks)</a></p>
<p class="toc level3"><a href="mailadmin-270.html">Task Map for Mail Services</a></p>
<p class="toc level3"><a href="mailadmin-2.html">Planning Your Mail System</a></p>
<p class="toc level3"><a href="mailadmin-263.html">Setting Up Mail Services (Task Map)</a></p>
<p class="toc level3"><a href="mailadmin-13.html">Setting Up Mail Services</a></p>
<p class="toc level4"><a href="mailadmin-13.html#mailadmin-15">How to Set Up a Mail Server</a></p>
<p class="toc level4"><a href="mailadmin-13.html#mailadmin-20">How to Set Up a Mail Client</a></p>
<p class="toc level4"><a href="mailadmin-13.html#mailadmin-29">How to Set Up a Mail Host</a></p>
<p class="toc level4"><a href="mailadmin-13.html#mailadmin-37">How to Set Up a Mail Gateway</a></p>
<p class="toc level4"><a href="mailadmin-13.html#mailadmin-122">How to Use DNS With <tt>sendmail</tt></a></p>
<p class="toc level3 tocsp"><a href="mailadmin-43.html">Building the <tt>sendmail.cf</tt> Configuration File</a></p>
<p class="toc level4"><a href="mailadmin-43.html#mailadmin-44">How to Build a New <tt>sendmail.cf</tt> File</a></p>
<p class="toc level3 tocsp"><a href="ganav.html">Setting SMTP to Use TLS</a></p>
<p class="toc level4"><a href="ganav.html#fxcty">How to Set SMTP to Use TLS</a></p>
<p class="toc level3 tocsp"><a href="mailadmin-377.html">Managing Mail Delivery by Using an Alternate Configuration</a></p>
<p class="toc level4"><a href="mailadmin-377.html#mailadmin-378">How to Manage Mail Delivery by Using an Alternate Configuration of <tt>sendmail.cf</tt></a></p>
<p class="toc level3 tocsp"><a href="mailadmin-260.html">Administering Mail Alias Files (Task Map)</a></p>
<p class="toc level3"><a href="mailadmin-52.html">Administering Mail Alias Files</a></p>
<p class="toc level4"><a href="mailadmin-52.html#mailadmin-345">How to Initiate an NIS+ <tt>mail_aliases</tt> Table</a></p>
<p class="toc level4"><a href="mailadmin-52.html#mailadmin-327">How to List the Contents of the NIS+ <tt>mail_aliases</tt> Table</a></p>
<p class="toc level4"><a href="mailadmin-52.html#mailadmin-330">How to Add Aliases to the NIS+ <tt>mail_aliases</tt> Table From the Command Line</a></p>
<p class="toc level4"><a href="mailadmin-52.html#mailadmin-331">How to Add Entries by Editing an NIS+ <tt>mail_aliases</tt> Table</a></p>
<p class="toc level4"><a href="mailadmin-52.html#mailadmin-332">How to Edit Entries in an NIS+ <tt>mail_aliases</tt> Table</a></p>
<p class="toc level4"><a href="mailadmin-52.html#mailadmin-93">How to Set Up an NIS <tt>mail.aliases</tt> Map</a></p>
<p class="toc level4"><a href="mailadmin-52.html#mailadmin-106">How to Set Up a Local Mail Alias File</a></p>
<p class="toc level4"><a href="mailadmin-52.html#mailadmin-118">How to Create a Keyed Map File</a></p>
<p class="toc level3 tocsp"><a href="mailadmin-262.html">Administering the Queue Directories (Task Map)</a></p>
<p class="toc level3"><a href="mailadmin-138.html">Administering the Queue Directories</a></p>
<p class="toc level4"><a href="mailadmin-138.html#eyhyo">How to Display the Contents of the Mail Queue, <tt>/var/spool/mqueue</tt></a></p>
<p class="toc level4"><a href="mailadmin-138.html#mailadmin-142">How to Force Mail Queue Processing in the Mail Queue, <tt>/var/spool/mqueue</tt></a></p>
<p class="toc level4"><a href="mailadmin-138.html#mailadmin-145">How to Run a Subset of the Mail Queue, <tt>/var/spool/mqueue</tt></a></p>
<p class="toc level4"><a href="mailadmin-138.html#mailadmin-148">How to Move the Mail Queue, <tt>/var/spool/mqueue</tt></a></p>
<p class="toc level4"><a href="mailadmin-138.html#mailadmin-156">How to Run the Old Mail Queue, <tt>/var/spool/omqueue</tt></a></p>
<p class="toc level3 tocsp"><a href="mailadmin-264.html">Administering <tt>.forward</tt> Files (Task Map)</a></p>
<p class="toc level3"><a href="mailadmin-160.html">Administering <tt>.forward</tt> Files</a></p>
<p class="toc level4"><a href="mailadmin-160.html#mailadmin-161">How to Disable <tt>.forward</tt> Files</a></p>
<p class="toc level4"><a href="mailadmin-160.html#mailadmin-167">How to Change the <tt>.forward</tt>-File Search Path</a></p>
<p class="toc level4"><a href="mailadmin-160.html#mailadmin-173">How to Create and Populate <tt>/etc/shells</tt></a></p>
<p class="toc level3 tocsp"><a href="mailadmin-265.html">Troubleshooting Procedures and Tips for Mail Services (Task Map)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Troubleshooting Procedures and Tips for Mail Services</a></p>
<p class="toc level4"><a href="#mailadmin-181">How to Test the Mail Configuration</a></p>
<p class="toc level4"><a href="#mailadmin-195">How to Test the <tt>sendmail</tt> Rule Sets</a></p>
</div>
<p class="toc level3 tocsp"><a href="mailadmin-219.html">Resolving Error Messages</a></p>
<p class="toc level2 tocsp"><a href="mailrefer-1.html">14.&nbsp;&nbsp;Mail Services (Reference)</a></p>
<p class="toc level1 tocsp"><a href="modemtm-1.html">Part&nbsp;V&nbsp;Serial Networking Topics</a></p>
<p class="toc level2"><a href="pppsvrconfig.intro-1.html">15.&nbsp;&nbsp;Solaris PPP 4.0 (Overview)</a></p>
<p class="toc level2"><a href="pppsvrconfig.p2plink-1.html">16.&nbsp;&nbsp;Planning for the PPP Link (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.dialin-1.html">17.&nbsp;&nbsp;Setting Up a Dial-up PPP Link (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.leased-1.html">18.&nbsp;&nbsp;Setting Up a Leased-Line PPP Link (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.auth-1.html">19.&nbsp;&nbsp;Setting Up PPP Authentication (Tasks)</a></p>
<p class="toc level2"><a href="ppp.pppoe-1.html">20.&nbsp;&nbsp;Setting Up a PPPoE Tunnel (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.troubleshoot-1.html">21.&nbsp;&nbsp;Fixing Common PPP Problems (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.reference-1.html">22.&nbsp;&nbsp;Solaris PPP 4.0 (Reference)</a></p>
<p class="toc level2"><a href="pppsvrconfig.convert.app-1.html">23.&nbsp;&nbsp;Migrating From Asynchronous Solaris PPP to Solaris PPP 4.0 (Tasks)</a></p>
<p class="toc level2"><a href="uucpov-1.html">24.&nbsp;&nbsp;UUCP (Overview)</a></p>
<p class="toc level2"><a href="uucptasks-1.html">25.&nbsp;&nbsp;Administering UUCP (Tasks)</a></p>
<p class="toc level2"><a href="uucpref-1.html">26.&nbsp;&nbsp;UUCP (Reference)</a></p>
<p class="toc level1 tocsp"><a href="wwrstm.html">Part&nbsp;VI&nbsp;Working With Remote Systems Topics</a></p>
<p class="toc level2"><a href="wwrsov.html">27.&nbsp;&nbsp;Working With Remote Systems (Overview)</a></p>
<p class="toc level2"><a href="wuftp-17.html">28.&nbsp;&nbsp;Administering the FTP Server (Tasks)</a></p>
<p class="toc level2"><a href="remotehowtoaccess-99941.html">29.&nbsp;&nbsp;Accessing Remote Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="netmonitortm-1.html">Part&nbsp;VII&nbsp;Monitoring Network Services Topics</a></p>
<p class="toc level2"><a href="netmonitor-1.html">30.&nbsp;&nbsp;Monitoring Network Performance (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="mailadmin-180"></a><h3>Troubleshooting Procedures and Tips for Mail Services</h3>
<p>This section provides some procedures and tips that you can use for troubleshooting problems
with mail services.</p>

<a name="mailadmin-181"></a><h4>How to Test the Mail Configuration</h4><p><a name="indexterm-1216"></a><a name="indexterm-1217"></a>To test the changes that you make to your configuration file, follow these instructions.</p><ol>
<li><a name="mailadmin-step-183"></a><b>Restart <tt>sendmail</tt> on any system that has a revised configuration file. </b><pre># <tt><b>svcadm refresh network/smtp:sendmail</b></tt></pre></li>
<li><a name="mailadmin-step-184"></a><b>Send test messages from each system.</b><pre># <tt><b>/usr/lib/sendmail -v</b></tt> <i>names</i> <tt><b>&lt;/dev/null</b></tt></pre><dl><dt><i>names</i></dt>
<dd><p>Specify a recipient's email address.</p></dd>
</dl>
<p>This command sends a null message to the specified recipient and displays the message
activity on your monitor.</p></li>
<li><a name="mailadmin-step-350"></a><b>Send mail to yourself or other people on the local system by addressing the message
to a regular user name. </b></li>
<li><a name="mailadmin-step-351"></a>(Optional) <b><a name="indexterm-1218"></a>If you are connected to a network, send mail in three directions to someone
on another system. </b>
<ul><li><p>From the main system to a client system</p></li>
<li><p>From a client system to the main system</p></li>
<li><p>From a client system to another client system</p></li></ul>
</li>
<li><a name="mailadmin-step-352"></a>(Optional) <b><a name="indexterm-1219"></a>If you have a mail gateway, send mail from the mail host to
another domain to ensure that the relay mailer and host are configured properly. </b></li>
<li><a name="mailadmin-step-353"></a>(Optional) <b><a name="indexterm-1220"></a>If you have set up a UUCP connection on your phone line to
another host, send mail to someone at that host. Have that person send mail
back or call you when the message is received. </b></li>
<li><a name="mailadmin-step-354"></a><b>Ask someone to send mail to you over the UUCP connection.</b><p>The <tt>sendmail</tt> program cannot detect whether the message is delivered because the program passes
the message to UUCP for delivery.</p></li>
<li><a name="mailadmin-step-355"></a><b><a name="indexterm-1221"></a>From different systems, send a message to <tt>postmaster</tt> and ensure that the message is
delivered to your postmaster's mailbox. </b></li></ol>

<a name="mailadmin-192"></a><h4>How to Check Mail Aliases</h4>
<a name="indexterm-1222"></a><a name="indexterm-1223"></a><a name="indexterm-1224"></a><a name="indexterm-1225"></a><a name="indexterm-1226"></a><p>The following example shows you how to verify an alias.</p><pre>% <tt><b>mconnect</b></tt>
connecting to host localhost (127.0.0.1), port 25
connection open
220 your.domain.com ESMTP Sendmail 8.13.6+Sun/8.13.6; Tue, 12 Sep 2004 13:34:13 -0800 (PST)
<tt><b>expn sandy</b></tt>
250 2.1.5 &lt;sandy@phoenix.example.com>
<tt><b>quit</b></tt>
221 2.0.0 your.domain.com closing connection
% </pre><p>In this example, the <tt>mconnect</tt> program opened a connection to a mail 
server on a local host and enabled you to test that connection. The program
runs interactively, so you can issue various diagnostic commands. For a complete description, see
the <a href="http://docs.sun.com/doc/819-2239/mconnect-1?a=view"><tt>mconnect</tt>(1)</a> man page. The entry, <tt>expn</tt> <tt>sandy</tt>, provided the expanded address, <tt>sandy@phoenix.example.com</tt>. Thus,
you have verified that mail can be delivered when using the alias <tt>sandy</tt>.</p><p><a name="indexterm-1227"></a><a name="indexterm-1228"></a>Remember to avoid loops and inconsistent databases when both local and domain-wide aliases are used.
Be especially careful to avoid the creation of alias loops when you move a
user from one system to another system.  </p>

<a name="mailadmin-195"></a><h4>How to Test the <tt>sendmail</tt> Rule Sets</h4><p><a name="indexterm-1229"></a><a name="indexterm-1230"></a><a name="indexterm-1231"></a>To check the input and returns of the <tt>sendmail</tt> rule sets, follow these instructions.</p><ol>
<li><a name="mailadmin-step-197"></a><b>Change to address test mode.</b><pre># <tt><b>/usr/lib/sendmail -bt</b></tt></pre></li>
<li><a name="mailadmin-step-198"></a><b>Test a mail address.</b><p>Provide the following numbers and address at the last prompt (<tt>></tt>).</p><pre>> <tt><b>3,0 </tt><i>mail-address</i><tt></b></tt></pre><dl><dt><i>mail-address</i></dt>
<dd><p>Use the mail address that you are testing.</p></dd>
</dl>
</li>
<li><a name="mailadmin-step-199"></a><b>End the session.</b><p>Press Control-d.</p></li></ol><a name="mailadmin-ex-240"></a>Example&nbsp;13-5 Address Test Mode Output<p>The following is an example of the output from the address test mode.</p><pre>% <tt><b>/usr/lib/sendmail -bt</b></tt>
ADDRESS TEST MODE (ruleset 3 NOT automatically invoked)
Enter &lt;ruleset> &lt;address>
> <tt><b>3,0 sandy@phoenix</b></tt>
canonify           input: sandy @ phoenix
Canonify2          input: sandy &lt; @ phoenix >
Canonify2        returns: sandy &lt; @ phoenix . example . com . >
canonify         returns: sandy &lt; @ phoenix . example . com . >
parse              input: sandy &lt; @ phoenix . example . com . >
Parse0             input: sandy &lt; @ phoenix . example . com . >
Parse0           returns: sandy &lt; @ phoenix . example . com . >
ParseLocal         input: sandy &lt; @ phoenix . example . com . >
ParseLocal       returns: sandy &lt; @ phoenix . example . com . >
Parse1             input: sandy &lt; @ phoenix . example . com . >
MailerToTriple     input: &lt; mailhost . phoenix . example . com > 
     sandy &lt; @ phoenix . example . com . >
MailerToTriple   returns: $# relay $@ mailhost . phoenix . example . com 
     $: sandy &lt; @ phoenix . example . com . >
Parse1           returns: $# relay $@ mailhost . phoenix . example . com 
     $: sandy &lt; @ phoenix . example . com . >
parse            returns: $# relay $@ mailhost . phoenix . example . com 
     $: sandy &lt; @ phoenix . example . com . ></pre>

<a name="mailadmin-200"></a><h4>How to Verify Connections to Other Systems</h4>
<a name="indexterm-1232"></a><a name="indexterm-1233"></a><a name="indexterm-1234"></a><a name="indexterm-1235"></a><a name="indexterm-1236"></a><p>The <tt>mconnect</tt> program opens a connection to a mail server on a host that
you specify and enables you to test that connection. The program runs interactively, so
you can issue various diagnostic commands. See the <a href="http://docs.sun.com/doc/819-2239/mconnect-1?a=view"><tt>mconnect</tt>(1)</a> man page for a complete
description. The following example verifies that mail to the user name <tt>sandy</tt> is deliverable.</p><pre>% <tt><b>mconnect phoenix</b></tt>

connecting to host phoenix (172.31.255.255), port 25
connection open
220 phoenix.example.com ESMTP Sendmail 8.13.1+Sun/8.13.1; Sat, 4 Sep 2004 3:52:56 -0700
<tt><b>expn sandy</b></tt>
250 2.1.5 &lt;sandy@phoenix.example.com>
<tt><b>quit</b></tt></pre><p>If you cannot use <tt>mconnect</tt> to connect to an <tt>SMTP</tt> port, check
these conditions.</p>
<ul><li><p>Is the system load too high?</p></li>
<li><p>Is the <tt>sendmail</tt> daemon running?</p></li>
<li><p>Does the system have the appropriate <tt>/etc/mail/sendmail.cf</tt> file?</p></li>
<li><p>Is port 25, the port that <tt>sendmail</tt> uses, active?</p></li></ul>


<a name="mailadmin-201"></a><h4>Logging Error Messages</h4>
<p>Your mail service logs most error messages by using the <tt>syslogd</tt> program. By
default, the <tt>syslogd</tt> program sends these messages to a system that is called
<tt>loghost</tt>, which is specified in the <tt>/etc/hosts</tt> file. You can define <tt>loghost</tt> to hold all
logs for an entire NIS domain. If no <tt>loghost</tt> is specified, error messages from
<tt>syslogd</tt> are not reported.</p><p><a name="indexterm-1237"></a><a name="indexterm-1238"></a>The <tt>/etc/syslog.conf</tt> file controls where the <tt>syslogd</tt> program forwards messages. You can change
the default configuration by editing the <tt>/etc/syslog.conf</tt> file. You must restart the <tt>syslog</tt> daemon for
any changes to become active. To gather information about mail, you can add the
following selections to the file.</p>
<ul><li><p><tt>mail.alert</tt> &ndash; Messages about conditions that should be fixed now</p></li>
<li><p><tt>mail.crit</tt> &ndash; Critical messages</p></li>
<li><p><tt>mail.warning</tt> &ndash; Warning messages</p></li>
<li><p><tt>mail.notice</tt> &ndash; Messages that are not errors, but might need attention</p></li>
<li><p><tt>mail.info</tt> &ndash; Informational messages</p></li>
<li><p><tt>mail.debug</tt> &ndash; Debugging messages</p></li></ul>
<p>The following entry in the <tt>/etc/syslog.conf</tt> file sends a copy of all critical,
informational, and debug messages to <tt>/var/log/syslog</tt>.</p><pre>mail.crit;mail.info;mail.debug            /var/log/syslog</pre><p>Each line in the system log contains a timestamp, the name of the system
that generated the line, and a message. The <tt>syslog</tt> file can log a large
amount of information.</p><p>The log is arranged in a succession of levels. At the lowest level,
only unusual occurrences are logged. At the highest level, even the most mundane and uninteresting
events are recorded. As a convention, log levels under 10 are considered &ldquo;useful.&rdquo; Log levels
that are higher than 10 are usually used for debugging. See <a href="http://docs.sun.com/doc/819-2380/eekis?a=view">Customizing System Message Logging in <i>System Administration Guide: Advanced Administration</i></a> for information
about <tt>loghost</tt> and the <tt>syslogd</tt> program.</p>

<a name="mailadmin-203"></a><h4>Other Sources for Mail Diagnostic Information</h4>
<p>For other diagnostic information, check the following sources.</p>
<ul><li><p>Look at the <tt>Received</tt> lines in the header of the message. These lines trace the route that the message took as the message was relayed. Remember to consider time&ndash;zone differences.</p></li>
<li><p><a name="indexterm-1239"></a><a name="indexterm-1240"></a>Look at the messages from <tt>MAILER-DAEMON</tt>. These messages typically report delivery problems.  </p></li>
<li><p>Check the system log that records delivery problems for your group of systems. The <tt>sendmail</tt> program always records its activities in the system log. You might want to modify the <tt>crontab</tt> file to run a shell script nightly. The script searches the log for <tt>SYSERR</tt> messages and mails any messages that it finds to the postmaster.</p></li>
<li><p>Use the <tt>mailstats</tt> program to test mail types and determine the number of incoming messages and outgoing messages.</p></li></ul>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="mailadmin-265.html">Previous</a>
             </td>
             <td align="right">
                 <a href="mailadmin-219.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

