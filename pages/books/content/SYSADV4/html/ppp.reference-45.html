<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Creating PPPoE Tunnels for DSL Support - System Administration Guide: Network Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Network Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ppp.reference-39.html">Previous</a>
             </td>
             <td align="right">
                 <a href="pppsvrconfig.convert.app-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="netservices-1.html">Part&nbsp;I&nbsp;Network Services Topics</a></p>
<p class="toc level2"><a href="nsov-1.html">1.&nbsp;&nbsp;Network Service (Overview)</a></p>
<p class="toc level2"><a href="nca-1.html">2.&nbsp;&nbsp;Managing Web Cache Servers</a></p>
<p class="toc level2"><a href="time-1.html">3.&nbsp;&nbsp;Time-Related Services</a></p>
<p class="toc level1 tocsp"><a href="rfstm-1.html">Part&nbsp;II&nbsp;Accessing Network File Systems Topics</a></p>
<p class="toc level2"><a href="rfsintro-2.html">4.&nbsp;&nbsp;Managing Network File Systems (Overview)</a></p>
<p class="toc level2"><a href="rfsadmin-8.html">5.&nbsp;&nbsp;Network File System Administration (Tasks)</a></p>
<p class="toc level2"><a href="rfsrefer-1.html">6.&nbsp;&nbsp;Accessing Network File Systems (Reference)</a></p>
<p class="toc level1 tocsp"><a href="slptm.html">Part&nbsp;III&nbsp;SLP Topics</a></p>
<p class="toc level2"><a href="slparch-16.html">7.&nbsp;&nbsp;SLP (Overview)</a></p>
<p class="toc level2"><a href="slp.setup-10.html">8.&nbsp;&nbsp;Planning and Enabling SLP (Tasks)</a></p>
<p class="toc level2"><a href="ch.configuration-6.html">9.&nbsp;&nbsp;Administering SLP (Tasks)</a></p>
<p class="toc level2"><a href="legacy-7.html">10.&nbsp;&nbsp;Incorporating Legacy Services</a></p>
<p class="toc level2"><a href="slpreference.html">11.&nbsp;&nbsp;SLP (Reference)</a></p>
<p class="toc level1 tocsp"><a href="mailtm-1.html">Part&nbsp;IV&nbsp;Mail Services Topics</a></p>
<p class="toc level2"><a href="mailintro-1.html">12.&nbsp;&nbsp;Mail Services (Overview)</a></p>
<p class="toc level2"><a href="mailadmin-1.html">13.&nbsp;&nbsp;Mail Services (Tasks)</a></p>
<p class="toc level2"><a href="mailrefer-1.html">14.&nbsp;&nbsp;Mail Services (Reference)</a></p>
<p class="toc level1 tocsp"><a href="modemtm-1.html">Part&nbsp;V&nbsp;Serial Networking Topics</a></p>
<p class="toc level2"><a href="pppsvrconfig.intro-1.html">15.&nbsp;&nbsp;Solaris PPP 4.0 (Overview)</a></p>
<p class="toc level2"><a href="pppsvrconfig.p2plink-1.html">16.&nbsp;&nbsp;Planning for the PPP Link (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.dialin-1.html">17.&nbsp;&nbsp;Setting Up a Dial-up PPP Link (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.leased-1.html">18.&nbsp;&nbsp;Setting Up a Leased-Line PPP Link (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.auth-1.html">19.&nbsp;&nbsp;Setting Up PPP Authentication (Tasks)</a></p>
<p class="toc level2"><a href="ppp.pppoe-1.html">20.&nbsp;&nbsp;Setting Up a PPPoE Tunnel (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.troubleshoot-1.html">21.&nbsp;&nbsp;Fixing Common PPP Problems (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.reference-1.html">22.&nbsp;&nbsp;Solaris PPP 4.0 (Reference)</a></p>
<p class="toc level3"><a href="pppsvrconfig.reference-65.html">Using PPP Options in Files and on the Command Line</a></p>
<p class="toc level3"><a href="enmzz.html">Configuring User-Specific Options</a></p>
<p class="toc level3"><a href="pppsvrconfig.reference-45.html">Specifying Information for Communicating With the Dial-in Server</a></p>
<p class="toc level3"><a href="ppp.reference-65.html">Configuring Modem Speed for a Dial-up Link</a></p>
<p class="toc level3"><a href="pppsvrconfig.reference-66.html">Defining the Conversation on the Dial-up Link</a></p>
<p class="toc level4"><a href="pppsvrconfig.reference-66.html#ppp.reference-2">How to Invoke a Chat Script (Task)</a></p>
<p class="toc level4"><a href="pppsvrconfig.reference-66.html#ppp.reference-3">How to Create an Executable Chat Program</a></p>
<p class="toc level3 tocsp"><a href="pppsvrconfig.reference-17.html">Authenticating Callers on a Link</a></p>
<p class="toc level3"><a href="ppp.reference-39.html">Creating an IP Addressing Scheme for Callers</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Creating PPPoE Tunnels for DSL Support</a></p>
</div>
<p class="toc level2 tocsp"><a href="pppsvrconfig.convert.app-1.html">23.&nbsp;&nbsp;Migrating From Asynchronous Solaris PPP to Solaris PPP 4.0 (Tasks)</a></p>
<p class="toc level2"><a href="uucpov-1.html">24.&nbsp;&nbsp;UUCP (Overview)</a></p>
<p class="toc level2"><a href="uucptasks-1.html">25.&nbsp;&nbsp;Administering UUCP (Tasks)</a></p>
<p class="toc level2"><a href="uucpref-1.html">26.&nbsp;&nbsp;UUCP (Reference)</a></p>
<p class="toc level1 tocsp"><a href="wwrstm.html">Part&nbsp;VI&nbsp;Working With Remote Systems Topics</a></p>
<p class="toc level2"><a href="wwrsov.html">27.&nbsp;&nbsp;Working With Remote Systems (Overview)</a></p>
<p class="toc level2"><a href="wuftp-17.html">28.&nbsp;&nbsp;Administering the FTP Server (Tasks)</a></p>
<p class="toc level2"><a href="remotehowtoaccess-99941.html">29.&nbsp;&nbsp;Accessing Remote Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="netmonitortm-1.html">Part&nbsp;VII&nbsp;Monitoring Network Services Topics</a></p>
<p class="toc level2"><a href="netmonitor-1.html">30.&nbsp;&nbsp;Monitoring Network Performance (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="ppp.reference-45"></a><h3>Creating PPPoE Tunnels for DSL Support</h3>
<p>By using PPPoE, you can provide PPP over high-speed digital services to multiple clients
that are using one or more DSL modems. PPPoE implements these services by creating
an Ethernet tunnel through three participants: the enterprise, the telephone company, and the service provider.</p>
<ul><li><p>For an overview and description of how PPPoE works, see <a href="ppp.intro-19.html#ppp.intro-20">PPPoE Overview</a>.</p></li>
<li><p>For tasks for setting up PPPoE tunnels, see <a href="ppp.pppoe-1.html">Chapter&nbsp;20, Setting Up a PPPoE Tunnel (Tasks)</a>.</p></li></ul>
<p><a name="indexterm-2057"></a>This section contains detailed information about PPPoE commands and files, which is summarized in the
next table.</p><a name="ppp.intro-tbl-26"></a><h6>Table&nbsp;22-2 PPPoE Commands and Configuration Files</h6><table><col width="40*"><col width="63.40*"><col width="60*"><tr><th align="left" valign="top" scope="column"><p>File or Command </p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
<th align="left" valign="top" scope="column"><p>For Instructions</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>/etc/ppp/pppoe</tt></p></td>
<td align="left" valign="top" scope="row"><p>A file that contains characteristics that are applied
by default to all tunnels that were set up by PPPoE on the system</p></td>
<td align="left" valign="top" scope="row"><p><a href="#ppp.reference-52"><tt>/etc/ppp/pppoe</tt> File</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>/etc/ppp/pppoe.</tt><i>device</i></p></td>
<td align="left" valign="top" scope="row"><p>A
file that contains characteristics of a particular interface that is used by PPPoE for
a tunnel</p></td>
<td align="left" valign="top" scope="row"><p><a href="#ppp.reference-56"><tt>/etc/ppp/pppoe.</tt><i>device</i> File</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>/etc/ppp/pppoe.if</tt></p></td>
<td align="left" valign="top" scope="row"><p>File that lists the Ethernet interface over which runs the tunnel that is
set up by PPPoE</p></td>
<td align="left" valign="top" scope="row"><p><a href="#ppp.reference-51"><tt>/etc/ppp/pppoe.if</tt> File</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>/usr/sbin/sppptun</tt></p></td>
<td align="left" valign="top" scope="row"><p>Command for configuring the Ethernet interfaces that are involved in a
PPPoE tunnel</p></td>
<td align="left" valign="top" scope="row"><p><a href="#ppp.reference-49"><tt>/usr/sbin/sppptun</tt> Command</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>/usr/lib/inet/pppoed</tt> </p></td>
<td align="left" valign="top" scope="row"><p>Command and options for using PPPoE to set up a tunnel</p></td>
<td align="left" valign="top" scope="row"><p><a href="#ppp.reference-48"><tt>/usr/lib/inet/pppoed</tt> Daemon</a></p></td>
</tr>
</table>

<a name="ppp.reference-50"></a><h4>Files for Configuring Interfaces for PPPoE</h4>
<p>The interfaces that are used at either end of the PPPoE tunnel must be
configured before the tunnel can support PPP communications. Use <tt>/usr/sbin/sppptun</tt> and <tt>/etc/ppp/pppoe.if</tt> files for
this purpose. You must use these tools to configure Ethernet interfaces on all Solaris
PPPoE clients and PPPoE access servers.</p>

<a name="ppp.reference-51"></a><h5><tt>/etc/ppp/pppoe.if</tt> File</h5>
<p><a name="indexterm-2058"></a><a name="indexterm-2059"></a>The <tt>/etc/ppp/pppoe.if</tt> file lists the names of all Ethernet interfaces on a host to
be used for the PPPoE tunnels. This file is processed during system boot when
the interfaces that are listed are plumbed for use in PPPoE tunnels.</p><p>You need to create explicitly <tt>/etc/ppp/pppoe.if</tt>. Type the name of one interface to
be configured for PPPoE on each line.</p><p><a name="indexterm-2060"></a>The following example shows an <tt>/etc/ppp/pppoe.if</tt> file for a server that offers three interfaces for
PPPoE tunnels.</p><pre># <tt><b>cat /etc/ppp/pppoe.if</b></tt>
hme1
hme2
hme3</pre><p>PPPoE clients usually have only one interface that is listed in <tt>/etc/ppp/pppoe.if</tt>.</p>

<a name="ppp.reference-49"></a><h5><tt>/usr/sbin/sppptun</tt> Command</h5>
<p><a name="indexterm-2061"></a><a name="indexterm-2062"></a>You can use the <tt>/usr/sbin/sppptun</tt> command to manually plumb and unplumb the Ethernet
interfaces to be used for PPPoE tunnels. By contrast, <tt>/etc/ppp/pppoe.if</tt> is only read when
the system boots. These interfaces should correspond to the interfaces that are listed in
<tt>/etc/ppp/pppoe.if</tt>.</p><p><tt>sppptun</tt> plumbs the Ethernet interfaces that are used in PPPoE tunnels in a manner
that is similar to the <tt>ifconfig</tt> command. Unlike <tt>ifconfig</tt>, you must plumb interfaces twice to support
PPPoE because two Ethernet protocol numbers are involved.</p><p>The basic syntax for <tt>sppptun</tt> is as follows:</p><pre><tt><b># /usr/sbin/sppptun plumb pppoed</b></tt> <i>device-name</i>
     <i>device-name</i>:pppoed
<tt><b># /usr/sbin/sppptun plumb pppoe</b></tt> <tt>device-name</tt>
     <i>device-name</i>:pppoe</pre><p>In this syntax, <i>device-name</i> is the name of the device to be plumbed
for PPPoE.</p><p>The first time that you issue the <tt>sppptun</tt> command, the discovery protocol <tt>pppoed</tt> is plumbed
on the interface. The second time that you run <tt>sppptun</tt>, the session protocol <tt>pppoe</tt>
is plumbed. <tt>sppptun</tt> prints the name of the interface that was just plumbed. You use
this name to unplumb the interface, when necessary.</p><p>For more information, refer to the <a href="http://docs.sun.com/doc/819-2240/sppptun-1m?a=view"><tt>sppptun</tt>(1M)</a> man page.</p>

<a name="egjzz"></a><h5>Examples of <tt>sppptun</tt> Commands for Administering Interfaces</h5>
<p>The following example shows how to manually plumb an interface for PPPoE by using
<tt>/usr/sbin/sppptun</tt>.</p><pre># <tt><b>/usr/sbin/sppptun plumb pppoed hme0</b></tt>
hme0:pppoed
# <tt><b>/dev/sppptun plumb pppoe hme0</b></tt>
 hme0:pppoe</pre><p>This example shows how to list the interfaces on an access server that was
plumbed for PPPoE.</p><pre># <tt><b>/usr/sbin/sppptun query</b></tt>
hme0:pppoe
hme0:pppoed
hme1:pppoe
hme1:pppoed
hme2:pppoe
hme2:pppoed</pre><p>This example shows how to unplumb an interface.</p><pre># <tt><b>sppptun unplumb hme0:pppoed</b></tt>
# <tt><b>sppptun unplumb hme0:pppoe</b></tt></pre>

<a name="ppp.reference-47"></a><h4>PPPoE Access Server Commands and Files</h4>
<p><a name="indexterm-2063"></a>A service provider that offers DSL services or support to customers can use an
access server that is running Solaris PPPoE. The PPPoE access server and client do function
in the traditional client-server relationship. This relationship is similar to the relationship of the dial-out
machine and dial-in server on a dial-up link.  One PPPoE system initiates communications
and one PPPoE system answers. By contrast, the PPP protocol has no notion of
the client-server relationship.  PPP considers both systems equal peers.</p><p>The commands and files that set up a PPPoE access server include the following:
</p>
<ul><li><p><a href="#ppp.reference-49"><tt>/usr/sbin/sppptun</tt> Command</a></p></li>
<li><p><a href="#ppp.reference-48"><tt>/usr/lib/inet/pppoed</tt> Daemon</a></p></li>
<li><p><a href="#ppp.reference-52"><tt>/etc/ppp/pppoe</tt> File</a></p></li>
<li><p><a href="#ppp.reference-56"><tt>/etc/ppp/pppoe.</tt><i>device</i> File</a></p></li>
<li><p><a href="#ppp.reference-63"><tt>pppoe.so</tt> Shared Object</a></p></li></ul>


<a name="ppp.reference-48"></a><h5><tt>/usr/lib/inet/pppoed</tt> Daemon</h5>
<p><a name="indexterm-2064"></a>The <tt>pppoed</tt> daemon accepts broadcasts for services from prospective PPPoE clients. Additionally, <tt>pppoed</tt> negotiates
the server side of the PPPoE tunnel and runs <tt>pppd</tt>, the PPP daemon,
over that tunnel. </p><p>You configure <tt>pppoed</tt> services in the <tt>/etc/ppp/pppoe</tt> and <tt>/etc/ppp/pppoe.</tt><i>device</i> files. If <tt>/etc/ppp/pppoe</tt> exists
when the system boots, <tt>pppoed</tt> runs automatically. You can also explicitly run the <tt>pppoed</tt> daemon on
the command line by typing <tt>/usr/lib/inet/pppoed</tt>. </p>

<a name="ppp.reference-52"></a><h5><tt>/etc/ppp/pppoe</tt> File</h5>
<a name="indexterm-2065"></a><a name="indexterm-2066"></a><p>The <tt>/etc/ppp/pppoe</tt> file describes the services that are offered by an access server plus
options that define how PPP runs over the PPPoE tunnel. You can define services
for individual interfaces, or globally, that is, for all interfaces on the access server. The
access server sends the information in the <tt>/etc/ppp/pppoe</tt> file in response to a broadcast
from a potential PPPoE client. </p><p><a name="indexterm-2067"></a>The following is the basic syntax of <tt>/etc/ppp/pppoe</tt>:</p><pre><i>global-options</i>
<i>service</i> <i>service-name</i>
    <i>service-specific-options</i>
    <i>device</i> <i>interface-name</i>
  </pre><p>The parameters have the following meanings.</p><dl><dt><i>global-options</i></dt>
<dd><p>Sets the default options for the <tt>/etc/ppp/pppoe</tt> file. These options can be any options that are available through <tt>pppoed</tt> or <tt>pppd</tt>. For complete lists of options, see the man pages <a href="http://docs.sun.com/doc/819-2240/pppoed-1m?a=view"><tt>pppoed</tt>(1M)</a> and <a href="http://docs.sun.com/doc/819-2240/pppd-1m?a=view"><tt>pppd</tt>(1M)</a>.</p><p>For example, you must list the Ethernet interfaces that are available for the PPPoE tunnel as part of <i>global options</i>. If you do not define devices in <tt>/etc/ppp/pppoe</tt>, the services are not offered on any interface.</p><p>To define <tt>devices</tt> as a global option, use the following form:</p><pre><i>device</i> <i>interface &lt;,interface></i></pre><p><i>interface</i> specifies the interface where the service listens for potential PPPoE clients. If more than one interface is associated with the service, separate each name with a comma.</p></dd>
<dt><i>service</i> <i>service-name</i></dt>
<dd><p>Starts the definition of the service <i>service-name</i>. <i>service-name</i> is a string that can be any phrase that is appropriate to the services that are provided.</p></dd>
<dt><i>service-specific-options</i></dt>
<dd><p>Lists the PPPoE and PPP options specific to this service.</p></dd>
<dt><tt>device</tt> <i>interface-name</i></dt>
<dd><p>Specifies the interface where the previously listed service is available.</p></dd>
</dl>
<p>For additional options to <tt>/etc/ppp/pppoe</tt>, refer to the <a href="http://docs.sun.com/doc/819-2240/pppoed-1m?a=view"><tt>pppoed</tt>(1M)</a> and <a href="http://docs.sun.com/doc/819-2240/pppd-1m?a=view"><tt>pppd</tt>(1M)</a> man pages.</p><p><a name="indexterm-2068"></a><a name="indexterm-2069"></a>A typical <tt>/etc/ppp/pppoe</tt> file might resemble the following.</p><a name="ppp.reference-ex-10"></a>Example&nbsp;22-2 Basic <tt>/etc/ppp/pppoe</tt> File<pre>device hme1,hme2,hme3
service internet
   pppd "name internet-server"
service intranet
   pppd "192.168.1.1:"
service debug
   device hme1
   pppd "debug name internet-server"</pre><p>In this file, the following values apply.</p><dl><dt><tt>hme1,hme2,hme3</tt></dt>
<dd><p>Three interfaces on the access server to be used for PPPoE tunnels.</p></dd>
<dt><tt>service internet</tt></dt>
<dd><p>Advertises a service that is called <tt>internet</tt> to prospective clients. The provider that offers the service also determines how <tt>internet</tt> is defined. For example, a provider might interpret <tt>internet</tt> to mean various IP services, as well as access to the Internet.</p></dd>
<dt><tt>pppd</tt></dt>
<dd><p>Sets the command-line options that are used when the caller invokes <tt>pppd</tt>. The option <tt>"name internet-server"</tt> gives the name of the local machine, the access server, as <tt>internet-server</tt>.</p></dd>
<dt><tt>service intranet</tt></dt>
<dd><p>Advertises another service that is called <tt>intranet</tt> to prospective clients.</p></dd>
<dt><tt>pppd "192.168.1.1:"</tt></dt>
<dd><p>Sets the command-line options that are used when the caller invokes <tt>pppd</tt>. When the caller invokes <tt>pppd</tt>, 192.168.1.1 is set as the IP address for the local machine, the access server.</p></dd>
<dt><tt>service debug</tt></dt>
<dd><p>Advertises a third service, debugging, on the interfaces that are defined for PPPoE.</p></dd>
<dt><tt>device hme1</tt></dt>
<dd><p>Restricts debugging to PPPoE tunnels to <tt>hme1</tt>.</p></dd>
<dt><tt>pppd "debug name internet-server"</tt></dt>
<dd><p>Sets the command-line options that are used when the caller invokes <tt>pppd</tt>, in this instance, PPP debugging on <tt>internet-server</tt>, the local machine.</p></dd>
</dl>


<a name="ppp.reference-56"></a><h5><tt>/etc/ppp/pppoe.</tt><i>device</i> File</h5>
<p><a name="indexterm-2070"></a><a name="indexterm-2071"></a>The <tt>/etc/ppp/pppoe.</tt><i>device</i> file describes the services that are offered on one interface of a
PPPoE access server. <tt>/etc/ppp/pppoe.</tt><i>device</i> also includes options that define how PPP runs over the PPPoE
tunnel. <tt>/etc/ppp/pppoe.</tt><i>device</i> is an optional file, which operates exactly like the global <tt>/etc/ppp/pppoe</tt>. However, if
<tt>/etc/ppp/pppoe.</tt><i>device</i> is defined for an interface, its parameters have precedence for that interface over the
global parameters that are defined in <tt>/etc/ppp/pppoe</tt>.</p><p><a name="indexterm-2072"></a>The basic syntax of <tt>/etc/ppp/pppoe.</tt><i>device</i> is as follows:</p><pre><tt><b>service</b></tt> <i>service-name</i>
     <i>service-specific-options</i>
<tt><b>service</b></tt> <i>another-service-name</i>
      <i>service-specific-options</i>    </pre><p>The only difference between this syntax and the syntax of <tt>/etc/ppp/pppoe</tt> is that
you cannot use the <tt>device</tt> option that is shown in <a href="#ppp.reference-52"><tt>/etc/ppp/pppoe</tt> File</a>. </p>

<a name="ppp.reference-59"></a><h5><tt>pppoe.so</tt> Plugin</h5>
<p><a name="indexterm-2073"></a><tt>pppoe.so</tt> is the PPPoE shared object file that must be invoked by PPPoE access
servers and clients. This file limits MTU and MRU to 1492, filters packets from the
driver, and negotiates the PPPoE tunnel, along with <tt>pppoed</tt>. On the access server side,
<tt>pppoe.so</tt> is automatically invoked by the <tt>pppd</tt> daemon.</p>

<a name="ppp.reference-71"></a><h5>Using PPPoE and PPP Files to Configure an Access Server</h5>
<a name="indexterm-2074"></a><p>This section contains samples of all files that are used to configure an access
server. The access server is multihomed. The server is attached to three subnets: <tt>green</tt>,
<tt>orange</tt>, and <tt>purple</tt>. <tt>pppoed</tt> runs as <tt>root</tt> on the server, which is the
default.</p><p>PPPoE clients can access the <tt>orange</tt> and <tt>purple</tt> networks through interfaces <tt>hme0</tt> and
<tt>hme1</tt>. Clients log in to the server by using the standard UNIX login. The
server authenticates the clients by using PAP.</p><p><a name="indexterm-2075"></a>The <tt>green</tt> network is not advertised to clients. The only way clients can access
<tt>green</tt> is by directly specifying &ldquo;<tt>green-net</tt>&rdquo; and supplying CHAP authentication credentials. Moreover, only clients
<tt>joe</tt> and <tt>mary</tt> are allowed to access the <tt>green</tt> network by using  static
IP addresses.</p><a name="ppp.reference-ex-11"></a>Example&nbsp;22-3 <tt>/etc/ppp/pppoe</tt> File for an Access Server<pre>service orange-net
     device hme0,hme1
     pppd "require-pap login name orange-server orange-server:"
service purple-net
     device hme0,hme1 
     pppd "require-pap login name purple-server purple-server:"
service green-net
     device hme1 
     pppd "require-chap name green-server green-server:"
     nowildcard</pre><p>This sample describes the services that are available from the access server. The first
service section describes the services of the <tt>orange</tt> network.</p><pre>service orange-net
     device hme0,hme1
     pppd "require-pap login name orange-server orange-server:"</pre><p>Clients access the <tt>orange</tt> network over interfaces <tt>hme0</tt> and <tt>hme1</tt>. The options that
are given to the <tt>pppd</tt> command force the server to require PAP credentials from potential
clients. The <tt>pppd</tt> options also set the server's name to <tt>orange-server</tt>, as used in
the <tt>pap-secrets</tt> file.</p><p>The service section for the <tt>purple</tt> network is identical to the service section
of the <tt>orange</tt> network except for the network and server names.</p><p>The next section describes the services of the <tt>green</tt> network:</p><pre>service green-net
     device hme1 
     pppd "require-chap name green-server green-server:"
     nowildcard</pre><p>This section restricts client access to interface <tt>hme1</tt>. Options that are given to the
<tt>pppd</tt> command force the server to require CHAP credentials from prospective clients. The <tt>pppd</tt>
options also set the server name to <tt>green-server</tt>, to be used in the
<tt>chap-secrets</tt> file. The <tt>nowildcard</tt> option specifies that the existence of the green network is
not advertised to clients.</p><p><a name="indexterm-2076"></a><a name="indexterm-2077"></a>For this access server scenario just discussed, you might set up the following <tt>/etc/ppp/options</tt>
file.</p><a name="ppp.reference-ex-12"></a>Example&nbsp;22-4 <tt>/etc/ppp/options</tt> File for an Access Server<pre>     auth
     proxyarp
     nodefaultroute
     name no-service    # don't authenticate otherwise</pre><p><a name="indexterm-2078"></a><a name="indexterm-2079"></a><a name="indexterm-2080"></a>The option <tt>name no-service</tt> overrides the server name that is normally searched for during PAP
or CHAP authentication. The server's default name is  the one found by the
<tt>/usr/bin/hostname</tt> command. The <tt>name</tt> option in the previous example changes the server's name to
<tt>no-service</tt>. The name <tt>no-service</tt> is not likely to be found in a <tt>pap</tt> or
<tt>chap-secrets</tt> file. This action prevents a random user from running <tt>pppd</tt> and overriding the <tt>auth</tt>
and <tt>name</tt> options that are set in <tt>/etc/ppp/options</tt>. <tt>pppd</tt> then fails because no secrets
can be found for the client with a server name of <tt>no-service</tt>.</p><p>The access server scenario uses the following <tt>/etc/hosts</tt> file.</p><a name="ppp.reference-ex-13"></a>Example&nbsp;22-5 <tt>/etc/hosts</tt> File for an Access Server<pre>     172.16.0.1    orange-server
     172.17.0.1    purple-server
     172.18.0.1    green-server
     172.18.0.2    joes-pc
     172.18.0.3    marys-pc</pre><p><a name="indexterm-2081"></a><a name="indexterm-2082"></a>Here is the <tt>/etc/ppp/pap-secrets</tt> file that is used for PAP authentication for clients
that attempt to access the <tt>orange</tt> and <tt>purple</tt> networks.</p><a name="ppp.reference-ex-14"></a>Example&nbsp;22-6 <tt>/etc/ppp/pap-secrets</tt> File for an Access Server<pre>* orange-server "" 172.16.0.2/16+
* purple-server "" 172.17.0.2/16+</pre><p><a name="indexterm-2083"></a><a name="indexterm-2084"></a>Here is the <tt>/etc/ppp/chap-secrets</tt> file that is used for CHAP authentication. Note that
only clients <tt>joe</tt> and <tt>mary</tt> are listed in the file.</p><a name="ppp.reference-ex-15"></a>Example&nbsp;22-7 <tt>/etc/ppp/chap-secrets</tt> File for an Access Server<pre> joe green-server "joe's secret" joes-pc
mary green-server "mary's secret" marys-pc</pre>

<a name="ppp.reference-55"></a><h4>PPPoE Client Commands and Files</h4>
<p><a name="indexterm-2085"></a><a name="indexterm-2086"></a>To run PPP over a DSL modem, a machine must become a PPPoE client.
You have to plumb an interface to run PPPoE, and then use the
<tt>pppoec</tt> utility to &ldquo;discover&rdquo; the existence of an access server. Thereafter, the client can
create the PPPoE tunnel over the DSL modem and run PPP.</p><p>The PPPoE client relates to the access server in the traditional client-server model. The
PPPoE tunnel is not a dial-up link, but the tunnel is configured and operated
in much the same manner. </p><p>The commands and files that set up a PPPoE client include the following:</p>
<ul><li><p><a href="#ppp.reference-49"><tt>/usr/sbin/sppptun</tt> Command</a></p></li>
<li><p><a href="#ppp.reference-58"><tt>/usr/lib/inet/pppoec</tt> Utility</a></p></li>
<li><p><a href="#ppp.reference-63"><tt>pppoe.so</tt> Shared Object</a></p></li>
<li><p><a href="pppsvrconfig.reference-45.html#pppsvrconfig.reference-56"><tt>/etc/ppp/peers/</tt><i>peer-name</i> File</a></p></li>
<li><p><a href="pppsvrconfig.reference-65.html#pppsvrconfig.reference-46"><tt>/etc/ppp/options</tt> Configuration File</a></p></li></ul>


<a name="ppp.reference-58"></a><h5><tt>/usr/lib/inet/pppoec</tt> Utility</h5>
<p><a name="indexterm-2087"></a>The <tt>/usr/lib/inet/pppoec</tt> utility is responsible for negotiating the client side of a PPPoE tunnel.
<tt>pppoec</tt> is similar to the Solaris PPP 4.0 <tt>chat</tt> utility. You do not
invoke <tt>pppoec</tt> directly. Rather, you start <tt>/usr/lib/inet/pppoec</tt> as an argument to the <tt>connect</tt> option of
<tt>pppd</tt>.</p>

<a name="ppp.reference-63"></a><h5><tt>pppoe.so</tt> Shared Object</h5>
<p><a name="indexterm-2088"></a><tt>pppoe.so</tt> is the PPPoE shared object that must be loaded by PPPoE to provide
PPPoE capability to access servers and clients. The <tt>pppoe.so</tt> shared object limits MTU and MRU
to 1492, filters packets from the driver, and handles runtime PPPoE messages.</p><p>On the client side, <tt>pppd</tt> loads <tt>pppoe.so</tt> when the user specifies the <tt>plugin pppoe.so</tt>
option.</p>

<a name="ppp.reference-46"></a><h5><tt>/etc/ppp/peers/</tt><i>peer-name</i> File for Defining an Access Server Peer</h5>
<p><a name="indexterm-2089"></a><a name="indexterm-2090"></a><a name="indexterm-2091"></a>When you define an access server to be discovered by <tt>pppoec</tt>, you use
options that apply to both <tt>pppoec</tt> and the <tt>pppd</tt> daemon. An <tt>/etc/ppp/peers/</tt><i>peer-name</i> file for an access
server requires the following parameters:</p>
<ul><li><p><tt>sppptun</tt> &ndash; Name for the serial device that is used by the PPPoE tunnel.</p></li>
<li><p><tt>plugin pppoe.so</tt> &ndash; Instructs <tt>pppd</tt> to load the <tt>pppoe.so</tt> shared object.</p></li>
<li><p><tt>connect "/usr/lib/inet/pppoec</tt> <i>device</i><tt>"</tt> &ndash; Starts a connection. <tt>connect</tt> then invokes the <tt>pppoec</tt> utility over <i>device</i>, the interface that is plumbed for PPPoE.</p></li></ul>
<p>The remaining parameters in the <tt>/etc/ppp/peers/</tt><i>peer-name</i> file should apply to the PPP link on
the server. Use the same options that you would for <tt>/etc/ppp/peers/</tt><i>peer-name</i> on a dial-out machine.
Try to limit the number of options to the minimum you need for the
PPP link.</p><p>The following example is introduced in <a href="ppp.pppoe-2.html#ppp.pppoe-56">How to Define a PPPoE Access Server Peer</a>.</p><a name="ppp.reference-ex-16"></a>Example&nbsp;22-8 <tt>/etc/ppp/peers/</tt><i>peer-name</i> to Define a Remote Access Server<pre># <tt><b>cat /etc/ppp/peers/dslserve</b></tt>
sppptun
plugin pppoe.so
connect "/usr/lib/inet/pppoec hme0"
noccp
noauth
user Red
password redsecret
noipdefault
defaultroute</pre><p>This file defines parameters to be used when setting up a PPPoE tunnel and
PPP link to access server <tt>dslserve</tt>. The options that are included are as
follows.</p><table><col width="41.26*"><col width="58.74*"><tr><th align="left" valign="top" scope="column"><p>Option</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>sppptun</tt></p></td>
<td align="left" valign="top" scope="row"><p>Defines <tt>sppptun</tt> as the name of the serial device.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>plugin pppoe.so</tt></p></td>
<td align="left" valign="top" scope="row"><p>Instructs <tt>pppd</tt> to load the <tt>pppoe.so</tt>
shared object.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>connect "/usr/lib/inet/pppoec hme0"</tt></p></td>
<td align="left" valign="top" scope="row"><p>Runs <tt>pppoec</tt> and designates <tt>hme0</tt> as the interface for the PPPoE tunnel and PPP link.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>noccp</tt></p></td>
<td align="left" valign="top" scope="row"><p>Turns
off CCP compression on the link.</p>
<hr><p><b>Note - </b>Many ISPs use only proprietary compression algorithms. Turning off the
publicly available CCP algorithm saves negotiation time and avoids very occasional interoperability problems.</p>
<hr>
</td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>noauth</tt></p></td>
<td align="left" valign="top" scope="row"><p>Stops <tt>pppd</tt>
from demanding authentication credentials from the access server. Most ISPs do not provide authentication credentials to
customers.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>user Red</tt></p></td>
<td align="left" valign="top" scope="row"><p>Sets the name <tt>Red</tt> as the user name for the client, which is required
for PAP authentication by the access server.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>password redsecret</tt></p></td>
<td align="left" valign="top" scope="row"><p>Defines <tt>redsecret</tt> as the password to be provided
to the access server for PAP authentication.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>noipdefault</tt></p></td>
<td align="left" valign="top" scope="row"><p>Assigns 0.0.0.0 as the initial IP address.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>defaultroute</tt></p></td>
<td align="left" valign="top" scope="row"><p>Tells <tt>pppd</tt>
to install a default IPv4 route after IPCP negotiation. You should include <tt>defaultroute</tt> in
<tt>/etc/ppp/peers/</tt><i>peer-name</i> when the link is the system's link to the Internet, which is true
for a PPPoE client.</p></td>
</tr>
</table>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ppp.reference-39.html">Previous</a>
             </td>
             <td align="right">
                 <a href="pppsvrconfig.convert.app-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

