<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Commands for Troubleshooting NFS Problems - System Administration Guide: Network Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Network Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="rfsrefer-13.html">Previous</a>
             </td>
             <td align="right">
                 <a href="rfsrefer-154.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="netservices-1.html">Part&nbsp;I&nbsp;Network Services Topics</a></p>
<p class="toc level2"><a href="nsov-1.html">1.&nbsp;&nbsp;Network Service (Overview)</a></p>
<p class="toc level2"><a href="nca-1.html">2.&nbsp;&nbsp;Managing Web Cache Servers</a></p>
<p class="toc level2"><a href="time-1.html">3.&nbsp;&nbsp;Time-Related Services</a></p>
<p class="toc level1 tocsp"><a href="rfstm-1.html">Part&nbsp;II&nbsp;Accessing Network File Systems Topics</a></p>
<p class="toc level2"><a href="rfsintro-2.html">4.&nbsp;&nbsp;Managing Network File Systems (Overview)</a></p>
<p class="toc level2"><a href="rfsadmin-8.html">5.&nbsp;&nbsp;Network File System Administration (Tasks)</a></p>
<p class="toc level2"><a href="rfsrefer-1.html">6.&nbsp;&nbsp;Accessing Network File Systems (Reference)</a></p>
<p class="toc level3"><a href="rfsrefer-6.html">NFS Files</a></p>
<p class="toc level3"><a href="rfsrefer-8.html">NFS Daemons</a></p>
<p class="toc level3"><a href="rfsrefer-13.html">NFS Commands</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Commands for Troubleshooting NFS Problems</a></p>
</div>
<p class="toc level3"><a href="rfsrefer-154.html">NFS Over RDMA</a></p>
<p class="toc level3"><a href="rfsrefer-45.html">How the NFS Service Works</a></p>
<p class="toc level3"><a href="rfsrefer-66.html">Autofs Maps</a></p>
<p class="toc level3"><a href="rfsrefer-75.html">How Autofs Works</a></p>
<p class="toc level3"><a href="rfsrefer-98.html">Autofs Reference</a></p>
<p class="toc level1 tocsp"><a href="slptm.html">Part&nbsp;III&nbsp;SLP Topics</a></p>
<p class="toc level2"><a href="slparch-16.html">7.&nbsp;&nbsp;SLP (Overview)</a></p>
<p class="toc level2"><a href="slp.setup-10.html">8.&nbsp;&nbsp;Planning and Enabling SLP (Tasks)</a></p>
<p class="toc level2"><a href="ch.configuration-6.html">9.&nbsp;&nbsp;Administering SLP (Tasks)</a></p>
<p class="toc level2"><a href="legacy-7.html">10.&nbsp;&nbsp;Incorporating Legacy Services</a></p>
<p class="toc level2"><a href="slpreference.html">11.&nbsp;&nbsp;SLP (Reference)</a></p>
<p class="toc level1 tocsp"><a href="mailtm-1.html">Part&nbsp;IV&nbsp;Mail Services Topics</a></p>
<p class="toc level2"><a href="mailintro-1.html">12.&nbsp;&nbsp;Mail Services (Overview)</a></p>
<p class="toc level2"><a href="mailadmin-1.html">13.&nbsp;&nbsp;Mail Services (Tasks)</a></p>
<p class="toc level2"><a href="mailrefer-1.html">14.&nbsp;&nbsp;Mail Services (Reference)</a></p>
<p class="toc level1 tocsp"><a href="modemtm-1.html">Part&nbsp;V&nbsp;Serial Networking Topics</a></p>
<p class="toc level2"><a href="pppsvrconfig.intro-1.html">15.&nbsp;&nbsp;Solaris PPP 4.0 (Overview)</a></p>
<p class="toc level2"><a href="pppsvrconfig.p2plink-1.html">16.&nbsp;&nbsp;Planning for the PPP Link (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.dialin-1.html">17.&nbsp;&nbsp;Setting Up a Dial-up PPP Link (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.leased-1.html">18.&nbsp;&nbsp;Setting Up a Leased-Line PPP Link (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.auth-1.html">19.&nbsp;&nbsp;Setting Up PPP Authentication (Tasks)</a></p>
<p class="toc level2"><a href="ppp.pppoe-1.html">20.&nbsp;&nbsp;Setting Up a PPPoE Tunnel (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.troubleshoot-1.html">21.&nbsp;&nbsp;Fixing Common PPP Problems (Tasks)</a></p>
<p class="toc level2"><a href="pppsvrconfig.reference-1.html">22.&nbsp;&nbsp;Solaris PPP 4.0 (Reference)</a></p>
<p class="toc level2"><a href="pppsvrconfig.convert.app-1.html">23.&nbsp;&nbsp;Migrating From Asynchronous Solaris PPP to Solaris PPP 4.0 (Tasks)</a></p>
<p class="toc level2"><a href="uucpov-1.html">24.&nbsp;&nbsp;UUCP (Overview)</a></p>
<p class="toc level2"><a href="uucptasks-1.html">25.&nbsp;&nbsp;Administering UUCP (Tasks)</a></p>
<p class="toc level2"><a href="uucpref-1.html">26.&nbsp;&nbsp;UUCP (Reference)</a></p>
<p class="toc level1 tocsp"><a href="wwrstm.html">Part&nbsp;VI&nbsp;Working With Remote Systems Topics</a></p>
<p class="toc level2"><a href="wwrsov.html">27.&nbsp;&nbsp;Working With Remote Systems (Overview)</a></p>
<p class="toc level2"><a href="wuftp-17.html">28.&nbsp;&nbsp;Administering the FTP Server (Tasks)</a></p>
<p class="toc level2"><a href="remotehowtoaccess-99941.html">29.&nbsp;&nbsp;Accessing Remote Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="netmonitortm-1.html">Part&nbsp;VII&nbsp;Monitoring Network Services Topics</a></p>
<p class="toc level2"><a href="netmonitor-1.html">30.&nbsp;&nbsp;Monitoring Network Performance (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="rfsrefer-37"></a><h3>Commands for Troubleshooting NFS Problems</h3>
<p>These commands can be useful when troubleshooting NFS problems.</p>

<a name="rfsrefer-38"></a><h4><tt>nfsstat</tt> Command</h4>
<a name="indexterm-667"></a><p>You can use this command to gather statistical information about NFS and RPC
connections. The syntax of the command is as follows:</p><p><tt>nfsstat</tt> <tt>[</tt>  <tt>-cmnrsz</tt> <tt>]</tt> </p><dl><dt><tt>-c</tt></dt>
<dd><p>Displays client-side information</p></dd>
<dt><tt>-m</tt></dt>
<dd><p>Displays statistics for each NFS-mounted file system</p></dd>
<dt><tt>-n</tt></dt>
<dd><p>Specifies that NFS information is to be displayed on both the client side and the server side</p></dd>
<dt><tt>-r</tt></dt>
<dd><p>Displays RPC statistics</p></dd>
<dt><tt>-s</tt></dt>
<dd><p>Displays the server-side information</p></dd>
<dt><tt>-z</tt></dt>
<dd><p>Specifies that the statistics should be set to zero</p></dd>
</dl>
<p>If no options are supplied on the command line, the <tt>-cnrs</tt> options are
used. </p><p>Gathering server-side statistics can be important for debugging problems when new software or
new hardware is added to the computing environment. Running this command a minimum
of once a week, and storing the numbers, provides a good history of
previous performance.</p><p>Refer to the following example:</p><pre># <tt><b>nfsstat -s</b></tt>

Server rpc:
Connection oriented:
calls      badcalls   nullrecv   badlen     xdrcall    dupchecks  dupreqs    
719949194  0          0          0          0          58478624   33         
Connectionless:
calls      badcalls   nullrecv   badlen     xdrcall    dupchecks  dupreqs    
73753609   0          0          0          0          987278     7254       

Server nfs:
calls                badcalls             
787783794            3516                 
Version 2: (746607 calls)
null       getattr    setattr    root       lookup     readlink   read       
883 0%     60 0%      45 0%      0 0%       177446 23% 1489 0%    537366 71% 
wrcache    write      create     remove     rename     link       symlink    
0 0%       1105 0%    47 0%      59 0%      28 0%      10 0%      9 0%       
mkdir      rmdir      readdir    statfs     
26 0%      0 0%       27926 3%   108 0%     
Version 3: (728863853 calls)
null          getattr       setattr       lookup        access        
1365467 0%    496667075 68% 8864191 1%    66510206 9%   19131659 2%   
readlink      read          write         create        mkdir         
414705 0%     80123469 10%  18740690 2%   4135195 0%    327059 0%     
symlink       mknod         remove        rmdir         rename        
101415 0%     9605 0%       6533288 0%    111810 0%     366267 0%     
link          readdir       readdirplus   fsstat        fsinfo        
2572965 0%    519346 0%     2726631 0%    13320640 1%   60161 0%      
pathconf      commit        
13181 0%      6248828 0%    
Version 4: (54871870 calls)
null                compound            
266963 0%           54604907 99%        
Version 4: (167573814 operations)
reserved            access              close               commit              
0 0%                2663957 1%          2692328 1%          1166001 0%          
create              delegpurge          delegreturn         getattr             
167423 0%           0 0%                1802019 1%          26405254 15%        
getfh               link                lock                lockt               
11534581 6%         113212 0%           207723 0%           265 0%              
locku               lookup              lookupp             nverify             
230430 0%           11059722 6%         423514 0%           21386866 12%        
open                openattr            open_confirm        open_downgrade      
2835459 1%          4138 0%             18959 0%            3106 0%             
putfh               putpubfh            putrootfh           read                
52606920 31%        0 0%                35776 0%            4325432 2%          
readdir             readlink            remove              rename              
606651 0%           38043 0%            560797 0%           248990 0%           
renew               restorefh           savefh              secinfo             
2330092 1%          8711358 5%          11639329 6%         19384 0%            
setattr             setclientid         setclientid_confirm verify              
453126 0%           16349 0%            16356 0%            2484 0%             
write               release_lockowner   illegal             
3247770 1%          0 0%                0 0%                

Server nfs_acl:
Version 2: (694979 calls)
null        getacl      setacl      getattr     access      getxattrdir 
0 0%        42358 6%    0 0%        584553 84%  68068 9%    0 0%        
Version 3: (2465011 calls)
null        getacl      setacl      getxattrdir 
0 0%        1293312 52% 1131 0%     1170568 47% </pre><p>The previous listing is an example of NFS server statistics. The first five
lines relate to RPC and the remaining lines report NFS activities. In both
sets of statistics, knowing the average number of <tt>badcalls</tt> or <tt>calls</tt> and
the number of calls per week can help identify a problem. The <tt>badcalls</tt>
value reports the number of bad messages from a client. This value can
indicate network hardware problems.</p><p>Some of the connections generate write activity on the disks. A sudden increase
in these statistics could indicate trouble and should be investigated. For NFS version
2 statistics, the connections to note are <tt>setattr</tt>, <tt>write</tt>, <tt>create</tt>, <tt>remove</tt>, <tt>rename</tt>,
<tt>link</tt>, <tt>symlink</tt>, <tt>mkdir</tt>, and <tt>rmdir</tt>. For NFS version 3 and version 4 statistics, the
value to watch is <tt>commit</tt>. If the <tt>commit</tt> level is high in one
NFS server, compared to another almost identical server, check that the NFS clients
have enough memory. The number of <tt>commit</tt> operations on the server grows when
clients do not have available resources.</p>

<a name="rfsrefer-40"></a><h4><tt>pstack</tt> Command</h4>
<a name="indexterm-668"></a><p>This command displays a stack trace for each process. The <tt>pstack</tt> command must
be run by the owner of the process or by <tt>root</tt>. You can
use <tt>pstack</tt> to determine where a process is hung. The only option that
is allowed with this command is the <tt>PID</tt> of the process that you
want to check. See the <a href="http://docs.sun.com/doc/819-2239/proc-1?a=view"><tt>proc</tt>(1)</a> man page.</p><p>The following example is checking the <tt>nfsd</tt> process that is running.</p><pre># <tt><b>/usr/bin/pgrep nfsd</b></tt>
243
# <tt><b>/usr/bin/pstack 243</b></tt>
243:    /usr/lib/nfs/nfsd -a 16
 ef675c04 poll     (24d50, 2, ffffffff)
 000115dc ???????? (24000, 132c4, 276d8, 1329c, 276d8, 0)
 00011390 main     (3, efffff14, 0, 0, ffffffff, 400) + 3c8
 00010fb0 _start   (0, 0, 0, 0, 0, 0) + 5c</pre><p>The example shows that the process is waiting for a new connection
request, which  is a normal response. If the stack shows that the
process is still in poll after a request is made, the process might
be hung. Follow the instructions in <a href="rfsadmin-215.html#rfsadmin-240">How to Restart NFS Services</a> to fix this problem. Review the instructions
in <a href="rfsadmin-215.html">NFS Troubleshooting Procedures</a> to fully verify that your problem is a hung program.</p>

<a name="rfsrefer-41"></a><h4><tt>rpcinfo</tt> Command</h4>
<a name="indexterm-669"></a><p>This command generates information about the RPC service that is running on a
system. You can also use this command to change the RPC service.
Many options are available with this command. See the <a href="http://docs.sun.com/doc/819-2240/rpcinfo-1m?a=view"><tt>rpcinfo</tt>(1M)</a> man page. The
following is a shortened synopsis for some of the options that you can
use with the command.</p><p><tt>rpcinfo</tt> <tt>[</tt> <tt>-m</tt> <tt>|</tt> <tt>-s</tt> <tt>]</tt> <tt>[</tt> <i>hostname</i> <tt>]</tt></p><p><tt>rpcinfo</tt> <tt>-T</tt> <i>transport</i> <i>hostname</i> <tt>[</tt> <i>progname</i> <tt>]</tt></p><p><tt>rpcinfo</tt> <tt>[</tt> <tt>-t</tt> <tt>|</tt> <tt>-u</tt> <tt>]</tt> <tt>[</tt> <i>hostname</i> <tt>]</tt> <tt>[</tt> <i>progname</i> <tt>]</tt></p><dl><dt><tt>-m</tt></dt>
<dd><p>Displays a table of statistics of the <tt>rpcbind</tt> operations</p></dd>
<dt><tt>-s</tt></dt>
<dd><p>Displays a concise list of all registered RPC programs</p></dd>
<dt><tt>-T</tt></dt>
<dd><p>Displays information about services that use specific transports or protocols</p></dd>
<dt><tt>-t</tt></dt>
<dd><p>Probes the RPC programs that use TCP</p></dd>
<dt><tt>-u</tt></dt>
<dd><p>Probes the RPC programs that use UDP</p></dd>
<dt><i>transport</i></dt>
<dd><p>Selects the transport or protocol for the services</p></dd>
<dt><i>hostname</i></dt>
<dd><p>Selects the host name of the server that you need information from</p></dd>
<dt><i>progname</i></dt>
<dd><p>Selects the RPC program to gather information about</p></dd>
</dl>
<p>If no value is given for <i>hostname</i>, the local host name is used.
You can substitute the RPC program number for <i>progname</i>, but many users
can remember the name and not the number. You can use the <tt>-p</tt>
option in place of the <tt>-s</tt> option on those systems that do not
run the NFS version 3 software.</p><p>The data that is generated by this command can include the following:</p>
<ul><li><p>The RPC program number</p></li>
<li><p>The version number for a specific program</p></li>
<li><p>The transport protocol that is being used</p></li>
<li><p>The name of the RPC service</p></li>
<li><p>The owner of the RPC service</p></li></ul>
<p>The following example gathers information about the RPC services that are running on
a server. The text that is generated by the command is filtered by
the <tt>sort</tt> command to make the output more readable. Several lines that list
RPC services have been deleted from the example.</p><pre>% <tt><b>rpcinfo -s bee |sort -n</b></tt>
   program version(s) netid(s)                         service     owner
    100000  2,3,4     udp6,tcp6,udp,tcp,ticlts,ticotsord,ticots rpcbind     superuser
    100001  4,3,2     ticlts,udp,udp6                  rstatd      superuser
    100002  3,2       ticots,ticotsord,tcp,tcp6,ticlts,udp,udp6 rusersd     superuser
    100003  3,2       tcp,udp,tcp6,udp6                nfs         superuser
    100005  3,2,1     ticots,ticotsord,tcp,tcp6,ticlts,udp,udp6 mountd      superuser
    100007  1,2,3     ticots,ticotsord,ticlts,tcp,udp,tcp6,udp6 ypbind      superuser
    100008  1         ticlts,udp,udp6                  walld       superuser
    100011  1         ticlts,udp,udp6                  rquotad     superuser
    100012  1         ticlts,udp,udp6                  sprayd      superuser
    100021  4,3,2,1   tcp,udp,tcp6,udp6                nlockmgr    superuser
    100024  1         ticots,ticotsord,ticlts,tcp,udp,tcp6,udp6 status      superuser
    100029  3,2,1     ticots,ticotsord,ticlts          keyserv     superuser
    100068  5         tcp,udp                          cmsd        superuser
    100083  1         tcp,tcp6                         ttdbserverd superuser
    100099  3         ticotsord                        autofs      superuser
    100133  1         ticots,ticotsord,ticlts,tcp,udp,tcp6,udp6 -           superuser
    100134  1         ticotsord                        tokenring   superuser
    100155  1         ticots,ticotsord,tcp,tcp6        smserverd   superuser
    100221  1         tcp,tcp6                         -           superuser
    100227  3,2       tcp,udp,tcp6,udp6                nfs_acl     superuser
    100229  1         tcp,tcp6                         metad       superuser
    100230  1         tcp,tcp6                         metamhd     superuser
    100231  1         ticots,ticotsord,ticlts          -           superuser
    100234  1         ticotsord                        gssd        superuser
    100235  1         tcp,tcp6                         -           superuser
    100242  1         tcp,tcp6                         metamedd    superuser
    100249  1         ticots,ticotsord,ticlts,tcp,udp,tcp6,udp6 -           superuser
    300326  4         tcp,tcp6                         -           superuser
    300598  1         ticots,ticotsord,ticlts,tcp,udp,tcp6,udp6 -           superuser
    390113  1         tcp                              -           unknown
 805306368  1         ticots,ticotsord,ticlts,tcp,udp,tcp6,udp6 -           superuser
1289637086  1,5       tcp                              -           26069</pre><p>The following two examples show how to gather information about a particular RPC
service by selecting a particular transport on a server. The first example checks
the <tt>mountd</tt> service that is running over TCP. The second example checks the
NFS service that is running over UDP.</p><pre>% <tt><b>rpcinfo -t bee mountd</b></tt>
program 100005 version 1 ready and waiting
program 100005 version 2 ready and waiting
program 100005 version 3 ready and waiting
% <tt><b>rpcinfo -u bee nfs</b></tt>
program 100003 version 2 ready and waiting
program 100003 version 3 ready and waiting</pre>

<a name="rfsrefer-43"></a><h4><tt>snoop</tt> Command</h4>
<a name="indexterm-670"></a><p>This command is often used to watch for packets on the network.
The <tt>snoop</tt> command must be run as <tt>root</tt>. The use of this command
is a good way to ensure that the network hardware is functioning on
both the client and the server. Many options are available. See the
<a href="http://docs.sun.com/doc/819-2240/snoop-1m?a=view"><tt>snoop</tt>(1M)</a> man page. A shortened synopsis of the command follows:</p><p><tt>snoop</tt>  <tt>[</tt> <tt>-d</tt> <i>device</i> <tt>]</tt> <tt>[</tt> <tt>-o</tt> <i>filename</i> <tt>]</tt> <tt>[</tt> <tt>host</tt>
<i>hostname</i> <tt>]</tt>  </p><dl><dt><tt>-d</tt> <i>device</i></dt>
<dd><p>Specifies the local network interface</p></dd>
<dt><tt>-o</tt> <i>filename</i></dt>
<dd><p>Stores all the captured packets into the named file</p></dd>
<dt><i>hostname</i></dt>
<dd><p>Displays packets going to and from a specific host only</p></dd>
</dl>
<p>The <tt>-d</tt> <i>device</i> option is useful on those servers that have multiple network
interfaces. You can use many expressions  other than setting the host. A
combination of command expressions with <tt>grep</tt> can often generate data that is
specific enough to be useful.</p><p>When troubleshooting, make sure that packets are going to and from the proper
host. Also, look for error messages. Saving the packets to a file
can simplify the review of the data.</p>

<a name="rfsrefer-44"></a><h4><tt>truss</tt> Command</h4>
<a name="indexterm-671"></a><p>You can use this command to check if a process is hung.
The <tt>truss</tt> command must be run by the owner of the process or
by <tt>root</tt>. You can use many options with this command. See the <a href="http://docs.sun.com/doc/819-2239/truss-1?a=view"><tt>truss</tt>(1)</a>
man page. A shortened syntax of the command follows.</p><p><tt>truss</tt> <tt>[</tt> <tt>-t</tt> <i>syscall</i> <tt>]</tt> <tt>-p</tt> <i>pid</i></p><dl><dt><tt>-t</tt> <i>syscall</i></dt>
<dd><p>Selects system calls to trace</p></dd>
<dt><tt>-p</tt> <i>pid</i></dt>
<dd><p>Indicates the PID of the process to be traced</p></dd>
</dl>
<p>The <i>syscall</i> can be a comma-separated list of system calls to be traced.
Also, starting <i>syscall</i> with an <tt>!</tt> selects to exclude the listed system calls
from the trace.</p><p>This example shows that the process is waiting for another connection request from
a new client. </p><pre># <tt><b>/usr/bin/truss -p 243</b></tt>
poll(0x00024D50, 2, -1)         (sleeping...)</pre><p>The previous example shows a normal response. If the response does not change
after a new connection request has been made, the process could be hung.
Follow the instructions in <a href="rfsadmin-215.html#rfsadmin-240">How to Restart NFS Services</a> to fix the hung program. Review the
instructions in <a href="rfsadmin-215.html">NFS Troubleshooting Procedures</a> to fully verify that your problem is a hung program.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="rfsrefer-13.html">Previous</a>
             </td>
             <td align="right">
                 <a href="rfsrefer-154.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

