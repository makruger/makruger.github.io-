<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Overview of Secure RPC - System Administration Guide: Security Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Security Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="auth-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="auth-11.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="oview-1.html">Part&nbsp;I&nbsp;Security Overview</a></p>
<p class="toc level2"><a href="secov-1.html">1.&nbsp;&nbsp;Security Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="sectm-1.html">Part&nbsp;II&nbsp;System, File, and Device Security</a></p>
<p class="toc level2"><a href="concept-1.html">2.&nbsp;&nbsp;Managing Machine Security (Overview)</a></p>
<p class="toc level2"><a href="secsys-1.html">3.&nbsp;&nbsp;Controlling Access to Systems (Tasks)</a></p>
<p class="toc level2"><a href="vscan-1.html">4.&nbsp;&nbsp;Virus Scanning Service (Tasks)</a></p>
<p class="toc level2"><a href="devtask-1.html">5.&nbsp;&nbsp;Controlling Access to Devices (Tasks)</a></p>
<p class="toc level2"><a href="bart-1.html">6.&nbsp;&nbsp;Using the Basic Audit Reporting Tool (Tasks)</a></p>
<p class="toc level2"><a href="secfile-1.html">7.&nbsp;&nbsp;Controlling Access to Files (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="prbactm-1.html">Part&nbsp;III&nbsp;Roles, Rights Profiles, and Privileges</a></p>
<p class="toc level2"><a href="prbac-1.html">8.&nbsp;&nbsp;Using Roles and Privileges (Overview)</a></p>
<p class="toc level2"><a href="rbactask-1.html">9.&nbsp;&nbsp;Using Role-Based Access Control (Tasks)</a></p>
<p class="toc level2"><a href="rbacref-1.html">10.&nbsp;&nbsp;Role-Based Access Control (Reference)</a></p>
<p class="toc level2"><a href="privtask-1.html">11.&nbsp;&nbsp;Privileges (Tasks)</a></p>
<p class="toc level2"><a href="privref-1.html">12.&nbsp;&nbsp;Privileges (Reference)</a></p>
<p class="toc level1 tocsp"><a href="scftm-1.html">Part&nbsp;IV&nbsp;Solaris Cryptographic Services</a></p>
<p class="toc level2"><a href="scf-1.html">13.&nbsp;&nbsp;Solaris Cryptographic Framework (Overview)</a></p>
<p class="toc level2"><a href="scftask-1.html">14.&nbsp;&nbsp;Solaris Cryptographic Framework (Tasks)</a></p>
<p class="toc level2"><a href="kmf-1.html">15.&nbsp;&nbsp;Solaris Key Management Framework</a></p>
<p class="toc level1 tocsp"><a href="authtm-1.html">Part&nbsp;V&nbsp;Authentication Services and Secure Communication</a></p>
<p class="toc level2"><a href="auth-1.html">16.&nbsp;&nbsp;Using Authentication Services (Tasks)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Overview of Secure RPC</a></p>
</div>
<p class="toc level3"><a href="auth-11.html">Administering Secure RPC (Task Map)</a></p>
<p class="toc level3"><a href="auth-36.html">Administering Authentication With Secure RPC</a></p>
<p class="toc level2 tocsp"><a href="pam-1.html">17.&nbsp;&nbsp;Using PAM</a></p>
<p class="toc level2"><a href="sasl-1.html">18.&nbsp;&nbsp;Using SASL</a></p>
<p class="toc level2"><a href="sshuser-1.html">19.&nbsp;&nbsp;Using Solaris Secure Shell (Tasks)</a></p>
<p class="toc level2"><a href="sshref-1.html">20.&nbsp;&nbsp;Solaris Secure Shell (Reference)</a></p>
<p class="toc level1 tocsp"><a href="seamtm-1.html">Part&nbsp;VI&nbsp;Kerberos Service</a></p>
<p class="toc level2"><a href="intro-1.html">21.&nbsp;&nbsp;Introduction to the Kerberos Service</a></p>
<p class="toc level2"><a href="seamplan-1.html">22.&nbsp;&nbsp;Planning for the Kerberos Service</a></p>
<p class="toc level2"><a href="setup-8.html">23.&nbsp;&nbsp;Configuring the Kerberos Service (Tasks)</a></p>
<p class="toc level2"><a href="trouble-1.html">24.&nbsp;&nbsp;Kerberos Error Messages and Troubleshooting</a></p>
<p class="toc level2"><a href="aadmin-1.html">25.&nbsp;&nbsp;Administering Kerberos Principals and Policies (Tasks)</a></p>
<p class="toc level2"><a href="user-7.html">26.&nbsp;&nbsp;Using Kerberos Applications (Tasks)</a></p>
<p class="toc level2"><a href="refer-1.html">27.&nbsp;&nbsp;The Kerberos Service (Reference)</a></p>
<p class="toc level1 tocsp"><a href="audittm-1.html">Part&nbsp;VII&nbsp;Solaris Auditing</a></p>
<p class="toc level2"><a href="auditov-1.html">28.&nbsp;&nbsp;Solaris Auditing (Overview)</a></p>
<p class="toc level2"><a href="auditplan-1.html">29.&nbsp;&nbsp;Planning for Solaris Auditing</a></p>
<p class="toc level2"><a href="audittask-1.html">30.&nbsp;&nbsp;Managing Solaris Auditing (Tasks)</a></p>
<p class="toc level2"><a href="auditref-1.html">31.&nbsp;&nbsp;Solaris Auditing (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-2.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="auth-2"></a><h3>Overview of Secure RPC</h3>
<p><a name="indexterm-1839"></a><a name="indexterm-1840"></a><a name="indexterm-1841"></a><a name="indexterm-1842"></a><a name="indexterm-1843"></a><a name="indexterm-1844"></a><a name="indexterm-1845"></a>Secure RPC (Remote Procedure Call) protects remote procedures with an authentication mechanism. The Diffie-Hellman
authentication mechanism authenticates both the host and the user who is making a
request for a service. The authentication mechanism uses Data Encryption Standard (<a href="glossary-2.html#glossary-137">DES</a>) encryption. Applications
that use Secure RPC include NFS and the name services, NIS and NIS+.</p>

<a name="auth-3"></a><h4>NFS Services and Secure RPC</h4>
<p><a name="indexterm-1846"></a><a name="indexterm-1847"></a><a name="indexterm-1848"></a><a name="indexterm-1849"></a><a name="indexterm-1850"></a>NFS enables several hosts to share files over the network. Under the NFS
service, a server holds the data and resources for several clients. The clients
have access to the file systems that the server shares with the clients.
Users who are logged in to the client systems can access the
file systems by mounting the file systems from the server. To the user
on the client system, it appears as if the files are local to
the client. One of the most common uses of NFS allows systems to
be installed in offices, while storing all user files in a central location.
Some features of the NFS service, such as the <tt>-nosuid</tt> option to the
<tt>mount</tt> command, can be used to prohibit the opening of devices and file
systems by unauthorized users.</p><p><a name="indexterm-1851"></a>The NFS service uses Secure RPC to authenticate users who make requests over
the network. This process is known as <b>Secure NFS</b>. The Diffie-Hellman authentication mechanism, <tt>AUTH_DH</tt>, uses
DES encryption to ensure authorized access. The <tt>AUTH_DH</tt> mechanism has also been called
<tt>AUTH_DES</tt>. For more information, see the following:</p>
<ul><li><p>To set up and administer Secure NFS, see <a href="http://docs.sun.com/doc/819-1634/rfsadmin-96?a=view">Administering the Secure NFS System in <i>System Administration Guide: Network Services</i></a>.</p></li>
<li><p>To set up the NIS+ tables and enter names in the <tt>cred</tt> table, see <a href="http://docs.sun.com/doc/819-3195"><i>System Administration Guide: Naming and Directory Services (NIS+)</i></a>.</p></li>
<li><p>For an outline of the transactions that are involved in RPC authentication, see <a href="#auth-35">Implementation of Diffie-Hellman Authentication</a>.</p></li></ul>


<a name="auth-52"></a><h4>DES Encryption With Secure NFS</h4>
<a name="indexterm-1852"></a><a name="indexterm-1853"></a><a name="indexterm-1854"></a><p>The Data Encryption Standard (DES) encryption functions use a 56-bit key to encrypt
data. If two credential users or principals know the same DES key, they
can communicate in private by using the key to encipher and decipher text.
DES is a relatively fast encryption mechanism. A DES chip makes the encryption
even faster. However, if the chip is not present, a software implementation is
substituted.</p><p><a name="indexterm-1855"></a>The risk of using just the DES key is that an intruder
can collect enough cipher-text messages that were encrypted with the same key to
be able to discover the key and decipher the messages. For this reason,
security systems such as Secure NFS need to change the keys frequently.</p>

<a name="auth-17"></a><h4>Kerberos Authentication</h4>
<p><a name="indexterm-1856"></a><a name="indexterm-1857"></a>Kerberos is an authentication system that was developed at MIT. Some encryption in
Kerberos is based on DES. Kerberos V4 support is no longer supplied as
part of Secure RPC. However, a client-side and server-side implementation of Kerberos V5,
which uses RPCSEC_GSS, is included with this release. For more information, see <a href="intro-1.html">Chapter&nbsp;21, Introduction to the Kerberos Service</a>.</p>

<a name="auth-34"></a><h4>Diffie-Hellman Authentication and Secure RPC</h4>
<a name="indexterm-1858"></a><a name="indexterm-1859"></a><a name="indexterm-1860"></a><a name="indexterm-1861"></a><a name="indexterm-1862"></a><a name="indexterm-1863"></a><a name="indexterm-1864"></a><a name="indexterm-1865"></a><p>The Diffie-Hellman (DH) method of authenticating a user is nontrivial for an intruder
to crack. The client and the server have their own private key, which
they use with the public key to devise a common key. The
private key is also known as the <b>secret key</b>. The client and the server use
the common key to communicate with each other. The common key is encrypted
with an agreed-upon encryption function, such as DES.</p><p>Authentication is based on the ability of the sending system to use the
common key to encrypt the current time. Then, the receiving system can decrypt
and check against its current time. The time on the client and
the server must be synchronized. For more information, see <a href="http://docs.sun.com/doc/819-1634/time-20?a=view">Managing Network Time Protocol (Tasks) in <i>System Administration Guide: Network Services</i></a>.</p><p><a name="indexterm-1866"></a><a name="indexterm-1867"></a><a name="indexterm-1868"></a>The public keys and private keys are stored in an NIS or NIS+
database. NIS stores the keys in the <tt>publickey</tt> map. NIS+ stores the keys
in the <tt>cred</tt> table. These files contain the public key and the private
key for all potential users.</p><p><a name="indexterm-1869"></a><a name="indexterm-1870"></a>The system administrator is responsible for setting up NIS maps or NIS+ tables,
and for generating a public key and a private key for each user.
The private key is stored in encrypted form with the user's password. This
process makes the private key known only to the user.</p>

<a name="auth-35"></a><h5>Implementation of Diffie-Hellman Authentication</h5>
<a name="indexterm-1871"></a><a name="indexterm-1872"></a><a name="indexterm-1873"></a><a name="indexterm-1874"></a><a name="indexterm-1875"></a><a name="indexterm-1876"></a><a name="indexterm-1877"></a><a name="indexterm-1878"></a><a name="indexterm-1879"></a><a name="indexterm-1880"></a><p><a name="indexterm-1881"></a>This section describes the series of transactions in a client-server session that use
Diffie-Hellman authentication (<tt>AUTH_DH</tt>).</p>

<a name="auth-24"></a><h5>Generating the Public Keys and Secret Keys for Secure RPC</h5>
<p><a name="indexterm-1882"></a><a name="indexterm-1883"></a><a name="indexterm-1884"></a><a name="indexterm-1885"></a><a name="indexterm-1886"></a><a name="indexterm-1887"></a><a name="indexterm-1888"></a><a name="indexterm-1889"></a><a name="indexterm-1890"></a><a name="indexterm-1891"></a><a name="indexterm-1892"></a><a name="indexterm-1893"></a>Sometime prior to a transaction, the administrator runs either the <tt>newkey</tt> or the <tt>nisaddcred</tt>
command to generate a public key and a secret key. Each user has
a unique public key and secret key. The public key is stored in
a public database. The secret key is stored in encrypted form in
the same database. The <tt>chkey</tt> command changes the key pair.</p>

<a name="auth-19"></a><h5>Running the <tt>keylogin</tt> Command for Secure RPC</h5>
<a name="indexterm-1894"></a><a name="indexterm-1895"></a><a name="indexterm-1896"></a><p>Normally, the login password is identical to the Secure RPC password. In this
case, the <tt>keylogin</tt> command is not required. However, if the passwords are different,
the users have to log in and then run the <tt>keylogin</tt> command.</p><p><a name="indexterm-1897"></a><a name="indexterm-1898"></a><a name="indexterm-1899"></a>The <tt>keylogin</tt> command prompts the user for a Secure RPC password. The command
then uses the password to decrypt the secret key. The <tt>keylogin</tt> command then
passes the decrypted secret key to the <b>keyserver</b> program. The keyserver is an RPC
service with a local instance on every computer. The keyserver saves the decrypted
secret key and waits for the user to initiate a Secure RPC transaction
with a server.</p><p>If both the login password and the RPC password are the same,
the login process passes the secret key to the keyserver. If the passwords
are required to be different, then the user must always run the <tt>keylogin</tt>
command. When the <tt>keylogin</tt> command is included in the user's environment configuration file, such
as the <tt>~/.login</tt>, <tt>~/.cshrc</tt>, or <tt>~/.profile</tt> file, the <tt>keylogin</tt> command runs automatically whenever
the user logs in.</p>

<a name="auth-20"></a><h5>Generating the Conversation Key for Secure RPC</h5>
<p><a name="indexterm-1900"></a><a name="indexterm-1901"></a>When the user initiates a transaction with a server, the following occurs:</p>
<ol><li><p>The keyserver randomly generates a conversation key.</p></li>
<li><p>The kernel uses the conversation key, plus other material, to encrypt the client's timestamp.</p></li>
<li><p>The keyserver looks up the server's public key in the public key database. For more information, see the <a href="http://docs.sun.com/doc/819-2251/publickey-4?a=view"><tt>publickey</tt>(4)</a> man page.</p></li>
<li><p>The keyserver uses the client's secret key and the server's public key to create a common key.</p></li>
<li><p>The keyserver encrypts the conversation key with the common key.</p></li></ol>


<a name="auth-22"></a><h5>Initially Contacting the Server in Secure RPC</h5>
<p>The transmission, which includes the encrypted timestamp and the encrypted conversation key, is
then sent to the server. The transmission includes a credential and a verifier.
The credential contains three components:</p>
<ul><li><p>The client's network name</p></li>
<li><p>The conversation key, which is encrypted with the common key</p></li>
<li><p>A &ldquo;window,&rdquo; which is encrypted with the conversation key</p></li></ul>
<p><a name="indexterm-1902"></a>The window is the difference in time that the client says should be
allowed between the server's clock and the client's timestamp. If the difference between
the server's clock and the timestamp is greater than the window, the server
rejects the client's request. Under normal circumstances, this rejection does not happen, because
the client first synchronizes with the server before starting the RPC session.</p><p><a name="indexterm-1903"></a>The client's verifier contains the following:</p>
<ul><li><p>The encrypted timestamp</p></li>
<li><p>An encrypted verifier of the specified window, which is decremented by 1</p></li></ul>
<p><a name="indexterm-1904"></a><a name="indexterm-1905"></a>The window verifier is needed in case somebody wants to impersonate a user.
The impersonator can write a program that, instead of filling in the encrypted
fields of the credential and verifier, just inserts random bits. The server decrypts
the conversation key into some random key. The server then uses the key
to try to decrypt the window and the timestamp. The result is random
numbers. After a few thousand trials, however, the random window/timestamp pair is likely to
pass the authentication system. The window verifier lessens the chance that a fake
credential could be authenticated.</p>

<a name="auth-23"></a><h5>Decrypting the Conversation Key in Secure RPC</h5>
<a name="indexterm-1906"></a><a name="indexterm-1907"></a><p>When the server receives the transmission from the client, the following occurs:</p>
<ol><li><p>The keyserver that is local to the server looks up the client's public key in the public key database.</p></li>
<li><p><a name="indexterm-1908"></a><a name="indexterm-1909"></a>The keyserver uses the client's public key and the server's secret key to deduce the common key. The common key is the same common key that is computed by the client. Only the server and the client can calculate the common key because the calculation requires knowing one of the secret keys.</p></li>
<li><p>The kernel uses the common key to decrypt the conversation key.</p></li>
<li><p>The kernel calls the keyserver to decrypt the client's timestamp with the decrypted conversation key.</p></li></ol>


<a name="auth-33"></a><h5>Storing Information on the Server in Secure RPC</h5>
<p><a name="indexterm-1910"></a>After the server decrypts the client's timestamp, the server stores four items of
information in a credential table:</p>
<ul><li><p>The client's computer name </p></li>
<li><p>The conversation key </p></li>
<li><p>The window </p></li>
<li><p>The client's timestamp </p></li></ul>
<p><a name="indexterm-1911"></a>The server stores the first three items for future use. The server stores
the client's timestamp to protect against replays. The server accepts only timestamps that are
chronologically greater than the last timestamp seen. As a result, any replayed transactions
are guaranteed to be rejected.</p>
<hr><p><b>Note - </b><a name="indexterm-1912"></a>Implicit in these transactions is the name of the caller, who must be
authenticated in some manner. The keyserver cannot use DES authentication to authenticate the
caller because the use of DES by the keyserver would create a deadlock.
To avoid a deadlock, the keyserver stores the secret keys by user ID
(UID) and grants requests only to local <tt>root</tt> processes.</p>
<hr>


<a name="auth-25"></a><h5>Returning the Verifier to the Client in Secure RPC</h5>
<p><a name="indexterm-1913"></a>The server returns a verifier to the client, which includes the following:</p>
<ul><li><p>The index ID, which the server records in its credential cache</p></li>
<li><p>The client's timestamp minus 1, which is encrypted by the conversation key </p></li></ul>
<p>The reason for subtracting 1 from the client's timestamp is to ensure that
the timestamp is out of date. An out-of-date timestamp cannot be reused as
a client verifier.</p>

<a name="auth-26"></a><h5>Authenticating the Server in Secure RPC</h5>
<p>The client receives the verifier and authenticates the server. The client knows that
only the server could have sent the verifier because only the server knows
what timestamp the client sent.</p>

<a name="auth-27"></a><h5>Handling Transactions in Secure RPC</h5>
<p>With every transaction after the first transaction, the client returns the index ID
to the server in its next transaction. The client also sends another encrypted
timestamp. The server sends back the client's timestamp minus 1, which is encrypted
by the conversation key.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="auth-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="auth-11.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

