<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Using Solaris Secure Shell - System Administration Guide: Security Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Security Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="sshuser-14.html">Previous</a>
             </td>
             <td align="right">
                 <a href="sshref-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="oview-1.html">Part&nbsp;I&nbsp;Security Overview</a></p>
<p class="toc level2"><a href="secov-1.html">1.&nbsp;&nbsp;Security Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="sectm-1.html">Part&nbsp;II&nbsp;System, File, and Device Security</a></p>
<p class="toc level2"><a href="concept-1.html">2.&nbsp;&nbsp;Managing Machine Security (Overview)</a></p>
<p class="toc level2"><a href="secsys-1.html">3.&nbsp;&nbsp;Controlling Access to Systems (Tasks)</a></p>
<p class="toc level2"><a href="vscan-1.html">4.&nbsp;&nbsp;Virus Scanning Service (Tasks)</a></p>
<p class="toc level2"><a href="devtask-1.html">5.&nbsp;&nbsp;Controlling Access to Devices (Tasks)</a></p>
<p class="toc level2"><a href="bart-1.html">6.&nbsp;&nbsp;Using the Basic Audit Reporting Tool (Tasks)</a></p>
<p class="toc level2"><a href="secfile-1.html">7.&nbsp;&nbsp;Controlling Access to Files (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="prbactm-1.html">Part&nbsp;III&nbsp;Roles, Rights Profiles, and Privileges</a></p>
<p class="toc level2"><a href="prbac-1.html">8.&nbsp;&nbsp;Using Roles and Privileges (Overview)</a></p>
<p class="toc level2"><a href="rbactask-1.html">9.&nbsp;&nbsp;Using Role-Based Access Control (Tasks)</a></p>
<p class="toc level2"><a href="rbacref-1.html">10.&nbsp;&nbsp;Role-Based Access Control (Reference)</a></p>
<p class="toc level2"><a href="privtask-1.html">11.&nbsp;&nbsp;Privileges (Tasks)</a></p>
<p class="toc level2"><a href="privref-1.html">12.&nbsp;&nbsp;Privileges (Reference)</a></p>
<p class="toc level1 tocsp"><a href="scftm-1.html">Part&nbsp;IV&nbsp;Solaris Cryptographic Services</a></p>
<p class="toc level2"><a href="scf-1.html">13.&nbsp;&nbsp;Solaris Cryptographic Framework (Overview)</a></p>
<p class="toc level2"><a href="scftask-1.html">14.&nbsp;&nbsp;Solaris Cryptographic Framework (Tasks)</a></p>
<p class="toc level2"><a href="kmf-1.html">15.&nbsp;&nbsp;Solaris Key Management Framework</a></p>
<p class="toc level1 tocsp"><a href="authtm-1.html">Part&nbsp;V&nbsp;Authentication Services and Secure Communication</a></p>
<p class="toc level2"><a href="auth-1.html">16.&nbsp;&nbsp;Using Authentication Services (Tasks)</a></p>
<p class="toc level2"><a href="pam-1.html">17.&nbsp;&nbsp;Using PAM</a></p>
<p class="toc level2"><a href="sasl-1.html">18.&nbsp;&nbsp;Using SASL</a></p>
<p class="toc level2"><a href="sshuser-1.html">19.&nbsp;&nbsp;Using Solaris Secure Shell (Tasks)</a></p>
<p class="toc level3"><a href="sshuser-2.html">Solaris Secure Shell (Overview)</a></p>
<p class="toc level3"><a href="sshuser-6.html">Solaris Secure Shell Enhancements in the Solaris 10 Release</a></p>
<p class="toc level3"><a href="sshuser-20.html">Solaris Secure Shell (Task Map)</a></p>
<p class="toc level3"><a href="sshuser-24.html">Configuring Solaris Secure Shell (Task Map)</a></p>
<p class="toc level3"><a href="sshuser-8.html">Configuring Solaris Secure Shell</a></p>
<p class="toc level3"><a href="sshuser-14.html">Using Solaris Secure Shell (Task Map)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Using Solaris Secure Shell</a></p>
</div>
<p class="toc level2 tocsp"><a href="sshref-1.html">20.&nbsp;&nbsp;Solaris Secure Shell (Reference)</a></p>
<p class="toc level1 tocsp"><a href="seamtm-1.html">Part&nbsp;VI&nbsp;Kerberos Service</a></p>
<p class="toc level2"><a href="intro-1.html">21.&nbsp;&nbsp;Introduction to the Kerberos Service</a></p>
<p class="toc level2"><a href="seamplan-1.html">22.&nbsp;&nbsp;Planning for the Kerberos Service</a></p>
<p class="toc level2"><a href="setup-8.html">23.&nbsp;&nbsp;Configuring the Kerberos Service (Tasks)</a></p>
<p class="toc level2"><a href="trouble-1.html">24.&nbsp;&nbsp;Kerberos Error Messages and Troubleshooting</a></p>
<p class="toc level2"><a href="aadmin-1.html">25.&nbsp;&nbsp;Administering Kerberos Principals and Policies (Tasks)</a></p>
<p class="toc level2"><a href="user-7.html">26.&nbsp;&nbsp;Using Kerberos Applications (Tasks)</a></p>
<p class="toc level2"><a href="refer-1.html">27.&nbsp;&nbsp;The Kerberos Service (Reference)</a></p>
<p class="toc level1 tocsp"><a href="audittm-1.html">Part&nbsp;VII&nbsp;Solaris Auditing</a></p>
<p class="toc level2"><a href="auditov-1.html">28.&nbsp;&nbsp;Solaris Auditing (Overview)</a></p>
<p class="toc level2"><a href="auditplan-1.html">29.&nbsp;&nbsp;Planning for Solaris Auditing</a></p>
<p class="toc level2"><a href="audittask-1.html">30.&nbsp;&nbsp;Managing Solaris Auditing (Tasks)</a></p>
<p class="toc level2"><a href="auditref-1.html">31.&nbsp;&nbsp;Solaris Auditing (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-2.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="sshuser-15"></a><h3>Using Solaris Secure Shell</h3>
<p>Solaris Secure Shell provides secure access between a local shell and a
remote shell. For more information, see the <a href="http://docs.sun.com/doc/819-2251/ssh-config-4?a=view"><tt>ssh_config</tt>(4)</a> and <a href="http://docs.sun.com/doc/819-2239/ssh-1?a=view"><tt>ssh</tt>(1)</a> man pages.</p>

<a name="sshuser-33"></a><h4>How to Generate a Public/Private Key Pair for Use With Solaris Secure Shell</h4><a name="indexterm-2059"></a><a name="indexterm-2060"></a><a name="indexterm-2061"></a><a name="indexterm-2062"></a><a name="indexterm-2063"></a><a name="indexterm-2064"></a><a name="indexterm-2065"></a><a name="indexterm-2066"></a><a name="indexterm-2067"></a><a name="indexterm-2068"></a><p>Users must generate a public/private key pair when their site implements host-based authentication
or user public-key authentication. For additional options, see the <a href="http://docs.sun.com/doc/819-2239/ssh-keygen-1?a=view"><tt>ssh-keygen</tt>(1)</a> man page.</p><h6>Before You Begin</h6><p>Determine from your system administrator if host-based authentication is configured.</p><ol>
<li><b>Start the key generation program.</b><pre>myLocalHost% <tt><b>ssh-keygen -t rsa</b></tt>
Generating public/private rsa key pair.
&hellip;</pre><p>where <tt>-t</tt> is the type of algorithm, one of <tt>rsa</tt>, <tt>dsa</tt>, or
<tt>rsa1</tt>.</p></li>
<li><b>Specify the path to the file that will hold the key.</b><p>By default, the file name <tt>id_rsa</tt>, which represents an RSA v2 key, appears in
parentheses. You can select this file by pressing the Return key. Or,
you can type an alternative file name.</p><pre>Enter file in which to save the key (/home/jdoe/.ssh/id_rsa):&lt;Press Return&gt;</pre><p>The file name of the public key is created automatically by appending the
string <tt>.pub</tt> to the name of the private key file.</p></li>
<li><b>Type a passphrase for using your key.</b><p>This passphrase is used for encrypting your private key. A null entry is
<b>strongly discouraged</b>. Note that the passphrase is not displayed when you type it in.</p><pre>Enter passphrase (empty for no passphrase): &lt;Type passphrase&gt;</pre></li>
<li><b>Retype the passphrase to confirm it.</b><pre>Enter same passphrase again: &lt;Type passphrase&gt;
Your identification has been saved in /home/jdoe/.ssh/id_rsa.
Your public key has been saved in /home/jdoe/.ssh/id_rsa.pub.
The key fingerprint is:
0e:fb:3d:57:71:73:bf:58:b8:eb:f3:a3:aa:df:e0:d1 jdoe@myLocalHost</pre></li>
<li><b>Check the results.</b><p>Check that the path to the key file is correct.</p><pre>% <tt><b>ls ~/.ssh</b></tt>
id_rsa
id_rsa.pub</pre><p>At this point, you have created a public/private key pair.</p></li>
<li><b>Choose the appropriate option:</b><ul>
<li><a name="sshuser-hostkeycopy-1"></a><b>If your administrator has configured host-based authentication, you might need to copy the
local host's public key to the remote host.</b><p>You can now log in to the remote host. For details, see <a href="#sshuser-34">How to Log In to a Remote Host With Solaris Secure Shell</a>.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>Type the command on one line with no backslash.</b><pre>% <tt><b>cat /etc/ssh/ssh_host_dsa_key.pub | ssh</b></tt> <i>RemoteHost</i> <tt><b>\</b></tt>
<tt><b>'cat &gt;&gt; ~./ssh/known_hosts &amp;&amp; echo "Host key copied"'</b></tt></pre></li>
<li><b>When you are prompted, supply your login password.</b><pre>Enter password: &lt;Type password&gt;
Host key copied
%</pre></li></ol></li>
<li><b>If your site uses user authentication with public keys, populate your <tt>authorized_keys</tt> file
on the remote host.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Copy your public key to the remote host.</b><p>Type the command on one line with no backslash.</p><pre>myLocalHost% <tt><b>cat $HOME/.ssh/id_rsa.pub | ssh myRemoteHost \</b></tt>
<tt><b>'cat &gt;&gt; .ssh/authorized_keys &amp;&amp; echo "Key copied"'</b></tt></pre></li>
<li><b>When you are prompted, supply your login password.</b><p>When the file is copied, the message &ldquo;Key copied&rdquo; is displayed.</p><pre>Enter password: Type login password
Key copied
myLocalHost%</pre></li></ol></li></ul></li>
<li>(Optional) <b>Reduce the prompting for passphrases.</b><p>For a procedure, see <a href="#sshuser-35">How to Reduce Password Prompts in Solaris Secure Shell</a>. For more information, see the <a href="http://docs.sun.com/doc/819-2239/ssh-agent-1?a=view"><tt>ssh-agent</tt>(1)</a> and
<a href="http://docs.sun.com/doc/819-2239/ssh-add-1?a=view"><tt>ssh-add</tt>(1)</a> man pages.</p></li></ol><h6>Example&nbsp;19-2 Establishing a v1 RSA Key for a User</h6><p><a name="indexterm-2069"></a>In the following example, the user can contact hosts that run v1 of
the Solaris Secure Shell protocol. To be authenticated by v1 hosts, the user
creates a v1 key, then copies the public key portion to the remote
host.</p><pre>myLocalHost% <tt><b>ssh-keygen -t rsa1 -f /home/jdoe/.ssh/identity</b></tt>
Generating public/private rsa key pair.
&hellip;
Enter passphrase (empty for no passphrase): &lt;Type passphrase&gt;
Enter same passphrase again: &lt;Type passphrase&gt;
Your identification has been saved in /home/jdoe/.ssh/identity.
Your public key has been saved in /home/jdoe/.ssh/identity.pub.
The key fingerprint is:
&hellip;
myLocalHost% <tt><b>ls ~/.ssh</b></tt>
id_rsa
id_rsa.pub
identity
identity.pub
myLocalHost% <tt><b>cat $HOME/.ssh/identity.pub | ssh myRemoteHost \</b></tt>
<tt><b>'cat &gt;&gt; .ssh/authorized_keys &amp;&amp; echo "Key copied"'</b></tt></pre>

<a name="sshuser-10"></a><h4>How to Change the Passphrase for a Solaris Secure Shell Private Key</h4><a name="indexterm-2070"></a><a name="indexterm-2071"></a><a name="indexterm-2072"></a><a name="indexterm-2073"></a><p>The following procedure does not change the private key. The procedure changes the
authentication mechanism for the private key, the passphrase. For more information, see the
<a href="http://docs.sun.com/doc/819-2239/ssh-keygen-1?a=view"><tt>ssh-keygen</tt>(1)</a> man page.</p><ul>
<li><b>Change your passphrase.</b><p>Type the <tt>ssh-keygen</tt> command with the <tt>-p</tt> option, and answer the prompts.</p><pre>myLocalHost% <tt><b>ssh-keygen -p</b></tt>
Enter file which contains the private key (/home/jdoe/.ssh/id_rsa):&lt;Press Return&gt;
Enter passphrase (empty for no passphrase): &lt;Type passphrase&gt;
Enter same passphrase again:   &lt;Type passphrase&gt;</pre><p>where <tt>-p</tt> requests changing the passphrase of a private key file.</p></li></ul>

<a name="sshuser-34"></a><h4>How to Log In to a Remote Host With Solaris Secure Shell</h4><a name="indexterm-2074"></a><a name="indexterm-2075"></a><a name="indexterm-2076"></a><a name="indexterm-2077"></a><ol>
<li><b>Start a Solaris Secure Shell session.</b><p>Type the <tt>ssh</tt> command, and specify the name of the remote host.</p><pre>myLocalHost% <tt><b>ssh myRemoteHost</b></tt></pre><p>A prompt questions the authenticity of the remote host:</p><pre>The authenticity of host 'myRemoteHost' can't be established.
RSA key fingerprint in md5 is: 04:9f:bd:fc:3d:3e:d2:e7:49:fd:6e:18:4f:9c:26
Are you sure you want to continue connecting(yes/no)? </pre><p>This prompt is normal for initial connections to remote hosts.</p></li>
<li><b>If prompted, verify the authenticity of the remote host key.</b><ul>
<li><b>If you cannot confirm the authenticity of the remote host, type <tt><b>no</b></tt>
and contact your system administrator.</b><pre>Are you sure you want to continue connecting(yes/no)? <tt><b>no</b></tt></pre><p>The administrator is responsible for updating the global <tt>/etc/ssh/ssh_known_hosts</tt> file. An updated
<tt>ssh_known_hosts</tt> file prevents this prompt from appearing.</p></li>
<li><b>If you confirm the authenticity of the remote host, answer the prompt and
continue to the next step.</b><pre>Are you sure you want to continue connecting(yes/no)? <tt><b>yes</b></tt></pre></li></ul></li>
<li><b><a name="indexterm-2078"></a>Authenticate yourself to Solaris Secure Shell.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>When prompted, type your passphrase.</b><pre>Enter passphrase for key '/home/jdoe/.ssh/id_rsa': &lt;Type passphrase&gt;</pre></li>
<li><b>When prompted, type your account password.</b><pre>jdoe@myRemoteHost's password: &lt;Type password&gt;
Last login: Fri Jul 20 14:24:10 2001 from myLocalHost
myRemoteHost%</pre></li></ol></li>
<li><b><a name="indexterm-2079"></a>Conduct transactions on the remote host.</b><p>The commands that you send are encrypted. Any responses that you receive are
encrypted.</p></li>
<li><b>Close the Solaris Secure Shell connection.</b><p>When you are finished, type <tt><b>exit</b></tt> or use your usual method for exiting
your shell.</p><pre>myRemoteHost% <tt><b>exit</b></tt>
myRemoteHost% logout
Connection to myRemoteHost closed
myLocalHost%</pre></li></ol>

<a name="sshuser-35"></a><h4>How to Reduce Password Prompts in Solaris Secure Shell</h4><a name="indexterm-2080"></a><a name="indexterm-2081"></a><a name="indexterm-2082"></a><a name="indexterm-2083"></a><a name="indexterm-2084"></a><a name="indexterm-2085"></a><a name="indexterm-2086"></a><a name="indexterm-2087"></a><a name="indexterm-2088"></a><a name="indexterm-2089"></a><a name="indexterm-2090"></a><a name="indexterm-2091"></a><a name="indexterm-2092"></a><p>If you do not want to type your passphrase and your password
to use Solaris Secure Shell, you can use the agent daemon. Start the
daemon at the beginning of the session. Then, store your private keys with
the agent daemon by using the <tt>ssh-add</tt> command. If you have different
accounts on different hosts, add the keys that you need for the session.</p><p>You can start the agent daemon manually when needed, as described in the
following procedure. Or, you can set the agent daemon to run automatically at
the start of every session as described in <a href="#sshuser-36">How to Set Up the <tt>ssh-agent</tt> Command to Run Automatically in CDE</a>.</p><ol>
<li><b>Start the agent daemon.</b><pre>myLocalHost% <tt><b>ssh-agent</b></tt></pre></li>
<li><b>Verify that the agent daemon has been started.</b><pre>myLocalHost% <tt><b>eval `ssh-agent`</b></tt>
Agent pid 9892</pre></li>
<li><b>Add your private key to the agent daemon.</b><p>Type the <tt>ssh-add</tt> command.</p><pre>myLocalHost% <tt><b>ssh-add</b></tt>
Enter passphrase for /home/jdoe/.ssh/id_rsa: &lt;Type passphrase&gt;
Identity added: /home/jdoe/.ssh/id_rsa(/home/jdoe/.ssh/id_rsa)
myLocalHost%</pre></li>
<li><b>Start a Solaris Secure Shell session.</b><pre>myLocalHost% <tt><b>ssh myRemoteHost</b></tt></pre><p>You are not prompted for a passphrase.</p></li></ol><a name="sshuser-25"></a><h6>Example&nbsp;19-3 Using <tt>ssh-add</tt> Options</h6><a name="indexterm-2093"></a><p>In this example, <tt>jdoe</tt> adds two keys to the agent daemon. The <tt>-l</tt>
option is used to list all keys that are stored in the daemon.
At the end of the session, the <tt>-D</tt> option is used to remove
all the keys from the agent daemon.</p><pre>myLocalHost% <tt><b>ssh-agent</b></tt>
myLocalHost% <tt><b>ssh-add</b></tt>
Enter passphrase for /home/jdoe/.ssh/id_rsa: &lt;Type passphrase&gt;
Identity added: /home/jdoe/.ssh/id_rsa(/home/jdoe/.ssh/id_rsa)
myLocalHost% <tt><b>ssh-add /home/jdoe/.ssh/id_dsa</b></tt>
Enter passphrase for /home/jdoe/.ssh/id_dsa: &lt;Type passphrase&gt;
Identity added:
/home/jdoe/.ssh/id_dsa(/home/jdoe/.ssh/id_dsa)

myLocalHost% <tt><b>ssh-add -l</b></tt>
md5 1024 0e:fb:3d:53:71:77:bf:57:b8:eb:f7:a7:aa:df:e0:d1
/home/jdoe/.ssh/id_rsa(RSA)
md5 1024 c1:d3:21:5e:40:60:c5:73:d8:87:09:3a:fa:5f:32:53
/home/jdoe/.ssh/id_dsa(DSA)

User conducts Solaris Secure Shell transactions</pre><pre>myLocalHost% <tt><b>ssh-add -D</b></tt>
Identity removed:
/home/jdoe/.ssh/id_rsa(/home/jdoe/.ssh/id_rsa.pub)
/home/jdoe/.ssh/id_dsa(DSA)</pre>

<a name="sshuser-36"></a><h4>How to Set Up the <tt>ssh-agent</tt> Command to Run Automatically in CDE</h4><a name="indexterm-2094"></a><a name="indexterm-2095"></a><a name="indexterm-2096"></a><a name="indexterm-2097"></a><a name="indexterm-2098"></a><a name="indexterm-2099"></a><p>If you use CDE, you can avoid providing your passphrase and password whenever
you use Solaris Secure Shell by automatically starting an agent daemon, <tt>ssh-agent</tt>.
You can start the agent daemon from the <tt>.dtprofile</tt> script. To add your
passphrase and password to the agent daemon, see <a href="#sshuser-25">Example&nbsp;19-3</a>.</p>
<hr><p><b>Caution - </b>If you use the Sun Java<sup>TM</sup> Desktop System (Java DS), do not set
up the <tt>ssh-agent</tt> command to run automatically. Because the killing of the <tt>ssh-agent</tt>
process is controlled by a CDE interface, when you exit the Java DS,
the daemon continues to run. For example, if you start the daemon in
a CDE session, move to a Java DS session, and then log out,
the daemon continues to run.</p><p>A running daemon uses system resources. Although no known issues are associated with
leaving the <tt>ssh-agent</tt> daemon running, the daemon contains a password, which could create a
security risk.</p>
<hr>
<ol>
<li><b>Start the agent daemon automatically in a user startup script.</b><p>Add the following lines to the end of the <tt>$HOME/.dtprofile</tt> script:</p><pre>if [ "$SSH_AUTH_SOCK" = "" -a -x /usr/bin/ssh-agent ]; then
                eval `/usr/bin/ssh-agent`
fi</pre></li>
<li><b>Terminate the agent daemon when you exit the CDE session.</b><p>Add the following lines to the <tt>$HOME/.dt/sessions/sessionexit</tt> script:</p><pre>if [ "$SSH_AGENT_PID" != "" -a -x /usr/bin/ssh-agent ]; then
                /usr/bin/ssh-agent -k
fi</pre><p>This entry ensures that no one can use the Solaris Secure Shell
agent after a CDE session is terminated. Because the script uses a CDE-specific
interface, <tt>sessionexit</tt>, this procedure does not terminate the agent daemon in a
Sun Java Desktop System session.</p></li></ol>

<a name="sshuser-37"></a><h4>How to Use Port Forwarding in Solaris Secure Shell</h4><a name="indexterm-2100"></a><a name="indexterm-2101"></a><a name="indexterm-2102"></a><a name="indexterm-2103"></a><p>You can specify that a local port be forwarded to a remote
host. Effectively, a socket is allocated to listen to the port on the
local side. The connection from this port is made over a secure channel
to the remote host. For example, you might specify port <tt>143</tt> to obtain
email remotely with IMAP4. Similarly, a port can be specified on the remote
side.</p><h6>Before You Begin</h6><p>To use port forwarding, the administrator must have enabled port forwarding on the
remote Solaris Secure Shell server. For details, see <a href="sshuser-8.html#sshuser-30">How to Configure Port Forwarding in Solaris Secure Shell</a>.</p><ul>
<li><b>To use secure port forwarding, choose one of the following options:</b><ul>
<li><b>To set a local port to receive secure communication from a remote port,
specify both ports.</b><p>Specify the local port that listens for remote communication. Also, specify the remote
host and the remote port that forward the communication.</p><pre>myLocalHost% ssh -L <i>localPort:remoteHost:remotePort</i> </pre></li>
<li><b>To set a remote port to receive a secure connection from a
local port, specify both ports.</b><p>Specify the remote port that listens for remote communication. Also, specify the local
host and the local port that forward the communication.</p><pre>myLocalHost% ssh -R <i>remotePort:localhost:localPort</i></pre></li></ul></li></ul><a name="sshuser-27"></a><h6>Example&nbsp;19-4 Using Local Port Forwarding to Receive Mail</h6><a name="indexterm-2104"></a><a name="indexterm-2105"></a><a name="indexterm-2106"></a><a name="indexterm-2107"></a><p>The following example demonstrates how you can use local port forwarding to receive
mail securely from a remote server.</p><pre>myLocalHost% <tt><b>ssh -L 9143:myRemoteHost:143 myRemoteHost</b></tt> </pre><p>This command forwards connections from port <tt>9143</tt> on <tt>myLocalHost</tt> to port <tt>143</tt>.
Port <tt>143</tt> is the IMAP v2 server port on <tt>myRemoteHost</tt>. When the user launches
a mail application, the user needs to specify the local port number, as
shown in the following dialog box.</p><img src="figures/maillogin.gif" alt="Dialog box titled Mailer - Login. The IMAP Server field shows the server name followed by a colon and the port number." width="346" height="223"></img><p>Do not confuse <tt>localhost</tt> in the dialog box with <tt>myLocalHost</tt>. <tt>myLocalHost</tt> is
a hypothetical host name. <tt>localhost</tt> is a keyword that identifies your local system.</p><a name="sshuser-ex-2"></a><h6>Example&nbsp;19-5 Using Remote Port Forwarding to Communicate Outside of a Firewall</h6><a name="indexterm-2108"></a><a name="indexterm-2109"></a><a name="indexterm-2110"></a><p>This example demonstrates how a user in an enterprise environment can forward connections
from a host on an external network to a host inside a corporate
firewall.</p><pre>myLocalHost% <tt><b>ssh -R 9022:myLocalHost:22 myOutsideHost</b></tt></pre><p>This command forwards connections from port <tt>9022</tt> on <tt>myOutsideHost</tt> to port <tt>22</tt>,
the <tt>sshd</tt> server, on the local host.</p><pre>myOutsideHost% <tt><b>ssh -p 9022 localhost</b></tt>
myLocalHost%</pre>

<a name="sshuser-38"></a><h4>How to Copy Files With Solaris Secure Shell</h4><a name="indexterm-2111"></a><a name="indexterm-2112"></a><a name="indexterm-2113"></a><a name="indexterm-2114"></a><a name="indexterm-2115"></a><p>The following procedure shows how to use the <tt>scp</tt> command to copy encrypted
files between hosts. You can copy encrypted files either between a local host
and a remote host, or between two remote hosts. The command operates similarly
to the <tt>rcp</tt> command, except that the <tt>scp</tt> command prompts for authentication.
For more information, see the <a href="http://docs.sun.com/doc/819-2239/scp-1?a=view"><tt>scp</tt>(1)</a> man page.</p><p>You can also use the <tt>sftp</tt>, a more secure form of the <tt>ftp</tt>
command. For more information, see the <a href="http://docs.sun.com/doc/819-2239/sftp-1?a=view"><tt>sftp</tt>(1)</a> man page. For an example, see
<a href="#sshuser-11">Example&nbsp;19-6</a>.</p><ol>
<li><b>Start the secure copy program.</b><p>Specify the source file, the user name at the remote destination, and the
destination directory.</p><pre>myLocalHost% <tt><b>scp </tt><i>myfile.1 jdoe@myRemoteHost:~</i><tt></b></tt></pre></li>
<li><b>Supply your passphrase when prompted.</b><pre>Enter passphrase for key '/home/jdoe/.ssh/id_rsa': &lt;Type passphrase&gt;
myfile.1       25% |*******                      |    640 KB  0:20 ETA 
myfile.1 </pre><p>After you type the passphrase, a progress meter is displayed. See the second
line in the preceding output. The progress meter displays:</p>
<ul><li><p>The file name</p></li>
<li><p>The percentage of the file that has been transferred</p></li>
<li><p>A series of asterisks that indicate the percentage of the file that has been transferred</p></li>
<li><p>The quantity of data transferred</p></li>
<li><p>The estimated time of arrival, or ETA, of the complete file (that is, the remaining amount of time)</p></li></ul>
</li></ol><a name="sshuser-11"></a><h6>Example&nbsp;19-6 Specifying a Port When Using the <tt>sftp</tt> Command</h6><a name="indexterm-2116"></a><p>In this example, the user wants the <tt>sftp</tt> command to use a specific
port. The user uses the <tt>-o</tt> option to specify the port.</p><pre>% <tt><b>sftp -o port=2222 guest@RemoteFileServer</b></tt></pre>

<a name="sshuser-46"></a><h4>How to Set Up Default Connections to Hosts Outside a Firewall</h4><a name="indexterm-2117"></a><a name="indexterm-2118"></a><p><a name="indexterm-2119"></a><a name="indexterm-2120"></a><a name="indexterm-2121"></a><a name="indexterm-2122"></a>You can use Solaris Secure Shell to make a connection from a
host inside a firewall to a host outside the firewall. This task is
done by specifying a proxy command for <tt>ssh</tt> either in a configuration file
or as an option on the command line. For the command-line option, see
<a href="#sshuser-52">Example&nbsp;19-7</a>.</p><p>In general, you can customize your <tt>ssh</tt> interactions through a configuration file.</p>
<ul><li><p>You can customize either your own personal file in <tt>~/.ssh/config</tt>.</p></li>
<li><p>Or, you can use the settings in the administrative configuration file, <tt>/etc/ssh/ssh_config</tt>.</p></li></ul>
<p>The files can be customized with two types of proxy commands. One
proxy command is for HTTP connections. The other proxy command is for SOCKS5
connections. For more information, see the <a href="http://docs.sun.com/doc/819-2251/ssh-config-4?a=view"><tt>ssh_config</tt>(4)</a> man page.</p><ol>
<li><a name="sshuser-step-85"></a><b>Specify the proxy commands and hosts in a configuration file.</b><p>Use the following syntax to add as many lines as you need:</p><pre>[Host <i>outside-host</i>]
ProxyCommand <i>proxy-command</i> [<tt>-h</tt> <i>proxy-server</i>] \
[<tt>-p</tt> <i>proxy-port</i>] <i>outside-host</i>|%h <i>outside-port</i>|%p</pre><dl><dt><tt>Host</tt> <i>outside-host</i></dt>
<dd><p><a name="indexterm-2123"></a>Limits the proxy command specification to instances when a remote host name is specified on the command line. If you use a wildcard for <i>outside-host</i>, you apply the proxy command specification to a set of hosts.</p></dd>
<dt><i>proxy-command</i></dt>
<dd><p>Specifies the proxy command.</p><p>The command can be either of the following:</p>
<ul><li><p><tt>/usr/lib/ssh/ssh-http-proxy-connect</tt> for HTTP connections</p></li>
<li><p><tt>/usr/lib/ssh/ssh-socks5-proxy-connect</tt> for SOCKS5 connections</p></li></ul>
</dd>
<dt><tt>-h</tt> <i>proxy-server</i> and <tt>-p</tt> <i>proxy-port</i></dt>
<dd><p><a name="indexterm-2124"></a><a name="indexterm-2125"></a>These options specify a proxy server and a proxy port, respectively. If present, the proxies override any environment variables that specify proxy servers and proxy ports, such as <tt>HTTPPROXY</tt>, <tt>HTTPPROXYPORT</tt>, <tt>SOCKS5_PORT</tt>, <tt>SOCKS5_SERVER</tt>, and <tt>http_proxy</tt>. The <tt>http_proxy</tt> variable specifies a URL. If the options are not used, then the relevant environment variables must be set. For more information, see the <a href="http://docs.sun.com/doc/819-2239/ssh-socks5-proxy-connect-1?a=view"><tt>ssh-socks5-proxy-connect</tt>(1)</a> and <a href="http://docs.sun.com/doc/819-2239/ssh-http-proxy-connect-1?a=view"><tt>ssh-http-proxy-connect</tt>(1)</a> man pages.</p></dd>
<dt><i>outside-host</i></dt>
<dd><p>Designates a specific host to connect to. Use the <tt>%h</tt> substitution argument to specify the host on the command line.</p></dd>
<dt><i>outside-port</i></dt>
<dd><p>Designates a specific port to connect to. Use the <tt>%p</tt> substitution argument to specify the port on the command line. By specifying <tt>%h</tt> and <tt>%p</tt> without using the <tt>Host</tt> <i>outside-host</i> option, the proxy command is applied to the host argument whenever the <tt>ssh</tt> command is invoked.</p></dd>
</dl>
</li>
<li><b>Run Solaris Secure Shell, specifying the outside host.</b><p>For example, type the following:</p><pre>myLocalHost% <tt><b>ssh myOutsideHost</b></tt></pre><p>This command looks for a proxy command specification for <tt>myOutsideHost</tt> in your
personal configuration file. If the specification is not found, then the command looks
in the system-wide configuration file, <tt>/etc/ssh/ssh_config</tt>. The proxy command is substituted for
the <tt>ssh</tt> command.</p></li></ol><a name="sshuser-52"></a><h6>Example&nbsp;19-7 Connecting to Hosts Outside a Firewall From the Command Line</h6><a name="indexterm-2126"></a><a name="indexterm-2127"></a><a name="indexterm-2128"></a><a name="indexterm-2129"></a><p><a href="#sshuser-46">How to Set Up Default Connections to Hosts Outside a Firewall</a> explains how to specify a proxy command in a configuration file. In
this example, a proxy command is specified on the <tt>ssh</tt> command line.</p><pre>% <tt><b>ssh -o'Proxycommand=/usr/lib/ssh/ssh-http-proxy-connect \</b></tt>
<tt><b>-h myProxyServer -p 8080 myOutsideHost 22' myOutsideHost</b></tt></pre><p>The <tt>-o</tt> option to the <tt>ssh</tt> command provides a command-line method of specifying
a proxy command. This example command does the following:</p>
<ul><li><p>Substitutes the HTTP proxy command for <tt>ssh</tt></p></li>
<li><p>Uses port <tt>8080</tt> and <tt>myProxyServer</tt> as the proxy server</p></li>
<li><p>Connects to port <tt>22</tt> on <tt>myOutsideHost</tt></p></li></ul>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="sshuser-14.html">Previous</a>
             </td>
             <td align="right">
                 <a href="sshref-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

