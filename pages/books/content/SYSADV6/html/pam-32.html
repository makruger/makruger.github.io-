<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>PAM Configuration (Reference) - System Administration Guide: Security Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Security Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="pam-11.html">Previous</a>
             </td>
             <td align="right">
                 <a href="sasl-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="oview-1.html">Part&nbsp;I&nbsp;Security Overview</a></p>
<p class="toc level2"><a href="secov-1.html">1.&nbsp;&nbsp;Security Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="sectm-1.html">Part&nbsp;II&nbsp;System, File, and Device Security</a></p>
<p class="toc level2"><a href="concept-1.html">2.&nbsp;&nbsp;Managing Machine Security (Overview)</a></p>
<p class="toc level2"><a href="secsys-1.html">3.&nbsp;&nbsp;Controlling Access to Systems (Tasks)</a></p>
<p class="toc level2"><a href="vscan-1.html">4.&nbsp;&nbsp;Virus Scanning Service (Tasks)</a></p>
<p class="toc level2"><a href="devtask-1.html">5.&nbsp;&nbsp;Controlling Access to Devices (Tasks)</a></p>
<p class="toc level2"><a href="bart-1.html">6.&nbsp;&nbsp;Using the Basic Audit Reporting Tool (Tasks)</a></p>
<p class="toc level2"><a href="secfile-1.html">7.&nbsp;&nbsp;Controlling Access to Files (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="prbactm-1.html">Part&nbsp;III&nbsp;Roles, Rights Profiles, and Privileges</a></p>
<p class="toc level2"><a href="prbac-1.html">8.&nbsp;&nbsp;Using Roles and Privileges (Overview)</a></p>
<p class="toc level2"><a href="rbactask-1.html">9.&nbsp;&nbsp;Using Role-Based Access Control (Tasks)</a></p>
<p class="toc level2"><a href="rbacref-1.html">10.&nbsp;&nbsp;Role-Based Access Control (Reference)</a></p>
<p class="toc level2"><a href="privtask-1.html">11.&nbsp;&nbsp;Privileges (Tasks)</a></p>
<p class="toc level2"><a href="privref-1.html">12.&nbsp;&nbsp;Privileges (Reference)</a></p>
<p class="toc level1 tocsp"><a href="scftm-1.html">Part&nbsp;IV&nbsp;Solaris Cryptographic Services</a></p>
<p class="toc level2"><a href="scf-1.html">13.&nbsp;&nbsp;Solaris Cryptographic Framework (Overview)</a></p>
<p class="toc level2"><a href="scftask-1.html">14.&nbsp;&nbsp;Solaris Cryptographic Framework (Tasks)</a></p>
<p class="toc level2"><a href="kmf-1.html">15.&nbsp;&nbsp;Solaris Key Management Framework</a></p>
<p class="toc level1 tocsp"><a href="authtm-1.html">Part&nbsp;V&nbsp;Authentication Services and Secure Communication</a></p>
<p class="toc level2"><a href="auth-1.html">16.&nbsp;&nbsp;Using Authentication Services (Tasks)</a></p>
<p class="toc level2"><a href="pam-1.html">17.&nbsp;&nbsp;Using PAM</a></p>
<p class="toc level3"><a href="pam-2.html">PAM (Overview)</a></p>
<p class="toc level3"><a href="pam-11.html">PAM (Tasks)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">PAM Configuration (Reference)</a></p>
</div>
<p class="toc level2 tocsp"><a href="sasl-1.html">18.&nbsp;&nbsp;Using SASL</a></p>
<p class="toc level2"><a href="sshuser-1.html">19.&nbsp;&nbsp;Using Solaris Secure Shell (Tasks)</a></p>
<p class="toc level2"><a href="sshref-1.html">20.&nbsp;&nbsp;Solaris Secure Shell (Reference)</a></p>
<p class="toc level1 tocsp"><a href="seamtm-1.html">Part&nbsp;VI&nbsp;Kerberos Service</a></p>
<p class="toc level2"><a href="intro-1.html">21.&nbsp;&nbsp;Introduction to the Kerberos Service</a></p>
<p class="toc level2"><a href="seamplan-1.html">22.&nbsp;&nbsp;Planning for the Kerberos Service</a></p>
<p class="toc level2"><a href="setup-8.html">23.&nbsp;&nbsp;Configuring the Kerberos Service (Tasks)</a></p>
<p class="toc level2"><a href="trouble-1.html">24.&nbsp;&nbsp;Kerberos Error Messages and Troubleshooting</a></p>
<p class="toc level2"><a href="aadmin-1.html">25.&nbsp;&nbsp;Administering Kerberos Principals and Policies (Tasks)</a></p>
<p class="toc level2"><a href="user-7.html">26.&nbsp;&nbsp;Using Kerberos Applications (Tasks)</a></p>
<p class="toc level2"><a href="refer-1.html">27.&nbsp;&nbsp;The Kerberos Service (Reference)</a></p>
<p class="toc level1 tocsp"><a href="audittm-1.html">Part&nbsp;VII&nbsp;Solaris Auditing</a></p>
<p class="toc level2"><a href="auditov-1.html">28.&nbsp;&nbsp;Solaris Auditing (Overview)</a></p>
<p class="toc level2"><a href="auditplan-1.html">29.&nbsp;&nbsp;Planning for Solaris Auditing</a></p>
<p class="toc level2"><a href="audittask-1.html">30.&nbsp;&nbsp;Managing Solaris Auditing (Tasks)</a></p>
<p class="toc level2"><a href="auditref-1.html">31.&nbsp;&nbsp;Solaris Auditing (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-2.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="pam-32"></a><h3>PAM Configuration (Reference)</h3>
<p><a name="indexterm-1971"></a>The PAM configuration file, <a href="http://docs.sun.com/doc/819-2251/pam.conf-4?a=view"><tt>pam.conf</tt>(4)</a>, is used to configure PAM service modules for
system services, such as <tt>login</tt>, <tt>rlogin</tt>, <tt>su</tt>, and <tt>cron</tt>. The system administrator manages
this file. An incorrect order of entries in <tt>pam.conf</tt> can cause unforeseen
side effects. For example, a badly configured <tt>pam.conf</tt> can lock out users
so that  single-user mode becomes necessary for repair. For a description of
setting the order, see <a href="#pam-15">How PAM Stacking Works</a>.</p>

<a name="pam-33"></a><h4>PAM Configuration File Syntax</h4>
<p><a name="indexterm-1972"></a>The entries in the configuration file are in the format:</p><pre><i>service-name</i> <i>module-type</i> <i>control-flag</i> <i>module-path</i> <i>module-options</i></pre><dl><dt><i>service-name</i></dt>
<dd><p>Name of the service, for example, <tt>ftp</tt>, <tt>login</tt>, or <tt>passwd</tt>. An application can use different service names for the services that the application provides. For example, the Solaris secure shell daemon uses these service names: <tt>sshd-none</tt>, <tt>sshd-password</tt>, <tt>sshd-kbdint</tt>, <tt>sshd-pubkey</tt>, and <tt>sshd-hostbased</tt>. The service-name <b>other</b> is a predefined name that is used as a wildcard service-name. If a particular service-name is not found in the configuration file, the configuration for <b>other</b> is used.</p></dd>
<dt><i>module-type</i></dt>
<dd><p>The type of service, that is, <tt>auth</tt>, <tt>account</tt>, <tt>session</tt>, or <tt>password</tt>.</p></dd>
<dt><i>control-flag</i></dt>
<dd><p>Indicates the role of the module in determining the integrated success or failure value for the service. Valid control flags are <tt>binding</tt>, <tt>include</tt>, <tt>optional</tt>, <tt>required</tt>, <tt>requisite</tt>, and <tt>sufficient</tt>. See <a href="#pam-15">How PAM Stacking Works</a> for information on the use of these flags.</p></dd>
<dt><i>module-path</i></dt>
<dd><p>The path to the library object that implements the service. If the pathname is not absolute, the pathname is assumed to be relative to <tt>/usr/lib/security/$ISA/</tt>. Use the architecture-dependent macro $ISA to cause <tt>libpam</tt> to look in the directory for the particular architecture of the application.</p></dd>
<dt><i>module-options</i></dt>
<dd><p>Options that are passed to the service modules. A module's man page describes the options that are accepted by that module. Typical module options include <tt>nowarn</tt> and <tt>debug</tt>.</p></dd>
</dl>


<a name="pam-15"></a><h4>How PAM Stacking Works</h4>
<p><a name="indexterm-1973"></a>When an application calls on the following functions, <tt>libpam</tt> reads the configuration file <tt>/etc/pam.conf</tt>
to determine which modules participate in the operation for this service:</p>
<ul><li><p><a href="http://docs.sun.com/doc/819-2247/pam-authenticate-3pam?a=view"><tt>pam_authenticate</tt>(3PAM)</a></p></li>
<li><p><a href="http://docs.sun.com/doc/819-2247/pam-acct-mgmt-3pam?a=view"><tt>pam_acct_mgmt</tt>(3PAM)</a></p></li>
<li><p><a href="http://docs.sun.com/doc/819-2247/pam-setcred-3pam?a=view"><tt>pam_setcred</tt>(3PAM)</a></p></li>
<li><p><a href="http://docs.sun.com/doc/819-2247/pam-open-session-3pam?a=view"><tt>pam_open_session</tt>(3PAM)</a></p></li>
<li><p><a href="http://docs.sun.com/doc/819-2247/pam-close-session-3pam?a=view"><tt>pam_close_session</tt>(3PAM)</a></p></li>
<li><p><a href="http://docs.sun.com/doc/819-2247/pam-chauthtok-3pam?a=view"><tt>pam_chauthtok</tt>(3PAM)</a></p></li></ul>
<p>If <tt>/etc/pam.conf</tt> contains only one module for an operation for this service such
as authentication or account management, the result of that module determines the outcome
of the operation. For example, the default authentication operation for the <tt>passwd</tt> application contains
one module, <tt>pam_passwd_auth.so.1</tt>:</p><pre>passwd  auth required           pam_passwd_auth.so.1</pre><p>If, on the other hand, there are multiple modules defined for the
service's operation, those modules are said to be <b>stacked</b> and that a <b>PAM stack</b> exists
for that service. For example, consider the case where <tt>pam.conf</tt> contains the following
entries:</p><pre>login   auth requisite          pam_authtok_get.so.1
login   auth required           pam_dhkeys.so.1
login   auth required           pam_unix_cred.so.1
login   auth required           pam_unix_auth.so.1
login   auth required           pam_dial_auth.so.1</pre><p>These entries represent a sample <tt>auth</tt> stack for the <tt>login</tt> service. To
determine the outcome of this stack, the result codes of the individual modules
require an <b>integration process</b>. In the integration process, the modules are executed in order
as specified in <tt>/etc/pam.conf</tt>. Each success or failure code is integrated in the overall
result depending on the module's control flag. The control flag can cause early
termination of the stack. For example, a <tt>requisite</tt> module might fail, or a
<tt>sufficient</tt> or <tt>binding</tt> module might succeed. After the stack has been processed, the
individual results are combined into a single, overall result that is delivered to
the application.</p><p><a name="indexterm-1974"></a>The control flag indicates the role that a PAM module plays in determining
access to the service. The control flags and their effects are:</p>
<ul><li><p><a name="indexterm-1975"></a><b>Binding</b> &ndash; Success in meeting a binding module's requirements returns success immediately to the application if no previous required modules have failed. If these conditions are met, then no further execution of modules occurs. Failure causes a required failure to be recorded and the processing of modules to be continued.</p></li>
<li><p><a name="indexterm-1976"></a><b>Include</b> &ndash; Adds lines from a separate PAM configuration file to be used at this point in the PAM stack. This flag does not control success or failure behaviors. When a new file is read, the PAM include stack is incremented. When the stack check in the new file finishes, the include stack value is decremented. When the end of a file is reached and the PAM include stack is 0, then the stack processing ends. The maximum number for the PAM include stack is 32.</p></li>
<li><p><a name="indexterm-1977"></a><b>Optional</b> &ndash; Success in meeting an optional module's requirements is not necessary for using the service. Failure causes an optional failure to be recorded.</p></li>
<li><p><a name="indexterm-1978"></a><b>Required</b> &ndash; Success in meeting a required module's requirements is necessary for using the service. Failure results in an error return after the remaining modules for this service have been executed. Final success for the service is returned only if no binding or required modules have reported failures.</p></li>
<li><p><a name="indexterm-1979"></a><b>Requisite</b> &ndash; Success in meeting a requisite module's requirements is necessary for using the service. Failure results in an immediate error return with no further execution of modules. All requisite modules for a service must return success for the function to be able to return success to the application. </p></li>
<li><p><a name="indexterm-1980"></a><b>Sufficient</b> &ndash;  If no previous required failures have occurred, success in a sufficient module returns success to the application immediately with no further execution of modules. Failure causes an optional failure to be recorded.</p></li></ul>
<p><a name="indexterm-1981"></a>The following two diagrams shows how access is determined in the integration process.
The first diagram indicates how success or failure is recorded for each type
of control flag. The second diagram shows how the integrated value is determined.</p><a name="pam-fig-24"></a><h6>Figure&nbsp;17-2 PAM Stacking: Effect of Control Flags</h6><img src="figures/pam.run_stack1.gif" alt="Flow diagram shows how control flags affect PAM stacking."></img><a name="pam-fig-25"></a><h6>Figure&nbsp;17-3 PAM Stacking: How Integrated Value Is Determined</h6><img src="figures/pam.run_stack2.gif" alt="Flow diagram shows how integrated values are determined in PAM stacking."></img>

<a name="emqut"></a><h4>PAM Stacking Example</h4>
<p><a name="indexterm-1982"></a>Consider the following example of an <tt>rlogin</tt> service that requests authentication. </p><a name="pam-ex-18"></a><h6>Example&nbsp;17-1 Partial Contents of a Typical PAM Configuration File</h6><p>The <tt>pam.conf</tt> file in this example has the following contents for <tt>rlogin</tt> services:</p><pre>     # Authentication management
     ...     
     # rlogin service 
     rlogin  auth sufficient         pam_rhosts_auth.so.1
     rlogin  auth requisite          pam_authtok_get.so.1
     rlogin  auth required           pam_dhkeys.so.1
     rlogin  auth required           pam_unix_auth.so.1
     ...</pre><p>When the <tt>rlogin</tt> service requests authentication, <tt>libpam</tt> first executes the <a href="http://docs.sun.com/doc/819-2252/pam-rhosts-auth-5?a=view"><tt>pam_rhosts_auth</tt>(5)</a> module.
The control flag is set to <tt>sufficient</tt> for the <tt>pam_rhosts_auth</tt> module. If the <tt>pam_rhosts_auth</tt>
module is able to authenticate the user, then processing stops and success is
returned to the application.</p><p>If the <tt>pam_rhosts_auth</tt> module fails to authenticate the user, then the next PAM
module, <a href="http://docs.sun.com/doc/819-2252/pam-authtok-get-5?a=view"><tt>pam_authtok_get</tt>(5)</a> is executed. The control flag for this module is set to
<tt>requisite</tt>. If <tt>pam_authtok_get</tt> fails, then the authentication process ends and the failure
is returned to <tt>rlogin</tt>. </p><p>If <tt>pam_authtok_get</tt> succeeds, then the next two modules, <a href="http://docs.sun.com/doc/819-2252/pam-dhkeys-5?a=view"><tt>pam_dhkeys</tt>(5)</a> and <a href="http://docs.sun.com/doc/819-2252/pam-unix-auth-5?a=view"><tt>pam_unix_auth</tt>(5)</a>, are
executed. Both modules have the associated control flags that are set to <tt>required</tt>
so that the process continues regardless of whether an individual failure is returned. After
<tt>pam_unix_auth</tt> is executed, no modules for <tt>rlogin</tt> authentication remain. At this point,
if either <tt>pam_dhkeys</tt> or <tt>pam_unix_auth</tt> has returned a failure, the user is denied
access through <tt>rlogin</tt>.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="pam-11.html">Previous</a>
             </td>
             <td align="right">
                 <a href="sasl-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

