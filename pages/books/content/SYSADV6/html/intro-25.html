<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>How the Kerberos Service Works - System Administration Guide: Security Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Security Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="intro-5.html">Previous</a>
             </td>
             <td align="right">
                 <a href="intro-38.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="oview-1.html">Part&nbsp;I&nbsp;Security Overview</a></p>
<p class="toc level2"><a href="secov-1.html">1.&nbsp;&nbsp;Security Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="sectm-1.html">Part&nbsp;II&nbsp;System, File, and Device Security</a></p>
<p class="toc level2"><a href="concept-1.html">2.&nbsp;&nbsp;Managing Machine Security (Overview)</a></p>
<p class="toc level2"><a href="secsys-1.html">3.&nbsp;&nbsp;Controlling Access to Systems (Tasks)</a></p>
<p class="toc level2"><a href="vscan-1.html">4.&nbsp;&nbsp;Virus Scanning Service (Tasks)</a></p>
<p class="toc level2"><a href="devtask-1.html">5.&nbsp;&nbsp;Controlling Access to Devices (Tasks)</a></p>
<p class="toc level2"><a href="bart-1.html">6.&nbsp;&nbsp;Using the Basic Audit Reporting Tool (Tasks)</a></p>
<p class="toc level2"><a href="secfile-1.html">7.&nbsp;&nbsp;Controlling Access to Files (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="prbactm-1.html">Part&nbsp;III&nbsp;Roles, Rights Profiles, and Privileges</a></p>
<p class="toc level2"><a href="prbac-1.html">8.&nbsp;&nbsp;Using Roles and Privileges (Overview)</a></p>
<p class="toc level2"><a href="rbactask-1.html">9.&nbsp;&nbsp;Using Role-Based Access Control (Tasks)</a></p>
<p class="toc level2"><a href="rbacref-1.html">10.&nbsp;&nbsp;Role-Based Access Control (Reference)</a></p>
<p class="toc level2"><a href="privtask-1.html">11.&nbsp;&nbsp;Privileges (Tasks)</a></p>
<p class="toc level2"><a href="privref-1.html">12.&nbsp;&nbsp;Privileges (Reference)</a></p>
<p class="toc level1 tocsp"><a href="scftm-1.html">Part&nbsp;IV&nbsp;Solaris Cryptographic Services</a></p>
<p class="toc level2"><a href="scf-1.html">13.&nbsp;&nbsp;Solaris Cryptographic Framework (Overview)</a></p>
<p class="toc level2"><a href="scftask-1.html">14.&nbsp;&nbsp;Solaris Cryptographic Framework (Tasks)</a></p>
<p class="toc level2"><a href="kmf-1.html">15.&nbsp;&nbsp;Solaris Key Management Framework</a></p>
<p class="toc level1 tocsp"><a href="authtm-1.html">Part&nbsp;V&nbsp;Authentication Services and Secure Communication</a></p>
<p class="toc level2"><a href="auth-1.html">16.&nbsp;&nbsp;Using Authentication Services (Tasks)</a></p>
<p class="toc level2"><a href="pam-1.html">17.&nbsp;&nbsp;Using PAM</a></p>
<p class="toc level2"><a href="sasl-1.html">18.&nbsp;&nbsp;Using SASL</a></p>
<p class="toc level2"><a href="sshuser-1.html">19.&nbsp;&nbsp;Using Solaris Secure Shell (Tasks)</a></p>
<p class="toc level2"><a href="sshref-1.html">20.&nbsp;&nbsp;Solaris Secure Shell (Reference)</a></p>
<p class="toc level1 tocsp"><a href="seamtm-1.html">Part&nbsp;VI&nbsp;Kerberos Service</a></p>
<p class="toc level2"><a href="intro-1.html">21.&nbsp;&nbsp;Introduction to the Kerberos Service</a></p>
<p class="toc level3"><a href="intro-5.html">What Is the Kerberos Service?</a></p>
<div class="onpage">
<p class="toc level3"><a href="">How the Kerberos Service Works</a></p>
</div>
<p class="toc level3"><a href="intro-38.html">Kerberos Security Services</a></p>
<p class="toc level3"><a href="intro-27.html">The Components of Various Kerberos Releases</a></p>
<p class="toc level2 tocsp"><a href="seamplan-1.html">22.&nbsp;&nbsp;Planning for the Kerberos Service</a></p>
<p class="toc level2"><a href="setup-8.html">23.&nbsp;&nbsp;Configuring the Kerberos Service (Tasks)</a></p>
<p class="toc level2"><a href="trouble-1.html">24.&nbsp;&nbsp;Kerberos Error Messages and Troubleshooting</a></p>
<p class="toc level2"><a href="aadmin-1.html">25.&nbsp;&nbsp;Administering Kerberos Principals and Policies (Tasks)</a></p>
<p class="toc level2"><a href="user-7.html">26.&nbsp;&nbsp;Using Kerberos Applications (Tasks)</a></p>
<p class="toc level2"><a href="refer-1.html">27.&nbsp;&nbsp;The Kerberos Service (Reference)</a></p>
<p class="toc level1 tocsp"><a href="audittm-1.html">Part&nbsp;VII&nbsp;Solaris Auditing</a></p>
<p class="toc level2"><a href="auditov-1.html">28.&nbsp;&nbsp;Solaris Auditing (Overview)</a></p>
<p class="toc level2"><a href="auditplan-1.html">29.&nbsp;&nbsp;Planning for Solaris Auditing</a></p>
<p class="toc level2"><a href="audittask-1.html">30.&nbsp;&nbsp;Managing Solaris Auditing (Tasks)</a></p>
<p class="toc level2"><a href="auditref-1.html">31.&nbsp;&nbsp;Solaris Auditing (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-2.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="intro-25"></a><h3>How the Kerberos Service Works</h3>
<a name="indexterm-2381"></a><p>The following is an overview of the Kerberos authentication system. For a more
detailed description, see <a href="refer-14.html">How the Kerberos Authentication System Works</a>.</p><p>From the user's standpoint, the Kerberos service is mostly invisible after the Kerberos
session has been started. Commands such as <tt>rsh</tt> or <tt>ftp</tt> work about
the same. Initializing a Kerberos session often involves no more than logging in
and providing a Kerberos password.</p><p><a name="indexterm-2382"></a><a name="indexterm-2383"></a><a name="indexterm-2384"></a>The Kerberos system revolves around the concept of a <b>ticket</b>. A ticket is
a set of electronic information that identifies a user or a service such
as the NFS service. Just as your driver's license identifies you and indicates
what driving privileges you have, so a ticket identifies you and your network
access privileges. When you perform a Kerberos-based transaction (for example, if you remote
log in to another machine), you transparently send a request for a ticket
to a <b>Key Distribution Center</b>, or KDC. The KDC accesses a database to authenticate your
identity and returns a ticket that grants you permission to access the other
machine. &ldquo;Transparently&rdquo; means that you do not need to explicitly request a ticket.
The request happens as part of the <tt>rlogin</tt> command. Because only an
authenticated client can get a ticket for a specific service, another client cannot
use <tt>rlogin</tt> under an assumed identity.</p><p><a name="indexterm-2385"></a><a name="indexterm-2386"></a><a name="indexterm-2387"></a><a name="indexterm-2388"></a>Tickets have certain attributes associated with them. For example, a ticket can be
<b>forwardable</b>, which means that it can be used on another machine without a
new authentication process. A ticket can also be <b>postdated</b>, which means that it
is not valid until a specified time. How tickets can be used, for
example, to specify which users are allowed to obtain which types of ticket,
is set by <b>policies</b>. Policies are determined when the Kerberos service is installed
or administered.</p>
<hr><p><b>Note - </b><a name="indexterm-2389"></a><a name="indexterm-2390"></a>You will frequently see the terms <b>credential</b> and <b>ticket</b>. In the greater
Kerberos world, they are often used interchangeably. Technically, however, a credential is a
ticket plus the <b>session key</b> for that session. This difference is explained in
more detail in <a href="refer-15.html">Gaining Access to a Service Using Kerberos</a>.</p>
<hr>
<p>The following sections further explain the Kerberos authentication process.</p>

<a name="intro-55"></a><h4>Initial Authentication: the Ticket-Granting Ticket</h4>
<a name="indexterm-2391"></a><a name="indexterm-2392"></a><p>Kerberos authentication has two phases: an initial authentication that allows for all subsequent
authentications, and the subsequent authentications themselves.</p><p>The following figure shows how the initial authentication takes place.</p><a name="intro-fig-39"></a><h6>Figure&nbsp;21-1 Initial Authentication for a Kerberos Session</h6><img src="figures/SimpKerbExch1.gif" alt="Flow diagram shows a client requesting a TGT from the KDC, and then decrypting the TGT that the KDC returns to the client."></img>
<ol><li><p>A client (a user, or a service such as NFS) begins a Kerberos session by requesting a <b>ticket-granting ticket</b> (TGT) from the Key Distribution Center (KDC). This request is often done automatically at login. </p><p>A ticket-granting ticket is needed to obtain other tickets for specific services. Think of the ticket-granting ticket as similar to a passport. Like a passport, the ticket-granting ticket identifies you and allows you to obtain numerous &ldquo;visas,&rdquo; where the &ldquo;visas&rdquo; (tickets) are not for foreign countries but for remote machines or network services. Like passports and visas, the ticket-granting ticket and the other various tickets have limited lifetimes. The difference is that &ldquo;Kerberized&rdquo; commands notice that you have a passport and obtain the visas for you. You don't have to perform the transactions yourself. </p><p>Another analogy for the ticket-granting ticket is that of a three-day ski pass that is good at four different ski resorts. You show the pass at whichever resort you decide to go to and you receive a lift ticket for that resort, as long as the pass has not expired. Once you have the lift ticket, you can ski all you want at that resort. If you go to another resort the next day, you once again show your pass, and you get an additional lift ticket for the new resort. The difference is that the Kerberos-based commands notice that you have the weekend ski pass, and they get the lift ticket for you. So you don't have to perform the transactions yourself.</p></li>
<li><p>The KDC creates a ticket&ndash;granting ticket and sends it back, in encrypted form, to the client. The client decrypts the ticket-granting ticket by using the client's password. </p></li>
<li><p>Now in possession of a valid ticket-granting ticket, the client can request tickets for all sorts of network operations, such as <tt>rlogin</tt> or <tt>telnet</tt>, for as long as the ticket-granting ticket lasts. This ticket usually lasts for a few hours. Each time the client performs a unique network operation, it requests a ticket for that operation from the KDC. </p></li></ol>


<a name="intro-54"></a><h4>Subsequent Kerberos Authentications</h4>
<p>After the client has received the initial authentication, each subsequent authentication follows the
pattern that is shown in the following figure.</p><a name="intro-fig-41"></a><h6>Figure&nbsp;21-2 Obtaining Access to a Service Using Kerberos Authentication</h6><img src="figures/SimpKerbExch2.gif" alt="Flow diagram shows the client using a TGT to request a ticket from the KDC, and then using the returned ticket for access to the server."></img>
<ol><li><p>The client requests a ticket for a particular service, for example, to remote log in to another machine, from the KDC by sending the KDC its ticket-granting ticket as proof of identity.</p></li>
<li><p>The KDC sends the ticket for the specific service to the client.</p><p>For example, suppose user <tt>joe</tt> wants to access an NFS file system that has been shared with <tt>krb5</tt> authentication required. Because he is already authenticated (that is, he already has a ticket-granting ticket), as he attempts to access the files, the NFS client system automatically and transparently obtains a ticket from the KDC for the NFS service.</p><p>For example, suppose the user <tt>joe</tt> uses <tt>rlogin</tt> on the server <tt>boston</tt>. Because he is already authenticated, that is, he already has a ticket-granting ticket, he automatically and transparently obtains a ticket as part of the <tt>rlogin</tt> command. This ticket allows him to remote log in to <tt>boston</tt> as often as he wants until the ticket expires. If <tt>joe</tt> wants to remote log in to the machine <tt>denver</tt>, he obtains another ticket, as in Step 1.</p></li>
<li><p>The client sends the ticket to the server.</p><p>When using the NFS service, the NFS client automatically and transparently sends the ticket for the NFS service to the NFS server.</p></li>
<li><p>The server allows the client access.</p></li></ol>
<p>These steps make it appear that the server doesn't ever communicate with the
KDC. The server does, though; it registers itself with the KDC, just as
the first client does. For simplicity's sake, that part has been left
out.</p>

<a name="intro-53"></a><h4>The Kerberos Remote Applications</h4>
<a name="indexterm-2393"></a><p>The Kerberos-based (or &ldquo;Kerberized&rdquo;) commands that a user such as <tt>joe</tt> can use
are the following:</p>
<ul><li><p><tt>ftp</tt></p></li>
<li><p><tt>rcp</tt></p></li>
<li><p><tt>rdist</tt></p></li>
<li><p><tt>rlogin</tt></p></li>
<li><p><tt>rsh</tt></p></li>
<li><p><tt>ssh</tt></p></li>
<li><p><tt>telnet</tt></p></li></ul>
<p>These applications are the same as the Solaris applications of the same name.
However, they have been extended to use Kerberos principals to authenticate transactions, thereby
providing Kerberos-based security. See <a href="#intro-26">Kerberos Principals</a> for information on principals.</p><p>These commands are discussed further in <a href="userseamsapp1.html">Kerberos User Commands</a>.</p>

<a name="intro-26"></a><h4>Kerberos Principals</h4>
<a name="indexterm-2394"></a><a name="indexterm-2395"></a><a name="indexterm-2396"></a><a name="indexterm-2397"></a><a name="indexterm-2398"></a><p>A client in the Kerberos service is identified by its <b>principal</b>. A principal
is a unique identity to which the KDC can assign tickets. A
principal can be a user, such as <tt>joe</tt>, or a service, such as
<tt>nfs</tt> or <tt>telnet</tt>.</p><p>By convention, a principal name is divided into three components: the <b>primary</b>,
the <b>instance</b>, and the <b>realm</b>. A typical Kerberos principal would be, for example,
<tt>joe/admin@ENG.EXAMPLE.COM</tt>. In this example:</p>
<ul><li><p><tt>joe</tt> is the primary. The primary can be a user name, as shown here, or a service, such as <tt>nfs</tt>. The primary can also be the word <tt>host</tt>, which signifies that this principal is a service principal that is set up to provide various network services, <tt>ftp</tt>, <tt>rcp</tt>, <tt>rlogin</tt>, and so on.</p></li>
<li><p><a name="indexterm-2399"></a><a name="indexterm-2400"></a><a name="indexterm-2401"></a><a name="indexterm-2402"></a><tt>admin</tt> is the instance. An instance is optional in the case of user principals, but it is required for service principals. For example, if the user <tt>joe</tt> sometimes acts as a system administrator, he can use <tt>joe/admin</tt> to distinguish himself from his usual user identity. Likewise, if <tt>joe</tt> has accounts on two different hosts, he can use two principal names with different instances, for example, <tt>joe/denver.example.com</tt> and <tt>joe/boston.example.com</tt>. Notice that the Kerberos service treats <tt>joe</tt> and <tt>joe/admin</tt> as two completely different principals.</p><p>In the case of a service principal, the instance is the fully qualified host name. <tt>bigmachine.eng.example.com</tt> is an example of such an instance. The primary/instance for this example might be <tt>ftp/bigmachine.eng.example.com</tt> or <tt>host/bigmachine.eng.example.com</tt>.</p></li>
<li><p><tt>ENG.EXAMPLE.COM</tt> is the Kerberos realm. Realms are discussed in <a href="#intro-56">Kerberos Realms</a>.</p></li></ul>
<p>The following are all valid principal names:</p>
<ul><li><p><tt>joe</tt></p></li>
<li><p><tt>joe/admin</tt></p></li>
<li><p><tt>joe/admin@ENG.EXAMPLE.COM</tt></p></li>
<li><p><tt>nfs/host.eng.example.com@ENG.EXAMPLE.COM</tt></p></li>
<li><p><tt>host/eng.example.com@ENG.EXAMPLE.COM</tt></p></li></ul>


<a name="intro-56"></a><h4>Kerberos Realms</h4>
<a name="indexterm-2403"></a><a name="indexterm-2404"></a><a name="indexterm-2405"></a><p>A <b>realm</b> is a logical network, similar to a domain, that defines a
group of systems under the same <b>master KDC</b>. <a href="#intro-fig-43">Figure&nbsp;21-3</a> shows how realms can relate
to one another. Some realms are hierarchical, where one realm is a superset
of the other realm. Otherwise, the realms are nonhierarchical (or &ldquo;direct&rdquo;) and the
mapping between the two realms must be defined. A feature of the
Kerberos service is that it permits authentication across realms. Each realm only needs to
have a principal entry for the other realm in its KDC. This
Kerberos feature is called <b>cross-realm authentication</b>.</p><a name="intro-fig-43"></a><h6>Figure&nbsp;21-3 Kerberos Realms</h6><img src="figures/Realms1.gif" alt="Diagram shows the ENG.EXAMPLE.COM realm in a non-hierarchical relationship with SEAMCO.COM, and in a hierarchical relationship with EXAMPLE.COM."></img>

<a name="intro-57"></a><h4>Kerberos Servers</h4>
<a name="indexterm-2406"></a><a name="indexterm-2407"></a><a name="indexterm-2408"></a><a name="indexterm-2409"></a><a name="indexterm-2410"></a><p>Each realm must include a server that maintains the master copy of
the principal database. This server is called the <b>master KDC server</b>. Additionally, each realm should contain
at least one <b>slave KDC server</b>, which contains duplicate copies of the principal database. Both
the master KDC server and the slave KDC server create tickets that are
used to establish authentication. </p><p>The realm can also include  a Kerberos <b>application server</b>. This server  provides
access to Kerberized services (such as <tt>ftp</tt>, <tt>telnet</tt>, <tt>rsh</tt> and NFS). 
If you have installed SEAM 1.0 or 1.0.1, the realm might include a
Kerberos network application server, but this software was not included with these releases.</p><p><a name="indexterm-2411"></a>The following figure shows what a hypothetical realm might contain.</p><a name="intro-fig-45"></a><h6>Figure&nbsp;21-4 A Typical Kerberos Realm</h6><img src="figures/Realms2.gif" alt="Diagram shows a typical Kerberos realm, EXAMPLE.COM, which contains a master KDC, three clients, two slave KDCs, and two application servers."></img>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="intro-5.html">Previous</a>
             </td>
             <td align="right">
                 <a href="intro-38.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

