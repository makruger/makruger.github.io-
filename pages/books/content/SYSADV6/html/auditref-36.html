<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Audit Commands - System Administration Guide: Security Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Security Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="auditref-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="auditref-13.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="oview-1.html">Part&nbsp;I&nbsp;Security Overview</a></p>
<p class="toc level2"><a href="secov-1.html">1.&nbsp;&nbsp;Security Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="sectm-1.html">Part&nbsp;II&nbsp;System, File, and Device Security</a></p>
<p class="toc level2"><a href="concept-1.html">2.&nbsp;&nbsp;Managing Machine Security (Overview)</a></p>
<p class="toc level2"><a href="secsys-1.html">3.&nbsp;&nbsp;Controlling Access to Systems (Tasks)</a></p>
<p class="toc level2"><a href="vscan-1.html">4.&nbsp;&nbsp;Virus Scanning Service (Tasks)</a></p>
<p class="toc level2"><a href="devtask-1.html">5.&nbsp;&nbsp;Controlling Access to Devices (Tasks)</a></p>
<p class="toc level2"><a href="bart-1.html">6.&nbsp;&nbsp;Using the Basic Audit Reporting Tool (Tasks)</a></p>
<p class="toc level2"><a href="secfile-1.html">7.&nbsp;&nbsp;Controlling Access to Files (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="prbactm-1.html">Part&nbsp;III&nbsp;Roles, Rights Profiles, and Privileges</a></p>
<p class="toc level2"><a href="prbac-1.html">8.&nbsp;&nbsp;Using Roles and Privileges (Overview)</a></p>
<p class="toc level2"><a href="rbactask-1.html">9.&nbsp;&nbsp;Using Role-Based Access Control (Tasks)</a></p>
<p class="toc level2"><a href="rbacref-1.html">10.&nbsp;&nbsp;Role-Based Access Control (Reference)</a></p>
<p class="toc level2"><a href="privtask-1.html">11.&nbsp;&nbsp;Privileges (Tasks)</a></p>
<p class="toc level2"><a href="privref-1.html">12.&nbsp;&nbsp;Privileges (Reference)</a></p>
<p class="toc level1 tocsp"><a href="scftm-1.html">Part&nbsp;IV&nbsp;Solaris Cryptographic Services</a></p>
<p class="toc level2"><a href="scf-1.html">13.&nbsp;&nbsp;Solaris Cryptographic Framework (Overview)</a></p>
<p class="toc level2"><a href="scftask-1.html">14.&nbsp;&nbsp;Solaris Cryptographic Framework (Tasks)</a></p>
<p class="toc level2"><a href="kmf-1.html">15.&nbsp;&nbsp;Solaris Key Management Framework</a></p>
<p class="toc level1 tocsp"><a href="authtm-1.html">Part&nbsp;V&nbsp;Authentication Services and Secure Communication</a></p>
<p class="toc level2"><a href="auth-1.html">16.&nbsp;&nbsp;Using Authentication Services (Tasks)</a></p>
<p class="toc level2"><a href="pam-1.html">17.&nbsp;&nbsp;Using PAM</a></p>
<p class="toc level2"><a href="sasl-1.html">18.&nbsp;&nbsp;Using SASL</a></p>
<p class="toc level2"><a href="sshuser-1.html">19.&nbsp;&nbsp;Using Solaris Secure Shell (Tasks)</a></p>
<p class="toc level2"><a href="sshref-1.html">20.&nbsp;&nbsp;Solaris Secure Shell (Reference)</a></p>
<p class="toc level1 tocsp"><a href="seamtm-1.html">Part&nbsp;VI&nbsp;Kerberos Service</a></p>
<p class="toc level2"><a href="intro-1.html">21.&nbsp;&nbsp;Introduction to the Kerberos Service</a></p>
<p class="toc level2"><a href="seamplan-1.html">22.&nbsp;&nbsp;Planning for the Kerberos Service</a></p>
<p class="toc level2"><a href="setup-8.html">23.&nbsp;&nbsp;Configuring the Kerberos Service (Tasks)</a></p>
<p class="toc level2"><a href="trouble-1.html">24.&nbsp;&nbsp;Kerberos Error Messages and Troubleshooting</a></p>
<p class="toc level2"><a href="aadmin-1.html">25.&nbsp;&nbsp;Administering Kerberos Principals and Policies (Tasks)</a></p>
<p class="toc level2"><a href="user-7.html">26.&nbsp;&nbsp;Using Kerberos Applications (Tasks)</a></p>
<p class="toc level2"><a href="refer-1.html">27.&nbsp;&nbsp;The Kerberos Service (Reference)</a></p>
<p class="toc level1 tocsp"><a href="audittm-1.html">Part&nbsp;VII&nbsp;Solaris Auditing</a></p>
<p class="toc level2"><a href="auditov-1.html">28.&nbsp;&nbsp;Solaris Auditing (Overview)</a></p>
<p class="toc level2"><a href="auditplan-1.html">29.&nbsp;&nbsp;Planning for Solaris Auditing</a></p>
<p class="toc level2"><a href="audittask-1.html">30.&nbsp;&nbsp;Managing Solaris Auditing (Tasks)</a></p>
<p class="toc level2"><a href="auditref-1.html">31.&nbsp;&nbsp;Solaris Auditing (Reference)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Audit Commands</a></p>
</div>
<p class="toc level3"><a href="auditref-13.html">Files Used in the Auditing Service</a></p>
<p class="toc level3"><a href="auditref-22.html">Rights Profiles for Administering Auditing</a></p>
<p class="toc level3"><a href="auditref-28.html">Auditing and Solaris Zones</a></p>
<p class="toc level3"><a href="auditref-48.html">Audit Classes</a></p>
<p class="toc level3"><a href="auditref-74.html">Audit Policy</a></p>
<p class="toc level3"><a href="auditref-55.html">Process Audit Characteristics</a></p>
<p class="toc level3"><a href="auditref-75.html">Audit Trail</a></p>
<p class="toc level3"><a href="auditref-77.html">Conventions for Binary Audit File Names</a></p>
<p class="toc level3"><a href="auditref-20.html">Audit Record Structure</a></p>
<p class="toc level3"><a href="aparecord-11.html">Audit Token Formats</a></p>
<p class="toc level1 tocsp"><a href="glossary-2.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="auditref-36"></a><h3>Audit Commands</h3>
<a name="indexterm-3417"></a><p>This section provides information about the following commands:</p>
<ul><li><p><a href="#auditref-14"><tt>auditd</tt> Daemon</a></p></li>
<li><p><a href="#auditref-3"><tt>audit</tt> Command</a></p></li>
<li><p><a href="#auditref-56"><tt>bsmrecord</tt> Command</a></p></li>
<li><p><a href="#auditref-11"><tt>auditreduce</tt> Command</a></p></li>
<li><p><a href="#auditref-76"><tt>praudit</tt> Command</a></p></li>
<li><p><a href="#auditref-18"><tt>auditconfig</tt> Command</a></p></li></ul>


<a name="auditref-14"></a><h4><tt>auditd</tt> Daemon</h4>
<a name="indexterm-3418"></a><a name="indexterm-3419"></a><a name="indexterm-3420"></a><a name="indexterm-3421"></a><p>The following list summarizes what the <tt>auditd</tt> daemon does.</p>
<ul><li><p>The <tt>auditd</tt> daemon opens and closes audit files in the directories that are specified in the <tt>audit_control</tt> file. The files are opened in order.</p></li>
<li><p>The <tt>auditd</tt> daemon loads one or more plugins. Sun provides two plugins. The <tt>/lib/security/audit_binfile.so.1</tt> plugin writes binary audit data to a file. The <tt>/lib/security audit_syslog.so.1</tt> plugin sends text summaries of audit records to the <tt>syslogd</tt> daemon.</p></li>
<li><p>The <tt>auditd</tt> daemon reads audit data from the kernel and outputs the data by using an <tt>auditd</tt> plugin.</p></li>
<li><p><a name="indexterm-3422"></a><a name="indexterm-3423"></a><a name="indexterm-3424"></a>The <tt>auditd</tt> daemon executes the <tt>audit_warn</tt> script to warn of configuration errors. The <tt>binfile.so.1</tt> plugin executes the <tt>audit_warn</tt> script. The script, by default, sends warnings to the <tt>audit_warn</tt> email alias and to the console. The <tt>syslog.so.1</tt> plugin does not execute the <tt>audit_warn</tt> script.</p></li>
<li><p><a name="indexterm-3425"></a><a name="indexterm-3426"></a>By default, when all audit directories are full, processes that generate audit records are suspended. In addition, the <tt>auditd</tt> daemon writes a message to the console and to the <tt>audit_warn</tt> email alias. At this point, only the system administrator can fix the auditing service. The administrator can log in to write audit files to offline media, delete audit files from the system, and do other cleanup tasks.</p><p>The audit policy can be reconfigured with the <tt>auditconfig</tt> command.</p></li></ul>
<p><a name="indexterm-3427"></a>The <tt>auditd</tt> daemon can be started automatically when the system is brought up
to multiuser mode. Or, you can start the daemon from the command line.
When the <tt>auditd</tt> daemon is started, it calculates the amount of free space
necessary for audit files.</p><p><a name="indexterm-3428"></a><a name="indexterm-3429"></a><a name="indexterm-3430"></a><a name="indexterm-3431"></a><a name="indexterm-3432"></a><a name="indexterm-3433"></a><a name="indexterm-3434"></a><a name="indexterm-3435"></a><a name="indexterm-3436"></a>The <tt>auditd</tt> daemon uses the list of audit directories in the <tt>audit_control</tt> file as
possible locations for creating audit files. The daemon maintains a pointer into this
list of directories, starting with the first directory. Every time the <tt>auditd</tt> daemon
needs to create an audit file, the daemon puts the file into the
first available directory in the list. The list starts at the <tt>auditd</tt> daemon's
current pointer. You can reset the pointer to the beginning of the list
by running the <tt>audit</tt> <tt>-s</tt> command. The <tt>audit</tt> <tt>-n</tt> command instructs the daemon
to switch to a new audit file. The new file is created in
the same directory as the current file.</p>

<a name="auditref-3"></a><h4><tt>audit</tt> Command</h4>
<a name="indexterm-3437"></a><p>The <tt>audit</tt> command controls the actions of the <tt>auditd</tt> daemon. The <tt>audit</tt>
command can do the following tasks:</p>
<ul><li><p>Enable and disable auditing</p></li>
<li><p>Reset the <tt>auditd</tt> daemon</p></li>
<li><p><a name="indexterm-3438"></a><a name="indexterm-3439"></a><a name="indexterm-3440"></a>Adjust the auditing preselection mask on the local system</p></li>
<li><p>Write audit records to a different audit file</p></li></ul>
<p>For a discussion of the available options, see the <a href="http://docs.sun.com/doc/819-2240/audit-1m?a=view"><tt>audit</tt>(1M)</a> man page.</p>

<a name="auditref-56"></a><h4><tt>bsmrecord</tt> Command</h4>
<a name="indexterm-3441"></a><a name="indexterm-3442"></a><p>The <tt>bsmrecord</tt> command displays the format of audit events that are defined in
the <tt>/etc/security/audit_event</tt> file. The output includes the event's audit ID, audit class,
audit flag, and the record's audit tokens in order. With no option, the
<tt>bsmrecord</tt> output displays in a terminal window. With the <tt>-h</tt> option, the output
is suitable for viewing in a browser. For examples of the use
of the <tt>bsmrecord</tt> command, see <a href="audittask-21.html#audittask-10">How to Display Audit Record Formats</a>. Also, see the <a href="http://docs.sun.com/doc/819-2240/bsmrecord-1m?a=view"><tt>bsmrecord</tt>(1M)</a> man page.</p>

<a name="auditref-11"></a><h4><tt>auditreduce</tt> Command</h4>
<p><a name="indexterm-3443"></a><a name="indexterm-3444"></a><a name="indexterm-3445"></a><a name="indexterm-3446"></a><a name="indexterm-3447"></a><a name="indexterm-3448"></a><a name="indexterm-3449"></a><a name="indexterm-3450"></a>The <tt>auditreduce</tt> command summarizes audit records that are stored in binary format. The
command can merge audit records from one or more input audit files. The
command can also be used to perform a post selection of audit records.
The records remain in binary format. To merge the entire audit trail, run
this command on the audit server. The audit server is the system that
mounts all the audit file systems for the installation. For more information, see
the <a href="http://docs.sun.com/doc/819-2240/auditreduce-1m?a=view"><tt>auditreduce</tt>(1M)</a> man page.</p><p><a name="indexterm-3451"></a>The <tt>auditreduce</tt> command enables you to track all audited actions on multiple systems
from a single location. The command can read the logical combination of all
audit files as a single audit trail. You must identically configure all systems
at a site for auditing, and create servers and local directories for the
audit files. The <tt>auditreduce</tt> command ignores how the records were generated or where
the records are stored. Without options, the <tt>auditreduce</tt> command merges audit records from all
the audit files in all of the subdirectories in the audit root
directory. Typically, <tt>/etc/security/audit</tt> is the audit root directory. The <tt>auditreduce</tt> command sends the merged
results to standard output. You can also place the results into a single,
chronologically ordered output file. The file contains binary data.</p><p>The <tt>auditreduce</tt> command can also select particular types of records for analysis. The
merging functions and selecting functions of the <tt>auditreduce</tt> command are logically independent. The
<tt>auditreduce</tt> command captures data from the input files as the records are read,
before the files are merged and then written to disk.</p><p><a name="indexterm-3452"></a>By specifying options to the <tt>auditreduce</tt> command, you can also do the
following:</p>
<ul><li><p>Request audit records that were generated by specified audit classes</p></li>
<li><p>Request audit records that were generated by one particular user</p></li>
<li><p>Request audit records that were generated on specific dates</p></li></ul>
<p><a name="indexterm-3453"></a><a name="indexterm-3454"></a><a name="indexterm-3455"></a>With no arguments, the <tt>auditreduce</tt> command checks the subdirectories within the <tt>/etc/security/audit</tt> directory, the default
audit root directory. The command checks for a <tt>files</tt> directory in which
the <i>start-time.end-time.hostname</i> files reside. The <tt>auditreduce</tt> command is very useful when audit data
resides in separate directories. <a href="#auditref-fig-2">Figure&nbsp;31-1</a> illustrates audit data in separate directories for different
hosts. <a href="#auditref-fig-3">Figure&nbsp;31-2</a> illustrates audit data in separate directories for different audit servers.</p><a name="auditref-fig-2"></a><h6>Figure&nbsp;31-1 Audit Trail Storage Sorted by Host</h6><img src="figures/audittrail1.gif" alt="Diagram shows a default audit root directory whose top directory names are host names."></img><a name="auditref-fig-3"></a><h6>Figure&nbsp;31-2 Audit Trail Storage Sorted by Server</h6><img src="figures/audittrail2.gif" alt="Diagram shows a default audit root directory whose top directory names are server names."></img><p>If the partition for the <tt>/etc/security/audit</tt> directory is very small, you might not
store audit data in the default directory. You can pass the <tt>auditreduce</tt> command
another directory by using the <tt>-R</tt> option:</p><pre># auditreduce -R /var/<i>audit-alt</i> </pre><p>You can also specify a particular subdirectory by using the <tt>-S</tt> option:</p><pre># auditreduce -S /var/<i>audit-alt</i>/<i>host1</i> </pre><p>For other options and more examples, see the <a href="http://docs.sun.com/doc/819-2240/auditreduce-1m?a=view"><tt>auditreduce</tt>(1M)</a> man page.</p>

<a name="auditref-76"></a><h4><tt>praudit</tt> Command</h4>
<p><a name="indexterm-3456"></a><a name="indexterm-3457"></a><a name="indexterm-3458"></a><a name="indexterm-3459"></a><a name="indexterm-3460"></a><a name="indexterm-3461"></a><a name="indexterm-3462"></a><a name="indexterm-3463"></a><a name="indexterm-3464"></a>The <tt>praudit</tt> command makes the binary output of the <tt>auditreduce</tt> command readable. The
<tt>praudit</tt> command reads audit records in binary format from standard input and displays
the records in a presentable format. The input can be piped from the
<tt>auditreduce</tt> command or from a single audit file. Input can also be
produced with the <tt>cat</tt> command to concatenate several files, or the <tt>tail</tt> command
for a current audit file.</p><p><a name="indexterm-3465"></a><a name="indexterm-3466"></a>The <tt>praudit</tt> command can generate four output formats. A fifth option, <tt>-l</tt>
(long), prints one audit record per line of output. The default is to
place one audit token per line of output. The <tt>-d</tt> option changes the
delimiter that is used between token fields and between tokens. The default delimiter
is a comma.</p>
<ul><li><p><a name="indexterm-3467"></a><b>Default &ndash;</b> The <tt>praudit</tt> command with no options displays one audit token per line. The command displays the audit event by its description, such as the <tt>ioctl(2)</tt> system call. Any value that can be displayed as text is displayed in text format. For example, a user is displayed as the user name, not as the user ID.</p></li>
<li><p><a name="indexterm-3468"></a><a name="indexterm-3469"></a><b>&ndash;r option &ndash;</b> The raw option displays as a number any value that could be numeric. For example, a user is displayed by user ID, Internet addresses are in hexadecimal format, and modes are in octal format. The audit event is displayed as its event number, such as <tt>158</tt>.</p></li>
<li><p><a name="indexterm-3470"></a><a name="indexterm-3471"></a><b>&ndash;s option &ndash;</b> The short option displays the audit event by its table name, for example, <tt>AUE_IOCTL</tt>. The option displays the other tokens as the default option displays them.</p></li>
<li><p><a name="indexterm-3472"></a><a name="indexterm-3473"></a><a name="indexterm-3474"></a><b>&ndash;x option &ndash;</b> The XML option displays the audit record in XML format. This option is useful as input to browsers, or as input to scripts that manipulate XML.</p><p><a name="indexterm-3475"></a><a name="indexterm-3476"></a><a name="indexterm-3477"></a>The XML is described by a DTD that the auditing service provides. Solaris software also provides a style sheet. The DTD and the style sheet are in the <tt>/usr/share/lib/xml</tt> directory.</p></li></ul>
<p>In the default output format of the <tt>praudit</tt> command, each record is easily
identified as a sequence of audit tokens. Each token is presented on a
separate line. Each record begins with a <tt>header</tt> token. You could, for example,
further process the output with the <tt>awk</tt> command.</p><p><a name="indexterm-3478"></a>Here is the output from the <tt>praudit</tt> <tt>-l</tt> command for a <tt>header</tt>
token:</p><pre>header,173,2,settppriv(2),,example1,2003-10-13 13:46:02.174 -07:00</pre><p><a name="indexterm-3479"></a>Here is the output from the <tt>praudit</tt> <tt>-r</tt> command for the same
<tt>header</tt> token:</p><pre>121,173,2,289,0x0000,192.168.86.166,1066077962,174352445</pre><a name="auditref-946"></a><h6>Example&nbsp;31-1 Processing <tt>praudit</tt> Output With a Script</h6><a name="indexterm-3480"></a><a name="indexterm-3481"></a><p>You might want to process output from the <tt>praudit</tt> command as lines of
text. For example, you might want to select records that the <tt>auditreduce</tt>
command cannot select. You can use a simple shell script to process the
output of the <tt>praudit</tt> command. The following simple example script puts one audit
record on one line, searches for a user-specified string, then returns the audit
file to its original form.</p><pre>#!/bin/sh
#
## This script takes an argument of a user-specified string.
#  The sed command prefixes the header tokens with Control-A
#  The first tr command puts the audit tokens for one record 
#  onto one line while preserving the line breaks as Control-A
#
praudit | sed -e '1,2d' -e '$s/^file.*$//' -e 's/^header/^aheader/' \\
| tr '\\012\\001' '\\002\\012' \\
| grep "$1" \\ Finds the user-specified string
| tr '\\002' '\\012' Restores the original newline breaks</pre><p>Note that the <tt>^a</tt> in the script is Control-A, not the two characters
<tt>^</tt> and <tt>a</tt>. The prefix distinguishes the <tt>header</tt> token from the string <tt>header</tt>
that might appear as text.</p>

<a name="auditref-18"></a><h4><tt>auditconfig</tt> Command</h4>
<a name="indexterm-3482"></a><a name="indexterm-3483"></a><p>The <tt>auditconfig</tt> command provides a command-line interface to retrieve and set audit configuration
parameters. The <tt>auditconfig</tt> command can do the following tasks:</p>
<ul><li><p>Display, check, and configure audit policy</p></li>
<li><p>Determine if auditing is turned on or turned off</p></li>
<li><p>Turn auditing off and turn auditing on</p></li>
<li><p>Manage the audit directory and the audit file</p></li>
<li><p>Manage the audit queue</p></li>
<li><p>Get and set preselection masks</p></li>
<li><p>Get and set audit event to audit class mappings</p></li>
<li><p>Get and set configuration information, such as session ID and audit ID</p></li>
<li><p>Configure audit characteristics for a process, a shell, and a session</p></li>
<li><p>Reset audit statistics</p></li></ul>
<p>For a discussion of the command options, see the <a href="http://docs.sun.com/doc/819-2240/auditconfig-1m?a=view"><tt>auditconfig</tt>(1M)</a> man page.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="auditref-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="auditref-13.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

