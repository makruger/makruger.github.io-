<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Managing Audit Records - System Administration Guide: Security Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Security Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="audittask-91.html">Previous</a>
             </td>
             <td align="right">
                 <a href="auditref-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="oview-1.html">Part&nbsp;I&nbsp;Security Overview</a></p>
<p class="toc level2"><a href="secov-1.html">1.&nbsp;&nbsp;Security Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="sectm-1.html">Part&nbsp;II&nbsp;System, File, and Device Security</a></p>
<p class="toc level2"><a href="concept-1.html">2.&nbsp;&nbsp;Managing Machine Security (Overview)</a></p>
<p class="toc level2"><a href="secsys-1.html">3.&nbsp;&nbsp;Controlling Access to Systems (Tasks)</a></p>
<p class="toc level2"><a href="vscan-1.html">4.&nbsp;&nbsp;Virus Scanning Service (Tasks)</a></p>
<p class="toc level2"><a href="devtask-1.html">5.&nbsp;&nbsp;Controlling Access to Devices (Tasks)</a></p>
<p class="toc level2"><a href="bart-1.html">6.&nbsp;&nbsp;Using the Basic Audit Reporting Tool (Tasks)</a></p>
<p class="toc level2"><a href="secfile-1.html">7.&nbsp;&nbsp;Controlling Access to Files (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="prbactm-1.html">Part&nbsp;III&nbsp;Roles, Rights Profiles, and Privileges</a></p>
<p class="toc level2"><a href="prbac-1.html">8.&nbsp;&nbsp;Using Roles and Privileges (Overview)</a></p>
<p class="toc level2"><a href="rbactask-1.html">9.&nbsp;&nbsp;Using Role-Based Access Control (Tasks)</a></p>
<p class="toc level2"><a href="rbacref-1.html">10.&nbsp;&nbsp;Role-Based Access Control (Reference)</a></p>
<p class="toc level2"><a href="privtask-1.html">11.&nbsp;&nbsp;Privileges (Tasks)</a></p>
<p class="toc level2"><a href="privref-1.html">12.&nbsp;&nbsp;Privileges (Reference)</a></p>
<p class="toc level1 tocsp"><a href="scftm-1.html">Part&nbsp;IV&nbsp;Solaris Cryptographic Services</a></p>
<p class="toc level2"><a href="scf-1.html">13.&nbsp;&nbsp;Solaris Cryptographic Framework (Overview)</a></p>
<p class="toc level2"><a href="scftask-1.html">14.&nbsp;&nbsp;Solaris Cryptographic Framework (Tasks)</a></p>
<p class="toc level2"><a href="kmf-1.html">15.&nbsp;&nbsp;Solaris Key Management Framework</a></p>
<p class="toc level1 tocsp"><a href="authtm-1.html">Part&nbsp;V&nbsp;Authentication Services and Secure Communication</a></p>
<p class="toc level2"><a href="auth-1.html">16.&nbsp;&nbsp;Using Authentication Services (Tasks)</a></p>
<p class="toc level2"><a href="pam-1.html">17.&nbsp;&nbsp;Using PAM</a></p>
<p class="toc level2"><a href="sasl-1.html">18.&nbsp;&nbsp;Using SASL</a></p>
<p class="toc level2"><a href="sshuser-1.html">19.&nbsp;&nbsp;Using Solaris Secure Shell (Tasks)</a></p>
<p class="toc level2"><a href="sshref-1.html">20.&nbsp;&nbsp;Solaris Secure Shell (Reference)</a></p>
<p class="toc level1 tocsp"><a href="seamtm-1.html">Part&nbsp;VI&nbsp;Kerberos Service</a></p>
<p class="toc level2"><a href="intro-1.html">21.&nbsp;&nbsp;Introduction to the Kerberos Service</a></p>
<p class="toc level2"><a href="seamplan-1.html">22.&nbsp;&nbsp;Planning for the Kerberos Service</a></p>
<p class="toc level2"><a href="setup-8.html">23.&nbsp;&nbsp;Configuring the Kerberos Service (Tasks)</a></p>
<p class="toc level2"><a href="trouble-1.html">24.&nbsp;&nbsp;Kerberos Error Messages and Troubleshooting</a></p>
<p class="toc level2"><a href="aadmin-1.html">25.&nbsp;&nbsp;Administering Kerberos Principals and Policies (Tasks)</a></p>
<p class="toc level2"><a href="user-7.html">26.&nbsp;&nbsp;Using Kerberos Applications (Tasks)</a></p>
<p class="toc level2"><a href="refer-1.html">27.&nbsp;&nbsp;The Kerberos Service (Reference)</a></p>
<p class="toc level1 tocsp"><a href="audittm-1.html">Part&nbsp;VII&nbsp;Solaris Auditing</a></p>
<p class="toc level2"><a href="auditov-1.html">28.&nbsp;&nbsp;Solaris Auditing (Overview)</a></p>
<p class="toc level2"><a href="auditplan-1.html">29.&nbsp;&nbsp;Planning for Solaris Auditing</a></p>
<p class="toc level2"><a href="audittask-1.html">30.&nbsp;&nbsp;Managing Solaris Auditing (Tasks)</a></p>
<p class="toc level3"><a href="audittask-3.html">Solaris Auditing (Task Map)</a></p>
<p class="toc level3"><a href="audittask-15.html">Configuring Audit Files (Task Map)</a></p>
<p class="toc level3"><a href="audittask-44.html">Configuring Audit Files (Tasks)</a></p>
<p class="toc level3"><a href="audittask-4.html">Configuring and Enabling the Auditing Service (Task Map)</a></p>
<p class="toc level3"><a href="audittask-28.html">Configuring and Enabling the Auditing Service (Tasks)</a></p>
<p class="toc level3"><a href="audittask-26.html">Configuring the Auditing Service in Zones (Tasks)</a></p>
<p class="toc level3"><a href="audittask-91.html">Managing Audit Records (Task Map)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Managing Audit Records</a></p>
</div>
<p class="toc level2 tocsp"><a href="auditref-1.html">31.&nbsp;&nbsp;Solaris Auditing (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-2.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="audittask-21"></a><h3>Managing Audit Records</h3>
<p>By managing the audit trail, you can monitor the actions of users
on your network. Auditing can generate large amounts of data. The following tasks show
you how to work with all this data.</p>

<a name="audittask-10"></a><h4>How to Display Audit Record Formats</h4><a name="indexterm-3325"></a><a name="indexterm-3326"></a><a name="indexterm-3327"></a><a name="indexterm-3328"></a><a name="indexterm-3329"></a><a name="indexterm-3330"></a><p>To write scripts that can find the audit data that you want,
you need to know the order of tokens in an audit event. The
<tt>bsmrecord</tt> command displays the audit event number, audit class, selection mask, and record
format of an audit event.</p><ul>
<li><b><a name="indexterm-3331"></a><a name="indexterm-3332"></a>Put the format of all audit event records in an HTML file.</b><p>The <tt>-a</tt> option lists all audit event record formats. The <tt>-h</tt> option puts
the list in HTML format that can be displayed in a browser.</p><pre>% <tt><b>bsmrecord -a -h &gt; audit.events.html</b></tt></pre><p>When you display the <tt>*html</tt> file in a browser, use the browser's Find
tool to find specific records.</p><p><a name="indexterm-3333"></a><a name="indexterm-3334"></a><a name="indexterm-3335"></a><a name="indexterm-3336"></a>For more information, see the <a href="http://docs.sun.com/doc/819-2240/bsmrecord-1m?a=view"><tt>bsmrecord</tt>(1M)</a> man page.</p></li></ul><a name="audittask-79"></a><h6>Example&nbsp;30-24 Displaying the Audit Record Formats of a Program</h6><a name="indexterm-3337"></a><a name="indexterm-3338"></a><a name="indexterm-3339"></a><p>In this example, the format of all audit records that are generated by
the <tt>login</tt> program are displayed. The login programs include <tt>rlogin</tt>, <tt>telnet</tt>, <tt>newgrp</tt>, role login
to the Solaris Management Console, and Solaris Secure Shell.</p><pre>% <tt><b>bsmrecord -p login</b></tt>
terminal login
  program     /usr/sbin/login      See login(1)
              /usr/dt/bin/dtlogin  See dtlogin
  event ID    6152                 AUE_login
  class       lo                   (0x00001000)
      header
      subject
      text                         error message or "successful login"
      return

login: logout
  program     various              See login(1)
  event ID    6153                 AUE_logout
&hellip;

newgrp
  program     newgrp               See newgrp login
  event ID    6212                 AUE_newgrp_login
&hellip;

rlogin
  program     /usr/sbin/login      See login(1) - rlogin
  event ID    6155                 AUE_rlogin
&hellip;

SMC: role login
  program     SMC server           See role login
  event ID    6173                 AUE_role_login
&hellip;

/usr/lib/ssh/sshd
  program     /usr/lib/ssh/sshd    See login - ssh
  event ID    6172                 AUE_ssh
&hellip;

telnet login
  program     /usr/sbin/login      See login(1) - telnet
  event ID    6154                 AUE_telnet
  &hellip;</pre><a name="audittask-33"></a><h6>Example&nbsp;30-25 Displaying the Audit Record Formats of an Audit Class</h6><a name="indexterm-3340"></a><a name="indexterm-3341"></a><a name="indexterm-3342"></a><p>In this example, the format of all audit records in the <tt>fd</tt>
class are displayed.</p><pre>% <tt><b>bsmrecord -c fd</b></tt>

rmdir
  system call rmdir                See rmdir(2)
  event ID    48                   AUE_RMDIR
  class       fd                   (0x00000020)
      header
      path
      [attribute]
      subject
      [use_of_privilege]
      return

unlink
  system call unlink               See unlink(2)
  event ID    6                    AUE_UNLINK
  &hellip;

unlinkat
  system call unlinkat             See openat(2)
  event ID    286                  AUE_UNLINKAT
  &hellip;</pre>

<a name="audittask-20"></a><h4>How to Merge Audit Files From the Audit Trail</h4><a name="indexterm-3343"></a><a name="indexterm-3344"></a><a name="indexterm-3345"></a><a name="indexterm-3346"></a><a name="indexterm-3347"></a><a name="indexterm-3348"></a><a name="indexterm-3349"></a><a name="indexterm-3350"></a><a name="indexterm-3351"></a><a name="indexterm-3352"></a><a name="indexterm-3353"></a><a name="indexterm-3354"></a><a name="indexterm-3355"></a><a name="indexterm-3356"></a><a name="indexterm-3357"></a><p><a name="indexterm-3358"></a>By merging all audit files in all the audit directories, you can analyze
the contents of the entire audit trail. The <tt>auditreduce</tt> command merges all the
records from its input files into a single output file. The input files
can then be deleted. When the output file is placed in a
directory that is named <tt>/etc/security/audit</tt><i>server-name</i><tt>/files</tt>, the <tt>auditreduce</tt> command can find the output file without
your specifying the full path.</p>
<hr><p><b>Note - </b>This procedure applies only to binary audit records.</p>
<hr>
<ol>
<li><b>Assume a role that includes the Audit Review profile, or become superuser.</b><p>The System Administrator role includes the Audit Review profile. You can also create
a separate role that includes the Audit Review profile. To create a role
and assign the role to a user, see <a href="rbactask-15.html">Configuring RBAC (Task Map)</a>.</p></li>
<li><b>Create a directory for storing merged audit files.</b><pre># mkdir <i>audit-trail-directory</i></pre></li>
<li><b>Limit access to the directory.</b><pre># chmod 700 <i>audit-trail-directory</i>
# ls -la <i>audit-trail-directory</i>
drwx------   3 root     sys          512 May 12 11:47 .
drwxr-xr-x   4 root     sys         1024 May 12 12:47 ..</pre></li>
<li><b>Merge the audit records in the audit trail.</b><p>Change directories to the <i>audit-trail-directory</i> and merge the audit records into a file with
a named suffix. All directories that are listed in the <tt>dir</tt> lines of
the <tt>audit_control</tt> file on the local system are merged.</p><pre># cd <i>audit-trail-directory</i>
# auditreduce -<i>Uppercase-option</i> -O <i>suffix</i></pre><p><a name="indexterm-3359"></a>The uppercase options to the <tt>auditreduce</tt> command manipulate files in the audit trail. The
uppercase options include the following:</p><dl><dt><tt>-A</tt></dt>
<dd><p>Selects all of the files in the audit trail.</p></dd>
<dt><tt>-C</tt></dt>
<dd><p>Selects complete files only. This option ignores files with the suffix <tt>not_terminated</tt>.</p></dd>
<dt><tt>-M</tt></dt>
<dd><p>Selects files with a particular suffix. The suffix can be a machine name, or it can be a suffix that you have specified for a summary file.</p></dd>
<dt><tt>-O</tt></dt>
<dd><p>Creates an audit file with 14-character timestamps for both the start time and the end time, with the suffix <i>suffix</i> in the current directory.</p></dd>
</dl>
</li></ol><a name="audittask-54"></a><h6>Example&nbsp;30-26 Copying Audit Files to a Summary File</h6><p><a name="indexterm-3360"></a>In the following example, the System Administrator role, <tt>sysadmin</tt>, copies all files from the
audit trail into a merged file.</p><pre>$ <tt><b>whoami</b></tt>
sysadmin
$ <tt><b>mkdir /var/audit/audit_summary.dir</b></tt>
$ <tt><b>chmod 700 /var/audit/audit_summary.dir</b></tt>
$ <tt><b>cd /var/audit/audit_summary.dir</b></tt>
$ <tt><b>auditreduce -A -O All</b></tt>
$ <tt><b>ls *All</b></tt>
20030827183214.20030827215318.All</pre><p><a name="indexterm-3361"></a>In the following example, only complete files are copied from the audit trail into
a merged file.</p><pre>$ <tt><b>cd /var/audit/audit_summary.dir</b></tt>
$ <tt><b>auditreduce -C -O Complete</b></tt>
$ <tt><b>ls *Complete</b></tt>
20030827183214.20030827214217.Complete</pre><p><a name="indexterm-3362"></a>In the following example, only complete files are copied from the <tt>example1</tt> machine into
a merged file.</p><pre>$ <tt><b>cd /var/audit/audit_summary.dir</b></tt>
$ <tt><b>auditreduce -M example1 -O example1summ</b></tt>
$ <tt><b>ls *summ</b></tt>
20030827183214.20030827214217.example1summ</pre><a name="audittask-56"></a><h6>Example&nbsp;30-27 Moving Audit Files to a Summary File</h6><p><a name="indexterm-3363"></a>The <tt>-D</tt> option to the <tt>auditreduce</tt> command deletes an audit file when you
copy it to another location. In the following example, the complete audit files
from one system are copied to the summary directory for later examination.</p><pre>$ <tt><b>cd /var/audit/audit_summary.dir</b></tt>
$ <tt><b>auditreduce -C -O daily_example1 -D example1</b></tt>
$ <tt><b>ls *example1</b></tt>
20030827183214.20030827214217.daily_example1</pre><p>The audit files from the <tt>example1</tt> system that were the input to the
<tt>*daily_example1</tt> file are removed when this command successfully completes.</p>

<a name="audittask-24"></a><h4>How to Select Audit Events From the Audit Trail</h4><a name="indexterm-3364"></a><a name="indexterm-3365"></a><a name="indexterm-3366"></a><a name="indexterm-3367"></a><a name="indexterm-3368"></a><p><a name="indexterm-3369"></a><a name="indexterm-3370"></a>You can filter audit records for examination. For the complete list of filtering
options, see the <a href="http://docs.sun.com/doc/819-2240/auditreduce-1m?a=view"><tt>auditreduce</tt>(1M)</a> man page.</p><ol>
<li><b>Assume a role that includes the Audit Review profile, or become superuser.</b><p>The System Administrator role includes the Audit Review profile. You can also create
a separate role that includes the Audit Review profile. To create a role
and assign the role to a user, see <a href="rbactask-15.html">Configuring RBAC (Task Map)</a>.</p></li>
<li><b>Select the kinds of records that you want from the audit trail, or
from a specified audit file.</b><pre>auditreduce -<i>lowercase-option</i> <i>argument</i> [<i>optional-file</i>]</pre><dl><dt><i>argument</i></dt>
<dd><p>Specific argument that a lowercase option requires. For example, the <tt>-c</tt> option requires an <i>argument</i> of an audit class, such as <tt>ua</tt>.</p></dd>
<dt><tt>-d</tt></dt>
<dd><p>Selects all of the events on a particular date. The date format for <i>argument</i> is <i>yyymmdd</i>. Other date options, <tt>-b</tt> and <tt>-a</tt>, select events before and after a particular date.</p></dd>
<dt><tt>-u</tt></dt>
<dd><p>Selects all of the events attributable to a particular user. The <i>argument</i> is a user name. Another user option, <tt>-e</tt>, selects all of the events attributable to an effective user ID.</p></dd>
<dt><tt>-c</tt></dt>
<dd><p>Selects all of the events in a preselected audit class. The <i>argument</i> is an audit class name.</p></dd>
<dt><tt>-m</tt></dt>
<dd><p>Selects all of the instances of a particular audit event. The <i>argument</i> is an audit event.</p></dd>
<dt><i>optional-file</i></dt>
<dd><p>Is the name of an audit file.</p></dd>
</dl>
</li></ol><a name="audittask-72"></a><h6>Example&nbsp;30-28 Combining and Reducing Audit Files</h6><p><a name="indexterm-3371"></a>The <tt>auditreduce</tt> command can eliminate the less interesting records as it combines the
input files. For example, you might use the <tt>auditreduce</tt> command to retain only the
login and logout records in audit files that are over a month
old. If you need to retrieve the complete audit trail, you could recover
the trail from backup media.</p><pre># <tt><b>cd /var/audit/audit_summary.dir</b></tt>
# <tt><b>auditreduce -O lo.summary -b 20030827 -c lo; compress *lo.summary</b></tt></pre><a name="audittask-55"></a><h6>Example&nbsp;30-29 Copying <tt>na</tt> Audit Records to a Summary File</h6><p><a name="indexterm-3372"></a>In this example, all the records of nonattributable audit events in the audit
trail are collected into one file.</p><pre>$ <tt><b>whoami</b></tt>
sysadmin
$ <tt><b>cd /var/audit/audit_summary.dir</b></tt>
$ <tt><b>auditreduce -c na -O nasumm</b></tt>
$ <tt><b>ls *nasumm</b></tt>
20030827183214.20030827215318.nasumm</pre><p>The merged <tt>nasumm</tt> audit file is time stamped with the beginning and ending
date of the <tt>na</tt> records.</p><a name="audittask-57"></a><h6>Example&nbsp;30-30 Finding Audit Events in a Specified Audit File</h6><p>You can select audit files manually to search just the named set
of files. For example, you can further process the <tt>*nasumm</tt> file in the previous
example to find system boot events. To do so, you would specify the
file name as the final argument to the <tt>auditreduce</tt> command.</p><pre>$ <tt><b>auditreduce -m 113 -O systemboot 20030827183214.20030827215318.nasumm</b></tt>
20030827183214.20030827183214.systemboot</pre><p>The <tt>20030827183214.20030827183214.systemboot</tt> file contains only system boot audit events.</p><a name="audittask-41"></a><h6>Example&nbsp;30-31 Copying One User's Audit Records to a Summary File</h6><p><a name="indexterm-3373"></a>In this example, the records in the audit trail that contain the name
of a particular user are merged. The <tt>-e</tt> option finds the effective user.
The <tt>-u</tt> option finds the audit user.</p><pre>$ <tt><b>cd /var/audit/audit_summary.dir</b></tt>
$ <tt><b>auditreduce -e tamiko -O tamiko</b></tt></pre><p><a name="indexterm-3374"></a>You can look for specific events in this file. In the following example,
what time the user logged in and out on Sept 7, 2003, your
time, is checked. Only those files with the user's name as the file
suffix are checked. The short form of the date is <i>yyyymmdd</i>.</p><pre># <tt><b>auditreduce -M tamiko -O tamikolo -d 20030907 -u tamiko -c lo</b></tt></pre><a name="audittask-88"></a><h6>Example&nbsp;30-32 Copying Selected Records to a Single File</h6><a name="indexterm-3375"></a><a name="indexterm-3376"></a><a name="indexterm-3377"></a><a name="indexterm-3378"></a><a name="indexterm-3379"></a><p>In this example, login and logout messages for a particular day are selected
from the audit trail. The messages are merged into a target file. The
target file is written in a directory other than the normal audit
root directory.</p><pre># <tt><b>auditreduce -c lo -d 20030827 -O /var/audit/audit_summary.dir/logins</b></tt>
# <tt><b>ls /var/audit/audit_summary.dir/*logins</b></tt>
/var/audit/audit_summary.dir/20030827183936.20030827232326.logins</pre>

<a name="audittask-22"></a><h4>How to View the Contents of Binary Audit Files</h4><a name="indexterm-3380"></a><a name="indexterm-3381"></a><a name="indexterm-3382"></a><a name="indexterm-3383"></a><a name="indexterm-3384"></a><a name="indexterm-3385"></a><a name="indexterm-3386"></a><p>The <tt>praudit</tt> command enables you to view the contents of binary audit files.
You can pipe the output from the <tt>auditreduce</tt> command, or you can read
a particular audit file. The <tt>-x</tt> option is useful for further processing.</p><ol>
<li><b>Assume a role that includes the Audit Review profile, or become superuser.</b><p>The System Administrator role includes the Audit Review profile. You can also create
a separate role that includes the Audit Review profile. To create a role
and assign the role to a user, see <a href="rbactask-15.html">Configuring RBAC (Task Map)</a>.</p></li>
<li><b>Use one of the following <tt>praudit</tt> commands to produce the output that is
best for your purposes.</b><p>The following examples show <tt>praudit</tt> output from the same audit event. Audit policy has
been set to include the <tt>sequence</tt> and <tt>trailer</tt> tokens.</p>
<ul><li><p>The <tt>praudit -s</tt> command displays audit records in a short format, one token per line. Use the <tt>-l</tt> option to place each record on one line.</p><pre>$ <tt><b>auditreduce -c lo | praudit -s</b></tt>
header,101,2,AUE_rlogin,,example1,2003-10-13 11:23:31.050 -07:00
subject,jdoe,jdoe,staff,jdoe,staff,749,749,195 1234 server1
text,successful login 
return,success,0 
sequence,1298</pre></li>
<li><p>The <tt>praudit -r</tt> command displays audit records in their raw format, one token per line. Use the <tt>-l</tt> option to place each record on one line.</p><pre>$ <tt><b>auditreduce -c lo | praudit -r</b></tt>
21,101,2,6155,0x0000,192.168.60.83,1062021202,64408258
36,2026700,2026700,10,2026700,10,749,749,195 1234 192.168.60.17
40,successful login
39,0,0
47,1298</pre></li>
<li><p><a name="indexterm-3387"></a><a name="indexterm-3388"></a>The <tt>praudit -x</tt> command displays audit records in XML format, one token per line. Use the <tt>-l</tt> option to place the XML output for one record on one line.</p><pre>$ <tt><b>auditreduce -c lo | praudit -x</b></tt>
&lt;record version="2" event="login - rlogin" host="example1" 
time="Wed Aug 27 14:53:22 PDT 2003" msec="64"&gt;
&lt;subject audit-uid="jdoe" uid="jdoe" gid="staff" ruid="jdoe" 
rgid="staff" pid="749" sid="749" tid="195 1234 server1"/&gt;
&lt;text&gt;successful login&lt;/text&gt;
&lt;return errval="success" retval="0"/&gt;
&lt;sequence seq-num="1298"/&gt;

&lt;/record&gt;</pre></li></ul>
</li></ol><a name="audittask-40"></a><h6>Example&nbsp;30-33 Printing the Entire Audit Trail</h6><a name="indexterm-3389"></a><a name="indexterm-3390"></a><a name="indexterm-3391"></a><p>With a pipe to the <tt>lp</tt> command, the output for the entire audit
trail goes to the printer. The printer should have limited access.</p><pre># <tt><b>auditreduce | praudit | lp -d example.protected.printer</b></tt></pre><a name="audittask-42"></a><h6>Example&nbsp;30-34 Viewing a Specific Audit File</h6><a name="indexterm-3392"></a><a name="indexterm-3393"></a><a name="indexterm-3394"></a><a name="indexterm-3395"></a><a name="indexterm-3396"></a><p>In this example, a summary login file is examined in a terminal
window.</p><pre># <tt><b>cd /var/audit/audit_summary.dir/logins</b></tt>
# <tt><b>praudit 20030827183936.20030827232326.logins | more</b></tt></pre><a name="audittask-46"></a><h6>Example&nbsp;30-35 Putting Audit Records in XML Format</h6><a name="indexterm-3397"></a><a name="indexterm-3398"></a><a name="indexterm-3399"></a><a name="indexterm-3400"></a><p>In this example, the audit records are converted to XML format.</p><pre># <tt><b>praudit -x 20030827183214.20030827215318.logins &gt; 20030827.logins.xml</b></tt></pre><p>The <tt>*xml</tt> file can be displayed in a browser. The contents of the
file can be operated on by a script to extract the relevant information.</p>

<a name="audittask-12"></a><h4>How to Clean Up a <tt>not_terminated</tt> Audit File</h4><a name="indexterm-3401"></a><a name="indexterm-3402"></a><a name="indexterm-3403"></a><a name="indexterm-3404"></a><p>Occasionally, an audit daemon exits while its audit file is still open. Or,
a server becomes inaccessible and forces the machine to switch to a
new server. In such instances, an audit file remains with the string <tt>not_terminated</tt>
as the end timestamp, even though the file is no longer used
for audit records. Use the <tt>auditreduce -O</tt> command to give the file the correct timestamp.</p><ol>
<li><b>List the files with the <tt>not_terminated</tt> string on your audit file system in
order of creation.</b><pre># ls -R1t <i>audit-directory</i>*/files/* | grep not_terminated</pre><dl><dt><tt>-R</tt></dt>
<dd><p>Lists files in subdirectories.</p></dd>
<dt><tt>-t</tt></dt>
<dd><p>Lists files from most recent to oldest.</p></dd>
<dt><tt>-1</tt></dt>
<dd><p>Lists the files in one column.</p></dd>
</dl>
</li>
<li><b>Clean up the old <tt>not_terminated</tt> file.</b><p>Specify the name of the old file to the <tt>auditreduce -O</tt> command.</p><pre># auditreduce -O <i>system-name old-not-terminated-file</i></pre></li>
<li><b>Remove the old <tt>not_terminated</tt> file.</b><pre># rm <i>system-name old-not-terminated-file</i></pre></li></ol><a name="audittask-47"></a><h6>Example&nbsp;30-36 Cleaning Up Closed <tt>not_terminated</tt> Audit Files</h6><p>In the following example, <tt>not_terminated</tt> files are found, renamed, then the originals are
removed.</p><pre><tt><b>ls -R1t */files/* | grep not_terminated</b></tt>
&hellip;/egret.1/20030908162220.not_terminated.egret
&hellip;/egret.1/20030827215359.not_terminated.egret
# <tt><b>cd */files/egret.1</b></tt>
# <tt><b>auditreduce -O egret 20030908162220.not_terminated.egret</b></tt>
# <tt><b>ls -1t</b></tt>
20030908162220.not_terminated.egret Current audit file
20030827230920.20030830000909.egret Input (old) audit file
20030827215359.not_terminated.egret
# <tt><b>rm 20030827215359.not_terminated.egret</b></tt>
# <tt><b>ls -1t</b></tt>
20030908162220.not_terminated.egret Current audit file
20030827230920.20030830000909.egret Cleaned up audit file</pre><p>The start timestamp on the new file reflects the time of the
first audit event in the <tt>not_terminated</tt> file. The end timestamp reflects the time of
the last audit event in the file.</p>

<a name="audittask-83"></a><h4>How to Prevent Audit Trail Overflow</h4><a name="indexterm-3405"></a><a name="indexterm-3406"></a><a name="indexterm-3407"></a><a name="indexterm-3408"></a><a name="indexterm-3409"></a><a name="indexterm-3410"></a><a name="indexterm-3411"></a><a name="indexterm-3412"></a><a name="indexterm-3413"></a><a name="indexterm-3414"></a><p>If your security policy requires that all audit data be saved, do
the following:</p><ol>
<li><b>Set up a schedule to regularly archive audit files.</b><p>Archive audit files by backing up the files to offline media. You can
also move the files to an archive file system.</p><p><a name="indexterm-3415"></a>If you are collecting text audit logs with the <tt>syslog</tt> utility, archive the
text logs. For more information, see the <a href="http://docs.sun.com/doc/819-2240/logadm-1m?a=view"><tt>logadm</tt>(1M)</a> man page.</p></li>
<li><b><a name="indexterm-3416"></a>Set up a schedule to delete the archived audit files from the audit
file system.</b></li>
<li><b>Save and store auxiliary information.</b><p>Archive information that is necessary to interpret audit records along with the audit
trail.</p></li>
<li><b>Keep records of which audit files have been archived.</b></li>
<li><b>Store the archived media appropriately.</b></li>
<li><b>Reduce the volume of audit data that you store by creating summary files.</b><p>You can extract summary files from the audit trail by using options to
the <tt>auditreduce</tt> command. The summary files contain only records for specified types of
audit events. To extract summary files, see <a href="#audittask-72">Example&nbsp;30-28</a> and <a href="#audittask-88">Example&nbsp;30-32</a>.</p></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="audittask-91.html">Previous</a>
             </td>
             <td align="right">
                 <a href="auditref-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

