<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Configuring Solaris Secure Shell - System Administration Guide: Security Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Security Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="sshuser-24.html">Previous</a>
             </td>
             <td align="right">
                 <a href="sshuser-14.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="oview-1.html">Part&nbsp;I&nbsp;Security Overview</a></p>
<p class="toc level2"><a href="secov-1.html">1.&nbsp;&nbsp;Security Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="sectm-1.html">Part&nbsp;II&nbsp;System, File, and Device Security</a></p>
<p class="toc level2"><a href="concept-1.html">2.&nbsp;&nbsp;Managing Machine Security (Overview)</a></p>
<p class="toc level2"><a href="secsys-1.html">3.&nbsp;&nbsp;Controlling Access to Systems (Tasks)</a></p>
<p class="toc level2"><a href="vscan-1.html">4.&nbsp;&nbsp;Virus Scanning Service (Tasks)</a></p>
<p class="toc level2"><a href="devtask-1.html">5.&nbsp;&nbsp;Controlling Access to Devices (Tasks)</a></p>
<p class="toc level2"><a href="bart-1.html">6.&nbsp;&nbsp;Using the Basic Audit Reporting Tool (Tasks)</a></p>
<p class="toc level2"><a href="secfile-1.html">7.&nbsp;&nbsp;Controlling Access to Files (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="prbactm-1.html">Part&nbsp;III&nbsp;Roles, Rights Profiles, and Privileges</a></p>
<p class="toc level2"><a href="prbac-1.html">8.&nbsp;&nbsp;Using Roles and Privileges (Overview)</a></p>
<p class="toc level2"><a href="rbactask-1.html">9.&nbsp;&nbsp;Using Role-Based Access Control (Tasks)</a></p>
<p class="toc level2"><a href="rbacref-1.html">10.&nbsp;&nbsp;Role-Based Access Control (Reference)</a></p>
<p class="toc level2"><a href="privtask-1.html">11.&nbsp;&nbsp;Privileges (Tasks)</a></p>
<p class="toc level2"><a href="privref-1.html">12.&nbsp;&nbsp;Privileges (Reference)</a></p>
<p class="toc level1 tocsp"><a href="scftm-1.html">Part&nbsp;IV&nbsp;Solaris Cryptographic Services</a></p>
<p class="toc level2"><a href="scf-1.html">13.&nbsp;&nbsp;Solaris Cryptographic Framework (Overview)</a></p>
<p class="toc level2"><a href="scftask-1.html">14.&nbsp;&nbsp;Solaris Cryptographic Framework (Tasks)</a></p>
<p class="toc level2"><a href="kmf-1.html">15.&nbsp;&nbsp;Solaris Key Management Framework</a></p>
<p class="toc level1 tocsp"><a href="authtm-1.html">Part&nbsp;V&nbsp;Authentication Services and Secure Communication</a></p>
<p class="toc level2"><a href="auth-1.html">16.&nbsp;&nbsp;Using Authentication Services (Tasks)</a></p>
<p class="toc level2"><a href="pam-1.html">17.&nbsp;&nbsp;Using PAM</a></p>
<p class="toc level2"><a href="sasl-1.html">18.&nbsp;&nbsp;Using SASL</a></p>
<p class="toc level2"><a href="sshuser-1.html">19.&nbsp;&nbsp;Using Solaris Secure Shell (Tasks)</a></p>
<p class="toc level3"><a href="sshuser-2.html">Solaris Secure Shell (Overview)</a></p>
<p class="toc level3"><a href="sshuser-6.html">Solaris Secure Shell Enhancements in the Solaris 10 Release</a></p>
<p class="toc level3"><a href="sshuser-20.html">Solaris Secure Shell (Task Map)</a></p>
<p class="toc level3"><a href="sshuser-24.html">Configuring Solaris Secure Shell (Task Map)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Configuring Solaris Secure Shell</a></p>
</div>
<p class="toc level3"><a href="sshuser-14.html">Using Solaris Secure Shell (Task Map)</a></p>
<p class="toc level3"><a href="sshuser-15.html">Using Solaris Secure Shell</a></p>
<p class="toc level2 tocsp"><a href="sshref-1.html">20.&nbsp;&nbsp;Solaris Secure Shell (Reference)</a></p>
<p class="toc level1 tocsp"><a href="seamtm-1.html">Part&nbsp;VI&nbsp;Kerberos Service</a></p>
<p class="toc level2"><a href="intro-1.html">21.&nbsp;&nbsp;Introduction to the Kerberos Service</a></p>
<p class="toc level2"><a href="seamplan-1.html">22.&nbsp;&nbsp;Planning for the Kerberos Service</a></p>
<p class="toc level2"><a href="setup-8.html">23.&nbsp;&nbsp;Configuring the Kerberos Service (Tasks)</a></p>
<p class="toc level2"><a href="trouble-1.html">24.&nbsp;&nbsp;Kerberos Error Messages and Troubleshooting</a></p>
<p class="toc level2"><a href="aadmin-1.html">25.&nbsp;&nbsp;Administering Kerberos Principals and Policies (Tasks)</a></p>
<p class="toc level2"><a href="user-7.html">26.&nbsp;&nbsp;Using Kerberos Applications (Tasks)</a></p>
<p class="toc level2"><a href="refer-1.html">27.&nbsp;&nbsp;The Kerberos Service (Reference)</a></p>
<p class="toc level1 tocsp"><a href="audittm-1.html">Part&nbsp;VII&nbsp;Solaris Auditing</a></p>
<p class="toc level2"><a href="auditov-1.html">28.&nbsp;&nbsp;Solaris Auditing (Overview)</a></p>
<p class="toc level2"><a href="auditplan-1.html">29.&nbsp;&nbsp;Planning for Solaris Auditing</a></p>
<p class="toc level2"><a href="audittask-1.html">30.&nbsp;&nbsp;Managing Solaris Auditing (Tasks)</a></p>
<p class="toc level2"><a href="auditref-1.html">31.&nbsp;&nbsp;Solaris Auditing (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-2.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="sshuser-8"></a><h3>Configuring Solaris Secure Shell</h3>
<p>By default, host-based authentication and the use of both protocols are not enabled
in Solaris Secure Shell. Changing these defaults requires administrative intervention. Also, for port
forwarding to work requires administrative intervention.</p>

<a name="sshuser-12"></a><h4>How to Set Up Host-Based Authentication for Solaris Secure Shell</h4><a name="indexterm-2040"></a><a name="indexterm-2041"></a><a name="indexterm-2042"></a><p>The following procedure sets up a public key system where the client's public
key is used for authentication on the server. The user must also
create a public/private key pair.</p><p>In the procedure, the terms <b>client</b> and <b>local host</b> refer to the machine
where a user types the <tt>ssh</tt> command. The terms <b>server</b> and <b>remote host</b> refer to
the machine that the client is trying to reach.</p><ol>
<li><b>Assume the Primary Administrator role, or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role
and assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><b>On the client, enable host-based authentication.</b><p>In the client configuration file, <tt>/etc/ssh/ssh_config</tt>, type the following entry:</p><pre>HostbasedAuthentication yes</pre></li>
<li><b>On the server, enable host-based authentication.</b><p>In the server configuration file, <tt>/etc/ssh/sshd_config</tt>, type the same entry:</p><pre>HostbasedAuthentication yes</pre></li>
<li><b>On the server, configure a file that enables the client to be recognized
as a trusted host.</b><p>For more information, see the <tt>FILES</tt> section of the <a href="http://docs.sun.com/doc/819-2240/sshd-1m?a=view"><tt>sshd</tt>(1M)</a> man page.</p><ul>
<li><b>Add the client as an entry to the server's <tt>/etc/ssh/shosts.equiv</tt> file.</b><pre><i>client-host</i></pre></li>
<li><b>Or, you can instruct users to add an entry for the client
to their <tt>~/.shosts</tt> file on the server.</b><pre><i>client-host</i></pre></li></ul></li>
<li><b>On the server, ensure that the <tt>sshd</tt> daemon can access the list of
trusted hosts.</b><p>Set <tt>IgnoreRhosts</tt> to <tt>no</tt> in the <tt>/etc/ssh/sshd_config</tt> file.</p><pre># sshd_config
IgnoreRhosts no</pre></li>
<li><b>Ensure that users of Solaris Secure Shell at your site have accounts
on both hosts.</b></li>
<li><b>Do one of the following to put the client's public key on
the server.</b><ul>
<li><b>Modify the <tt>sshd_config</tt> file on the server, then instruct your users to add
the client's public host keys to their <tt>~/.ssh/known_hosts</tt> file.</b><pre># sshd_config
IgnoreUserKnownHosts no</pre><p>For user instructions, see <a href="sshuser-15.html#sshuser-33">How to Generate a Public/Private Key Pair for Use With Solaris Secure Shell</a>.</p></li>
<li><b>Copy the client's public key to the server.</b><p>The host keys are stored in the <tt>/etc/ssh</tt> directory. The keys are typically generated
by the <tt>sshd</tt> daemon on first boot.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>Add the key to the <tt>/etc/ssh/ssh_known_hosts</tt> file on the server.</b><p>On the client, type the command on one line with no backslash.</p><pre># <tt><b>cat /etc/ssh/ssh_host_dsa_key.pub | ssh</b></tt> <i>RemoteHost</i> <tt><b>\</b></tt>
<tt><b>'cat &gt;&gt; /etc/ssh/ssh_known_hosts &amp;&amp; echo "Host key copied"'</b></tt></pre></li>
<li><b>When you are prompted, supply your login password.</b><p>When the file is copied, the message &ldquo;Host key copied&rdquo; is displayed.</p><p>Each line in the <tt>/etc/ssh/ssh_known_hosts</tt> file consists of fields that are separated by
spaces:</p><pre><i>hostnames algorithm-name publickey comment</i></pre></li>
<li><b>Edit the <tt>/etc/ssh/ssh_known_hosts</tt> file and add <i>RemoteHost</i> as the first field in the
copied entry.</b><pre>## /etc/ssh/ssh_known_hosts File
<i>RemoteHost</i> <i>&lt;copied entry&gt;</i></pre></li></ol></li></ul></li></ol><a name="sshuser-29"></a><h6>Example&nbsp;19-1 Setting Up Host-based Authentication</h6><p>In the following example, each host is configured as a server and
as a client. A user on either host can initiate an <tt>ssh</tt> connection to
the other host. The following configuration makes each host a server and a
client:</p>
<ul><li><p>On each host, the Solaris Secure Shell configuration files contain the following entries:</p><pre># /etc/ssh/ssh_config
HostBasedAuthentication yes
# 
# /etc/ssh/sshd_config
HostBasedAuthentication yes
IgnoreRhosts no</pre></li>
<li><p>On each host, the <tt>shosts.equiv</tt> file contains an entry for the other host:</p><pre># /etc/ssh/shosts.equiv on machine2
machine1</pre><pre># /etc/ssh/shosts.equiv on machine1
machine2</pre></li>
<li><p>The public key for each host is in the <tt>/etc/ssh/ssh_known_hosts</tt> file on the other host:</p><pre># /etc/ssh/ssh_known_hosts on machine2
&hellip; machine1</pre><pre># /etc/ssh/ssh_known_hosts on machine1
&hellip; machine2</pre></li>
<li><p>Users have an account on both hosts:</p><pre># /etc/passwd on machine1
jdoe:x:3111:10:J Doe:/home/jdoe:/bin/sh</pre><pre># /etc/passwd on machine2
jdoe:x:3111:10:J Doe:/home/jdoe:/bin/sh</pre></li></ul>


<a name="sshuser-22"></a><h4>How to Enable Solaris Secure Shell v1</h4><p>This procedure is useful when a host interoperates with hosts that run v1
and v2.</p><ol>
<li><b>Assume the Primary Administrator role, or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role
and assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><b>Configure the host to use both Solaris Secure Shell protocols.</b><p>Edit the <tt>/etc/ssh/sshd_config</tt> file.</p><pre># Protocol 2
Protocol 2,1</pre></li>
<li><b>Provide a separate file for the host key for v1.</b><p>Add a <tt>HostKey</tt> entry to the <tt>/etc/ssh/sshd_config</tt> file.</p><pre>HostKey /etc/ssh/ssh_host_rsa_key
HostKey /etc/ssh/ssh_host_dsa_key
<tt><b>HostKey /etc/ssh/ssh_host_rsa1_key</b></tt></pre></li>
<li><b>Generate a host key for v1.</b><pre># <tt><b>ssh-keygen -t rsa1 -f /etc/ssh/ssh_host_rsa1_key -N ''</b></tt></pre><dl><dt><tt>-t rsa1</tt></dt>
<dd><p>Indicates the RSA algorithm for v1.</p></dd>
<dt><tt>-f</tt></dt>
<dd><p>Indicates the file that holds the host key.</p></dd>
<dt><tt>-N ''</tt></dt>
<dd><p>Indicates that no passphrase is required.</p></dd>
</dl>
</li>
<li><b>Restart the <tt>sshd</tt> daemon.</b><pre># <tt><b>svcadm restart network/ssh:default</b></tt></pre><p>You can also reboot the system.</p></li></ol>

<a name="sshuser-30"></a><h4>How to Configure Port Forwarding in Solaris Secure Shell</h4><a name="indexterm-2043"></a><a name="indexterm-2044"></a><a name="indexterm-2045"></a><p>Port forwarding enables a local port be forwarded to a remote host. Effectively,
a socket is allocated to listen to the port on the local
side. Similarly, a port can be specified on the remote side.</p>
<hr><p><b>Note - </b><a name="indexterm-2046"></a><a name="indexterm-2047"></a><a name="indexterm-2048"></a><a name="indexterm-2049"></a>Solaris Secure Shell port forwarding must use TCP connections. Solaris Secure Shell does
not support UDP connections for port forwarding.</p>
<hr>
<ol>
<li><b>Assume the Primary Administrator role, or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role
and assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><b>Configure a Solaris Secure Shell setting on the remote server to allow
port forwarding.</b><p><a name="indexterm-2050"></a>Change the value of <tt>AllowTcpForwarding</tt> to <tt>yes</tt> in the <tt>/etc/ssh/sshd_config</tt> file.</p><pre># Port forwarding
AllowTcpForwarding yes</pre></li>
<li><b><a name="indexterm-2051"></a><a name="indexterm-2052"></a><a name="indexterm-2053"></a><a name="indexterm-2054"></a>Restart the Solaris Secure Shell service.</b><pre>remoteHost# <tt><b>svcadm restart network/ssh:default</b></tt></pre><p>For information on managing persistent services, see <a href="http://docs.sun.com/doc/819-2379/hbrunlevels-25516?a=view">Chapter 15, Managing Services (Overview), in <i>System Administration Guide: Basic Administration</i></a> and the <a href="http://docs.sun.com/doc/819-2240/svcadm-1m?a=view"><tt>svcadm</tt>(1M)</a> man page.</p></li>
<li><b>Verify that port forwarding can be used.</b><pre>remoteHost# <tt><b>/usr/bin/pgrep -lf sshd</b></tt>
 1296 ssh -L 2001:remoteHost:23 remoteHost</pre></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="sshuser-24.html">Previous</a>
             </td>
             <td align="right">
                 <a href="sshuser-14.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

