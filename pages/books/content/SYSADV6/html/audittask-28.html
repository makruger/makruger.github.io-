<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Configuring and Enabling the Auditing Service (Tasks) - System Administration Guide: Security Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Security Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="audittask-4.html">Previous</a>
             </td>
             <td align="right">
                 <a href="audittask-26.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="oview-1.html">Part&nbsp;I&nbsp;Security Overview</a></p>
<p class="toc level2"><a href="secov-1.html">1.&nbsp;&nbsp;Security Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="sectm-1.html">Part&nbsp;II&nbsp;System, File, and Device Security</a></p>
<p class="toc level2"><a href="concept-1.html">2.&nbsp;&nbsp;Managing Machine Security (Overview)</a></p>
<p class="toc level2"><a href="secsys-1.html">3.&nbsp;&nbsp;Controlling Access to Systems (Tasks)</a></p>
<p class="toc level2"><a href="vscan-1.html">4.&nbsp;&nbsp;Virus Scanning Service (Tasks)</a></p>
<p class="toc level2"><a href="devtask-1.html">5.&nbsp;&nbsp;Controlling Access to Devices (Tasks)</a></p>
<p class="toc level2"><a href="bart-1.html">6.&nbsp;&nbsp;Using the Basic Audit Reporting Tool (Tasks)</a></p>
<p class="toc level2"><a href="secfile-1.html">7.&nbsp;&nbsp;Controlling Access to Files (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="prbactm-1.html">Part&nbsp;III&nbsp;Roles, Rights Profiles, and Privileges</a></p>
<p class="toc level2"><a href="prbac-1.html">8.&nbsp;&nbsp;Using Roles and Privileges (Overview)</a></p>
<p class="toc level2"><a href="rbactask-1.html">9.&nbsp;&nbsp;Using Role-Based Access Control (Tasks)</a></p>
<p class="toc level2"><a href="rbacref-1.html">10.&nbsp;&nbsp;Role-Based Access Control (Reference)</a></p>
<p class="toc level2"><a href="privtask-1.html">11.&nbsp;&nbsp;Privileges (Tasks)</a></p>
<p class="toc level2"><a href="privref-1.html">12.&nbsp;&nbsp;Privileges (Reference)</a></p>
<p class="toc level1 tocsp"><a href="scftm-1.html">Part&nbsp;IV&nbsp;Solaris Cryptographic Services</a></p>
<p class="toc level2"><a href="scf-1.html">13.&nbsp;&nbsp;Solaris Cryptographic Framework (Overview)</a></p>
<p class="toc level2"><a href="scftask-1.html">14.&nbsp;&nbsp;Solaris Cryptographic Framework (Tasks)</a></p>
<p class="toc level2"><a href="kmf-1.html">15.&nbsp;&nbsp;Solaris Key Management Framework</a></p>
<p class="toc level1 tocsp"><a href="authtm-1.html">Part&nbsp;V&nbsp;Authentication Services and Secure Communication</a></p>
<p class="toc level2"><a href="auth-1.html">16.&nbsp;&nbsp;Using Authentication Services (Tasks)</a></p>
<p class="toc level2"><a href="pam-1.html">17.&nbsp;&nbsp;Using PAM</a></p>
<p class="toc level2"><a href="sasl-1.html">18.&nbsp;&nbsp;Using SASL</a></p>
<p class="toc level2"><a href="sshuser-1.html">19.&nbsp;&nbsp;Using Solaris Secure Shell (Tasks)</a></p>
<p class="toc level2"><a href="sshref-1.html">20.&nbsp;&nbsp;Solaris Secure Shell (Reference)</a></p>
<p class="toc level1 tocsp"><a href="seamtm-1.html">Part&nbsp;VI&nbsp;Kerberos Service</a></p>
<p class="toc level2"><a href="intro-1.html">21.&nbsp;&nbsp;Introduction to the Kerberos Service</a></p>
<p class="toc level2"><a href="seamplan-1.html">22.&nbsp;&nbsp;Planning for the Kerberos Service</a></p>
<p class="toc level2"><a href="setup-8.html">23.&nbsp;&nbsp;Configuring the Kerberos Service (Tasks)</a></p>
<p class="toc level2"><a href="trouble-1.html">24.&nbsp;&nbsp;Kerberos Error Messages and Troubleshooting</a></p>
<p class="toc level2"><a href="aadmin-1.html">25.&nbsp;&nbsp;Administering Kerberos Principals and Policies (Tasks)</a></p>
<p class="toc level2"><a href="user-7.html">26.&nbsp;&nbsp;Using Kerberos Applications (Tasks)</a></p>
<p class="toc level2"><a href="refer-1.html">27.&nbsp;&nbsp;The Kerberos Service (Reference)</a></p>
<p class="toc level1 tocsp"><a href="audittm-1.html">Part&nbsp;VII&nbsp;Solaris Auditing</a></p>
<p class="toc level2"><a href="auditov-1.html">28.&nbsp;&nbsp;Solaris Auditing (Overview)</a></p>
<p class="toc level2"><a href="auditplan-1.html">29.&nbsp;&nbsp;Planning for Solaris Auditing</a></p>
<p class="toc level2"><a href="audittask-1.html">30.&nbsp;&nbsp;Managing Solaris Auditing (Tasks)</a></p>
<p class="toc level3"><a href="audittask-3.html">Solaris Auditing (Task Map)</a></p>
<p class="toc level3"><a href="audittask-15.html">Configuring Audit Files (Task Map)</a></p>
<p class="toc level3"><a href="audittask-44.html">Configuring Audit Files (Tasks)</a></p>
<p class="toc level3"><a href="audittask-4.html">Configuring and Enabling the Auditing Service (Task Map)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Configuring and Enabling the Auditing Service (Tasks)</a></p>
</div>
<p class="toc level3"><a href="audittask-26.html">Configuring the Auditing Service in Zones (Tasks)</a></p>
<p class="toc level3"><a href="audittask-91.html">Managing Audit Records (Task Map)</a></p>
<p class="toc level3"><a href="audittask-21.html">Managing Audit Records</a></p>
<p class="toc level2 tocsp"><a href="auditref-1.html">31.&nbsp;&nbsp;Solaris Auditing (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-2.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="audittask-28"></a><h3>Configuring and Enabling the Auditing Service (Tasks)</h3>
<p>After the configuration files have been set up for your site, you need
to set up disk space for your audit files. You also need
to set up other attributes of the auditing service, and then enable the
service. This section also contains procedures to refresh the auditing service when you change
configuration settings.</p><p>When a non-global zone is installed, you can choose to audit the
zone exactly as the global zone is being audited. Alternatively, to audit the
non-global zone individually, you can modify the audit configuration files in the non-global zone.
To customize audit configuration files, see <a href="audittask-15.html">Configuring Audit Files (Task Map)</a>.</p>

<a name="audittask-8"></a><h4>How to Create Partitions for Audit Files</h4><a name="indexterm-3268"></a><a name="indexterm-3269"></a><a name="indexterm-3270"></a><a name="indexterm-3271"></a><a name="indexterm-3272"></a><a name="indexterm-3273"></a><p>The following procedure shows how to create partitions for audit files, as well
as the corresponding file systems and directories. Skip steps as necessary, depending on
if you already have an empty partition, or if you have already mounted
an empty file system.</p><ol>
<li><b>Assume the Primary Administrator role, or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role
and assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><b>Determine the amount of disk space that is required.</b><p>Assign at least 200 Mbytes of disk space per host. However, how much
auditing you require dictates the disk space requirements. So, your disk space requirements might
be far greater than this figure. Remember to include a local partition for
a directory of last resort.</p></li>
<li><b>Create dedicated audit partitions, as needed.</b><p>This step is most easily done during server installation. You can also create
the partitions on disks that have not yet been mounted on the server.
For complete instructions on how to create the partitions, see <a href="http://docs.sun.com/doc/819-2723/disksprep-31030?a=view">Chapter 11, Administering Disks (Tasks), in <i>System Administration Guide: Devices and File Systems</i></a>.</p><pre># newfs /dev/rdsk/c<i>w</i>t<i>x</i>d<i>y</i>s<i>z</i></pre><p>where <tt>/dev/rdsk/c</tt><i>w</i><tt>t</tt><i>x</i><tt>d</tt><i>y</i><tt>s</tt><i>z</i> is the raw device name for the partition.</p><p>If the local host is to be audited, also create an audit
directory of last resort for the local host.</p></li>
<li><b>Create mount points for each new partition.</b><pre># mkdir /var/audit/<i>server-name</i>.<i>n</i></pre><p>where <i>server-name</i>.<i>n</i> is the name of the server plus a number that identifies
each partition. The number is optional, but the number is useful when there
are many audit directories.</p></li>
<li><b>Add entries to automatically mount the new partitions.</b><p>Add a line to the <tt>/etc/vfstab</tt> file that resembles the following:</p><pre>/dev/dsk/c<i>w</i>t<i>x</i>d<i>y</i>s<i>z</i> /dev/rdsk/c<i>w</i>t<i>x</i>d<i>y</i>s<i>z</i> /var/audit/<i>server-name</i>.<i>n</i>   ufs  2  yes</pre></li>
<li><a name="audittask-stepopt-2"></a>(Optional) <b>Remove the minimum free space threshold on each partition.</b><p>If you use the default configuration, a warning is generated when the directory
is 80 percent full. The warning removes the reason to reserve free space
on the partition.</p><pre># tunefs -m 0 /var/audit/<i>server-name</i>.<i>n</i></pre></li>
<li><b>Mount the new audit partitions.</b><pre># mount /var/audit/<i>server-name</i>.<i>n</i></pre></li>
<li><b>Create audit directories on the new partitions.</b><pre># mkdir /var/audit/<i>server-name</i>.<i>n</i>/files</pre></li>
<li><b>Correct the permissions on the mount points and new directories.</b><pre># chmod -R 750 /var/audit/<i>server-name</i>.<i>n</i>/files</pre></li>
<li><a name="audittask-stepopt-7"></a><b>On a file server, define the file systems to be made available to
other hosts.</b><p>Often, disk farms are installed to store the audit records. If an audit
directory is to be used by several systems, then the directory must be
shared through the NFS service. Add an entry that resembles the following for
each directory to the <tt>/etc/dfs/dfstab</tt> file:</p><pre>share -F nfs /var/audit/<i>server-name</i>.<i>n</i>/files</pre></li>
<li><a name="audittask-stepopt-8"></a><b>On a file server, restart the NFS service.</b><p><a name="indexterm-3274"></a>If this command is the first <tt>share</tt> command or set of <tt>share</tt> commands
that you have initiated, the NFS daemons might not be running.</p><ul>
<li><b>If the NFS service is offline, enable the service.</b><pre>% <tt><b>svcs \*nfs\*</b></tt>
disabled       Nov_02   svc:/network/nfs/rquota:default
offline        Nov_02   svc:/network/nfs/server:default
# <tt><b>svcadm enable network/nfs/server</b></tt></pre></li>
<li><b>If the NFS service is running, restart the service.</b><pre>% <tt><b>svcs \*nfs\*</b></tt>
online         Nov_02   svc:/network/nfs/client:default
online         Nov_02   svc:/network/nfs/server:default
# <tt><b>svcadm restart network/nfs/server</b></tt></pre></li></ul><p>For more information about the NFS service, refer to <a href="http://docs.sun.com/doc/819-1634/rfsadmin-68?a=view">Setting Up NFS Services in <i>System Administration Guide: Network Services</i></a>. For information
on managing persistent services, see <a href="http://docs.sun.com/doc/819-2379/hbrunlevels-25516?a=view">Chapter 15, Managing Services (Overview), in <i>System Administration Guide: Basic Administration</i></a> and the <a href="http://docs.sun.com/doc/819-2252/smf-5?a=view"><tt>smf</tt>(5)</a> man page.</p></li></ol><a name="audittask-76"></a><h6>Example&nbsp;30-12 Creating an Audit Directory of Last Resort</h6><a name="indexterm-3275"></a><p>All systems that run the auditing service should have a local file
system that can be used if no other file system is available. In
this example, a file system is being added to a system that is
named <tt>egret</tt>. Because this file system is only used locally, none of the
steps for a file server are necessary.</p><pre># <tt><b>newfs /dev/rdsk/c0t2d0</b></tt>
# <tt><b>mkdir /var/audit/egret</b></tt>
# <tt><b>grep egret /etc/vfstab</b></tt>
/dev/dsk/c0t2d0s1  /dev/rdsk/c0t2d0s1  /var/audit/egret ufs  2  yes  -
# <tt><b>tunefs -m 0 /var/audit/egret</b></tt>
# <tt><b>mount /var/audit/egret</b></tt>
# <tt><b>mkdir /var/audit/egret/files</b></tt>
# <tt><b>chmod -R 750 /var/audit/egret/files</b></tt></pre><a name="audittask-77"></a><h6>Example&nbsp;30-13 Creating New Audit Partitions</h6><p>In this example, a new file system is created on two new
disks that are to be used by other systems in the network.</p><pre># <tt><b>newfs /dev/rdsk/c0t2d0</b></tt>
# <tt><b>newfs /dev/rdsk/c0t2d1</b></tt>
# <tt><b>mkdir /var/audit/egret.1</b></tt>
# <tt><b>mkdir /var/audit/egret.2</b></tt>
# <tt><b>grep egret /etc/vfstab</b></tt>
/dev/dsk/c0t2d0s1  /dev/rdsk/c0t2d0s1  /var/audit/egret.1 ufs  2  yes  -
/dev/dsk/c0t2d1s1  /dev/rdsk/c0t2d1s1  /var/audit/egret.2 ufs  2  yes  -
# <tt><b>tunefs -m 0 /var/audit/egret.1</b></tt>
# <tt><b>tunefs -m 0 /var/audit/egret.2</b></tt>
# <tt><b>mount /var/audit/egret.1</b></tt>
# <tt><b>mount /var/audit/egret.2</b></tt>
# <tt><b>mkdir /var/audit/egret.1/files</b></tt>
# <tt><b>mkdir /var/audit/egret.2/files</b></tt>
# <tt><b>chmod -R 750 /var/audit/egret.1/files /var/audit/egret.2/files</b></tt>
# <tt><b>grep egret /etc/dfs/dfstab</b></tt>
 share -F nfs /var/audit/egret.1/files
 share -F nfs /var/audit/egret.2/files
# <tt><b>svcadm enable network/nfs/server</b></tt></pre>

<a name="audittask-16"></a><h4>How to Configure the <tt>audit_warn</tt> Email Alias</h4><a name="indexterm-3276"></a><a name="indexterm-3277"></a><p>The <tt>audit_warn</tt> script generates mail to an email alias that is called <tt>audit_warn</tt>.
To send this mail to a valid email address, you can follow one
of the options that are described in <a href="#audittask-step-6">Step&nbsp;2</a>:</p><ol>
<li><b>Assume the Primary Administrator role, or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role
and assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><a name="audittask-step-6"></a><b>Configure the <tt>audit_warn</tt> email alias.</b><p>Choose one of the following options:</p>
<ul><li><p><b>OPTION 1 &ndash;</b> Replace the <tt>audit_warn</tt> email alias with another email account in the <tt>audit_warn</tt> script.</p><p>Change the email alias in the following line of the script:</p><pre>ADDRESS=<tt><b>audit_warn</b></tt>            # standard alias for audit alerts</pre></li>
<li><p><b>OPTION 2 &ndash;</b> Redirect the <tt>audit_warn</tt> email to another mail account.</p><p>In this case, you would add the <tt>audit_warn</tt> email alias to the appropriate mail aliases file. You could add the alias to the local <tt>/etc/mail/aliases</tt> file or to the <tt>mail_aliases</tt> database in the name space. The new entry would resemble the following if the <tt>root</tt> mail account was made a member of the <tt>audit_warn</tt> email alias:</p><pre>audit_warn: root</pre></li></ul>
</li></ol>

<a name="audittask-18"></a><h4>How to Configure Audit Policy</h4><a name="indexterm-3278"></a><a name="indexterm-3279"></a><a name="indexterm-3280"></a><a name="indexterm-3281"></a><a name="indexterm-3282"></a><a name="indexterm-3283"></a><p>Audit policy determines the characteristics of the audit records for the local host.
When auditing is enabled, the contents of the <tt>/etc/security/audit_startup</tt> file determine the
audit policy.</p><p>You can inspect, enable, or disable the current audit policy options with the
the <tt>auditconfig</tt> command. You can also modify the policy options to the <tt>auditconfig</tt>
command in the <tt>audit_startup</tt> script to make permanent audit policy changes.</p><ol>
<li><b>Assume a role that includes the Audit Control profile, or become superuser.</b><p>To create a role that includes the Audit Control profile and to assign
the role to a user, see <a href="rbactask-15.html">Configuring RBAC (Task Map)</a>.</p></li>
<li><a name="audittask-stepopt-10"></a><b><a name="indexterm-3284"></a>Review the audit policy.</b><p>Before auditing is enabled, the contents of the <tt>audit_startup</tt> file determine the audit
policy:</p><pre>#! /bin/sh
...
/usr/bin/echo "Starting BSM services."
/usr/sbin/auditconfig -setpolicy +cnt Counts rather than drops records
/usr/sbin/auditconfig -conf  Configures event-class mappings
/usr/sbin/auditconfig -aconf Configures nonattributable events</pre></li>
<li><a name="audittask-step-policy-1"></a><b>View the available policy options.</b><pre>$ <tt><b>auditconfig -lspolicy</b></tt></pre>
<hr><p><b>Note - </b>The <tt>perzone</tt> and <tt>ahlt</tt> policy options can be set only in the global
zone.</p>
<hr>
</li>
<li><b>Enable or disable selected audit policy options.</b><pre># <tt><b>auditconfig -setpolicy </tt><i>prefix</i><tt></tt><i>policy</i><tt></b></tt></pre><dl><dt><i>prefix</i></dt>
<dd><p>A <i>prefix</i> value of <tt>+</tt> enables the policy option. A <i>prefix</i> value of <tt>-</tt> disables the policy option.</p></dd>
<dt><i>policy</i></dt>
<dd><p>Selects the policy to be enabled or to be disabled.</p></dd>
</dl>
<p>The policy is in effect until the next boot, or until the
policy is modified by the <tt>auditconfig -setpolicy</tt> command.</p><p>For a description of each policy option, see <a href="auditplan-5.html">Determining Audit Policy</a>.</p></li></ol><a name="audittask-90"></a><h6>Example&nbsp;30-14 Setting the <tt>cnt</tt> and <tt>ahlt</tt> Audit Policy Options</h6><a name="indexterm-3285"></a><a name="indexterm-3286"></a><a name="indexterm-3287"></a><a name="indexterm-3288"></a><a name="indexterm-3289"></a><p>In this example, the <tt>cnt</tt> policy is disabled and the <tt>ahlt</tt> policy
is enabled. With these settings, system use is halted when the audit partitions
are full. These settings are appropriate when security is more important than availability.
For restrictions on setting this policy, see <a href="#audittask-step-policy-1">Step&nbsp;3</a>.</p><p>The following <tt>audit_startup</tt> entries disable the <tt>cnt</tt> policy option and enable the
<tt>ahlt</tt> policy option across reboots:</p><pre># <tt><b>cat /etc/security/audit_startup</b></tt>
#!/bin/sh
/usr/bin/echo "Starting BSM services."
/usr/sbin/deallocate -Is
/usr/sbin/auditconfig -conf
/usr/sbin/auditconfig -aconf
/usr/sbin/auditconfig -setpolicy -cnt    
/usr/sbin/auditconfig -setpolicy +ahlt</pre><a name="audittask-93"></a><h6>Example&nbsp;30-15 Setting the <tt>seq</tt> Audit Policy Temporarily</h6><a name="indexterm-3290"></a><a name="indexterm-3291"></a><a name="indexterm-3292"></a><p>In this example, the <tt>auditd</tt> daemon is running and the <tt>ahlt</tt> audit policy
has been set. The <tt>seq</tt> audit policy is added to the current policy.
The <tt>seq</tt> policy adds a <tt>sequence</tt> token to every audit record. This is
useful for debugging the auditing service when audit records are corrupted, or when records
are being dropped.</p><p>The <tt>+</tt> prefix adds the <tt>seq</tt> option to the audit policy, rather than
replaces the current audit policy with <tt>seq</tt>. The <tt>auditconfig</tt> command puts the
policy in effect until the next invocation of the command, or until the
next boot.</p><pre>$ <tt><b>auditconfig -setpolicy +seq</b></tt>
$ <tt><b>auditconfig -getpolicy</b></tt>
audit policies = ahlt,seq    </pre><a name="audittask-32"></a><h6>Example&nbsp;30-16 Setting the <tt>perzone</tt> Audit Policy</h6><a name="indexterm-3293"></a><a name="indexterm-3294"></a><a name="indexterm-3295"></a><p>In this example, the <tt>perzone</tt> audit policy is set in the <tt>audit_startup</tt> script
in the global zone. When a zone boots, the non-global  zone collects
audit records according to the audit configuration settings in its zone.</p><pre>$ <tt><b>cat /etc/security/audit_startup</b></tt>
#!/bin/sh
/usr/bin/echo "Starting BSM services."
/usr/sbin/deallocate -Is
/usr/sbin/auditconfig -conf
/usr/sbin/auditconfig -aconf
/usr/sbin/auditconfig -setpolicy +perzone
/usr/sbin/auditconfig -setpolicy +cnt</pre><a name="audittask-78"></a><h6>Example&nbsp;30-17 Changing an Audit Policy</h6><p>In this example, the audit daemon is running and audit policy has
been set. The <tt>auditconfig</tt> command changes the <tt>ahlt</tt> and <tt>cnt</tt> policies for the
duration of the session. With these settings, audit records are dropped, but counted,
when the audit file system is full. For restrictions on setting the <tt>ahlt</tt>
policy, see <a href="#audittask-step-policy-1">Step&nbsp;3</a>.</p><pre>$ <tt><b>auditconfig -setpolicy +cnt</b></tt>
$ <tt><b>auditconfig -setpolicy -ahlt</b></tt>
$ <tt><b>auditconfig -getpolicy</b></tt>
audit policies = cnt,seq</pre><p>When the changes are put in the <tt>audit_startup</tt> file, the policies are permanently
in effect:</p><pre>$ <tt><b>cat /etc/security/audit_startup</b></tt>
#!/bin/sh
/usr/bin/echo "Starting BSM services."
/usr/sbin/deallocate -Is
/usr/sbin/auditconfig -conf
/usr/sbin/auditconfig -aconf
/usr/sbin/auditconfig -setpolicy +cnt</pre><p>The <tt>-ahlt</tt> option does not have to be specified in the file, because
the <tt>ahlt</tt> policy option is disabled by default. This setting is appropriate when
availability is more important than the security that audit records provide.</p>

<a name="audittask-62"></a><h4>How to Enable the Auditing Service</h4><a name="indexterm-3296"></a><a name="indexterm-3297"></a><a name="indexterm-3298"></a><a name="indexterm-3299"></a><a name="indexterm-3300"></a><a name="indexterm-3301"></a><p>This procedure enables the auditing service for all zones. To start the audit
daemon in a non-global zone, see <a href="#audittask-85">Example&nbsp;30-18</a>.</p><p>When auditing is configured securely, the system is in single-user mode until auditing
is enabled. You can also enable auditing in multiuser mode.</p><h6>Before You Begin</h6><p>You should perform this procedure as superuser after completing the following tasks:</p>
<ul><li><p>Planning &ndash; <a href="auditplan-11.html">Planning Solaris Auditing (Task Map)</a></p></li>
<li><p>Customizing audit files &ndash; <a href="audittask-15.html">Configuring Audit Files (Task Map)</a></p></li>
<li><p>Setting up audit partitions &ndash; <a href="#audittask-8">How to Create Partitions for Audit Files</a></p></li>
<li><p>Setting up audit warning messages &ndash; <a href="#audittask-16">How to Configure the <tt>audit_warn</tt> Email Alias</a></p></li>
<li><p>Setting audit policy &ndash; <a href="#audittask-18">How to Configure Audit Policy</a></p></li></ul>
<ol>
<li><b>Run the script that enables the auditing service.</b><p>Go to the <tt>/etc/security</tt> directory, and execute the <tt>bsmconv</tt> script there.</p><pre># <tt><b>cd /etc/security</b></tt>
# <tt><b>./bsmconv</b></tt>
This script is used to enable the Basic Security Module (BSM).
Shall we continue with the conversion now? [y/n] <tt><b>y</b></tt>
bsmconv: INFO: checking startup file.
bsmconv: INFO: turning on audit module.
bsmconv: INFO: initializing device allocation.

The Basic Security Module is ready.
If there were any errors, please fix them now.
Configure BSM by editing files located in /etc/security.
Reboot this system now to come up with BSM enabled.</pre><p>For the effects of the script, see the <a href="http://docs.sun.com/doc/819-2240/bsmconv-1m?a=view"><tt>bsmconv</tt>(1M)</a> man page.</p></li>
<li><b>Reboot the system.</b><pre># <tt><b>reboot</b></tt></pre><p>The startup file <tt>/etc/security/audit_startup</tt> causes the <tt>auditd</tt> daemon to run automatically when the
system enters multiuser mode.</p><p>Another effect of the script is to turn on device allocation. To
configure device allocation, see <a href="devtask-3.html">Managing Device Allocation (Task Map)</a>.</p></li></ol><a name="audittask-85"></a><h6>Example&nbsp;30-18 Enabling Auditing in a Non-Global Zone</h6><p>In the following example, the global zone administrator turned on <tt>perzone</tt> policy
after auditing was enabled in the global zone and after the non-global zone
had booted. The zone administrator of the non-global zone has configured the audit
files for the zone, and then starts the audit daemon in the zone.</p><pre>zone1# <tt><b>svcadm enable svc:/system/auditd</b></tt></pre>

<a name="audittask-31"></a><h4>How to Disable the Auditing Service</h4><a name="indexterm-3302"></a><a name="indexterm-3303"></a><a name="indexterm-3304"></a><p>If the auditing service is no longer required at some point, this
procedure returns the system to the system state before auditing was enabled. If
non-global zones are being audited, their auditing service is also disabled.</p>
<hr><p><b>Caution - </b><a name="indexterm-3305"></a><a name="indexterm-3306"></a>This command also disables device allocation. Do not run this command if you
want to be able to allocate devices. To disable auditing and retain device
allocation, see <a href="#audittask-67">Example&nbsp;30-19</a>.</p>
<hr>
<ol>
<li><b>Become superuser and bring the system into single-user mode.</b><pre>% <tt><b>su</b></tt>
Password: &lt;Type root password&gt;
# <tt><b>init S</b></tt></pre><p>For more information, see the <a href="http://docs.sun.com/doc/819-2240/init-1m?a=view"><tt>init</tt>(1M)</a> man page.</p></li>
<li><b>Run the script to disable auditing.</b><p>Change to the <tt>/etc/security</tt> directory, and execute the <tt>bsmunconv</tt> script.</p><pre># <tt><b>cd /etc/security</b></tt>
# <tt><b>./bsmunconv</b></tt></pre><p>Another effect of the script is to disable device allocation.</p><p>For information on the full effect of the <tt>bsmunconv</tt> script, see the <a href="http://docs.sun.com/doc/819-2240/bsmconv-1m?a=view"><tt>bsmconv</tt>(1M)</a>
man page.</p></li>
<li><b>Bring the system into multiuser mode.</b><pre># <tt><b>init 6</b></tt></pre></li></ol><a name="audittask-67"></a><h6>Example&nbsp;30-19 Disabling Auditing and Keeping Device Allocation</h6><p>In this example, the auditing service stops collecting records, but device allocation continues
to work. All values from the <tt>flags</tt>, <tt>naflags</tt>, and <tt>plugin</tt> entries in
the <tt>audit_control</tt> file are removed, as are all user entries in the
<tt>audit_user</tt> file. </p><pre># audit_control file
&hellip;
flags:
minfree:10
naflags:
plugin:

# audit_user file</pre><p>The <tt>auditd</tt> daemon runs, but no audit records are kept.</p><a name="audittask-87"></a><h6>Example&nbsp;30-20 Disabling Auditing on a Per-Zone Basis</h6><p>In this example, the auditing service stops running in the zone where the
auditing service is disabled. Device allocation continues to work. When this command is
run in the global zone, and the <tt>perzone</tt> audit policy is not set,
auditing is disabled for all zones, not just the global zone.</p><pre># svcadm disable svc:/system/auditd</pre>

<a name="audittask-30"></a><h4>How to Update the Auditing Service</h4><a name="indexterm-3307"></a><a name="indexterm-3308"></a><a name="indexterm-3309"></a><p><a name="indexterm-3310"></a><a name="indexterm-3311"></a>This procedure restarts the <tt>auditd</tt> daemon when you have made changes to audit configuration
files after the daemon has been running.</p><ol>
<li><b>Assume a role that includes the Audit Control rights profile, or become superuser.</b><p>To create a role that includes the Audit Control rights profile and assign
the role to a user, see <a href="rbactask-15.html">Configuring RBAC (Task Map)</a>.</p></li>
<li><b>Choose the appropriate command.</b><ul>
<li><b><a name="indexterm-3312"></a>If you modify the <tt>naflags</tt> line in the <tt>audit_control</tt> file, change the
kernel mask for nonattributable events.</b><pre>$ <tt><b>/usr/sbin/auditconfig -aconf</b></tt></pre><p>You can also reboot.</p></li>
<li><b><a name="indexterm-3313"></a><a name="indexterm-3314"></a><a name="indexterm-3315"></a><a name="indexterm-3316"></a>If you modify other lines in the <tt>audit_control</tt> file, reread the <tt>audit_control</tt> file.</b><p>The audit daemon stores information from the <tt>audit_control</tt> file internally. To use
the new information, either reboot the system or instruct the audit daemon to
read the modified file.</p><pre>$ <tt><b>/usr/sbin/audit -s</b></tt></pre>
<hr><p><b>Note - </b>Audit records are generated based on the audit preselection mask that is associated
with each process. Executing <tt>audit -s</tt> does <b>not</b> change the masks in existing
processes. To change the preselection mask for an existing process, you must restart
the process. You can also reboot.</p>
<hr>
<p>The <tt>audit -s</tt> command causes the audit daemon to re-read the <tt>directory</tt> and <tt>minfree</tt>
values from the <tt>audit_control</tt> file. The command changes the generation of the preselection mask
for processes spawned by subsequent logins.</p></li>
<li><b>If you modify the <tt>audit_event</tt> file or the <tt>audit_class</tt> file while the
audit daemon is running, refresh the auditing service.</b><p>Read the modified event-class mappings into the system, and ensure that each user
who uses the machine is correctly audited.</p><pre>$ <tt><b>auditconfig -conf</b></tt>
$ <tt><b>auditconfig -setumask</b></tt> <i>auid classes</i></pre><dl><dt><i>auid</i></dt>
<dd><p>Is the user ID.</p></dd>
<dt><i>classes</i></dt>
<dd><p>Are the preselected audit classes.</p></dd>
</dl>
</li>
<li><b>To change audit policy on a running system, see <a href="#audittask-93">Example&nbsp;30-15</a>.</b></li></ul></li></ol><a name="audittask-52"></a><h6>Example&nbsp;30-21 Restarting the Audit Daemon</h6><p><a name="indexterm-3317"></a>In this example, the system is brought down to single-user mode, then back
up to multiuser mode. When the system is brought into multiuser mode, modified
audit configuration files are read into the system.</p><pre># <tt><b>init S</b></tt>
# <tt><b>init 6</b></tt></pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="audittask-4.html">Previous</a>
             </td>
             <td align="right">
                 <a href="audittask-26.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

