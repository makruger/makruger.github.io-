<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Configuring RBAC - System Administration Guide: Security Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Security Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="rbactask-15.html">Previous</a>
             </td>
             <td align="right">
                 <a href="rbactask-40.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="oview-1.html">Part&nbsp;I&nbsp;Security Overview</a></p>
<p class="toc level2"><a href="secov-1.html">1.&nbsp;&nbsp;Security Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="sectm-1.html">Part&nbsp;II&nbsp;System, File, and Device Security</a></p>
<p class="toc level2"><a href="concept-1.html">2.&nbsp;&nbsp;Managing Machine Security (Overview)</a></p>
<p class="toc level2"><a href="secsys-1.html">3.&nbsp;&nbsp;Controlling Access to Systems (Tasks)</a></p>
<p class="toc level2"><a href="vscan-1.html">4.&nbsp;&nbsp;Virus Scanning Service (Tasks)</a></p>
<p class="toc level2"><a href="devtask-1.html">5.&nbsp;&nbsp;Controlling Access to Devices (Tasks)</a></p>
<p class="toc level2"><a href="bart-1.html">6.&nbsp;&nbsp;Using the Basic Audit Reporting Tool (Tasks)</a></p>
<p class="toc level2"><a href="secfile-1.html">7.&nbsp;&nbsp;Controlling Access to Files (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="prbactm-1.html">Part&nbsp;III&nbsp;Roles, Rights Profiles, and Privileges</a></p>
<p class="toc level2"><a href="prbac-1.html">8.&nbsp;&nbsp;Using Roles and Privileges (Overview)</a></p>
<p class="toc level2"><a href="rbactask-1.html">9.&nbsp;&nbsp;Using Role-Based Access Control (Tasks)</a></p>
<p class="toc level3"><a href="rbactask-14.html">Using RBAC (Task Map)</a></p>
<p class="toc level3"><a href="rbactask-15.html">Configuring RBAC (Task Map)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Configuring RBAC</a></p>
</div>
<p class="toc level3"><a href="rbactask-40.html">Using Roles (Task Map)</a></p>
<p class="toc level3"><a href="rbactask-42.html">Using Roles</a></p>
<p class="toc level3"><a href="rbactask-10.html">Managing RBAC (Task Map)</a></p>
<p class="toc level3"><a href="rbactask-4.html">Managing RBAC</a></p>
<p class="toc level2 tocsp"><a href="rbacref-1.html">10.&nbsp;&nbsp;Role-Based Access Control (Reference)</a></p>
<p class="toc level2"><a href="privtask-1.html">11.&nbsp;&nbsp;Privileges (Tasks)</a></p>
<p class="toc level2"><a href="privref-1.html">12.&nbsp;&nbsp;Privileges (Reference)</a></p>
<p class="toc level1 tocsp"><a href="scftm-1.html">Part&nbsp;IV&nbsp;Solaris Cryptographic Services</a></p>
<p class="toc level2"><a href="scf-1.html">13.&nbsp;&nbsp;Solaris Cryptographic Framework (Overview)</a></p>
<p class="toc level2"><a href="scftask-1.html">14.&nbsp;&nbsp;Solaris Cryptographic Framework (Tasks)</a></p>
<p class="toc level2"><a href="kmf-1.html">15.&nbsp;&nbsp;Solaris Key Management Framework</a></p>
<p class="toc level1 tocsp"><a href="authtm-1.html">Part&nbsp;V&nbsp;Authentication Services and Secure Communication</a></p>
<p class="toc level2"><a href="auth-1.html">16.&nbsp;&nbsp;Using Authentication Services (Tasks)</a></p>
<p class="toc level2"><a href="pam-1.html">17.&nbsp;&nbsp;Using PAM</a></p>
<p class="toc level2"><a href="sasl-1.html">18.&nbsp;&nbsp;Using SASL</a></p>
<p class="toc level2"><a href="sshuser-1.html">19.&nbsp;&nbsp;Using Solaris Secure Shell (Tasks)</a></p>
<p class="toc level2"><a href="sshref-1.html">20.&nbsp;&nbsp;Solaris Secure Shell (Reference)</a></p>
<p class="toc level1 tocsp"><a href="seamtm-1.html">Part&nbsp;VI&nbsp;Kerberos Service</a></p>
<p class="toc level2"><a href="intro-1.html">21.&nbsp;&nbsp;Introduction to the Kerberos Service</a></p>
<p class="toc level2"><a href="seamplan-1.html">22.&nbsp;&nbsp;Planning for the Kerberos Service</a></p>
<p class="toc level2"><a href="setup-8.html">23.&nbsp;&nbsp;Configuring the Kerberos Service (Tasks)</a></p>
<p class="toc level2"><a href="trouble-1.html">24.&nbsp;&nbsp;Kerberos Error Messages and Troubleshooting</a></p>
<p class="toc level2"><a href="aadmin-1.html">25.&nbsp;&nbsp;Administering Kerberos Principals and Policies (Tasks)</a></p>
<p class="toc level2"><a href="user-7.html">26.&nbsp;&nbsp;Using Kerberos Applications (Tasks)</a></p>
<p class="toc level2"><a href="refer-1.html">27.&nbsp;&nbsp;The Kerberos Service (Reference)</a></p>
<p class="toc level1 tocsp"><a href="audittm-1.html">Part&nbsp;VII&nbsp;Solaris Auditing</a></p>
<p class="toc level2"><a href="auditov-1.html">28.&nbsp;&nbsp;Solaris Auditing (Overview)</a></p>
<p class="toc level2"><a href="auditplan-1.html">29.&nbsp;&nbsp;Planning for Solaris Auditing</a></p>
<p class="toc level2"><a href="audittask-1.html">30.&nbsp;&nbsp;Managing Solaris Auditing (Tasks)</a></p>
<p class="toc level2"><a href="auditref-1.html">31.&nbsp;&nbsp;Solaris Auditing (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-2.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="rbactask-30"></a><h3>Configuring RBAC</h3>
<a name="indexterm-1133"></a><a name="indexterm-1134"></a><p>RBAC can be configured with the following utilities:</p>
<ul><li><p><b>Solaris Management Console GUI &ndash;</b> The preferred method for performing RBAC-related tasks is through the GUI. The console tools for managing the RBAC elements are contained in the Users Tool collection.</p></li>
<li><p><b>Solaris Management Console commands &ndash;</b> With the Solaris Management Console command-line interfaces, such as <tt>smrole</tt>, you can operate on any name service. The Solaris Management Console commands require authentication to connect to the server. As a result, these commands are not practical for use in scripts.</p></li>
<li><p><b>Local commands &ndash;</b> With the <tt>user</tt>* and <tt>role</tt>* set of command-line interfaces, such as <tt>useradd</tt>, you can operate on local files only. The commands that operate on local files must be run by superuser or by a role with the appropriate privileges.</p></li></ul>


<a name="rbactask-16"></a><h4>How to Plan Your RBAC Implementation</h4><a name="indexterm-1135"></a><a name="indexterm-1136"></a><a name="indexterm-1137"></a><a name="indexterm-1138"></a><a name="indexterm-1139"></a><p>RBAC can be an integral part of how an organization manages its
information resources. Planning requires a thorough knowledge of the RBAC capabilities as well as
the security requirements of your organization.</p><ol>
<li><b>Learn the basic RBAC concepts.</b><p>Read <a href="rbac-1.html">Role-Based Access Control (Overview)</a>. Using RBAC to administer a system is very different from using
conventional UNIX administrative practices. You should be familiar with the RBAC concepts before
you start your implementation. For greater detail, see <a href="rbacref-1.html">Chapter&nbsp;10, Role-Based Access Control (Reference)</a>.</p></li>
<li><b>Examine your security policy.</b><p>Your organization's security policy should detail the potential threats to your system, measure the
risk of each threat, and have a strategy to counter these threats.
Isolating the security-relevant tasks through RBAC can be a part of the strategy.
Although you can install the recommended roles and their configurations as is, you might
need to customize your RBAC configuration to adhere to your security policy.</p></li>
<li><b>Decide how much RBAC your organization needs.</b><p>Depending on your security needs, you can use varying degrees of RBAC, as
follows:</p>
<ul><li><p><b>No RBAC &ndash;</b> You can perform all tasks as <tt>root</tt> user. In this configuration, you log in as yourself. Then, you type <tt>root</tt> as the user when you select a Solaris Management Console tool.</p></li>
<li><p><b>Single Role Only &ndash;</b> This method adds one role. The one role is assigned the Primary Administrator rights profile. This method is similar to the superuser model, in that the role has superuser capabilities. However, this method enables you to track the user who has assumed the role.</p></li>
<li><p><b>Recommended Roles &ndash;</b> This method creates three roles that are based on the following rights profiles: Primary Administrator, System Administrator, and Operator. The roles are suitable for organizations with administrators at different levels of responsibility.</p></li>
<li><p><b>Custom Roles &ndash;</b> You can create your own roles to meet the security requirements of your organization. The new roles can be based on existing or customized rights profiles. To customize rights profiles that enforce separation of duty, see <a href="http://docs.sun.com/doc/819-7309/txconf-14?a=view">Creating Roles and Users in Trusted Extensions in <i>Solaris Trusted Extensions Administrator&rsquo;s Procedures</i></a>.</p></li>
<li><p><b>Root User as a Role &ndash;</b> This method prevents any user from logging in as <tt>root</tt>. Instead, users must log in as ordinary users prior to assuming the <tt>root</tt> role. For details, see <a href="#rbactask-20">How to Make <tt>root</tt> User Into a Role</a>.</p></li></ul>
</li>
<li><b>Decide which recommended roles are appropriate for your organization.</b><p>Review the capabilities of the recommended roles and default rights profiles. Default rights
profiles enable administrators to configure a recommended role by using a single profile.</p><p>Three default rights profiles are available for configuring the recommended roles:</p>
<ul><li><p><b>Primary Administrator rights profile &ndash;</b> For configuring a role that can perform all administrative tasks, can grant rights to others, and can edit rights that are associated with administrative roles. A user in this role can assign this role to other users, and can grant rights to other users.</p></li>
<li><p><b>System Administrator rights profile &ndash;</b> For configuring a role that can perform most administrative tasks that are not related to security. For example, the System Administrator can add new user accounts, but cannot set passwords or grant rights to other users.</p></li>
<li><p><b>Operator rights profile &ndash;</b> For configuring a role that can perform simple administrative tasks, such as media backup and printer maintenance.</p></li></ul>
<p>To further examine rights profiles, read one of the following:</p>
<ul><li><p>In the <tt>/etc/security</tt> directory, read the contents of the <tt>prof_attr</tt> database and the <tt>exec_attr</tt> database.</p></li>
<li><p>In the Solaris Management Console, use the Rights tool to display the contents of a rights profile.</p></li>
<li><p>In this book, refer to <a href="rbacref-26.html">Contents of Rights Profiles</a> for summaries of some typical rights profiles.</p></li></ul>
</li>
<li><b>Decide if any additional roles or rights profiles are appropriate for your organization.</b><p>Look for other applications or families of applications at your site that might
benefit from restricted access. Applications that affect security, that can cause denial-of-service problems,
or that require special administrator training are good candidates for RBAC. You can
customize roles and rights profiles to handle the security requirements of your organization.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>Determine which commands are needed for the new task.</b></li>
<li><b>Decide which rights profile is appropriate for this task.</b><p>Check if an existing rights profile can handle this task or if
a separate rights profile needs to be created.</p></li>
<li><b>Determine which role is appropriate for this rights profile.</b><p>Decide if the rights profile for this task should be assigned to
an existing role or if a new role should be created. If you
use an existing role, check that the other rights profiles are appropriate for
users who are assigned to this role.</p></li></ol></li>
<li><b>Decide which users should be assigned to the available roles.</b><p>According to the principle of least privilege, you should assign users to roles
that are appropriate to their level of trust. When you prevent users from
access to tasks that the users do not need to perform, you
reduce potential problems.</p></li></ol>

<a name="rbactask-32"></a><h4>How to Create and Assign a Role by Using the GUI</h4><a name="indexterm-1140"></a><a name="indexterm-1141"></a><a name="indexterm-1142"></a><a name="indexterm-1143"></a><a name="indexterm-1144"></a><a name="indexterm-1145"></a><a name="indexterm-1146"></a><a name="indexterm-1147"></a><p>To create a new role, you can be superuser, or you can
use the Primary Administrator role. In this procedure, the creator of the new
role has assumed the role of Primary Administrator.</p><h6>Before You Begin</h6>
<ul><li><p>You have already created users who can assume a role at your site. If the users are not yet created, create them by following the instructions in <a href="http://docs.sun.com/doc/819-2379/usersetup-21?a=view">How to Add a User With the Solaris Management Console&rsquo;s Users Tool in <i>System Administration Guide: Basic Administration</i></a><a href="http://docs.sun.com/doc/819-2379/smcover-95?a=view">Using the Solaris Management Tools With RBAC (Task Map) in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><p>You have been assigned the Primary Administrator role by following the procedures in <a href="http://docs.sun.com/doc/819-2379/smcover-95?a=view">Using the Solaris Management Tools With RBAC (Task Map) in <i>System Administration Guide: Basic Administration</i></a>.</p></li></ul>
<ol>
<li><b>Start the Solaris Management Console.</b><pre># <tt><b>/usr/sbin/smc &amp;</b></tt></pre><p>For login instructions, see <a href="rbactask-42.html#rbactask-21">How to Assume a Role in the Solaris Management Console</a>.</p></li>
<li><b>Click the Administrative Roles icon.</b></li>
<li><b>Select Add Administrative Role from the Action menu.</b></li>
<li><b>Create a new role by filling in the fields in the series
of dialog boxes.</b><p>For possible roles, see <a href="#rbactask-35">Example&nbsp;9-1</a> to <a href="#rbactask-41">Example&nbsp;9-4</a>.</p>
<hr><p><b>Tip - </b>All tools in the Solaris Management Console display information in the bottom section
of the page or at the left side of a wizard panel.
Choose Help at any time to find additional information about performing tasks in this
interface.</p>
<hr>
</li>
<li><b><a name="indexterm-1148"></a>Assign the role to a user.</b>
<hr><p><b>Tip - </b>After filling in the properties of the role, the last dialog box prompts
you for a user for the role.</p>
<hr>
</li>
<li><b><a name="indexterm-1149"></a><a name="indexterm-1150"></a><a name="indexterm-1151"></a>In a terminal window, restart the name service cache daemon.</b><pre># <tt><b>svcadm restart system/name-service-cache</b></tt></pre><p>For more information, see the <a href="http://docs.sun.com/doc/819-2240/svcadm-1m?a=view"><tt>svcadm</tt>(1M)</a> and <a href="http://docs.sun.com/doc/819-2240/nscd-1m?a=view"><tt>nscd</tt>(1M)</a> man pages.</p></li></ol><a name="rbactask-35"></a><h6>Example&nbsp;9-1 Creating a Role for the System Administrator Rights Profile</h6><a name="indexterm-1152"></a><a name="indexterm-1153"></a><a name="indexterm-1154"></a><a name="indexterm-1155"></a><p>In this example, the new role can do system administration tasks that are
not connected to security. The role is created by performing the preceding procedure
with the following parameters:</p>
<ul><li><p>Role name: <tt>sysadmin</tt></p></li>
<li><p>Role full name: <tt>System Administrator</tt></p></li>
<li><p>Role description: <tt>Performs non-security admin tasks</tt></p></li>
<li><p>Rights profile: <tt>System Administrator</tt></p><p>This rights profile is at the top of the list of profiles that are included in the role.</p></li></ul>
<a name="rbactask-37"></a><h6>Example&nbsp;9-2 Creating a Role for the Operator Rights Profile</h6><a name="indexterm-1156"></a><a name="indexterm-1157"></a><a name="indexterm-1158"></a><a name="indexterm-1159"></a><p>The Operator rights profile can manage printers and back up the system to
offline media. You might want to assign the role to one user
on each shift. To do so, you would select the role mailing list
option in the Step 1: Enter a Role Name dialog box. The role
is created by performing the preceding procedure with the following parameters:</p>
<ul><li><p>Role name: <tt>operadm</tt></p></li>
<li><p>Role full name: <tt>Operator</tt></p></li>
<li><p>Role description: <tt>Backup operator</tt></p></li>
<li><p>Rights profile: <tt>Operator</tt></p><p>This rights profile must be at the top of the list of profiles that are included in the role.</p></li></ul>
<a name="rbactask-39"></a><h6>Example&nbsp;9-3 Creating a Role for a Security-Related Rights Profile</h6><a name="indexterm-1160"></a><a name="indexterm-1161"></a><a name="indexterm-1162"></a><p>By default, the only rights profile that contains security-related commands and rights is
the Primary Administrator profile. If you want to create a role that is
not as powerful as Primary Administrator, but can handle some security-related tasks, you
must create the role.</p><p>In the following example, the role protects devices. The role is created by
performing the preceding procedure with the following parameters:</p>
<ul><li><p><a name="indexterm-1163"></a><a name="indexterm-1164"></a>Role name: <tt>devicesec</tt></p></li>
<li><p>Role full name: <tt>Device Security</tt></p></li>
<li><p>Role description: <tt>Configures Devices</tt></p></li>
<li><p>Rights profile: <tt>Device Security</tt></p></li></ul>
<p>In the following example, the role secures systems and hosts on the network.
The role is created by performing the preceding procedure with the following parameters:</p>
<ul><li><p><a name="indexterm-1165"></a><a name="indexterm-1166"></a>Role name: <tt>netsec</tt></p></li>
<li><p>Role full name: <tt>Network Security</tt></p></li>
<li><p>Role description: <tt>Handles IPsec, IKE, and SSH</tt></p></li>
<li><p>Rights profile: <tt>Network Security</tt></p></li></ul>
<a name="rbactask-41"></a><h6>Example&nbsp;9-4 Creating a Role for a Rights Profile With Limited Scope</h6><a name="indexterm-1167"></a><a name="indexterm-1168"></a><a name="indexterm-1169"></a><a name="indexterm-1170"></a><a name="indexterm-1171"></a><p>A number of rights profiles are of limited scope. In this example,
the sole task of the role is to manage DHCP. The role is
created by performing the preceding procedure with the following parameters:</p>
<ul><li><p>Role name: <tt>dhcpmgt</tt></p></li>
<li><p>Role full name: <tt>DHCP Management</tt></p></li>
<li><p>Role description: <tt>Manages Dynamic Host Config Protocol</tt></p></li>
<li><p>Rights profile: <tt>DHCP Management</tt></p></li></ul>
<a name="rbactask-18"></a><h6>Example&nbsp;9-5 Modifying a User's Role Assignment</h6><a name="indexterm-1172"></a><a name="indexterm-1173"></a><a name="indexterm-1174"></a><a name="indexterm-1175"></a><p>In this example, a role is added to an existing user. The
user's role assignment is modified by clicking the User Accounts icon in the
Users tool in the Solaris Management Console, double-clicking the user, and following the online
help to add a role to the user's capabilities.</p><h6>Troubleshooting</h6><p><a name="indexterm-1176"></a><a name="indexterm-1177"></a>Check the following if the role does not have the capabilities that it
should:</p>
<ul><li><p>Are the role's rights profiles listed in the GUI from most to least powerful?</p><p>For example, if the <tt>All</tt> rights profile is at the top of the list, then no commands are run with security attributes. A profile that contains commands with security attributes must precede the <tt>All</tt> rights profile in the list.</p></li>
<li><p>Do the commands in the role's rights profiles have the appropriate security attributes?</p><p>For example, when the policy is <tt>suser</tt>, some commands require <tt>uid=0</tt> rather than <tt>euid=0</tt>.</p></li>
<li><p>Is the rights profile defined in the appropriate name service scope? Is the role operating in the name service scope where the rights profile is defined?</p></li>
<li><p>Has the name service cache, <tt>svc:/system/name-service-cache</tt>, been restarted?</p><p>The <tt>nscd</tt> daemon can have a lengthy time-to-live interval. By restarting the daemon, you update the name service with current data.</p></li></ul>


<a name="rbactask-22"></a><h4>How to Create a Role From the Command Line</h4><a name="indexterm-1178"></a><a name="indexterm-1179"></a><a name="indexterm-1180"></a><a name="indexterm-1181"></a><a name="indexterm-1182"></a><a name="indexterm-1183"></a><p>The Solaris Management Console GUI is the preferred method for managing RBAC. To
use the GUI, see <a href="#rbactask-32">How to Create and Assign a Role by Using the GUI</a>. You can also use the command-line interfaces, as
described in this procedure.</p>
<hr><p><b>Note - </b>Do not attempt to administer RBAC with the command line and the graphical
user interface at the same time. Conflicting changes could be made to the
configuration, and the behavior would be unpredictable. You can use both tools to
administer RBAC, but you cannot use both concurrently.</p>
<hr>
<h6>Before You Begin</h6><p>To create a role, you must either assume a role that includes
the Primary Administrator rights profile, or switch to the user <tt>root</tt>.</p><ol>
<li><b>Assume the Primary Administrator role, or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role
and assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><b>Choose one of the following commands to create a role on the
command line.</b><ul>
<li><b><a name="indexterm-1184"></a>For roles in the local name service scope, use the <tt>roleadd</tt> command.</b>
<hr><p><b>Note - </b>The <tt>roleadd</tt> command is more limited than the Solaris Management Console GUI or
command-line interfaces. After running the <tt>roleadd</tt> command, you must run the <tt>usermod</tt>
command to assign the role to a user. And, the user then must
set the password for the role, as shown in <a href="#rbactask-44">How to Assign a Role to a Local User</a>.</p>
<hr>
<pre># roleadd -c <i>comment</i> \
-g <i>group</i> -m <i>homedir</i> -u <i>UID</i> -s <i>shell</i> \
-P <i>profile</i> <i>rolename</i></pre><dl><dt><tt>-c</tt> <i>comment</i></dt>
<dd><p>Is a comment that describes <i>rolename</i>.</p></dd>
<dt><tt>-g</tt> <i>group</i></dt>
<dd><p>Is the group assignment for <i>rolename</i>.</p></dd>
<dt><tt>-m</tt> <i>homedir</i></dt>
<dd><p>Is the path to the home directory for <i>rolename</i>.</p></dd>
<dt><tt>-u</tt> <i>UID</i></dt>
<dd><p>Is the UID for <i>rolename</i>.</p></dd>
<dt><tt>-s</tt> <i>shell</i></dt>
<dd><p>Is the login shell for <i>rolename</i>. This shell must be a profile shell.</p></dd>
<dt><tt>-P</tt> <i>profile</i></dt>
<dd><p>Is one or more rights profiles for <i>rolename</i>.</p></dd>
<dt><i>rolename</i></dt>
<dd><p>Is the name of the new local role.</p></dd>
</dl>
</li>
<li><b>Use the <tt>smrole add</tt> command.</b><p>This command creates a role in a distributed name service, such as NIS,
NIS+, or LDAP. This command runs as a client of the Solaris Management
Console server.</p><pre>$ /usr/sadm/bin/smrole -D <i>domain-name</i> \ 
-r <i>admin-role</i> -l <i>&lt;Type admin-role password&gt;</i> \
add -- -n <i>rolename</i> -a <i>rolename</i> -d <i>directory</i>\
-F <i>full-description</i> -p <i>profile</i></pre><dl><dt><tt>-D</tt> <i>domain-name</i></dt>
<dd><p>Is the name of the domain that you want to manage.</p></dd>
<dt><tt>-r</tt> <i>admin-role</i></dt>
<dd><p>Is the name of the administrative role that can modify the role. The administrative role must have the <tt>solaris.role.assign</tt> authorization. If you are modifying a role that you have assumed, the role must have the <tt>solaris.role.delegate</tt> authorization.</p></dd>
<dt><tt>-l</tt></dt>
<dd><p>Is the prompt for the password of <i>admin-role</i>.</p></dd>
<dt><tt>--</tt></dt>
<dd><p>Is the required separator between authentication options and subcommand options.</p></dd>
<dt><tt>-n</tt> <i>rolename</i></dt>
<dd><p>Is the name of the new role.</p></dd>
<dt><tt>-c</tt> <i>comment</i></dt>
<dd><p>Is the comment that describes the capabilities of the role.</p></dd>
<dt><tt>-a</tt> <i>username</i></dt>
<dd><p>Is the name of the user who can assume <i>rolename</i>.</p></dd>
<dt><tt>-d</tt> <i>directory</i></dt>
<dd><p>Is the home directory for <i>rolename</i>.</p></dd>
<dt><tt>-F</tt> <i>full-description</i></dt>
<dd><p>Is the full description for <i>rolename</i>. This description is displayed in the Solaris Management Console GUI.</p></dd>
<dt><tt>-p</tt> <i>profile</i></dt>
<dd><p>Is a rights profile that is included in the capabilities of <i>rolename</i>. This option gives commands with administrative capabilities to the role. You can specify multiple <tt>-p</tt> <i>profile</i> options.</p></dd>
</dl>
</li></ul></li>
<li><b>To put the changes into effect, see <a href="#rbactask-44">How to Assign a Role to a Local User</a>.</b></li></ol><a name="rbactask-19"></a><h6>Example&nbsp;9-6 Creating a Custom Operator Role by Using the <tt>smrole</tt> Command</h6><a name="indexterm-1185"></a><a name="indexterm-1186"></a><a name="indexterm-1187"></a><a name="indexterm-1188"></a><a name="indexterm-1189"></a><a name="indexterm-1190"></a><a name="indexterm-1191"></a><a name="indexterm-1192"></a><a name="indexterm-1193"></a><a name="indexterm-1194"></a><p>The <tt>smrole</tt> command specifies a new role and its attributes in a name
service. In the following example, the Primary Administrator creates a new version of
the Operator role. The role includes the standard Operator rights profile as well
as the Media Restore rights profile. Note that the command prompts you for
a password for the new role.</p><pre>% <tt><b>su - primaryadm</b></tt>
Password: &lt;Type primaryadm password&gt; 
$ <tt><b>/usr/sadm/bin/smrole add -H myHost -- -c "Backup and Restore Operator" \</b></tt>
<tt><b>-n operadm2 -a janedoe -d /export/home/operadm \</b></tt>
<tt><b>-F "Backup/Restore Operator" -p "Operator" -p "Media Restore"</b></tt>
Authenticating as user: primaryadm

Type /? for help, pressing &lt;enter&gt; accepts the default denoted by [ ]
Please enter a string value for: password :: &lt;Type primaryadm password&gt;

Loading Tool: com.sun.admin.usermgr.cli.role.UserMgrRoleCli from myHost
Login to myHost as user primaryadm was successful.
Download of com.sun.admin.usermgr.cli.role.UserMgrRoleCli from myHost was successful.

Type /? for help, pressing &lt;enter&gt; accepts the default denoted by [ ]
Please enter a string value for: password ::&lt;Type operadm2 password&gt;

$ <tt><b>svcadm restart system/name-service-cache</b></tt></pre><p>The <tt>smrole</tt> command with the <tt>list</tt> subcommand is used to display the new
role:</p><pre>$ <tt><b>/usr/sadm/bin/smrole list --</b></tt>
Authenticating as user: primaryadm

Type /? for help, pressing &lt;enter&gt; accepts the default denoted by [ ]
Please enter a string value for: password :: &lt;Type primaryadm password&gt;

Loading Tool: com.sun.admin.usermgr.cli.role.UserMgrRoleCli from myHost
Login to myHost as user primaryadm was successful.
Download of com.sun.admin.usermgr.cli.role.UserMgrRoleCli from myHost was successful.
root                    0             Superuser
primaryadm            100             Most powerful role
sysadmin              101             Performs non-security admin tasks
operadm               102             Backup Operator
operadm2              103             Backup/Restore Operator</pre>

<a name="rbactask-44"></a><h4>How to Assign a Role to a Local User</h4><a name="indexterm-1195"></a><a name="indexterm-1196"></a><a name="indexterm-1197"></a><p>This procedure assigns a local role to a local user, restarts the
name cache daemon, and then shows how the user can assume the role.</p><p>To assign a role to a user in a distributed name service,
see <a href="#rbactask-22">How to Create a Role From the Command Line</a> and <a href="rbactask-4.html#rbactask-23">How to Change the Properties of a Role</a>.</p><h6>Before You Begin</h6><p>You have added a local role, as described in <a href="#rbactask-22">How to Create a Role From the Command Line</a>. You must
have assumed the role of Primary Administrator or have switched to superuser.</p><ol>
<li><b>Assign the role to a local user.</b><p>If you added a local role with the <tt>roleadd</tt> command, this step is
required. This step is optional when you use the <tt>smrole</tt> command and the Solaris
Management Console to create a role.</p><pre># usermod -u <i>UID</i> -R <i>rolename</i></pre><dl><dt><tt>-u</tt> <i>UID</i></dt>
<dd><p>Is the UID of the user.</p></dd>
<dt><tt>-R</tt> <i>rolename</i></dt>
<dd><p>Is the role that is being assigned to the user.</p></dd>
</dl>
</li>
<li><b>To put the changes into effect, restart the name service cache daemon.</b><pre># svcadm restart system/name-service-cache</pre><p>If you added a role with a Solaris Management Console interface, go to
<a href="rbactask-40.html">Using Roles (Task Map)</a>. Otherwise, continue with the next step.</p></li>
<li>(Optional) <b>To unlock the role account, the user must create a password.</b><p>If you added a local role with the <tt>roleadd</tt> command, this step
is required.</p><pre>% su - <i>rolename</i>
Password: &lt;Type rolename password&gt;
Confirm Password: &lt;Retype rolename password&gt;
$</pre></li></ol><a name="rbactask-17"></a><h6>Example&nbsp;9-7 Creating and Assigning a Local Role From the Command Line</h6><a name="indexterm-1198"></a><a name="indexterm-1199"></a><a name="indexterm-1200"></a><a name="indexterm-1201"></a><a name="indexterm-1202"></a><p>In this example, a role is created to administer the Solaris Cryptographic Framework.
The Crypto Management rights profile contains the <tt>cryptoadm</tt> command for administering hardware and
software cryptographic services on a local system.</p><pre># <tt><b>roleadd -c "Cryptographic Services manager" \</b></tt>
<tt><b>-g 14 -m /export/home/cryptoadm -u 104 -s pfksh \</b></tt>
<tt><b>-P "Crypto Management" cryptomgt</b></tt>
# <tt><b>usermod -u 1111 -R cryptomgt</b></tt>
# <tt><b>svcadm restart system/name-service-cache</b></tt>
% <tt><b>su - cryptomgt</b></tt>
Password: &lt;Type cryptomgt password&gt;
Confirm Password: &lt;Retype cryptomgt password&gt;
$ <tt><b>/usr/ucb/whoami</b></tt>
cryptomgt
$</pre><p>For information about the Solaris Cryptographic Framework, see <a href="scf-1.html">Chapter&nbsp;13, Solaris Cryptographic Framework (Overview)</a>. To administer the framework,
see <a href="scftask-28.html">Administering the Cryptographic Framework (Task Map)</a>.</p>

<a name="rbactask-34"></a><h4>How to Audit Roles</h4><a name="indexterm-1203"></a><a name="indexterm-1204"></a><a name="indexterm-1205"></a><a name="indexterm-1206"></a><a name="indexterm-1207"></a><p>The actions that a role performs can be audited. Included in the
audit record is the login name of the user who assumed the role,
the role name, and the action that the role performed.  The <tt>6180:AUE_prof_cmd:profile command:ua,as</tt>
audit event collects the information. By preselecting the <tt>as</tt> class or the <tt>ua</tt>
class, you can audit role actions.</p><ol>
<li><b>Plan for auditing and edit the audit configuration files.</b><p>For more information, see <a href="audittask-3.html">Solaris Auditing (Task Map)</a>.</p></li>
<li><b>Include the <tt>ua</tt> class or the <tt>as</tt> class in the <tt>flags</tt> line of
the <tt>audit_control</tt> file.</b><pre># audit_control file
dir:/var/audit
flags:lo,<tt><b>as</b></tt>
minfree:20
naflags:lo</pre><p>The <tt>ua</tt> class and the <tt>as</tt> class include other audit events. To see
the audit events that are included in a class, read the <tt>audit_event</tt> file.
You can also use the <tt>bsmrecord</tt> command, as shown in <a href="audittask-21.html#audittask-33">Example&nbsp;30-25</a>.</p></li>
<li><b>Finish configuring the auditing service, then enable auditing.</b><p>For more information, see <a href="audittask-28.html">Configuring and Enabling the Auditing Service (Tasks)</a>.</p></li></ol>

<a name="rbactask-20"></a><h4>How to Make <tt>root</tt> User Into a Role</h4><a name="indexterm-1208"></a><a name="indexterm-1209"></a><a name="indexterm-1210"></a><a name="indexterm-1211"></a><a name="indexterm-1212"></a><a name="indexterm-1213"></a><a name="indexterm-1214"></a><p>This procedure shows how to change <tt>root</tt> from a login user to a
role. When you complete this procedure, you can no longer directly log in
to the system as <tt>root</tt>, except in single-user mode. You must be assigned
the <tt>root</tt> role and <tt>su</tt> to <tt>root</tt>.</p><p>By changing the <tt>root</tt> user into a role, you prevent anonymous <tt>root</tt> login.
Because a user must log in and <b>then</b> assume the <tt>root</tt> role,
the user's login ID is provided to the auditing service and is in
the <tt>sulog</tt> file.</p><p>In this procedure, you create a local user and assign the <tt>root</tt>
role to the user. To prevent users from assuming the role, see <a href="#rbactask-59">Example&nbsp;9-8</a>.</p><ol>
<li><b>As a regular user, log in to the target system.</b></li>
<li><b>Assume the Primary Administrator role, or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role
and assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-95?a=view">Using the Solaris Management Tools With RBAC (Task Map) in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><b><a name="indexterm-1215"></a><a name="indexterm-1216"></a><a name="indexterm-1217"></a><a name="indexterm-1218"></a><a name="indexterm-1219"></a>Create a local user who can assume the <tt>root</tt> role.</b><p>For safety, at least one local user should be assigned the <tt>root</tt> role.</p><pre>$ useradd -c <i>comment</i> -u <i>uid</i> -d <i>homedir username</i></pre><dl><dt><tt>-c</tt> <i>comment</i></dt>
<dd><p>Is the comment that describes the user.</p></dd>
<dt><tt>-d</tt> <i>homedir</i></dt>
<dd><p>Is the home directory of the user. This directory should be on the local system.</p></dd>
<dt><tt>-u</tt> <i>uid</i></dt>
<dd><p>Is the user identification number.</p></dd>
<dt><i>username</i></dt>
<dd><p>Is the name of the new local user.</p></dd>
</dl>
<pre># <tt><b>useradd -c "JDoe's local account" -u 123 -d /export/home1 jdoe-local</b></tt></pre></li>
<li><b>Give the user a password.</b><pre># <tt><b>passwd -r files jdoe-local</b></tt>
New Password:    &lt;Type password&gt;
Re-enter new Password: &lt;Retype password&gt;
passwd: password successfully changed for jdoe-local
#</pre></li>
<li><b>Make sure that you are not logged in as <tt>root</tt>.</b><pre># <tt><b>who</b></tt>
jdoe    console      May 24 13:51    (:0)
jdoe    pts/5        May 24 13:51    (:0.0)
jdoe    pts/4        May 24 13:51    (:0.0)
jdoe    pts/10       May 24 13:51    (:0.0)</pre></li>
<li><b>Change <tt>root</tt> user into a role.</b><pre># <tt><b>usermod -K type=role root</b></tt></pre></li>
<li><b>Verify that <tt>root</tt> is a role.</b><p>The <tt>root</tt> entry in the <tt>user_attr</tt> file should appear similar to the following:</p><pre># <tt><b>grep root /etc/user_attr</b></tt>
root::::type=role;auths=solaris.*,solaris.grant;profiles=...</pre></li>
<li><b>Assign the <tt>root</tt> role to your local account.</b><pre># <tt><b>usermod -R root jdoe-local</b></tt></pre>
<hr><p><b>Caution - </b>If you do not assign the <tt>root</tt> role to a user, no one
can become superuser, except in single-user mode. You must type a root password
to enter single-user mode.</p>
<hr>
</li>
<li><b>Configure the name service to return in case of failure.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Open a new terminal window and assume the <tt>root</tt> role.</b><pre>% <tt><b>whoami</b></tt>
jdoe
% <tt><b>su - jdoe-local</b></tt>
Enter password:   &lt;Type jdoe-local password&gt;
% <tt><b>roles</b></tt>
root
% <tt><b>su - root</b></tt>
Enter password:   &lt;Type root password&gt;
#</pre></li>
<li><b>Edit the <tt>nsswitch.conf</tt> file.</b><p><a name="indexterm-1220"></a>For example, the following entries in the <tt>nsswitch.conf</tt> file would enable the name service
to return.</p><pre>passwd:  files nis [TRYAGAIN=0 UNAVAIL=return NOTFOUND=return]
group:  files nis [TRYAGAIN=0 UNAVAIL=return NOTFOUND=return]</pre></li></ol></li>
<li>(Optional) <b>Assign the <tt>root</tt> role to selected user accounts in the name service.</b><p>For the procedure, see <a href="rbactask-4.html#rbactask-25">How to Change the RBAC Properties of a User</a>.</p></li></ol><a name="rbactask-59"></a><h6>Example&nbsp;9-8 Preventing the <tt>root</tt> Role From Being Used to Configure a System</h6><p>In this example, site security policy requires that several discrete roles configure the
system. These discrete roles have been created and tested. To prevent the <tt>root</tt>
account from being used to configure the system, the security administrator changes <tt>root</tt>
into a role, but does not assign the role. The <tt>root</tt> role retains a
password to enter the system in single-user mode.</p><p>First, the administrator verifies that <tt>root</tt> is not an assigned role.</p><pre>% <tt><b>whoami</b></tt>
jdoe-local
% <tt><b>su - root</b></tt>
Password: <tt><b>a!2@3#4$5%6^7</b></tt>
# <tt><b>grep roles /etc/user_attr</b></tt>
jdoe-local::::type=normal;roles=secadmin
kdoe-local::::type=normal;roles=sysadmin</pre><p>Still in the <tt>root</tt> account, the administrator changes <tt>root</tt> into a role.</p><pre># <tt><b>usermod -K type=role root</b></tt></pre><p>Then, the administrator verifies the change in the <tt>root</tt> entry in the <tt>user_attr</tt>
file.</p><pre># <tt><b>grep root /etc/user_attr</b></tt>
root::::type=<b>role</b>;auths=solaris.*,solaris.grant;profiles=...</pre><a name="rbactask-58"></a><h6>Example&nbsp;9-9 Changing the <tt>root</tt> Role Back Into the <tt>root</tt> User</h6><p>In this example, the administrator is decommissioning a system and wants to log
in to the desktop as superuser. The system has been removed from
the network.</p><p>First, the administrator assumes the <tt>root</tt> role to remove all <tt>root</tt> role assignments.</p><pre>% <tt><b>whoami</b></tt>
jdoe-local
% <tt><b>su - root</b></tt>
Password: <tt><b>a!2@3#4$5%6^7</b></tt>
# <tt><b>grep roles /etc/user_attr</b></tt>
jdoe-local::::type=normal;roles=<b>root</b>
kdoe-local::::type=normal;roles=<b>root</b>
# <tt><b>usermod -R "" jdoe-local</b></tt>
# <tt><b>usermod -R "" kdoe-local</b></tt>
# <tt><b>grep roles /etc/user_attr</b></tt>
#</pre><p>Still in the <tt>root</tt> role, the administrator changes <tt>root</tt> into a user.</p><pre># <tt><b>rolemod -K type=normal root</b></tt></pre><p>Then, the administrator verifies the change in the <tt>root</tt> entry in the <tt>user_attr</tt>
file.</p><pre># <tt><b>grep root /etc/user_attr</b></tt>
root::::type=<b>normal</b>;auths=solaris.*,solaris.grant;profiles=...</pre><h6>Troubleshooting</h6><p>In a desktop environment, you cannot directly log in as <tt>root</tt> when
<tt>root</tt> is a role. A diagnostic message indicates that <tt>root</tt> is a role
on your system. If you do not have a local account that
can assume the <tt>root</tt> role, create one. As <tt>root</tt>, log in to the system
in single-user mode, create a local user account, and assign the <tt>root</tt> role
to the new account. Then, log in as the new user and assume
the <tt>root</tt> role.</p><p>No one can become superuser if you change the <tt>root</tt> user into a
role and fail to make one of the following assignments:</p>
<ul><li><p>Assign the <tt>root</tt> role to a valid user.</p></li>
<li><p>Assign a rights profile that is equivalent to <tt>root</tt>'s rights profile to a valid user. The Primary Administrator profile is an equivalent rights profile for <tt>root</tt> capabilities.</p></li>
<li><p>Create a role that has the capabilities of <tt>root</tt> and assign the role to a valid user. A role that is assigned the Primary Administrator profile is equivalent to the <tt>root</tt> role.</p></li></ul>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="rbactask-15.html">Previous</a>
             </td>
             <td align="right">
                 <a href="rbactask-40.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

