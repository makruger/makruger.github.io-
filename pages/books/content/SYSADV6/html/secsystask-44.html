<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Monitoring and Restricting Superuser - System Administration Guide: Security Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Security Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="secsys-37.html">Previous</a>
             </td>
             <td align="right">
                 <a href="secsys-29.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="oview-1.html">Part&nbsp;I&nbsp;Security Overview</a></p>
<p class="toc level2"><a href="secov-1.html">1.&nbsp;&nbsp;Security Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="sectm-1.html">Part&nbsp;II&nbsp;System, File, and Device Security</a></p>
<p class="toc level2"><a href="concept-1.html">2.&nbsp;&nbsp;Managing Machine Security (Overview)</a></p>
<p class="toc level2"><a href="secsys-1.html">3.&nbsp;&nbsp;Controlling Access to Systems (Tasks)</a></p>
<p class="toc level3"><a href="secsys-24.html">Controlling System Access (Task Map)</a></p>
<p class="toc level3"><a href="secsys-25.html">Securing Logins and Passwords (Task Map)</a></p>
<p class="toc level3"><a href="secsystask-40.html">Securing Logins and Passwords</a></p>
<p class="toc level3"><a href="secsys-15.html">Changing the Password Algorithm (Task Map)</a></p>
<p class="toc level3"><a href="secsystask-42.html">Changing the Default Algorithm for Password Encryption</a></p>
<p class="toc level3"><a href="secsys-37.html">Monitoring and Restricting Superuser (Task Map)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Monitoring and Restricting Superuser</a></p>
</div>
<p class="toc level3"><a href="secsys-29.html">SPARC: Controlling Access to System Hardware (Task Map)</a></p>
<p class="toc level3"><a href="secsystask-46.html">Controlling Access to System Hardware</a></p>
<p class="toc level2 tocsp"><a href="vscan-1.html">4.&nbsp;&nbsp;Virus Scanning Service (Tasks)</a></p>
<p class="toc level2"><a href="devtask-1.html">5.&nbsp;&nbsp;Controlling Access to Devices (Tasks)</a></p>
<p class="toc level2"><a href="bart-1.html">6.&nbsp;&nbsp;Using the Basic Audit Reporting Tool (Tasks)</a></p>
<p class="toc level2"><a href="secfile-1.html">7.&nbsp;&nbsp;Controlling Access to Files (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="prbactm-1.html">Part&nbsp;III&nbsp;Roles, Rights Profiles, and Privileges</a></p>
<p class="toc level2"><a href="prbac-1.html">8.&nbsp;&nbsp;Using Roles and Privileges (Overview)</a></p>
<p class="toc level2"><a href="rbactask-1.html">9.&nbsp;&nbsp;Using Role-Based Access Control (Tasks)</a></p>
<p class="toc level2"><a href="rbacref-1.html">10.&nbsp;&nbsp;Role-Based Access Control (Reference)</a></p>
<p class="toc level2"><a href="privtask-1.html">11.&nbsp;&nbsp;Privileges (Tasks)</a></p>
<p class="toc level2"><a href="privref-1.html">12.&nbsp;&nbsp;Privileges (Reference)</a></p>
<p class="toc level1 tocsp"><a href="scftm-1.html">Part&nbsp;IV&nbsp;Solaris Cryptographic Services</a></p>
<p class="toc level2"><a href="scf-1.html">13.&nbsp;&nbsp;Solaris Cryptographic Framework (Overview)</a></p>
<p class="toc level2"><a href="scftask-1.html">14.&nbsp;&nbsp;Solaris Cryptographic Framework (Tasks)</a></p>
<p class="toc level2"><a href="kmf-1.html">15.&nbsp;&nbsp;Solaris Key Management Framework</a></p>
<p class="toc level1 tocsp"><a href="authtm-1.html">Part&nbsp;V&nbsp;Authentication Services and Secure Communication</a></p>
<p class="toc level2"><a href="auth-1.html">16.&nbsp;&nbsp;Using Authentication Services (Tasks)</a></p>
<p class="toc level2"><a href="pam-1.html">17.&nbsp;&nbsp;Using PAM</a></p>
<p class="toc level2"><a href="sasl-1.html">18.&nbsp;&nbsp;Using SASL</a></p>
<p class="toc level2"><a href="sshuser-1.html">19.&nbsp;&nbsp;Using Solaris Secure Shell (Tasks)</a></p>
<p class="toc level2"><a href="sshref-1.html">20.&nbsp;&nbsp;Solaris Secure Shell (Reference)</a></p>
<p class="toc level1 tocsp"><a href="seamtm-1.html">Part&nbsp;VI&nbsp;Kerberos Service</a></p>
<p class="toc level2"><a href="intro-1.html">21.&nbsp;&nbsp;Introduction to the Kerberos Service</a></p>
<p class="toc level2"><a href="seamplan-1.html">22.&nbsp;&nbsp;Planning for the Kerberos Service</a></p>
<p class="toc level2"><a href="setup-8.html">23.&nbsp;&nbsp;Configuring the Kerberos Service (Tasks)</a></p>
<p class="toc level2"><a href="trouble-1.html">24.&nbsp;&nbsp;Kerberos Error Messages and Troubleshooting</a></p>
<p class="toc level2"><a href="aadmin-1.html">25.&nbsp;&nbsp;Administering Kerberos Principals and Policies (Tasks)</a></p>
<p class="toc level2"><a href="user-7.html">26.&nbsp;&nbsp;Using Kerberos Applications (Tasks)</a></p>
<p class="toc level2"><a href="refer-1.html">27.&nbsp;&nbsp;The Kerberos Service (Reference)</a></p>
<p class="toc level1 tocsp"><a href="audittm-1.html">Part&nbsp;VII&nbsp;Solaris Auditing</a></p>
<p class="toc level2"><a href="auditov-1.html">28.&nbsp;&nbsp;Solaris Auditing (Overview)</a></p>
<p class="toc level2"><a href="auditplan-1.html">29.&nbsp;&nbsp;Planning for Solaris Auditing</a></p>
<p class="toc level2"><a href="audittask-1.html">30.&nbsp;&nbsp;Managing Solaris Auditing (Tasks)</a></p>
<p class="toc level2"><a href="auditref-1.html">31.&nbsp;&nbsp;Solaris Auditing (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-2.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="secsystask-44"></a><h3>Monitoring and Restricting Superuser</h3>
<p>An alternative to using the superuser account is to set up role-based access
control. Role-based access control is called RBAC. For overview information on RBAC, see
<a href="rbac-1.html">Role-Based Access Control (Overview)</a>. To set up RBAC, see <a href="rbactask-1.html">Chapter&nbsp;9, Using Role-Based Access Control (Tasks)</a>.</p>

<a name="secsys-16"></a><h4>How to Monitor Who Is Using the <tt>su</tt> Command</h4><a name="indexterm-319"></a><a name="indexterm-320"></a><a name="indexterm-321"></a><a name="indexterm-322"></a><a name="indexterm-323"></a><a name="indexterm-324"></a><a name="indexterm-325"></a><a name="indexterm-326"></a><a name="indexterm-327"></a><p>The <tt>sulog</tt> file lists every use of the <tt>su</tt> command, not only the
<tt>su</tt> attempts that are used to switch from user to superuser.</p><ul>
<li><b><a name="indexterm-328"></a><a name="indexterm-329"></a>Monitor the contents of the <tt>/var/adm/sulog</tt> file on a regular basis.</b><pre># <tt><b>more /var/adm/sulog</b></tt>
SU 12/20 16:26 + pts/0 stacey-root
SU 12/21 10:59 + pts/0 stacey-root
SU 01/12 11:11 + pts/0 root-rimmer
SU 01/12 14:56 + pts/0 pmorph-root
SU 01/12 14:57 + pts/0 pmorph-root</pre><p>The entries display the following information:</p>
<ul><li><p>The date and time that the command was entered.</p></li>
<li><p><a name="indexterm-330"></a><a name="indexterm-331"></a><a name="indexterm-332"></a><a name="indexterm-333"></a>If the attempt was successful. A plus sign (<tt>+</tt>) indicates a successful attempt. A minus sign (<tt>-</tt>) indicates an unsuccessful attempt.</p></li>
<li><p>The port from which the command was issued.</p></li>
<li><p>The name of the user and the name of the switched identity.</p></li></ul>
<p>The <tt>su</tt> logging in this file is enabled by default through the following
entry in the <tt>/etc/default/su</tt> file:</p><pre>SULOG=/var/adm/sulog</pre></li></ul><h6>Troubleshooting</h6><p>Entries that include <tt>???</tt> indicate that the controlling terminal for the <tt>su</tt> command
cannot be identified. Typically, system invocations of the <tt>su</tt> command before the desktop appears
include <tt>???</tt>, as in <tt>SU 10/10 08:08 + ??? root-root</tt>. After the user starts a desktop session, the
<tt>ttynam</tt> command returns the value of the controlling terminal to the <tt>sulog</tt>: <tt>SU 10/10 10:10 + pts/3 jdoe-root</tt>.</p><p>Entries similar to the following can indicate that the <tt>su</tt> command was not
invoked on the command line: <tt>SU 10/10 10:20 + ??? root-oracle</tt>. The user might have switched to
the oracle role by using a GUI.</p>

<a name="secsys-23"></a><h4>How to Restrict and Monitor Superuser Logins</h4><a name="indexterm-334"></a><a name="indexterm-335"></a><a name="indexterm-336"></a><a name="indexterm-337"></a><a name="indexterm-338"></a><a name="indexterm-339"></a><a name="indexterm-340"></a><a name="indexterm-341"></a><a name="indexterm-342"></a><a name="indexterm-343"></a><a name="indexterm-344"></a><a name="indexterm-345"></a><a name="indexterm-346"></a><a name="indexterm-347"></a><a name="indexterm-348"></a><a name="indexterm-349"></a><a name="indexterm-350"></a><a name="indexterm-351"></a><a name="indexterm-352"></a><a name="indexterm-353"></a><a name="indexterm-354"></a><p>This method immediately detects superuser attempts to access the local system.</p><ol>
<li><b>View the <tt>CONSOLE</tt> entry in the <tt>/etc/default/login</tt> file.</b><pre>CONSOLE=/dev/console</pre><p>By default, the console device is set to <tt>/dev/console</tt>. With this setting, <tt>root</tt>
can log in to the console. <tt>root</tt> cannot log in remotely.</p></li>
<li><b>Verify that <tt>root</tt> cannot log in remotely.</b><p>From a remote system, try to log in as superuser.</p><pre>mach2 % <tt><b>rlogin -l root mach1</b></tt>
Password: &lt;Type root password of mach1&gt;
Not on system console
Connection closed.</pre></li>
<li><b>Monitor attempts to become superuser.</b><p>By default,  attempts to become superuser are printed to the console by
the <tt>SYSLOG</tt> utility.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>Open a terminal console on your desktop.</b></li>
<li><b>In another window, use the <tt>su</tt> command to become superuser.</b><pre>% <tt><b>su -</b></tt>
Password: &lt;Type root password&gt;
#</pre><p>A message is printed on the terminal console.</p><pre>Sep 7 13:22:57 mach1 su: 'su root' succeeded for jdoe on /dev/pts/6</pre></li></ol></li></ol><a name="secsys-45"></a><h6>Example&nbsp;3-7 Logging Superuser Access Attempts</h6><p>In this example, superuser attempts are not being logged by <tt>SYSLOG</tt>. Therefore,
the administrator is logging those attempts by removing the comment from the <tt>#CONSOLE=/dev/console</tt>
entry in the <tt>/etc/default/su</tt> file.</p><pre># CONSOLE determines whether attempts to su to root should be logged
# to the named device
#
CONSOLE=/dev/console</pre><p>When a user attempts to become superuser, the attempt is printed on the
terminal console.</p><pre>SU 09/07 16:38 + pts/8 jdoe-root</pre><h6>Troubleshooting</h6><p>To become superuser from a remote system when the <tt>/etc/default/login</tt> file contains
the default <tt>CONSOLE</tt> entry, users must first log in with their user name.
After logging in with their user name, users then can use the <tt>su</tt>
command to become superuser.</p><p>If the console displays an entry similar to <tt>Mar 16 16:20:36 mach1 login: ROOT LOGIN /dev/pts/14 FROM mach2.Example.COM</tt>, then the system is
permitting remote <tt>root</tt> logins. To prevent remote superuser access,  change the <tt>#CONSOLE=/dev/console</tt>
entry to <tt>CONSOLE=/dev/console</tt> in the <tt>/etc/default/login</tt> file.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="secsys-37.html">Previous</a>
             </td>
             <td align="right">
                 <a href="secsys-29.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

