<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Planning Solaris Auditing (Tasks) - System Administration Guide: Security Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Security Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="auditplan-11.html">Previous</a>
             </td>
             <td align="right">
                 <a href="auditplan-5.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="oview-1.html">Part&nbsp;I&nbsp;Security Overview</a></p>
<p class="toc level2"><a href="secov-1.html">1.&nbsp;&nbsp;Security Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="sectm-1.html">Part&nbsp;II&nbsp;System, File, and Device Security</a></p>
<p class="toc level2"><a href="concept-1.html">2.&nbsp;&nbsp;Managing Machine Security (Overview)</a></p>
<p class="toc level2"><a href="secsys-1.html">3.&nbsp;&nbsp;Controlling Access to Systems (Tasks)</a></p>
<p class="toc level2"><a href="vscan-1.html">4.&nbsp;&nbsp;Virus Scanning Service (Tasks)</a></p>
<p class="toc level2"><a href="devtask-1.html">5.&nbsp;&nbsp;Controlling Access to Devices (Tasks)</a></p>
<p class="toc level2"><a href="bart-1.html">6.&nbsp;&nbsp;Using the Basic Audit Reporting Tool (Tasks)</a></p>
<p class="toc level2"><a href="secfile-1.html">7.&nbsp;&nbsp;Controlling Access to Files (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="prbactm-1.html">Part&nbsp;III&nbsp;Roles, Rights Profiles, and Privileges</a></p>
<p class="toc level2"><a href="prbac-1.html">8.&nbsp;&nbsp;Using Roles and Privileges (Overview)</a></p>
<p class="toc level2"><a href="rbactask-1.html">9.&nbsp;&nbsp;Using Role-Based Access Control (Tasks)</a></p>
<p class="toc level2"><a href="rbacref-1.html">10.&nbsp;&nbsp;Role-Based Access Control (Reference)</a></p>
<p class="toc level2"><a href="privtask-1.html">11.&nbsp;&nbsp;Privileges (Tasks)</a></p>
<p class="toc level2"><a href="privref-1.html">12.&nbsp;&nbsp;Privileges (Reference)</a></p>
<p class="toc level1 tocsp"><a href="scftm-1.html">Part&nbsp;IV&nbsp;Solaris Cryptographic Services</a></p>
<p class="toc level2"><a href="scf-1.html">13.&nbsp;&nbsp;Solaris Cryptographic Framework (Overview)</a></p>
<p class="toc level2"><a href="scftask-1.html">14.&nbsp;&nbsp;Solaris Cryptographic Framework (Tasks)</a></p>
<p class="toc level2"><a href="kmf-1.html">15.&nbsp;&nbsp;Solaris Key Management Framework</a></p>
<p class="toc level1 tocsp"><a href="authtm-1.html">Part&nbsp;V&nbsp;Authentication Services and Secure Communication</a></p>
<p class="toc level2"><a href="auth-1.html">16.&nbsp;&nbsp;Using Authentication Services (Tasks)</a></p>
<p class="toc level2"><a href="pam-1.html">17.&nbsp;&nbsp;Using PAM</a></p>
<p class="toc level2"><a href="sasl-1.html">18.&nbsp;&nbsp;Using SASL</a></p>
<p class="toc level2"><a href="sshuser-1.html">19.&nbsp;&nbsp;Using Solaris Secure Shell (Tasks)</a></p>
<p class="toc level2"><a href="sshref-1.html">20.&nbsp;&nbsp;Solaris Secure Shell (Reference)</a></p>
<p class="toc level1 tocsp"><a href="seamtm-1.html">Part&nbsp;VI&nbsp;Kerberos Service</a></p>
<p class="toc level2"><a href="intro-1.html">21.&nbsp;&nbsp;Introduction to the Kerberos Service</a></p>
<p class="toc level2"><a href="seamplan-1.html">22.&nbsp;&nbsp;Planning for the Kerberos Service</a></p>
<p class="toc level2"><a href="setup-8.html">23.&nbsp;&nbsp;Configuring the Kerberos Service (Tasks)</a></p>
<p class="toc level2"><a href="trouble-1.html">24.&nbsp;&nbsp;Kerberos Error Messages and Troubleshooting</a></p>
<p class="toc level2"><a href="aadmin-1.html">25.&nbsp;&nbsp;Administering Kerberos Principals and Policies (Tasks)</a></p>
<p class="toc level2"><a href="user-7.html">26.&nbsp;&nbsp;Using Kerberos Applications (Tasks)</a></p>
<p class="toc level2"><a href="refer-1.html">27.&nbsp;&nbsp;The Kerberos Service (Reference)</a></p>
<p class="toc level1 tocsp"><a href="audittm-1.html">Part&nbsp;VII&nbsp;Solaris Auditing</a></p>
<p class="toc level2"><a href="auditov-1.html">28.&nbsp;&nbsp;Solaris Auditing (Overview)</a></p>
<p class="toc level2"><a href="auditplan-1.html">29.&nbsp;&nbsp;Planning for Solaris Auditing</a></p>
<p class="toc level3"><a href="auditplan-11.html">Planning Solaris Auditing (Task Map)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Planning Solaris Auditing (Tasks)</a></p>
</div>
<p class="toc level3"><a href="auditplan-5.html">Determining Audit Policy</a></p>
<p class="toc level3"><a href="auditplan-3.html">Controlling Auditing Costs</a></p>
<p class="toc level3"><a href="auditplan-9.html">Auditing Efficiently</a></p>
<p class="toc level2 tocsp"><a href="audittask-1.html">30.&nbsp;&nbsp;Managing Solaris Auditing (Tasks)</a></p>
<p class="toc level2"><a href="auditref-1.html">31.&nbsp;&nbsp;Solaris Auditing (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-2.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="auditplan-12"></a><h3>Planning Solaris Auditing (Tasks)</h3>
<a name="indexterm-3160"></a><a name="indexterm-3161"></a><a name="indexterm-3162"></a><p>You want to be selective about what kinds of activities are audited. At
the same time, you want to collect useful audit information. Audit files can
quickly grow to fill the available space, so you should allocate enough disk
space. You also need to carefully plan who to audit and what
to audit.</p>

<a name="auditplan-10"></a><h4>How to Plan Auditing in Zones</h4><a name="indexterm-3163"></a><a name="indexterm-3164"></a><a name="indexterm-3165"></a><a name="indexterm-3166"></a><a name="indexterm-3167"></a><a name="indexterm-3168"></a><p>If your system has implemented zones, you have two audit configuration possibilities:</p>
<ul><li><p>You can configure a single audit service in the global zone for all zones.</p></li>
<li><p>You can configure one audit service per zone.</p></li></ul>
<p>For a discussion of the trade-offs, see <a href="auditov-8.html">Auditing on a System With Zones</a>.</p><ul>
<li><b>Choose one of the following methods.</b><ul>
<li><a name="auditplan-zone-1"></a><b>OPTION 1 - Configure a single audit service for all zones.</b><p><a name="indexterm-3169"></a>Auditing all zones identically can create a single-image audit trail. A single-image audit
trail occurs when all zones on a system are part of one administrative
domain. The audit records can then be easily compared, because the records in
every zone are preselected with identical settings.</p><p>This configuration treats all zones as part of one system. The global zone
runs the only audit daemon on a system, and collects audit logs for
every zone. You customize audit configuration files only in the global zone, then
copy the audit configuration files to every non-global zone.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>Copy the <tt>audit_control</tt> file from the global zone to every non-global zone.</b></li>
<li><b>Use the same <tt>audit_user</tt> database for every zone.</b><p>The <tt>audit_user</tt> database might be a local file, or you might get it
from a shared naming service.</p></li>
<li><b>Enable the audit records to be selected by zone.</b><p>To put the zone name as part of the audit record, set the
<tt>zonename</tt> policy in the global zone. The <tt>auditreduce</tt> command can then select audit events
by zone. For an example, see the <a href="http://docs.sun.com/doc/819-2240/auditreduce-1m?a=view"><tt>auditreduce</tt>(1M)</a> man page.</p></li></ol><p>To plan a single-image audit trail, use <a href="#auditplan-6">How to Plan Who and What to Audit</a> to plan. Start with
the first step. The global zone administrator must also set aside storage, as
described in <a href="#auditplan-2">How to Plan Storage for Audit Records</a>.</p></li>
<li><b>OPTION 2 - Configure one audit service per zone.</b><p>Choose to configure per-zone auditing if different zones have different name service files, or
if zone administrators want to control auditing in their zones.</p>
<ul><li><p><a name="indexterm-3170"></a><a name="indexterm-3171"></a>When you configure per-zone auditing, you must configure the global zone for auditing. You set the <tt>perzone</tt> audit policy in the global zone.</p>
<hr><p><b>Note - </b>If name service files are customized in non-global zones, and <tt>perzone</tt> policy is not set, then careful use of the audit tools is required to select usable records. A user ID in one zone can refer to a different user from the same ID in a different zone.</p>
<hr>
</li>
<li><p><a name="indexterm-3172"></a><a name="indexterm-3173"></a>To generate records that can be traced to their originating zone, set the <tt>zonename</tt> audit policy in the global zone. In the global zone, run the <tt>auditreduce</tt> command with the <tt>zonename</tt> option. Then, in the <tt>zonename</tt> zone, run the <tt>praudit</tt> command on the <tt>auditreduce</tt> output.</p></li>
<li><p>Each zone administrator configures the audit files for the zone.</p><p>A non-global zone administrator can set all policy options except <tt>perzone</tt> and <tt>ahlt</tt>.</p></li>
<li><p>Each zone administrator can enable or disable auditing in the zone.</p></li></ul>
<p>If you customize audit configuration files in every zone, use <a href="#auditplan-6">How to Plan Who and What to Audit</a> to
plan for every zone. You can skip the first step. Each zone administrator
must also set aside storage for every zone, as described in <a href="#auditplan-2">How to Plan Storage for Audit Records</a>.</p></li></ul></li></ul>

<a name="auditplan-2"></a><h4>How to Plan Storage for Audit Records</h4><a name="indexterm-3174"></a><a name="indexterm-3175"></a><p>The audit trail requires dedicated file space. The dedicated file space for audit
files must be available and secure. Each system should have several audit directories
that are configured for audit files. You should decide how to configure the
audit directories as one of the first tasks before you enable auditing on
any systems. The following procedure covers the issues to be resolved when you
plan for audit trail storage.</p><h6>Before You Begin</h6><p>If you are implementing non-global zones, complete <a href="#auditplan-10">How to Plan Auditing in Zones</a> before using this procedure.</p><ol>
<li><b>Determine how much auditing your site needs.</b><p>Balance your site's security needs against the availability of disk space for the audit
trail.</p><p>For guidance on how to reduce space requirements while still maintaining site security,
as well as how to design audit storage, see <a href="auditplan-3.html">Controlling Auditing Costs</a> and <a href="auditplan-9.html">Auditing Efficiently</a>.</p></li>
<li><b>Determine which systems are to be audited.</b><p>On those systems,  allocate space for at least one local audit directory.
To specify the audit directories, see <a href="audittask-44.html#audittask-50">Example&nbsp;30-3</a>.</p></li>
<li><b>Determine which systems are to store audit files.</b><p>Decide which servers are to hold the primary and secondary audit directories. For examples
of configuring disks for audit directories, see <a href="audittask-28.html#audittask-8">How to Create Partitions for Audit Files</a>.</p></li>
<li><b>Name the audit directories.</b><p>Create a list of all the audit directories that you plan to use.
For the naming conventions, see <a href="auditref-77.html">Conventions for Binary Audit File Names</a></p></li>
<li><b>Determine which systems are to use which audit directories.</b><p>Create a map that shows which system should use which audit directory. The
map helps you to balance the auditing activity. For an illustration, see
<a href="auditref-36.html#auditref-fig-2">Figure&nbsp;31-1</a> and <a href="auditref-36.html#auditref-fig-3">Figure&nbsp;31-2</a>.</p></li></ol>

<a name="auditplan-6"></a><h4>How to Plan Who and What to Audit</h4><a name="indexterm-3176"></a><h6>Before You Begin</h6><p>If you are implementing non-global zones, complete <a href="#auditplan-10">How to Plan Auditing in Zones</a> before using this procedure.</p><ol>
<li><a name="auditplan-single-1"></a><b>Determine if you want a single-system image audit trail.</b><p>Systems within a single administrative domain can create a single-system image audit trail.
If your systems use different naming services, start with the next step. You
should complete the rest of the planning steps for every system.</p><p>A single-system image audit trail treats the systems that are being audited as
one machine. To create a single-system image audit trail for a site, every
system in the installation should be configured as follows:</p>
<ul><li><p>Use the same naming service.</p><p>To interpret the audit records, two commands are used, <tt>auditreduce</tt> and <tt>praudit</tt>. For correct interpretation of the audit records, the <tt>passwd</tt>, <tt>hosts</tt>, and <tt>audit_user</tt> files must be consistent.</p></li>
<li><p>Use the same <tt>audit_warn</tt>, <tt>audit_event</tt>, <tt>audit_class</tt>, and <tt>audit_startup</tt> files as every other system.</p></li>
<li><p>Use the same <tt>audit_user</tt> database. The database can be in a naming service such as NIS or LDAP.</p></li>
<li><p>Have identical <tt>flags</tt>, <tt>naflags</tt>, and <tt>plugin</tt> entries in the <tt>audit_control</tt> file.</p></li></ul>
</li>
<li><a name="auditplan-policy-1"></a><b>Determine the audit policy.</b><p>Use the <tt>auditconfig -lspolicy</tt> command to see a short description of available policy options. By
default, only the <tt>cnt</tt> policy is turned on. For a fuller discussion, see
<a href="#auditplan-overflow-1">Step&nbsp;8</a>.</p><p>For the effects of the policy options, see <a href="auditplan-5.html">Determining Audit Policy</a>. To set audit policy,
see <a href="audittask-28.html#audittask-18">How to Configure Audit Policy</a>.</p></li>
<li><b>Determine if you want to modify event-to-class mappings.</b><p>In many situations, the default mapping is sufficient. However, if you add new
classes, change class definitions, or determine that a record of a specific system
call is not useful, you might also need to move an event
to a different class.</p><p>For an example, see <a href="audittask-44.html#audittask-59">How to Change an Audit Event's Class Membership</a>.</p></li>
<li><a name="auditplan-preselect-1"></a><b>Determine which audit classes to preselect.</b><p>The best time to add audit classes or to change the default
classes is before you start the auditing service.</p><p>The audit class values of the <tt>flags</tt>, <tt>naflags</tt>, and <tt>plugin</tt> entries in the <tt>audit_control</tt>
file apply to all users and processes. The preselected classes determine whether an
audit class is audited for success, for failure, or for both.</p><p>To preselect audit classes, see <a href="audittask-44.html#audittask-45">How to Modify the <tt>audit_control</tt> File</a>.</p></li>
<li><b>Determine user exceptions to the system-wide preselected audit classes.</b><p>If you decide that some users should be audited differently from the system-wide
preselected audit classes, modify the individual users' entries in the <tt>audit_user</tt> database.</p><p>For an example, see <a href="audittask-44.html#audittask-53">How to Change a User's Audit Characteristics</a>.</p></li>
<li><b>Determine the minimum free disk space.</b><p>When disk space on an audit file system drops below the <tt>minfree</tt> percentage, the
<tt>auditd</tt> daemon switches to the next available audit directory. The daemon then sends
a warning that the soft limit has been exceeded.</p><p>To set the minimum free disk space, see <a href="audittask-44.html#audittask-49">Example&nbsp;30-4</a>.</p></li>
<li><b>Decide how to manage the <tt>audit_warn</tt> email alias.</b><p>The <tt>audit_warn</tt> script is run whenever the audit system needs to notify you
of a situation that requires administrative attention. By default, the <tt>audit_warn</tt> script sends
email to an <tt>audit_warn</tt> alias and sends a message to the console.</p><p>To set up the alias, see <a href="audittask-28.html#audittask-16">How to Configure the <tt>audit_warn</tt> Email Alias</a>.</p></li>
<li><a name="auditplan-overflow-1"></a><b>Decide what action to take when all the audit directories are full.</b><p>By default, when the audit trail overflows, the system continues to work. The
system counts the audit records that are dropped, but does not record the
events. For greater security, you can disable the <tt>cnt</tt> policy, and enable the
<tt>ahlt</tt> policy. The <tt>ahlt</tt> policy stops the system when the audit audit trail
overflows.</p><p>To configure these policy options, see <a href="audittask-28.html#audittask-90">Example&nbsp;30-14</a>.</p></li>
<li><b>Decide whether to collect audit records in <tt>syslog</tt> format as well as in
binary logs.</b><p>For overview information, see <a href="auditov-6.html#auditov-21">Audit Files</a>.</p><p>For an example, see <a href="audittask-44.html#audittask-11">How to Configure <tt>syslog</tt> Audit Logs</a>.</p></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="auditplan-11.html">Previous</a>
             </td>
             <td align="right">
                 <a href="auditplan-5.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

