<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Protecting Against Programs With Security Risk (Task Map) - System Administration Guide: Security Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Security Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="secfile-30.html">Previous</a>
             </td>
             <td align="right">
                 <a href="prbactm-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="oview-1.html">Part&nbsp;I&nbsp;Security Overview</a></p>
<p class="toc level2"><a href="secov-1.html">1.&nbsp;&nbsp;Security Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="sectm-1.html">Part&nbsp;II&nbsp;System, File, and Device Security</a></p>
<p class="toc level2"><a href="concept-1.html">2.&nbsp;&nbsp;Managing Machine Security (Overview)</a></p>
<p class="toc level2"><a href="secsys-1.html">3.&nbsp;&nbsp;Controlling Access to Systems (Tasks)</a></p>
<p class="toc level2"><a href="vscan-1.html">4.&nbsp;&nbsp;Virus Scanning Service (Tasks)</a></p>
<p class="toc level2"><a href="devtask-1.html">5.&nbsp;&nbsp;Controlling Access to Devices (Tasks)</a></p>
<p class="toc level2"><a href="bart-1.html">6.&nbsp;&nbsp;Using the Basic Audit Reporting Tool (Tasks)</a></p>
<p class="toc level2"><a href="secfile-1.html">7.&nbsp;&nbsp;Controlling Access to Files (Tasks)</a></p>
<p class="toc level3"><a href="secfile-60.html">Using UNIX Permissions to Protect Files</a></p>
<p class="toc level3"><a href="secfile-37.html">Using Access Control Lists to Protect Files</a></p>
<p class="toc level3"><a href="secfile-68.html">Preventing Executable Files From Compromising Security</a></p>
<p class="toc level3"><a href="secfile-10.html">Protecting Files (Task Map)</a></p>
<p class="toc level3"><a href="secfile-15.html">Protecting Files With UNIX Permissions (Task Map)</a></p>
<p class="toc level3"><a href="secfile-30.html">Protecting Files With ACLs (Task Map)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Protecting Against Programs With Security Risk (Task Map)</a></p>
</div>
<p class="toc level1 tocsp"><a href="prbactm-1.html">Part&nbsp;III&nbsp;Roles, Rights Profiles, and Privileges</a></p>
<p class="toc level2"><a href="prbac-1.html">8.&nbsp;&nbsp;Using Roles and Privileges (Overview)</a></p>
<p class="toc level2"><a href="rbactask-1.html">9.&nbsp;&nbsp;Using Role-Based Access Control (Tasks)</a></p>
<p class="toc level2"><a href="rbacref-1.html">10.&nbsp;&nbsp;Role-Based Access Control (Reference)</a></p>
<p class="toc level2"><a href="privtask-1.html">11.&nbsp;&nbsp;Privileges (Tasks)</a></p>
<p class="toc level2"><a href="privref-1.html">12.&nbsp;&nbsp;Privileges (Reference)</a></p>
<p class="toc level1 tocsp"><a href="scftm-1.html">Part&nbsp;IV&nbsp;Solaris Cryptographic Services</a></p>
<p class="toc level2"><a href="scf-1.html">13.&nbsp;&nbsp;Solaris Cryptographic Framework (Overview)</a></p>
<p class="toc level2"><a href="scftask-1.html">14.&nbsp;&nbsp;Solaris Cryptographic Framework (Tasks)</a></p>
<p class="toc level2"><a href="kmf-1.html">15.&nbsp;&nbsp;Solaris Key Management Framework</a></p>
<p class="toc level1 tocsp"><a href="authtm-1.html">Part&nbsp;V&nbsp;Authentication Services and Secure Communication</a></p>
<p class="toc level2"><a href="auth-1.html">16.&nbsp;&nbsp;Using Authentication Services (Tasks)</a></p>
<p class="toc level2"><a href="pam-1.html">17.&nbsp;&nbsp;Using PAM</a></p>
<p class="toc level2"><a href="sasl-1.html">18.&nbsp;&nbsp;Using SASL</a></p>
<p class="toc level2"><a href="sshuser-1.html">19.&nbsp;&nbsp;Using Solaris Secure Shell (Tasks)</a></p>
<p class="toc level2"><a href="sshref-1.html">20.&nbsp;&nbsp;Solaris Secure Shell (Reference)</a></p>
<p class="toc level1 tocsp"><a href="seamtm-1.html">Part&nbsp;VI&nbsp;Kerberos Service</a></p>
<p class="toc level2"><a href="intro-1.html">21.&nbsp;&nbsp;Introduction to the Kerberos Service</a></p>
<p class="toc level2"><a href="seamplan-1.html">22.&nbsp;&nbsp;Planning for the Kerberos Service</a></p>
<p class="toc level2"><a href="setup-8.html">23.&nbsp;&nbsp;Configuring the Kerberos Service (Tasks)</a></p>
<p class="toc level2"><a href="trouble-1.html">24.&nbsp;&nbsp;Kerberos Error Messages and Troubleshooting</a></p>
<p class="toc level2"><a href="aadmin-1.html">25.&nbsp;&nbsp;Administering Kerberos Principals and Policies (Tasks)</a></p>
<p class="toc level2"><a href="user-7.html">26.&nbsp;&nbsp;Using Kerberos Applications (Tasks)</a></p>
<p class="toc level2"><a href="refer-1.html">27.&nbsp;&nbsp;The Kerberos Service (Reference)</a></p>
<p class="toc level1 tocsp"><a href="audittm-1.html">Part&nbsp;VII&nbsp;Solaris Auditing</a></p>
<p class="toc level2"><a href="auditov-1.html">28.&nbsp;&nbsp;Solaris Auditing (Overview)</a></p>
<p class="toc level2"><a href="auditplan-1.html">29.&nbsp;&nbsp;Planning for Solaris Auditing</a></p>
<p class="toc level2"><a href="audittask-1.html">30.&nbsp;&nbsp;Managing Solaris Auditing (Tasks)</a></p>
<p class="toc level2"><a href="auditref-1.html">31.&nbsp;&nbsp;Solaris Auditing (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-2.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="secfile-40"></a><h3>Protecting Against Programs With Security Risk (Task Map)</h3>
<a name="indexterm-987"></a><a name="indexterm-988"></a><a name="indexterm-989"></a><p><a name="indexterm-990"></a><a name="indexterm-991"></a>The following task map points to procedures that find risky executables on the
system, and that prevent programs from exploiting an executable stack.</p><table><col width="27%"><col width="42%"><col width="30%"><tr><th align="left" valign="top" scope="column"><p>Task</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
<th align="left" valign="top" scope="column"><p>For Instructions</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Find files
with special permissions</p></td>
<td align="left" valign="top" scope="row"><p>Locates files with the <tt>setuid</tt> bit set, but that are not
owned by the <tt>root</tt> user.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#secfile-23">How to Find Files With Special File Permissions</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Prevent executable stack from overflowing</p></td>
<td align="left" valign="top" scope="row"><p>Prevents programs from exploiting
an executable stack.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#secfile-71">How to Disable Programs From Using Executable Stacks</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Prevent logging of executable stack messages</p></td>
<td align="left" valign="top" scope="row"><p>Turns off logging of executable
stack messages.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#secfile-70">Example&nbsp;7-13</a></p></td>
</tr>
</table>

<a name="secfile-23"></a><h4>How to Find Files With Special File Permissions</h4><p><a name="indexterm-992"></a><a name="indexterm-993"></a><a name="indexterm-994"></a><a name="indexterm-995"></a><a name="indexterm-996"></a>You should monitor your system for any unauthorized use of the <tt>setuid</tt>
and <tt>setgid</tt> permissions on programs. The <tt>setuid</tt> and <tt>setgid</tt> permissions enable ordinary users
to gain superuser capabilities. A suspicious executable file grants ownership to a user
rather than to <tt>root</tt> or <tt>bin</tt>.</p><ol>
<li><b>Assume the Primary Administrator role, or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role
and assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><b>Find files with <tt>setuid</tt> permissions by using the <tt>find</tt> command.</b><pre># find <i>directory</i> -user root -perm -4000 -exec ls -ldb {} \; &gt;/tmp/<i>filename</i></pre><dl><dt><tt>find</tt> <i>directory</i></dt>
<dd><p>Checks all mounted paths starting at the specified <i>directory</i>, which can be root (<tt>/</tt>), <tt>sys</tt>, <tt>bin</tt>, or <tt>mail</tt>.</p></dd>
<dt><tt>-user</tt> <tt>root</tt></dt>
<dd><p>Displays files owned only by <tt>root</tt>.</p></dd>
<dt><tt>-perm</tt> <tt>-4000</tt></dt>
<dd><p>Displays files only with permissions set to <tt>4000</tt>.</p></dd>
<dt><tt>-exec</tt> <tt>ls</tt> <tt>-ldb</tt></dt>
<dd><p>Displays the output of the <tt>find</tt> command in <tt>ls -ldb</tt> format.</p></dd>
<dt><tt>&gt;/tmp/</tt><i>filename</i></dt>
<dd><p>Is the file that contains the results of the <tt>find</tt> command.</p></dd>
</dl>
</li>
<li><b>Display the results in <tt>/tmp/</tt><i>filename</i>.</b><pre># more <tt>/tmp/</tt><i>filename</i></pre><p>For background information on <tt>setuid</tt> permissions, see <a href="secfile-60.html#secfile-64"><tt>setuid</tt> Permission</a>.</p></li></ol><a name="secfile-36"></a><h6>Example&nbsp;7-12 Finding Files With <tt>setuid</tt> Permissions</h6><p>The output from the following example shows that a user named <tt>rar</tt>
has made a personal copy of <tt>/usr/bin/sh</tt>, and has set the permissions as <tt>setuid</tt>
to <tt>root</tt>. As a result, the <tt>/usr/rar/bin/sh</tt> program runs with <tt>root</tt> permissions. </p><p>This output was saved for future reference by moving the file out
of the <tt>/tmp</tt> directory.</p><pre># <tt><b>find / -user root -perm -4000 -exec ls -ldb {} \; &gt; /var/tmp/ckprm</b></tt>
# <tt><b>cat /var/tmp/ckprm</b></tt>
-r-sr-xr-x 1 root bin 38836 Aug 10 16:16 /usr/bin/at
-r-sr-xr-x 1 root bin 19812 Aug 10 16:16 /usr/bin/crontab
---s--x--x 1 root sys 46040 Aug 10 15:18 /usr/bin/ct
-r-sr-xr-x 1 root sys 12092 Aug 11 01:29 /usr/lib/mv_dir
-r-sr-sr-x 1 root bin 33208 Aug 10 15:55 /usr/lib/lpadmin
-r-sr-sr-x 1 root bin 38696 Aug 10 15:55 /usr/lib/lpsched
---s--x--- 1 root rar 45376 Aug 18 15:11 /usr/rar/bin/sh
-r-sr-xr-x 1 root bin 12524 Aug 11 01:27 /usr/bin/df
-rwsr-xr-x 1 root sys 21780 Aug 11 01:27 /usr/bin/newgrp
-r-sr-sr-x 1 root sys 23000 Aug 11 01:27 /usr/bin/passwd
-r-sr-xr-x 1 root sys 23824 Aug 11 01:27 /usr/bin/su
# <tt><b>mv /var/tmp/ckprm /export/sysreports/ckprm</b></tt></pre>

<a name="secfile-71"></a><h4>How to Disable Programs From Using Executable Stacks</h4><a name="indexterm-997"></a><a name="indexterm-998"></a><a name="indexterm-999"></a><p>For a description of the security risks of executable stacks, see <a href="secfile-68.html">Preventing Executable Files From Compromising Security</a>.</p><ol>
<li><b>Assume the Primary Administrator role, or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role
and assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><b><a name="indexterm-1000"></a><a name="indexterm-1001"></a>Edit the <tt>/etc/system</tt> file, and add the following line:</b><pre>set noexec_user_stack=1</pre></li>
<li><b>Reboot the system.</b><pre># <tt><b>init 6</b></tt></pre></li></ol><a name="secfile-70"></a><h6>Example&nbsp;7-13 Disabling the Logging of Executable Stack Messages</h6><a name="indexterm-1002"></a><a name="indexterm-1003"></a><a name="indexterm-1004"></a><a name="indexterm-1005"></a><p>In this example, the logging of executable stack messages is disabled, and then
the system is rebooted.</p><pre># <tt><b>cat /etc/system</b></tt>
set noexec_user_stack=1
<tt><b>set noexec_user_stack_log=0</b></tt>
# <tt><b>init 6</b></tt></pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="secfile-30.html">Previous</a>
             </td>
             <td align="right">
                 <a href="prbactm-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

