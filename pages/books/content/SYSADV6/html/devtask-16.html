<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Device Protection (Reference) - System Administration Guide: Security Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Security Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="devtask-52.html">Previous</a>
             </td>
             <td align="right">
                 <a href="bart-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="oview-1.html">Part&nbsp;I&nbsp;Security Overview</a></p>
<p class="toc level2"><a href="secov-1.html">1.&nbsp;&nbsp;Security Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="sectm-1.html">Part&nbsp;II&nbsp;System, File, and Device Security</a></p>
<p class="toc level2"><a href="concept-1.html">2.&nbsp;&nbsp;Managing Machine Security (Overview)</a></p>
<p class="toc level2"><a href="secsys-1.html">3.&nbsp;&nbsp;Controlling Access to Systems (Tasks)</a></p>
<p class="toc level2"><a href="vscan-1.html">4.&nbsp;&nbsp;Virus Scanning Service (Tasks)</a></p>
<p class="toc level2"><a href="devtask-1.html">5.&nbsp;&nbsp;Controlling Access to Devices (Tasks)</a></p>
<p class="toc level3"><a href="devtask-45.html">Configuring Devices (Task Map)</a></p>
<p class="toc level3"><a href="devtask-10.html">Configuring Device Policy (Task Map)</a></p>
<p class="toc level3"><a href="devtask-30.html">Configuring Device Policy</a></p>
<p class="toc level3"><a href="devtask-3.html">Managing Device Allocation (Task Map)</a></p>
<p class="toc level3"><a href="devtask-32.html">Managing Device Allocation</a></p>
<p class="toc level3"><a href="devtask-48.html">Allocating Devices (Task Map)</a></p>
<p class="toc level3"><a href="devtask-52.html">Allocating Devices</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Device Protection (Reference)</a></p>
</div>
<p class="toc level2 tocsp"><a href="bart-1.html">6.&nbsp;&nbsp;Using the Basic Audit Reporting Tool (Tasks)</a></p>
<p class="toc level2"><a href="secfile-1.html">7.&nbsp;&nbsp;Controlling Access to Files (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="prbactm-1.html">Part&nbsp;III&nbsp;Roles, Rights Profiles, and Privileges</a></p>
<p class="toc level2"><a href="prbac-1.html">8.&nbsp;&nbsp;Using Roles and Privileges (Overview)</a></p>
<p class="toc level2"><a href="rbactask-1.html">9.&nbsp;&nbsp;Using Role-Based Access Control (Tasks)</a></p>
<p class="toc level2"><a href="rbacref-1.html">10.&nbsp;&nbsp;Role-Based Access Control (Reference)</a></p>
<p class="toc level2"><a href="privtask-1.html">11.&nbsp;&nbsp;Privileges (Tasks)</a></p>
<p class="toc level2"><a href="privref-1.html">12.&nbsp;&nbsp;Privileges (Reference)</a></p>
<p class="toc level1 tocsp"><a href="scftm-1.html">Part&nbsp;IV&nbsp;Solaris Cryptographic Services</a></p>
<p class="toc level2"><a href="scf-1.html">13.&nbsp;&nbsp;Solaris Cryptographic Framework (Overview)</a></p>
<p class="toc level2"><a href="scftask-1.html">14.&nbsp;&nbsp;Solaris Cryptographic Framework (Tasks)</a></p>
<p class="toc level2"><a href="kmf-1.html">15.&nbsp;&nbsp;Solaris Key Management Framework</a></p>
<p class="toc level1 tocsp"><a href="authtm-1.html">Part&nbsp;V&nbsp;Authentication Services and Secure Communication</a></p>
<p class="toc level2"><a href="auth-1.html">16.&nbsp;&nbsp;Using Authentication Services (Tasks)</a></p>
<p class="toc level2"><a href="pam-1.html">17.&nbsp;&nbsp;Using PAM</a></p>
<p class="toc level2"><a href="sasl-1.html">18.&nbsp;&nbsp;Using SASL</a></p>
<p class="toc level2"><a href="sshuser-1.html">19.&nbsp;&nbsp;Using Solaris Secure Shell (Tasks)</a></p>
<p class="toc level2"><a href="sshref-1.html">20.&nbsp;&nbsp;Solaris Secure Shell (Reference)</a></p>
<p class="toc level1 tocsp"><a href="seamtm-1.html">Part&nbsp;VI&nbsp;Kerberos Service</a></p>
<p class="toc level2"><a href="intro-1.html">21.&nbsp;&nbsp;Introduction to the Kerberos Service</a></p>
<p class="toc level2"><a href="seamplan-1.html">22.&nbsp;&nbsp;Planning for the Kerberos Service</a></p>
<p class="toc level2"><a href="setup-8.html">23.&nbsp;&nbsp;Configuring the Kerberos Service (Tasks)</a></p>
<p class="toc level2"><a href="trouble-1.html">24.&nbsp;&nbsp;Kerberos Error Messages and Troubleshooting</a></p>
<p class="toc level2"><a href="aadmin-1.html">25.&nbsp;&nbsp;Administering Kerberos Principals and Policies (Tasks)</a></p>
<p class="toc level2"><a href="user-7.html">26.&nbsp;&nbsp;Using Kerberos Applications (Tasks)</a></p>
<p class="toc level2"><a href="refer-1.html">27.&nbsp;&nbsp;The Kerberos Service (Reference)</a></p>
<p class="toc level1 tocsp"><a href="audittm-1.html">Part&nbsp;VII&nbsp;Solaris Auditing</a></p>
<p class="toc level2"><a href="auditov-1.html">28.&nbsp;&nbsp;Solaris Auditing (Overview)</a></p>
<p class="toc level2"><a href="auditplan-1.html">29.&nbsp;&nbsp;Planning for Solaris Auditing</a></p>
<p class="toc level2"><a href="audittask-1.html">30.&nbsp;&nbsp;Managing Solaris Auditing (Tasks)</a></p>
<p class="toc level2"><a href="auditref-1.html">31.&nbsp;&nbsp;Solaris Auditing (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-2.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="devtask-16"></a><h3>Device Protection (Reference)</h3>
<a name="indexterm-543"></a><p>Devices in the Solaris OS are protected by device policy. Peripheral devices can
be protected by device allocation. Device policy is enforced by the kernel. Device
allocation is optionally enabled, and is enforced at the user level.</p>

<a name="devtask-4"></a><h4>Device Policy Commands</h4>
<a name="indexterm-544"></a><a name="indexterm-545"></a><p><a name="indexterm-546"></a><a name="indexterm-547"></a><a name="indexterm-548"></a>Device management commands administer the device policy on local files. Device policy can include
privilege requirements. Only superuser or a role of equivalent capabilities can manage devices.</p><p>The following table lists the device management commands.</p><a name="devtask-tbl-2"></a><h6>Table&nbsp;5-1 Device Management Commands</h6><table><col width="21%"><col width="53%"><col width="25%"><tr><th align="left" valign="top" scope="column"><p>Command</p></th>
<th align="left" valign="top" scope="column"><p>Purpose</p></th>
<th align="left" valign="top" scope="column"><p>Man Page</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-549"></a><tt>devfsadm</tt></p></td>
<td align="left" valign="top" scope="row"><p>Administers devices and device
drivers on a running system. Also loads device policy.</p><p>The <tt>devfsadm</tt> command enables the
cleanup of dangling <tt>/dev</tt> links to disk, tape, port, audio, and pseudo
devices. Devices for a named driver can also be reconfigured.</p></td>
<td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2240/devfsadm-1m?a=view"><tt>devfsadm</tt>(1M)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-550"></a><tt>getdevpolicy</tt></p></td>
<td align="left" valign="top" scope="row"><p>Displays the policy associated
with one or more devices. This command can be run by any user.</p></td>
<td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2240/getdevpolicy-1m?a=view"><tt>getdevpolicy</tt>(1M)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-551"></a><tt>add_drv</tt></p></td>
<td align="left" valign="top" scope="row"><p>Adds
a new device driver to a running system. Contains options to add device
policy to the new device. Typically, this command is called in a
script when a device driver is being installed.</p></td>
<td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2240/add-drv-1m?a=view"><tt>add_drv</tt>(1M)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-552"></a><tt>update_drv</tt></p></td>
<td align="left" valign="top" scope="row"><p>Updates the attributes of an existing
device driver. Contains options to update the device policy for the device. Typically,
this command is called in a script when a device driver is being
installed.</p></td>
<td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2240/update-drv-1m?a=view"><tt>update_drv</tt>(1M)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-553"></a><tt>rem_drv</tt></p></td>
<td align="left" valign="top" scope="row"><p>Removes a device or device driver.</p></td>
<td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2240/rem-drv-1m?a=view"><tt>rem_drv</tt>(1M)</a></p></td>
</tr>
</table>

<a name="devtask-40"></a><h4>Device Allocation</h4>
<p>Device allocation can protect your site from loss of data, computer viruses, and
other security breaches. Unlike device policy, device allocation is optional. Devices are not
allocatable until the <tt>bsmconv</tt> script is run. Device allocation uses authorizations to limit
access to allocatable devices.</p>

<a name="devtask-42"></a><h5>Components of Device Allocation</h5>
<a name="indexterm-554"></a><a name="indexterm-555"></a><p>The components of the device allocation mechanism are as follows:</p>
<ul><li><p>The <tt>allocate</tt>, <tt>deallocate</tt>, <tt>dminfo</tt>, and <tt>list_devices</tt> commands. For more information, see <a href="#devtask-44">Device Allocation Commands</a>.</p></li>
<li><p>Device-clean scripts for each allocatable device.</p></li></ul>
<p>These commands and scripts use the following local files to implement device allocation:</p>
<ul><li><p>The <tt>/etc/security/device_allocate</tt> file. For more information, see the <a href="http://docs.sun.com/doc/819-2251/device-allocate-4?a=view"><tt>device_allocate</tt>(4)</a> man page.</p></li>
<li><p>The <tt>/etc/security/device_maps</tt> file. For more information, see the <a href="http://docs.sun.com/doc/819-2251/device-maps-4?a=view"><tt>device_maps</tt>(4)</a> man page.</p></li>
<li><p>A lock file, in the <tt>/etc/security/dev</tt> directory, for each allocatable device.</p></li>
<li><p>The changed attributes of the lock files that are associated with each allocatable device.</p></li></ul>

<hr><p><b>Note - </b>The <tt>/etc/security/dev</tt> directory might not be supported in future releases of the Solaris
OS.</p>
<hr>


<a name="devtask-44"></a><h5>Device Allocation Commands</h5>
<p><a name="indexterm-556"></a><a name="indexterm-557"></a>With uppercase options, the <tt>allocate</tt>, <tt>deallocate</tt>, and <tt>list_devices</tt> commands are administrative commands. Otherwise,
these commands are user commands. The following table lists the device allocation commands.</p><a name="devtask-tbl-4"></a><h6>Table&nbsp;5-2 Device Allocation Commands</h6><table><col width="22%"><col width="58%"><col width="19%"><tr><th align="left" valign="top" scope="column"><p>Command</p></th>
<th align="left" valign="top" scope="column"><p>Purpose</p></th>
<th align="left" valign="top" scope="column"><p>Man
Page</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>bsmconv</tt></p></td>
<td align="left" valign="top" scope="row"><p>Creates databases to handle device allocation. Also enables the auditing service. You must
be superuser or in the Primary Administrator role.</p></td>
<td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2240/bsmconv-1m?a=view"><tt>bsmconv</tt>(1M)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>dminfo</tt></p></td>
<td align="left" valign="top" scope="row"><p>Searches for an allocatable device
by device type, by device name, and by full path name.</p></td>
<td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2240/dminfo-1m?a=view"><tt>dminfo</tt>(1M)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-558"></a><tt>list_devices</tt></p></td>
<td align="left" valign="top" scope="row"><p>Lists the status
of allocatable devices.</p><p>Lists all the device-special files that are associated with any
device that is listed in the <tt>device_maps</tt> file. </p></td>
<td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2239/list-devices-1?a=view"><tt>list_devices</tt>(1)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-559"></a><tt>list_devices -U</tt></p></td>
<td align="left" valign="top" scope="row"><p>Lists the devices that are
allocatable or allocated to the specified user ID. This option allows you to
check which devices are allocatable or allocated to another user. You must have
the <tt>solaris.device.revoke</tt> authorization.</p></td>
<td align="left" valign="top" scope="row"></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-560"></a><a name="indexterm-561"></a><tt>allocate</tt></p></td>
<td align="left" valign="top" scope="row"><p>Reserves an allocatable device for use by one user.</p><p><a name="indexterm-562"></a>By default,
a user must have the <tt>solaris.device.allocate</tt> authorization to allocate a device. You
can modify the <tt>device_allocate</tt> file to not require user authorization. Then, any
user on the system can request the device to be allocated for use.</p></td>
<td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2239/allocate-1?a=view"><tt>allocate</tt>(1)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="indexterm-563"></a><a name="indexterm-564"></a><tt>deallocate</tt></p></td>
<td align="left" valign="top" scope="row"><p>Removes
the allocation reservation from a device.</p></td>
<td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2239/deallocate-1?a=view"><tt>deallocate</tt>(1)</a></p></td>
</tr>
</table>

<a name="devtask-15"></a><h5>Authorizations for the Allocation Commands</h5>
<a name="indexterm-565"></a><a name="indexterm-566"></a><p>By default, users must have the <tt>solaris.device.allocate</tt> authorization to reserve an allocatable device.
To create a rights profile to include the <tt>solaris.device.allocate</tt> authorization, see <a href="devtask-32.html#devtask-36">How to Authorize Users to Allocate a Device</a>.</p><p><a name="indexterm-567"></a><a name="indexterm-568"></a><a name="indexterm-569"></a><a name="indexterm-570"></a><a name="indexterm-571"></a><a name="indexterm-572"></a>Administrators must have the <tt>solaris.device.revoke</tt> authorization to change the allocation state of any device.
For example, the <tt>-U</tt> option to the <tt>allocate</tt> and <tt>list_devices</tt> commands, and the <tt>-F</tt>
option to the <tt>deallocate</tt> command require the <tt>solaris.device.revoke</tt> authorization.</p><p>For more information, see <a href="rbacref-22.html#rbacref-4">Commands That Require Authorizations</a>.</p>

<a name="devtask-12"></a><h5>Allocate Error State</h5>
<a name="indexterm-573"></a><a name="indexterm-574"></a><a name="indexterm-575"></a><a name="indexterm-576"></a><a name="indexterm-577"></a><p>A device is put in an <b>allocate error state</b> when the <tt>deallocate</tt> command fails to
deallocate, or when the <tt>allocate</tt> command fails to allocate. When an allocatable
device is in an allocate error state, then the device must be forcibly
deallocated. Only superuser or a role with the Device Management rights profile or
the Device Security rights profile can handle an allocate error state.</p><p><a name="indexterm-578"></a><a name="indexterm-579"></a>The <tt>deallocate</tt> command with the <tt>-F</tt> option forces deallocation. Or, you can use
<tt>allocate -U</tt> to assign the device to a user. Once the device is allocated,
you can investigate any error messages that appear. After any problems with the
device are corrected, you can forcibly deallocate it.</p>

<a name="devtask-46"></a><h5><tt>device_maps</tt> File</h5>
<a name="indexterm-580"></a><a name="indexterm-581"></a><a name="indexterm-582"></a><p><a name="indexterm-583"></a><a name="indexterm-584"></a><a name="indexterm-585"></a><a name="indexterm-586"></a>Device maps are created when you set up device allocation. A default <tt>/etc/security/device_maps</tt>
file is created by the <tt>bsmconv</tt> command when the auditing service is enabled. This
initial <tt>device_maps</tt> file can be customized for  your site. The <tt>device_maps</tt> file
includes the device names, device types, and device-special files that are associated with
each allocatable device.</p><p><a name="indexterm-587"></a>The <tt>device_maps</tt> file defines the device-special file mappings for each device, which in
many cases is not intuitive. This file allows programs to discover which device-special
files map to which devices. You can use the <tt>dminfo</tt> command, for example,
to retrieve the device name, the device type, and the device-special files to
specify when you set up an allocatable device. The <tt>dminfo</tt> command uses the <tt>device_maps</tt>
file to report this information.</p><p><a name="indexterm-588"></a>Each device is represented by a one-line entry of the form:</p><pre><i>device-name</i>:<i>device-type</i>:<i>device-list</i></pre><a name="devtask-27"></a><h6>Example&nbsp;5-14 Sample <tt>device_maps</tt> Entry</h6><p><a name="indexterm-589"></a>The following is an example of an entry in a <tt>device_maps</tt> file for
a diskette drive, <tt>fd0</tt>:</p><pre>fd0:\
        fd:\
        /dev/diskette /dev/rdiskette /dev/fd0a /dev/rfd0a \
/dev/fd0b /dev/rfd0b /dev/fd0c /dev/fd0 /dev/rfd0c /dev/rfd0:\</pre><p><a name="indexterm-590"></a><a name="indexterm-591"></a><a name="indexterm-592"></a><a name="indexterm-593"></a>Lines in the <tt>device_maps</tt> file can end with a backslash (<tt>\</tt>) to
continue an entry on the next line. Comments can also be included. A
pound sign (<tt>#</tt>) comments all subsequent text until the next newline that
is not immediately preceded by a backslash. Leading and trailing blanks are allowed in
any field. The fields are defined as follows:</p><dl><dt><i>device-name</i></dt>
<dd><p><a name="indexterm-594"></a>Specifies the name of the device. For a list of current device names, see <a href="devtask-32.html#devtask-26">How to View Allocation Information About a Device</a>.</p></dd>
<dt><i>device-type</i></dt>
<dd><p>Specifies the generic device type. The generic name is the name for the class of devices, such as <tt>st</tt>, <tt>fd</tt>, or <tt>audio</tt>. The <i>device-type</i> field logically groups related devices.</p></dd>
<dt><i>device-list</i></dt>
<dd><p>Lists the device-special files that are associated with the physical device. The <i>device-list</i> must contain all of the special files that allow access to a particular device. If the list is incomplete, a malevolent user can still obtain or modify private information. Valid entries for the <i>device-list</i> field reflect the device files that are located in the <tt>/dev</tt> directory.</p></dd>
</dl>


<a name="devtask-34"></a><h5><tt>device_allocate</tt> File</h5>
<a name="indexterm-595"></a><a name="indexterm-596"></a><p><a name="indexterm-597"></a><a name="indexterm-598"></a>An initial <tt>/etc/security/device_allocate</tt> file is created by the <tt>bsmconv</tt> command when the auditing
service is enabled. This initial <tt>device_allocate</tt> file can be used as a starting
point. You can modify the <tt>device_allocate</tt> file to change devices from allocatable to
nonallocatable, or to add new devices. A sample <tt>device_allocate</tt> file follows.</p><pre>st0;st;;;;/etc/security/lib/st_clean
fd0;fd;;;;/etc/security/lib/fd_clean
sr0;sr;;;;/etc/security/lib/sr_clean
audio;audio;;;*;/etc/security/lib/audio_clean</pre><p><a name="indexterm-599"></a><a name="indexterm-600"></a><a name="indexterm-601"></a><a name="indexterm-602"></a>An entry in the <tt>device_allocate</tt> file does not mean that the device
is allocatable, unless the entry specifically states that the device is allocatable. In
the sample <tt>device_allocate</tt> file, note the asterisk (<tt>*</tt>) in the fifth field of the
audio device entry. An asterisk in the fifth field indicates to the system
that the device is not allocatable. Therefore, the device cannot be used. Other
values or no value in this field indicates that the device can be
used.</p><p><a name="indexterm-603"></a>In the <tt>device_allocate</tt> file, each device is represented by a one-line entry of
the form:</p><pre><i>device-name</i>;<i>device-type</i>;reserved;reserved;<i>auths</i>;<i>device-exec</i></pre><p><a name="indexterm-604"></a><a name="indexterm-605"></a><a name="indexterm-606"></a><a name="indexterm-607"></a>Lines in the <tt>device_allocate</tt> file can end with a backslash (<tt>\</tt>) to
continue an entry on the next line. Comments can also be included. A
pound sign (<tt>#</tt>) comments all subsequent text until the next newline that
is not immediately preceded by a backslash. Leading and trailing blanks are allowed in
any field. The fields are defined as follows:</p><dl><dt><i>device-name</i></dt>
<dd><p><a name="indexterm-608"></a>Specifies the name of the device. For a list of current device names, see <a href="devtask-32.html#devtask-26">How to View Allocation Information About a Device</a>.</p></dd>
<dt><i>device-type</i></dt>
<dd><p>Specifies the generic device type. The generic name is the name for the class of devices, such as <tt>st</tt>, <tt>fd</tt>, and <tt>sr</tt>. The <i>device-type</i> field logically groups related devices. When you make a device allocatable, retrieve the device name from the <i>device-type</i> field in the <tt>device_maps</tt> file.</p></dd>
<dt><tt>reserved</tt></dt>
<dd><p>Sun reserves the two fields that are marked <tt>reserved</tt> for future use.</p></dd>
<dt><i>auths</i></dt>
<dd><p><a name="indexterm-609"></a><a name="indexterm-610"></a><a name="indexterm-611"></a><a name="indexterm-612"></a>Specifies whether the device is allocatable. An asterisk (<tt>*</tt>) in this field indicates that the device is not allocatable. An authorization string, or an empty field, indicates that the device is allocatable. For example, the string <tt>solaris.device.allocate</tt> in the <i>auths</i> field indicates that the <tt>solaris.device.allocate</tt> authorization is required to allocate the device. An at sign (<tt>@</tt>) in this file indicates that the device is allocatable by any user.</p></dd>
<dt><i>device-exec</i></dt>
<dd><p>Supplies the path name of a script to be invoked for special handling, such as cleanup and object-reuse protection during the allocation process. The <i>device-exec</i> script is run any time that the device is acted on by the <tt>deallocate</tt> command.</p></dd>
</dl>
<p>For example, the following entry for the <tt>sr0</tt> device indicates that the CD-ROM
drive is allocatable by a user with the <tt>solaris.device.allocate</tt> authorization:</p><pre>sr0;sr;reserved;reserved;solaris.device.allocate;/etc/security/lib/sr_clean</pre><p><a name="indexterm-613"></a><a name="indexterm-614"></a><a name="indexterm-615"></a>You can decide to accept the default devices and their defined characteristics. After
you install a new device, you can modify the entries. Any device that
needs to be allocated before use must be defined in the <tt>device_allocate</tt>
and <tt>device_maps</tt> files for that device's system. Currently, cartridge tape drives, diskette drives,
CD-ROM drives, and audio chips are considered allocatable. These device types have device-clean scripts.</p>
<hr><p><b>Note - </b><a name="indexterm-616"></a><a name="indexterm-617"></a><a name="indexterm-618"></a><a name="indexterm-619"></a><a name="indexterm-620"></a><a name="indexterm-621"></a><a name="indexterm-622"></a><a name="indexterm-623"></a><a name="indexterm-624"></a>Xylogics<sup>TM</sup> tape drives or Archive tape drives also use the <tt>st_clean</tt> script that is
supplied for SCSI devices. You need to create your own device-clean scripts for
other devices, such as modems, terminals, graphics tablets, and other allocatable devices. The
script must fulfill object-reuse requirements for that type of device.</p>
<hr>


<a name="devtask-38"></a><h5>Device-Clean Scripts</h5>
<a name="indexterm-625"></a><a name="indexterm-626"></a><a name="indexterm-627"></a><a name="indexterm-628"></a><a name="indexterm-629"></a><a name="indexterm-630"></a><p>Device allocation satisfies part of what is called the object reuse requirement. The
<b>device-clean</b> scripts address the security requirement that all usable data be purged from
a physical device before reuse. The data is cleared before the device is
allocatable by another user. By default, cartridge tape drives, diskette drives, CD-ROM drives,
and audio devices require device-clean scripts. The Solaris OS provides the scripts. This
section describes what device-clean scripts do.</p>

<a name="devtask-53"></a><h5>Device-Clean Script for Tapes</h5>
<a name="indexterm-631"></a><a name="indexterm-632"></a><a name="indexterm-633"></a><a name="indexterm-634"></a><p>The <tt>st_clean</tt> device-clean script supports three tape devices:</p>
<ul><li><p>SCSI &frac14;-inch tape</p></li>
<li><p>Archive &frac14;-inch tape</p></li>
<li><p>Open-reel &frac12;-inch tape</p></li></ul>
<p><a name="indexterm-635"></a><a name="indexterm-636"></a>The <tt>st_clean</tt> script uses the <tt>rewoffl</tt> option to the <tt>mt</tt> command to clean
up the device. For more information, see the <a href="http://docs.sun.com/doc/819-2239/mt-1?a=view"><tt>mt</tt>(1)</a> man page. If the script
runs during system boot, the script queries the device to determine if the
device is online. If the device is online, the script determines if the
device has media in it. The &frac14;-inch tape devices that have media in
them are placed in the allocate error state. The allocate error state forces
the administrator to manually clean up the device.</p><p>During normal system operation, when the <tt>deallocate</tt> command is executed in interactive mode,
the user is prompted to remove the media. Deallocation is delayed until the
media is removed from the device.</p>

<a name="devtask-54"></a><h5>Device-Clean Scripts for Diskettes and CD-ROM Drives</h5>
<a name="indexterm-637"></a><a name="indexterm-638"></a><a name="indexterm-639"></a><a name="indexterm-640"></a><a name="indexterm-641"></a><a name="indexterm-642"></a><p>The following device-clean scripts are provided for diskettes and CD-ROM drives:</p>
<ul><li><p><a name="indexterm-643"></a><tt><b>fd_clean</b></tt> <b>script &ndash;</b> Is a device-clean script for diskettes.</p></li>
<li><p><a name="indexterm-644"></a><tt><b>sr_clean</b></tt> <b>script &ndash;</b> Is a device-clean script for CD-ROM drives.</p></li></ul>
<p><a name="indexterm-645"></a>The scripts use the <tt>eject</tt> command to remove the media from the drive.
If the <tt>eject</tt> command fails, the device is placed in the allocate error
state. For more information, see the <a href="http://docs.sun.com/doc/819-2239/eject-1?a=view"><tt>eject</tt>(1)</a> man page.</p>

<a name="devtask-55"></a><h5>Device-Clean Script for Audio</h5>
<a name="indexterm-646"></a><a name="indexterm-647"></a><a name="indexterm-648"></a><a name="indexterm-649"></a><a name="indexterm-650"></a><p>Audio devices are cleaned up with an <tt>audio_clean</tt> script. The script performs an
<tt>AUDIO_GETINFO</tt> ioctl system call to read the device. The script then performs an
<tt>AUDIO_SETINFO</tt> ioctl system call to reset the device configuration to the default.</p>

<a name="devtask-7"></a><h5>Writing New Device-Clean Scripts</h5>
<a name="indexterm-651"></a><a name="indexterm-652"></a><a name="indexterm-653"></a><a name="indexterm-654"></a><a name="indexterm-655"></a><a name="indexterm-656"></a><p>If you add more allocatable devices to the system, you might need
to create your own device-clean scripts. The <tt>deallocate</tt> command passes a parameter to the
device-clean scripts. The parameter, which is shown here, is a string that contains
the device name. For more information, see the <a href="http://docs.sun.com/doc/819-2251/device-allocate-4?a=view"><tt>device_allocate</tt>(4)</a> man page.</p><pre><i>clean-script</i> -[I|i|f|S] <i>device-name</i></pre><p><a name="indexterm-657"></a><a name="indexterm-658"></a>Device-clean scripts must return &ldquo;<tt>0</tt>&rdquo; for success and greater than &ldquo;<tt>0</tt>&rdquo; for failure.
The options <tt>-I</tt>, <tt>-f</tt>, and <tt>-S</tt> determine the running mode of the script:</p><dl><dt><tt>-I</tt></dt>
<dd><p><a name="indexterm-659"></a>Is needed during system boot only. All output must go to the system console. Failure or inability to forcibly eject the media must put the device in the allocate error state.</p></dd>
<dt><tt>-i</tt></dt>
<dd><p><a name="indexterm-660"></a>Similar to the <tt>-I</tt> option, except that output is suppressed.</p></dd>
<dt><tt>-f</tt></dt>
<dd><p><a name="indexterm-661"></a><a name="indexterm-662"></a>Is for forced cleanup. The option is interactive and assumes that the user is available to respond to prompts. A script with this option must attempt to complete the cleanup if one part of the cleanup fails.</p></dd>
<dt><tt>-S</tt></dt>
<dd><p><a name="indexterm-663"></a><a name="indexterm-664"></a>Is for standard cleanup. The option is interactive and assumes that the user is available to respond to prompts.</p></dd>
</dl>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="devtask-52.html">Previous</a>
             </td>
             <td align="right">
                 <a href="bart-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

