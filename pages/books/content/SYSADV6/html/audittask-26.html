<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Configuring the Auditing Service in Zones (Tasks) - System Administration Guide: Security Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Security Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="audittask-28.html">Previous</a>
             </td>
             <td align="right">
                 <a href="audittask-91.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="oview-1.html">Part&nbsp;I&nbsp;Security Overview</a></p>
<p class="toc level2"><a href="secov-1.html">1.&nbsp;&nbsp;Security Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="sectm-1.html">Part&nbsp;II&nbsp;System, File, and Device Security</a></p>
<p class="toc level2"><a href="concept-1.html">2.&nbsp;&nbsp;Managing Machine Security (Overview)</a></p>
<p class="toc level2"><a href="secsys-1.html">3.&nbsp;&nbsp;Controlling Access to Systems (Tasks)</a></p>
<p class="toc level2"><a href="vscan-1.html">4.&nbsp;&nbsp;Virus Scanning Service (Tasks)</a></p>
<p class="toc level2"><a href="devtask-1.html">5.&nbsp;&nbsp;Controlling Access to Devices (Tasks)</a></p>
<p class="toc level2"><a href="bart-1.html">6.&nbsp;&nbsp;Using the Basic Audit Reporting Tool (Tasks)</a></p>
<p class="toc level2"><a href="secfile-1.html">7.&nbsp;&nbsp;Controlling Access to Files (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="prbactm-1.html">Part&nbsp;III&nbsp;Roles, Rights Profiles, and Privileges</a></p>
<p class="toc level2"><a href="prbac-1.html">8.&nbsp;&nbsp;Using Roles and Privileges (Overview)</a></p>
<p class="toc level2"><a href="rbactask-1.html">9.&nbsp;&nbsp;Using Role-Based Access Control (Tasks)</a></p>
<p class="toc level2"><a href="rbacref-1.html">10.&nbsp;&nbsp;Role-Based Access Control (Reference)</a></p>
<p class="toc level2"><a href="privtask-1.html">11.&nbsp;&nbsp;Privileges (Tasks)</a></p>
<p class="toc level2"><a href="privref-1.html">12.&nbsp;&nbsp;Privileges (Reference)</a></p>
<p class="toc level1 tocsp"><a href="scftm-1.html">Part&nbsp;IV&nbsp;Solaris Cryptographic Services</a></p>
<p class="toc level2"><a href="scf-1.html">13.&nbsp;&nbsp;Solaris Cryptographic Framework (Overview)</a></p>
<p class="toc level2"><a href="scftask-1.html">14.&nbsp;&nbsp;Solaris Cryptographic Framework (Tasks)</a></p>
<p class="toc level2"><a href="kmf-1.html">15.&nbsp;&nbsp;Solaris Key Management Framework</a></p>
<p class="toc level1 tocsp"><a href="authtm-1.html">Part&nbsp;V&nbsp;Authentication Services and Secure Communication</a></p>
<p class="toc level2"><a href="auth-1.html">16.&nbsp;&nbsp;Using Authentication Services (Tasks)</a></p>
<p class="toc level2"><a href="pam-1.html">17.&nbsp;&nbsp;Using PAM</a></p>
<p class="toc level2"><a href="sasl-1.html">18.&nbsp;&nbsp;Using SASL</a></p>
<p class="toc level2"><a href="sshuser-1.html">19.&nbsp;&nbsp;Using Solaris Secure Shell (Tasks)</a></p>
<p class="toc level2"><a href="sshref-1.html">20.&nbsp;&nbsp;Solaris Secure Shell (Reference)</a></p>
<p class="toc level1 tocsp"><a href="seamtm-1.html">Part&nbsp;VI&nbsp;Kerberos Service</a></p>
<p class="toc level2"><a href="intro-1.html">21.&nbsp;&nbsp;Introduction to the Kerberos Service</a></p>
<p class="toc level2"><a href="seamplan-1.html">22.&nbsp;&nbsp;Planning for the Kerberos Service</a></p>
<p class="toc level2"><a href="setup-8.html">23.&nbsp;&nbsp;Configuring the Kerberos Service (Tasks)</a></p>
<p class="toc level2"><a href="trouble-1.html">24.&nbsp;&nbsp;Kerberos Error Messages and Troubleshooting</a></p>
<p class="toc level2"><a href="aadmin-1.html">25.&nbsp;&nbsp;Administering Kerberos Principals and Policies (Tasks)</a></p>
<p class="toc level2"><a href="user-7.html">26.&nbsp;&nbsp;Using Kerberos Applications (Tasks)</a></p>
<p class="toc level2"><a href="refer-1.html">27.&nbsp;&nbsp;The Kerberos Service (Reference)</a></p>
<p class="toc level1 tocsp"><a href="audittm-1.html">Part&nbsp;VII&nbsp;Solaris Auditing</a></p>
<p class="toc level2"><a href="auditov-1.html">28.&nbsp;&nbsp;Solaris Auditing (Overview)</a></p>
<p class="toc level2"><a href="auditplan-1.html">29.&nbsp;&nbsp;Planning for Solaris Auditing</a></p>
<p class="toc level2"><a href="audittask-1.html">30.&nbsp;&nbsp;Managing Solaris Auditing (Tasks)</a></p>
<p class="toc level3"><a href="audittask-3.html">Solaris Auditing (Task Map)</a></p>
<p class="toc level3"><a href="audittask-15.html">Configuring Audit Files (Task Map)</a></p>
<p class="toc level3"><a href="audittask-44.html">Configuring Audit Files (Tasks)</a></p>
<p class="toc level3"><a href="audittask-4.html">Configuring and Enabling the Auditing Service (Task Map)</a></p>
<p class="toc level3"><a href="audittask-28.html">Configuring and Enabling the Auditing Service (Tasks)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Configuring the Auditing Service in Zones (Tasks)</a></p>
</div>
<p class="toc level3"><a href="audittask-91.html">Managing Audit Records (Task Map)</a></p>
<p class="toc level3"><a href="audittask-21.html">Managing Audit Records</a></p>
<p class="toc level2 tocsp"><a href="auditref-1.html">31.&nbsp;&nbsp;Solaris Auditing (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-2.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="audittask-26"></a><h3>Configuring the Auditing Service in Zones (Tasks)</h3>
<p>The auditing service audits the entire system, including audit events in zones. A
system that has installed non-global zones can audit all zones identically, or can
control auditing per zone. For background, see <a href="auditov-8.html">Auditing on a System With Zones</a>. To plan, see <a href="auditplan-12.html#auditplan-10">How to Plan Auditing in Zones</a>.</p>

<a name="audittask-34"></a><h4>How to Configure All Zones Identically for Auditing</h4><a name="indexterm-3318"></a><a name="indexterm-3319"></a><p>This procedure enables audits every zone identically. This method requires the least computer
overhead and administrative resources.</p><ol>
<li><b>Configure the global zone for auditing.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Complete the tasks in <a href="audittask-15.html">Configuring Audit Files (Task Map)</a>.</b></li>
<li><b>Complete the tasks in <a href="audittask-4.html">Configuring and Enabling the Auditing Service (Task Map)</a>, with the following exceptions.</b>
<ul><li><p>Do not enable <tt>perzone</tt> audit policy.</p></li>
<li><p>Do not enable the auditing service. You enable the auditing service after you have configured the non-global zones for auditing.</p></li></ul>
</li></ol></li>
<li><b>Copy the audit configuration files from the global zone to every non-global zone.</b><p>Copy any of the following files that you have edited: <tt>audit_class</tt>, <tt>audit_control</tt>, <tt>audit_event</tt>,
<tt>audit_user</tt>. Do not copy <tt>audit_startup</tt> or <tt>audit_warn</tt>. You do not have to
copy files that you have not edited.</p><p>You have two options. As superuser, you can copy the files, or
loopback mount the files. The non-global zone must be running.</p><ul>
<li><b>Copy the files.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>From the global zone, list the <tt>/etc/security</tt> directory in the non-global zone.</b><pre># ls /zone/<i>zonename</i>/etc/security/</pre></li>
<li><b>Copy the audit configuration files to the zone's  <tt>/etc/security</tt> directory.</b><pre># cp /etc/security/<i>audit-file</i> /zone/<i>zonename</i>/etc/security/<i>audit-file</i></pre><p>Later, if you modify an audit configuration file in the global zone, you
re-copy the file to the non-global zones.</p></li></ol></li>
<li><b>Loopback mount the configuration files.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>From the global zone, halt the non-global zone. </b><pre># zoneadm -z <i>non-global-zone</i> halt</pre></li>
<li><b>Create a read-only loopback mount for every audit configuration file that you modified
in the global zone.</b><pre># zonecfg -z <i>non-global-zone</i>
 add filesystem
    set special=/etc/security/<i>audit-file</i>
    set directory=/etc/security/<i>audit-file</i>
    set type=lofs
    add options [ro,nodevices,nosetuid]
    end
 exit</pre></li></ol></li></ul></li></ol><a name="audittask-89"></a><h6>Example&nbsp;30-22 Loopback Mounting Audit Configuration Files</h6><p>In this example, the system administrator has modified the <tt>audit_class</tt>, <tt>audit_event</tt>, <tt>audit_control</tt>,
<tt>audit_user</tt>, <tt>audit_startup</tt>, and <tt>audit_warn</tt> files.</p><p>The <tt>audit_startup</tt> and <tt>audit_warn</tt> files are read in the global zone only, so
do not have to be loopback mounted into the non-global zones.</p><p>On this system, <tt>machine1</tt>, the administrator has created two non-global zones, <tt>machine1&ndash;webserver</tt> and
<tt>machine1&ndash;appserver</tt>.</p><pre># <tt><b>zoneadm -z machine1-webserver halt</b></tt>
# <tt><b>zoneadm -z machine1-appserver halt</b></tt>
# <tt><b>zonecfg -z machine1-webserver</b></tt> 
 <tt><b>add filesystem</b></tt>
    <tt><b>set special=/etc/security/audit_class</b></tt>
    <tt><b>set directory=/etc/security/audit_class</b></tt>
    <tt><b>set type=lofs</b></tt>
    <tt><b>add options [ro,nodevices,nosetuid]</b></tt>
    <tt><b>end</b></tt>
 <tt><b>add filesystem</b></tt>
    <tt><b>set special=/etc/security/audit_event</b></tt>
    <tt><b>set directory=/etc/security/audit_event</b></tt>
    <tt><b>set type=lofs</b></tt>
    <tt><b>add options [ro,nodevices,nosetuid]</b></tt>
    <tt><b>end</b></tt>
 <tt><b>add filesystem</b></tt>
    <tt><b>set special=/etc/security/audit_control</b></tt>
    <tt><b>set directory=/etc/security/audit_control</b></tt>
    <tt><b>set type=lofs</b></tt>
    <tt><b>add options [ro,nodevices,nosetuid]</b></tt>
    <tt><b>end</b></tt> 
<tt><b>add filesystem</b></tt>
    <tt><b>set special=/etc/security/audit_user</b></tt>
    <tt><b>set directory=/etc/security/audit_user</b></tt>
    <tt><b>set type=lofs</b></tt>
    <tt><b>add options [ro,nodevices,nosetuid]</b></tt>
    <tt><b>end</b></tt>
 <tt><b>exit</b></tt>
# <tt><b>zonecfg -z machine1-appserver</b></tt> 
 <tt><b>add filesystem</b></tt>
    <tt><b>set special=/etc/security/audit_class</b></tt>
    <tt><b>set directory=/etc/security/audit_class</b></tt>
    <tt><b>set type=lofs</b></tt>
    <tt><b>add options [ro,nodevices,nosetuid]</b></tt>
    <tt><b>end</b></tt>
...
 <tt><b>exit</b></tt></pre><p>When the zones are rebooted, the audit configuration files are read-only in the
zones. When the global administrator modifies the files in the global zone, the
changes are immediately effective in the non-global zones.</p>

<a name="audittask-36"></a><h4>How to Configure Per-Zone Auditing</h4><a name="indexterm-3320"></a><a name="indexterm-3321"></a><a name="indexterm-3322"></a><p>This procedure enables separate zone administrators to control the auditing service in their
zone. For the complete list of policy options, see the <a href="http://docs.sun.com/doc/819-2240/auditconfig-1m?a=view"><tt>auditconfig</tt>(1M)</a> man
page.</p><ol>
<li><b>In the global zone, configure auditing, but do not enable the auditing service.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Complete the tasks in <a href="audittask-15.html">Configuring Audit Files (Task Map)</a>.</b></li>
<li><b>Complete the tasks in <a href="audittask-4.html">Configuring and Enabling the Auditing Service (Task Map)</a>, with the following exceptions.</b>
<ul><li><p>Add the <tt>perzone</tt> audit policy. For an example, see <a href="audittask-28.html#audittask-32">Example&nbsp;30-16</a>.</p></li>
<li><p>Do not enable the auditing service. You enable the auditing service after the non-global zones are configured for auditing.</p></li></ul>
</li></ol></li>
<li><b>In each non-global zone, configure the audit files.</b>
<hr><p><b>Note - </b>If you are planning to disable auditing in the non-global zone, you can
skip this step. To disable auditing, see <a href="#audittask-81">Example&nbsp;30-23</a>.</p>
<hr>
<ol style="list-style-type: lower-alpha">
				 
<li><b>Complete the tasks in <a href="audittask-15.html">Configuring Audit Files (Task Map)</a>.</b></li>
<li><b>Follow the procedures that are described in <a href="audittask-4.html">Configuring and Enabling the Auditing Service (Task Map)</a>.</b></li>
<li><b>Do not configure system-wide audit settings.</b><p>Specifically, do not add the <tt>perzone</tt> or <tt>ahlt</tt> to the non-global zone's <tt>audit_startup</tt> file.
And do not run the <tt>bsmconv</tt> command from the non-global zone.</p></li>
<li><b>Enable auditing in your zone.</b><p>When the global zone reboots after auditing is configured, auditing is automatically enabled
in your zone.</p><p>If the global zone administrator activates the <tt>perzone</tt> audit policy after the system
is booted, individual zone administrators must enable auditing. For details, see <a href="audittask-28.html#audittask-85">Example&nbsp;30-18</a>.</p></li></ol></li>
<li><b>In the global zone, enable the auditing service.</b><p>For the procedure, see <a href="audittask-28.html#audittask-62">How to Enable the Auditing Service</a>.</p></li></ol><a name="audittask-81"></a><h6>Example&nbsp;30-23 Disabling Auditing in a Non-Global Zone</h6><p>This example works if the global zone has set the <tt>perzone</tt> audit policy.
The zone administrator of the <tt>noaudit</tt> zone disables auditing for that zone. Because
the administrator planned to disable auditing, she did not edit the audit configuration
files.</p><pre>noauditzone # <tt><b>svcadm disable svc:/system/auditd</b></tt></pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="audittask-28.html">Previous</a>
             </td>
             <td align="right">
                 <a href="audittask-91.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

