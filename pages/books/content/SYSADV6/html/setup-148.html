<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Configuring Kerberos Clients - System Administration Guide: Security Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Security Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="setup-97.html">Previous</a>
             </td>
             <td align="right">
                 <a href="setup-192.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="oview-1.html">Part&nbsp;I&nbsp;Security Overview</a></p>
<p class="toc level2"><a href="secov-1.html">1.&nbsp;&nbsp;Security Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="sectm-1.html">Part&nbsp;II&nbsp;System, File, and Device Security</a></p>
<p class="toc level2"><a href="concept-1.html">2.&nbsp;&nbsp;Managing Machine Security (Overview)</a></p>
<p class="toc level2"><a href="secsys-1.html">3.&nbsp;&nbsp;Controlling Access to Systems (Tasks)</a></p>
<p class="toc level2"><a href="vscan-1.html">4.&nbsp;&nbsp;Virus Scanning Service (Tasks)</a></p>
<p class="toc level2"><a href="devtask-1.html">5.&nbsp;&nbsp;Controlling Access to Devices (Tasks)</a></p>
<p class="toc level2"><a href="bart-1.html">6.&nbsp;&nbsp;Using the Basic Audit Reporting Tool (Tasks)</a></p>
<p class="toc level2"><a href="secfile-1.html">7.&nbsp;&nbsp;Controlling Access to Files (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="prbactm-1.html">Part&nbsp;III&nbsp;Roles, Rights Profiles, and Privileges</a></p>
<p class="toc level2"><a href="prbac-1.html">8.&nbsp;&nbsp;Using Roles and Privileges (Overview)</a></p>
<p class="toc level2"><a href="rbactask-1.html">9.&nbsp;&nbsp;Using Role-Based Access Control (Tasks)</a></p>
<p class="toc level2"><a href="rbacref-1.html">10.&nbsp;&nbsp;Role-Based Access Control (Reference)</a></p>
<p class="toc level2"><a href="privtask-1.html">11.&nbsp;&nbsp;Privileges (Tasks)</a></p>
<p class="toc level2"><a href="privref-1.html">12.&nbsp;&nbsp;Privileges (Reference)</a></p>
<p class="toc level1 tocsp"><a href="scftm-1.html">Part&nbsp;IV&nbsp;Solaris Cryptographic Services</a></p>
<p class="toc level2"><a href="scf-1.html">13.&nbsp;&nbsp;Solaris Cryptographic Framework (Overview)</a></p>
<p class="toc level2"><a href="scftask-1.html">14.&nbsp;&nbsp;Solaris Cryptographic Framework (Tasks)</a></p>
<p class="toc level2"><a href="kmf-1.html">15.&nbsp;&nbsp;Solaris Key Management Framework</a></p>
<p class="toc level1 tocsp"><a href="authtm-1.html">Part&nbsp;V&nbsp;Authentication Services and Secure Communication</a></p>
<p class="toc level2"><a href="auth-1.html">16.&nbsp;&nbsp;Using Authentication Services (Tasks)</a></p>
<p class="toc level2"><a href="pam-1.html">17.&nbsp;&nbsp;Using PAM</a></p>
<p class="toc level2"><a href="sasl-1.html">18.&nbsp;&nbsp;Using SASL</a></p>
<p class="toc level2"><a href="sshuser-1.html">19.&nbsp;&nbsp;Using Solaris Secure Shell (Tasks)</a></p>
<p class="toc level2"><a href="sshref-1.html">20.&nbsp;&nbsp;Solaris Secure Shell (Reference)</a></p>
<p class="toc level1 tocsp"><a href="seamtm-1.html">Part&nbsp;VI&nbsp;Kerberos Service</a></p>
<p class="toc level2"><a href="intro-1.html">21.&nbsp;&nbsp;Introduction to the Kerberos Service</a></p>
<p class="toc level2"><a href="seamplan-1.html">22.&nbsp;&nbsp;Planning for the Kerberos Service</a></p>
<p class="toc level2"><a href="setup-8.html">23.&nbsp;&nbsp;Configuring the Kerberos Service (Tasks)</a></p>
<p class="toc level3"><a href="setup-306.html">Configuring the Kerberos Service (Task Map)</a></p>
<p class="toc level3"><a href="ezecs.html">Configuring Additional Kerberos Services (Task Map)</a></p>
<p class="toc level3"><a href="setup-9.html">Configuring KDC Servers</a></p>
<p class="toc level3"><a href="setup-87.html">Configuring Cross-Realm Authentication</a></p>
<p class="toc level3"><a href="setup-119.html">Configuring Kerberos Network Application Servers</a></p>
<p class="toc level3"><a href="setup-97.html">Configuring Kerberos NFS Servers</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Configuring Kerberos Clients</a></p>
</div>
<p class="toc level3"><a href="setup-192.html">Synchronizing Clocks Between KDCs and Kerberos Clients</a></p>
<p class="toc level3"><a href="aadmin-2.html">Swapping a Master KDC and a Slave KDC</a></p>
<p class="toc level3"><a href="aadmin-3.html">Administering the Kerberos Database</a></p>
<p class="toc level3"><a href="ggklp.html">Managing a KDC on an LDAP Directory Server</a></p>
<p class="toc level3"><a href="setup-280.html">Increasing Security on Kerberos Servers</a></p>
<p class="toc level2 tocsp"><a href="trouble-1.html">24.&nbsp;&nbsp;Kerberos Error Messages and Troubleshooting</a></p>
<p class="toc level2"><a href="aadmin-1.html">25.&nbsp;&nbsp;Administering Kerberos Principals and Policies (Tasks)</a></p>
<p class="toc level2"><a href="user-7.html">26.&nbsp;&nbsp;Using Kerberos Applications (Tasks)</a></p>
<p class="toc level2"><a href="refer-1.html">27.&nbsp;&nbsp;The Kerberos Service (Reference)</a></p>
<p class="toc level1 tocsp"><a href="audittm-1.html">Part&nbsp;VII&nbsp;Solaris Auditing</a></p>
<p class="toc level2"><a href="auditov-1.html">28.&nbsp;&nbsp;Solaris Auditing (Overview)</a></p>
<p class="toc level2"><a href="auditplan-1.html">29.&nbsp;&nbsp;Planning for Solaris Auditing</a></p>
<p class="toc level2"><a href="audittask-1.html">30.&nbsp;&nbsp;Managing Solaris Auditing (Tasks)</a></p>
<p class="toc level2"><a href="auditref-1.html">31.&nbsp;&nbsp;Solaris Auditing (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-2.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="setup-148"></a><h3>Configuring Kerberos Clients</h3>
<a name="indexterm-2609"></a><a name="indexterm-2610"></a><p>Kerberos clients include any host, that is not a KDC server, on
the network that needs to use Kerberos services. This section provides procedures for installing
a Kerberos client, as well as specific information about using <tt>root</tt> authentication
to mount NFS file systems.</p>

<a name="seamtask-435"></a><h4>Configuring Kerberos Clients (Task Map)</h4>
<p>The following task map includes all of the procedures associated with setting up
Kerberos clients. Each row includes a task identifier, a description of why you
would want to do that task, followed by a link to the
task.</p><a name="setup-tbl-12"></a><table><col width="27%"><col width="42%"><col width="30%"><tr><th align="left" valign="top" scope="column"><p>Task</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
<th align="left" valign="top" scope="column"><p>For Instructions</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Establish a Kerberos client installation profile.</p></td>
<td align="left" valign="top" scope="row"><p>Generates a client installation profile that
can be used to automatically install a Kerberos client.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#seamtask-436">How to Create a Kerberos Client Installation Profile</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Configure a Kerberos client.</p></td>
<td align="left" valign="top" scope="row"><p>Manually installs
a Kerberos client. Use this procedure if each client installation requires unique installation
parameters.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#setup-341">How to Manually Configure a Kerberos Client</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>Automatically installs a Kerberos client. Use this procedure if the installation parameters for
each client are the same.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#seamtask-439">How to Automatically Configure a Kerberos Client</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>Interactively installs a Kerberos client. Use this procedure
if only a few of the installation parameters need to change.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#seamtask-443">How to Interactively Configure a Kerberos Client</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>Automatically installs a
Kerberos client of an Active Directory server. </p></td>
<td align="left" valign="top" scope="row"><p><a href="#ggtwg">How to Configure a Kerberos Client for an Active Directory Server</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Allow a client to access
a NFS file system as the <tt>root</tt> user</p></td>
<td align="left" valign="top" scope="row"><p>Creates a <tt>root</tt> principal on
the client, so that the client can mount a NFS file system shared
with <tt>root</tt> access. Also, allows for the client to set up non-interactive <tt>root</tt>
access to the NFS file system, so that cron jobs can run.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#fgohx">How to Access a Kerberos Protected NFS File System as the <tt>root</tt> User</a></p></td>
</tr>
</table>

<a name="seamtask-436"></a><h4>How to Create a Kerberos Client Installation Profile</h4><p>This procedure creates a kclient profile that can be used when you
install a Kerberos client. By using the kclient profile, you reduce the likelihood of
typing errors. Also, using the profile reduces user intervention as compared to the
interactive process.</p><ol>
<li><b>Become superuser.</b></li>
<li><b>Create a kclient installation profile.</b><p>A sample kclient profile could look similar to the following:</p><pre>client# <tt><b>cat /net/denver.example.com/export/install/profile</b></tt>
REALM EXAMPLE.COM
KDC kdc1.example.com
ADMIN clntconfig
FILEPATH /net/denver.example.com/export/install/krb5.conf
NFS 1
DNSLOOKUP none</pre></li></ol>

<a name="seamtask-439"></a><h4>How to Automatically Configure a Kerberos Client</h4><h6>Before You Begin</h6><p>This procedure uses an installation profile. See <a href="#seamtask-436">How to Create a Kerberos Client Installation Profile</a>.</p><ol>
<li><b>Become superuser.</b></li>
<li><a name="seamtask-step-441"></a><b>Run the <tt>kclient</tt> installation script.</b><p>You need to provide the password for the <tt>clntconfig</tt> principal to complete the
process.</p><pre>client# <tt><b>/usr/sbin/kclient -p /net/denver.example.com/export/install/profile</b></tt>

Starting client setup
---------------------------------------------------

kdc1.example.com

Setting up /etc/krb5/krb5.conf.

Obtaining TGT for clntconfig/admin ...
Password for clntconfig/admin@EXAMPLE.COM: &lt;Type the password&gt;

nfs/client.example.com entry ADDED to KDC database.
nfs/client.example.com entry ADDED to keytab.

host/client.example.com entry ADDED to KDC database.
host/client.example.com entry ADDED to keytab.

Copied /net/denver.example.com/export/install/krb5.conf.

---------------------------------------------------
Setup COMPLETE.

client#</pre></li></ol><a name="seamtask-ex-442"></a><h6>Example&nbsp;23-7 Automatically Configuring a Kerberos Client With Command-Line Overrides</h6><p>The following example overrides the <tt>DNSARG</tt> and the <tt>KDC</tt> parameters that are
set in the installation profile.</p><pre># <tt><b>/usr/sbin/kclient -p /net/denver.example.com/export/install/profile</b></tt>\
<tt><b>-d dns_fallback -k kdc2.example.com</b></tt>

Starting client setup
---------------------------------------------------

kdc1.example.com

Setting up /etc/krb5/krb5.conf.

Obtaining TGT for clntconfig/admin ...
Password for clntconfig/admin@EXAMPLE.COM: &lt;Type the password&gt;

nfs/client.example.com entry ADDED to KDC database.
nfs/client.example.com entry ADDED to keytab.

host/client.example.com entry ADDED to KDC database.
host/client.example.com entry ADDED to keytab.

Copied /net/denver.example.com/export/install/krb5.conf.

---------------------------------------------------
Setup COMPLETE.

client#</pre>

<a name="seamtask-443"></a><h4>How to Interactively Configure a Kerberos Client</h4><p>This procedure uses the <tt>kclient</tt> installation utility without a installation profile. In build
90 of the Solaris Express Community Edition release, the <tt>kclient</tt> utility has been expanded
to improve ease of use and ability to work with Active Directory servers.
See <a href="#ggtwg">How to Configure a Kerberos Client for an Active Directory Server</a> for more information. See <a href="#ehgbb">Example&nbsp;23-9</a> for an example of running
<tt>kclient</tt> on a previous Solaris release.</p><ol><a name="egyrl"></a>
<li><b>Become superuser.</b></li>
<li><b>Run the <tt>kclient</tt> installation script.</b><p>You need to provide the following information:</p>
<ul><li><p>Kerberos realm name</p></li>
<li><p>KDC master host name</p></li>
<li><p>KDC slave host names</p></li>
<li><p>Domains to map to the local realm</p></li>
<li><p>PAM service names and options to use for Kerberos authentication</p></li></ul>
<ol style="list-style-type: lower-alpha">
				 
<li><b>Indicate if the KDC server is not running a Solaris release.</b><p>If this system is a client of a KDC server that is
not running a Solaris release, you need to define the type of server
that is running the KDC. The available servers are: Microsoft Active Directory, MIT
KDC server, Heimdal KDC server, and Shishi KDC server.</p></li>
<li><b>Select if DNS should be used for Kerberos lookups.</b><p>If you use DNS for Kerberos lookups, you need to enter the DNS
lookup option that you want to use. Valid options are <tt>dns_lookup_kdc</tt>, <tt>dns_lookup_realm</tt>, and
<tt>dns_fallback</tt>. See the <a href="http://docs.sun.com/doc/819-2251/krb5.conf-4?a=view"><tt>krb5.conf</tt>(4)</a> man page for more information about these values.</p></li>
<li><b>Define the name of the Kerberos realm and the master KDC hostname.</b><p>This information is added to the <tt>/etc/krb5/krb5.conf</tt> configuration file.</p></li>
<li><b>Select if slave KDCs exist.</b><p>If there are slave KDCs in the realm, then you need to enter
the slave KDC host names. This information is used to create additional KDC
entries in  the client's configuration file.</p></li>
<li><b>Indicate if service or host keys are required.</b><p>Normally, service or host keys are not required unless the client system is
hosting Kerberized services.</p></li>
<li><b>Specify if the client is a member of a cluster.</b><p>If the client is a member of a cluster, then you need to
provide the logical name of the cluster. The logical host name is used
when creating service keys, which is required when hosting Kerberos services from clusters.</p></li>
<li><b>Identify any domains or hosts to map to the current realm.</b><p>This mapping allows other domains to belong in the default realm of the
client.</p></li>
<li><b>Specify if the client will use Kerberized NFS.</b><p>NFS service keys need to be created if the client will host NFS
services using Kerberos.</p></li>
<li><b>Indicate if the <tt>/etc/pam.conf</tt> file needs to be updated.</b><p>This allows you to set which PAM services use Kerberos for authentication. You
need to enter the service name and a flag indicating how Kerberos
authentication is to be used. The valid flag options are:</p>
<ul><li><p><tt>first</tt> &ndash; use Kerberos authentication first, and only use UNIX if Kerberos authentication fails</p></li>
<li><p><tt>only</tt> &ndash; use Kerberos authentication only</p></li>
<li><p><tt>optional</tt> &ndash; use Kerberos authentication optionally</p></li></ul>
</li>
<li><b>Select if the master <tt>/etc/krb5/krb5.conf</tt> file should be copied.</b><p>This option allows for specific configuration information to be used when the arguments
to <tt>kclient</tt> are not sufficient.</p></li></ol></li></ol><a name="ggtsk"></a><h6>Example&nbsp;23-8 Running the <tt>kclient</tt> Installation Utility</h6><pre>client# <tt><b>/usr/sbin/kclient</b></tt>

Starting client setup
---------------------------------------------------

Is this a client of a non-Solaris KDC ? [y/n]: <tt><b>n</b></tt>
        No action performed.
Do you want to use DNS for kerveros lookups ? [y/n]: <tt><b>n</b></tt>
        No action performed.
Enter the Kerberos realm: <tt><b>EXAMPLE.COM</b></tt>
Specify the KDC hostname for the above realm: <tt><b>kdc1.example.com</b></tt>

Note, this system and the KDC's time must be within 5 minutes of each other for
Kerberos to function. Both systems should run some form of time synchronization
system like Network Time Protocol (NTP).
Do you have any slave KDC(s) ? [y/n]: <tt><b>y</b></tt>
Enter a comma-separated list of slave KDC host names: <tt><b>kdc2.example.com</b></tt>

Will this client need service keys ? [y/n]: <tt><b>n</b></tt>
        No action performed.
Is this client a member of a cluster that uses a logical host name ? [y/n]: <tt><b>n</b></tt>
        No action performed.
Do you have multiple domains/hosts to map to realm ? [y/n]: <tt><b>y</b></tt>
Enter a comma-separated list of domain/hosts to map to the default realm: <tt><b>engineering.example.com, \ example.com</b></tt>

Setting up /etc/krb5/krb5.conf.

Do you plan on doing Kerberized nfs ? [y/n]: <tt><b>y</b></tt>
Do you want to update /etc/pam.conf ? [y/n]: <tt><b>y</b></tt>
Enter a comma-separated list of PAM service names in the following format:
service:{first|only|optional}: <tt><b>xscreensaver:first</b></tt>
Configuring /etc/pam.conf.

Do you want to copy over the master krb5.conf file ? [y/n]: <tt><b>n</b></tt>
        No action performed.

---------------------------------------------------
Setup COMPLETE.</pre><a name="ehgbb"></a><h6>Example&nbsp;23-9 Running the <tt>kclient</tt> Installation Utility on the Solaris 10 Release</h6><p>The following output shows the results of running the <tt>kclient</tt> command.</p><pre>client# <tt><b>/usr/sbin/kclient</b></tt>

Starting client setup
---------------------------------------------------

Do you want to use DNS for kerberos lookups ? [y/n]: <tt><b>n</b></tt>
        No action performed.
Enter the Kerberos realm: <tt><b>EXAMPLE.COM</b></tt>
Specify the KDC hostname for the above realm: <tt><b>kdc1.example.com</b></tt>

Setting up /etc/krb5/krb5.conf.

Enter the krb5 administrative principal to be used: <tt><b>clntconfig/admin</b></tt>
Obtaining TGT for clntconfig/admin ...
Password for clntconfig/admin@EXAMPLE.COM: &lt;Type the password&gt;
Do you plan on doing Kerberized nfs ? [y/n]: <tt><b>n</b></tt>

host/client.example.com entry ADDED to KDC database.
host/client.example.com entry ADDED to keytab.

Do you want to copy over the master krb5.conf file ? [y/n]: <tt><b>y</b></tt>
Enter the pathname of the file to be copied: \
<tt><b>/net/denver.example.com/export/install/krb5.conf</b></tt>

Copied /net/denver.example.com/export/install/krb5.conf.

---------------------------------------------------
Setup COMPLETE !
#</pre>

<a name="ggtwg"></a><h4>How to Configure a Kerberos Client for an Active Directory Server</h4><p>This procedure uses the <tt>kclient</tt> installation utility without a installation profile.</p><ol><a name="ggttx"></a>
<li><b>Become superuser.</b></li>
<li>(Optional) <b>Enable DNS resource record creation for the client.</b><p>This command causes DNS records to be created when the client is joined
to the Active Directory domain.</p><pre>client# <tt><b>svccfg -s smb/server setprop smbd/ddns_enable=true</b></tt></pre></li>
<li><b>Run the <tt>kclient</tt> installation script.</b><p>You need to provide the following information:</p>
<ul><li><p>Password for the administrative principal</p></li></ul>
</li></ol><a name="ggtur"></a><h6>Example&nbsp;23-10 Configuring a Kerberos Client for an Active Directory Server Using <tt>kclient</tt>.</h6><p>The following output shows the results of running the <tt>kclient</tt> command using the
<tt>ms_ad</tt> (Microsoft Active Directory) server type argument. The client will be joined to
the Active Directory domain called EXAMPLE.COM.</p><pre>client# <tt><b>/usr/sbin/kclient -T ms_ad</b></tt>

Starting client setup
---------------------------------------------------

Attempting to join 'CLIENT' to the 'EXAMPLE.COM' domain.
Password for Administrator@EXAMPLE.COM: &lt;Type the password&gt;
Forest name found: example.com
Looking for local KDCs, DCs and global catalog servers (SVR RRs).

Setting up /etc/krb5/krb5.conf

Creating the machine account in AD via LDAP.
---------------------------------------------------
Setup COMPLETE.
#</pre>

<a name="setup-341"></a><h4>How to Manually Configure a Kerberos Client</h4><p>In this procedure, the following configuration parameters are used:</p>
<ul><li><p>Realm name = <tt>EXAMPLE.COM</tt></p></li>
<li><p>DNS domain name = <tt>example.com</tt></p></li>
<li><p>Master KDC = <tt>kdc1.example.com</tt></p></li>
<li><p>Slave KDC = <tt>kdc2.example.com</tt></p></li>
<li><p>NFS server = <tt>denver.example.com</tt></p></li>
<li><p>Client = <tt>client.example.com</tt></p></li>
<li><p><tt>admin</tt> principal = <tt>kws/admin</tt></p></li>
<li><p>User principal = <tt>mre</tt></p></li>
<li><p>Online help URL = <tt>http://denver:8888/ab2/coll.384.1/SEAM/@AB2PageView/6956</tt></p>
<hr><p><b>Note - </b>Adjust the URL to point to the &ldquo;Graphical Kerberos Administration Tool&rdquo; section, as described in the <a href="seamplan-3.html">Online Help URL in the Graphical Kerberos Administration Tool</a>.</p>
<hr>
</li></ul>
<ol>
<li><a name="seamtask-step-403"></a><b>Become superuser.</b></li>
<li><a name="seamtask-step-404"></a><b>Edit the Kerberos configuration file (<tt>krb5.conf</tt>).</b><p>To change the file from the Kerberos default version, you need to change
the realm names and the server names. You also need to identify the
path to the help files for <tt>gkadmin</tt>.</p><pre>kdc1 # <tt><b>cat /etc/krb5/krb5.conf</b></tt>
[libdefaults]
        default_realm = <tt><b>EXAMPLE.COM</b></tt>

[realms]
        <tt><b>EXAMPLE.COM</b></tt> = {
        <tt><b>kdc = kdc1.example.com</b></tt>
        <tt><b>kdc = kdc2.example.com</b></tt>
        admin_server = <tt><b>kdc1.example.com</b></tt>
        }

[domain_realm]
        <tt><b>.example.com = EXAMPLE.COM</b></tt>
#
# if the domain name and realm name are equivalent, 
# this entry is not needed
#
[logging]
        default = FILE:/var/krb5/kdc.log
        kdc = FILE:/var/krb5/kdc.log

[appdefaults]
    gkadmin = {
        help_url = <tt><b>http://denver:8888/ab2/coll.384.1/SEAM/@AB2PageView/6956</b></tt></pre>
<hr><p><b>Note - </b>If you want to restrict the encryption types, you can set the
<tt>default_tkt_enctypes</tt> or <tt>default_tgs_enctypes</tt> lines. Refer to <a href="egric.html">Using Kerberos Encryption Types</a> for a description of the issues involved
with restricting the encryption types.</p>
<hr>
</li>
<li>(Optional) <b>Change the process used to locate the KDCs.</b><p>Starting with the Solaris 10 5/08 and Solaris Express Developer Edition 1/08
releases, by default the Kerberos realm to KDC mapping is determined in the
following order:</p>
<ul><li><p>The definition in the <tt>realms</tt> section in <tt>krb5.conf</tt>.</p></li>
<li><p>By looking up SRV records in DNS.</p></li></ul>
<p>You can change this behavior by adding <tt>dns_lookup_kdc</tt> or <tt>dns_fallback</tt> to the
<tt>libdefaults</tt> section of the <tt>krb5.conf</tt> file. See the <a href="http://docs.sun.com/doc/819-2251/krb5.conf-4?a=view"><tt>krb5.conf</tt>(4)</a> man page for
more information. Note that referrals are always tried first.</p></li>
<li>(Optional) <b>Change the process used to determine the realm for a host.</b><p>Starting with the Solaris 10 5/08 and Solaris Express Developer Edition 1/08
releases, by default the host to realm mapping is determined in the following
order:</p>
<ul><li><p>If the KDC supports referrals, then the KDC may inform the client which realm the host belongs to.</p></li>
<li><p>By the definition of <tt>domain_realm</tt> in the <tt>krb5.conf</tt> file.</p></li>
<li><p>The DNS domainname of the host.</p></li>
<li><p>The default realm.</p></li></ul>
<p>You can change this behavior by adding <tt>dns_lookup_kdc</tt> or <tt>dns_fallback</tt> to the
<tt>libdefaults</tt> section of the <tt>krb5.conf</tt>file. See the <a href="http://docs.sun.com/doc/819-2251/krb5.conf-4?a=view"><tt>krb5.conf</tt>(4)</a> man page for more
information. Note that referrals will always be tried first.</p></li>
<li><a name="setup-step-220"></a>(Optional) <b>Synchronize the client's clock with the master KDC's clock by using NTP or
another clock synchronization mechanism.</b><p>Installing and using the Network Time Protocol (NTP) is not required. However, every
clock must be synchronized with the time on the KDC server within a
maximum difference defined in the <tt>clockskew</tt> relation in the <tt>krb5.conf</tt> file for authentication
to succeed. See <a href="setup-192.html">Synchronizing Clocks Between KDCs and Kerberos Clients</a> for information about NTP.</p></li>
<li><a name="ejurk"></a><b>Start <tt>kadmin</tt>.</b><p>You can use the Graphical Kerberos Administration Tool to add a principal, as
explained in <a href="aadmin-9.html#aadmin-17">How to Create a New Kerberos Principal</a>. To do so, you must log in with one of the
<tt>admin</tt> principal names that you created when you configured the master KDC. However,
the following example shows how to add the required principals by using the
command line. </p><pre>denver # <tt><b>/usr/sbin/kadmin -p kws/admin</b></tt>
Enter password: &lt;Type kws/admin password&gt;
kadmin: </pre><ol style="list-style-type: lower-alpha">
				 
<li><a name="setup-step-221a"></a>(Optional) <b>Create a user principal if a user principal does not already exist.</b><p>You need to create a user principal only if the user associated with
this host does not already have a principal assigned to him or her.</p><pre>kadmin: <tt><b>addprinc mre</b></tt>
Enter password for principal mre@EXAMPLE.COM: &lt;Type the password&gt;
Re-enter password for principal mre@EXAMPLE.COM: &lt;Type it again&gt;
kadmin: </pre></li>
<li><a name="ejusb"></a>(Optional) <b>Create a <tt>root</tt> principal and add the principal to the server's keytab file.</b><p>This step is required so that the client can have <tt>root</tt> access to
file systems mounted using the NFS service. This step is also required if
non-interactive <tt>root</tt> access is needed, such as running cron jobs as <tt>root</tt>.</p><p>If the client does not require <tt>root</tt> access to a remote file system
which is mounted using the NFS service, then you can skip this step.
The <tt>root</tt> principal should be a two component principal with the second component
the host name of the Kerberos client system to avoid  the creation
of a realm wide <tt>root</tt> principal. Note that when the principal instance is
a host name, the FQDN must be specified in lowercase letters, regardless of
the case of the domain name in the <tt>/etc/resolv.conf</tt> file.</p><pre>kadmin: <tt><b>addprinc -randkey root/client.example.com</b></tt>
Principal "root/client.example.com" created.
kadmin: <tt><b>ktadd root/client.example.com</b></tt>
Entry for principal root/client.example.com with kvno 3, encryption type AES-256 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal root/client.example.com with kvno 3, encryption type AES-128 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal root/client.example.com with kvno 3, encryption type Triple DES cbc
          mode with HMAC/sha1 added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal root/client.example.com with kvno 3, encryption type ArcFour
          with HMAC/md5 added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal root/client.example.com with kvno 3, encryption type DES cbc mode
          with RSA-MD5 added to keytab WRFILE:/etc/krb5/krb5.keytab.
kadmin: </pre></li>
<li><a name="ejuqx"></a><b>Create a <tt>host</tt> principal and add the principal to the server's keytab file.</b><p>The <tt>host</tt> principal is used by remote access services to provide authentication. The
principal allows <tt>root</tt> to acquire a credential, if there is not one already in
the keytab file.</p><pre>kadmin: <tt><b>addprinc -randkey host/denver.example.com</b></tt>
Principal "host/denver.example.com@EXAMPLE.COM" created.
kadmin: <tt><b>ktadd host/denver.example.com</b></tt>
Entry for principal host/denver.example.com with kvno 3, encryption type AES-256 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal host/denver.example.com with kvno 3, encryption type AES-128 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal host/denver.example.com with kvno 3, encryption type Triple DES cbc
          mode with HMAC/sha1 added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal host/denver.example.com with kvno 3, encryption type ArcFour
          with HMAC/md5 added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal host/denver.example.com with kvno 3, encryption type DES cbc mode
          with RSA-MD5 added to keytab WRFILE:/etc/krb5/krb5.keytab.
kadmin:</pre></li>
<li><a name="ejusq"></a>(Optional) <b>Add the server's NFS service principal to the server's keytab file.</b><p>This step is only required if the client needs to access NFS file
systems using Kerberos authentication.</p><pre>kadmin: <tt><b>ktadd nfs/denver.example.com</b></tt>
Entry for principal nfs/denver.example.com with kvno 3, encryption type AES-256 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal nfs/denver.example.com with kvno 3, encryption type AES-128 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal nfs/denver.example.com with kvno 3, encryption type Triple DES cbc
          mode with HMAC/sha1 added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal nfs/denver.example.com with kvno 3, encryption type ArcFour
          with HMAC/md5 added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal nfs/denver.example.com with kvno 3, encryption type DES cbc mode
          with RSA-MD5 added to keytab WRFILE:/etc/krb5/krb5.keytab.
kadmin: </pre></li>
<li><b>Add the <tt>host</tt> principal to the server's keytab file.</b><pre>kadmin: <tt><b>ktadd host/denver.example.com</b></tt>
Entry for principal host/denver.example.com with kvno 3, encryption type AES-256 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal host/denver.example.com with kvno 3, encryption type AES-128 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal host/denver.example.com with kvno 3, encryption type Triple DES cbc
          mode with HMAC/sha1 added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal host/denver.example.com with kvno 3, encryption type ArcFour
          with HMAC/md5 added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal host/denver.example.com with kvno 3, encryption type DES cbc mode
          with RSA-MD5 added to keytab WRFILE:/etc/krb5/krb5.keytab.
kadmin:</pre></li>
<li><a name="ejutc"></a><b>Quit <tt>kadmin</tt>.</b><pre>kadmin: <tt><b>quit</b></tt></pre></li></ol></li>
<li><a name="seamtask-step-406"></a>(Optional) <b>Enable Kerberos with NFS.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Enable Kerberos security modes in the <tt>/etc/nfssec.conf</tt> file.</b><p>Edit the <tt>/etc/nfssec.conf</tt> file and remove the &ldquo;#&rdquo; that is placed in front
of the Kerberos security modes.</p><pre># <tt><b>cat /etc/nfssec.conf</b></tt>
 .
 .
#
# Uncomment the following lines to use Kerberos V5 with NFS
#
krb5            390003  kerberos_v5     default -               # RPCSEC_GSS
krb5i           390004  kerberos_v5     default integrity       # RPCSEC_GSS
krb5p           390005  kerberos_v5     default privacy         # RPCSEC_GSS</pre></li>
<li><b>Enable DNS.</b><p>If the <tt>/etc/resolv.conf</tt> file has not already been created, then create this file
as the service principal canonicalization is dependent upon DNS to do this. See
the <a href="http://docs.sun.com/doc/819-2251/resolv.conf-4?a=view"><tt>resolv.conf</tt>(4)</a> man page for more information.</p></li>
<li><b>Restart the <tt>gssd</tt> service.</b><p>After the <tt>/etc/resolv.conf</tt> file has been created or modified you must then restart the
<tt>gssd</tt> daemon to reread any changes.</p><pre># <tt><b>svcadm restart network/rpc/gss</b></tt></pre></li></ol></li>
<li><a name="seamtask-step-407"></a><b><a name="indexterm-2611"></a><a name="indexterm-2612"></a>If you want the client to automatically renew the TGT or to warn
users about Kerberos ticket expiration, create an entry in the <tt>/etc/krb5/warn.conf</tt> file. </b><p>See the <a href="http://docs.sun.com/doc/819-2251/warn.conf-4?a=view"><tt>warn.conf</tt>(4)</a> man page for more information.</p></li></ol><a name="ehgbd"></a><h6>Example&nbsp;23-11 Setting Up a Kerberos Client Using a Non-Solaris KDC</h6><p>A Kerberos client can be set up to work with a non-Solaris
KDC. In this case, a line must be included in the <tt>/etc/krb5/krb5.conf</tt> file in
the <tt>realms</tt> section. This line changes the protocol that is used when the
client is communicating with the Kerberos password-changing server. The format of this line
follows.</p><pre>[realms]
                EXAMPLE.COM = {
                kdc = kdc1.example.com
                kdc = kdc2.example.com
                admin_server = kdc1.example.com
                <tt><b>kpasswd_protocol = SET_CHANGE</b></tt>
        }</pre><h6>Example&nbsp;23-12 DNS TXT Records for the Mapping of Host and Domain Name to Kerberos Realm</h6><pre>@ IN SOA kdc1.example.com root.kdc1.example.com (
                                1989020501   ;serial
                                10800        ;refresh
                                3600         ;retry
                                3600000      ;expire
                                86400 )      ;minimum

                        IN      NS      kdc1.example.com.
kdc1                    IN      A       192.146.86.20
kdc2                    IN      A       192.146.86.21

_kerberos.example.com.             IN      TXT     "EXAMPLE.COM"
_kerberos.kdc1.example.com.        IN      TXT     "EXAMPLE.COM"
_kerberos.kdc2.example.com.        IN      TXT     "EXAMPLE.COM"</pre><a name="ejusj"></a><h6>Example&nbsp;23-13 DNS SRV Records for Kerberos Server Locations</h6><p>This example defines the records for the location of the KDCs, the <tt>admin</tt>
server, and the <tt>kpasswd</tt> server, respectively.</p><pre>@ IN SOA kdc1.example.com root.kdc1.example.com (
                                1989020501   ;serial
                                10800        ;refresh
                                3600         ;retry
                                3600000      ;expire
                                86400 )      ;minimum

                                   IN      NS      kdc1.example.com.
kdc1                               IN      A       192.146.86.20
kdc2                               IN      A       192.146.86.21

_kerberos._udp.EXAMPLE.COM         IN      SRV 0 0 88  kdc2.example.com
_kerberos._tcp.EXAMPLE.COM         IN      SRV 0 0 88  kdc2.example.com
_kerberos._udp.EXAMPLE.COM         IN      SRV 1 0 88  kdc1.example.com
_kerberos._tcp.EXAMPLE.COM         IN      SRV 1 0 88  kdc1.example.com
_kerberos-adm._tcp.EXAMPLE.COM     IN      SRV 0 0 749 kdc1.example.com
_kpasswd._udp.EXAMPLE.COM          IN      SRV 0 0 749 kdc1.example.com</pre>

<a name="fgohx"></a><h4>How to Access a Kerberos Protected NFS File System as the <tt>root</tt> User</h4><p>This procedure allows a client to access a NFS file system that
requires Kerberos authentication with the <tt>root</tt> ID privilege. In particular, if the NFS file
system is shared with options like: <tt>-o</tt> <tt>sec=krb5,root=client1.sun.com</tt>.</p><ol>
<li><b>Become superuser.</b></li>
<li><b>Start <tt>kadmin</tt>.</b><p>You can use the Graphical Kerberos Administration Tool to add a principal, as
explained in <a href="aadmin-9.html#aadmin-17">How to Create a New Kerberos Principal</a>. To do so, you must log in with one of
the <tt>admin</tt> principal names that you created when you configured the master KDC.
However, the following example shows how to add the required principals by using
the command line. </p><pre>denver # <tt><b>/usr/sbin/kadmin -p kws/admin</b></tt>
Enter password: &lt;Type kws/admin password&gt;
kadmin: </pre><ol style="list-style-type: lower-alpha">
				 
<li><b>Create a <tt>root</tt> principal for the NFS client.</b><p>This principal is used to provide root equivalent access to NFS mounted file
systems that require Kerberos authentication. The <tt>root</tt> principal should be a two component
principal with the second component the host name of the Kerberos client system
to avoid  the creation of a realm wide root principal. Note that
when the principal instance is a host name, the FQDN must be specified
in lowercase letters, regardless of the case of the domain name in the
<tt>/etc/resolv.conf</tt> file.</p><pre>kadmin: <tt><b>addprinc -randkey root/client.example.com</b></tt>
Principal "root/client.example.com" created.
kadmin:</pre></li>
<li><b>Add the <tt>root</tt> principal to the server's keytab file.</b><p>This step is required if you added a <tt>root</tt> principal so that the
client can have <tt>root</tt> access to file systems mounted using the NFS service.
This step is also required if non-interactive <tt>root</tt> access is needed, such
as running cron jobs as <tt>root</tt>.</p><pre>kadmin: <tt><b>ktadd root/client.example.com</b></tt>
Entry for principal root/client.example.com with kvno 3, encryption type AES-256 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal root/client.example.com with kvno 3, encryption type AES-128 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal root/client.example.com with kvno 3, encryption type Triple DES cbc
          mode with HMAC/sha1 added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal root/client.example.com with kvno 3, encryption type ArcFour
          with HMAC/md5 added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal root/client.example.com with kvno 3, encryption type DES cbc mode
          with RSA-MD5 added to keytab WRFILE:/etc/krb5/krb5.keytab.
kadmin: </pre></li>
<li><b>Quit <tt>kadmin</tt>.</b><pre>kadmin: <tt><b>quit</b></tt></pre></li></ol></li></ol>

<a name="faavx"></a><h4>How to Configure Automatic Migration of Users in a Kerberos Realm</h4><p>Users, who do not have a Kerberos principal, can be automatically migrated to
an existing Kerberos realm. The migration is achieved by using the PAM framework
for the service  in use by stacking the <tt>pam_krb5_migrate</tt> module in 
the service's authentication stack in <tt>/etc/pam.conf</tt>.</p><p>In this example, the <tt>dtlogin</tt> and <tt>other</tt> PAM service names are configured to
use the automatic migration. The following configuration parameters are used:</p>
<ul><li><p>Realm name = <tt>EXAMPLE.COM</tt></p></li>
<li><p>Master KDC = <tt>kdc1.example.com</tt></p></li>
<li><p>Machine hosting the migration service = <tt>server1.example.com</tt></p></li>
<li><p>Migration service principal = <tt>host/server1.example.com</tt></p></li></ul>
<h6>Before You Begin</h6><p>Setup <tt>server1</tt> as a Kerberos client of the realm <tt>EXAMPLE.COM</tt>. See <a href="">Configuring Kerberos Clients</a>
for more information.</p><ol>
<li><b>Check to see if a host service principal for <tt>server1</tt> exists.</b><p>The host service principal in the <tt>keytab</tt> file of <tt>server1</tt> is used to
authenticate the server to the master KDC.</p><pre>server1 # <tt><b>klist -k</b></tt>
Keytab name: FILE:/etc/krb5/krb5.keytab
    KVNO Principal
    ---- ------------------------------------------------
       3 host/server1.example.com@EXAMPLE.COM
       3 host/server1.example.com@EXAMPLE.COM
       3 host/server1.example.com@EXAMPLE.COM
       3 host/server1.example.com@EXAMPLE.COM</pre></li>
<li><b>Make changes to the PAM configuration file.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Add entries for the <tt>dtlogin</tt> service.</b><pre># <tt><b>cat /etc/pam.conf</b></tt>
 .
 .
<tt><b># # dtlogin service (explicit because of pam_krb5_migrate) # dtlogin auth requisite pam_authtok_get.so.1 dtlogin auth required pam_dhkeys.so.1 dtlogin auth required pam_unix_cred.so.1 dtlogin auth sufficient pam_krb5.so.1 dtlogin auth requisite pam_unix_auth.so.1 dtlogin auth optional pam_krb5_migrate.so.1</b></tt></pre></li>
<li>(Optional) <b>Force an immediate password change, if needed.</b><p>The newly created Kerberos accounts can have their password expiration time set to
the current time (now), in order to force an immediate Kerberos password change.
To set the expiration time to now, add the <tt>expire_pw</tt> option to
the lines which use the <tt>pam_krb5_migrate</tt> module. See the <a href="http://docs.sun.com/doc/819-2252/pam-krb5-migrate-5?a=view"><tt>pam_krb5_migrate</tt>(5)</a> man page
for more information.</p><pre># <tt><b>cat /etc/pam.conf</b></tt>
 .
 .
<tt><b>dtlogin auth optional pam_krb5_migrate.so.1 expire_pw</b></tt></pre></li>
<li><b>Add the <tt>pam_krb5</tt> module to the account stack.</b><p>This addition allows for password expiration in Kerberos to block access.</p><pre># <tt><b>cat /etc/pam.conf</b></tt>
 .
 .
#
# Default definition for Account management
# Used when service name is not explicitly mentioned for account management
#
other   account requisite       pam_roles.so.1
<tt><b>other account required pam_krb5.so.1</b></tt>
other   account required        pam_unix_account.so.1</pre></li>
<li><b>Add the <tt>pam_krb5</tt> module to the password stack.</b><p>This addition allows for passwords to be updated when the password expire.</p><pre># <tt><b>cat /etc/pam.conf</b></tt>
 .
 .
#
# Default definition for Password management
# Used when service name is not explicitly mentioned for password management
#
other   password required       pam_dhkeys.so.1
other   password requisite      pam_authtok_get.so.1
other   password requisite      pam_authtok_check.so.1
other   password sufficient     pam_krb5.so.1
other   password required       pam_authtok_store.so.1</pre></li></ol></li>
<li><b>On the master KDC, update the access control file.</b><p>The following entries grant migrate and inquire privileges to the <tt>host/server1.example.com</tt> service principal
for all users, excepting the <tt>root</tt> user. It is important that users who
should not be migrated are listed in the kadm5.acl file using the <tt>U</tt>
privilege. These entries need to be before the permit all or <tt>ui</tt> entry.
See the <a href="http://docs.sun.com/doc/819-2251/kadm5.acl-4?a=view"><tt>kadm5.acl</tt>(4)</a> man page for more information.</p><pre>kdc1 # <tt><b>cat /etc/krb5/kadm5.acl</b></tt>
host/server1.example.com@EXAMPLE.COM U root
host/server1.example.com@EXAMPLE.COM ui *
*/admin@EXAMPLE.COM *</pre></li>
<li><b>On the master KDC, restart the Kerberos administration daemon.</b><p>This step allows the <tt>kadmind</tt> daemon to use the new <tt>kadm5.acl</tt> entries.</p><pre>kdc1 # <tt><b>svcadm restart network/security/kadmin</b></tt></pre></li>
<li><b>On the master KDC, add entries to the <tt>pam.conf</tt> file.</b><p>The following entries enable the <tt>kadmind</tt> daemon to use the <tt>k5migrate</tt> PAM service,
to validate UNIX user password for accounts that require migration.</p><pre># <tt><b>grep k5migrate /etc/pam.conf</b></tt>
k5migrate        auth    required        pam_unix_auth.so.1
k5migrate        account required        pam_unix_account.so.1</pre></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="setup-97.html">Previous</a>
             </td>
             <td align="right">
                 <a href="setup-192.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

