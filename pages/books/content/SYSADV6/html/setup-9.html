<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Configuring KDC Servers - System Administration Guide: Security Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Security Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ezecs.html">Previous</a>
             </td>
             <td align="right">
                 <a href="setup-87.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="oview-1.html">Part&nbsp;I&nbsp;Security Overview</a></p>
<p class="toc level2"><a href="secov-1.html">1.&nbsp;&nbsp;Security Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="sectm-1.html">Part&nbsp;II&nbsp;System, File, and Device Security</a></p>
<p class="toc level2"><a href="concept-1.html">2.&nbsp;&nbsp;Managing Machine Security (Overview)</a></p>
<p class="toc level2"><a href="secsys-1.html">3.&nbsp;&nbsp;Controlling Access to Systems (Tasks)</a></p>
<p class="toc level2"><a href="vscan-1.html">4.&nbsp;&nbsp;Virus Scanning Service (Tasks)</a></p>
<p class="toc level2"><a href="devtask-1.html">5.&nbsp;&nbsp;Controlling Access to Devices (Tasks)</a></p>
<p class="toc level2"><a href="bart-1.html">6.&nbsp;&nbsp;Using the Basic Audit Reporting Tool (Tasks)</a></p>
<p class="toc level2"><a href="secfile-1.html">7.&nbsp;&nbsp;Controlling Access to Files (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="prbactm-1.html">Part&nbsp;III&nbsp;Roles, Rights Profiles, and Privileges</a></p>
<p class="toc level2"><a href="prbac-1.html">8.&nbsp;&nbsp;Using Roles and Privileges (Overview)</a></p>
<p class="toc level2"><a href="rbactask-1.html">9.&nbsp;&nbsp;Using Role-Based Access Control (Tasks)</a></p>
<p class="toc level2"><a href="rbacref-1.html">10.&nbsp;&nbsp;Role-Based Access Control (Reference)</a></p>
<p class="toc level2"><a href="privtask-1.html">11.&nbsp;&nbsp;Privileges (Tasks)</a></p>
<p class="toc level2"><a href="privref-1.html">12.&nbsp;&nbsp;Privileges (Reference)</a></p>
<p class="toc level1 tocsp"><a href="scftm-1.html">Part&nbsp;IV&nbsp;Solaris Cryptographic Services</a></p>
<p class="toc level2"><a href="scf-1.html">13.&nbsp;&nbsp;Solaris Cryptographic Framework (Overview)</a></p>
<p class="toc level2"><a href="scftask-1.html">14.&nbsp;&nbsp;Solaris Cryptographic Framework (Tasks)</a></p>
<p class="toc level2"><a href="kmf-1.html">15.&nbsp;&nbsp;Solaris Key Management Framework</a></p>
<p class="toc level1 tocsp"><a href="authtm-1.html">Part&nbsp;V&nbsp;Authentication Services and Secure Communication</a></p>
<p class="toc level2"><a href="auth-1.html">16.&nbsp;&nbsp;Using Authentication Services (Tasks)</a></p>
<p class="toc level2"><a href="pam-1.html">17.&nbsp;&nbsp;Using PAM</a></p>
<p class="toc level2"><a href="sasl-1.html">18.&nbsp;&nbsp;Using SASL</a></p>
<p class="toc level2"><a href="sshuser-1.html">19.&nbsp;&nbsp;Using Solaris Secure Shell (Tasks)</a></p>
<p class="toc level2"><a href="sshref-1.html">20.&nbsp;&nbsp;Solaris Secure Shell (Reference)</a></p>
<p class="toc level1 tocsp"><a href="seamtm-1.html">Part&nbsp;VI&nbsp;Kerberos Service</a></p>
<p class="toc level2"><a href="intro-1.html">21.&nbsp;&nbsp;Introduction to the Kerberos Service</a></p>
<p class="toc level2"><a href="seamplan-1.html">22.&nbsp;&nbsp;Planning for the Kerberos Service</a></p>
<p class="toc level2"><a href="setup-8.html">23.&nbsp;&nbsp;Configuring the Kerberos Service (Tasks)</a></p>
<p class="toc level3"><a href="setup-306.html">Configuring the Kerberos Service (Task Map)</a></p>
<p class="toc level3"><a href="ezecs.html">Configuring Additional Kerberos Services (Task Map)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Configuring KDC Servers</a></p>
</div>
<p class="toc level3"><a href="setup-87.html">Configuring Cross-Realm Authentication</a></p>
<p class="toc level3"><a href="setup-119.html">Configuring Kerberos Network Application Servers</a></p>
<p class="toc level3"><a href="setup-97.html">Configuring Kerberos NFS Servers</a></p>
<p class="toc level3"><a href="setup-148.html">Configuring Kerberos Clients</a></p>
<p class="toc level3"><a href="setup-192.html">Synchronizing Clocks Between KDCs and Kerberos Clients</a></p>
<p class="toc level3"><a href="aadmin-2.html">Swapping a Master KDC and a Slave KDC</a></p>
<p class="toc level3"><a href="aadmin-3.html">Administering the Kerberos Database</a></p>
<p class="toc level3"><a href="ggklp.html">Managing a KDC on an LDAP Directory Server</a></p>
<p class="toc level3"><a href="setup-280.html">Increasing Security on Kerberos Servers</a></p>
<p class="toc level2 tocsp"><a href="trouble-1.html">24.&nbsp;&nbsp;Kerberos Error Messages and Troubleshooting</a></p>
<p class="toc level2"><a href="aadmin-1.html">25.&nbsp;&nbsp;Administering Kerberos Principals and Policies (Tasks)</a></p>
<p class="toc level2"><a href="user-7.html">26.&nbsp;&nbsp;Using Kerberos Applications (Tasks)</a></p>
<p class="toc level2"><a href="refer-1.html">27.&nbsp;&nbsp;The Kerberos Service (Reference)</a></p>
<p class="toc level1 tocsp"><a href="audittm-1.html">Part&nbsp;VII&nbsp;Solaris Auditing</a></p>
<p class="toc level2"><a href="auditov-1.html">28.&nbsp;&nbsp;Solaris Auditing (Overview)</a></p>
<p class="toc level2"><a href="auditplan-1.html">29.&nbsp;&nbsp;Planning for Solaris Auditing</a></p>
<p class="toc level2"><a href="audittask-1.html">30.&nbsp;&nbsp;Managing Solaris Auditing (Tasks)</a></p>
<p class="toc level2"><a href="auditref-1.html">31.&nbsp;&nbsp;Solaris Auditing (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-2.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="setup-9"></a><h3>Configuring KDC Servers</h3>
<a name="indexterm-2491"></a><p>After you install the Kerberos software, you must configure the KDC servers. Configuring
a master KDC and at least one slave KDC provides the service that
issues credentials. These credentials are the basis for the Kerberos service, so the
KDCs must be installed before you attempt other tasks.</p><p><a name="indexterm-2492"></a><a name="indexterm-2493"></a><a name="indexterm-2494"></a>The most significant difference between a master KDC and a slave KDC is
that only the master KDC can handle database administration requests. For instance, changing
a password or adding a new principal must be done on the master
KDC. These changes can then be propagated to the slave KDCs. Both the
slave KDC and master KDC generate credentials. This feature provides redundancy in case
the master KDC cannot respond. </p><a name="ggdxl"></a><h6>Table&nbsp;23-1 Configuring KDC Servers (Task Map)</h6><table><col width="27%"><col width="42%"><col width="30%"><tr><th align="left" valign="top" scope="column"><p>Task</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
<th align="left" valign="top" scope="column"><p>For Instructions</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Configuring a Master KDC</p></td>
<td align="left" valign="top" scope="row"><p>Configures and builds
the master KDC server and database for a realm using an automatic process,
which is good for scripts.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#ggdrn">How to Automatically Configure a Master KDC</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>Configures and builds the master KDC server and
database for a realm using an interactive process, which is sufficient for most
installations</p></td>
<td align="left" valign="top" scope="row"><p><a href="#ggdsn">How to Interactively Configure a Master KDC</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>Configures and builds the master KDC server and database for a realm using
a manual process, which is needed for more complex installations</p></td>
<td align="left" valign="top" scope="row"><p><a href="#setup-1">How to Configure a Master KDC</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>Configures and builds
the master KDC server and database for a realm using a manual process
and using LDAP for the KDC</p></td>
<td align="left" valign="top" scope="row"><p><a href="#ggdqi">How to Configure a KDC to Use an LDAP Data Server</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Configure a slave KDC server.</p></td>
<td align="left" valign="top" scope="row"><p>Configures and builds
a slave KDC server for a realm using an automatic process, which is
good for scripts</p></td>
<td align="left" valign="top" scope="row"><p><a href="#ggdvb">How to Automatically Configure a Slave KDC</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>Configures and builds a slave KDC server for a realm
using an interactive process, which is sufficient for most installations</p></td>
<td align="left" valign="top" scope="row"><p><a href="#ggdua">How to Interactively Configure a Slave KDC</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>Configures and builds a
slave KDC server for a realm using the manual process, which is needed
for more complex installations</p></td>
<td align="left" valign="top" scope="row"><p><a href="#setup-74">How to Configure a Slave KDC</a></p></td>
</tr>
</table>

<a name="ggdrn"></a><h4>How to Automatically Configure a Master KDC</h4><a name="indexterm-2495"></a><a name="indexterm-2496"></a><a name="indexterm-2497"></a><a name="indexterm-2498"></a><p>Starting with the Solaris 10 5/08 and the Solaris Express Developer Edition
1/08 releases, a master KDC can be automatically configured by using the following
procedure.</p><ol>
<li><b>Become superuser.</b></li>
<li><b>Create the KDC.</b><p>Run the <tt>kdcmgr</tt> utility to create the KDC. You need to provide both
the master key password and the password for the administrative principal.<a name="indexterm-2499"></a></p><pre>kdc1# <tt><b>kdcmgr -a kws/admin -r EXAMPLE.COM create master</b></tt>

Starting server setup
---------------------------------------

Setting up /etc/krb5/kdc.conf

Setting up /etc/krb5/krb5.conf

Initializing database '/var/krb5/principal' for realm 'EXAMPLE.COM', 
master key name 'K/M@EXAMPLE.COM' 
You will be prompted for the database Master Password. 
It is important that you NOT FORGET this password. 
Enter KDC database master key: &lt;Type the password&gt;
Re-enter KDC database master key to verify: &lt;Type it again&gt;

Authenticating as principal root/admin@EXAMPLE.COM with password. 
WARNING: no policy specified for kws/admin@EXAMPLE.COM; defaulting to no policy 
Enter password for principal "kws/admin@EXAMPLE.COM": &lt;Type the password&gt;
Re-enter password for principal "kws/admin@EXAMPLE.COM": &lt;Type it again&gt;
Principal "kws/admin@EXAMPLE.COM" created. 

Setting up /etc/krb5/kadm5.acl. 

--------------------------------------------------- 
Setup COMPLETE. 

kdc1#</pre></li></ol>

<a name="ggdsn"></a><h4>How to Interactively Configure a Master KDC</h4><a name="indexterm-2500"></a><a name="indexterm-2501"></a><a name="indexterm-2502"></a><a name="indexterm-2503"></a><p>Starting with the Solaris 10 5/08 and the Solaris Express Developer Edition
1/08 releases, a master KDC can be interactively configured by using the following
procedure.</p><ol>
<li><b>Become superuser.</b></li>
<li><b>Create the KDC.</b><p><a name="indexterm-2504"></a>Run the <tt>kdcmgr</tt> utility to create the KDC. You need to provide both
the master key password and the password for the administrative principal.</p><pre>kdc1# <tt><b>kdcmgr create master</b></tt>

Starting server setup
---------------------------------------

Enter the Kerberos realm: <tt><b>EXAMPLE.COM</b></tt>

Setting up /etc/krb5/kdc.conf

Setting up /etc/krb5/krb5.conf

Initializing database '/var/krb5/principal' for realm 'EXAMPLE.COM', 
master key name 'K/M@EXAMPLE.COM' 
You will be prompted for the database Master Password. 
It is important that you NOT FORGET this password. 
Enter KDC database master key: &lt;Type the password&gt;
Re-enter KDC database master key to verify: &lt;Type it again&gt;

Enter the krb5 administrative principal to be created: <tt><b>kws/admin</b></tt>

Authenticating as principal root/admin@EXAMPLE.COM with password. 
WARNING: no policy specified for kws/admin@EXAMPLE.COM; defaulting to no policy 
Enter password for principal "kws/admin@EXAMPLE.COM": &lt;Type the password&gt;
Re-enter password for principal "kws/admin@EXAMPLE.COM": &lt;Type it again&gt;
Principal "kws/admin@EXAMPLE.COM" created. 

Setting up /etc/krb5/kadm5.acl. 

--------------------------------------------------- 
Setup COMPLETE. 

kdc1#</pre></li></ol><a name="ggdwr"></a><h6>Example&nbsp;23-1 Displaying the Status of a KDC Server</h6><a name="indexterm-2505"></a><p>The <tt>kdcmgr</tt> <tt>status</tt> command can be used to display information about either a
master or a slave KDC server.</p>

<a name="setup-1"></a><h4>How to Configure a Master KDC</h4><a name="indexterm-2506"></a><a name="indexterm-2507"></a><a name="indexterm-2508"></a><a name="indexterm-2509"></a><p>In this procedure, incremental propagation is configured. In addition, the following configuration parameters
are used: </p>
<ul><li><p>Realm name = <tt>EXAMPLE.COM</tt></p></li>
<li><p>DNS domain name = <tt>example.com</tt></p></li>
<li><p>Master KDC = <tt>kdc1.example.com</tt></p></li>
<li><p><tt>admin</tt> principal = <tt>kws/admin</tt></p></li>
<li><p>Online help URL = <tt>http://denver:8888/ab2/coll.384.1/SEAM/@AB2PageView/6956</tt></p>
<hr><p><b>Note - </b>Adjust the URL to point to the &ldquo;Graphical Kerberos Administration Tool&rdquo; section, as described in <a href="seamplan-3.html">Online Help URL in the Graphical Kerberos Administration Tool</a>.</p>
<hr>
</li></ul>
<h6>Before You Begin</h6><p>This procedure requires that the host is configured to use DNS. For specific
naming instructions if this master is to be swappable, see <a href="aadmin-2.html">Swapping a Master KDC and a Slave KDC</a>.</p><ol>
<li><a name="ggdrw"></a><b>Become superuser on the master KDC.</b></li>
<li><a name="ggdsh"></a><b><a name="indexterm-2510"></a>Edit the Kerberos configuration file (<tt>krb5.conf</tt>).</b><p>You need to change the realm names and the names of the servers.
See the <a href="http://docs.sun.com/doc/819-2251/krb5.conf-4?a=view"><tt>krb5.conf</tt>(4)</a> man page for a full description of this file.</p><pre>kdc1 # <tt><b>cat /etc/krb5/krb5.conf</b></tt>
[libdefaults]
        default_realm = <tt><b>EXAMPLE.COM</b></tt>

[realms]
        <tt><b>EXAMPLE.COM</b></tt> = {
        kdc = <tt><b>kdc1.example.com</b></tt>
        admin_server = <tt><b>kdc1.example.com</b></tt>
        }

[domain_realm]
        <tt><b>.example.com = EXAMPLE.COM</b></tt>
#
# if the domain name and realm name are equivalent, 
# this entry is not needed
#
[logging]
        default = FILE:/var/krb5/kdc.log
        kdc = FILE:/var/krb5/kdc.log

[appdefaults]
    gkadmin = {
        help_url = <tt><b>http://denver:8888/ab2/coll.384.1/SEAM/@AB2PageView/6956</b></tt>
        }</pre><p><a name="indexterm-2511"></a><a name="indexterm-2512"></a><a name="indexterm-2513"></a>In this example, the lines for <tt>default_realm</tt>, <tt>kdc</tt>, <tt>admin_server</tt>, and all <tt>domain_realm</tt>
entries were changed. In addition, the line that defines the <tt>help_url</tt> was edited.</p>
<hr><p><b>Note - </b>If you want to restrict the encryption types, you can set the
<tt>default_tkt_enctypes</tt> or <tt>default_tgs_enctypes</tt> lines. Refer to <a href="egric.html">Using Kerberos Encryption Types</a> for a description of the issues involved
with restricting the encryption types.</p>
<hr>
</li>
<li><a name="ggdqa"></a><b>Edit the KDC configuration file (<tt>kdc.conf</tt>).</b><p>You need to change the realm name. See the <a href="http://docs.sun.com/doc/819-2251/kdc.conf-4?a=view"><tt>kdc.conf</tt>(4)</a> man page
for a full description of this file. </p><pre>kdc1 # <tt><b>cat /etc/krb5/kdc.conf</b></tt>
[kdcdefaults]
        kdc_ports = 88,750

[realms]
        <tt><b>EXAMPLE.COM</b></tt> = {
                profile = /etc/krb5/krb5.conf
                database_name = /var/krb5/principal
                admin_keytab = /etc/krb5/kadm5.keytab
                acl_file = /etc/krb5/kadm5.acl
                kadmind_port = 749
                max_life = 8h 0m 0s
                max_renewable_life = 7d 0h 0m 0s
                <tt><b>sunw_dbprop_enable = true</b></tt>
                <tt><b>sunw_dbprop_master_ulogsize = 1000</b></tt>
                }</pre><p>In this example, the realm name definition in the <tt>realms</tt> section was changed.
Also, in the <tt>realms</tt> section, lines to enable incremental propagation and to select
the number of updates the KDC master keeps in the log were added.</p>
<hr><p><b>Note - </b>If you want to restrict the encryption types, you can set the
<tt>permitted_enctypes</tt>, <tt>supported_enctypes</tt>, or <tt>master_key_type</tt> lines. Refer to <a href="egric.html">Using Kerberos Encryption Types</a> for a description of
the issues involved with restricting the encryption types.</p>
<hr>
</li>
<li><a name="ggdrl"></a><b><a name="indexterm-2514"></a><a name="indexterm-2515"></a><a name="indexterm-2516"></a>Create the KDC database by using the <tt>kdb5_util</tt> command.</b><p>The <tt>kdb5_util</tt> command creates the KDC database. Also, when used with the
<tt>-s</tt> option, this command creates a stash file that is used to authenticate
the KDC to itself before the <tt>kadmind</tt> and <tt>krb5kdc</tt> daemons are started.</p><pre>kdc1 # <tt><b>/usr/sbin/kdb5_util create -s</b></tt>
Initializing database '/var/krb5/principal' for realm 'EXAMPLE.COM'
master key name 'K/M@EXAMPLE.COM'
You will be prompted for the database Master Password.
It is important that you NOT FORGET this password.
Enter KDC database master key: &lt;Type the key&gt;
Re-enter KDC database master key to verify: &lt;Type it again&gt;</pre></li>
<li><a name="ggdsg"></a><b><a name="indexterm-2517"></a><a name="indexterm-2518"></a>Edit the Kerberos access control list file (<tt>kadm5.acl</tt>).</b><p>Once populated, the <tt>/etc/krb5/kadm5.acl</tt> file should contain all principal names that are allowed to
administer the KDC.</p><pre>kws/admin@EXAMPLE.COM   *</pre><p>The entry gives the <tt>kws/admin</tt> principal in the <tt>EXAMPLE.COM</tt> realm the ability
to modify principals or policies in the KDC. The default installation includes an
asterisk (*) to match all <tt>admin</tt> principals. This default could be a
security risk, so it is more secure to include a list of all
of the <tt>admin</tt> principals. See the <a href="http://docs.sun.com/doc/819-2251/kadm5.acl-4?a=view"><tt>kadm5.acl</tt>(4)</a> man page for more information.</p></li>
<li><a name="ggdpy"></a><b>Start the <tt>kadmin.local</tt> command and add principals.</b><p>The next substeps create principals that are used by the Kerberos service.</p><pre>kdc1 # <tt><b>/usr/sbin/kadmin.local</b></tt>
kadmin.local: </pre><ol style="list-style-type: lower-alpha">
				 
<li><a name="ggdqc"></a><b><a name="indexterm-2519"></a><a name="indexterm-2520"></a><a name="indexterm-2521"></a><a name="indexterm-2522"></a>Add administration principals to the database.</b><p>You can add as many <tt>admin</tt> principals as you need. You must add at
least one <tt>admin</tt> principal to complete the KDC configuration process. For this example,
a <tt>kws/admin</tt> principal is added. You can substitute an appropriate principal name instead
of &ldquo;<tt>kws</tt>.&rdquo;</p><pre>kadmin.local: <tt><b>addprinc kws/admin</b></tt>
Enter password for principal kws/admin@EXAMPLE.COM:&lt;Type the password&gt;
Re-enter password for principal kws/admin@EXAMPLE.COM: &lt;Type it again&gt;
Principal "kws/admin@EXAMPLE.COM" created.
kadmin.local: </pre></li>
<li><b>Create the <tt>kiprop</tt> principals.</b><p>The <tt>kiprop</tt> principal is used to authorize updates from the master KDC.</p><pre>kadmin.local: <tt><b>addprinc -randkey kiprop/kdc1.example.com</b></tt>
Principal "kiprop/kdc1.example.com@EXAMPLE.COM" created.
kadmin.local:</pre></li>
<li><a name="ggdsd"></a><b><a name="indexterm-2523"></a><a name="indexterm-2524"></a><a name="indexterm-2525"></a>Create a keytab file for the <tt>kadmind</tt> service.</b><p>This command sequence creates a special keytab file with principal entries for <tt>kadmin/&lt;FQDN&gt;</tt>
and <tt>changepw/&lt;FQDN&gt;</tt>. These principals are needed for the <tt>kadmind</tt> service and for passwords to
be changed. Note that when the principal instance is a host name, the
FQDN must be specified in lowercase letters, regardless of the case of the
domain name in the <tt>/etc/resolv.conf</tt> file. The <tt>kadmin/changepw</tt> principal is used to
change passwords from clients that are not running a Solaris release.</p><pre>kadmin.local: <tt><b>ktadd -k /etc/krb5/kadm5.keytab kadmin/kdc1.example.com</b></tt>
Entry for principal kadmin/kdc1.example.com with kvno 3, encryption type AES-256 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal kadmin/kdc1.example.com with kvno 3, encryption type AES-128 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal kadmin/kdc1.example.com with kvno 3, encryption type Triple DES cbc
          mode with HMAC/sha1 added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal kadmin/kdc1.example.com with kvno 3, encryption type ArcFour
          with HMAC/md5 added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal kadmin/kdc1.example.com with kvno 3, encryption type DES cbc mode
          with RSA-MD5 added to keytab WRFILE:/etc/krb5/kadm5.keytab.
kadmin.local: <tt><b>ktadd -k /etc/krb5/kadm5.keytab changepw/kdc1.example.com</b></tt>
Entry for principal changepw/kdc1.example.com with kvno 3, encryption type AES-256 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal changepw/kdc1.example.com with kvno 3, encryption type AES-128 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal changepw/kdc1.example.com with kvno 3, encryption type Triple DES cbc
          mode with HMAC/sha1 added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal changepw/kdc1.example.com with kvno 3, encryption type ArcFour
          with HMAC/md5 added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal changepw/kdc1.example.com with kvno 3, encryption type DES cbc mode
          with RSA-MD5 added to keytab WRFILE:/etc/krb5/kadm5.keytab.
kadmin.local: <tt><b>ktadd -k /etc/krb5/kadm5.keytab kadmin/changepw</b></tt>
Entry for principal kadmin/changepw with kvno 3, encryption type AES-256 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal kadmin/changepw with kvno 3, encryption type AES-128 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal kadmin/changepw with kvno 3, encryption type Triple DES cbc
          mode with HMAC/sha1 added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal kadmin/changepw with kvno 3, encryption type ArcFour
          with HMAC/md5 added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal kadmin/changepw with kvno 3, encryption type DES cbc mode
          with RSA-MD5 added to keytab WRFILE:/etc/krb5/kadm5.keytab.
kadmin.local:</pre></li>
<li><b>Add the <tt>kiprop</tt> principal for the master KDC server to the <tt>kadmind</tt> keytab
file.</b><p>Adding the <tt>kiprop</tt> principal to the <tt>kadm5.keytab</tt> file allows the <tt>kadmind</tt> command
to authenticate itself when incremental propagation is started.</p><pre>kadmin.local: <tt><b>ktadd -k /etc/krb5/kadm5.keytab kiprop/kdc1.example.com</b></tt>
Entry for principal kiprop/kdc1.example.com with kvno 3, encryption type AES-256 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal kiprop/kdc1.example.com with kvno 3, encryption type AES-128 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal kiprop/kdc1.example.com with kvno 3, encryption type Triple DES cbc
          mode with HMAC/sha1 added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal kiprop/kdc1.example.com with kvno 3, encryption type ArcFour
          with HMAC/md5 added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal kiprop/kdc1.example.com with kvno 3, encryption type DES cbc mode
          with RSA-MD5 added to keytab WRFILE:/etc/krb5/kadm5.keytab.
kadmin.local: </pre></li>
<li><a name="ggdss"></a><b>Quit <tt>kadmin.local</tt>.</b><p>You have added all of the required principals for the next steps.</p><pre>kadmin.local: <tt><b>quit</b></tt></pre></li></ol></li>
<li><a name="ggdsq"></a><b>Start the Kerberos daemons.</b><pre>kdc1 # <tt><b>svcadm enable -r network/security/krb5kdc</b></tt>
kdc1 # <tt><b>svcadm enable -r network/security/kadmin</b></tt></pre></li>
<li><a name="ggdqm"></a><b>Start <tt>kadmin</tt> and add more principals.</b><p>At this point, you can add principals by using the Graphical Kerberos Administration
Tool. To do so, you must log in with one of the
<tt>admin</tt> principal names that you created earlier in this procedure. However, the following
command-line example is shown for simplicity. </p><pre>kdc1 # <tt><b>/usr/sbin/kadmin -p kws/admin</b></tt>
Enter password: &lt;Type kws/admin password&gt;
kadmin: </pre><ol style="list-style-type: lower-alpha">
				 
<li><a name="ggdso"></a><b><a name="indexterm-2526"></a><a name="indexterm-2527"></a><a name="indexterm-2528"></a><a name="indexterm-2529"></a>Create the master KDC <tt>host</tt> principal.</b><p>The host principal is used by Kerberized applications, such as <tt>kprop</tt> to propagate changes
to the slave KDCs. This principal is also used to provide secure
remote access to the KDC server using applications, like <tt>ssh</tt>. Note that when the
principal instance is a host name, the FQDN must be specified in lowercase
letters, regardless of the case of the domain name in the <tt>/etc/resolv.conf</tt>
file.</p><pre>kadmin: <tt><b>addprinc -randkey host/kdc1.example.com</b></tt>
Principal "host/kdc1.example.com@EXAMPLE.COM" created.
kadmin: </pre></li>
<li><a name="ggdpr"></a>(Optional) <b><a name="indexterm-2530"></a><a name="indexterm-2531"></a>Create the <tt>kclient</tt> principal.</b><p>This principal is used by the <tt>kclient</tt> utility during the installation of a Kerberos
client. If you do not plan on using this utility, then you
do not need to add the principal. The users of the <tt>kclient</tt> utility need
to use this password.</p><pre>kadmin: <tt><b>addprinc clntconfig/admin</b></tt>
Enter password for principal clntconfig/admin@EXAMPLE.COM:&lt;Type the password&gt;
Re-enter password for principal clntconfig/admin@EXAMPLE.COM: &lt;Type it again&gt;
Principal "clntconfig/admin@EXAMPLE.COM" created.
kadmin: </pre></li>
<li><a name="ggdqq"></a><b><a name="indexterm-2532"></a>Add the master KDC's <tt>host</tt> principal to the master KDC's keytab file.</b><p>Adding the host principal to the keytab file allows this principal to be
used by application servers, like <tt>sshd</tt>, automatically.</p><pre>kadmin: <tt><b>ktadd host/kdc1.example.com</b></tt>
Entry for principal host/kdc1.example.com with kvno 3, encryption type AES-256 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal host/kdc1.example.com with kvno 3, encryption type AES-128 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal host/kdc1.example.com with kvno 3, encryption type Triple DES cbc
          mode with HMAC/sha1 added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal host/kdc1.example.com with kvno 3, encryption type ArcFour
          with HMAC/md5 added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal host/kdc1.example.com with kvno 3, encryption type DES cbc mode
          with RSA-MD5 added to keytab WRFILE:/etc/krb5/krb5.keytab.
kadmin: </pre></li>
<li><a name="ggdro"></a><b>Quit <tt>kadmin</tt>.</b><pre>kadmin: <tt><b>quit</b></tt></pre></li></ol></li>
<li><a name="ggdrj"></a>(Optional) <b><a name="indexterm-2533"></a><a name="indexterm-2534"></a><a name="indexterm-2535"></a><a name="indexterm-2536"></a>Synchronize the master KDCs clock by using NTP or another clock synchronization mechanism.</b><p>Installing and using the Network Time Protocol (NTP) is not required. However, every
clock must be within the default time that is defined in the
<tt>libdefaults</tt> section of the <tt>krb5.conf</tt> file for authentication to succeed. See <a href="setup-192.html">Synchronizing Clocks Between KDCs and Kerberos Clients</a> for
information about NTP.</p></li>
<li><b>Configure Slave KDCs.</b><p>To provide redundancy, make sure to install at least one slave KDC. See
<a href="#setup-74">How to Configure a Slave KDC</a> for specific instructions.</p></li></ol>

<a name="ggdqi"></a><h4>How to Configure a KDC to Use an LDAP Data Server</h4><a name="indexterm-2537"></a><a name="indexterm-2538"></a><a name="indexterm-2539"></a><a name="indexterm-2540"></a><a name="indexterm-2541"></a><p>Starting with the Solaris 10 5/08 and the Solaris Express Developer Edition
1/08 releases, a KDC can be configured to use an LDAP data server
by using the following procedure.</p><p>In this procedure, the following configuration parameters are used: </p>
<ul><li><p>Realm name = <tt>EXAMPLE.COM</tt></p></li>
<li><p>DNS domain name = <tt>example.com</tt></p></li>
<li><p>Master KDC = <tt>kdc1.example.com</tt></p></li>
<li><p>Directory Server = <tt>dsserver.example.com</tt></p></li>
<li><p><tt>admin</tt> principal = <tt>kws/admin</tt></p></li>
<li><p>Online help URL = <tt>http://denver:8888/ab2/coll.384.1/SEAM/@AB2PageView/6956</tt></p>
<hr><p><b>Note - </b>Adjust the URL to point to the &ldquo;Graphical Kerberos Administration Tool&rdquo; section, as described in <a href="seamplan-3.html">Online Help URL in the Graphical Kerberos Administration Tool</a>.</p>
<hr>
</li></ul>
<h6>Before You Begin</h6><p>This procedure also requires that  the host is configured to use
DNS. For better performance, install the KDC and the LDAP Directory Service on the
same server. In addition, a directory server should be running. The procedure below
works with servers using the Sun Java<sup>TM</sup> Directory Server Enterprise Edition release.</p><ol>
<li><b>Become superuser on the KDC.</b></li>
<li><b>Configure the master KDC to use SSL to reach the directory server.</b><p>The following steps configure a Solaris Express Developer Release KDC to use the
Directory Server 6.1 self-signed certificate. If the certificate has expired, follow the instructions for
renewing a certificate in <a href="http://docs.sun.com/doc/820-2763/fwaxk?a=view">To Manage Self-Signed Certificates in <i>Sun Java System Directory Server Enterprise Edition 6.3 Administration Guide</i></a>.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>On the directory server, export the self-signed directory server certificate.</b><pre><tt><b># /export/sun-ds6.1/ds6/bin/dsadm show-cert -F der /export/sun-ds6.1/directory2 \ defaultCert &gt; /tmp/defaultCert.cert.der</b></tt></pre></li>
<li><b>On the master KDC, import the directory server certificate.</b><pre># <tt><b>pktool setpin keystore=nss dir=/var/ldap</b></tt>
# <tt><b>chmod a+r /var/ldap/*.db</b></tt>
# <tt><b>pktool import keystore=nss objtype=cert trust="CT" infile=/tmp/defaultCert.certutil.der</b></tt> \
        <tt><b>label=defaultCert dir=/var/ldap</b></tt></pre></li>
<li><b>On the master KDC, test that SSL is working.</b><p>This example assumes that the <tt>cn=directory manager</tt>entry has administration privileges.</p><pre><tt><b>/usr/bin/ldapsearch -Z -P /var/ldap -D "cn=directory manager" \ -h dsserver.example.com -b "" -s base objectclass='*'</b></tt>
Subject:
    "CN=dsserver.example.com,CN=636,CN=Directory Server,O=Example Corporation</pre><p>Note that the <tt>CN=dsserver.example.com</tt> entry should include the fully qualified host name, not
a short version.</p></li></ol></li>
<li><b>Populate the LDAP directory, if necessary.</b></li>
<li><b>Add the Solaris Kerberos schema to the existing schema.</b><pre># <tt><b>ldapmodify -h dsserver.example.com -D "cn=directory manager" -f /usr/share/lib/ldif/kerberos.ldif</b></tt></pre></li>
<li><b>Create the Kerberos container in the LDAP directory.</b><p>Add the following entries to the <tt>krb5.conf</tt> file.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>Define the database type.</b><p>Add an entry to define the <tt>database_module</tt>to the <tt>realms</tt> section.</p><pre><tt><b>database_module = LDAP</b></tt></pre></li>
<li><b>Define the database module.</b><pre><tt><b>[dbmodules] LDAP = { ldap_kerberos_container_dn = "cn=krbcontainer,dc=example,dc=com" db_library = kldap ldap_kdc_dn = "cn=kdc service,ou=profile,dc=example,dc=com" ldap_kadmind_dn = "cn=kadmin service,ou=profile,dc=example,dc=com" ldap_cert_path = /var/ldap ldap_servers = ldaps://dsserver.example.com }</b></tt></pre></li>
<li><b>Create the KDC in the LDAP directory.</b><p>This command creates <tt>krbcontainer</tt> and several other objects. It also creates a <tt>/var/krb5/.k5.EXAMPLE.COM</tt> master
key stash file.</p><pre># <tt><b>kdb5_ldap_util -D "cn=directory manager" create -P abcd1234 -r EXAMPLE.COM</b></tt> -s</pre></li></ol></li>
<li><b>Stash the KDC bind Distinguished Name (DN) passwords.</b><p>These passwords are used by the KDC when it binds to the DS.
The KDC uses different roles depending on the type of access the KDC
is using.</p><pre># <tt><b>kdb5_ldap_util stashsrvpw "cn=kdc service,ou=profile,dc=example,dc=com"</b></tt>
# <tt><b>kdb5_ldap_util stashsrvpw "cn=kadmin service,ou=profile,dc=example,dc=com"</b></tt></pre></li>
<li><b>Add KDC service roles.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Create a <tt>kdc_roles.ldif</tt> file with contents like this:</b><pre>dn: cn=kdc service,ou=profile,dc=example,dc=com
cn: kdc service
sn: kdc service
objectclass: top
objectclass: person
userpassword: test123

dn: cn=kadmin service,ou=profile,dc=example,dc=com
cn: kadmin service
sn: kadmin service
objectclass: top
objectclass: person
userpassword: test123</pre></li>
<li><b>Create the role entries in the LDAP directory</b><pre># <tt><b>ldapmodify -a -h dsserver.example.com -D "cn=directory manager" -f kdc_roles.ldif</b></tt></pre></li></ol></li>
<li><b>Set the ACLs for the KDC-related roles.</b><pre># cat &lt;&lt; EOF | ldapmodify -h dsserver.example.com -D "cn=directory manager" 
# Set kadmin ACL for everything under krbcontainer.
dn: cn=krbcontainer,dc=example,dc=com
changetype: modify
add: aci
aci: (target="ldap:///cn=krbcontainer,dc=example,dc=com")(targetattr="krb*")(version 3.0;\
      acl kadmin_ACL; allow (all)\
      userdn = "ldap:///cn=kadmin service,ou=profile,dc=example,dc=com";)

# Set kadmin ACL for everything under the people subtree if there are
# mix-in entries for krb princs:
dn: ou=people,dc=example,dc=com
changetype: modify
add: aci
aci: (target="ldap:///ou=people,dc=example,dc=com")(targetattr="krb*")(version 3.0;\
      acl kadmin_ACL; allow (all)\
      userdn = "ldap:///cn=kadmin service,ou=profile,dc=example,dc=com";)
EOF</pre></li>
<li><b><a name="indexterm-2542"></a>Edit the Kerberos configuration file (<tt>krb5.conf</tt>).</b><p>You need to change the realm names and the names of the servers.
See the <a href="http://docs.sun.com/doc/819-2251/krb5.conf-4?a=view"><tt>krb5.conf</tt>(4)</a> man page for a full description of this file.</p><pre>kdc1 # <tt><b>cat /etc/krb5/krb5.conf</b></tt>
[libdefaults]
        default_realm = <tt><b>EXAMPLE.COM</b></tt>

[realms]
        <tt><b>EXAMPLE.COM</b></tt> = {
        kdc = <tt><b>kdc1.example.com</b></tt>
        admin_server = <tt><b>kdc1.example.com</b></tt>
        }

[domain_realm]
        <tt><b>.example.com = EXAMPLE.COM</b></tt>
#
# if the domain name and realm name are equivalent, 
# this entry is not needed
#
[logging]
        default = FILE:/var/krb5/kdc.log
        kdc = FILE:/var/krb5/kdc.log

[appdefaults]
    gkadmin = {
        help_url = <tt><b>http://denver:8888/ab2/coll.384.1/SEAM/@AB2PageView/6956</b></tt>
        }</pre><p><a name="indexterm-2543"></a><a name="indexterm-2544"></a><a name="indexterm-2545"></a>In this example, the lines for <tt>default_realm</tt>, <tt>kdc</tt>, <tt>admin_server</tt>, and all <tt>domain_realm</tt>
entries were changed. In addition, the line that defines the <tt>help_url</tt> was edited.</p>
<hr><p><b>Note - </b>If you want to restrict the encryption types, you can set the
<tt>default_tkt_enctypes</tt> or <tt>default_tgs_enctypes</tt> lines. Refer to <a href="egric.html">Using Kerberos Encryption Types</a> for a description of the issues involved
with restricting the encryption types.</p>
<hr>
</li>
<li><b>Edit the KDC configuration file (<tt>kdc.conf</tt>).</b><p>You need to change the realm name. See the <a href="http://docs.sun.com/doc/819-2251/kdc.conf-4?a=view"><tt>kdc.conf</tt>(4)</a> man page
for a full description of this file. </p><pre>kdc1 # <tt><b>cat /etc/krb5/kdc.conf</b></tt>
[kdcdefaults]
        kdc_ports = 88,750

[realms]
        <tt><b>EXAMPLE.COM</b></tt> = {
                profile = /etc/krb5/krb5.conf
                database_name = /var/krb5/principal
                admin_keytab = /etc/krb5/kadm5.keytab
                acl_file = /etc/krb5/kadm5.acl
                kadmind_port = 749
                max_life = 8h 0m 0s
                max_renewable_life = 7d 0h 0m 0s
                <tt><b>sunw_dbprop_enable = true</b></tt>
                <tt><b>sunw_dbprop_master_ulogsize = 1000</b></tt>
                }</pre><p>In this example, the realm name definition in the <tt>realms</tt> section was changed.
Also, in the <tt>realms</tt> section, lines to enable incremental propagation and to select
the number of updates the KDC master keeps in the log were added.</p>
<hr><p><b>Note - </b>If you want to restrict the encryption types, you can set the
<tt>permitted_enctypes</tt>, <tt>supported_enctypes</tt>, or <tt>master_key_type</tt> lines. Refer to <a href="egric.html">Using Kerberos Encryption Types</a> for a description of
the issues involved with restricting the encryption types.</p>
<hr>
</li>
<li><b><a name="indexterm-2546"></a><a name="indexterm-2547"></a>Edit the Kerberos access control list file (<tt>kadm5.acl</tt>).</b><p>Once populated, the <tt>/etc/krb5/kadm5.acl</tt> file should contain all principal names that are allowed to
administer the KDC. </p><pre>kws/admin@EXAMPLE.COM   *</pre><p>The entry gives the <tt>kws/admin</tt> principal in the <tt>EXAMPLE.COM</tt> realm the ability
to modify principals or policies in the KDC. The default installation includes an
asterisk (*) to match all <tt>admin</tt> principals. This default could be a
security risk, so it is more secure to include a list of all
of the <tt>admin</tt> principals. See the <a href="http://docs.sun.com/doc/819-2251/kadm5.acl-4?a=view"><tt>kadm5.acl</tt>(4)</a> man page for more information.</p></li>
<li><b>Start the <tt>kadmin.local</tt> command and add principals.</b><p>The next substeps create principals that are used by the Kerberos service.</p><pre>kdc1 # <tt><b>/usr/sbin/kadmin.local</b></tt>
kadmin.local: </pre><ol style="list-style-type: lower-alpha">
				 
<li><a name="ggdpw"></a><b><a name="indexterm-2548"></a><a name="indexterm-2549"></a><a name="indexterm-2550"></a><a name="indexterm-2551"></a>Add administration principals to the database.</b><p>You can add as many <tt>admin</tt> principals as you need. You must add at
least one <tt>admin</tt> principal to complete the KDC configuration process. For this example,
a <tt>kws/admin</tt> principal is added. You can substitute an appropriate principal name instead
of &ldquo;<tt>kws</tt>.&rdquo;</p><pre>kadmin.local: <tt><b>addprinc kws/admin</b></tt>
Enter password for principal kws/admin@EXAMPLE.COM:&lt;Type the password&gt;
Re-enter password for principal kws/admin@EXAMPLE.COM: &lt;Type it again&gt;
Principal "kws/admin@EXAMPLE.COM" created.
kadmin.local: </pre></li>
<li><a name="ggdpt"></a><b><a name="indexterm-2552"></a><a name="indexterm-2553"></a><a name="indexterm-2554"></a>Create a keytab file for the <tt>kadmind</tt> service.</b><p>This command sequence creates a special keytab file with principal entries for <tt>kadmin</tt>
and <tt>changepw</tt>. These principals are needed for the <tt>kadmind</tt> service. Note that when
the principal instance is a host name, the FQDN must be specified in
lowercase letters, regardless of the case of the domain name in the <tt>/etc/resolv.conf</tt>
file.</p><pre>kadmin.local: <tt><b>ktadd -k /etc/krb5/kadm5.keytab kadmin/kdc1.example.com</b></tt>
Entry for principal kadmin/kdc1.example.com with kvno 3, encryption type AES-256 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal kadmin/kdc1.example.com with kvno 3, encryption type AES-128 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal kadmin/kdc1.example.com with kvno 3, encryption type Triple DES cbc
          mode with HMAC/sha1 added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal kadmin/kdc1.example.com with kvno 3, encryption type ArcFour
          with HMAC/md5 added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal kadmin/kdc1.example.com with kvno 3, encryption type DES cbc mode
          with RSA-MD5 added to keytab WRFILE:/etc/krb5/kadm5.keytab.
kadmin.local: <tt><b>ktadd -k /etc/krb5/kadm5.keytab changepw/kdc1.example.com</b></tt>
Entry for principal changepw/kdc1.example.com with kvno 3, encryption type AES-256 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal changepw/kdc1.example.com with kvno 3, encryption type AES-128 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal changepw/kdc1.example.com with kvno 3, encryption type Triple DES cbc
          mode with HMAC/sha1 added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal changepw/kdc1.example.com with kvno 3, encryption type ArcFour
          with HMAC/md5 added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal changepw/kdc1.example.com with kvno 3, encryption type DES cbc mode
          with RSA-MD5 added to keytab WRFILE:/etc/krb5/kadm5.keytab.
kadmin.local: <tt><b>ktadd -k /etc/krb5/kadm5.keytab kadmin/changepw</b></tt>
Entry for principal kadmin/changepw with kvno 3, encryption type AES-256 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal kadmin/changepw with kvno 3, encryption type AES-128 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal kadmin/changepw with kvno 3, encryption type Triple DES cbc
          mode with HMAC/sha1 added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal kadmin/changepw with kvno 3, encryption type ArcFour
          with HMAC/md5 added to keytab WRFILE:/etc/krb5/kadm5.keytab.
Entry for principal kadmin/changepw with kvno 3, encryption type DES cbc mode
          with RSA-MD5 added to keytab WRFILE:/etc/krb5/kadm5.keytab.
kadmin.local:</pre></li>
<li><b>Quit <tt>kadmin.local</tt>.</b><p>You have added all of the required principals for the next steps.</p><pre>kadmin.local: <tt><b>quit</b></tt></pre></li></ol></li>
<li><b>Start the Kerberos daemons.</b><pre>kdc1 # <tt><b>svcadm enable -r network/security/krb5kdc</b></tt>
kdc1 # <tt><b>svcadm enable -r network/security/kadmin</b></tt></pre></li>
<li><b>Start <tt>kadmin</tt> and add more principals.</b><p>At this point, you can add principals by using the Graphical Kerberos Administration
Tool. To do so, you must log in with one of the
<tt>admin</tt> principal names that you created earlier in this procedure. However, the following
command-line example is shown for simplicity. </p><pre>kdc1 # <tt><b>/usr/sbin/kadmin -p kws/admin</b></tt>
Enter password: &lt;Type kws/admin password&gt;
kadmin: </pre><ol style="list-style-type: lower-alpha">
				 
<li><b><a name="indexterm-2555"></a><a name="indexterm-2556"></a><a name="indexterm-2557"></a><a name="indexterm-2558"></a>Create the master KDC <tt>host</tt> principal.</b><p>The host principal is used by Kerberized applications, such as <tt>klist</tt> and <tt>kprop</tt>. Solaris
10 clients use this principal when mounting an authenticated NFS file system. Note
that when the principal instance is a host name, the FQDN must be
specified in lowercase letters, regardless of the case of the domain name in
the <tt>/etc/resolv.conf</tt> file.</p><pre>kadmin: <tt><b>addprinc -randkey host/kdc1.example.com</b></tt>
Principal "host/kdc1.example.com@EXAMPLE.COM" created.
kadmin: </pre></li>
<li>(Optional) <b><a name="indexterm-2559"></a><a name="indexterm-2560"></a>Create the <tt>kclient</tt> principal.</b><p>This principal is used by the <tt>kclient</tt> utility during the installation of a Kerberos
client. If you do not plan on using this utility, then you
do not need to add the principal. The users of the <tt>kclient</tt> utility need
to use this password.</p><pre>kadmin: <tt><b>addprinc clntconfig/admin</b></tt>
Enter password for principal clntconfig/admin@EXAMPLE.COM:&lt;Type the password&gt;
Re-enter password for principal clntconfig/admin@EXAMPLE.COM: &lt;Type it again&gt;
Principal "clntconfig/admin@EXAMPLE.COM" created.
kadmin: </pre></li>
<li><b><a name="indexterm-2561"></a>Add the master KDC's <tt>host</tt> principal to the master KDC's keytab file.</b><p>Adding the host principal to the keytab file allows this principal to be
used automatically.</p><pre>kadmin: <tt><b>ktadd host/kdc1.example.com</b></tt>
Entry for principal host/kdc1.example.com with kvno 3, encryption type AES-256 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal host/kdc1.example.com with kvno 3, encryption type AES-128 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal host/kdc1.example.com with kvno 3, encryption type Triple DES cbc
          mode with HMAC/sha1 added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal host/kdc1.example.com with kvno 3, encryption type ArcFour
          with HMAC/md5 added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal host/kdc1.example.com with kvno 3, encryption type DES cbc mode
          with RSA-MD5 added to keytab WRFILE:/etc/krb5/krb5.keytab.
kadmin: </pre></li>
<li><b>Quit <tt>kadmin</tt>.</b><pre>kadmin: <tt><b>quit</b></tt></pre></li></ol></li>
<li>(Optional) <b><a name="indexterm-2562"></a><a name="indexterm-2563"></a><a name="indexterm-2564"></a><a name="indexterm-2565"></a>Synchronize the master KDCs clock by using NTP or another clock synchronization mechanism.</b><p>Installing and using the Network Time Protocol (NTP) is not required. However, every
clock must be within the default time that is defined in the <tt>libdefaults</tt>
section of the <tt>krb5.conf</tt> file for authentication to succeed. See <a href="setup-192.html">Synchronizing Clocks Between KDCs and Kerberos Clients</a> for information about
NTP.</p></li>
<li><b>Configure Slave KDCs.</b><p>To provide redundancy, make sure to install at least one slave KDC. See
<a href="#setup-74">How to Configure a Slave KDC</a> for specific instructions.</p></li></ol>

<a name="ggdvb"></a><h4>How to Automatically Configure a Slave KDC</h4><a name="indexterm-2566"></a><a name="indexterm-2567"></a><a name="indexterm-2568"></a><a name="indexterm-2569"></a><p>Starting with the Solaris 10 5/08 and the Solaris Express Developer Edition
1/08 releases, a slave KDC can be automatically configured by using the following
procedure.</p><ol>
<li><b>Become superuser.</b></li>
<li><b>Create the KDC.</b><p>Run the <tt>kdcmgr</tt> utility to create the KDC. You need to provide both
the master key password and the password for the administrative principal.<a name="indexterm-2570"></a></p><pre>kdc2# <tt><b>kdcmgr -a kws/admin -r EXAMPLE.COM create -m kdc1 slave</b></tt>

Starting server setup
---------------------------------------

Setting up /etc/krb5/kdc.conf

Setting up /etc/krb5/krb5.conf
Obtaining TGT for kws/admin ... 
Password for kws/admin@EXAMPLE.COM: &lt;Type the password&gt;

Setting up /etc/krb5/kadm5.acl. 

Setting up /etc/krb5/kpropd.acl. 

Waiting for database from master... 
Waiting for database from master... 
Waiting for database from master... 
kdb5_util: Cannot find/read stored master key while reading master key 
kdb5_util: Warning: proceeding without master key 
Enter KDC database master key: &lt;Type the password&gt;

--------------------------------------------------- 
Setup COMPLETE. 

kdc2#</pre></li></ol>

<a name="ggdua"></a><h4>How to Interactively Configure a Slave KDC</h4><a name="indexterm-2571"></a><a name="indexterm-2572"></a><a name="indexterm-2573"></a><a name="indexterm-2574"></a><p>Starting with the Solaris 10 5/08 and the Solaris Express Developer Edition
1/08 releases, a slave KDC can be interactively configured by using the following
procedure.</p><ol>
<li><b>Become superuser.</b></li>
<li><b>Create the KDC.</b><p>Run the <tt>kdcmgr</tt> utility to create the KDC. You need to provide both
the master key password and the password for the administrative principal.<a name="indexterm-2575"></a></p><pre>kdc1# <tt><b>kdcmgr create slave</b></tt>

Starting server setup
---------------------------------------

Enter the Kerberos realm: <tt><b>EXAMPLE.COM</b></tt>
What is the master KDC's host name?: <tt><b>kdc1</b></tt>

Setting up /etc/krb5/kdc.conf

Setting up /etc/krb5/krb5.conf
Obtaining TGT for kws/admin ... 
Password for kws/admin@EXAMPLE.COM: &lt;Type the password&gt;

Setting up /etc/krb5/kadm5.acl. 

Setting up /etc/krb5/kpropd.acl. 

Waiting for database from master... 
Waiting for database from master... 
Waiting for database from master... 
kdb5_util: Cannot find/read stored master key while reading master key 
kdb5_util: Warning: proceeding without master key 
Enter KDC database master key: &lt;Type the password&gt;

--------------------------------------------------- 
Setup COMPLETE. 

kdc2#</pre></li></ol>

<a name="setup-74"></a><h4>How to Configure a Slave KDC</h4><a name="indexterm-2576"></a><a name="indexterm-2577"></a><a name="indexterm-2578"></a><a name="indexterm-2579"></a><p>In this procedure, a new slave KDC named <tt>kdc2</tt> is configured. Also, incremental
propagation is configured. This procedure uses the following configuration parameters:</p>
<ul><li><p>Realm name = <tt>EXAMPLE.COM</tt></p></li>
<li><p>DNS domain name = <tt>example.com</tt></p></li>
<li><p>Master KDC = <tt>kdc1.example.com</tt></p></li>
<li><p>Slave KDC = <tt>kdc2.example.com</tt></p></li>
<li><p><tt>admin</tt> principal = <tt>kws/admin</tt></p></li></ul>
<h6>Before You Begin</h6><p>The master KDC must be configured. For specific instructions if this slave is
to be swappable, see <a href="aadmin-2.html">Swapping a Master KDC and a Slave KDC</a>.</p><ol>
<li><b>On the master KDC, become superuser.</b></li>
<li><b>On the master KDC, start <tt>kadmin</tt>.</b><p>You must log in with one of the <tt>admin</tt> principal names that you created
when you configured the master KDC.</p><pre>kdc1 # <tt><b>/usr/sbin/kadmin -p kws/admin</b></tt>
Enter password: &lt;Type kws/admin password&gt;
kadmin: </pre><ol style="list-style-type: lower-alpha">
				 
<li><a name="ggdsm"></a><b>On the master KDC, add slave host principals to the database, if not
already done.</b><p>For the slave to function, it must have a host principal. Note that
when the principal instance is a host name, the FQDN must be specified
in lowercase letters, regardless of the case of the domain name in the
<tt>/etc/resolv.conf</tt> file.</p><pre>kadmin: <tt><b>addprinc -randkey host/kdc2.example.com</b></tt>
Principal "host/kdc2.example.com@EXAMPLE.COM" created.
kadmin: </pre></li>
<li><b>On the master KDC, create the <tt>kiprop</tt> principal.</b><p>The <tt>kiprop</tt> principal is used to authorize incremental propagation from the master KDC.</p><pre>kadmin: <tt><b>addprinc -randkey kiprop/kdc2.example.com</b></tt>
Principal "kiprop/kdc2.example.com@EXAMPLE.COM" created.
kadmin:</pre></li>
<li><a name="ggdqe"></a><b>Quit <tt>kadmin</tt>.</b><pre>kadmin: <tt><b>quit</b></tt></pre></li></ol></li>
<li><a name="ggdqh"></a><b>On the master KDC, edit the Kerberos configuration file (<tt>krb5.conf</tt>).</b><p>You need to add an entry for each slave. See the <a href="http://docs.sun.com/doc/819-2251/krb5.conf-4?a=view"><tt>krb5.conf</tt>(4)</a> man page
for a full description of this file.</p><pre>kdc1 # <tt><b>cat /etc/krb5/krb5.conf</b></tt>
 .
 .
[realms]
                EXAMPLE.COM = {
                kdc = kdc1.example.com
                <tt><b>kdc = kdc2.example.com</b></tt>
                admin_server = kdc1.example.com
        }</pre></li>
<li><b>On the master KDC, add an <tt>kiprop</tt> entry to <tt>kadm5.acl</tt>.</b><p>This entry allows the master KDC to receive requests for incremental propagation for
the <tt>kdc2</tt> server.</p><pre>kdc1 # <tt><b>cat /etc/krb5/kadm5.acl</b></tt>
*/admin@EXAMPLE.COM *
<tt><b>kiprop/kdc2.example.com@EXAMPLE.COM p</b></tt></pre></li>
<li><b>On the master KDC, restart <tt>kadmind</tt> to use the new entries in the
<tt>kadm5.acl</tt> file.</b><pre>kdc1 # <tt><b>svcadm restart network/security/kadmin</b></tt></pre></li>
<li><a name="ggdqr"></a><b><a name="indexterm-2580"></a>On all slave KDCs, copy the KDC administration files from the master KDC
server.</b><p>This step needs to be followed on all slave KDCs, because the
master KDC server has updated information that each KDC server needs. You can
use <tt>ftp</tt> or a similar transfer mechanism to grab copies of the
following files from the master KDC:</p>
<ul><li><p><tt>/etc/krb5/krb5.conf</tt></p></li>
<li><p><tt>/etc/krb5/kdc.conf</tt></p></li></ul>
</li>
<li><b>On all slave KDCs, add an entry for the master KDC and
each slave KDC into the database propagation configuration file, <tt>kpropd.acl</tt>.</b><p>This information needs to be updated on all slave KDC servers.</p><pre>kdc2 # <tt><b>cat /etc/krb5/kpropd.acl</b></tt>
host/kdc1.example.com@EXAMPLE.COM
host/kdc2.example.com@EXAMPLE.COM</pre></li>
<li><b>On all slave KDCs, make sure that the Kerberos access control list file,
<tt>kadm5.acl</tt>, is not populated.</b><p>An unmodified <tt>kadm5.acl</tt> file would look like:</p><pre>kdc2 # <tt><b>cat /etc/krb5/kadm5.acl</b></tt>
*/admin@___default_realm___ *</pre><p>If the file has <tt>kiprop</tt> entries, remove them.</p></li>
<li><b>On the new slave, change an entry in <tt>kdc.conf</tt>.</b><p>Replace the <tt>sunw_dbprop_master_ulogsize</tt> entry with an entry defining <tt>sunw_dbprop_slave_poll</tt>. The entry sets the poll
time to 2 minutes.</p><pre>kdc1 # <tt><b>cat /etc/krb5/kdc.conf</b></tt>
[kdcdefaults]
        kdc_ports = 88,750

[realms]
        EXAMPLE.COM= {
                profile = /etc/krb5/krb5.conf
                database_name = /var/krb5/principal
                admin_keytab = /etc/krb5/kadm5.keytab
                acl_file = /etc/krb5/kadm5.acl
                kadmind_port = 749
                max_life = 8h 0m 0s
                max_renewable_life = 7d 0h 0m 0s
                sunw_dbprop_enable = true
                <tt><b>sunw_dbprop_slave_poll = 2m</b></tt>
        }</pre></li>
<li><a name="ggdqd"></a><b>On the new slave, start the <tt>kadmin</tt> command.</b><p>You must log in with one of the <tt>admin</tt> principal names that you
created when you configured the master KDC.</p><pre>kdc2 # <tt><b>/usr/sbin/kadmin -p kws/admin</b></tt>
Enter password: &lt;Type kws/admin password&gt;
kadmin: </pre><ol style="list-style-type: lower-alpha">
				 
<li><b>Add the slave's host principal to the slave's keytab file by using
<tt>kadmin</tt>.</b><p>This entry allows <tt>kprop</tt> and other Kerberized applications to function. Note that when
the principal instance is a host name, the FQDN must be specified in
lowercase letters, regardless of the case of the domain name in the <tt>/etc/resolv.conf</tt>
file.</p><pre>kadmin: <tt><b>ktadd host/kdc2.example.com</b></tt>
Entry for principal host/kdc2.example.com with kvno 3, encryption type AES-256 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal host/kdc2.example.com with kvno 3, encryption type AES-128 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal host/kdc2.example.com with kvno 3, encryption type Triple DES cbc
          mode with HMAC/sha1 added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal host/kdc2.example.com with kvno 3, encryption type ArcFour
          with HMAC/md5 added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal host/kdc2.example.com with kvno 3, encryption type DES cbc mode
          with RSA-MD5 added to keytab WRFILE:/etc/krb5/krb5.keytab.
kadmin: </pre></li>
<li><b>Add the <tt>kiprop</tt> principal to the slave KDC's keytab file.</b><p>Adding the <tt>kiprop</tt> principal to the <tt>krb5.keytab</tt> file allows the <tt>kpropd</tt> command to authenticate
itself when incremental propagation is started.</p><pre>kadmin: <tt><b>ktadd kiprop/kdc2.example.com</b></tt>
Entry for principal kiprop/kdc2.example.com with kvno 3, encryption type AES-256 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal kiprop/kdc2.example.com with kvno 3, encryption type AES-128 CTS mode
          with 96-bit SHA-1 HMAC added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal kiprop/kdc2.example.com with kvno 3, encryption type Triple DES cbc
          mode with HMAC/sha1 added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal kiprop/kdc2.example.com with kvno 3, encryption type ArcFour
          with HMAC/md5 added to keytab WRFILE:/etc/krb5/krb5.keytab.
Entry for principal kiprop/kdc2.example.com with kvno 3, encryption type DES cbc mode
          with RSA-MD5 added to keytab WRFILE:/etc/krb5/krb5.keytab.
kadmin: </pre></li>
<li><b>Quit <tt>kadmin</tt>.</b><pre>kadmin: <tt>quit</tt></pre></li></ol></li>
<li><b>On the new slave, start the Kerberos propagation daemon.</b><pre>kdc2 # <tt><b>svcadm enable network/security/krb5_prop</b></tt></pre></li>
<li><a name="ggdrz"></a><b><a name="indexterm-2581"></a><a name="indexterm-2582"></a><a name="indexterm-2583"></a>On the new slave, create a stash file by using <tt>kdb5_util</tt>.</b><pre>kdc2 # <tt><b>/usr/sbin/kdb5_util stash</b></tt>
kdb5_util: Cannot find/read stored master key while reading master key
kdb5_util: Warning: proceeding without master key

Enter KDC database master key: &lt;Type the key&gt;</pre></li>
<li><a name="ggdqy"></a>(Optional) <b><a name="indexterm-2584"></a><a name="indexterm-2585"></a><a name="indexterm-2586"></a><a name="indexterm-2587"></a>On the new slave KDC, synchronize the master KDCs clock by using NTP
or another clock synchronization mechanism.</b><p>Installing and using the Network Time Protocol (NTP) is not required. However, every
clock must be within the default time that is defined in the <tt>libdefaults</tt>
section of the <tt>krb5.conf</tt> file for authentication to succeed. See <a href="setup-192.html">Synchronizing Clocks Between KDCs and Kerberos Clients</a> for
information about NTP.</p></li>
<li><a name="ggdsj"></a><b><a name="indexterm-2588"></a><a name="indexterm-2589"></a><a name="indexterm-2590"></a>On the new slave, start the KDC daemon (<tt>krb5kdc</tt>).</b><pre>kdc2 # <tt><b>svcadm enable network/security/krb5kdc</b></tt></pre></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ezecs.html">Previous</a>
             </td>
             <td align="right">
                 <a href="setup-87.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

