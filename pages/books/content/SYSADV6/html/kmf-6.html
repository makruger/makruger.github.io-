<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Using the Key Management Framework (Tasks) - System Administration Guide: Security Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Security Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="kmf-5.html">Previous</a>
             </td>
             <td align="right">
                 <a href="authtm-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="oview-1.html">Part&nbsp;I&nbsp;Security Overview</a></p>
<p class="toc level2"><a href="secov-1.html">1.&nbsp;&nbsp;Security Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="sectm-1.html">Part&nbsp;II&nbsp;System, File, and Device Security</a></p>
<p class="toc level2"><a href="concept-1.html">2.&nbsp;&nbsp;Managing Machine Security (Overview)</a></p>
<p class="toc level2"><a href="secsys-1.html">3.&nbsp;&nbsp;Controlling Access to Systems (Tasks)</a></p>
<p class="toc level2"><a href="vscan-1.html">4.&nbsp;&nbsp;Virus Scanning Service (Tasks)</a></p>
<p class="toc level2"><a href="devtask-1.html">5.&nbsp;&nbsp;Controlling Access to Devices (Tasks)</a></p>
<p class="toc level2"><a href="bart-1.html">6.&nbsp;&nbsp;Using the Basic Audit Reporting Tool (Tasks)</a></p>
<p class="toc level2"><a href="secfile-1.html">7.&nbsp;&nbsp;Controlling Access to Files (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="prbactm-1.html">Part&nbsp;III&nbsp;Roles, Rights Profiles, and Privileges</a></p>
<p class="toc level2"><a href="prbac-1.html">8.&nbsp;&nbsp;Using Roles and Privileges (Overview)</a></p>
<p class="toc level2"><a href="rbactask-1.html">9.&nbsp;&nbsp;Using Role-Based Access Control (Tasks)</a></p>
<p class="toc level2"><a href="rbacref-1.html">10.&nbsp;&nbsp;Role-Based Access Control (Reference)</a></p>
<p class="toc level2"><a href="privtask-1.html">11.&nbsp;&nbsp;Privileges (Tasks)</a></p>
<p class="toc level2"><a href="privref-1.html">12.&nbsp;&nbsp;Privileges (Reference)</a></p>
<p class="toc level1 tocsp"><a href="scftm-1.html">Part&nbsp;IV&nbsp;Solaris Cryptographic Services</a></p>
<p class="toc level2"><a href="scf-1.html">13.&nbsp;&nbsp;Solaris Cryptographic Framework (Overview)</a></p>
<p class="toc level2"><a href="scftask-1.html">14.&nbsp;&nbsp;Solaris Cryptographic Framework (Tasks)</a></p>
<p class="toc level2"><a href="kmf-1.html">15.&nbsp;&nbsp;Solaris Key Management Framework</a></p>
<p class="toc level3"><a href="kmf-28.html">Managing Public Key Technologies</a></p>
<p class="toc level3"><a href="kmf-2.html">Key Management Framework Utilities</a></p>
<p class="toc level3"><a href="kmf-3.html">KMF Policy Management</a></p>
<p class="toc level3"><a href="kmf-14.html">KMF Plugin Management</a></p>
<p class="toc level3"><a href="kmf-4.html">KMF Keystore Management</a></p>
<p class="toc level3"><a href="kmf-5.html">Using the Key Management Framework (Task Map)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Using the Key Management Framework (Tasks)</a></p>
</div>
<p class="toc level1 tocsp"><a href="authtm-1.html">Part&nbsp;V&nbsp;Authentication Services and Secure Communication</a></p>
<p class="toc level2"><a href="auth-1.html">16.&nbsp;&nbsp;Using Authentication Services (Tasks)</a></p>
<p class="toc level2"><a href="pam-1.html">17.&nbsp;&nbsp;Using PAM</a></p>
<p class="toc level2"><a href="sasl-1.html">18.&nbsp;&nbsp;Using SASL</a></p>
<p class="toc level2"><a href="sshuser-1.html">19.&nbsp;&nbsp;Using Solaris Secure Shell (Tasks)</a></p>
<p class="toc level2"><a href="sshref-1.html">20.&nbsp;&nbsp;Solaris Secure Shell (Reference)</a></p>
<p class="toc level1 tocsp"><a href="seamtm-1.html">Part&nbsp;VI&nbsp;Kerberos Service</a></p>
<p class="toc level2"><a href="intro-1.html">21.&nbsp;&nbsp;Introduction to the Kerberos Service</a></p>
<p class="toc level2"><a href="seamplan-1.html">22.&nbsp;&nbsp;Planning for the Kerberos Service</a></p>
<p class="toc level2"><a href="setup-8.html">23.&nbsp;&nbsp;Configuring the Kerberos Service (Tasks)</a></p>
<p class="toc level2"><a href="trouble-1.html">24.&nbsp;&nbsp;Kerberos Error Messages and Troubleshooting</a></p>
<p class="toc level2"><a href="aadmin-1.html">25.&nbsp;&nbsp;Administering Kerberos Principals and Policies (Tasks)</a></p>
<p class="toc level2"><a href="user-7.html">26.&nbsp;&nbsp;Using Kerberos Applications (Tasks)</a></p>
<p class="toc level2"><a href="refer-1.html">27.&nbsp;&nbsp;The Kerberos Service (Reference)</a></p>
<p class="toc level1 tocsp"><a href="audittm-1.html">Part&nbsp;VII&nbsp;Solaris Auditing</a></p>
<p class="toc level2"><a href="auditov-1.html">28.&nbsp;&nbsp;Solaris Auditing (Overview)</a></p>
<p class="toc level2"><a href="auditplan-1.html">29.&nbsp;&nbsp;Planning for Solaris Auditing</a></p>
<p class="toc level2"><a href="audittask-1.html">30.&nbsp;&nbsp;Managing Solaris Auditing (Tasks)</a></p>
<p class="toc level2"><a href="auditref-1.html">31.&nbsp;&nbsp;Solaris Auditing (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-2.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="kmf-6"></a><h3>Using the Key Management Framework (Tasks)</h3>
<p>This section describes how to use the <tt>pktool</tt> command to manage your public
key objects, such as passwords, passphrases, files, keystores, certificates, and CRLs.</p>

<a name="kmf-8"></a><h4>How to Create a Certificate by Using the <tt>pktool&nbsp;gencert</tt> Command</h4><a name="indexterm-1794"></a><a name="indexterm-1795"></a><a name="indexterm-1796"></a><a name="indexterm-1797"></a><a name="indexterm-1798"></a><a name="indexterm-1799"></a><a name="indexterm-1800"></a><p>This procedure creates a self-signed certificate and stores the certificate in the PKCS&nbsp;#11
keystore. As a part of this operation, an RSA public/private key pair is
also created. The private key is stored in the keystore with the certificate.</p><ol>
<li><b>Generate a self-signed certificate.</b><pre>% pktool gencert [keystore=<i>keystore</i>] label=<i>label-name</i> \
subject=<i>subject-DN</i> serial=<i>hex-serial-number</i></pre><dl><dt><tt>keystore=</tt><i>keystore</i></dt>
<dd><p>Specifies the keystore by type of public key object. The value can be <tt>nss</tt>, <tt>pkcs11</tt>, or <tt>ssl</tt>. This keyword is optional.</p></dd>
<dt><tt>label=</tt><i>label-name</i></dt>
<dd><p>Is a unique name that the issuer gives to the certificate.</p></dd>
<dt><tt>subject=</tt><i>subject-DN</i></dt>
<dd><p>Is the distinguished name for the certificate.</p></dd>
<dt><tt>serial=</tt><i>hex-serial-number</i></dt>
<dd><p>Is the serial number in hexadecimal format. The issuer of the certificate chooses the number, such as <tt>0x0102030405</tt>.</p></dd>
</dl>
</li>
<li><b><a name="indexterm-1801"></a><a name="indexterm-1802"></a><a name="indexterm-1803"></a><a name="indexterm-1804"></a>Verify the contents of the keystore.</b><pre>% <tt><b>pktool list</b></tt>
Found <i>number</i> certificates.
1. (X.509 certificate)
      Label:  <i>label-name</i>
      ID: <i>Fingerprint that binds certificate to private key</i>
      Subject: <i>subject-DN</i>
      Issuer:  <i>distinguished-name</i>
      Serial:  <i>hex-serial-number</i>
<i>n</i>. ...</pre><p>This command lists all certificates in the keystore. In the following example, the
keystore contains one certificate only.</p></li></ol><a name="kmf-25"></a><h6>Example&nbsp;15-1 Creating a Self-Signed Certificate by Using <tt>pktool</tt></h6><p>In the following example, a user at <tt>My Company</tt> creates a self-signed certificate and
stores the certificate in a keystore for PKCS&nbsp;#11 objects. The keystore is initially
empty. If the keystore has not been initialized, the PIN for the softtoken
is <tt>changeme</tt>.</p><pre>% <tt><b>pktool gencert keystore=pkcs11 label="My Cert" \</b></tt>
<tt><b>subject="C=US, O=My Company, OU=Security Engineering Group, CN=MyCA" \</b></tt>
<tt><b>serial=0x000000001</b></tt>
Enter pin for Sun Software PKCS#11 softtoken:Type PIN for token</pre><pre>% <tt><b>pktool list</b></tt>
Found 1 certificates.
1. (X.509 certificate)
      Label: My Cert
      ID: 12:82:17:5f:80:78:eb:44:8b:98:e3:3c:11:c0:32:5e:b6:4c:ea:eb
      Subject: C=US, O=My Company, OU=Security Engineering Group, CN=MyCA
      Issuer: C=US, O=My Company, OU=Security Engineering Group, CN=MyCA
      Serial: 0x01</pre>

<a name="kmf-16"></a><h4>How to Import a Certificate Into Your Keystore</h4><a name="indexterm-1805"></a><a name="indexterm-1806"></a><a name="indexterm-1807"></a><a name="indexterm-1808"></a><a name="indexterm-1809"></a><a name="indexterm-1810"></a><p>This procedure describes how to import a file with PKI information that is
encoded with PEM or with raw DER into your keystore. For an
export procedure, see <a href="#kmf-19">Example&nbsp;15-4</a>.</p><ol>
<li><b>Import the certificate.</b><pre>% pktool import keystore=<i>keystore</i> infile=<i>infile-name</i> label=<i>label-name</i></pre></li>
<li><b>If you are importing private PKI objects, provide passwords when prompted.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>At the prompt, provide the password for the file.</b><p>If you are importing PKI information that is private, such as an export
file in PKCS&nbsp;#12 format, the file requires a password. The creator of the file
that you are importing provides you with the PKCS&nbsp;#12 password.</p><pre>Enter password to use for accessing the PKCS12 file:Type PKCS #12 password</pre></li>
<li><b>At the prompt, type the password for your keystore.</b><pre>Enter pin for Sun Software PKCS#11 softtoken: Type PIN for token</pre></li></ol></li>
<li><b>Verify the contents of the keystore.</b><pre>% <tt><b>pktool list</b></tt>
Found <i>number</i> certificates.
1. (X.509 certificate)
      Label:  <i>label-name</i>
      ID: <i>Fingerprint that binds certificate to private key</i>
      Subject: <i>subject-DN</i>
      Issuer:  <i>distinguished-name</i>
      Serial:  <i>hex-serial-number</i>
2. ...</pre></li></ol><a name="kmf-17"></a><h6>Example&nbsp;15-2 Importing a PKCS&nbsp;#12 File Into Your Keystore</h6><p>In the following example, the user imports a PKCS&nbsp;#12 file from a third
party. The <tt>pktool import</tt> command extracts the private key and the certificate from the
<tt>gracedata.p12</tt> file, and stores them in the user's preferred keystore.</p><pre>% <tt><b>pktool import keystore=pkcs11 infile=gracedata.p12 label=GraceCert</b></tt>
Enter password to use for accessing the PKCS12 file:Type PKCS #12 password
Enter pin for Sun Software PKCS#11 softtoken: Type PIN for token
Found 1 certificate(s) and 1 key(s) in gracedata.p12
% <tt><b>pktool list</b></tt>
Found 1 certificates.
1. (X.509 certificate)
        Label: GraceCert
        ID: 12:82:17:5f:80:78:eb:44:8b:98:e3:3c:11:c0:32:5e:b6:4c:ea:eb
        Subject: C=US, O=My Company, OU=Security Engineering Group, CN=MyCA
        Issuer: C=US, O=My Company, OU=Security Engineering Group, CN=MyCA
        Serial: 0x01</pre><a name="kmf-15"></a><h6>Example&nbsp;15-3 Importing an X.509 Certificate Into Your Keystore</h6><p>In the following example, the user imports an X.509 certificate in PEM format
into the user's preferred keystore. This public certificate is not protected with a
password. The user's public keystore is also not protected by a password.</p><pre>% <tt><b>pktool import keystore=pkcs11 infile=somecert.pem label="TheirCompany Root Cert"</b></tt>
% <tt><b>pktool list</b></tt>
Found 1 certificates.
1. (X.509 certificate)
        Label: TheirCompany Root Cert
        ID: 21:ae:83:98:24:d1:1f:cb:65:5b:48:75:7d:02:47:cf:98:1f:ec:a0
        Subject: C=US, O=TheirCompany, OU=Security, CN=TheirCompany Root CA
        Issuer: C=US, O=TheirCompany, OU=Security, CN=TheirCompany Root CA
        Serial: 0x01</pre>

<a name="kmf-12"></a><h4>How to Export a Certificate and Private Key in PKCS&nbsp;#12 Format</h4><a name="indexterm-1811"></a><a name="indexterm-1812"></a><a name="indexterm-1813"></a><a name="indexterm-1814"></a><a name="indexterm-1815"></a><a name="indexterm-1816"></a><p>You can create a file in PKCS&nbsp;#12 format to export private keys and
their associated X.509 certificate to other systems. Access to the file is protected
by a password. </p><ol>
<li><b>Find the certificate to export.</b><pre>% <tt><b>pktool list</b></tt>
Found <i>number</i> certificates.
1. (X.509 certificate)
      Label:  <i>label-name</i>
      ID: <i>Fingerprint that binds certificate to private key</i>
      Subject: <i>subject-DN</i>
      Issuer:  <i>distinguished-name</i>
      Serial:  <i>hex-serial-number</i>
2. ...</pre></li>
<li><b>Export the keys and certificate.</b><p>Use the keystore and label from the <tt>pktool list</tt> command. Provide a file name for
the export file. When the name contains a space, surround the name with
double quotes.</p><pre>% pktool export keystore=<i>keystore</i> outfile=<i>outfile-name</i> label=<i>label-name</i></pre></li>
<li><b>Protect the export file with a password.</b><p>At the prompt, type the current password for the keystore. At this point,
you create a password for the export file. The receiver must provide this
password when importing the file.</p><pre>Enter pin for Sun Software PKCS#11 softtoken: Type PIN for token
Enter password to use for accessing the PKCS12 file:Create PKCS #12 password</pre>
<hr><p><b>Tip - </b>Send the password separately from the export file. Best practice suggests that you
provide the password out of band, such as during a telephone call.</p>
<hr>
</li></ol><a name="kmf-19"></a><h6>Example&nbsp;15-4 Exporting a Certificate and Private Key in PKCS&nbsp;#12 Format</h6><p><a name="indexterm-1817"></a><a name="indexterm-1818"></a><a name="indexterm-1819"></a><a name="indexterm-1820"></a><a name="indexterm-1821"></a>In the following example, a user exports the private keys with their associated
X.509 certificate into a standard PKCS&nbsp;#12 file. This file can be imported into other
keystores. The PKCS&nbsp;#11 password protects the source keystore. The PKCS&nbsp;#12 password is used
to protect private data in the  PKCS&nbsp;#12 file. This password is required
to import the file.</p><pre>% <tt><b>pktool list</b></tt>
Found 1 certificates.
1. (X.509 certificate)
      Label: My Cert
      ID: 12:82:17:5f:80:78:eb:44:8b:98:e3:3c:11:c0:32:5e:b6:4c:ea:eb
      Subject: C=US, O=My Company, OU=Security Engineering Group, CN=MyCA
      Issuer: C=US, O=My Company, OU=Security Engineering Group, CN=MyCA
      Serial: 0x01</pre><pre>% <tt><b>pktool export keystore=pkcs11 outfile=mydata.p12 label="My Cert"</b></tt>
Enter pin for Sun Software PKCS#11 softtoken: Type PIN for token
Enter password to use for accessing the PKCS12 file:Create PKCS #12 password</pre><p>The user then telephones the recipient and provides the PKCS #12 password.</p>

<a name="kmf-9"></a><h4>How to Generate a Passphrase by Using the <tt>pktool&nbsp;setpin</tt> Command</h4><a name="indexterm-1822"></a><a name="indexterm-1823"></a><a name="indexterm-1824"></a><a name="indexterm-1825"></a><a name="indexterm-1826"></a><a name="indexterm-1827"></a><a name="indexterm-1828"></a><p>You can generate a passphrase for an object in a keystore, and
for the keystore itself. The passphrase is required to access the object or
keystore. For an example of generating a passphrase for an object in a
keystore, see <a href="#kmf-19">Example&nbsp;15-4</a>.</p><ol>
<li><b>Generate a passphrase for access to a keystore.</b><pre>% pktool setpin keystore=nss|pkcs11 dir=<i>directory</i></pre></li>
<li><b>Answer the prompts.</b><p>If the keystore does not have a password already set, press the Return
key to create the password.</p><pre>Enter current token passphrase:Press the Return key
Create new passphrase:Type the passphrase that you want to use
Re-enter new passphrase:Retype the passphrase
Passphrase changed.</pre><p>The keystore is now protected by <i>passphrase</i>. If you lose the passphrase, you
lose access to the objects in the keystore.</p></li></ol><a name="kmf-11"></a><h6>Example&nbsp;15-5 Protecting a Keystore With a Passphrase</h6><p>The following example shows how to set the passphrase for an NSS
database. Because no passphrase has been created, the user presses the Return key at
the first prompt.</p><pre>% <tt><b>pktool setpin keystore=nss dir=/var/nss</b></tt>
Enter current token passphrase:Press the Return key
Create new passphrase:    <tt><b>has8n0NdaH</b></tt>
Re-enter new passphrase:  <tt><b>has8n0NdaH</b></tt>
Passphrase changed.</pre>

<a name="kmf-22"></a><h4>How to Manage Third-Party Plugins in KMF</h4><a name="indexterm-1829"></a><a name="indexterm-1830"></a><a name="indexterm-1831"></a><a name="indexterm-1832"></a><a name="indexterm-1833"></a><a name="indexterm-1834"></a><a name="indexterm-1835"></a><a name="indexterm-1836"></a><a name="indexterm-1837"></a><a name="indexterm-1838"></a><p>You identify your plugin by giving it a keystore name. When you
add the plugin to KMF, the software identifies it by its keystore
name. The plugin can be defined to accept an option. This procedure
includes how to remove the plugin from KMF.</p><ol>
<li><b>Install the plugin.</b><pre>% /usr/bin/kmfcfg install keystore=<i>keystore-name</i> \
modulepath=<i>path-to-plugin</i> [option="<i>option-string</i>"]</pre><p>where</p><p><i>keystore-name</i> &ndash; Is a unique name for the keystore that you provide.</p><p><i>path-to-plugin</i> &ndash; Is the full path to the shared library object for
the KMF plugin.</p><p><i>option-string</i> &ndash; Is an optional argument to the shared library object.</p></li>
<li><b>List the plugins.</b><pre>% <tt><b>kmfcfg list plugin</b></tt>
<i>keystore-name</i>:<i>path-to-plugin</i> [(built-in)] | [;option=<i>option-string</i>]</pre></li>
<li><b>To remove the plugin, uninstall it and verify its removal.</b><pre>% <tt><b>kmfcfg uninstall keystore=</tt><i>keystore-name</i><tt></b></tt>
% <tt><b>kmfcfg plugin list</b></tt></pre></li></ol><a name="kmf-27"></a><h6>Example&nbsp;15-6 Calling a KMF Plugin With an Option</h6><p>In the following example, the administrator stores a KMF plugin in a
site-specific directory. The plugin is defined to accept a <tt>debug</tt> option. The
administrator adds the plugin and verifies that the plugin is installed.</p><pre># <tt><b>/usr/bin/kmfcfg install keystore=mykmfplug \</b></tt>
<tt><b>modulepath=/usr/lib/security/site-modules/mykmfplug.so</b></tt>
# <tt><b>kmfcfg list plugin</b></tt>
KMF plugin information:
-----------------------
pkcs11:kmf_pkcs11.so.1 (built-in)
file:kmf_openssl.so.1 (built-in)
nss:kmf_nss.so.1 (built-in)
mykmfplug:/usr/lib/security/site-modules/mykmfplug.so
# <tt><b>kmfcfg modify plugin keystore=mykmfplug option="debug"</b></tt>
# <tt><b>kmfcfg list plugin</b></tt>
KMF plugin information:
-----------------------
...
mykmfplug:/usr/lib/security/site-modules/mykmfplug.so;option=debug</pre><p>The plugin now runs in debugging mode.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="kmf-5.html">Previous</a>
             </td>
             <td align="right">
                 <a href="authtm-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

