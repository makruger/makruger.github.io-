<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Recovering Storage From a Different System - Solaris Volume Manager Administration Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2006-06-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">Solaris Volume Manager Administration Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="tasks-softpart-26.html">Previous</a>
             </td>
             <td align="right">
                 <a href="egcpz.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="roadmap-10.html">1.&nbsp;&nbsp;Getting Started With Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="storage-overview-1.html">2.&nbsp;&nbsp;Storage Management Concepts</a></p>
<p class="toc level1 tocsp"><a href="basics-23185.html">3.&nbsp;&nbsp;Solaris Volume Manager Overview</a></p>
<p class="toc level1 tocsp"><a href="eoqra.html">4.&nbsp;&nbsp;Solaris Volume Manager for Sun Cluster (Overview)</a></p>
<p class="toc level1 tocsp"><a href="svm-scenario-1.html">5.&nbsp;&nbsp;Configuring and Using Solaris Volume Manager (Scenario)</a></p>
<p class="toc level1 tocsp"><a href="about-state-db-replicas-1.html">6.&nbsp;&nbsp;State Database (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-state-db-replicas-1.html">7.&nbsp;&nbsp;State Database (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-metadevices-22802.html">8.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-metadevices-1.html">9.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-mirrors-2.html">10.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-mirrors-1.html">11.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-softpart-1.html">12.&nbsp;&nbsp;Soft Partitions (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-softpart-1.html">13.&nbsp;&nbsp;Soft Partitions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-raid5-1.html">14.&nbsp;&nbsp;RAID-5 Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-raid5-1.html">15.&nbsp;&nbsp;RAID-5 Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-hotspares-40444.html">16.&nbsp;&nbsp;Hot Spare Pools (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-hotspares-1.html">17.&nbsp;&nbsp;Hot Spare Pools (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-disksets-31856.html">18.&nbsp;&nbsp;Disk Sets (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-disksets-1.html">19.&nbsp;&nbsp;Disk Sets (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-basics-2.html">20.&nbsp;&nbsp;Maintaining Solaris Volume Manager (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="best-practices-1.html">21.&nbsp;&nbsp;Best Practices for Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="topdown-overview.html">22.&nbsp;&nbsp;Top-Down Volume Creation (Overview)</a></p>
<p class="toc level1 tocsp"><a href="topdown-tasks-chap.html">23.&nbsp;&nbsp;Top-Down Volume Creation (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-snmp-1.html">24.&nbsp;&nbsp;Monitoring and Error Reporting (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="troubleshoottasks-33506.html">25.&nbsp;&nbsp;Troubleshooting Solaris Volume Manager (Tasks)</a></p>
<p class="toc level2"><a href="troubleshoottasks-83.html">Troubleshooting Solaris Volume Manager (Task Map)</a></p>
<p class="toc level2"><a href="troubleshoottasks-1.html">Overview of Troubleshooting the System</a></p>
<p class="toc level2"><a href="troubleshoottasks-95.html">Replacing Disks</a></p>
<p class="toc level3"><a href="troubleshoottasks-95.html#troubleshoottasks-96">How to Replace a Failed Disk</a></p>
<p class="toc level2 tocsp"><a href="tasks-basics-7.html">Recovering From Disk Movement Problems</a></p>
<p class="toc level2"><a href="extkh.html">Device ID Discrepancies After Upgrading to the Solaris 10 Release</a></p>
<p class="toc level2"><a href="troubleshoottasks-29.html">Recovering From Boot Problems</a></p>
<p class="toc level3"><a href="troubleshoottasks-29.html#troubleshoottasks-82">Recovering the root (<tt>/</tt>) RAID-1 (Mirror) Volume</a></p>
<p class="toc level3"><a href="troubleshoottasks-29.html#troubleshoottasks-21051">How to Recover From a Boot Device Failure</a></p>
<p class="toc level2 tocsp"><a href="tasks-state-db-replicas-11.html">Recovering From State Database Replica Failures</a></p>
<p class="toc level3"><a href="tasks-state-db-replicas-11.html#troubleshoottasks-31036">How to Recover From Insufficient State Database Replicas</a></p>
<p class="toc level2 tocsp"><a href="tasks-softpart-26.html">Recovering From Soft Partition Problems</a></p>
<p class="toc level3"><a href="tasks-softpart-26.html#tasks-softpart-27">How to Recover Configuration Data for a Soft Partition</a></p>
<div class="onpage">
<p class="toc level2 tocsp"><a href="">Recovering Storage From a Different System</a></p>
<p class="toc level3"><a href="#eqqcz">How to Recover Storage From a Local Disk Set</a></p>
</div>
<p class="toc level2 tocsp"><a href="egcpz.html">Recovering From Disk Set Problems</a></p>
<p class="toc level2"><a href="exlvv.html">Performing Mounted Filesystem Backups Using the <tt>ufsdump</tt> Command</a></p>
<p class="toc level3"><a href="exlvv.html#exlvw">How to Perform a Backup of a Mounted Filesystem Located on a RAID-1 Volume</a></p>
<p class="toc level2 tocsp"><a href="fsujr.html">Performing System Recovery</a></p>
<p class="toc level3"><a href="fsujr.html#fsujq">How to Recover a System Using a Solaris Volume Manager Configuration</a></p>
<p class="toc level1 tocsp"><a href="appendfiles-1.html">A.&nbsp;&nbsp;Important Solaris Volume Manager Files</a></p>
<p class="toc level1 tocsp"><a href="quick-reference-1.html">B.&nbsp;&nbsp;Solaris Volume Manager Quick Reference</a></p>
<p class="toc level1 tocsp"><a href="append-cim-wbem-1.html">C.&nbsp;&nbsp;Solaris Volume Manager CIM/WBEM API</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="troubleshoottasks-84"></a><h3>Recovering Storage From a Different System</h3>
<p>You can recover a Solaris Volume Manager configuration, even onto a different system
from the original system. </p>

<a name="eqqcz"></a><h4>How to Recover Storage From a Local Disk Set</h4><p>If you experience a system failure, you can attach the storage to
a different system and recover the complete configuration from the local disk set. For
example, assume you have a system with an external disk pack of
six disks in it and a Solaris Volume Manager configuration, including at least
one state database replica, on some of those disks. If you have a
system failure, you can physically move the disk pack to a new system
and enable the new system to recognize the configuration. This procedure describes how
to move the disks to another system and recover the configuration from a
local disk set.</p>
<hr><p><b>Note - </b>This recovery procedure works only with Solaris 9, and later, Solaris Volume Manager
volumes.</p>
<hr>
<ol>
<li><a name="troubleshoottasks-step-111"></a><b>Attach the disk or disks that contain the Solaris Volume Manager configuration to
a system with no preexisting Solaris Volume Manager configuration. </b></li>
<li><a name="troubleshoottasks-step-87"></a><b>Do a reconfiguration reboot to ensure that the system recognizes the newly added
disks.</b><pre># <tt><b>reboot -- -r</b></tt></pre></li>
<li><a name="troubleshoottasks-step-88"></a><b>Determine the major/minor number for a slice containing a state database replica on
the newly added disks. </b><p>Use <tt>ls -lL</tt>, and note the two numbers between the group name and the
date. These numbers are the major/minor numbers for this slice. </p><pre># ls -Ll /dev/dsk/c1t9d0s7
brw-r-----   1 root     sys       32, 71 Dec  5 10:05 /dev/dsk/c1t9d0s7</pre></li>
<li><a name="troubleshoottasks-step-94"></a><b>If necessary, determine the major name corresponding with the major number by looking
up the major number in <tt>/etc/name_to_major</tt>.</b><pre># <tt><b>grep " 32" /etc/name_to_major sd 32</b></tt></pre></li>
<li><a name="troubleshoottasks-step-89"></a><b>Update the <tt>/kernel/drv/md.conf</tt> file with the information that instructs Solaris Volume Manager
where to find a valid state database replica on the new disks.</b><p>For example, in the line that begins with <tt>mddb_bootlist1</tt>, replace the <tt>sd</tt> with
the major name you found in step 4. Replace <i>71</i> in the example
with the minor number you identified in <a href="#troubleshoottasks-step-88">Step&nbsp;3</a>.</p><pre>#pragma ident   "@(#)md.conf    2.2     04/04/02 SMI"
#
# Copyright 2004 Sun Microsystems, Inc.  All rights reserved.
# Use is subject to license terms.
#
# The parameters nmd and md_nsets are obsolete.  The values for these
# parameters no longer have any meaning.
name="md" parent="pseudo" nmd=128 md_nsets=4;

# Begin MDD database info (do not edit)
<tt><b>mddb_bootlist1="</b></tt><tt>sd</tt><tt><b>:</b></tt><tt>71</tt><tt><b>:16:id0";</b></tt>
# End MDD database info (do not edit)</pre></li>
<li><a name="troubleshoottasks-step-90"></a><b>Reboot to force Solaris Volume Manager to reload your configuration. </b><p>You will see messages similar to the following displayed on the console. </p><pre>volume management starting.
Dec  5 10:11:53 host1 metadevadm: Disk movement detected
Dec  5 10:11:53 host1 metadevadm: Updating device names in 
Solaris Volume Manager
The system is ready.</pre></li>
<li><a name="troubleshoottasks-step-91"></a><b>Verify your configuration. Use the <tt>metadb</tt> command to verify the status of the
state database replicas. and <tt>metastat</tt> command view the status for each volume.</b><pre># <tt><b>metadb</b></tt>
        flags           first blk       block count
     a m  p  luo        16              8192            /dev/dsk/c1t9d0s7
     a       luo        16              8192            /dev/dsk/c1t10d0s7
     a       luo        16              8192            /dev/dsk/c1t11d0s7
     a       luo        16              8192            /dev/dsk/c1t12d0s7
     a       luo        16              8192            /dev/dsk/c1t13d0s7
# <tt><b>metastat</b></tt>
d12: RAID
    State: Okay         
    Interlace: 32 blocks
    Size: 125685 blocks
Original device:
    Size: 128576 blocks
        Device              Start Block  Dbase State        Reloc  Hot Spare
        c1t11d0s3                330     No    Okay         Yes    
        c1t12d0s3                330     No    Okay         Yes    
        c1t13d0s3                330     No    Okay         Yes    

d20: Soft Partition
    Device: d10
    State: Okay
    Size: 8192 blocks
        Extent              Start Block              Block count
             0                     3592                     8192

d21: Soft Partition
    Device: d10
    State: Okay
    Size: 8192 blocks
        Extent              Start Block              Block count
             0                    11785                     8192

d22: Soft Partition
    Device: d10
    State: Okay
    Size: 8192 blocks
        Extent              Start Block              Block count
             0                    19978                     8192

d10: Mirror
    Submirror 0: d0
      State: Okay         
    Submirror 1: d1
      State: Okay         
    Pass: 1
    Read option: roundrobin (default)
    Write option: parallel (default)
    Size: 82593 blocks

d0: Submirror of d10
    State: Okay         
    Size: 118503 blocks
    Stripe 0: (interlace: 32 blocks)
        Device              Start Block  Dbase State        Reloc  Hot Spare
        c1t9d0s0                   0     No    Okay         Yes    
        c1t10d0s0               3591     No    Okay         Yes    


d1: Submirror of d10
    State: Okay         
    Size: 82593 blocks
    Stripe 0: (interlace: 32 blocks)
        Device              Start Block  Dbase State        Reloc  Hot Spare
        c1t9d0s1                   0     No    Okay         Yes    
        c1t10d0s1                  0     No    Okay         Yes    


Device Relocation Information:
Device       Reloc    Device ID
c1t9d0       Yes      id1,sd@SSEAGATE_ST39103LCSUN9.0GLS3487980000U00907AZ
c1t10d0      Yes      id1,sd@SSEAGATE_ST39103LCSUN9.0GLS3397070000W0090A8Q
c1t11d0      Yes      id1,sd@SSEAGATE_ST39103LCSUN9.0GLS3449660000U00904NZ
c1t12d0      Yes      id1,sd@SSEAGATE_ST39103LCSUN9.0GLS32655400007010H04J
c1t13d0      Yes      id1,sd@SSEAGATE_ST39103LCSUN9.0GLS3461190000701001T0
# 
# metadb         
        flags           first blk       block count
     a m  p  luo        16              8192            /dev/dsk/c1t9d0s7
     a       luo        16              8192            /dev/dsk/c1t10d0s7
     a       luo        16              8192            /dev/dsk/c1t11d0s7
     a       luo        16              8192            /dev/dsk/c1t12d0s7
     a       luo        16              8192            /dev/dsk/c1t13d0s7
# metastat 
d12: RAID
    State: Okay         
    Interlace: 32 blocks
    Size: 125685 blocks
Original device:
    Size: 128576 blocks
        Device              Start Block  Dbase State        Reloc  Hot Spare
        c1t11d0s3                330     No    Okay         Yes    
        c1t12d0s3                330     No    Okay         Yes    
        c1t13d0s3                330     No    Okay         Yes    

d20: Soft Partition
    Device: d10
    State: Okay
    Size: 8192 blocks
        Extent              Start Block              Block count
             0                     3592                     8192

d21: Soft Partition
    Device: d10
    State: Okay
    Size: 8192 blocks
        Extent              Start Block              Block count
             0                    11785                     8192

d22: Soft Partition
    Device: d10
    State: Okay
    Size: 8192 blocks
        Extent              Start Block              Block count
             0                    19978                     8192

d10: Mirror
    Submirror 0: d0
      State: Okay         
    Submirror 1: d1
      State: Okay         
    Pass: 1
    Read option: roundrobin (default)
    Write option: parallel (default)
    Size: 82593 blocks

d0: Submirror of d10
    State: Okay         
    Size: 118503 blocks
    Stripe 0: (interlace: 32 blocks)
        Device              Start Block  Dbase State        Reloc  Hot Spare
        c1t9d0s0                   0     No    Okay         Yes    
        c1t10d0s0               3591     No    Okay         Yes    


d1: Submirror of d10
    State: Okay         
    Size: 82593 blocks
    Stripe 0: (interlace: 32 blocks)
        Device              Start Block  Dbase State        Reloc  Hot Spare
        c1t9d0s1                   0     No    Okay         Yes    
        c1t10d0s1                  0     No    Okay         Yes    


Device Relocation Information:
Device         Reloc    Device ID
c1t9d0         Yes     id1,sd@SSEAGATE_ST39103LCSUN9.0GLS3487980000U00907AZ1
c1t10d0        Yes     id1,sd@SSEAGATE_ST39103LCSUN9.0GLS3397070000W0090A8Q
c1t11d0        Yes     id1,sd@SSEAGATE_ST39103LCSUN9.0GLS3449660000U00904NZ
c1t12d0        Yes     id1,sd@SSEAGATE_ST39103LCSUN9.0GLS32655400007010H04J
c1t13d0        Yes     id1,sd@SSEAGATE_ST39103LCSUN9.0GLS3461190000701001T0
# <tt><b>metastat -p</b></tt>
d12 -r c1t11d0s3 c1t12d0s3 c1t13d0s3 -k -i 32b
d20 -p d10 -o 3592 -b 8192 
d21 -p d10 -o 11785 -b 8192 
d22 -p d10 -o 19978 -b 8192 
d10 -m d0 d1 1
d0 1 2 c1t9d0s0 c1t10d0s0 -i 32b
d1 1 2 c1t9d0s1 c1t10d0s1 -i 32b
#</pre></li></ol>

<a name="egkaa"></a><h4>Recovering Storage From a Known Disk Set</h4>
<a name="indexterm-249"></a><a name="indexterm-250"></a><a name="indexterm-251"></a><p>The introduction of device ID support for disk sets in Solaris Volume Manager
allows you to recover storage from known disk sets and to import
the disk set to a different system. The <tt>metaimport</tt> command allows you to 
import known disk sets  from one system to another system. Both systems
must contain existing Solaris Volume Manager configurations that include device ID support. For
more information on device ID support, see <a href="egjyq.html">Asynchronous Shared Storage in Disk Sets</a>. For more information on the
<tt>metaimport</tt> command, see the <a href="http://docs.sun.com/doc/819-2240/metaimport-1m?a=view"><tt>metaimport</tt>(1M)</a> man page.</p>

<a name="eoqsb"></a><h5>How to Print a Report on Disk Sets Available for Import</h5>
<ol>
<li><b>Become superuser.</b></li>
<li><b>Obtain a report on disk sets available for import.</b><pre># <tt>metaimport <tt>-r</tt> <tt>-v</tt></tt></pre><dl><dt><tt>-r</tt></dt>
<dd><p>Provides a report of the unconfigured disk sets available for import on the system.</p></dd>
<dt><tt>-v</tt></dt>
<dd><p>Provides detailed information about the state database replica location and status on the disks of unconfigured disk sets available for import on the system.</p></dd>
</dl>
</li></ol><a name="eoqrx"></a>Example&nbsp;25-3 Reporting on Disk Sets Available for Import<p>The following examples show how to print a report on disk sets
available for import.</p><pre># <tt><b>metaimport -r</b></tt>
 Drives in regular diskset including disk c1t2d0:
   c1t2d0
   c1t3d0
 More info:
   metaimport -r -v c1t2d0 
Import:   metaimport -s &lt;newsetname> c1t2d0 
 Drives in replicated diskset including disk c1t4d0:
   c1t4d0
   c1t5d0
 More info:
   metaimport -r -v c1t4d0 
Import:   metaimport -s &lt;newsetname> c1t4d0

# <tt><b>metaimport -r -v c1t2d0</b></tt>
Import: metaimport -s &lt;newsetname> c1t2d0
Last update: Mon Dec 29 14:13:35 2003
Device       offset       length replica flags
c1t2d0           16         8192      a        u     
c1t3d0           16         8192      a        u     
c1t8d0           16         8192      a        u     </pre>

<a name="eoqry"></a><h5>How to Import a Disk Set From One System to Another System</h5>
<ol>
<li><b>Become superuser.</b></li>
<li><b>Verify that a disk set is available for import .</b><pre># <tt>metaimport <tt>-r</tt> <tt>-v</tt></tt></pre></li>
<li><b>Import an available disk set.</b><pre># <tt>metaimport <tt>-s</tt> <i>diskset-name</i> <i>drive-name</i></tt></pre><dl><dt><tt>- s</tt> <i>diskset-name</i></dt>
<dd><p>Specifies the name of the disk set being created.</p></dd>
<dt><i>drive-name</i></dt>
<dd><p>Identifies a disk (<tt>c#t#d#</tt>) containing a state database replica from the disk set being imported.</p></dd>
</dl>
</li>
<li><b>Verify that the disk set has been imported.</b><pre># <tt>metaset</tt> <tt>-s</tt> <i>diskset-name</i></pre></li></ol><a name="eoqrz"></a>Example&nbsp;25-4 Importing a Disk Set<p>The following example shows how to import a disk set.</p><pre># <tt><b>metaimport -s red c1t2d0</b></tt>
Drives in diskset including disk c1t2d0:
  c1t2d0
  c1t3d0
  c1t8d0
# <tt><b>metaset -s red</b></tt>


Set name = red, Set number = 1

Host                Owner
  host1            Yes

Drive    Dbase

c1t2d0   Yes  

c1t3d0   Yes  

c1t8d0   Yes  </pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="tasks-softpart-26.html">Previous</a>
             </td>
             <td align="right">
                 <a href="egcpz.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

