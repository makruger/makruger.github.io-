<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Replacing Disks - Solaris Volume Manager Administration Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2006-06-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">Solaris Volume Manager Administration Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="troubleshoottasks-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="tasks-basics-7.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="roadmap-10.html">1.&nbsp;&nbsp;Getting Started With Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="storage-overview-1.html">2.&nbsp;&nbsp;Storage Management Concepts</a></p>
<p class="toc level1 tocsp"><a href="basics-23185.html">3.&nbsp;&nbsp;Solaris Volume Manager Overview</a></p>
<p class="toc level1 tocsp"><a href="eoqra.html">4.&nbsp;&nbsp;Solaris Volume Manager for Sun Cluster (Overview)</a></p>
<p class="toc level1 tocsp"><a href="svm-scenario-1.html">5.&nbsp;&nbsp;Configuring and Using Solaris Volume Manager (Scenario)</a></p>
<p class="toc level1 tocsp"><a href="about-state-db-replicas-1.html">6.&nbsp;&nbsp;State Database (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-state-db-replicas-1.html">7.&nbsp;&nbsp;State Database (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-metadevices-22802.html">8.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-metadevices-1.html">9.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-mirrors-2.html">10.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-mirrors-1.html">11.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-softpart-1.html">12.&nbsp;&nbsp;Soft Partitions (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-softpart-1.html">13.&nbsp;&nbsp;Soft Partitions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-raid5-1.html">14.&nbsp;&nbsp;RAID-5 Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-raid5-1.html">15.&nbsp;&nbsp;RAID-5 Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-hotspares-40444.html">16.&nbsp;&nbsp;Hot Spare Pools (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-hotspares-1.html">17.&nbsp;&nbsp;Hot Spare Pools (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-disksets-31856.html">18.&nbsp;&nbsp;Disk Sets (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-disksets-1.html">19.&nbsp;&nbsp;Disk Sets (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-basics-2.html">20.&nbsp;&nbsp;Maintaining Solaris Volume Manager (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="best-practices-1.html">21.&nbsp;&nbsp;Best Practices for Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="topdown-overview.html">22.&nbsp;&nbsp;Top-Down Volume Creation (Overview)</a></p>
<p class="toc level1 tocsp"><a href="topdown-tasks-chap.html">23.&nbsp;&nbsp;Top-Down Volume Creation (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-snmp-1.html">24.&nbsp;&nbsp;Monitoring and Error Reporting (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="troubleshoottasks-33506.html">25.&nbsp;&nbsp;Troubleshooting Solaris Volume Manager (Tasks)</a></p>
<p class="toc level2"><a href="troubleshoottasks-83.html">Troubleshooting Solaris Volume Manager (Task Map)</a></p>
<p class="toc level2"><a href="troubleshoottasks-1.html">Overview of Troubleshooting the System</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Replacing Disks</a></p>
<p class="toc level3"><a href="#troubleshoottasks-96">How to Replace a Failed Disk</a></p>
</div>
<p class="toc level2 tocsp"><a href="tasks-basics-7.html">Recovering From Disk Movement Problems</a></p>
<p class="toc level2"><a href="extkh.html">Device ID Discrepancies After Upgrading to the Solaris 10 Release</a></p>
<p class="toc level2"><a href="troubleshoottasks-29.html">Recovering From Boot Problems</a></p>
<p class="toc level3"><a href="troubleshoottasks-29.html#troubleshoottasks-82">Recovering the root (<tt>/</tt>) RAID-1 (Mirror) Volume</a></p>
<p class="toc level3"><a href="troubleshoottasks-29.html#troubleshoottasks-21051">How to Recover From a Boot Device Failure</a></p>
<p class="toc level2 tocsp"><a href="tasks-state-db-replicas-11.html">Recovering From State Database Replica Failures</a></p>
<p class="toc level3"><a href="tasks-state-db-replicas-11.html#troubleshoottasks-31036">How to Recover From Insufficient State Database Replicas</a></p>
<p class="toc level2 tocsp"><a href="tasks-softpart-26.html">Recovering From Soft Partition Problems</a></p>
<p class="toc level3"><a href="tasks-softpart-26.html#tasks-softpart-27">How to Recover Configuration Data for a Soft Partition</a></p>
<p class="toc level2 tocsp"><a href="troubleshoottasks-84.html">Recovering Storage From a Different System</a></p>
<p class="toc level3"><a href="troubleshoottasks-84.html#eqqcz">How to Recover Storage From a Local Disk Set</a></p>
<p class="toc level2 tocsp"><a href="egcpz.html">Recovering From Disk Set Problems</a></p>
<p class="toc level2"><a href="exlvv.html">Performing Mounted Filesystem Backups Using the <tt>ufsdump</tt> Command</a></p>
<p class="toc level3"><a href="exlvv.html#exlvw">How to Perform a Backup of a Mounted Filesystem Located on a RAID-1 Volume</a></p>
<p class="toc level2 tocsp"><a href="fsujr.html">Performing System Recovery</a></p>
<p class="toc level3"><a href="fsujr.html#fsujq">How to Recover a System Using a Solaris Volume Manager Configuration</a></p>
<p class="toc level1 tocsp"><a href="appendfiles-1.html">A.&nbsp;&nbsp;Important Solaris Volume Manager Files</a></p>
<p class="toc level1 tocsp"><a href="quick-reference-1.html">B.&nbsp;&nbsp;Solaris Volume Manager Quick Reference</a></p>
<p class="toc level1 tocsp"><a href="append-cim-wbem-1.html">C.&nbsp;&nbsp;Solaris Volume Manager CIM/WBEM API</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="troubleshoottasks-95"></a><h3>Replacing Disks</h3>
<p><a name="indexterm-233"></a><a name="indexterm-234"></a><a name="indexterm-235"></a><a name="indexterm-236"></a><a name="indexterm-237"></a><a name="indexterm-238"></a><a name="indexterm-239"></a>This section describes how to replace disks in a Solaris Volume Manager
environment. </p>
<hr><p><b>Caution - </b>If you have soft partitions on a failed disk or on volumes that
are built on a failed disk, you must put the new disk
in the same physical location Also, use the same <tt>c</tt><i>n</i><tt>t</tt><i>n</i><tt>d</tt><i>n</i><tt></tt> number as the disk
being replaced.</p>
<hr>


<a name="troubleshoottasks-96"></a><h4>How to Replace a Failed Disk</h4><ol>
<li><a name="troubleshoottasks-step-98"></a><b><a name="indexterm-240"></a>Identify the failed disk to be replaced by examining the <tt>/var/adm/messages</tt> file
and the <tt>metastat</tt> command output. </b></li>
<li><a name="troubleshoottasks-step-99"></a><b>Locate any state database replicas that might have been placed on the failed
disk. </b><p>Use the <tt>metadb</tt> command to find the replicas.</p><p>The <tt>metadb</tt> command might report errors for the state database replicas that are
located on the failed disk. In this example, <tt>c0t1d0</tt> is the problem device.</p><pre># <tt><b>metadb</b></tt>
   flags       first blk        block count
  a m     u        16               1034            /dev/dsk/c0t0d0s4
  a       u        1050             1034            /dev/dsk/c0t0d0s4
  a       u        2084             1034            /dev/dsk/c0t0d0s4
  W   pc luo       16               1034            /dev/dsk/c0t1d0s4
  W   pc luo       1050             1034            /dev/dsk/c0t1d0s4
  W   pc luo       2084             1034            /dev/dsk/c0t1d0s4</pre><p>The output shows three state database replicas on each slice 4 of
the local disks, <tt>c0t0d0</tt> and <tt>c0t1d0</tt>. The <tt>W</tt> in the flags field of the
<tt>c0t1d0s4</tt> slice indicates that the device has write errors. Three replicas on the
<tt>c0t0d0s4</tt> slice are still good.</p></li>
<li><a name="troubleshoottasks-step-100"></a><b>Record the slice name where the state database replicas reside and the number
of state database replicas. Then, delete the state database replicas.</b><p>The number of state database replicas is obtained by counting the number of
appearances of a slice in the <tt>metadb</tt> command output. In this example, the
three state database replicas that exist on <tt>c0t1d0s4</tt> are deleted. </p><pre># <tt><b>metadb -d c0t1d0s4</b></tt></pre>
<hr><p><b>Caution - </b>If, after deleting the bad state database replicas, you are left with three
or fewer, <a href="tasks-state-db-replicas-9.html">add more state database replicas</a> before continuing. Doing so helps to ensure that configuration information
remains intact.</p>
<hr>
</li>
<li><a name="troubleshoottasks-step-102"></a><b>Locate and delete any hot spares on the failed disk.</b><p>Use the <tt>metastat</tt> command to find hot spares. In this example, hot spare
pool <tt>hsp000</tt> included <tt>c0t1d0s6</tt>, which is then deleted from the pool.</p><pre># <tt><b>metahs -d hsp000 c0t1d0s6</b></tt>
hsp000: Hotspare is deleted</pre></li>
<li><b>Replace the failed disk.</b><p>This step might entail using the <tt>cfgadm</tt> command, the <tt>luxadm</tt> command, or other commands
as appropriate for your hardware and environment. When performing this step, make sure
to follow your hardware's documented procedures to properly manipulate the Solaris state of
this disk.</p></li>
<li><a name="troubleshoottasks-step-105"></a><b>Repartition the new disk.</b><p>Use the <tt>format</tt> command or the <tt>fmthard</tt> command to partition the disk with
the same slice information as the failed disk. If you have the <tt>prtvtoc</tt>
output from the failed disk, you can format the replacement disk with the
<tt>fmthard -s <i>/tmp/failed-disk-prtvtoc-output</i></tt> command.</p></li>
<li><a name="troubleshoottasks-step-106"></a><b>If you deleted state database replicas, add the same number back to the
appropriate slice.</b><p>In this example, <tt>/dev/dsk/c0t1d0s4</tt> is used.</p><pre># <tt><b>metadb -a -c 3 c0t1d0s4</b></tt></pre></li>
<li><a name="troubleshoottasks-step-106a"></a><b>If any slices on the disk are components of RAID-5 volumes or are
components of RAID-0 volumes that are in turn submirrors of RAID-1 volumes, run
the <tt>metareplace -e</tt> command for each slice. </b><p>In this example, <tt>/dev/dsk/c0t1d0s4</tt> and mirror <tt>d10</tt> are used.</p><pre># <tt><b>metareplace -e d10 c0t1d0s4</b></tt></pre></li>
<li><a name="troubleshoottasks-step-113"></a><b>If any soft partitions are built directly on slices on the replaced disk,
run the <tt>metarecover -m -p</tt> command on each slice that contains soft partitions. This command
regenerates the extent headers on disk.</b><p>In this example, <tt>/dev/dsk/c0t1d0s4</tt> needs to have the soft partition markings on disk
regenerated. The slice is scanned and the markings are reapplied, based on the
information in the state database replicas. </p><pre># <tt><b>metarecover c0t1d0s4 -m -p</b></tt></pre></li>
<li><b>If any soft partitions on the disk are components of RAID-5 volumes or
are components of RAID-0 volumes that are submirrors of RAID-1 volumes, run the
<tt>metareplace -e</tt> command for each slice. </b><p>In this example, <tt>/dev/dsk/c0t1d0s4</tt> and mirror <tt>d10</tt> are used.</p><pre># <tt><b>metareplace -e d10 c0t1d0s4</b></tt></pre></li>
<li><a name="troubleshoottasks-step-114b"></a><b>If any RAID-0 volumes have soft partitions built on them, run the <tt>metarecover</tt>
command for each RAID-0 volume.</b><p>In this example, RAID-0 volume, <tt>d17</tt>, has soft partitions built on it. </p><pre># <tt><b>metarecover d17 -m -p</b></tt></pre></li>
<li><a name="troubleshoottasks-step-109"></a><b>Replace hot spares that were deleted, and add them to the appropriate hot
spare pool or pools.</b><p>In this example, hot spare pool, <tt>hsp000</tt> included <tt>c0t1d0s6</tt>. This slice is added to
the hot spare pool.</p><pre># <tt><b>metahs -a hsp000 c0t1d0s6</b></tt>hsp000: Hotspare is added</pre></li>
<li><a name="troubleshoottasks-step-110"></a><b>If soft partitions or nonredundant volumes were affected by the failure, restore data
from backups. If only redundant volumes were affected, then validate your data.</b><p><a name="indexterm-241"></a>Check the user and application data on all volumes. You might have to
run an application-level consistency checker, or use some other method to check the
data. </p></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="troubleshoottasks-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="tasks-basics-7.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

