<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Working With File-Based Data Using the <tt>metassist</tt> Command - Solaris Volume Manager Administration Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2006-06-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">Solaris Volume Manager Administration Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ewaus.html">Previous</a>
             </td>
             <td align="right">
                 <a href="tasks-topdown-12.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="roadmap-10.html">1.&nbsp;&nbsp;Getting Started With Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="storage-overview-1.html">2.&nbsp;&nbsp;Storage Management Concepts</a></p>
<p class="toc level1 tocsp"><a href="basics-23185.html">3.&nbsp;&nbsp;Solaris Volume Manager Overview</a></p>
<p class="toc level1 tocsp"><a href="eoqra.html">4.&nbsp;&nbsp;Solaris Volume Manager for Sun Cluster (Overview)</a></p>
<p class="toc level1 tocsp"><a href="svm-scenario-1.html">5.&nbsp;&nbsp;Configuring and Using Solaris Volume Manager (Scenario)</a></p>
<p class="toc level1 tocsp"><a href="about-state-db-replicas-1.html">6.&nbsp;&nbsp;State Database (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-state-db-replicas-1.html">7.&nbsp;&nbsp;State Database (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-metadevices-22802.html">8.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-metadevices-1.html">9.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-mirrors-2.html">10.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-mirrors-1.html">11.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-softpart-1.html">12.&nbsp;&nbsp;Soft Partitions (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-softpart-1.html">13.&nbsp;&nbsp;Soft Partitions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-raid5-1.html">14.&nbsp;&nbsp;RAID-5 Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-raid5-1.html">15.&nbsp;&nbsp;RAID-5 Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-hotspares-40444.html">16.&nbsp;&nbsp;Hot Spare Pools (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-hotspares-1.html">17.&nbsp;&nbsp;Hot Spare Pools (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-disksets-31856.html">18.&nbsp;&nbsp;Disk Sets (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-disksets-1.html">19.&nbsp;&nbsp;Disk Sets (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-basics-2.html">20.&nbsp;&nbsp;Maintaining Solaris Volume Manager (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="best-practices-1.html">21.&nbsp;&nbsp;Best Practices for Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="topdown-overview.html">22.&nbsp;&nbsp;Top-Down Volume Creation (Overview)</a></p>
<p class="toc level1 tocsp"><a href="topdown-tasks-chap.html">23.&nbsp;&nbsp;Top-Down Volume Creation (Tasks)</a></p>
<p class="toc level2"><a href="tasks-topdown-13.html">Top-Down Volume Creation (Task Map)</a></p>
<p class="toc level2"><a href="tasks-topdown-15.html">Prerequisites for Top-Down Volume Creation</a></p>
<p class="toc level2"><a href="ewaus.html">Creating Volumes Automatically</a></p>
<p class="toc level3"><a href="ewaus.html#exlvu">How to Create RAID-1 (mirror) Volumes Using the <tt>metassist</tt> Command</a></p>
<div class="onpage">
<p class="toc level2 tocsp"><a href="">Working With File-Based Data Using the <tt>metassist</tt> Command</a></p>
<p class="toc level3"><a href="#ewavh">How to Create a Command File (Shell Script) Using the <tt>metassist</tt> Command</a></p>
<p class="toc level3"><a href="#ewavd">How to Create a Volume Configuration File Using the <tt>metassist</tt> Command</a></p>
</div>
<p class="toc level2 tocsp"><a href="tasks-topdown-12.html">Changing the Default Behavior of the <tt>metassist</tt> Command</a></p>
<p class="toc level1 tocsp"><a href="tasks-snmp-1.html">24.&nbsp;&nbsp;Monitoring and Error Reporting (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="troubleshoottasks-33506.html">25.&nbsp;&nbsp;Troubleshooting Solaris Volume Manager (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="appendfiles-1.html">A.&nbsp;&nbsp;Important Solaris Volume Manager Files</a></p>
<p class="toc level1 tocsp"><a href="quick-reference-1.html">B.&nbsp;&nbsp;Solaris Volume Manager Quick Reference</a></p>
<p class="toc level1 tocsp"><a href="append-cim-wbem-1.html">C.&nbsp;&nbsp;Solaris Volume Manager CIM/WBEM API</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="tasks-topdown-16"></a><h3>Working With File-Based Data Using the <tt>metassist</tt> Command</h3>
<a name="indexterm-222"></a><p>The <tt>metassist</tt> command enables you to create files that you can use to
evaluate volume characteristics or for actual volume creation.</p>

<a name="tasks-topdown-8"></a><h4>Creating a Command File (Shell Script) Using the <tt>metassist</tt> Command</h4>
<p>By running the <tt>metassist</tt> command with the <tt>-c</tt> argument, you can generate a
Bourne shell script containing the commands that would be used to create the
volume configuration. This technique enables you to review the commands before actually creating
the volume, or even to modify the script somewhat to meet specific needs.</p>

<a name="ewavh"></a><h4>How to Create a Command File (Shell Script) Using the <tt>metassist</tt> Command</h4><h6>Before You Begin</h6><p>Check <a href="tasks-topdown-15.html">Prerequisites for Top-Down Volume Creation</a>.</p><ol>
<li><b>Identify the available storage on which to create the volume.</b><p>If you do not explicitly specify storage, Solaris Volume Manager identifies unused storage
on the system and uses it, as appropriate. If you choose to
specify storage, either broadly (for example, all storage on controller 1) or specifically (for
example, use <tt>c1t4d2</tt>, but do not use <tt>c1t4d1</tt>), Solaris Volume Manager uses the
storage you specify.</p></li>
<li><b>Use the <tt>metassist</tt> command and the appropriate options for your task.</b><p>Use the <tt>-c</tt> option to specify that the volume should not actually be
created.</p><pre># <tt><b>metassist create -s </tt><i>diskset-name</i><tt> -f -r </tt><i>redundancy</i><tt> -a </tt><i>device1, device2...</i><tt> \ -S </tt><i>size</i><tt> -v </tt><i>verbosity</i><tt> [-c]</b></tt></pre><dl><dt><tt>create</tt></dt>
<dd><p>Is the subcommand used to create volumes.</p></dd>
<dt><tt>-s</tt> <i>diskset-name</i></dt>
<dd><p>Specifies the name of the disk set to use for the volume.</p></dd>
<dt><tt>-f</tt></dt>
<dd><p>Specifies that the volume be associated with a hot spare.</p></dd>
<dt><tt>-r</tt> <i>redundancy</i></dt>
<dd><p>Specifies the level of redundancy (number of data copies) to create.</p></dd>
<dt><tt>-a</tt> <i>device1, device2...</i></dt>
<dd><p>Specifies the devices that are available for creating the volume.</p></dd>
<dt><tt>-S</tt> <i>size</i></dt>
<dd><p>Specifies the size of the volume to create in <tt>KB</tt>, <tt>MB</tt>, <tt>GB</tt>, or <tt>TB</tt>, for kilobytes, megabytes, gigabytes, and terabytes, respectively.</p></dd>
<dt><tt>-v</tt> <i>verbosity</i></dt>
<dd><p>Specifies how verbose the output should be. Allowable values range from <tt>0</tt> (nearly silent output) to <tt>2</tt> (significant output). The default level is <tt>1</tt> (moderate output).</p></dd>
<dt><tt>-c</tt></dt>
<dd><p>Specifies that the volume should not actually be created. Instead, a shell script that can be used to create the specified configuration is sent to standard output.</p>
<hr><p><b>Note - </b>The shell script required by the <tt>-c</tt> argument is sent to standard output, while the rest of the output from the <tt>metassist</tt> command goes to standard error. You can redirect the output streams as you choose.</p>
<hr>
<p>See the following examples and the <a href="http://docs.sun.com/doc/819-2240/metassist-1m?a=view"><tt>metassist</tt>(1M)</a> man page for more information.</p></dd>
</dl>
</li></ol><a name="ewavc"></a>Example&nbsp;23-6 Creating a Command File (Shell Script) Using the <tt>metassist</tt> Command<a name="indexterm-223"></a><p>The following example shows how to use the <tt>metassist</tt> command to create a
two-way mirror, 10 Mbytes in size, with a hot spare to provide additional
fault tolerance. The <tt>-f</tt> option specifies fault tolerance. The final argument (<tt>-c</tt>) specifies
that the volume should not actually be created. Rather, a shell script that
could be used to create the specified configuration should be sent to standard
output. </p><pre># <tt><b>metassist create -s myset -f -r 2 -S 10mb -c</b></tt>
(output truncated)
.
.
.
Volume request completed successfully.
#!/bin/sh

#
# Environment
#

# Amend PATH
PATH="/usr/sbin:/usr/bin:$PATH"
export PATH

# Disk set name
diskset='myset'

#
# Functions
#

# Echo (verbose) and exec given command, exit on error
execho () {
    test -n "$verbose" &amp;&amp; echo "$@"
    "$@" || exit
}

# Get full /dev/rdsk path of given slice
fullpath () {
    case "$1" in
        /dev/dsk/*|/dev/did/dsk/*) echo "$1" | sed 's/dsk/rdsk/' ;;
        /*) echo "$1" ;;
        *) echo /dev/rdsk/"$1" ;;
    esac
}

# Run fmthard, ignore partboot error, error if output
fmthard_special () {
    ignore='Error writing partboot'
    out=`fmthard "$@" 2>&amp;1`
    result=$?
    echo "$out" |
    case "$out" in
        *"$ignore"*) grep -v "$ignore"; return 0 ;;
        '') return "$result" ;;
        *) cat; return 1 ;;
    esac >&amp;2
}

#
# Main
#

# Verify root
if [ "`id | sed 's/^[^(]*(\([^)]*\).*/\1/'`" != root ]
then
    echo "This script must be run as root." >&amp;2
    exit 1;
fi

# Check for verbose option
case "$1" in
    -v) verbose=1 ;;
    *) verbose= ;;
esac
    
# Does the disk set exist?
if metaset -s "$diskset" >/dev/null 2>&amp;1
then
    # Take control of disk set
    execho metaset -s "$diskset" -t
else
    # Create the disk set
    autotakeargs=
    /usr/sbin/clinfo || autotakeargs='-A enable'
    execho metaset -s "$diskset" $autotakeargs -a -h `uname -n | cut -f1 -d.`
fi
    
# Format slices
execho fmthard_special -d 7:0:0:0:0 `fullpath c1t3d0s7`
execho fmthard_special -d 7:0:0:0:0 `fullpath c1t6d0s7`
execho fmthard_special -d 7:0:0:0:0 `fullpath c1t4d0s7`

# Add disks to set
execho metaset -s "$diskset" -a c1t3d0
execho metaset -s "$diskset" -a c1t6d0
execho metaset -s "$diskset" -a c1t4d0

# Format slices
execho fmthard_special -d 0:4:0:10773:17649765 `fullpath c1t3d0s0`
execho fmthard_special -d 0:4:0:10773:17649765 `fullpath c1t6d0s0`
execho fmthard_special -d 0:4:0:10773:17649765 `fullpath c1t4d0s0`
execho fmthard_special -d 1:4:0:17660538:21546 `fullpath c1t3d0s1`
execho fmthard_special -d 1:4:0:17660538:21546 `fullpath c1t4d0s1`
execho fmthard_special -d 1:4:0:17660538:21546 `fullpath c1t6d0s1`

# Does hsp000 exist?
metahs -s "$diskset" -i hsp000 >/dev/null 2>&amp;1 || {
    # Create hsp hsp000
    execho metainit -s "$diskset" hsp000
}

# Add slices to hsp000
execho metahs -s "$diskset" -a hsp000 c1t3d0s1

# Create concat d2
execho metainit -s "$diskset" d2 1 1 c1t4d0s1

# Associate concat d2 with hot spare pool hsp000
execho metaparam -s "$diskset" -h hsp000 d2

# Create concat d1
execho metainit -s "$diskset" d1 1 1 c1t6d0s1

# Associate concat d1 with hot spare pool hsp000
execho metaparam -s "$diskset" -h hsp000 d1

# Create mirror d0
execho metainit -s "$diskset" d0 -m d2 1
execho metattach -s "$diskset" d0 d1
# </pre><a name="eteth"></a>Example&nbsp;23-7 Saving a Command File (Shell Script) Using the <tt>metassist</tt> Command<a name="indexterm-224"></a><p>The following example shows how to use the <tt>metassist</tt> command to create a
two-way mirror, 10 Mbytes in size, with a hot spare to provide additional
fault tolerance. The <tt>-f</tt> option specifies fault tolerance. The final argument (<tt>-c</tt>) specifies
that the volume should not actually be created. Rather, a shell script that
could be used to create the specified configuration should be sent to standard
output. The end of the command redirects standard output to create the <tt>/tmp/metassist-shell-script.sh</tt>
shell script that can later be used to create the specified volume.</p><pre># <tt><b>metassist create -s myset -f -r 2 -S 10mb -c > \ /tmp/metassist-shell-script.sh</b></tt></pre>

<a name="tasks-topdown-25"></a><h4>Creating a Volume With a Saved Shell Script Created by the <tt>metassist</tt> Command</h4>
<p>After you have created a shell script with the <tt>metassist</tt> command, you can
use that script to create the volumes that you specified when the shell
script was created. </p>
<hr><p><b>Caution - </b>The command script created by the <tt>metassist</tt> command has significant dependencies on the
specific system configuration of the system on which the script was created, at
the time the script was created. Using the script on different systems or
after any changes to the system configuration can lead to data corruption or
loss. </p>
<hr>


<a name="tasks-topdown-proc-26"></a><h5>How to Execute a Saved <tt>metassist</tt> Command Shell Script</h5>
<h6>Before You Begin</h6><p>Check <a href="tasks-topdown-15.html">Prerequisites for Top-Down Volume Creation</a>.</p><ol>
<li><b>Ensure that the system configuration has not changed since the shell script was
created, and that you are executing the script on the same system it
was created on. </b></li>
<li><b>Execute the saved shell script.</b><pre># <tt>sh ./<i>metassist-shell-script-name</i></tt></pre></li>
<li><b>View the new volume. </b><pre># <tt>metastat</tt> <tt>-s</tt> <i>diskset-name</i></pre></li></ol><a name="ewavg"></a>Example&nbsp;23-8 Executing a Saved <tt>metassist</tt> Command Shell Script<p>The following example shows how to use the <tt>metassist</tt> command to create a
volume using a shell script.</p><pre># <tt><b>sh ./tmp/metassist-shell-script.sh</b></tt>
myset/hsp000: Hotspare pool is setup
myset/hsp000: Hotspare is added
myset/d2: Concat/Stripe is setup
myset/d1: Concat/Stripe is setup
myset/d0: Mirror is setup
myset/d0: submirror myset/d1 is attached</pre>

<a name="tasks-topdown-9"></a><h4>Creating a Volume Configuration File With the <tt>metassist</tt> Command</h4>
<a name="indexterm-225"></a><p>By running the <tt>metassist</tt> command with the <tt><tt>-d</tt></tt> argument, you can generate
an XML-based volume configuration file that specifies the volumes and their components in
detail, including all options and relevant information about the volumes. Reviewing this file helps
you to understand the configuration that the <tt>metassist</tt> command recommends. Making careful changes
to this file can also enable you to fine-tune the configuration, then to
use the volume configuration file as input to the <tt>metassist</tt> command to
actually create volumes. </p>

<a name="ewavd"></a><h4>How to Create a Volume Configuration File Using the <tt>metassist</tt> Command</h4><h6>Before You Begin</h6><p>Check <a href="tasks-topdown-15.html">Prerequisites for Top-Down Volume Creation</a>.</p><ol>
<li><b>Identify the available storage on which to create the volume.</b><p>If you do not explicitly specify storage, Solaris Volume Manager identifies unused storage
on the system and uses it, as appropriate. If you choose to
specify storage, either broadly (for example, all storage on controller 1) or specifically (for
example, use <tt>c1t4d2</tt>, but do not use <tt>c1t4d1</tt>), Solaris Volume Manager uses the
storage you specify.</p></li>
<li><b>Use the <tt>metassist</tt> command and the appropriate options for your task.</b><p>Use the <tt>-d</tt> option to specify that the volume should not actually be
created. Instead, an XML-based volume configuration file is sent to standard output:</p><pre># <tt><b>metassist create -s </tt><i>diskset-name</i><tt> -f -r </tt><i>redundancy</i><tt> -a </tt><i>device1, device2...</i><tt> \ -S </tt><i>size</i><tt> -v </tt><i>verbosity</i><tt> [-d]</b></tt></pre><dl><dt><tt>create</tt></dt>
<dd><p>Is the subcommand used to create volumes.</p></dd>
<dt><tt>-s</tt> <i>diskset-name</i></dt>
<dd><p>Specifies the name of the disk set to use for the volume.</p></dd>
<dt><tt>-f</tt></dt>
<dd><p>Specifies that the volume be associated with a hot spare.</p></dd>
<dt><tt>-r</tt> <i>redundancy</i></dt>
<dd><p>Specifies the level of redundancy (number of data copies) to create.</p></dd>
<dt><tt>-a</tt> <i>device1, device2...</i></dt>
<dd><p>Specifies the devices that are available for creating the volume.</p></dd>
<dt><tt>-S</tt> <i>size</i></dt>
<dd><p>Specifies the size of the volume to create in <tt>KB</tt>, <tt>MB</tt>, <tt>GB</tt>, or <tt>TB</tt>, for kilobytes, megabytes, gigabytes, and terabytes, respectively.</p></dd>
<dt><tt>-v</tt> <i>verbosity</i></dt>
<dd><p>Specifies how verbose the output should be. Allowable values range from <tt>0</tt> (nearly silent output) to <tt>2</tt> (significant output). The default level is <tt>1</tt> (moderate output).</p></dd>
<dt><tt>-d</tt></dt>
<dd><p>Specifies that the volume should not actually be created.</p>
<hr><p><b>Note - </b>The XML-based volume configuration file required by the <tt>-d</tt> argument is sent to standard output. However, the rest of the output from the <tt>metassist</tt> command goes to standard error. You can redirect the output streams as you choose.</p>
<hr>
<p>See the following examples and the <a href="http://docs.sun.com/doc/819-2240/metassist-1m?a=view"><tt>metassist</tt>(1M)</a> man page for more information.</p></dd>
</dl>
</li></ol><a name="etesj"></a>Example&nbsp;23-9 Creating a Volume Configuration File Using the <tt>metassist</tt> Command<a name="indexterm-226"></a><p>This example shows how to use the <tt>metassist</tt> command to create a two-way
mirror, 10 Mbytes in size, with a hot spare to provide additional fault
tolerance. The <tt>-f</tt> option specifies fault tolerance. The final argument (<tt>-d</tt>) specifies that
the volume should not actually be created. Rather, a volume configuration file that
could eventually be used to create the specified configuration should be sent to standard
output. </p><pre># <tt><b>metassist create -s myset -f -r 2 -S 10mb -d</b></tt>


.(output truncated)
.
.
Volume request completed successfully.
&lt;?xml version="1.0"?>
&lt;!DOCTYPE volume-config SYSTEM "/usr/share/lib/xml/dtd/volume-config.dtd">
 &lt;volume-config>
&lt;diskset name="myset"/>
&lt;disk name="c1t3d0"/>
&lt;disk name="c1t6d0"/>
&lt;disk name="c1t4d0"/>
&lt;slice name="c1t3d0s7" sizeinblocks="0"/>
&lt;slice name="c1t3d0s0" sizeinblocks="17649765" startsector="10773"/>
&lt;slice name="c1t6d0s7" sizeinblocks="0"/>
&lt;slice name="c1t6d0s0" sizeinblocks="17649765" startsector="10773"/>
&lt;slice name="c1t4d0s7" sizeinblocks="0"/>
&lt;slice name="c1t4d0s0" sizeinblocks="17649765" startsector="10773"/>
&lt;hsp name="hsp000">
&lt;slice name="c1t3d0s1" sizeinblocks="21546" startsector="17660538"/>
&lt;/hsp>
&lt;mirror name="d0" read="ROUNDROBIN" write="PARALLEL" passnum="1">
&lt;concat name="d2">
&lt;slice name="c1t4d0s1" sizeinblocks="21546" startsector="17660538"/>
&lt;hsp name="hsp000"/>
&lt;/concat>
&lt;concat name="d1>
&lt;slice name="c1t6d0s1"sizeinblocks="21546" startsector="17660538"/>
&lt;hsp name="hsp000"/>
&lt;/concat>
&lt;/mirror>
&lt;/volume-config>
# </pre><a name="etesc"></a>Example&nbsp;23-10 Saving a Volume Configuration File Using the <tt>metassist</tt> Command<a name="indexterm-227"></a><p>This example shows how to use the <tt>metassist</tt> command to create a two-way
mirror, 10 Mbytes in size, with a hot spare to provide additional fault
tolerance. The <tt>-f</tt> option specifies fault tolerance. The final argument (<tt>-d</tt>) specifies that
the volume should not actually be created. Rather, a volume configuration file that
could eventually be used to create the specified configuration should be sent to standard
output. The end of the command redirects standard output to create the <tt>/tmp/metassist-volume-config.xml</tt>
volume configuration file that can later be used to create the specified volume.</p><pre># <tt><b>metassist create -s myset -f -r 2 -S 10mb -d > \ /tmp/metassist-volume-config.xml</b></tt></pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ewaus.html">Previous</a>
             </td>
             <td align="right">
                 <a href="tasks-topdown-12.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

