<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Solaris Volume Manager Disk Set Administration - Solaris Volume Manager Administration Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2006-06-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">Solaris Volume Manager Administration Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="eqqda.html">Previous</a>
             </td>
             <td align="right">
                 <a href="egjyp.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="roadmap-10.html">1.&nbsp;&nbsp;Getting Started With Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="storage-overview-1.html">2.&nbsp;&nbsp;Storage Management Concepts</a></p>
<p class="toc level1 tocsp"><a href="basics-23185.html">3.&nbsp;&nbsp;Solaris Volume Manager Overview</a></p>
<p class="toc level1 tocsp"><a href="eoqra.html">4.&nbsp;&nbsp;Solaris Volume Manager for Sun Cluster (Overview)</a></p>
<p class="toc level1 tocsp"><a href="svm-scenario-1.html">5.&nbsp;&nbsp;Configuring and Using Solaris Volume Manager (Scenario)</a></p>
<p class="toc level1 tocsp"><a href="about-state-db-replicas-1.html">6.&nbsp;&nbsp;State Database (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-state-db-replicas-1.html">7.&nbsp;&nbsp;State Database (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-metadevices-22802.html">8.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-metadevices-1.html">9.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-mirrors-2.html">10.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-mirrors-1.html">11.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-softpart-1.html">12.&nbsp;&nbsp;Soft Partitions (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-softpart-1.html">13.&nbsp;&nbsp;Soft Partitions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-raid5-1.html">14.&nbsp;&nbsp;RAID-5 Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-raid5-1.html">15.&nbsp;&nbsp;RAID-5 Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-hotspares-40444.html">16.&nbsp;&nbsp;Hot Spare Pools (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-hotspares-1.html">17.&nbsp;&nbsp;Hot Spare Pools (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-disksets-31856.html">18.&nbsp;&nbsp;Disk Sets (Overview)</a></p>
<p class="toc level2"><a href="ftzhv.html">What's New in Disk Sets</a></p>
<p class="toc level2"><a href="about-disksets-39080.html">Introduction to Disk Sets</a></p>
<p class="toc level2"><a href="eqqda.html">Types of Disk Sets</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Solaris Volume Manager Disk Set Administration</a></p>
</div>
<p class="toc level2"><a href="egjyp.html">Guidelines for Working With Disk Sets</a></p>
<p class="toc level2"><a href="egjyq.html">Asynchronous Shared Storage in Disk Sets</a></p>
<p class="toc level2"><a href="about-disksets-2.html">Scenario--Disk Sets</a></p>
<p class="toc level1 tocsp"><a href="tasks-disksets-1.html">19.&nbsp;&nbsp;Disk Sets (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-basics-2.html">20.&nbsp;&nbsp;Maintaining Solaris Volume Manager (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="best-practices-1.html">21.&nbsp;&nbsp;Best Practices for Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="topdown-overview.html">22.&nbsp;&nbsp;Top-Down Volume Creation (Overview)</a></p>
<p class="toc level1 tocsp"><a href="topdown-tasks-chap.html">23.&nbsp;&nbsp;Top-Down Volume Creation (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-snmp-1.html">24.&nbsp;&nbsp;Monitoring and Error Reporting (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="troubleshoottasks-33506.html">25.&nbsp;&nbsp;Troubleshooting Solaris Volume Manager (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="appendfiles-1.html">A.&nbsp;&nbsp;Important Solaris Volume Manager Files</a></p>
<p class="toc level1 tocsp"><a href="quick-reference-1.html">B.&nbsp;&nbsp;Solaris Volume Manager Quick Reference</a></p>
<p class="toc level1 tocsp"><a href="append-cim-wbem-1.html">C.&nbsp;&nbsp;Solaris Volume Manager CIM/WBEM API</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="about-disksets-39970"></a><h3>Solaris Volume Manager Disk Set Administration</h3>
<a name="indexterm-145"></a><a name="indexterm-146"></a><p>Unlike local disk set administration, you do not need to manually create or
delete disk set state databases. Solaris Volume Manager places one state database replica
(on slice 7) on each disk across all disks in the disk
set, up to a maximum of 50 total replicas in the disk set.</p><p>When you add disks to a disk set, Solaris Volume Manager automatically
creates the state database replicas on the disk set. When a disk is
accepted into a disk set, Solaris Volume Manager might repartition the disk so
that the state database replica for the disk set can be placed on
the disk (see <a href="#about-disksets-123">Automatic Disk Partitioning</a>).</p><p>A file system that resides on a volume in a disk set
normally is not mounted automatically at boot time with the <tt>/etc/vfstab</tt> file. The necessary
Solaris Volume Manager RPC daemons (<tt>rpc.metad</tt> and <tt>rpc.metamhd</tt>) do not start early
enough in the boot process to permit this. Additionally, the ownership of a
disk set is lost during a reboot. Do not disable the Solaris Volume
Manager RPC daemons in the <tt>/etc/inetd.conf</tt> file. They are configured to start by
default. These daemons must remain enabled to allow Solaris Volume Manager to use
its full functionality.</p><p>When the autotake feature is enabled using the <tt>-A</tt> option of the <tt>metaset</tt>
command, the disk set is automatically taken at boot time. Under these circumstances,
a file system that resides on a volume in a disk set can
be automatically mounted with the <tt>/etc/vfstab</tt> file. To enable an automatic take during
the boot process, the disk set must be associated with only a single
host, and must have the autotake feature enabled. A disk set can be
enabled either during or after disk set creation. For more information on the
autotake feature, see <a href="eqqda.html#eqbhz">Autotake Disk Sets</a>.</p>
<hr><p><b>Note - </b>Although disk sets are supported in single-host configurations, they are often not appropriate
for &ldquo;local&rdquo; (not dual-connected) use. Two common exceptions are the use of disk
sets to provide a more manageable namespace for logical volumes, and to more
easily manage storage on a Storage Area Network (SAN) fabric (see <a href="about-disksets-2.html">Scenario--Disk Sets</a>.</p>
<hr>
<p>Disk sets can be created and configured by using the Solaris Volume
Manager command-line interface (the <tt>metaset</tt> command) or the Enhanced Storage tool within the
Solaris Management Console.  </p><p>After disks are added to a disk set, the disk set can
be <b>reserved</b> (or <b>taken</b>) and <b>released</b> by hosts in the disk set. When
a disk set is reserved by a host, the other host in the
disk set cannot access the data on the disks in the disk
set. To perform maintenance on a disk set, a host must be the
owner of the disk set or have reserved the disk set. A host
takes implicit ownership of the disk set by putting the first disk into
the set.</p><p>Disk sets, including disk sets created on a different system, can be imported
into existing Solaris Volume Manager configurations using the <tt>metaimport</tt> command.</p>

<a name="eqbic"></a><h4>Reserving a Disk Set</h4>
<a name="indexterm-147"></a><a name="indexterm-148"></a><p>Before a host can use the disks in a disk set, the
host must reserve the disk set. There are two methods of reserving a
disk set: </p>
<ul><li><p><b>Safely -</b> When you safely reserve a disk set, Solaris Volume Manager attempts to take the disk set, and the other host attempts to release the disk set. The release (and therefore the reservation) might fail. </p></li>
<li><p><b>Forcibly -</b> When you forcibly reserve a disk set, Solaris Volume Manager reserves the disk set whether or not another host currently has the set reserved. This method is generally used when a host in the disk set is down or not communicating. All disks within the disk set are taken over. The state database is read in on the host performing the reservation and the shared volumes configured in the disk set become accessible. If the other host had the disk set reserved at this point, it would panic due to reservation loss.</p><p>Normally, two hosts in a disk set cooperate with each other to ensure that the disks in a disk set are reserved by only one host at a time. A normal situation is defined as both hosts being up and communicating with each other.</p></li></ul>

<hr><p><b>Note - </b>If a disk has been determined unexpectedly not to be reserved (perhaps because
another host using the disk set forcibly took the disk), the host will
panic. This behavior helps to minimize data loss which would occur if two
hosts were to simultaneously access the same disk.</p>
<hr>
<p>For more information about taking or reserving a disk set, see <a href="tasks-disksets-45.html#tasks-disksets-3">How to Take a Disk Set</a>.</p>

<a name="eqbij"></a><h4>Releasing a Disk Set</h4>
<a name="indexterm-149"></a><a name="indexterm-150"></a><p>Releasing a disk set can be useful when you perform maintenance on
the physical disks in the disk set. When a disk set is released,
it cannot be accessed by the host. If both hosts in a disk
set release the set, neither host in the disk set can access the
disks in the disk set.</p><p>For more information about releasing a disk set, see <a href="tasks-disksets-45.html#tasks-disksets-6">How to Release a Disk Set</a>.</p>

<a name="eqbji"></a><h4>Importing a Disk Set</h4>
<a name="indexterm-151"></a><a name="indexterm-152"></a><a name="indexterm-153"></a><p>Beginning with the Solaris 9 9/04 release, the <tt>metaimport</tt> command enables you to
import disk sets, including replicated disk sets, into existing Solaris Volume Manager configurations
that have device ID support in the disk set. You can also use
the <tt>metaimport</tt> command to report on disk sets that are available for import.</p><p>Replicated disk sets are created using remote replication software. In order for a
replicated disk set to be imported with the <tt>metaimport</tt> command, the slice containing
the state database replica for each disk in the disk set must also
be replicated onto the same slice of the replicated disk set. This corresponds
to slice 7 for non-EFI disks and slice 6 for EFI disks.
Before replicating a disk set, make sure that the disk configurations of the
data to be replicated and of the remote site match. This step ensures
that both the state database replica and the data are replicated accurately.</p><p>The <tt>metaimport</tt> command also does not import a disk in a disk set
if the disk does not contain a volume or a state database
replica. This scenario occurs if a volume or a state database replica have
not been added to a disk or have been deleted from a disk.
In this case, when you import the disk set to another system, you
would find that the disk is missing from the disk set. For example,
maximum of 50 state database replicas are allowed per Solaris Volume Manager disk
set. If you have 60 disks in a disk set, the 10
disks that do not contain a state database replica must contain a volume
in order to be imported with the disk set.</p><p>For tasks associated with importing a disk set, see <a href="efnri.html">Importing Disk Sets</a>.</p>
<hr><p><b>Note - </b>In a Sun Cluster environment, the <tt>metaimport</tt> command is not available.</p>
<hr>


<a name="about-disksets-123"></a><h4>Automatic Disk Partitioning</h4>
<a name="indexterm-154"></a><a name="indexterm-155"></a><a name="indexterm-156"></a><a name="indexterm-157"></a><a name="indexterm-158"></a><p>When you add a new disk to a disk set, Solaris Volume
Manager checks the disk format. If necessary, Solaris Volume Manager repartitions the disk
to ensure that the disk has an appropriately configured slice 7 with adequate
space for a state database replica. The precise size of slice 7 depends
on the disk geometry. However, the size will be no less than 4
Mbytes, and probably closer to 6 Mbytes (depending on where the cylinder boundaries
lie). </p><p>By default, Solaris Volume Manager places one state database replica on slice 7.
You can increase the default size of slice 7 or decrease the
size of the state database replica in order to fit more than one
state database replica onto the slice.</p>
<hr><p><b>Note - </b>The minimal size for slice 7 will likely change in the future, based
on a variety of factors, including the size of the state database
replica and information to be stored in the state database replica. The default
size for a state database replica in a multi-owner disk set is 16
Mbytes.</p>
<hr>
<p>For use in disk sets, disks must have a slice 7 that
meets these criteria:</p>
<ul><li><p>Starts at sector 0</p></li>
<li><p>Includes enough space for a disk label and state database replicas</p></li>
<li><p>Cannot be mounted</p></li>
<li><p>Does not overlap with any other slices, including slice 2</p></li></ul>
<p>If the existing partition table does not meet these criteria, Solaris Volume
Manager repartitions the disk. A small portion of each drive is reserved in
slice 7 for use by Solaris Volume Manager. The remainder of the space
on each drive is placed into slice 0. Any existing data on the
disks is lost by repartitioning. </p>
<hr><p><b>Tip - </b>After you add a drive to a disk set, you may repartition
it  as necessary, with the exception that slice 7 is not altered
in any way. </p>
<hr>
<p>The following output from the <tt>prtvtoc</tt> command shows a disk before it is
added to a disk set.</p><pre>[root@lexicon:apps]$ prtvtoc /dev/rdsk/c1t6d0s0
* /dev/rdsk/c1t6d0s0 partition map
*
* Dimensions:
*     512 bytes/sector
*     133 sectors/track
*      27 tracks/cylinder
*    3591 sectors/cylinder
*    4926 cylinders
*    4924 accessible cylinders
*
* Flags:
*   1: unmountable
*  10: read-only
*
*                          First     Sector    Last
* Partition  Tag  Flags    Sector     Count    Sector  Mount Directory
       0      2    00          0   4111695   4111694
       1      3    01    4111695   1235304   5346998
       2      5    01          0  17682084  17682083
       3      0    00    5346999   4197879   9544877
       4      0    00    9544878   4197879  13742756
       5      0    00   13742757   3939327  17682083</pre><p>The above output shows that the disk does not contain a slice
7. Therefore, when the disk is added to a disk set, Solaris Volume
Manager repartitions the disk. The following output from the <tt>prtvtoc</tt> command shows the disk
after it is added to a disk set.</p><pre>[root@lexicon:apps]$ prtvtoc /dev/rdsk/c1t6d0s0
* /dev/rdsk/c1t6d0s0 partition map
*
* Dimensions:
*     512 bytes/sector
*     133 sectors/track
*      27 tracks/cylinder
*    3591 sectors/cylinder
*    4926 cylinders
*    4924 accessible cylinders
*
* Flags:
*   1: unmountable
*  10: read-only
*
*                          First     Sector    Last
* Partition  Tag  Flags    Sector     Count    Sector  Mount Directory
       0      0    00      10773  17671311  17682083
<b> 7 0 01 0 10773 10772</b>
[root@lexicon:apps]$ </pre><p>The output shows that the disk has been repartitioned to include a
slice 7 that starts at cylinder 0 and that has sufficient space for
the state database replica. If disks you add to a disk set each
have an acceptable slice 7, they are not reformatted.</p>
<hr><p><b>Note - </b>If you have disk sets that you upgraded from Solstice DiskSuite software, the
default state database replica size on those sets is 1034 blocks, not the
8192 block size from Solaris Volume Manager. Also, slice 7 on the
disks that were added under Solstice DiskSuite software are correspondingly smaller than slice 7
on disks that were added under Solaris Volume Manager. </p>
<hr>


<a name="basics-disk-set-name-requirements"></a><h4>Disk Set Name Requirements</h4>
<a name="indexterm-159"></a><p>Disk set volume names are similar to other Solaris Volume Manager component names.
However, the disk set name is included as part of the name.
For example, volume path names include the disk set name after <tt>/dev/md/</tt> and before
the actual volume name in the path.</p><p>The following table shows some example disk set volume names.</p><a name="basics-disk-set-names"></a><h6>Table&nbsp;18-1 Example Volume Names for Disk Sets</h6><table><col width="4*"><col width="4*"><tr><td align="left" valign="top" scope="row"><p><tt>/dev/md/blue/dsk/d0</tt></p></td>
<td align="left" valign="top" scope="row"><p>Block volume <tt>d0</tt>
in disk set <tt>blue</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>/dev/md/blue/dsk/d1</tt></p></td>
<td align="left" valign="top" scope="row"><p>Block volume <tt>d1</tt> in disk set <tt>blue</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>/dev/md/blue/rdsk/d126</tt></p></td>
<td align="left" valign="top" scope="row"><p>Raw volume <tt>d126</tt>
in disk set <tt>blue</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>/dev/md/blue/rdsk/d127</tt></p></td>
<td align="left" valign="top" scope="row"><p>Raw volume <tt>d127</tt> in disk set <tt>blue</tt></p></td>
</tr>
</table><p>Similarly, hot spare pools have the disk set name as part of
the hot spare name.</p>

<a name="about-disksets-1"></a><h4>Example&mdash;Two Shared Disk Sets</h4>
<p><a name="about-disksets-ix319"></a><a href="#about-disksets-fig-2">Figure&nbsp;18-1</a> shows an example configuration that uses two disk sets. </p><p>In this configuration, Host A and Host B share the disk sets
red and blue. They each have their own local disk set, which is
not shared. If Host A fails, Host B can take over control of
Host A's shared disk set, the disk set red. Likewise, if Host B
fails, Host A can take control of Host B's shared disk set, the
disk set blue.</p><a name="about-disksets-fig-2"></a><h6>Figure&nbsp;18-1 Disk Sets Example</h6><img src="figures/disksets-figure.gif" alt="Diagram shows how two hosts can share some disks through shared disk sets and retain exclusive use of other disks in local disk sets. "></img>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="eqqda.html">Previous</a>
             </td>
             <td align="right">
                 <a href="egjyp.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

