<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Recovering From Soft Partition Problems - Solaris Volume Manager Administration Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2006-06-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">Solaris Volume Manager Administration Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="tasks-state-db-replicas-11.html">Previous</a>
             </td>
             <td align="right">
                 <a href="troubleshoottasks-84.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="roadmap-10.html">1.&nbsp;&nbsp;Getting Started With Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="storage-overview-1.html">2.&nbsp;&nbsp;Storage Management Concepts</a></p>
<p class="toc level1 tocsp"><a href="basics-23185.html">3.&nbsp;&nbsp;Solaris Volume Manager Overview</a></p>
<p class="toc level1 tocsp"><a href="eoqra.html">4.&nbsp;&nbsp;Solaris Volume Manager for Sun Cluster (Overview)</a></p>
<p class="toc level1 tocsp"><a href="svm-scenario-1.html">5.&nbsp;&nbsp;Configuring and Using Solaris Volume Manager (Scenario)</a></p>
<p class="toc level1 tocsp"><a href="about-state-db-replicas-1.html">6.&nbsp;&nbsp;State Database (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-state-db-replicas-1.html">7.&nbsp;&nbsp;State Database (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-metadevices-22802.html">8.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-metadevices-1.html">9.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-mirrors-2.html">10.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-mirrors-1.html">11.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-softpart-1.html">12.&nbsp;&nbsp;Soft Partitions (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-softpart-1.html">13.&nbsp;&nbsp;Soft Partitions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-raid5-1.html">14.&nbsp;&nbsp;RAID-5 Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-raid5-1.html">15.&nbsp;&nbsp;RAID-5 Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-hotspares-40444.html">16.&nbsp;&nbsp;Hot Spare Pools (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-hotspares-1.html">17.&nbsp;&nbsp;Hot Spare Pools (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-disksets-31856.html">18.&nbsp;&nbsp;Disk Sets (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-disksets-1.html">19.&nbsp;&nbsp;Disk Sets (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-basics-2.html">20.&nbsp;&nbsp;Maintaining Solaris Volume Manager (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="best-practices-1.html">21.&nbsp;&nbsp;Best Practices for Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="topdown-overview.html">22.&nbsp;&nbsp;Top-Down Volume Creation (Overview)</a></p>
<p class="toc level1 tocsp"><a href="topdown-tasks-chap.html">23.&nbsp;&nbsp;Top-Down Volume Creation (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-snmp-1.html">24.&nbsp;&nbsp;Monitoring and Error Reporting (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="troubleshoottasks-33506.html">25.&nbsp;&nbsp;Troubleshooting Solaris Volume Manager (Tasks)</a></p>
<p class="toc level2"><a href="troubleshoottasks-83.html">Troubleshooting Solaris Volume Manager (Task Map)</a></p>
<p class="toc level2"><a href="troubleshoottasks-1.html">Overview of Troubleshooting the System</a></p>
<p class="toc level2"><a href="troubleshoottasks-95.html">Replacing Disks</a></p>
<p class="toc level3"><a href="troubleshoottasks-95.html#troubleshoottasks-96">How to Replace a Failed Disk</a></p>
<p class="toc level2 tocsp"><a href="tasks-basics-7.html">Recovering From Disk Movement Problems</a></p>
<p class="toc level2"><a href="extkh.html">Device ID Discrepancies After Upgrading to the Solaris 10 Release</a></p>
<p class="toc level2"><a href="troubleshoottasks-29.html">Recovering From Boot Problems</a></p>
<p class="toc level3"><a href="troubleshoottasks-29.html#troubleshoottasks-82">Recovering the root (<tt>/</tt>) RAID-1 (Mirror) Volume</a></p>
<p class="toc level3"><a href="troubleshoottasks-29.html#troubleshoottasks-21051">How to Recover From a Boot Device Failure</a></p>
<p class="toc level2 tocsp"><a href="tasks-state-db-replicas-11.html">Recovering From State Database Replica Failures</a></p>
<p class="toc level3"><a href="tasks-state-db-replicas-11.html#troubleshoottasks-31036">How to Recover From Insufficient State Database Replicas</a></p>
<div class="onpage">
<p class="toc level2 tocsp"><a href="">Recovering From Soft Partition Problems</a></p>
<p class="toc level3"><a href="#tasks-softpart-27">How to Recover Configuration Data for a Soft Partition</a></p>
</div>
<p class="toc level2 tocsp"><a href="troubleshoottasks-84.html">Recovering Storage From a Different System</a></p>
<p class="toc level3"><a href="troubleshoottasks-84.html#eqqcz">How to Recover Storage From a Local Disk Set</a></p>
<p class="toc level2 tocsp"><a href="egcpz.html">Recovering From Disk Set Problems</a></p>
<p class="toc level2"><a href="exlvv.html">Performing Mounted Filesystem Backups Using the <tt>ufsdump</tt> Command</a></p>
<p class="toc level3"><a href="exlvv.html#exlvw">How to Perform a Backup of a Mounted Filesystem Located on a RAID-1 Volume</a></p>
<p class="toc level2 tocsp"><a href="fsujr.html">Performing System Recovery</a></p>
<p class="toc level3"><a href="fsujr.html#fsujq">How to Recover a System Using a Solaris Volume Manager Configuration</a></p>
<p class="toc level1 tocsp"><a href="appendfiles-1.html">A.&nbsp;&nbsp;Important Solaris Volume Manager Files</a></p>
<p class="toc level1 tocsp"><a href="quick-reference-1.html">B.&nbsp;&nbsp;Solaris Volume Manager Quick Reference</a></p>
<p class="toc level1 tocsp"><a href="append-cim-wbem-1.html">C.&nbsp;&nbsp;Solaris Volume Manager CIM/WBEM API</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="tasks-softpart-26"></a><h3>Recovering From Soft Partition Problems</h3>
<p>This section shows how to recover configuration information for soft partitions. You should
only use the following procedure if all of your state database replicas have
been lost and you do not have one of the following:</p>
<ul><li><p>A current or accurate copy of <tt>metastat -p</tt> output</p></li>
<li><p>A current or accurate copy of the <tt>md.cf</tt> file</p></li>
<li><p>An up-to-date <tt>md.tab</tt> file</p></li></ul>


<a name="tasks-softpart-27"></a><h4>How to Recover Configuration Data for a Soft Partition</h4><p><a name="indexterm-248"></a>At the beginning of each soft partition extent, a sector is used to
mark the beginning of the soft partition extent. These  hidden sectors are
called <b>extent headers</b>. These headers do not appear to the user of the soft
partition. If all Solaris Volume Manager configuration data is lost, the disk can
be scanned in an attempt to generate the configuration data.  </p><p>This procedure is a last option to recover lost soft partition configuration information.
The <tt>metarecover</tt> command should only be used when you have lost both your
<tt>metadb</tt> and <tt>md.cf</tt> files, and your <tt>md.tab</tt> file is lost or out of
date. </p>
<hr><p><b>Note - </b>This procedure only works to recover soft partition information. This procedure does not
assist in recovering from other lost configurations or for recovering configuration information for
other Solaris Volume Manager volumes. </p>
<hr>

<hr><p><b>Note - </b>If your configuration included other Solaris Volume Manager volumes that were built on
top of soft partitions, you should recover the soft partitions before attempting to
recover the other volumes. </p>
<hr>
<p>Configuration information about your soft partitions is stored on your devices and in
your state database. Since either source could be corrupt, you must indicate to
the <tt>metarecover</tt> command which source is reliable. </p><p>First, use the <tt>metarecover</tt> command to determine whether the two sources agree. If
they do agree, the <tt>metarecover</tt> command cannot be used to make any changes.
However, if the <tt>metarecover</tt> command reports an inconsistency, you must examine its output
carefully to determine whether the disk or the state database is corrupt. Then,
you should use the <tt>metarecover</tt> command to rebuild the configuration based on
the appropriate source.</p><ol>
<li><a name="tasks-softpart-step-46"></a><b>Read the <a href="about-softpart-8.html">Configuration Guidelines for Soft Partitions</a>.</b></li>
<li><a name="tasks-softpart-step-47"></a><b>Review the soft partition recovery information by using the <tt>metarecover</tt> command.</b><pre># <tt><b>metarecover</b></tt> <i>component</i>-p <tt>-d</tt> </pre><dl><dt><i>component</i></dt>
<dd><p>Specifies the <tt>c</tt><i>n</i><tt>t</tt><i>n</i><tt>d</tt><i>n</i><tt>s</tt><i>n</i><tt></tt>name of the raw component</p></dd>
<dt><tt>-p</tt></dt>
<dd><p>Specifies to regenerate soft partitions</p></dd>
<dt><tt>-d</tt></dt>
<dd><p>Specifies to scan the physical slice for extent headers of soft partitions</p></dd>
</dl>
</li></ol><a name="metarecover-example-01"></a>Example&nbsp;25-2 Recovering Soft Partitions from On-Disk Extent Headers<pre># <tt><b>metarecover c1t1d0s1 -p -d</b></tt>
The following soft partitions were found and will be added to
your metadevice configuration.
 Name            Size     No. of Extents
    d10           10240         1
    d11           10240         1
    d12           10240         1
# <tt><b>metarecover c1t1d0s1 -p -d</b></tt>
The following soft partitions were found and will be added to
your metadevice configuration.
 Name            Size     No. of Extents
    d10           10240         1
    d11           10240         1
    d12           10240         1
WARNING: You are about to add one or more soft partition
metadevices to your metadevice configuration.  If there
appears to be an error in the soft partition(s) displayed
above, do NOT proceed with this recovery operation.
Are you sure you want to do this (yes/no)?<tt><b>yes</b></tt>
c1t1d0s1: Soft Partitions recovered from device.
bash-2.05# metastat
d10: Soft Partition
    Device: c1t1d0s1
    State: Okay
    Size: 10240 blocks
        Device              Start Block  Dbase Reloc
        c1t1d0s1                   0     No    Yes

        Extent              Start Block              Block count
             0                        1                    10240

d11: Soft Partition
    Device: c1t1d0s1
    State: Okay
    Size: 10240 blocks
        Device              Start Block  Dbase Reloc
        c1t1d0s1                   0     No    Yes

        Extent              Start Block              Block count
             0                    10242                    10240

d12: Soft Partition
    Device: c1t1d0s1
    State: Okay
    Size: 10240 blocks
        Device              Start Block  Dbase Reloc
        c1t1d0s1                   0     No    Yes

        Extent              Start Block              Block count
             0                    20483                    10240</pre><p>In this example, three soft partitions are recovered from disk, after the state
database replicas were accidentally deleted.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="tasks-state-db-replicas-11.html">Previous</a>
             </td>
             <td align="right">
                 <a href="troubleshoottasks-84.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

