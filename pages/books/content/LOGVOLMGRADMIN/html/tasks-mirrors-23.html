<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Working With Submirrors - Solaris Volume Manager Administration Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2006-06-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">Solaris Volume Manager Administration Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="tasks-mirrors-21.html">Previous</a>
             </td>
             <td align="right">
                 <a href="tasks-mirrors-24.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="roadmap-10.html">1.&nbsp;&nbsp;Getting Started With Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="storage-overview-1.html">2.&nbsp;&nbsp;Storage Management Concepts</a></p>
<p class="toc level1 tocsp"><a href="basics-23185.html">3.&nbsp;&nbsp;Solaris Volume Manager Overview</a></p>
<p class="toc level1 tocsp"><a href="eoqra.html">4.&nbsp;&nbsp;Solaris Volume Manager for Sun Cluster (Overview)</a></p>
<p class="toc level1 tocsp"><a href="svm-scenario-1.html">5.&nbsp;&nbsp;Configuring and Using Solaris Volume Manager (Scenario)</a></p>
<p class="toc level1 tocsp"><a href="about-state-db-replicas-1.html">6.&nbsp;&nbsp;State Database (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-state-db-replicas-1.html">7.&nbsp;&nbsp;State Database (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-metadevices-22802.html">8.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-metadevices-1.html">9.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-mirrors-2.html">10.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-mirrors-1.html">11.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Tasks)</a></p>
<p class="toc level2"><a href="fpjwe.html">RAID-1 Volumes (Task Map)</a></p>
<p class="toc level2"><a href="tasks-mirrors-21.html">Creating a RAID-1 Volume</a></p>
<p class="toc level3"><a href="tasks-mirrors-21.html#addtasks-12543">How to Create a RAID-1 Volume From Unused Slices</a></p>
<p class="toc level3"><a href="tasks-mirrors-21.html#addtasks-18898">How to Create a RAID-1 Volume From a File System</a></p>
<p class="toc level3"><a href="tasks-mirrors-21.html#frkdb">SPARC: How to Create a RAID-1 Volume From the root (<tt>/</tt>) File System</a></p>
<p class="toc level3"><a href="tasks-mirrors-21.html#gcsdr">x86: How to Create a RAID-1 Volume From the root (<tt>/</tt>) File System</a></p>
<div class="onpage">
<p class="toc level2 tocsp"><a href="">Working With Submirrors</a></p>
<p class="toc level3"><a href="#tasks-mirrors-8">How to Attach a Submirror</a></p>
<p class="toc level3"><a href="#tasks-mirrors-10">How to Detach a Submirror</a></p>
<p class="toc level3"><a href="#tasks-mirrors-12">How to Place a Submirror Offline and Online</a></p>
<p class="toc level3"><a href="#maintaintasksnew-14061">How to Enable a Slice in a Submirror</a></p>
</div>
<p class="toc level2 tocsp"><a href="tasks-mirrors-24.html">Maintaining RAID-1 Volumes</a></p>
<p class="toc level3"><a href="tasks-mirrors-24.html#maintaintasksnew-34973">How to View the Status of Mirrors and Submirrors</a></p>
<p class="toc level3"><a href="tasks-mirrors-24.html#tasks-mirrors-15">How to Change RAID-1 Volume Options</a></p>
<p class="toc level3"><a href="tasks-mirrors-24.html#maintaintasksnew-15601">How to Expand a RAID-1 Volume</a></p>
<p class="toc level3"><a href="tasks-mirrors-24.html#fpklu">How to Cancel a Volume Resynchronization Process</a></p>
<p class="toc level3"><a href="tasks-mirrors-24.html#fpkkx">How to Resume a Volume Resynchronization Process</a></p>
<p class="toc level2 tocsp"><a href="tasks-mirrors-25.html">Responding to RAID-1 Volume Component Failures</a></p>
<p class="toc level3"><a href="tasks-mirrors-25.html#maintaintasksnew-11508">How to Replace a Slice in a Submirror</a></p>
<p class="toc level3"><a href="tasks-mirrors-25.html#maintaintasksnew-10199">How to Replace a Submirror</a></p>
<p class="toc level2 tocsp"><a href="tasks-mirrors-26.html">Removing RAID-1 Volumes (Unmirroring)</a></p>
<p class="toc level3"><a href="tasks-mirrors-26.html#tasks-mirrors-3">How to Unmirror a File System</a></p>
<p class="toc level3"><a href="tasks-mirrors-26.html#tasks-mirrors-5">How to Unmirror a File System That Cannot Be Unmounted</a></p>
<p class="toc level2 tocsp"><a href="tasks-mirrors-27.html">Backing Up Data on a RAID-1 Volume</a></p>
<p class="toc level3"><a href="tasks-mirrors-27.html#tipsandtricks-36804">How to Perform an Online Backup of a RAID-1 Volume</a></p>
<p class="toc level1 tocsp"><a href="about-softpart-1.html">12.&nbsp;&nbsp;Soft Partitions (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-softpart-1.html">13.&nbsp;&nbsp;Soft Partitions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-raid5-1.html">14.&nbsp;&nbsp;RAID-5 Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-raid5-1.html">15.&nbsp;&nbsp;RAID-5 Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-hotspares-40444.html">16.&nbsp;&nbsp;Hot Spare Pools (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-hotspares-1.html">17.&nbsp;&nbsp;Hot Spare Pools (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-disksets-31856.html">18.&nbsp;&nbsp;Disk Sets (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-disksets-1.html">19.&nbsp;&nbsp;Disk Sets (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-basics-2.html">20.&nbsp;&nbsp;Maintaining Solaris Volume Manager (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="best-practices-1.html">21.&nbsp;&nbsp;Best Practices for Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="topdown-overview.html">22.&nbsp;&nbsp;Top-Down Volume Creation (Overview)</a></p>
<p class="toc level1 tocsp"><a href="topdown-tasks-chap.html">23.&nbsp;&nbsp;Top-Down Volume Creation (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-snmp-1.html">24.&nbsp;&nbsp;Monitoring and Error Reporting (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="troubleshoottasks-33506.html">25.&nbsp;&nbsp;Troubleshooting Solaris Volume Manager (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="appendfiles-1.html">A.&nbsp;&nbsp;Important Solaris Volume Manager Files</a></p>
<p class="toc level1 tocsp"><a href="quick-reference-1.html">B.&nbsp;&nbsp;Solaris Volume Manager Quick Reference</a></p>
<p class="toc level1 tocsp"><a href="append-cim-wbem-1.html">C.&nbsp;&nbsp;Solaris Volume Manager CIM/WBEM API</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="tasks-mirrors-23"></a><h3>Working With Submirrors</h3>


<a name="tasks-mirrors-8"></a><h4>How to Attach a Submirror</h4>
<hr><p><b>Note - </b>An error message stating &ldquo;<tt>can't attach labeled submirror to an unlabeled mirror</tt>&rdquo; indicates that you unsuccessfully attempted to attach a
RAID-0 volume to a mirror. A labeled volume (submirror) is a volume whose
first component starts at cylinder 0, while an unlabeled volume's first component starts
at cylinder 1. To prevent the labeled submirror's label from being corrupted, Solaris
Volume Manager does not allow labeled submirrors to be attached to unlabeled mirrors.</p>
<hr>
<h6>Before You Begin</h6><p>Read <a href="eyaso.html">Creating and Maintaining RAID-1 Volumes</a>.</p><ol>
<li><a name="tasks-mirrors-step-76"></a><b>Identify the component (concatenation or stripe) to be used as a submirror. </b><p>The component must be the same size as, or larger than the existing
submirror in the mirror. If you have not yet created a volume to
be a submirror, see <a href="tasks-metadevices-20.html">Creating RAID-0 (Stripe) Volumes</a> or <a href="tasks-metadevices-25.html">Creating RAID-0 (Concatenation) Volumes</a>.</p></li>
<li><a name="tasks-mirrors-step-141"></a><b>Make sure that you have root privilege and that you have a current
backup of all data.</b></li>
<li><b>Verify that the status of the mirror you want to work with
is in an &ldquo;Okay&rdquo; state using the <tt>metastat</tt> command.</b><pre># <tt><b>metastat </tt><i>mirror</i><tt></b></tt></pre></li>
<li><a name="tasks-mirrors-step-78"></a><b>Use one of the following methods to attach a submirror. </b>
<ul><li><p>From the Enhanced Storage tool within the Solaris Management Console, open the Volumes node. Choose the mirror. Then, choose Action&rArr;Properties and click the Submirror tab. Follow the onscreen instructions. For more information, see the online help.</p></li>
<li><p>Use the <tt>metattach <i>mirror</i> <i>submirror</i></tt> command.</p><pre># <tt><b>metattach </tt><i>mirror</i><tt> </tt><i>submirror</i><tt></b></tt></pre></li></ul>
<p>See the <a href="http://docs.sun.com/doc/819-2240/metattach-1m?a=view"><tt>metattach</tt>(1M)</a> man page for more information.</p></li>
<li><b>View the status of the mirror using the <tt>metastat</tt> command.</b><pre># <tt><b>metastat </tt><i>mirror</i><tt></b></tt></pre></li></ol><a name="egjxs"></a>Example&nbsp;11-7 Attaching a Submirror<pre># <tt><b>metastat d30</b></tt>
d30: mirror
    Submirror 0: d60
      State: Okay   
...
# <tt><b>metattach d30 d70</b></tt>
d30: submirror d70 is attached
# <tt><b>metastat d30</b></tt>
d30: mirror
    Submirror 0: d60
      State: Okay        
    Submirror 1: d70
      State: Resyncing
    Resync in progress: 41 % done
    Pass: 1
    Read option: roundrobin (default)
    Write option: parallel (default)
    Size: 2006130 blocks
...</pre><p><a name="indexterm-77"></a><a name="indexterm-78"></a>This example shows the attaching of a submirror, <tt>d70</tt>, to a one-way mirror,
<tt>d30</tt>. You create a two-way mirror when your attach the submirror to the
mirror. The mirror <tt>d30</tt> initially consists of submirror <tt>d60</tt>. The submirror <tt>d70</tt> is a
RAID-0 volume. You verify that the status of the mirror is &ldquo;Okay&rdquo; with
the <tt>metastat</tt> command, then attach the submirror. When the <tt>metattach</tt> command is run,
the new submirror is resynchronized with the existing mirror. When you attach an
additional submirror to the mirror, the system displays a message. To verify that
the mirror is resynchronizing, use the <tt>metastat</tt> command.  </p>

<a name="tasks-mirrors-10"></a><h4>How to Detach a Submirror</h4><h6>Before You Begin</h6><p>Read <a href="eyaso.html">Creating and Maintaining RAID-1 Volumes</a>.</p><ol>
<li><a name="tasks-mirrors-step-142"></a><b>Make sure that you have root privilege. Make sure that you have a
current backup of all data.</b></li>
<li><b>Verify that the status of the mirror you want to work with
is in an &ldquo;Okay&rdquo; state using the <tt>metastat</tt> command.</b></li>
<li><a name="tasks-mirrors-step-82"></a><b>Use one of the following methods to detach a submirror. </b>
<ul><li><p>From the Enhanced Storage tool within the Solaris Management Console, open the Volumes node. Choose the mirror. Then, choose Action&rArr;Properties and click the Submirror tab. Follow the onscreen instructions. For more information, see the online help.</p></li>
<li><p>Use the <tt>metadetach</tt> command to detach a submirror from a mirror. </p><pre># <tt><b>metadetach </tt><i>mirror</i><tt> </tt><i>submirror</i><tt></b></tt></pre><p>See the <a href="http://docs.sun.com/doc/819-2240/metadetach-1m?a=view"><tt>metadetach</tt>(1M)</a> man page for more information.</p></li></ul>
</li></ol><a name="egjxr"></a>Example&nbsp;11-8 Detaching a Submirror<pre># <tt><b>metastat</b></tt>
d5: mirror
    Submirror 0: d50
...
# <tt><b>metadetach d5 d50</b></tt>
d5: submirror d50 is detached</pre><p><a name="indexterm-79"></a>In this example, mirror <tt>d5</tt> has a submirror, <tt>d50</tt>. You detach the
submirror with the <tt>metadetach</tt> command. The underlying slices from <tt>d50</tt> can be reused
elsewhere. After the submirror is detached from the mirror, the system displays a
confirmation message.</p>

<a name="tasks-mirrors-12"></a><h4>How to Place a Submirror Offline and Online</h4><p>The <tt>metaonline</tt> command can only be used when a submirror was taken offline
by the <tt>metaoffline</tt> command. After the <tt>metaonline</tt> command runs, Solaris Volume Manager
automatically begins resynchronizing the submirror with the mirror. </p>
<hr><p><b>Note - </b>The <tt>metaoffline</tt> command's capabilities are similar to the capabilities offered by the <tt>metadetach</tt>
command. However, the <tt>metaoffline</tt> command does not sever the logical association between the submirror
and the mirror.</p>
<hr>
<h6>Before You Begin</h6><p>Read <a href="eyaso.html">Creating and Maintaining RAID-1 Volumes</a>.</p><ol>
<li><a name="tasks-mirrors-step-143"></a><b>Make sure that you have root privilege and that you have a current
backup of all data.</b></li>
<li><a name="tasks-mirrors-step-85"></a><b>Use one of the following methods to place a submirror online or offline.</b>
<ul><li><p>From the Enhanced Storage tool within the Solaris Management Console, open the Volumes node. Choose the mirror. Then, choose Action&rArr;Properties and click the Submirror tab. Follow the onscreen instructions . For more information, see the online help.</p></li>
<li><p>Use the <tt>metaoffline</tt> command to a submirror offline.</p><pre># <tt><b>metaoffline </tt><i>mirror</i><tt> </tt><i>submirror</i><tt></b></tt></pre><p>See the <a href="http://docs.sun.com/doc/819-2240/metaoffline-1m?a=view"><tt>metaoffline</tt>(1M)</a> man page for more information.</p></li>
<li><p>Use the <tt>metaonline</tt> command to place a submirror online. </p><pre># <tt><b>metaonline </tt><i>mirror</i><tt> </tt><i>submirror</i><tt></b></tt></pre><p>See the <a href="http://docs.sun.com/doc/819-2240/metaonline-1m?a=view"><tt>metaonline</tt>(1M)</a> man page for more information.</p></li></ul>
</li></ol><a name="egjye"></a>Example&nbsp;11-9 Placing a Submirror Offline<pre># <tt><b>metaoffline d10 d11</b></tt>
d10: submirror d11 is offlined</pre><p><a name="indexterm-80"></a>In this example, submirror <tt>d11</tt> is taken offline from mirror <tt>d10</tt>. Reads continue
to be made from the other submirror. The mirror is out of sync
as soon as the first write is made. This inconsistency is corrected when
the offlined submirror is brought back online. </p><a name="egjyx"></a>Example&nbsp;11-10 Placing a Submirror Online<pre># <tt><b>metaonline d10 d11</b></tt>d10: submirror d11 is onlined</pre><p>In this example, submirror <tt>d11</tt> is brought back online in mirror <tt>d10</tt>.</p>

<a name="maintaintasksnew-14061"></a><h4>How to Enable a Slice in a Submirror</h4><h6>Before You Begin</h6><p>Read <a href="replace-enable-1.html">Overview of Replacing and Enabling Components in RAID-1 and RAID-5 Volumes</a> and <a href="eyaso.html">Creating and Maintaining RAID-1 Volumes</a>.</p><ol>
<li><a name="tasks-mirrors-step-144"></a><b>Make sure that you have root privilege and that you have a current
backup of all data.</b></li>
<li><a name="tasks-mirrors-step-89"></a><b>Use one of the following methods to enable a slice in a submirror.</b>
<ul><li><p>From the Enhanced Storage tool within the Solaris Management Console, open the Volumes node. Choose the mirror. Then, choose Action&rArr;Properties and click the Submirror tab. Follow the onscreen instructions. For more information, see the online help.</p></li>
<li><p>Use the <tt>metareplace</tt> command to enable a failed slice in a submirror. </p><pre># <tt><b>metareplace -e </tt><i>mirror</i><tt> </tt><i>failed-slice</i><tt></b></tt> </pre><p><a name="maintaintasksnew-ix232"></a>The <tt>metareplace</tt> command automatically starts a resynchronization to synchronize the repaired or replaced slice with the rest of the mirror. </p><p>See the <a href="http://docs.sun.com/doc/819-2240/metareplace-1m?a=view"><tt>metareplace</tt>(1M)</a> man page for more information.</p></li></ul>
</li></ol><a name="egjyv"></a>Example&nbsp;11-11 Enabling a Slice in a Submirror<pre># <tt><b>metareplace -e d11 c1t4d0s7</b></tt>
d11: device c1t4d0s7 is enabled</pre><p><a name="maintaintasksnew-ix233"></a>In this example, the mirror <tt>d11</tt> has a submirror that contains slice, <tt>c1t4d0s7</tt>,
which had a soft error. The <tt>metareplace</tt> command with the <tt>-e</tt> option enables the
failed slice. </p><p><a name="maintaintasksnew-ix234"></a>If a physical disk is defective, you can replace it with another available
disk (and its slices) on the system as documented in <a href="tasks-mirrors-25.html#maintaintasksnew-11508">How to Replace a Slice in a Submirror</a>. Alternatively, you
can repair or replace the disk, format it, and then run the <tt>metareplace</tt>
command with the <tt>-e</tt> option as shown in this example. </p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="tasks-mirrors-21.html">Previous</a>
             </td>
             <td align="right">
                 <a href="tasks-mirrors-24.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

