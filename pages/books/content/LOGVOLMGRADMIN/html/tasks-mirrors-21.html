<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Creating a RAID-1 Volume - Solaris Volume Manager Administration Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2006-06-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">Solaris Volume Manager Administration Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="fpjwe.html">Previous</a>
             </td>
             <td align="right">
                 <a href="tasks-mirrors-23.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="roadmap-10.html">1.&nbsp;&nbsp;Getting Started With Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="storage-overview-1.html">2.&nbsp;&nbsp;Storage Management Concepts</a></p>
<p class="toc level1 tocsp"><a href="basics-23185.html">3.&nbsp;&nbsp;Solaris Volume Manager Overview</a></p>
<p class="toc level1 tocsp"><a href="eoqra.html">4.&nbsp;&nbsp;Solaris Volume Manager for Sun Cluster (Overview)</a></p>
<p class="toc level1 tocsp"><a href="svm-scenario-1.html">5.&nbsp;&nbsp;Configuring and Using Solaris Volume Manager (Scenario)</a></p>
<p class="toc level1 tocsp"><a href="about-state-db-replicas-1.html">6.&nbsp;&nbsp;State Database (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-state-db-replicas-1.html">7.&nbsp;&nbsp;State Database (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-metadevices-22802.html">8.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-metadevices-1.html">9.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-mirrors-2.html">10.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-mirrors-1.html">11.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Tasks)</a></p>
<p class="toc level2"><a href="fpjwe.html">RAID-1 Volumes (Task Map)</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Creating a RAID-1 Volume</a></p>
<p class="toc level3"><a href="#addtasks-12543">How to Create a RAID-1 Volume From Unused Slices</a></p>
<p class="toc level3"><a href="#addtasks-18898">How to Create a RAID-1 Volume From a File System</a></p>
<p class="toc level3"><a href="#frkdb">SPARC: How to Create a RAID-1 Volume From the root (<tt>/</tt>) File System</a></p>
<p class="toc level3"><a href="#gcsdr">x86: How to Create a RAID-1 Volume From the root (<tt>/</tt>) File System</a></p>
</div>
<p class="toc level2 tocsp"><a href="tasks-mirrors-23.html">Working With Submirrors</a></p>
<p class="toc level3"><a href="tasks-mirrors-23.html#tasks-mirrors-8">How to Attach a Submirror</a></p>
<p class="toc level3"><a href="tasks-mirrors-23.html#tasks-mirrors-10">How to Detach a Submirror</a></p>
<p class="toc level3"><a href="tasks-mirrors-23.html#tasks-mirrors-12">How to Place a Submirror Offline and Online</a></p>
<p class="toc level3"><a href="tasks-mirrors-23.html#maintaintasksnew-14061">How to Enable a Slice in a Submirror</a></p>
<p class="toc level2 tocsp"><a href="tasks-mirrors-24.html">Maintaining RAID-1 Volumes</a></p>
<p class="toc level3"><a href="tasks-mirrors-24.html#maintaintasksnew-34973">How to View the Status of Mirrors and Submirrors</a></p>
<p class="toc level3"><a href="tasks-mirrors-24.html#tasks-mirrors-15">How to Change RAID-1 Volume Options</a></p>
<p class="toc level3"><a href="tasks-mirrors-24.html#maintaintasksnew-15601">How to Expand a RAID-1 Volume</a></p>
<p class="toc level3"><a href="tasks-mirrors-24.html#fpklu">How to Cancel a Volume Resynchronization Process</a></p>
<p class="toc level3"><a href="tasks-mirrors-24.html#fpkkx">How to Resume a Volume Resynchronization Process</a></p>
<p class="toc level2 tocsp"><a href="tasks-mirrors-25.html">Responding to RAID-1 Volume Component Failures</a></p>
<p class="toc level3"><a href="tasks-mirrors-25.html#maintaintasksnew-11508">How to Replace a Slice in a Submirror</a></p>
<p class="toc level3"><a href="tasks-mirrors-25.html#maintaintasksnew-10199">How to Replace a Submirror</a></p>
<p class="toc level2 tocsp"><a href="tasks-mirrors-26.html">Removing RAID-1 Volumes (Unmirroring)</a></p>
<p class="toc level3"><a href="tasks-mirrors-26.html#tasks-mirrors-3">How to Unmirror a File System</a></p>
<p class="toc level3"><a href="tasks-mirrors-26.html#tasks-mirrors-5">How to Unmirror a File System That Cannot Be Unmounted</a></p>
<p class="toc level2 tocsp"><a href="tasks-mirrors-27.html">Backing Up Data on a RAID-1 Volume</a></p>
<p class="toc level3"><a href="tasks-mirrors-27.html#tipsandtricks-36804">How to Perform an Online Backup of a RAID-1 Volume</a></p>
<p class="toc level1 tocsp"><a href="about-softpart-1.html">12.&nbsp;&nbsp;Soft Partitions (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-softpart-1.html">13.&nbsp;&nbsp;Soft Partitions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-raid5-1.html">14.&nbsp;&nbsp;RAID-5 Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-raid5-1.html">15.&nbsp;&nbsp;RAID-5 Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-hotspares-40444.html">16.&nbsp;&nbsp;Hot Spare Pools (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-hotspares-1.html">17.&nbsp;&nbsp;Hot Spare Pools (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-disksets-31856.html">18.&nbsp;&nbsp;Disk Sets (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-disksets-1.html">19.&nbsp;&nbsp;Disk Sets (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-basics-2.html">20.&nbsp;&nbsp;Maintaining Solaris Volume Manager (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="best-practices-1.html">21.&nbsp;&nbsp;Best Practices for Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="topdown-overview.html">22.&nbsp;&nbsp;Top-Down Volume Creation (Overview)</a></p>
<p class="toc level1 tocsp"><a href="topdown-tasks-chap.html">23.&nbsp;&nbsp;Top-Down Volume Creation (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-snmp-1.html">24.&nbsp;&nbsp;Monitoring and Error Reporting (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="troubleshoottasks-33506.html">25.&nbsp;&nbsp;Troubleshooting Solaris Volume Manager (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="appendfiles-1.html">A.&nbsp;&nbsp;Important Solaris Volume Manager Files</a></p>
<p class="toc level1 tocsp"><a href="quick-reference-1.html">B.&nbsp;&nbsp;Solaris Volume Manager Quick Reference</a></p>
<p class="toc level1 tocsp"><a href="append-cim-wbem-1.html">C.&nbsp;&nbsp;Solaris Volume Manager CIM/WBEM API</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="tasks-mirrors-21"></a><h3>Creating a RAID-1 Volume</h3>
<a name="indexterm-72"></a><a name="indexterm-73"></a>

<a name="addtasks-12543"></a><h4>How to Create a RAID-1 Volume From Unused Slices</h4><p>This procedure shows you how to create a two-way mirror. If you
want to create a three-way mirror or a four-way mirror, use the same
procedure.</p><h6>Before You Begin</h6><p>Check <a href="addtasks-1.html#addtasks-20933">Prerequisites for Creating Solaris Volume Manager Components</a> and <a href="eyaso.html">Creating and Maintaining RAID-1 Volumes</a>.</p><ol>
<li><a name="tasks-mirrors-step-30"></a><b>Create two stripes or concatenations. These components become the submirrors.</b><p>See <a href="tasks-metadevices-20.html#tasks-metadevices-21">How to Create a RAID-0 (Stripe) Volume</a> or <a href="tasks-metadevices-25.html#addtasks-17877">How to Create a RAID-0 (Concatenation) Volume</a>.</p></li>
<li><a name="tasks-mirrors-step-31"></a><b>To create the mirror, use one of the following methods:</b>
<ul><li><p>From the Enhanced Storage tool within the Solaris Management Console, open the Volumes node, then choose Action&rArr;Create Volume and follow the onscreen instructions. For more information, see the online help.</p></li>
<li><p>Use the following form of the <tt>metainit</tt> command to create a one-way mirror:</p><pre># <tt><b>metainit </tt><i>volume-name</i><tt> -m </tt><i>submirror-name</i><tt></b></tt></pre><dl><dt><i>volume-name</i></dt>
<dd><p>Specifies the name of the volume to create</p></dd>
<dt><tt>-m</tt></dt>
<dd><p>Specifies to create a mirror</p></dd>
<dt><i>submirror-name</i></dt>
<dd><p>Specifies the name of the component that will be the first submirror in the mirror</p></dd>
</dl>
<p>See the following examples and the <a href="http://docs.sun.com/doc/819-2240/metainit-1m?a=view"><tt>metainit</tt>(1M)</a> man page for more information.</p></li></ul>
</li>
<li><a name="tasks-mirrors-step-31a"></a><b>To add the second submirror, use one of the following methods:</b>
<ul><li><p>From the Enhanced Storage tool within the Solaris Management Console, open the Volumes node, then choose the mirror you want to modify. Choose Action&rArr;Properties, then the Submirrors. Follow the onscreen instructions to attach the submirror. For more information, see the online help.</p></li>
<li><p>Use the following form of the <tt>metattach</tt> command:</p><pre># <tt><b>metattach </tt><i>volume-name</i><tt> </tt><i>submirror-name</i><tt></b></tt></pre><dl><dt><i>volume-name</i></dt>
<dd><p>Specifies the name of the RAID-1 volume on which to add the submirror</p></dd>
<dt><i>submirror-name</i></dt>
<dd><p>Specifies the name of the component that will be the second submirror attached to the mirror</p></dd>
</dl>
<p>See the following examples and the <a href="http://docs.sun.com/doc/819-2240/metattach-1m?a=view"><tt>metattach</tt>(1M)</a> man page for more information.</p></li></ul>
</li></ol><a name="egjxo"></a>Example&nbsp;11-1 Creating a Two-Way Mirror<pre># <tt><b>metainit d51 1 1 c0t0d0s2</b></tt>
d51: Concat/Stripe is setup
# <tt><b>metainit d52 1 1 c1t0d0s2</b></tt>
d52: Concat/Stripe is setup
# <tt><b>metainit d50 -m d51</b></tt>
d50: Mirror is setup
# <tt><b>metattach d50 d52</b></tt>
d50: Submirror d52 is attached</pre><p>This example shows you how to create the two-way mirror, <tt>d50</tt>. The <tt>metainit</tt>
command creates two submirrors (<tt>d51</tt> and <tt>d52</tt>), which are RAID-0 volumes. The
<tt>metainit</tt> <tt>-m</tt> command creates the one-way mirror from the <tt>d51</tt> RAID-0 volume. The
<tt>metattach</tt> command attaches <tt>d52</tt>, creating a two-way mirror and causing a resynchronization. Any
data on the attached submirror is overwritten by the other submirror during the
resynchronization. </p><a name="egjxk"></a>Example&nbsp;11-2 Creating a Two-Way Mirror Without Resynchronization<pre># <tt><b>metainit d51 1 1 c0t0d0s2</b></tt>
d51: Concat/Stripe is setup
# <tt><b>metainit d52 1 1 c1t0d0s2</b></tt>
d52: Concat/Stripe is setup
# <tt><b>metainit d50 -m d51 d52</b></tt>
metainit: d50: WARNING: This form of metainit is not recommended.
The submirrors may not have the same data.
Please see ERRORS in metainit(1M) for additional information.
d50: Mirror is setup</pre><p>This example shows the creation a two-way mirror, <tt>d50</tt>. The <tt>metainit</tt> command creates
two submirrors (<tt>d51</tt> and <tt>d52</tt>), which are RAID-0 volumes. The <tt>metainit</tt> <tt>-m</tt>
command is then run with both submirrors to create the mirror. When you
create a mirror using the <tt>metainit</tt> command rather than the <tt>metattach</tt> command ,
no resynchronization operations occur. As a result, data could become corrupted when Solaris
Volume Manager assumes that both sides of the mirror are identical and can
be used interchangeably.</p><h6>See Also</h6><p>To prepare a newly created mirror for a file system, see <a href="http://docs.sun.com/doc/819-2723/fscreate-96442?a=view">Chapter 18, Creating UFS, TMPFS, and LOFS File Systems (Tasks), in <i>System Administration Guide: Devices and File Systems</i></a>. Some
applications, such as a database, do not use a file system. These
applications instead use the raw device. The application must have its own way
of accessing the raw device.</p>

<a name="addtasks-18898"></a><h4>How to Create a RAID-1 Volume From a File System</h4><a name="indexterm-74"></a><p>Use this procedure to mirror an existing file system. If the file
system can be unmounted, the entire procedure can be completed without a reboot. For
file systems that cannot be unmounted, such as <tt>/usr</tt> and <tt>/swap</tt>, the
system must be rebooted to complete the procedure.</p><p>When creating a RAID-1 volume from an existing file system built on a
slice, only the single slice may be included in the primary RAID-0
volume (submirror). If you are mirroring system-critical file systems, all submirrors must consist of
only a single slice. </p><p>For the procedures associated with mirroring the root (/) file system, see <a href="#frkdb">SPARC: How to Create a RAID-1 Volume From the root (<tt>/</tt>) File System</a>
and <a href="#gcsdr">x86: How to Create a RAID-1 Volume From the root (<tt>/</tt>) File System</a>.</p><p>In the example used in this procedure, the existing slice is <tt>c1t0d0s0</tt>.
The second slice, <tt>c1t1d0s0</tt>, is available for the second half of the mirror.
The submirrors are <tt>d1</tt> and <tt>d2</tt>, respectively, and the mirror is <tt>d0</tt>.
</p>
<hr><p><b>Caution - </b>Be sure to create a one-way mirror with the <tt>metainit</tt> command then attach
the additional submirrors with the <tt>metattach</tt> command. When the <tt>metattach</tt> command is not
used, no resynchronization operations occur. As a result, data could become corrupted when
Solaris Volume Manager assumes that both sides of the mirror are identical and
can be used interchangeably. </p>
<hr>
<h6>Before You Begin</h6><p>Check <a href="addtasks-1.html#addtasks-20933">Prerequisites for Creating Solaris Volume Manager Components</a> and <a href="eyaso.html">Creating and Maintaining RAID-1 Volumes</a>.</p><ol>
<li><a name="tasks-mirrors-step-35"></a><b>Identify the slice that contains the existing file system to be mirrored This
example uses the slice <tt>c1t0d0s0</tt>.</b></li>
<li><a name="tasks-mirrors-step-132"></a><b>Create a new RAID-0 volume on the slice from the previous step by
using one of the following methods:</b>
<ul><li><p>From the Enhanced Storage tool within the Solaris Management Console, open the Volumes node, then choose Action&rArr;Create Volume. Follow the onscreen instructions . For more information, see the online help.</p></li>
<li><p>Use the following form of the <tt>metainit</tt> command:</p><pre># <tt><b>metainit -f </tt><i>volume-name</i><tt> </tt><i>number-of-stripes</i><tt> </tt><i>components-per-stripe</i><tt> </tt><i>component-name</i><tt></b></tt></pre><dl><dt><tt>-f</tt></dt>
<dd><p>Forces the command to continue. You must use this option when the slice contains a mounted file system.</p></dd>
<dt><i>volume-name</i></dt>
<dd><p>Specifies the name of the volume to create. For information on naming volumes, see <a href="basics-42385.html#basics-34">Volume Names</a>.</p></dd>
<dt><i>number-of-stripes</i></dt>
<dd><p>Specifies the number of stripes to create.</p></dd>
<dt><i>components-per-stripe</i></dt>
<dd><p>Specifies the number of components each stripe should have.</p></dd>
<dt><i>component-names</i></dt>
<dd><p>Specifies the names of the components that are used. This example uses the root slice, <tt>c0t0d0s0</tt>.</p></dd>
</dl>
</li></ul>
</li>
<li><a name="tasks-mirrors-step-126"></a><b>Create a second RAID-0 volume (concatenation) on an unused slice (<tt>c1t1d0s0</tt> in this
example) to act as the second submirror. The second submirror must be the
same size as the original submirror or larger. Use one of the following
methods:</b>
<ul><li><p>From the Enhanced Storage tool within the Solaris Management Console, open the Volumes node, then choose Action->Create Volume and follow the instructions on screen. For more information, see the online help.</p></li>
<li><p>Use the following form of the <tt>metainit </tt> command.</p><pre># <tt><b>metainit </tt><i>volume-name</i><tt> </tt><i>number-of-stripes</i><tt> </tt><i>components-per-stripe</i><tt> </tt><i>component-name</i><tt></b></tt></pre>
<hr><p><b>Note - </b>See Step 2 for an explanation of the options.</p>
<hr>
</li></ul>
</li>
<li><a name="tasks-mirrors-step-127"></a><b>Create a one-way mirror by using one of the following methods:</b>
<ul><li><p>From the Enhanced Storage tool within the Solaris Management Console, open the Volumes node, then choose Action&rArr;Create Volume. Follow the onscreen instructions . For more information, see the online help.</p></li>
<li><p>Use the following form of the <tt>metainit </tt> command.</p><pre># <tt><b>metainit </tt><i>volume-name</i><tt> -m </tt><i>submirror-name</i><tt></b></tt></pre><dl><dt><i>volume-name</i></dt>
<dd><p>Specifies the name of the volume to create.</p></dd>
<dt><tt>-m</tt></dt>
<dd><p>Specifies to create a mirror.</p></dd>
<dt><i>submirror-name</i></dt>
<dd><p>Specifies the name of the component that will be the first submirror in the mirror. In this example, it is the RAID-0 volume that contains the root slice.</p></dd>
</dl>
</li></ul>
<p>See the <a href="http://docs.sun.com/doc/819-2240/metainit-1m?a=view"><tt>metainit</tt>(1M)</a> man page for more information.</p>
<hr><p><b>Caution - </b>When you create a mirror from an existing file system, you must follow
the next two steps precisely to avoid data corruption. </p>
<hr>
</li>
<li><b>Edit the <tt>/etc/vfstab</tt> file so that the file system mount instructions refer to
the mirror, not to the block device. For more information about the<tt>/etc/vfstab</tt> file,
see <a href="http://docs.sun.com/doc/819-2723/fsmount-5?a=view">Mounting File Systems in <i>System Administration Guide: Devices and File Systems</i></a>.</b><p>For example, if the <tt>/etc/vfstab file</tt> contains the following entry for the file system:</p><pre>/dev/dsk/<i>slice</i> /dev/rdsk/<i>slice</i> /var ufs 2 yes -</pre><p>Change the entry to read as follows:</p><pre>/dev/md/dsk/<i>mirror-name</i> /dev/md/rdsk/<i>mirror-name</i> /var ufs 2 yes -</pre></li>
<li><a name="tasks-mirrors-step-39"></a><b>Remount your newly mirrored file system according to one of the following procedures:</b>
<ul><li><p>If you are mirroring a file system that can be unmounted, then unmount and remount the file system.</p><pre># <tt><b>umount </tt><i>/filesystem</i><tt></b></tt>
# <tt><b>mount </tt><i>/filesystem</i><tt></b></tt></pre></li>
<li><p>If you are mirroring a file system that cannot be unmounted, then reboot your system.</p><pre># <tt><b>reboot</b></tt></pre></li></ul>
</li>
<li><a name="tasks-mirrors-step-42"></a><b><a name="addtasks-ix70"></a>Use the following form of the <tt>metattach</tt> command to attach the second submirror.
</b><pre># <tt><b>metattach </tt><i>volume-name</i><tt> </tt><i>submirror-name</i><tt></b></tt></pre><dl><dt><i>volume-name</i></dt>
<dd><p>Specifies the name of the RAID-1 volume on which to add the submirror</p></dd>
<dt><i>submirror-name</i></dt>
<dd><p>Specifies the name of the component that will be the second submirror attached to the mirror</p></dd>
</dl>
<p>See the <a href="http://docs.sun.com/doc/819-2240/metattach-1m?a=view"><tt>metattach</tt>(1M)</a> man page for more information.</p></li></ol><a name="egjxl"></a>Example&nbsp;11-3 Creating a Two-Way Mirror From a File System That Can Be Unmounted<pre># <tt><b>metainit -f d1 1 1 c1t0d0s0</b></tt>
d1: Concat/Stripe is setup
# <tt><b>metainit d2 1 1 c1t1d0s0</b></tt>
d2: Concat/Stripe is setup
# <tt><b>metainit d0 -m d1</b></tt>
d0: Mirror is setup
# <tt><b>umount /master</b></tt>
(Edit the /etc/vfstab file so that the file system references the mirror)
# <tt><b>mount /master</b></tt>
# <tt><b>metattach d0 d2</b></tt>
d0: Submirror d2 is attached</pre><p><a name="addtasks-ix71"></a>In this example, the <tt>-f</tt> option forces the creation of the first concatenation,
<tt>d1</tt>, which contains the mounted file system <tt>/master</tt> on <tt>/dev/dsk/c1t0d0s0</tt>. The second concatenation, <tt>d2</tt>,
is created from <tt>/dev/dsk/c1t1d0s0</tt>. This slice must be the same size as
, or larger than the size of <tt>d1</tt>.) The <tt>metainit</tt> command with the <tt>-m</tt>
option creates the one-way mirror, <tt>d0</tt>, from <tt>d1</tt>. </p><p>Next, the entry for the file system should be changed in the
<tt>/etc/vfstab</tt> file to reference the mirror. The following line in the <tt>/etc/vfstab</tt>
file initially appears as follows:</p><pre>/dev/dsk/<b>c1t0d0s0</b> /dev/rdsk/<b>c1t0d0s0</b> /var ufs 2 yes -</pre><p>The entry is changed to the following: </p><pre>/dev/md/dsk/<b>d0</b> /dev/md/rdsk/<b>d0</b> /var ufs 2 yes -</pre><p>Finally, the file system is remounted and submirror <tt>d2</tt> is attached to the
mirror, causing a mirror resynchronization. The system confirms that the RAID-0 and RAID-1
volumes are set up, and that submirror <tt>d2</tt> is attached.</p><a name="egjxp"></a>Example&nbsp;11-4 Creating a Two-way Mirror From a File System That Cannot Be Unmounted<pre># <tt><b>metainit -f d12 1 1 c0t3d0s6</b></tt>
d12: Concat/Stripe is setup
# <tt><b>metainit d22 1 1 c1t0d0s6</b></tt>
d22: Concat/Stripe is setup
# <tt><b>metainit d2 -m d12</b></tt>
d2: Mirror is setup
(Edit the /etc/vfstab file so that /usr references the mirror)
# <tt><b>reboot</b></tt>
...
# <tt><b>metattach d2 d22</b></tt>
d2: Submirror d22 is attached</pre><p>This example creates a two-way mirror using a slice containing the <tt>/usr</tt>
file system. The <tt>-f</tt> option forces the creation of the first concatenation, <tt>d12</tt>,
which contains the mounted file system <tt>/usr</tt> on <tt>/dev/dsk/c0t3d0s6</tt>. The second concatenation, <tt>d22</tt>, is
created from <tt>/dev/dsk/c1t0d0s6</tt>. This slice must be the same size as, or
larger than the size of <tt>d12</tt>. The <tt>metainit</tt> command with the <tt>-m</tt> option creates
the one-way mirror <tt>d2</tt> using the concatenation that contains the <tt>/usr</tt> file system. Next,
the <tt>/etc/vfstab</tt> file must be edited to change the entry for <tt>/usr</tt> to
reference the mirror.</p><p>The <tt>/etc/vfstab file</tt> contains the following entry for the <tt>/usr</tt> file system:</p><pre>/dev/dsk/c0t3d0s6 /dev/rdsk/c0t3d0s6 /usr ufs 1 yes -</pre><p>Change the entry to read as follows:</p><pre>/dev/md/dsk/d2 /dev/md/rdsk/d2 /usr ufs 1 yes -</pre><p><a name="addtasks-ix76"></a>After a reboot, the second submirror <tt>d22</tt> is attached to the mirror, causing
a mirror resynchronization.</p><a name="egjxq"></a>Example&nbsp;11-5 Creating a Mirror From the <tt>/swap</tt> Space<pre># <tt><b>metainit -f d11 1 1 c0t0d0s1</b></tt>
d11: Concat/Stripe is setup
# <tt><b>metainit d21 1 1 c1t0d0s1</b></tt>
d21: Concat/Stripe is setup
# <tt><b>metainit d1 -m d11</b></tt>
d1: Mirror is setup
(Edit the /etc/vfstab file so that swap references the mirror)
# <tt><b>reboot</b></tt>
...
# <tt><b>metattach d1 d21</b></tt>
d1: Submirror d21 is attached</pre><p>In this example, the <tt>-f</tt> option forces the creation of the first concatenation,
<tt>d11</tt>, which contains the mounted file system <tt>swap</tt> on <tt>/dev/dsk/c0t0d0s1</tt>. The second concatenation, <tt>d21</tt>,
is created from <tt>/dev/dsk/c1t0d0s1</tt>. This slice must be the same size as,
or larger than the size of <tt>d11</tt>. The <tt>metainit</tt> command with the <tt>-m</tt> option
creates the one-way mirror <tt>d1</tt> using the concatenation that contains <tt>swap</tt>. Next, if
there is an entry for <tt>swap</tt> in the <tt>/etc/vfstab</tt> file, it must be edited
to reference the mirror.</p><p>The <tt>/etc/vfstab file</tt> contains the following entry for the <tt>swap</tt> space:</p><pre>/dev/dsk/c0t0d0s1 - - swap - no -</pre><p>Change the entry to read as follows:</p><pre>/dev/md/dsk/d1 - - swap - no -</pre><p>After a reboot, the second submirror <tt>d21</tt> is attached to the mirror, causing
a mirror resynchronization.</p><p>To save the crash dump when you have mirrored the <tt>swap</tt> space, use
the <tt>dumpadm</tt> command to configure the dump device as a volume. For instance,
if the swap device is named <tt>/dev/md/dsk/d2</tt>, use the <tt>dumpadm</tt> command to set
this device as the dump device.</p>

<a name="frkdb"></a><h4>SPARC: How to Create a RAID-1 Volume From the root (<tt>/</tt>) File System</h4><a name="indexterm-75"></a><p>The process for mirroring the root (<tt>/</tt>) file system on a SPARC platform
is similar to mirroring any other file system that you cannot unmount. The
procedure differs in that the <tt>metaroot</tt> command is run instead of manually editing
the <tt>/etc/vfstab</tt> file. Mirroring the root (<tt>/</tt>) file system also requires recording the path
to the alternate boot device. This device reboots the system if the submirror
fails.</p><p>In the example used in this procedure, the existing slice is <tt>c1t0d0s0</tt>.
The second slice, <tt>c1t1d0s0</tt>, is available for the second half of the mirror.
The submirrors are <tt>d1</tt> and <tt>d2</tt>, respectively, and the mirror is <tt>d0</tt>.
</p>
<hr><p><b>Caution - </b>Be sure to create a one-way mirror with the <tt>metainit</tt> command then attach
the additional submirrors with the <tt>metattach</tt> command. When the <tt>metattach</tt> command is not
used, no resynchronization operations occur. As a result, data could become corrupted when
Solaris Volume Manager assumes that both sides of the mirror are identical and
can be used interchangeably. </p>
<hr>
<h6>Before You Begin</h6><p>Check <a href="addtasks-1.html#addtasks-20933">Prerequisites for Creating Solaris Volume Manager Components</a> and <a href="eyaso.html">Creating and Maintaining RAID-1 Volumes</a>.</p><ol>
<li><b>Identify the slice that contains the existing root (<tt>/</tt>) file system to be
mirrored. This example uses the slice <tt>c1t0d0s0</tt>.</b></li>
<li><b>Create a new RAID-0 volume on the slice from the previous step by
using one of the following methods. Only the single slice can be
included in the RAID-0 volume.</b>
<ul><li><p>From the Enhanced Storage tool within the Solaris Management Console, open the Volumes node, then choose Action&rArr;Create Volume. Follow the onscreen instructions . For more information, see the online help.</p></li>
<li><p>Use the following form of the <tt>metainit</tt> command:</p><pre># <tt><b>metainit -f </tt><i>volume-name</i><tt> </tt><i>number-of-stripes</i><tt> </tt><i>components-per-stripe</i><tt> </tt><i>component-name</i><tt></b></tt></pre><dl><dt><tt>-f</tt></dt>
<dd><p>Forces the command to continue. You must use this option when the slice contains a mounted file system.</p></dd>
<dt><i>volume-name</i></dt>
<dd><p>Specifies the name of the volume to create. For information on naming volumes, see <a href="basics-42385.html#basics-34">Volume Names</a>.</p></dd>
<dt><i>number-of-stripes</i></dt>
<dd><p>Specifies the number of stripes to create.</p></dd>
<dt><i>components-per-stripe</i></dt>
<dd><p>Specifies the number of components each stripe should have.</p></dd>
<dt><i>component-names</i></dt>
<dd><p>Specifies the names of the components that are used. This example uses the root slice, <tt>c0t0d0s0</tt>.</p></dd>
</dl>
</li></ul>
</li>
<li><b>Create a second RAID-0 volume on an unused slice (<tt>c1t1d0s0</tt> in this example)
to act as the second submirror. The secondary submirror must be the same
size as the original submirror, or larger. Use one of the following methods:</b>
<ul><li><p>From the Enhanced Storage tool within the Solaris Management Console, open the Volumes node, then choose Action->Create Volume and follow the instructions on screen. For more information, see the online help.</p></li>
<li><p>Use the following form of the <tt>metainit </tt> command.</p><pre># <tt><b>metainit </tt><i>volume-name</i><tt> </tt><i>number-of-stripes</i><tt> </tt><i>components-per-stripe</i><tt> </tt><i>component-name</i><tt></b></tt></pre>
<hr><p><b>Note - </b>See Step 2 for and explanation of the options.</p>
<hr>
</li></ul>
</li>
<li><b>Create a one-way mirror by using one of the following methods:</b>
<ul><li><p>From the Enhanced Storage tool within the Solaris Management Console, open the Volumes node, then choose Action&rArr;Create Volume. Follow the onscreen instructions . For more information, see the online help.</p></li>
<li><p>Use the following form of the <tt>metainit </tt> command.</p><pre># <tt><b>metainit </tt><i>volume-name</i><tt> -m </tt><i>submirror-name</i><tt></b></tt></pre><dl><dt><i>volume-name</i></dt>
<dd><p>Specifies the name of the volume to create.</p></dd>
<dt><tt>-m</tt></dt>
<dd><p>Specifies to create a mirror.</p></dd>
<dt><i>submirror-name</i></dt>
<dd><p>Specifies the name of the component that will be the first submirror in the mirror. In this example, it is the RAID-0 volume that contains the root slice.</p></dd>
</dl>
</li></ul>
</li>
<li><b>Remount your newly mirrored file system. Run the <tt>metaroot <i>volume-name</i></tt> command, replacing <i>volume-name</i>
with the name of the mirror you have created. Then, reboot your system.</b><pre># <tt><b>metaroot </tt><i>volume-name</i><tt></b></tt>
# <tt><b>reboot</b></tt></pre><p>For more information, see the <a href="http://docs.sun.com/doc/819-2240/metaroot-1m?a=view"><tt>metaroot</tt>(1M)</a> man page.</p></li>
<li><b><a name="frqvh"></a>Use the following form of the <tt>metattach</tt> command to attach the second submirror.
</b><pre># <tt><b>metattach </tt><i>volume-name</i><tt> </tt><i>submirror-name</i><tt></b></tt></pre><dl><dt><i>volume-name</i></dt>
<dd><p>Specifies the name of the RAID-1 volume on which to add the submirror</p></dd>
<dt><i>submirror-name</i></dt>
<dd><p>Specifies the name of the component that will be the second submirror attached to the mirror</p></dd>
</dl>
<p>See the <a href="http://docs.sun.com/doc/819-2240/metattach-1m?a=view"><tt>metattach</tt>(1M)</a> man page for more information.</p></li>
<li><b>Record the alternate boot path.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Determine the path to the alternate root device. Use the <tt>ls <tt>-l</tt></tt> command
on the slice that is being attached as the second submirror to the
root (<tt>/</tt>) file system mirror.</b><pre># <tt><b>ls -l /dev/dsk/c1t1d0s0</b></tt>
lrwxrwxrwx 1  root root  55 Mar 5 12:54  /dev/rdsk/c1t1d0s0 -> \ 
../../devices/sbus@1,f8000000/esp@1,200000/sd@3,0:a</pre></li>
<li><b>Record the string that follows the <tt>/devices</tt> directory: <tt>/sbus@1,f8000000/esp@1,200000/sd@3,0:a</tt>.</b>
<hr><p><b>Note - </b>Because the system might not be available, this information should also be written
down somewhere other than on the system. See <a href="troubleshoottasks-29.html">Recovering From Boot Problems</a> for details on booting
from the alternate boot device.</p>
<hr>
</li>
<li><b>Edit the string to change the major name (<tt>sd</tt>, in this case) to
<tt>disk</tt>, resulting in <tt>/sbus@1,f8000000/esp@1,200000/disk@3,0:a</tt>. If the system uses an IDE bus, the
original full path might look like </b><pre>$ <tt><b>ls -l /dev/dsk/c1t1d0s0</b></tt> 
lrwxrwxrwx 1 root root 38 Mar 13 15:03 /dev/dsk/c0t0d0s0 -> \
../../devices/pci@1f,0/ide@d/dad@0,0:a</pre><p>After changing the major name <tt>dad</tt> to <tt>disk</tt>, you would have <tt>/pci@1f,0/ide@d/disk@0,0:a</tt></p></li>
<li><b>Use the OpenBoot<sup>TM</sup> PROM <tt>nvalias</tt> command to define a &ldquo;backup root&rdquo; device alias
for the secondary root (<tt>/</tt>) file system mirror. For example:</b><pre>ok  <tt><b>nvalias backup_root /sbus@1,f8000000/esp@1,200000/disk@3,0:a</b></tt></pre></li>
<li><b>Redefine the <tt>boot-device</tt> alias to reference both the primary and secondary submirrors, in
the order in which you want them to be used, and store the
configuration.</b><pre>ok <tt><b>printenv boot-device</b></tt>
boot-device =         disk net
ok <tt><b>setenv boot-device disk backup_root net</b></tt>
boot-device =         disk backup_root net
ok <tt><b>nvstore</b></tt></pre></li></ol>
<hr><p><b>Note - </b>In the event that the primary submirror fails, the system would automatically boot
to the second submirror. Or, if you boot manually, rather than using autoboot,
you would enter:</p><pre>ok <tt><b>boot backup_root</b></tt></pre>
<hr>
</li></ol><a name="egjxm"></a>Example&nbsp;11-6 SPARC: Creating a Mirror From the root (<tt>/</tt>) File System<pre># <tt><b>metainit -f d1 1 1 c0t0d0s0</b></tt>
d1: Concat/Stripe is setup
# <tt><b>metainit d2 1 1 c0t1d0s0</b></tt>
d2: Concat/Stripe is setup
# <tt><b>metainit d0 -m d1</b></tt>
d0: Mirror is setup
# <tt><b>metaroot d0</b></tt>
# <tt><b>lockfs -fa</b></tt>
# <tt><b>reboot</b></tt>
...
# <tt><b>metattach d0 d2</b></tt>
d0: Submirror d2 is attached
# <tt><b>ls -l /dev/dsk/c0t1d0s0</b></tt>
lrwxrwxrwx   1 root     root          88 Feb  8 15:51 /dev/rdsk/c1t3d0s0 ->
../../devices/pci@1f,0/pci@1,1/ide@3/dad@0,0:a
# <tt><b>init 0</b></tt>
.
.
.
ok <tt><b>nvalias backup_root /pci@1f,0/pci@1,1/ide@3/disk@0,0:a</b></tt>
ok <tt><b>setenv boot-device disk backup_root net</b></tt>
ok <tt><b>nvstore</b></tt></pre><p>In this example, the <tt>-f</tt> option forces the creation of the first RAID-0
volume, <tt>d1</tt>, which contains the mounted root (<tt>/</tt>) file system on <tt>/dev/dsk/c0t0d0s0</tt>. The second
concatenation, <tt>d2</tt>, is created from <tt>/dev/dsk/c0t1d0s0</tt>. This slice must be the same
size as, or larger than the size of <tt>d1</tt>. The <tt>metainit</tt> command with
the <tt>-m</tt> option creates the one-way mirror <tt>d0</tt> using the concatenation that contains
root (<tt>/</tt>). </p><p>Next, the <tt>metaroot</tt> command edits the <tt>/etc/vfstab</tt> and <tt>/etc/system</tt> files so that
the system can be booted with the root (<tt>/</tt>) file system on a
volume. It is a good idea to run the <tt>lockfs <tt>-fa</tt></tt> command before rebooting. For
more information, see the <a href="http://docs.sun.com/doc/819-2240/lockfs-1m?a=view"><tt>lockfs</tt>(1M)</a> man page.</p><p>Do not attach the second submirror before the system is rebooted. You must
reboot after running the <tt>metaroot</tt> command and before attaching the second submirror.</p><p>After a reboot, the submirror <tt>d2</tt> is attached to the mirror, causing a
mirror resynchronization. The system confirms that the concatenations and the mirror are set
up, and that submirror <tt>d2</tt> is attached.</p><p>The <tt>ls <tt>-l</tt></tt> command is run on the root raw device to determine the
path to the alternate root device in case the system might later need
to be booted from it.</p>

<a name="gcsdr"></a><h4>x86: How to Create a RAID-1 Volume From the root (<tt>/</tt>) File System</h4><a name="indexterm-76"></a><p>The process for mirroring the root (<tt>/</tt>) file system on an x86 based
system is similar to mirroring root on a SPARC system. However, on x86
based systems, the BIOS and <tt>fdisk</tt> partitioning add an additional layer of complexity.</p><p>In the example used in the procedures, the existing slice is <tt>c1t0d0s0</tt>.
The second slice, <tt>c1t1d0s0</tt>, is available for the second half of the mirror.
The submirrors are <tt>d1</tt> and <tt>d2</tt>, respectively, and the mirror is <tt>d0</tt>.</p><h6>Before You Begin</h6><p>Before implementing any of the procedures, check <a href="addtasks-1.html#addtasks-20933">Prerequisites for Creating Solaris Volume Manager Components</a> and <a href="eyaso.html">Creating and Maintaining RAID-1 Volumes</a>.</p><ol>
<li><b>Verify that the ordering for the BIOS boot device can be configured to
allow the system to boot off of the second disk in the
mirror.</b><p>Before the kernel is started, the system is controlled by the read-only-memory (ROM) Basic
Input/Output System (BIOS), which is the firmware interface on an x86 based system.
The BIOS is analogous to the boot PROM on a SPARC based
system. Some of the BIOS's tasks are as follows:</p>
<ul><li><p>Perform startup functions.</p></li>
<li><p>Detect the correct device from which to boot the system.</p></li>
<li><p>Load the master boot record from that device to allow the system to self-boot.</p></li></ul>
<p>You can usually configure the BIOS to select the order of devices
to probe for the boot record. Additionally, most modern BIOS implementations allow you to
configure your devices so that the failover to the secondary submirror is automatic.
If your system's BIOS does not have this feature and the primary submirror
fails, you need to access the BIOS during system boot to reconfigure the
system to boot from the secondary root slice. Consult the user's guide for
your BIOS for instructions on how to configure settings in your BIOS</p><p>Before setting up a root mirror, check the BIOS on your system to
verify that you can boot off of more than one disk. Some
device drivers are configured to only see one disk on the system.</p></li>
<li><b>Verify that the <tt>fdisk</tt> partitions are configured to support root mirroring.</b><p>The existence of a separate x86 boot partition presents a problem when mirroring
the root (<tt>/</tt>) file system. Because it exists outside of the Solaris <tt>fdisk</tt>
partition, the x86 boot partition cannot be mirrored by Solaris Volume Manager. Additionally, because
only one copy of the x86 boot partition exists, it represents a single
point of failure.</p><p>The GRUB-based installation program of the Solaris 10 1/06 software and subsequent releases
no longer automatically creates an x86 boot partition. However, if the x86 already
exists in the system, the installation program preserves that partition by default.</p><p>To determine if your system has a separate x86 boot partition, check the
<tt>/etc/vfstab</tt> file. The x86 boot partition exists if the file contains an entry
similar to the following:</p><pre>/dev/dsk/c2t1d0p0:boot  -       /boot   pcfs    -       no      -</pre><p>To use the Solaris Volume Manager to mirror the root (<tt>/</tt>) file system,
the file system must use the single Solaris <tt>fdisk</tt> partition. Therefore, if the
x86 boot partition already exists in the system, delete this partition with the
<tt>fdisk</tt> command and then reinstall the Solaris software. When you reinstall, the boot
partition is no longer recreated.</p>
<hr><p><b>Note - </b>Solaris Volume Manager can only mirror slices within the Solaris <tt>fdisk</tt> partition
If you have multiple <tt>fdisk</tt> partitions, you need to use another approach to
protect the data outside of the Solaris <tt>fdisk</tt> partition.</p>
<hr>
</li>
<li><b>Make the secondary submirror bootable with a master boot program.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Specify the master boot program.</b><pre># <tt><b>fdisk -b /usr/lib/fs/ufs/mboot /dev/rdsk/c1t1d0p0</b></tt></pre><p>The following screen appears:</p><pre>             Total disk size is 31035 cylinders
             Cylinder size is 1146 (512 byte) blocks

                                               Cylinders
      Partition   Status    Type          Start   End   Length    %
      =========   ======    ============  =====   ===   ======   ===
          1        Active   Solaris           1  31034    31034    100


SELECT ONE OF THE FOLLOWING:
   1. Create a partition
   2. Specify the active partition
   3. Delete a partition
   4. Change between Solaris and Solaris2 Partition IDs
   5. Exit (update disk configuration and exit)
   6. Cancel (exit without updating disk configuration)
Enter Selection: </pre></li>
<li><b>Choose number 5 from the menu, and press return.</b></li></ol></li>
<li><b>Make the secondary disk bootable.</b><pre># <tt><b>/sbin/installgrub /boot/grub/stage1 /boot/grub/stage2 /dev/rdsk/c1t1d0s0</b></tt></pre><p>For more information about <tt>installgrub,</tt> refer to the <a href="http://docs.sun.com/doc/819-2240/installgrub-1m?a=view"><tt>installgrub</tt>(1M)</a> man page.</p></li>
<li><b>Identify the slice that contains the existing root (<tt>/</tt>) file system to be
mirrored.</b><p>This example uses the slice <tt>c1t0d0s0</tt>.</p></li>
<li><b>Create a new RAID-0 volume on the slice from the previous step.</b><p>Only the single slice can be included in the RAID-0 volume. Use
one of the following methods:</p>
<ul><li><p>From the Enhanced Storage tool within the Solaris Management Console, open the Volumes node, then choose Action&rArr;Create Volume. Follow the onscreen instructions. For more information, see the online help.</p></li>
<li><p>Use the following form of the <tt>metainit</tt> command:</p><pre># <tt><b>metainit -f </tt><i>volume-name</i><tt> </tt><i>number-of-stripes</i><tt> </tt><i>components-per-stripe</i><tt> </tt><i>component-name</i><tt></b></tt></pre><dl><dt><tt>-f</tt></dt>
<dd><p>Forces the command to continue. You must use this option when the slice contains a mounted file system.</p></dd>
<dt><i>volume-name</i></dt>
<dd><p>Specifies the name of the volume to create. For information on naming volumes, see <a href="basics-42385.html#basics-34">Volume Names</a>.</p></dd>
<dt><i>number-of-stripes</i></dt>
<dd><p>Specifies the number of stripes to create.</p></dd>
<dt><i>components-per-stripe</i></dt>
<dd><p>Specifies the number of components each stripe should have.</p></dd>
<dt><i>component-names</i></dt>
<dd><p>Specifies the names of the components that are used. This example uses the root slice, <tt>c0t0d0s0</tt>.</p></dd>
</dl>
</li></ul>
</li>
<li><b>Create a second RAID-0 volume (<tt>c1t1d0s0</tt> in this example) on an unused slice
to act as the second submirror.</b>
<hr><p><b>Note - </b>The secondary submirror must be the same size as the original submirror, or
larger. Also, the slice you use as the second submirror must have a
slice tag of &ldquo;root&rdquo; and the root slice must be slice 0.</p><p>For information on configuring the slice tag field, see the <a href="http://docs.sun.com/doc/819-2240/format-1m?a=view"><tt>format</tt>(1M)</a> man
page.</p>
<hr>
<p>Use either of the following methods:</p>
<ul><li><p>From the Enhanced Storage tool within the Solaris Management Console, open the Volumes node, then choose Action->Create Volume and follow the instructions on screen. For more information, see the online help.</p></li>
<li><p>Use the following form of the <tt>metainit </tt> command.</p><pre># <tt><b>metainit </tt><i>volume-name</i><tt> </tt><i>number-of-stripes</i><tt> </tt><i>components-per-stripes</i><tt> </tt><i>component-names</i><tt></b></tt></pre>
<hr><p><b>Note - </b>See Step 6 for an explanation of the options.</p>
<hr>
</li></ul>
</li>
<li><b>Create a one-way mirror by using one of the following methods:</b>
<ul><li><p>From the Enhanced Storage tool within the Solaris Management Console, open the Volumes node, then choose Action&rArr;Create Volume. Follow the onscreen instructions. For more information, see the online help.</p></li>
<li><p>Use the following form of the <tt>metainit</tt> command.</p><pre># <tt><b>metainit </tt><i>volume-name</i><tt> -m </tt><i>submirror-name</i><tt></b></tt></pre><dl><dt><i>volume-name</i></dt>
<dd><p>Specifies the name of the volume to create.</p></dd>
<dt><tt>-m</tt></dt>
<dd><p>Specifies to create a mirror.</p></dd>
<dt><i>submirror-name</i></dt>
<dd><p>Specifies the name of the component that will be the first submirror in the mirror. In this example, it is the RAID-0 volume that contains the root slice.</p></dd>
</dl>
</li></ul>
</li>
<li><b>Remount your newly mirrored file system, then reboot the system.</b><pre># <tt><b>metaroot </tt><i>volume-name</i><tt></b></tt>
# <tt><b>reboot</b></tt></pre><p>For more information, see the <a href="http://docs.sun.com/doc/819-2240/metaroot-1m?a=view"><tt>metaroot</tt>(1M)</a> man page.</p></li>
<li><b><a name="gcsan"></a>Attach the second submirror. </b><pre># <tt><b>metattach </tt><i>volume-name</i><tt> </tt><i>submirror-name</i><tt></b></tt></pre><dl><dt><i>volume-name</i></dt>
<dd><p>Specifies the name of the RAID-1 volume on which to add the submirror.</p></dd>
<dt><i>submirror-name</i></dt>
<dd><p>Specifies the name of the component that will be the second submirror attached to the mirror.</p></dd>
</dl>
<p>See the <a href="http://docs.sun.com/doc/819-2240/metattach-1m?a=view"><tt>metattach</tt>(1M)</a> man page for more information.</p></li>
<li><b>Define the alternative boot path in the <tt>menu.lst</tt> file.</b><p>To enable the system to boot off of the disk that holds
the secondary submirror, configure the system to see the disk as the alternate
boot device. In the current example, <tt>c1t1d0s0</tt>, the alternative path is on the first
slice of the first fdisk partition on the second disk. Thus, you would
edit the <tt>menu.lst</tt> with the following entry:</p><pre>title alternate boot
 root (hd1,0,a)
 kernel /boot/multiboot
 module /boot/x86.miniroot-safe</pre>
<hr><p><b>Note - </b>To properly edit entries in <tt>menu.lst,</tt> you must be familiar with disk-naming conventions
in GRUB. For details, see <a href="http://docs.sun.com/doc/819-2379/hbx86boot-68676?a=view">Chapter 11, GRUB Based Booting (Tasks), in <i>System Administration Guide: Basic Administration</i></a></p>
<hr>
<p>After you have completed editing the <tt>menu.lst</tt> file, the system is set to
failover to the second disk. If the primary disk fails, disk numbering changes
so that the system boots from the secondary disk.</p>
<hr><p><b>Caution - </b>On certain cases, the automatic disk-renumbering feature of the BIOS might affect recovery
from an unavailable primary disk. When disk renumbering forces the system to boot
from the secondary disk, the primary disk's boot archive becomes stale. If the
same primary disk becomes available later and you boot the system, the disk
numbering switches again to use the default primary disk for the system boot.
However, at this stage, the primary disk's boot archive remains stale. Consequently, the
system might not boot at all. Therefore make sure that in such cases,
you select the correct entry from the GRUB menu to boot the system
from the valid boot archive. After the system completes the boot up process,
perform the normal <tt>metadevice</tt> maintenance which synchronizes both primary and secondary disks and
restores the valid boot archive to the primary disk.</p>
<hr>
</li></ol>

<a name="fryix"></a><h4>Understanding Boot Time Warnings When Mirroring the root (<tt>/</tt>) File System</h4>
<p>After you mirror your root (<tt>/</tt>) file system, error messages will be displayed
in the console and logged in the system log that is defined in
the <tt>/etc/syslog.conf</tt> file. These error messages do not indicate a problem. These messages
are displayed for each device type that you are not currently using, because
an unused module cannot be force loaded. The error messages are similar to
the following:</p><pre>Jul 13 10:17:42 ifr genunix: [ID 370176 kern.warning] WARNING: forceload of 
    misc/md_trans failed
Jul 13 10:17:42 ifr genunix: [ID 370176 kern.warning] WARNING: forceload of 
    misc/md_raid failed
Jul 13 10:17:42 ifr genunix: [ID 370176 kern.warning] WARNING: forceload of 
    misc/md_hotspares failed</pre><p>You can safely disregard these error messages. </p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="fpjwe.html">Previous</a>
             </td>
             <td align="right">
                 <a href="tasks-mirrors-23.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

