<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Overview of Replacing and Enabling Components in RAID-1 and RAID-5 Volumes - Solaris Volume Manager Administration Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2006-06-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">Solaris Volume Manager Administration Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="tasks-metadevices-41.html">Previous</a>
             </td>
             <td align="right">
                 <a href="best-practices-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="roadmap-10.html">1.&nbsp;&nbsp;Getting Started With Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="storage-overview-1.html">2.&nbsp;&nbsp;Storage Management Concepts</a></p>
<p class="toc level1 tocsp"><a href="basics-23185.html">3.&nbsp;&nbsp;Solaris Volume Manager Overview</a></p>
<p class="toc level1 tocsp"><a href="eoqra.html">4.&nbsp;&nbsp;Solaris Volume Manager for Sun Cluster (Overview)</a></p>
<p class="toc level1 tocsp"><a href="svm-scenario-1.html">5.&nbsp;&nbsp;Configuring and Using Solaris Volume Manager (Scenario)</a></p>
<p class="toc level1 tocsp"><a href="about-state-db-replicas-1.html">6.&nbsp;&nbsp;State Database (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-state-db-replicas-1.html">7.&nbsp;&nbsp;State Database (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-metadevices-22802.html">8.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-metadevices-1.html">9.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-mirrors-2.html">10.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-mirrors-1.html">11.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-softpart-1.html">12.&nbsp;&nbsp;Soft Partitions (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-softpart-1.html">13.&nbsp;&nbsp;Soft Partitions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-raid5-1.html">14.&nbsp;&nbsp;RAID-5 Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-raid5-1.html">15.&nbsp;&nbsp;RAID-5 Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-hotspares-40444.html">16.&nbsp;&nbsp;Hot Spare Pools (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-hotspares-1.html">17.&nbsp;&nbsp;Hot Spare Pools (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-disksets-31856.html">18.&nbsp;&nbsp;Disk Sets (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-disksets-1.html">19.&nbsp;&nbsp;Disk Sets (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-basics-2.html">20.&nbsp;&nbsp;Maintaining Solaris Volume Manager (Tasks)</a></p>
<p class="toc level2"><a href="tasks-basics-33.html">Solaris Volume Manager Maintenance (Task Map)</a></p>
<p class="toc level2"><a href="tasks-basics-28.html">Viewing the Solaris Volume Manager Configuration</a></p>
<p class="toc level3"><a href="tasks-basics-28.html#tasks-basics-29">How to View the Solaris Volume Manager Volume Configuration</a></p>
<p class="toc level2 tocsp"><a href="tasks-basics-5.html">Renaming Volumes</a></p>
<p class="toc level3"><a href="tasks-basics-5.html#tasks-metadevices-9">How to Rename a Volume</a></p>
<p class="toc level2 tocsp"><a href="tasks-basics-6.html">Working With Configuration Files</a></p>
<p class="toc level3"><a href="tasks-basics-6.html#tasks-basics-1">How to Create Configuration Files</a></p>
<p class="toc level3"><a href="tasks-basics-6.html#troubleshoottasks-23827">How to Initialize Solaris Volume Manager From a Configuration File</a></p>
<p class="toc level2 tocsp"><a href="troubleshoottasks-13.html">Changing Solaris Volume Manager Default Values</a></p>
<p class="toc level2"><a href="tasks-metadevices-41.html">Expanding a File System Using the <tt>growfs</tt> Command</a></p>
<p class="toc level3"><a href="tasks-metadevices-41.html#tasks-metadevices-7">How to Expand a File System</a></p>
<div class="onpage">
<p class="toc level2 tocsp"><a href="">Overview of Replacing and Enabling Components in RAID-1 and RAID-5 Volumes</a></p>
</div>
<p class="toc level1 tocsp"><a href="best-practices-1.html">21.&nbsp;&nbsp;Best Practices for Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="topdown-overview.html">22.&nbsp;&nbsp;Top-Down Volume Creation (Overview)</a></p>
<p class="toc level1 tocsp"><a href="topdown-tasks-chap.html">23.&nbsp;&nbsp;Top-Down Volume Creation (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-snmp-1.html">24.&nbsp;&nbsp;Monitoring and Error Reporting (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="troubleshoottasks-33506.html">25.&nbsp;&nbsp;Troubleshooting Solaris Volume Manager (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="appendfiles-1.html">A.&nbsp;&nbsp;Important Solaris Volume Manager Files</a></p>
<p class="toc level1 tocsp"><a href="quick-reference-1.html">B.&nbsp;&nbsp;Solaris Volume Manager Quick Reference</a></p>
<p class="toc level1 tocsp"><a href="append-cim-wbem-1.html">C.&nbsp;&nbsp;Solaris Volume Manager CIM/WBEM API</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="replace-enable-1"></a><h3>Overview of Replacing and Enabling Components in RAID-1 and RAID-5 Volumes</h3>
<a name="indexterm-208"></a><a name="indexterm-209"></a><p>Solaris Volume Manager can <b>replace</b> and <b>enable</b> components within RAID-1 (mirror) and RAID-5
volumes. </p><p>In Solaris Volume Manager terminology, <b>replacing</b> a component is a way to substitute
an available component on the system for a selected component in a submirror
or RAID-5 volume. You can think of this process as logical replacement, as
opposed to physically replacing the component. For more information see <a href="#replace-enable-3">Replacing a Component With Another Available Component</a>.</p><p><b>Enabling</b> a component means to &ldquo;activate&rdquo; or substitute a component with itself (that
is, the component name is the same). For more information, see <a href="#replace-enable-2">Enabling a Component</a>.</p>
<hr><p><b>Note - </b><a name="indexterm-210"></a>When recovering from disk errors, scan <tt>/var/adm/messages</tt> to see what kind of errors
occurred. If the errors are transitory and the disks themselves do not have
problems, try enabling the failed components. You can also use the <tt>format</tt> command
to test a disk. </p>
<hr>


<a name="replace-enable-2"></a><h4>Enabling a Component</h4>
<p>You can enable a component when any of the following conditions exist:</p>
<ul><li><p>Solaris Volume Manager cannot access the physical drive. This problem might occur, for example, due to a power loss, or a loose drive cable. In this case, Solaris Volume Manager puts the components in the &ldquo;Maintenance&rdquo; state. You need to make sure that the drive is accessible (restore power, reattach cables, and so on), and then enable the components in the volumes.</p></li>
<li><p>You suspect that a physical drive is having transitory problems that are not disk-related. You might be able to fix a component in the &ldquo;Maintenance&rdquo; state by simply enabling it. If enabling the component does not fix the problem, then you need to do one of the following:</p>
<ul><li><p>Physically replace the disk drive and enable the component</p></li>
<li><p>Replace the component with another available component on the system</p></li></ul>
<p>When you physically replace a disk, be sure to partition the disk like the replaced disk to ensure adequate space on each used component.</p></li></ul>

<hr><p><b>Note - </b>Always check for state database replicas and hot spares on the disk that
is being replaced. Any state database replica in an erred state should be
deleted before you replace the disk. Then, after you enable the component, recreate
the state database replicas using the same size. You should treat hot spares
in the same manner.</p>
<hr>


<a name="replace-enable-3"></a><h4>Replacing a Component With Another Available Component</h4>
<p>You use the <tt>metareplace</tt> command when you replace or swap an existing component
with a different component that is available and not in use on the
system.</p><p>You can use this command when any of the following conditions exist:</p>
<ul><li><p>A disk drive has problems, and you do not have a replacement drive. However, you do have available components elsewhere on the system. </p><p>You might want to use this strategy when a replacement is absolutely necessary, but you do not want to shut down the system.</p></li>
<li><p>You see soft errors on the physical disks. </p><p>Physical disks might report soft errors even though Solaris Volume Manager shows the mirror/submirror or RAID-5 volume in the &ldquo;Okay&rdquo; state. Replacing the component in question with another available component enables you to perform preventative maintenance and potentially prevent hard errors from occurring.</p></li>
<li><p>You want to do performance tuning. </p><p>One way that you can evaluate components is by using the performance monitoring feature available from the Enhanced Storage tool within the Solaris Management Console. For example, you might see that a particular component in a RAID-5 volume is experiencing a high load average, even though it is in the &ldquo;Okay&rdquo; state. To balance the load on the volume, you can replace that component with a component from a disk that is less utilized. You can perform this type of replacement online without interrupting service to the volume.</p></li></ul>


<a name="replace-enable-4"></a><h4>Maintenance and Last Erred States</h4>
<a name="indexterm-211"></a><a name="indexterm-212"></a><p>When a component in a RAID-1 or RAID-5 volume experiences errors, Solaris
Volume Manager puts the component in the &ldquo;Maintenance&rdquo; state. No further reads or writes
are performed to a component in the &ldquo;Maintenance&rdquo; state.</p><p>Sometimes a component goes into a &ldquo;Last Erred&rdquo; state. For a RAID-1 volume,
this usually occurs with a one-sided mirror. The volume experiences errors. However, there
are no redundant components to read from. For a RAID-5 volume this occurs
after one component goes into &ldquo;Maintenance&rdquo; state, and another component fails. The second
component to fail goes into the &ldquo;Last Erred&rdquo; state.</p><p>When either a RAID-1 volume or a RAID-5 volume has a component
in the &ldquo;Last Erred&rdquo; state, I/O is still attempted to the component marked
&ldquo;Last Erred.&rdquo; This I/O attempt occurs because a &ldquo;Last Erred&rdquo; component contains the last
good copy of data from Solaris Volume Manager's point of view. With a
component in the &ldquo;Last Erred&rdquo; state, the volume behaves like a normal device
(disk) and returns I/O errors to an application. Usually, at this point, some
data has been lost. </p><p>The subsequent errors on other components in the same volume are handled differently,
depending on the type of volume. </p><dl><dt>RAID-1 Volume</dt>
<dd><p>A RAID-1 volume might be able to tolerate many components in the &ldquo;Maintenance&rdquo; state and still be read from and written to. If components are in the &ldquo;Maintenance&rdquo; state, no data has been lost. You can safely replace or enable the components in any order. If a component is in the &ldquo;Last Erred&rdquo; state, you cannot replace it until you first replace the components in the &ldquo;Maintenance&rdquo; state. Replacing or enabling a component in the &ldquo;Last Erred&rdquo; state usually means that some data has been lost. Be sure to validate the data on the mirror after you repair it.</p></dd>
<dt>RAID-5 Volume</dt>
<dd><p>A RAID-5 volume can tolerate a single component in the &ldquo;Maintenance&rdquo; state. You can safely replace a single component in the &ldquo;Maintenance&rdquo; state without losing data. If an error on another component occurs, it is put into the &ldquo;Last Erred&rdquo; state. At this point, the RAID-5 volume is a read-only device. You need to perform some type of error recovery so that the state of the RAID-5 volume is stable and the possibility of data loss is reduced. If a RAID-5 volume reaches a &ldquo;Last Erred&rdquo; state, there is a good chance it has lost data. Be sure to validate the data on the RAID-5 volume after you repair it.</p></dd>
</dl>
<p>Always replace components in the &ldquo;Maintenance&rdquo; state first, followed by those in the
&ldquo;Last Erred&rdquo; state. After a component is replaced and resynchronized, use the <tt>metastat</tt>
command to verify its state. Then, validate the data.</p>

<a name="replace-enable-5"></a><h4>Background Information for Replacing and Enabling Components in RAID-1 and RAID-5 Volumes</h4>
<a name="indexterm-213"></a><a name="indexterm-214"></a><p><a name="indexterm-215"></a>When you replace components in a RAID-1 volume or a RAID-5 volume, follow
these guidelines: </p>
<ul><li><p>Always replace components in the &ldquo;Maintenance&rdquo; state first, followed by those components in the &ldquo;Last Erred&rdquo; state.</p></li>
<li><p>After a component is replaced and resynchronized, use the <tt>metastat</tt> command to verify the state of the volume. Then, validate the data. Replacing or enabling a component in the &ldquo;Last Erred&rdquo; state usually means that some data has been lost. Be sure to validate the data on the volume after you repair it. For a UFS, run the <tt>fsck</tt> command to validate the &ldquo;metadata&rdquo; (the structure of the file system). Then, check the actual user data. (Practically, users will have to examine their files.) A database or other application must have its own way of validating its internal data structure.</p></li>
<li><p>Always check for state database replicas and hot spares when you replace components. Any state database replica in an erred state should be deleted before you replace the physical disk. The state database replica should be added back before you enable the component. The same procedure applies to hot spares.</p></li>
<li><p>During component replacement for a RAID-5 volume, data is recovered in one of two ways. The data is recovered either from a hot spare currently in use or from using the RAID-5 parity, when no hot spare is in use.</p></li>
<li><p>When you replace a component for a RAID-1 volume, Solaris Volume Manager automatically starts resynchronizing the new component with the rest of the volume. When the resynchronization completes, the replaced component becomes readable and writable. If the failed component has been replaced with data from a hot spare, the hot spare is placed in the &ldquo;Available&rdquo; state and made available for other hot spare replacements.</p></li>
<li><p>The new component must be large enough to replace the old component.</p></li>
<li><p>As a precaution, back up all data before you replace &ldquo;Last Erred&rdquo; devices.</p></li></ul>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="tasks-metadevices-41.html">Previous</a>
             </td>
             <td align="right">
                 <a href="best-practices-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

