<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Creating and Maintaining RAID-1 Volumes - Solaris Volume Manager Administration Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2006-06-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">Solaris Volume Manager Administration Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="about-metadevices-25868.html">Previous</a>
             </td>
             <td align="right">
                 <a href="tipsandtricks-94.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="roadmap-10.html">1.&nbsp;&nbsp;Getting Started With Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="storage-overview-1.html">2.&nbsp;&nbsp;Storage Management Concepts</a></p>
<p class="toc level1 tocsp"><a href="basics-23185.html">3.&nbsp;&nbsp;Solaris Volume Manager Overview</a></p>
<p class="toc level1 tocsp"><a href="eoqra.html">4.&nbsp;&nbsp;Solaris Volume Manager for Sun Cluster (Overview)</a></p>
<p class="toc level1 tocsp"><a href="svm-scenario-1.html">5.&nbsp;&nbsp;Configuring and Using Solaris Volume Manager (Scenario)</a></p>
<p class="toc level1 tocsp"><a href="about-state-db-replicas-1.html">6.&nbsp;&nbsp;State Database (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-state-db-replicas-1.html">7.&nbsp;&nbsp;State Database (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-metadevices-22802.html">8.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-metadevices-1.html">9.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-mirrors-2.html">10.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Overview)</a></p>
<p class="toc level2"><a href="about-metadevices-24868.html">Overview of RAID-1 (Mirror) Volumes</a></p>
<p class="toc level2"><a href="about-metadevices-25868.html">RAID-1 Volume (Mirror) Resynchronization</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Creating and Maintaining RAID-1 Volumes</a></p>
</div>
<p class="toc level2"><a href="tipsandtricks-94.html">The Affect of Booting Into Single-User Mode on RAID-1 Volumes</a></p>
<p class="toc level2"><a href="about-mirrors-8.html">Scenario--RAID-1 Volumes (Mirrors)</a></p>
<p class="toc level1 tocsp"><a href="tasks-mirrors-1.html">11.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-softpart-1.html">12.&nbsp;&nbsp;Soft Partitions (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-softpart-1.html">13.&nbsp;&nbsp;Soft Partitions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-raid5-1.html">14.&nbsp;&nbsp;RAID-5 Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-raid5-1.html">15.&nbsp;&nbsp;RAID-5 Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-hotspares-40444.html">16.&nbsp;&nbsp;Hot Spare Pools (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-hotspares-1.html">17.&nbsp;&nbsp;Hot Spare Pools (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-disksets-31856.html">18.&nbsp;&nbsp;Disk Sets (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-disksets-1.html">19.&nbsp;&nbsp;Disk Sets (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-basics-2.html">20.&nbsp;&nbsp;Maintaining Solaris Volume Manager (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="best-practices-1.html">21.&nbsp;&nbsp;Best Practices for Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="topdown-overview.html">22.&nbsp;&nbsp;Top-Down Volume Creation (Overview)</a></p>
<p class="toc level1 tocsp"><a href="topdown-tasks-chap.html">23.&nbsp;&nbsp;Top-Down Volume Creation (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-snmp-1.html">24.&nbsp;&nbsp;Monitoring and Error Reporting (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="troubleshoottasks-33506.html">25.&nbsp;&nbsp;Troubleshooting Solaris Volume Manager (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="appendfiles-1.html">A.&nbsp;&nbsp;Important Solaris Volume Manager Files</a></p>
<p class="toc level1 tocsp"><a href="quick-reference-1.html">B.&nbsp;&nbsp;Solaris Volume Manager Quick Reference</a></p>
<p class="toc level1 tocsp"><a href="append-cim-wbem-1.html">C.&nbsp;&nbsp;Solaris Volume Manager CIM/WBEM API</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="eyaso"></a><h3>Creating and Maintaining RAID-1 Volumes</h3>
<p>This section provides guidelines can assist you in creating mirrors. This section also
provides performance guidelines for the mirrors that you create.</p>

<a name="eyasp"></a><h4>Configuration Guidelines for RAID-1 Volumes</h4>

<ul><li><p>Before you create a mirror, create the RAID-0 (stripe or concatenation) volumes that comprise the mirror.</p></li>
<li><p>When creating a mirror, first create a one-way mirror, then attach a second submirror. This strategy starts a resynchronization operation. This strategy also ensures that data is not corrupted. You can also create a one-way mirror for use as a future two-way or multi-way mirror.</p></li>
<li><p>You can create a two-way mirror, three-way mirror, or four-way mirror from a one-way mirror with a single command. You can speed the creation process by creating all submirrors with a single command. Use this process only if you are not mirroring existing data and if you are comfortable destroying the data on all of the submirrors.</p></li>
<li><p>You can create a RAID-1 volume from an existing file system that is built on a slice. Only the single slice may be included in the primary RAID-0 volume (submirror). If you are mirroring root or other system-critical file systems, all submirrors must consist of only a single slice. </p></li>
<li><p>Use the <tt>swap <tt>-l</tt></tt> command to check for all <tt>swap</tt> devices. Each slice that is specified as <tt>swap</tt> must be mirrored independently from the remaining swap slices.</p></li>
<li><p>The Enhanced Storage tool within the Solaris Management Console does not support unmirroring root (<tt>/</tt>), <tt>/opt</tt>, <tt>/usr</tt>, or <tt>swap</tt>. In fact, the tool does not support unmirroring any file system that cannot be unmounted while the system is running. Instead, use the command-line procedure for these file systems.</p></li>
<li><p>Use submirrors of the same size. Submirrors of different sizes result in unused disk space.</p></li>
<li><p>Use only similarly configured submirrors within a mirror. In particular, if you create a mirror with an unlabeled submirror, you cannot attach any submirrors that contain disk labels. </p></li>
<li><p>You can have a mirrored file system in which the first submirror attached does not start on cylinder 0. All additional submirrors you attach must also not start on cylinder 0. If you attempt to attach a submirror starting in this situation, the following error message displays: </p><pre>can't attach labeled submirror to an unlabeled mirror </pre><p>Either all submirrors intended for use within a specific mirror must start on cylinder 0, or all of the submirrors must <b>not</b> start on cylinder 0. </p><p>Starting cylinders do not have to be the same across all submirrors. However, all submirrors must either include or not include cylinder 0.</p></li>
<li><p>You can improve a mirror's performance by adding additional state database replicas before you create the mirror. As a general rule, add two additional replicas for each mirror you add to the system. Solaris Volume Manager uses these additional replicas to store the dirty region log (DRL), which is used to provide optimized resynchronization. By providing adequate numbers of replicas, you can minimize I/O impact on RAID-1 volume performance. Using at least two replicas on the same disks or controllers as the mirror that the replicas log also helps to improve overall performance.</p></li>
<li><p>Only mount the mirror device directly. Do not try to mount a submirror directly, unless the submirror is offline and mounted read-only. Do not mount a slice that is part of a submirror. This process could destroy data and crash the system.</p></li></ul>


<a name="eyasl"></a><h4>Performance Guidelines for RAID-1 Volumes</h4>

<ul><li><p>Keep the slices of different submirrors on different disks and controllers. Data protection is diminished considerably if slices of two or more submirrors of the same mirror are on the same disk. Likewise, organize submirrors across separate controllers, because controllers and associated cables tend to fail more often than disks. This practice also improves mirror performance.</p></li>
<li><p>Use the same type of disks and controllers in a single mirror. Particularly in old SCSI storage devices, different models or different brands of disks or controllers can have widely varying performance. If disks and controller that have the different performance levels are used in a single mirror, performance can degrade significantly.</p></li>
<li><p>Mirroring might improve read performance, but write performance is always degraded. Mirroring improves read performance only in threaded or asynchronous I/O situations. A single thread reading from the volume does not provide a performance gain.</p></li>
<li><p>You can experiment with the mirror read policies can improve performance. For example, the default read mode is to alternate reads in a round-robin fashion among the disks. This policy is the default because round-robin tends to work best for UFS multiuser, multiprocessor activity.</p><p>In some cases, the <tt>geometric</tt> read option improves performance by minimizing head motion and access time. This option is most effective when:</p>
<ul><li><p>There is only one slice per disk</p></li>
<li><p>Only one process at a time is using the slice or file system</p></li>
<li><p>I/O patterns are highly sequential or when all accesses are read</p></li></ul>
</li>
<li><p>You can attach a submirror to a mirror without interrupting service. You attach submirrors to mirrors to create two-way, three-way, and four-way mirrors.</p></li>
<li><p>When you place a submirror offline, you prevent the mirror from reading from and writing to the submirror. However, you preserve the submirror's logical association to the mirror. While the submirror is offline, Solaris Volume Manager keeps track of all writes to the mirror. The writes are written to the submirror when it is brought back online. By performing an optimized resynchronization, Solaris Volume Manager only has to resynchronize data that has changed, not the entire submirror. When you detach a submirror, you sever its logical association to the mirror. Typically, you place a submirror offline to perform maintenance. You detach a submirror to remove it.</p></li></ul>


<a name="about-metadevices-13"></a><h4>About RAID-1 Volume Options</h4>
<a name="about-metadevices-ix121"></a><p>The following options are available to optimize mirror performance:</p>
<ul><li><p>Mirror read policy</p></li>
<li><p>Mirror write policy</p></li>
<li><p>The order in which mirrors are resynchronized (pass number)</p></li></ul>
<p>You can define mirror options when you initially create the mirror. You
can also change mirror options after a mirror has been set up and
is running. For tasks related to changing these options, see  <a href="tasks-mirrors-24.html#tasks-mirrors-15">How to Change RAID-1 Volume Options</a>.</p>

<a name="about-metadevices-17"></a><h5>RAID-1 Volume Read-and-Write Policies</h5>
<p><a name="about-metadevices-ix129"></a><a name="indexterm-65"></a><a name="indexterm-66"></a><a name="indexterm-67"></a><a name="indexterm-68"></a><a name="indexterm-69"></a>Solaris Volume Manager enables different read-and-write policies to be configured for a RAID-1
volume. Properly set read-and-write policies can improve performance for a given configuration.</p><a name="about-metadevices-tbl-18"></a><h6>Table&nbsp;10-1 RAID-1 Volume Read Policies</h6><table><col width="2*"><col width="7*"><tr><th align="left" valign="top" scope="column"><p>Read Policy</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Round-Robin
(Default)</p></td>
<td align="left" valign="top" scope="row"><p>Attempts to balance the load across the submirrors. All reads are made
in a round-robin order (one after another) from all submirrors in a mirror.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Geometric</p></td>
<td align="left" valign="top" scope="row"><p>Enables
reads to be divided among submirrors on the basis of a logical
disk block address. For example, with a two-way submirror, the disk space on
the mirror is divided into two equally-sized logical address ranges. Reads from one
submirror are restricted to one half of the logical range. Reads from the
other submirror are restricted to the other half. The geometric read policy effectively
reduces the seek time that is necessary for reads. The performance gained by
this read policy depends on the system I/O load and the access patterns
of the applications.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>First</p></td>
<td align="left" valign="top" scope="row"><p>Directs all reads to the first submirror. This policy should
be used only when the device or devices that comprise the first submirror
are substantially faster than the devices of the second submirror.</p></td>
</tr>
</table><a name="about-metadevices-tbl-19"></a><h6>Table&nbsp;10-2 RAID-1 Volume Write Policies</h6><table><col width="2*"><col width="7*"><tr><th align="left" valign="top" scope="column"><p>Write Policy</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Parallel (Default)</p></td>
<td align="left" valign="top" scope="row"><p>Performs writes
to a mirror that are replicated and dispatched to all of the submirrors
simultaneously.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Serial</p></td>
<td align="left" valign="top" scope="row"><p>Performs writes to submirrors serially (that is, the first submirror write completes before
the second submirror write is started). This policy specifies that writes to one
submirror must be completed before the next submirror write is initiated. This policy
is provided in case a submirror becomes unreadable, for example, due to
a power failure.</p></td>
</tr>
</table>

<a name="eyasy"></a><h5>Pass Number</h5>
<a name="eyass"></a><a name="indexterm-70"></a><p>The pass number, a number in the range 0&ndash;9, determines the order
in which a particular mirror is resynchronized during a system reboot. The default
pass number is 1. The lower pass numbers are resynchronized first. If zero
is used, the mirror resynchronization is skipped. A pass number of zero should
be used only for mirrors that are mounted as read-only. Mirrors with the
same pass number are resynchronized at the same time.</p>

<a name="eyhxl"></a><h4>Understanding Submirror Status to Determine Maintenance Actions</h4>
<p>The <tt>metastat</tt> command of Solaris Volume Manager reports status information on RAID 1
volumes and submirrors. The status information helps you to determine if maintenance action
is required on a RAID-1 volume. The following table explains submirror states shown
when you run the metastat command on a RAID-1 volume.</p><a name="fpkae"></a><h6>Table&nbsp;10-3 Submirror States</h6><table><col width="88*"><col width="308*"><tr><th align="left" valign="top" scope="column"><p>State</p></th>
<th align="left" valign="top" scope="column"><p>Meaning</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Okay</p></td>
<td align="left" valign="top" scope="row"><p>The submirror has
no errors and is functioning correctly.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Resyncing</p></td>
<td align="left" valign="top" scope="row"><p>The submirror is actively being resynchronized. An
error has occurred and has been corrected, the submirror has just been brought
back online, or a new submirror has been added.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Resync canceled</p></td>
<td align="left" valign="top" scope="row"><p>The resynchronization process on
the submirror has been canceled using the <tt>metasync</tt> command.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Needs Maintenance</p></td>
<td align="left" valign="top" scope="row"><p>A slice (or
slices) in the submirror has encountered an I/O error or an open error.
All reads and writes to and from this slice in the submirror
have been discontinued.</p></td>
</tr>
</table><p>Additionally, for each slice in a submirror, the <tt>metastat</tt> command shows the following:</p><dl><dt>Device</dt>
<dd><p>Indicates the device name of the slice in the stripe</p></dd>
<dt>Start Block</dt>
<dd><p>Indicates the block on which the slice begins</p></dd>
<dt>Dbase</dt>
<dd><p>Indicates if the slice contains a state database replica</p></dd>
<dt>State</dt>
<dd><p>Indicates the state of the slice</p></dd>
<dt>Hot Spare</dt>
<dd><p>Indicates that a slice is being used as a hot spare for a failed slice</p></dd>
</dl>
<p>The submirror state only provides general information on the status of the
submirror. The slice state is perhaps the most important information to review when
you are troubleshooting mirror errors. If the submirror reports a &ldquo;Needs Maintenance&rdquo; state,
you must refer to the slice state for more information.</p><p>You take a different recovery action depending on if the slice is
in the &ldquo;Maintenance&rdquo; state or in the &ldquo;Last Erred&rdquo; state. If you only
have slices in the &ldquo;Maintenance&rdquo; state, they can be repaired in any order.
If you have slices both in the &ldquo;Maintenance&rdquo; state and in the &ldquo;Last
Erred&rdquo; state, you must fix the slices in the &ldquo;Maintenance&rdquo; state first. Once
the slices in the &ldquo;Maintenance&rdquo; state have been fixed, then fix the slices
in the &ldquo;Last Erred&rdquo; state. For more information, see <a href="replace-enable-1.html">Overview of Replacing and Enabling Components in RAID-1 and RAID-5 Volumes</a>.</p><p>The following table explains the slice states for submirrors and possible actions to
take.</p><a name="maintaintasksnew-10722"></a><h6>Table&nbsp;10-4 Submirror Slice States</h6><table><col width="61*"><col width="152*"><col width="183*"><tr><th align="left" valign="top" scope="column"><p>State</p></th>
<th align="left" valign="top" scope="column"><p>Meaning</p></th>
<th align="left" valign="top" scope="column"><p>Action</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Okay</p></td>
<td align="left" valign="top" scope="row"><p>The slice has no errors and is functioning correctly.</p></td>
<td align="left" valign="top" scope="row"><p>None.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Resyncing</p></td>
<td align="left" valign="top" scope="row"><p>The slice is actively
being resynchronized. An error has occurred and been corrected, the submirror has just
been brought back online, or a new submirror has been added.</p></td>
<td align="left" valign="top" scope="row"><p>If desired,
monitor the submirror status until the resynchronization is done.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Maintenance</p></td>
<td align="left" valign="top" scope="row"><p>The slice has encountered
an I/O error or an open error. All reads and writes to and
from this component have been discontinued.</p></td>
<td align="left" valign="top" scope="row"><p>Enable or replace the failed slice. See
<a href="tasks-mirrors-23.html#maintaintasksnew-14061">How to Enable a Slice in a Submirror</a>, or <a href="tasks-mirrors-25.html#maintaintasksnew-11508">How to Replace a Slice in a Submirror</a>. The <tt>metastat</tt> command will show an <tt>invoke</tt> recovery message with
the appropriate action to take with the <tt>metareplace</tt> command. You can also use
the <tt>metareplace <tt>-e</tt></tt> command.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Last Erred</p></td>
<td align="left" valign="top" scope="row"><p>The slice has encountered an I/O error or an
open error. However, the data is not replicated elsewhere due to another slice
failure. I/O is still performed on the slice. If I/O errors result, the
mirror I/O fails.</p></td>
<td align="left" valign="top" scope="row"><p>First, enable or replace slices in the &ldquo;Maintenance&rdquo; state. See
<a href="tasks-mirrors-23.html#maintaintasksnew-14061">How to Enable a Slice in a Submirror</a>, or <a href="tasks-mirrors-25.html#maintaintasksnew-11508">How to Replace a Slice in a Submirror</a>. Usually, this error results in some data loss, so validate
the mirror after it is fixed. For a file system, use the <tt>fsck</tt>
command, then check the data. An application or database must have its own
method of validating the device.</p></td>
</tr>
</table>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="about-metadevices-25868.html">Previous</a>
             </td>
             <td align="right">
                 <a href="tipsandtricks-94.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

