<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Working With Configuration Files - Solaris Volume Manager Administration Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2006-06-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">Solaris Volume Manager Administration Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="tasks-basics-5.html">Previous</a>
             </td>
             <td align="right">
                 <a href="troubleshoottasks-13.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="roadmap-10.html">1.&nbsp;&nbsp;Getting Started With Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="storage-overview-1.html">2.&nbsp;&nbsp;Storage Management Concepts</a></p>
<p class="toc level1 tocsp"><a href="basics-23185.html">3.&nbsp;&nbsp;Solaris Volume Manager Overview</a></p>
<p class="toc level1 tocsp"><a href="eoqra.html">4.&nbsp;&nbsp;Solaris Volume Manager for Sun Cluster (Overview)</a></p>
<p class="toc level1 tocsp"><a href="svm-scenario-1.html">5.&nbsp;&nbsp;Configuring and Using Solaris Volume Manager (Scenario)</a></p>
<p class="toc level1 tocsp"><a href="about-state-db-replicas-1.html">6.&nbsp;&nbsp;State Database (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-state-db-replicas-1.html">7.&nbsp;&nbsp;State Database (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-metadevices-22802.html">8.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-metadevices-1.html">9.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-mirrors-2.html">10.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-mirrors-1.html">11.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-softpart-1.html">12.&nbsp;&nbsp;Soft Partitions (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-softpart-1.html">13.&nbsp;&nbsp;Soft Partitions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-raid5-1.html">14.&nbsp;&nbsp;RAID-5 Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-raid5-1.html">15.&nbsp;&nbsp;RAID-5 Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-hotspares-40444.html">16.&nbsp;&nbsp;Hot Spare Pools (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-hotspares-1.html">17.&nbsp;&nbsp;Hot Spare Pools (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-disksets-31856.html">18.&nbsp;&nbsp;Disk Sets (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-disksets-1.html">19.&nbsp;&nbsp;Disk Sets (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-basics-2.html">20.&nbsp;&nbsp;Maintaining Solaris Volume Manager (Tasks)</a></p>
<p class="toc level2"><a href="tasks-basics-33.html">Solaris Volume Manager Maintenance (Task Map)</a></p>
<p class="toc level2"><a href="tasks-basics-28.html">Viewing the Solaris Volume Manager Configuration</a></p>
<p class="toc level3"><a href="tasks-basics-28.html#tasks-basics-29">How to View the Solaris Volume Manager Volume Configuration</a></p>
<p class="toc level2 tocsp"><a href="tasks-basics-5.html">Renaming Volumes</a></p>
<p class="toc level3"><a href="tasks-basics-5.html#tasks-metadevices-9">How to Rename a Volume</a></p>
<div class="onpage">
<p class="toc level2 tocsp"><a href="">Working With Configuration Files</a></p>
<p class="toc level3"><a href="#tasks-basics-1">How to Create Configuration Files</a></p>
<p class="toc level3"><a href="#troubleshoottasks-23827">How to Initialize Solaris Volume Manager From a Configuration File</a></p>
</div>
<p class="toc level2 tocsp"><a href="troubleshoottasks-13.html">Changing Solaris Volume Manager Default Values</a></p>
<p class="toc level2"><a href="tasks-metadevices-41.html">Expanding a File System Using the <tt>growfs</tt> Command</a></p>
<p class="toc level3"><a href="tasks-metadevices-41.html#tasks-metadevices-7">How to Expand a File System</a></p>
<p class="toc level2 tocsp"><a href="replace-enable-1.html">Overview of Replacing and Enabling Components in RAID-1 and RAID-5 Volumes</a></p>
<p class="toc level1 tocsp"><a href="best-practices-1.html">21.&nbsp;&nbsp;Best Practices for Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="topdown-overview.html">22.&nbsp;&nbsp;Top-Down Volume Creation (Overview)</a></p>
<p class="toc level1 tocsp"><a href="topdown-tasks-chap.html">23.&nbsp;&nbsp;Top-Down Volume Creation (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-snmp-1.html">24.&nbsp;&nbsp;Monitoring and Error Reporting (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="troubleshoottasks-33506.html">25.&nbsp;&nbsp;Troubleshooting Solaris Volume Manager (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="appendfiles-1.html">A.&nbsp;&nbsp;Important Solaris Volume Manager Files</a></p>
<p class="toc level1 tocsp"><a href="quick-reference-1.html">B.&nbsp;&nbsp;Solaris Volume Manager Quick Reference</a></p>
<p class="toc level1 tocsp"><a href="append-cim-wbem-1.html">C.&nbsp;&nbsp;Solaris Volume Manager CIM/WBEM API</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="tasks-basics-6"></a><h3>Working With Configuration Files</h3>
<a name="indexterm-200"></a><a name="indexterm-201"></a><p>Solaris Volume Manager configuration files contain basic Solaris Volume Manager information, as well
as most of the data that is necessary to reconstruct a configuration. The
following procedures illustrate how to work with these files. </p>

<a name="tasks-basics-1"></a><h4>How to Create Configuration Files</h4><ul>
<li><a name="tasks-basics-step-17"></a><b>Once you have defined all appropriate parameters for the Solaris Volume Manager environment,
use the <tt>metastat <tt>-p</tt></tt> command to create the <tt>/etc/lvm/md.tab</tt> file. </b><pre># <tt><b>metastat -p > /etc/lvm/md.tab</b></tt></pre><p>This file contains all parameters for use by the <tt>metainit</tt> command and <tt>metahs</tt>
command. Use this file if you need to set up several similar environments
or if you need to recreate the configuration after a system failure.</p><p>For more information about the <tt>md.tab</tt> file, see <a href="basics-27.html#basics-28">Overview of the <tt>md.tab</tt> File</a> and the <a href="http://docs.sun.com/doc/819-2251/md.tab-4?a=view"><tt>md.tab</tt>(4)</a>
man page.</p></li></ul>

<a name="troubleshoottasks-23827"></a><h4>How to Initialize Solaris Volume Manager From a Configuration File</h4>
<hr><p><b>Caution - </b><a name="troubleshoottasks-ix430"></a><a name="troubleshoottasks-ix431"></a>Use this procedure in the following circumstances:</p>
<ul><li><p>If you have experienced a complete loss of your Solaris Volume Manager configuration</p></li>
<li><p>If you have no configuration yet, and you want to create a configuration from a saved configuration file</p></li></ul>

<hr>
<p>On occasion, your system loses the information maintained in the state database. For
example, this loss might occur if the system was rebooted after all of
the state database replicas were deleted. As long as no volumes were created
after the state database was lost, you can use the <tt>md.cf</tt> or
<tt>md.tab</tt> files to recover your Solaris Volume Manager configuration.</p>
<hr><p><b>Note - </b>The <tt>md.cf</tt> file does not maintain information on active hot spares. Thus, if
hot spares were in use when the Solaris Volume Manager configuration was lost,
those volumes that were using active hot spares are likely corrupted.</p>
<hr>
<p>For more information about these files, see the <a href="http://docs.sun.com/doc/819-2251/md.cf-4?a=view"><tt>md.cf</tt>(4)</a> and the <a href="http://docs.sun.com/doc/819-2251/md.tab-4?a=view"><tt>md.tab</tt>(4)</a>
man pages.</p><ol>
<li><a name="troubleshoottasks-step-5"></a><b>Create state database replicas.</b><p>See <a href="tasks-state-db-replicas-9.html">Creating State Database Replicas</a> for more information.</p></li>
<li><a name="troubleshoottasks-step-6"></a><b><a name="troubleshoottasks-ix432"></a>Create or update the <tt>/etc/lvm/md.tab</tt> file.</b>
<ul><li><p>If you are attempting to recover the last known Solaris Volume Manager configuration, copy the <tt>md.cf</tt> file into the <tt>/etc/lvm/md.tab</tt> file.</p></li>
<li><p>If you are creating a new Solaris Volume Manager configuration based on a copy of the <tt>md.tab</tt> file that have you preserved, copy the preserved file into the <tt>/etc/lvm/md.tab</tt> file.</p></li></ul>
</li>
<li><a name="troubleshoottasks-step-8"></a><b>Edit the &ldquo;new&rdquo; <tt>/etc/lvm/md.tab</tt> file and do the following:</b>
<ul><li><p>If you are creating a new configuration or recovering a configuration after a crash, configure the mirrors as one-way mirrors. For example:</p><pre>d80 -m d81 1
d81 1 1 c1t6d0s3</pre><p>If the submirrors of a mirror are not the same size, be sure to use the smallest submirror for this one-way mirror. Otherwise, data could be lost.</p></li>
<li><p>If you are recovering an existing configuration and Solaris Volume Manager was cleanly stopped, leave the mirror configuration as multi-way mirrors. For example:</p><pre>d70 -m d71 d72 1
d71 1 1 c1t6d0s2
d72 1 1 c1t5d0s0</pre></li>
<li><p>Specify RAID-5 volumes with the <tt>-k</tt> option, to prevent reinitialization of the device. For example:</p><pre>d45 -r c1t3d0s5 c1t3d0s3 c1t3d0s4 -k -i 32b</pre><p>See the <a href="http://docs.sun.com/doc/819-2240/metainit-1m?a=view"><tt>metainit</tt>(1M)</a> man page for more information.</p></li></ul>
</li>
<li><a name="troubleshoottasks-step-9"></a><b><a name="troubleshoottasks-ix433"></a>Check the syntax of the <tt>/etc/lvm/md.tab</tt> file entries without committing changes by using
one of the following forms of the <tt>metainit </tt>command: </b><pre># <tt><b>metainit -n </tt><i>md.tab-entry</i><tt></b></tt></pre><pre># <tt><b>metainit -n -a</b></tt></pre><p>The <tt>metainit</tt> command does not maintain a hypothetical state of the devices that
might have been created while running with the <tt>-n</tt>, so creating volumes
that rely on other, nonexistent volumes will result in errors with the <tt>-n</tt>
even though the command may succeed without the <tt>-n</tt> option.</p><dl><dt><tt>-n</tt></dt>
<dd><p>Specifies not to actually create the devices. Use this option to verify that the results are as you expected.</p></dd>
<dt><i>md.tab-entry</i></dt>
<dd><p>Specifies the name of the component to initialize.</p></dd>
<dt><tt>-a</tt></dt>
<dd><p>Specifies to check all components.</p></dd>
</dl>
</li>
<li><a name="troubleshoottasks-step-10"></a><b>If no problems were apparent from the previous step, recreate the volumes and
hot spare pools from the <tt>md.tab</tt> file:</b><pre># <tt><b>metainit -a</b></tt></pre><dl><dt><tt>-a</tt></dt>
<dd><p>Specifies to activate the entries in the <tt>/etc/lvm/md.tab file</tt>.</p></dd>
</dl>
</li>
<li><a name="troubleshoottasks-step-11"></a><b><a name="troubleshoottasks-ix434"></a>As needed, make the one-way mirrors into multi-way mirrors by using the <tt>metattach</tt>
command.</b><pre># <tt><b>mettach </tt><i>mirror</i><tt> </tt><i>submirror</i><tt></b></tt></pre></li>
<li><a name="troubleshoottasks-step-12"></a><b>Validate the data on the volumes to confirm that the configuration has been
reconstructed accurately.</b><pre># <tt><b>metastat</b></tt></pre></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="tasks-basics-5.html">Previous</a>
             </td>
             <td align="right">
                 <a href="troubleshoottasks-13.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

