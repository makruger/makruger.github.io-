<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Removing RAID-1 Volumes (Unmirroring) - Solaris Volume Manager Administration Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2006-06-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">Solaris Volume Manager Administration Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="tasks-mirrors-25.html">Previous</a>
             </td>
             <td align="right">
                 <a href="tasks-mirrors-27.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="roadmap-10.html">1.&nbsp;&nbsp;Getting Started With Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="storage-overview-1.html">2.&nbsp;&nbsp;Storage Management Concepts</a></p>
<p class="toc level1 tocsp"><a href="basics-23185.html">3.&nbsp;&nbsp;Solaris Volume Manager Overview</a></p>
<p class="toc level1 tocsp"><a href="eoqra.html">4.&nbsp;&nbsp;Solaris Volume Manager for Sun Cluster (Overview)</a></p>
<p class="toc level1 tocsp"><a href="svm-scenario-1.html">5.&nbsp;&nbsp;Configuring and Using Solaris Volume Manager (Scenario)</a></p>
<p class="toc level1 tocsp"><a href="about-state-db-replicas-1.html">6.&nbsp;&nbsp;State Database (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-state-db-replicas-1.html">7.&nbsp;&nbsp;State Database (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-metadevices-22802.html">8.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-metadevices-1.html">9.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-mirrors-2.html">10.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-mirrors-1.html">11.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Tasks)</a></p>
<p class="toc level2"><a href="fpjwe.html">RAID-1 Volumes (Task Map)</a></p>
<p class="toc level2"><a href="tasks-mirrors-21.html">Creating a RAID-1 Volume</a></p>
<p class="toc level3"><a href="tasks-mirrors-21.html#addtasks-12543">How to Create a RAID-1 Volume From Unused Slices</a></p>
<p class="toc level3"><a href="tasks-mirrors-21.html#addtasks-18898">How to Create a RAID-1 Volume From a File System</a></p>
<p class="toc level3"><a href="tasks-mirrors-21.html#frkdb">SPARC: How to Create a RAID-1 Volume From the root (<tt>/</tt>) File System</a></p>
<p class="toc level3"><a href="tasks-mirrors-21.html#gcsdr">x86: How to Create a RAID-1 Volume From the root (<tt>/</tt>) File System</a></p>
<p class="toc level2 tocsp"><a href="tasks-mirrors-23.html">Working With Submirrors</a></p>
<p class="toc level3"><a href="tasks-mirrors-23.html#tasks-mirrors-8">How to Attach a Submirror</a></p>
<p class="toc level3"><a href="tasks-mirrors-23.html#tasks-mirrors-10">How to Detach a Submirror</a></p>
<p class="toc level3"><a href="tasks-mirrors-23.html#tasks-mirrors-12">How to Place a Submirror Offline and Online</a></p>
<p class="toc level3"><a href="tasks-mirrors-23.html#maintaintasksnew-14061">How to Enable a Slice in a Submirror</a></p>
<p class="toc level2 tocsp"><a href="tasks-mirrors-24.html">Maintaining RAID-1 Volumes</a></p>
<p class="toc level3"><a href="tasks-mirrors-24.html#maintaintasksnew-34973">How to View the Status of Mirrors and Submirrors</a></p>
<p class="toc level3"><a href="tasks-mirrors-24.html#tasks-mirrors-15">How to Change RAID-1 Volume Options</a></p>
<p class="toc level3"><a href="tasks-mirrors-24.html#maintaintasksnew-15601">How to Expand a RAID-1 Volume</a></p>
<p class="toc level3"><a href="tasks-mirrors-24.html#fpklu">How to Cancel a Volume Resynchronization Process</a></p>
<p class="toc level3"><a href="tasks-mirrors-24.html#fpkkx">How to Resume a Volume Resynchronization Process</a></p>
<p class="toc level2 tocsp"><a href="tasks-mirrors-25.html">Responding to RAID-1 Volume Component Failures</a></p>
<p class="toc level3"><a href="tasks-mirrors-25.html#maintaintasksnew-11508">How to Replace a Slice in a Submirror</a></p>
<p class="toc level3"><a href="tasks-mirrors-25.html#maintaintasksnew-10199">How to Replace a Submirror</a></p>
<div class="onpage">
<p class="toc level2 tocsp"><a href="">Removing RAID-1 Volumes (Unmirroring)</a></p>
<p class="toc level3"><a href="#tasks-mirrors-3">How to Unmirror a File System</a></p>
<p class="toc level3"><a href="#tasks-mirrors-5">How to Unmirror a File System That Cannot Be Unmounted</a></p>
</div>
<p class="toc level2 tocsp"><a href="tasks-mirrors-27.html">Backing Up Data on a RAID-1 Volume</a></p>
<p class="toc level3"><a href="tasks-mirrors-27.html#tipsandtricks-36804">How to Perform an Online Backup of a RAID-1 Volume</a></p>
<p class="toc level1 tocsp"><a href="about-softpart-1.html">12.&nbsp;&nbsp;Soft Partitions (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-softpart-1.html">13.&nbsp;&nbsp;Soft Partitions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-raid5-1.html">14.&nbsp;&nbsp;RAID-5 Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-raid5-1.html">15.&nbsp;&nbsp;RAID-5 Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-hotspares-40444.html">16.&nbsp;&nbsp;Hot Spare Pools (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-hotspares-1.html">17.&nbsp;&nbsp;Hot Spare Pools (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-disksets-31856.html">18.&nbsp;&nbsp;Disk Sets (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-disksets-1.html">19.&nbsp;&nbsp;Disk Sets (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-basics-2.html">20.&nbsp;&nbsp;Maintaining Solaris Volume Manager (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="best-practices-1.html">21.&nbsp;&nbsp;Best Practices for Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="topdown-overview.html">22.&nbsp;&nbsp;Top-Down Volume Creation (Overview)</a></p>
<p class="toc level1 tocsp"><a href="topdown-tasks-chap.html">23.&nbsp;&nbsp;Top-Down Volume Creation (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-snmp-1.html">24.&nbsp;&nbsp;Monitoring and Error Reporting (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="troubleshoottasks-33506.html">25.&nbsp;&nbsp;Troubleshooting Solaris Volume Manager (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="appendfiles-1.html">A.&nbsp;&nbsp;Important Solaris Volume Manager Files</a></p>
<p class="toc level1 tocsp"><a href="quick-reference-1.html">B.&nbsp;&nbsp;Solaris Volume Manager Quick Reference</a></p>
<p class="toc level1 tocsp"><a href="append-cim-wbem-1.html">C.&nbsp;&nbsp;Solaris Volume Manager CIM/WBEM API</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="tasks-mirrors-26"></a><h3>Removing RAID-1 Volumes (Unmirroring)</h3>


<a name="tasks-mirrors-3"></a><h4>How to Unmirror a File System</h4><p>Use this procedure to unmirror a file system that can be unmounted
while the system is running. To unmirror root (<tt>/</tt>), <tt>/var</tt>, <tt>/usr</tt>, or <tt>swap</tt>,
or any other file system that cannot be unmounted while the system is
running, see <a href="#tasks-mirrors-5">How to Unmirror a File System That Cannot Be Unmounted</a>.</p><h6>Before You Begin</h6><p>Read <a href="eyaso.html">Creating and Maintaining RAID-1 Volumes</a>.</p><ol>
<li><a name="tasks-mirrors-step-149"></a><b>Make sure that you have root privilege and that you have a current
backup of all data.</b></li>
<li><a name="tasks-mirrors-step-107"></a><b>Verify that at least one submirror is in the Okay state.</b><pre># <tt><b>metastat </tt><i>mirror</i><tt></b></tt></pre></li>
<li><a name="tasks-mirrors-step-108"></a><b>Unmount the file system.</b><pre># <tt><b>umount </tt><i>/file-system</i><tt></b></tt></pre></li>
<li><a name="tasks-mirrors-step-109"></a><b><a name="indexterm-88"></a>Detach the submirror that will continue to be used for the file system.</b><pre># <tt><b>metadetach </tt><i>mirror</i><tt> </tt><i>submirror</i><tt></b></tt></pre><p>For more information, see the <a href="http://docs.sun.com/doc/819-2240/metadetach-1m?a=view"><tt>metadetach</tt>(1M)</a> man page.</p></li>
<li><a name="tasks-mirrors-step-110"></a><b><a name="indexterm-89"></a>Clear the mirror and remaining subcomponents.</b><pre># <tt><b>metaclear -r </tt><i>mirror</i><tt></b></tt></pre><p>For more information, see the <a href="http://docs.sun.com/doc/819-2240/metaclear-1m?a=view"><tt>metaclear</tt>(1M)</a> man page.</p></li>
<li><a name="tasks-mirrors-step-111"></a><b>Edit the <tt>/etc/vfstab</tt> file to use the component detached in <a href="#tasks-mirrors-step-109">Step&nbsp;4</a>, if necessary.</b></li>
<li><a name="tasks-mirrors-step-112"></a><b>Remount the file system.</b><pre># <tt><b>mount </tt><i>/file-system</i><tt></b></tt></pre></li></ol><a name="eypfd"></a>Example&nbsp;11-21 Unmirroring the <tt>/opt</tt> File System<pre># <tt><b>metastat d4</b></tt>
d4: Mirror
    Submirror 0: d2
      State: Okay        
    Submirror 1: d3
      State: Okay        
    Pass: 1
    Read option: roundrobin (default)
    Write option: parallel (default)
    Size: 2100735 blocks (1.0 GB)

d2: Submirror of d4
    State: Okay         
    Size: 2100735 blocks (1.0 GB)
    Stripe 0:
        Device     Start Block  Dbase        State Reloc Hot Spare
        c0t0d0s0          0     No            Okay   Yes 


d3: Submirror of d4
    State: Okay         
    Size: 2100735 blocks (1.0 GB)
    Stripe 0:
        Device     Start Block  Dbase        State Reloc Hot Spare
        c1t0d0s0          0     No            Okay   Yes 

...
# <tt><b>umount /opt</b></tt>
# <tt><b>metadetach d4 d2</b></tt>
d4: submirror d2 is detached
# <tt><b>metaclear -r d4</b></tt>
d4: Mirror is cleared
d3: Concat/Stripe is cleared
(Edit the /etc/vfstab file so that the entry for /opt is changed from d4 to the underlying slice or volume)
# <tt><b>mount /opt</b></tt></pre><p>In this example, the <tt>/opt</tt> file system is composed of a two-way mirror,
<tt>d4</tt>. The submirrors of the mirror are <tt>d2</tt> and <tt>d3</tt>. The submirrors are composed
of slices <tt>/dev/dsk/c0t0d0s0</tt> and <tt>/dev/dsk/c1t0d0s0</tt>. The <tt>metastat</tt> command verifies that at least one
submirror is in the &ldquo;Okay&rdquo; state. (A mirror with no submirrors in the
&ldquo;Okay&rdquo; state must be repaired first.) The file system is unmounted. Then, submirror
<tt>d2</tt> is detached. The <tt>metaclear <tt>-r</tt></tt> command deletes the mirror and the other
submirror, <tt>d3</tt>.</p><p>Next, the entry for <tt>/opt</tt> in the <tt>/etc/vfstab</tt> file is changed to reference
the underlying slice.</p><p>In this example the <tt>/etc/vfstab file</tt> contains the following entry for the <tt>/opt</tt> file
system:</p><pre>/dev/md/dsk/d4  /dev/md/rdsk/d4  /opt ufs  2  yes -</pre><p>Change the entry to read as follows:</p><pre>/dev/md/dsk/d2  /dev/md/rdsk/d2  /opt ufs  2  yes -</pre><p>By using the submirror name, you can continue to have the file
system mounted on a volume. Finally, the <tt>/opt</tt> file system is remounted.</p><p><a name="indexterm-90"></a>By using <tt>d2</tt> instead of <tt>d4</tt> in the <tt>/etc/vfstab</tt> file, you have unmirrored
the mirror. Because <tt>d2</tt> consists of a single slice, you can mount the file
system on the slice name (<tt>/dev/dsk/c0t0d0s0</tt>) if you do not want the device
to support a volume. </p>

<a name="tasks-mirrors-5"></a><h4>How to Unmirror a File System That Cannot Be Unmounted</h4><a name="indexterm-91"></a><p>Use this task to unmirror file systems, including root (<tt>/</tt>), <tt>/usr</tt>, <tt>/opt</tt>,
and <tt>swap</tt>, that cannot be unmounted during normal system operation.</p><ol>
<li><b>Make sure that you have root privilege and that you have a
current backup of all data.</b></li>
<li><a name="tasks-mirrors-step-114"></a><b>Verify that at least one submirror is in the Okay state.</b><pre># <tt><b>metastat </tt><i>mirror</i><tt></b></tt></pre></li>
<li><a name="tasks-mirrors-step-115"></a><b>Detach the submirror that will continue to be used for the file system.</b><pre># <tt><b>metadetach </tt><i>mirror</i><tt> </tt><i>submirror</i><tt></b></tt></pre><p>For more information, see the <a href="http://docs.sun.com/doc/819-2240/metadetach-1m?a=view"><tt>metadetach</tt>(1M)</a> man page.</p></li>
<li><b>Use one of the following commands, depending the file system you want to
unmirror:</b>
<ul><li><p>For the <tt>/usr</tt>, <tt>/opt</tt>, or <tt>swap</tt> file systems, change the file system entry in the <tt>/etc/vfstab</tt> file to use a non-Solaris Volume Manager device (slice).</p></li>
<li><p>For the root (<tt>/</tt>) file system <b>only</b>: run the <tt>metaroot</tt> command.</p><pre># <tt><b>metaroot </tt><i>rootslice</i><tt></b></tt></pre><p>For more information, see the <a href="http://docs.sun.com/doc/819-2240/metaroot-1m?a=view"><tt>metaroot</tt>(1M)</a> man page.</p></li></ul>
</li>
<li><a name="tasks-mirrors-step-118"></a><b>Reboot the system.</b><pre># <tt><b>reboot</b></tt></pre></li>
<li><a name="tasks-mirrors-step-119"></a><b>Clear the remaining mirror and submirrors.</b><pre># <tt><b>metaclear -r </tt><i>mirror</i><tt></b></tt></pre><p>For more information, see the <a href="http://docs.sun.com/doc/819-2240/metaclear-1m?a=view"><tt>metaclear</tt>(1M)</a> man page.</p></li></ol><a name="egjyl"></a>Example&nbsp;11-22 Unmirroring the root (<tt>/</tt>) File System<pre># <tt><b>metastat d0</b></tt>
d0: Mirror
    Submirror 0: d10
      State: Okay        
    Submirror 1: d20
      State: Okay        
    Pass: 1
    Read option: roundrobin (default)
    Write option: parallel (default)
    Size: 2100735 blocks (1.0 GB)

d10: Submirror of d0
    State: Okay         
    Size: 2100735 blocks (1.0 GB)
    Stripe 0:
        Device     Start Block  Dbase        State Reloc Hot Spare
        c0t3d0s0          0     No            Okay   Yes 


d20: Submirror of d0
    State: Okay         
    Size: 2100735 blocks (1.0 GB)
    Stripe 0:
        Device     Start Block  Dbase        State Reloc Hot Spare
        c1t3d0s0          0     No            Okay   Yes 


# <tt><b>metadetach d0 d20</b></tt>
d0: submirror d20 is detached
# <tt><b>metaroot /dev/dsk/c0t3d0s0</b></tt>
# <tt><b>reboot</b></tt>
...
# <tt><b>metaclear -r d0</b></tt>
d0: Mirror is cleared
d10: Concat/Stripe is cleared
# <tt><b>metaclear d20</b></tt>
d20: Concat/Stripe is cleared</pre><p>In this example, the root (<tt>/</tt>) file system is a two-way mirror, <tt>d0</tt>.
The submirrors of the mirror are <tt>d10</tt> and <tt>d20</tt>. The submirrors are
composed of slices <tt>/dev/dsk/c0t3d0s0</tt> and <tt>/dev/dsk/c1t3d0s0</tt>. The <tt>metastat</tt> command verifies that at least one
submirror is in the &ldquo;Okay&rdquo; state. (A mirror with no submirrors in the
&ldquo;Okay&rdquo; state must be repaired first.) Submirror <tt>d20</tt> is detached to make <tt>d0</tt> a
one-way mirror.</p><p>The rootslice is the slice containing the root (<tt>/</tt>) file system. The <tt>metaroot</tt> command is
run, using the <i>rootslice</i> from which the system is going to boot. This
command edits the <tt>/etc/system</tt> and <tt>/etc/vfstab</tt> files. The command removes information that
specifies mirroring of the root (<tt>/</tt>) file system.</p><p>After rebooting the system, the <tt>metaclear <tt>-r</tt></tt> command deletes the mirror and the other
submirror, <tt>d10</tt>. The last <tt>metaclear</tt> command clears submirror <tt>d20</tt>.</p><a name="egjyt"></a>Example&nbsp;11-23 Unmirroring the <tt>swap</tt> File System<pre># <tt><b>metastat d1</b></tt>
d1: Mirror
    Submirror 0: d11
      State: Okay        
    Submirror 1: d21
      State: Okay        
...
# <tt><b>metadetach d1 d21</b></tt>
d1: submirror d21 is detached
(Edit the /etc/vfstab file to change the entry for swap from metadevice to slice name)
# <tt><b>reboot</b></tt>
...
# <tt><b>metaclear -r d1</b></tt>
d1: Mirror is cleared
d11: Concat/Stripe is cleared
# <tt><b>metaclear d21</b></tt>
d21: Concat/stripe is cleared</pre><p><a name="indexterm-92"></a>In this example, the <tt>swap</tt> file system is made of a two-way mirror,
<tt>d1</tt>. The submirrors of the mirror are <tt>d11</tt> and <tt>d21</tt>. The submirrors are composed
of slices <tt>/dev/dsk/c0t3d0s1</tt> and <tt>/dev/dsk/c1t3d0s1</tt>. The <tt>metastat</tt> command verifies that at least one
submirror is in the &ldquo;Okay&rdquo; state. (A mirror with no submirrors in the
&ldquo;Okay&rdquo; state must be repaired first.) Submirror <tt>d21</tt> is detached to make <tt>d1</tt>
a one-way mirror. Next, the <tt>/etc/vfstab</tt> file is edited to change the
entry for <tt>swap</tt> to reference the slice that is in submirror <tt>d21</tt>.</p><p>In this example, the <tt>/etc/vfstab file</tt> contains the following entry for the <tt>swap</tt> file
system:</p><pre>/dev/md/dsk/d4  /dev/md/rdsk/d4  /opt ufs  2  yes -</pre><pre>/dev/md/dsk/d1 - - swap - no -</pre><p>Change the entry to read as follows:</p><pre>/dev/dsk/c0t3d0s1 - - swap - no -</pre><p><a name="indexterm-93"></a>After rebooting the system, the <tt>metaclear <tt>-r</tt></tt> command deletes the mirror and the other
submirror, <tt>d11</tt>. The final <tt>metaclear</tt> command clears submirror <tt>d21</tt>. </p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="tasks-mirrors-25.html">Previous</a>
             </td>
             <td align="right">
                 <a href="tasks-mirrors-27.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

