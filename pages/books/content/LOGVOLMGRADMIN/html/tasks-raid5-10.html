<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Maintaining RAID-5 Volumes - Solaris Volume Manager Administration Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2006-06-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">Solaris Volume Manager Administration Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="tasks-raid5-6.html">Previous</a>
             </td>
             <td align="right">
                 <a href="about-hotspares-40444.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="roadmap-10.html">1.&nbsp;&nbsp;Getting Started With Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="storage-overview-1.html">2.&nbsp;&nbsp;Storage Management Concepts</a></p>
<p class="toc level1 tocsp"><a href="basics-23185.html">3.&nbsp;&nbsp;Solaris Volume Manager Overview</a></p>
<p class="toc level1 tocsp"><a href="eoqra.html">4.&nbsp;&nbsp;Solaris Volume Manager for Sun Cluster (Overview)</a></p>
<p class="toc level1 tocsp"><a href="svm-scenario-1.html">5.&nbsp;&nbsp;Configuring and Using Solaris Volume Manager (Scenario)</a></p>
<p class="toc level1 tocsp"><a href="about-state-db-replicas-1.html">6.&nbsp;&nbsp;State Database (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-state-db-replicas-1.html">7.&nbsp;&nbsp;State Database (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-metadevices-22802.html">8.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-metadevices-1.html">9.&nbsp;&nbsp;RAID-0 (Stripe and Concatenation) Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-mirrors-2.html">10.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-mirrors-1.html">11.&nbsp;&nbsp;RAID-1 (Mirror) Volumes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-softpart-1.html">12.&nbsp;&nbsp;Soft Partitions (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-softpart-1.html">13.&nbsp;&nbsp;Soft Partitions (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-raid5-1.html">14.&nbsp;&nbsp;RAID-5 Volumes (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-raid5-1.html">15.&nbsp;&nbsp;RAID-5 Volumes (Tasks)</a></p>
<p class="toc level2"><a href="tasks-raid5-26.html">RAID-5 Volumes (Task Map)</a></p>
<p class="toc level2"><a href="tasks-raid5-6.html">Creating RAID-5 Volumes</a></p>
<p class="toc level3"><a href="tasks-raid5-6.html#addtasks-30654">How to Create a RAID-5 Volume</a></p>
<div class="onpage">
<p class="toc level2 tocsp"><a href="">Maintaining RAID-5 Volumes</a></p>
<p class="toc level3"><a href="#maintaintasksnew-28175">How to Check the Status of a RAID-5 Volume</a></p>
<p class="toc level3"><a href="#maintaintasksnew-13229">How to Expand a RAID-5 Volume</a></p>
<p class="toc level3"><a href="#maintaintasksnew-31120">How to Enable a Component in a RAID-5 Volume</a></p>
<p class="toc level3"><a href="#maintaintasksnew-14708">How to Replace a Component in a RAID-5 Volume</a></p>
</div>
<p class="toc level1 tocsp"><a href="about-hotspares-40444.html">16.&nbsp;&nbsp;Hot Spare Pools (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-hotspares-1.html">17.&nbsp;&nbsp;Hot Spare Pools (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="about-disksets-31856.html">18.&nbsp;&nbsp;Disk Sets (Overview)</a></p>
<p class="toc level1 tocsp"><a href="tasks-disksets-1.html">19.&nbsp;&nbsp;Disk Sets (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-basics-2.html">20.&nbsp;&nbsp;Maintaining Solaris Volume Manager (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="best-practices-1.html">21.&nbsp;&nbsp;Best Practices for Solaris Volume Manager</a></p>
<p class="toc level1 tocsp"><a href="topdown-overview.html">22.&nbsp;&nbsp;Top-Down Volume Creation (Overview)</a></p>
<p class="toc level1 tocsp"><a href="topdown-tasks-chap.html">23.&nbsp;&nbsp;Top-Down Volume Creation (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tasks-snmp-1.html">24.&nbsp;&nbsp;Monitoring and Error Reporting (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="troubleshoottasks-33506.html">25.&nbsp;&nbsp;Troubleshooting Solaris Volume Manager (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="appendfiles-1.html">A.&nbsp;&nbsp;Important Solaris Volume Manager Files</a></p>
<p class="toc level1 tocsp"><a href="quick-reference-1.html">B.&nbsp;&nbsp;Solaris Volume Manager Quick Reference</a></p>
<p class="toc level1 tocsp"><a href="append-cim-wbem-1.html">C.&nbsp;&nbsp;Solaris Volume Manager CIM/WBEM API</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="tasks-raid5-10"></a><h3>Maintaining RAID-5 Volumes</h3>


<a name="maintaintasksnew-28175"></a><h4>How to Check the Status of a RAID-5 Volume</h4><a name="indexterm-113"></a><p>When checking status of RAID-5 volumes, you need to check both the
RAID-5 state and the slice state to fully understand the state of the
volume and the possibility of data loss if the volumes are not in
an Okay state. See <a href="egcls.html">Overview of Checking Status of RAID-5 Volumes</a> for details.</p>
<hr><p><b>Note - </b>RAID-5 volume initialization or resynchronization cannot be interrupted. </p>
<hr>
<ul>
<li><a name="tasks-raid5-step-12"></a><b>To check the status of a RAID-5 volume, use one of the following
methods:</b>
<ul><li><p>From the Enhanced Storage tool within the Solaris Management Console, open the Volumes node and view the status of the volumes. Choose a volume. Then, choose Action&rArr;Properties to see more detailed information. For more information, see the online help.</p></li>
<li><p>Use the <tt>metastat</tt> command to display the status of a RAID-5 volume.</p><pre># <tt><b>metastat [-s </tt><i>diskset</i><tt>] [</tt><i>volume</i><tt>]</b></tt></pre><dl><dt><tt>-s</tt> <i>diskset</i></dt>
<dd><p>Specifies the name of the disk set on which to perform the command.</p></dd>
<dt><i>volume</i></dt>
<dd><p>Specifies the volume to display.</p></dd>
</dl>
<p>For each slice in the RAID-5 volume, the <tt>metastat</tt> command shows the following:</p><dl><dt>Device</dt>
<dd><p>Specifies the device name of the slice in the stripe.</p></dd>
<dt>Start Block</dt>
<dd><p>Specifies the block on which the slice begins.</p></dd>
<dt>Dbase</dt>
<dd><p>Specifies whether the slice contains a state database replica</p></dd>
<dt>State</dt>
<dd><p>Specifies the state of the slice.</p></dd>
<dt>Hot Spare</dt>
<dd><p>Specifies whether the slice is being used to hot spare a failed slice</p></dd>
</dl>
</li></ul>
</li></ul><a name="egjxh"></a>Example&nbsp;15-2 Viewing RAID-5 Volume Status<p><a name="maintaintasksnew-ix198"></a>The following example shows RAID-5 volume output from the <tt>metastat</tt> command. </p><pre># <tt><b>metastat d10</b></tt>
d10: RAID
    State: Okay        
    Interlace: 32 blocks
    Size: 10080 blocks
Original device:
    Size: 10496 blocks
        Device              Start Block  Dbase State        Hot Spare
        c0t0d0s1                 330     No    Okay        
        c1t2d0s1                 330     No    Okay        
        c2t3d0s1                 330     No    Okay </pre><p>The <tt>metastat</tt> command output identifies the volume as a RAID-5 volume. This information
is indicated by the &ldquo;RAID&rdquo; notation after the volume name. For each slice
in the RAID-5 volume, the output shows the following:</p>
<ul><li><p>The name of the slice in the stripe.</p></li>
<li><p>The block on which the slice begins.</p></li>
<li><p>An indicator that none of these slices contain a state database replica.</p></li>
<li><p>The state of the slices. In this example all slices are in the &ldquo;Okay&rdquo; state.</p></li>
<li><p>If a slice is a hot spare replacement for a failed slice.</p></li></ul>


<a name="maintaintasksnew-13229"></a><h4>How to Expand a RAID-5 Volume</h4><a name="indexterm-114"></a><p>In general, attaching components is a short-term solution to a RAID-5 volume that
is running out of space. For performance reasons, it is best to have
a &ldquo;pure&rdquo; RAID-5 volume. If you must expand an existing RAID-5 volume to
gain extra storage space, use this procedure. </p>
<hr><p><b>Caution - </b>Do not create volumes larger than 1 Tbyte if you expect to run
the Solaris software with a 32&ndash;bit kernel or if you expect to
use a version of the Solaris OS prior to the Solaris 9 4/03
release. See <a href="large-volume-overview.html">Overview of Multi-Terabyte Support in Solaris Volume Manager</a> for more information about multiterabyte volume support in Solaris Volume
Manager.</p>
<hr>
<h6>Before You Begin</h6><p>Read <a href="addtasks-25668.html">Background Information for Creating RAID-5 Volumes</a>.</p><ol>
<li><a name="tasks-raid5-step-26"></a><b>Make sure that you have a current backup of all data and that
you have superuser access.</b></li>
<li><a name="tasks-raid5-step-17"></a><b>To attach additional components to a RAID-5 volume, use one of the following
methods:</b>
<ul><li><p>From the Enhanced Storage tool within the Solaris Management Console, open the Volumes node, then open the RAID-5 volume. Choose the Components pane. Then, choose Attach Component. Follow the onscreen instructions. For more information, see the online help.</p></li>
<li><p>Use the following form of the <tt>metattach</tt> command:</p><pre># <tt><b>metattach </tt><i>volume-name</i><tt> </tt><i>name-of-component-to-add</i><tt></b></tt></pre><dl><dt><i>volume-name</i></dt>
<dd><p>Specifies the name of the RAID-5 volume to expand.</p></dd>
<dt><i>name-of-component-to-add</i></dt>
<dd><p>Specifies the name of the component to attach to the RAID-5 volume.</p></dd>
</dl>
<p><a name="maintaintasksnew-ix287"></a>See the <a href="http://docs.sun.com/doc/819-2240/metattach-1m?a=view"><tt>metattach</tt>(1M)</a> man page for more information. </p></li></ul>
</li></ol><a name="egjxi"></a>Example&nbsp;15-3 Adding a Component to a RAID-5 Volume<p><a name="maintaintasksnew-ix289"></a>The following example shows the addition of slice <tt>c2t1d0s2</tt> to an existing RAID-5
volume, <tt>d2</tt>. </p><pre># <tt><b>metattach d2 c2t1d0s2</b></tt>
d2: column is attached</pre><h6>See Also</h6><p>For a UFS file system, run the <tt>growfs</tt> command on the RAID-5 volume.
See <a href="basics-42385.html#basics-18534">Volume and Disk Space Expansion Using the <tt>growfs</tt> Command</a>.</p><p>Some applications, such as a database, do not use a file system.
These applications instead use the raw volume. In these cases, the application must have
its own way of growing the added space.</p>

<a name="maintaintasksnew-31120"></a><h4>How to Enable a Component in a RAID-5 Volume</h4><a name="indexterm-115"></a><p>If a disk drive is defective, you can replace it with another
available disk (and its slices) on the system as documented in <a href="#maintaintasksnew-14708">How to Replace a Component in a RAID-5 Volume</a>. Alternatively,
you can repair the disk, label it, and run the <tt>metareplace</tt> command with
the <tt>-e</tt> option to re-enable the disk.</p><ol>
<li><a name="tasks-raid5-step-260"></a><b>Make sure that you have a current backup of all data and that
you have superuser access.</b></li>
<li><a name="tasks-raid5-step-20"></a><b>To enable a failed component in a RAID-5 volume, use one of the
following methods:</b>
<ul><li><p>From the Enhanced Storage tool within the Solaris Management Console, open the Volumes node, then open the RAID-5 volume. Choose the Components pane. Then, choose the failed component. Click Enable Component. Follow the onscreen instructions. For more information, see the online help.</p></li>
<li><p>Use the following form of the <tt>metareplace</tt> command:</p><pre># <tt><b>metareplace -e </tt><i>volume-name</i><tt> </tt><i>component-name</i><tt></b></tt></pre><dl><dt><tt>-e</tt></dt>
<dd><p>Specifies to place the failed component into an available state and to perform a resynchronization on the failed component.</p></dd>
<dt><i>volume-name</i></dt>
<dd><p>Specifies the name of the volume containing the failed component.</p></dd>
<dt><i>component-name</i></dt>
<dd><p>Specifies the name of the failed component.</p></dd>
</dl>
<p><a name="maintaintasksnew-ix244"></a>The <tt>metareplace</tt> command automatically starts resynchronizing the new component with the rest of the RAID-5 volume. </p></li></ul>
</li></ol><a name="egjxj"></a>Example&nbsp;15-4 Enabling a Component in a RAID-5 Volume<p><a name="maintaintasksnew-ix245"></a><a name="maintaintasksnew-ix246"></a>In the following example, the RAID-5 volume <tt>d20</tt> has a slice, <tt>c2t0d0s2</tt>, which
had a soft error. The <tt>metareplace</tt> command with the <tt>-e</tt> option enables
the slice.</p><pre># <tt><b>metareplace -e d20 c2t0d0s2</b></tt></pre>

<a name="maintaintasksnew-14708"></a><h4>How to Replace a Component in a RAID-5 Volume</h4><a name="indexterm-116"></a><p>This task replaces a failed slice of a RAID-5 volume in which
only one slice has failed.</p>
<hr><p><b>Caution - </b>Replacing a failed slice when multiple slices are in error might cause data
to be fabricated. In this instance, the integrity of the data in this
instance would be questionable.</p>
<hr>
<p>You can use the <tt>metareplace</tt> command on non-failed devices to change a disk
slice or other component. This procedure can be useful for tuning the performance
of RAID-5 volumes.</p><ol>
<li><a name="tasks-raid5-step-27"></a><b>Make sure that you have a current backup of all data and that
you have superuser access.</b></li>
<li><a name="tasks-raid5-step-23"></a><b>Use one of the following methods to determine which slice of the RAID-5
volume needs to be replaced:</b>
<ul><li><p>From the Enhanced Storage tool within the Solaris Management Console, open the Volumes node. Then open the RAID-5 volume. Choose the Components pane. View the status of the individual components. For more information, see the online help.</p></li>
<li><p>Use the <tt>metastat</tt> command.</p><pre># <tt><b>metastat </tt><i>volume</i><tt></b></tt></pre><dl><dt><i>volume</i></dt>
<dd><p>Specifies the name of the RAID-5 volume.</p></dd>
</dl>
</li></ul>
<p>Look for the keyword phrase &ldquo;Needs Maintenance&rdquo; to identify the state of the
RAID-5 volume. Look for the keyword &ldquo;Maintenance&rdquo; to identify the failed slice.</p></li>
<li><a name="tasks-raid5-step-24"></a><b>Use one of the following methods to replace the failed slice with another
slice:</b>
<ul><li><p>From the Enhanced Storage tool within the Solaris Management Console, open the Volumes node. Then open the RAID-5 volume. Choose the Components pane. Choose the failed component. Click Replace Component and follow the onscreen instructions. For more information, see the online help.</p></li>
<li><p>Use the following form of the <tt>metareplace</tt> command:</p><pre># <tt><b>metareplace </tt><i>volume-name</i><tt> </tt><i>failed-component</i><tt> </tt><i>new-component</i><tt></b></tt></pre>
<ul><li><p><i>volume-name</i> is the name of the RAID-5 volume with a failed component.</p></li>
<li><p><i>failed-component</i> specifies the name of the component to replace.</p></li>
<li><p><i>new-component</i> specifies the name of the component to add to the volume in place of the failed component.</p></li></ul>
<p>See the <a href="http://docs.sun.com/doc/819-2240/metareplace-1m?a=view"><tt>metareplace</tt>(1M)</a> man page for more information.</p></li></ul>
</li>
<li><a name="tasks-raid5-step-25"></a><b>To verify the status of the replacement slice, use one of the methods
described in <a href="#tasks-raid5-step-23">Step&nbsp;2</a>.</b><p>The state of the replaced slice should be &ldquo;Resyncing&rdquo; or &ldquo;Okay.&rdquo;</p></li></ol><a name="egjxn"></a>Example&nbsp;15-5 Replacing a RAID-5 Component<pre># <tt><b>metastat d1</b></tt>
d1: RAID
State: Needs Maintenance
    Invoke: metareplace d1 c0t14d0s6 &lt;new device>
    Interlace: 32 blocks
    Size: 8087040 blocks
Original device:
    Size: 8087520 blocks
    Device              Start Block  Dbase State        Hot Spare
    c0t9d0s6                 330     No    Okay        
    c0t13d0s6                330     No    Okay        
    c0t10d0s6                330     No    Okay        
    c0t11d0s6                330     No    Okay        
    c0t12d0s6                330     No    Okay        
    c0t14d0s6                330     No    Maintenance
 
# <tt><b>metareplace d1 c0t14d0s6 c0t4d0s6</b></tt>
d1: device c0t14d0s6 is replaced with c0t4d0s6
# <tt><b>metastat d1</b></tt>
d1: RAID
    State: Resyncing
    Resync in progress: 98% done
    Interlace: 32 blocks
    Size: 8087040 blocks
Original device:
    Size: 8087520 blocks
    Device              Start Block  Dbase State        Hot Spare
    c0t9d0s6                 330     No    Okay        
    c0t13d0s6                330     No    Okay        
    c0t10d0s6                330     No    Okay        
    c0t11d0s6                330     No    Okay        
    c0t12d0s6                330     No    Okay
    c0t4d0s6                 330     No    Resyncing</pre><p><a name="maintaintasksnew-ix249"></a>In this example, the <tt>metastat</tt> command displays the failed slice in the RAID-5
volume, <tt>d1</tt>. After locating an available slice, the <tt>metareplace</tt> command is run, specifying the
failed slice first, then the replacement slice.</p><p>If no other slices are available, run the <tt>metareplace</tt> command with the <tt>-e</tt>
option to attempt to recover from possible soft errors by resynchronizing the failed
device. For more information on this procedure, see <a href="#maintaintasksnew-31120">How to Enable a Component in a RAID-5 Volume</a>. If multiple errors exist,
the slice in the &ldquo;Maintenance&rdquo; state must first be replaced or enabled. Then
the slice in the &ldquo;Last Erred&rdquo; state can be repaired. After running the
<tt>metareplace</tt> command, you can use the <tt>metastat</tt> command to monitor the progress of the
resynchronization. During the replacement, the state of the volume and the new slice
is &ldquo;Resyncing.&rdquo; You can continue to use the volume while it is in
this state.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="tasks-raid5-6.html">Previous</a>
             </td>
             <td align="right">
                 <a href="about-hotspares-40444.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

