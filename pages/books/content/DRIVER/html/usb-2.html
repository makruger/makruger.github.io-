<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>USB in the Solaris Environment - Writing Device Drivers</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">Writing Device Drivers</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="usb-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="usb-7.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="eqbvu.html">Part&nbsp;I&nbsp;Designing Device Drivers for the Solaris Platform</a></p>
<p class="toc level2"><a href="eqbqn.html">1.&nbsp;&nbsp;Overview of Solaris Device Drivers</a></p>
<p class="toc level2"><a href="kernelovr-77198.html">2.&nbsp;&nbsp;Solaris Kernel and Device Tree</a></p>
<p class="toc level2"><a href="mt-17026.html">3.&nbsp;&nbsp;Multithreading</a></p>
<p class="toc level2"><a href="properties-1.html">4.&nbsp;&nbsp;Properties</a></p>
<p class="toc level2"><a href="events-1.html">5.&nbsp;&nbsp;Managing Events and Queueing Tasks</a></p>
<p class="toc level2"><a href="autoconf-17.html">6.&nbsp;&nbsp;Driver Autoconfiguration</a></p>
<p class="toc level2"><a href="devaccess-3.html">7.&nbsp;&nbsp;Device Access: Programmed I/O</a></p>
<p class="toc level2"><a href="interrupt-15678.html">8.&nbsp;&nbsp;Interrupt Handlers</a></p>
<p class="toc level2"><a href="dma-29901.html">9.&nbsp;&nbsp;Direct Memory Access (DMA)</a></p>
<p class="toc level2"><a href="devmap-24338.html">10.&nbsp;&nbsp;Mapping Device and Kernel Memory</a></p>
<p class="toc level2"><a href="devcnmgt-19679.html">11.&nbsp;&nbsp;Device Context Management</a></p>
<p class="toc level2"><a href="powermgt-37437.html">12.&nbsp;&nbsp;Power Management</a></p>
<p class="toc level2"><a href="gevsi.html">13.&nbsp;&nbsp;Hardening Solaris Drivers</a></p>
<p class="toc level2"><a href="ldi-1.html">14.&nbsp;&nbsp;Layered Driver Interface (LDI)</a></p>
<p class="toc level1 tocsp"><a href="eqbvb.html">Part&nbsp;II&nbsp;Designing Specific Kinds of Device Drivers</a></p>
<p class="toc level2"><a href="character-21002.html">15.&nbsp;&nbsp;Drivers for Character Devices</a></p>
<p class="toc level2"><a href="block-34861.html">16.&nbsp;&nbsp;Drivers for Block Devices</a></p>
<p class="toc level2"><a href="scsi-36812.html">17.&nbsp;&nbsp;SCSI Target Drivers</a></p>
<p class="toc level2"><a href="scsihba-32898.html">18.&nbsp;&nbsp;SCSI Host Bus Adapter Drivers</a></p>
<p class="toc level2"><a href="gld-1.html">19.&nbsp;&nbsp;Drivers for Network Devices</a></p>
<p class="toc level2"><a href="usb-1.html">20.&nbsp;&nbsp;USB Drivers</a></p>
<div class="onpage">
<p class="toc level3"><a href="">USB in the Solaris Environment</a></p>
</div>
<p class="toc level3"><a href="usb-7.html">Binding Client Drivers</a></p>
<p class="toc level3"><a href="usb-8.html">Basic Device Access</a></p>
<p class="toc level3"><a href="usb-16.html">Device Communication</a></p>
<p class="toc level3"><a href="usb-43.html">Device State Management</a></p>
<p class="toc level3"><a href="usb-17.html">Utility Functions</a></p>
<p class="toc level3"><a href="ewavr.html">Sample USB Device Driver</a></p>
<p class="toc level1 tocsp"><a href="eqbvo.html">Part&nbsp;III&nbsp;Building a Device Driver</a></p>
<p class="toc level2"><a href="loading-15035.html">21.&nbsp;&nbsp;Compiling, Loading, Packaging, and Testing Drivers</a></p>
<p class="toc level2"><a href="debug-60.html">22.&nbsp;&nbsp;Debugging, Testing, and Tuning Device Drivers</a></p>
<p class="toc level2"><a href="coding-practices.html">23.&nbsp;&nbsp;Recommended Coding Practices</a></p>
<p class="toc level1 tocsp"><a href="eqbva.html">Part&nbsp;IV&nbsp;Appendixes</a></p>
<p class="toc level2"><a href="hwovr-18191.html">A.&nbsp;&nbsp;Hardware Overview</a></p>
<p class="toc level2"><a href="ddidkisvc-29227.html">B.&nbsp;&nbsp;Summary of Solaris DDI/DKI Services</a></p>
<p class="toc level2"><a href="lp64-35004.html">C.&nbsp;&nbsp;Making a Device Driver 64-Bit Ready</a></p>
<p class="toc level2"><a href="euazz.html">D.&nbsp;&nbsp;Console Frame Buffer Drivers</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="usb-2"></a><h3>USB in the Solaris Environment</h3>
<p>The Solaris USB architecture includes the USBA&nbsp;2.0 framework and USB client drivers.</p>

<a name="usb-4"></a><h4>USBA 2.0 Framework</h4>
<a name="indexterm-814"></a><p>The USBA&nbsp;2.0 framework is a service layer that presents an abstract view
of USB devices to USBA-compliant client drivers. The framework enables USBA-compliant client drivers to
manage their USB devices. The USBA&nbsp;2.0 framework supports the USB&nbsp;2.0 specification except for
high speed isochronous pipes. For information on the USB&nbsp;2.0 specification, see <a href="http://www.usb.org/">http://www.usb.org/</a>.</p><p>The USBA&nbsp;2.0 framework is platform-independent. The Solaris USB architecture is shown in the
following figure. The USBA&nbsp;2.0 framework is the USBA layer in the figure. This
layer interfaces through a hardware-independent host controller driver interface to hardware-specific host controller
drivers. The host controller drivers access the USB physical devices through the host
controllers they manage.</p><a name="euxbt"></a><h6>Figure&nbsp;20-1 Solaris USB Architecture</h6><img src="figures/usb.arch.gif" alt="Diagram shows the flow of control from client and hub drivers, through the USB Architecture Interfaces, to the controllers and devices."></img>

<a name="usb-5"></a><h4>USB Client Drivers</h4>
<a name="indexterm-815"></a><a name="indexterm-816"></a><a name="indexterm-817"></a><p>The USBA&nbsp;2.0 framework is not a device driver itself. This chapter describes
the client drivers shown in <a href="#euxbt">Figure&nbsp;20-1</a> and <a href="#euxbg">Figure&nbsp;20-2</a>. The client drivers interact with various
kinds of USB devices such as mass storage devices, printers, and human interface
devices. The hub driver is a client driver that is also a nexus
driver. The hub driver enumerates devices on its ports and creates <tt>devinfo</tt>
nodes for those devices and then attaches the client drivers. This chapter does
not describe how to write a hub driver.</p><p>USB drivers have the same structure as any other Solaris driver. USB drivers
can be block drivers, character drivers, or STREAMS drivers. USB drivers follow the
calling conventions and use the data structures and routines described in the Solaris
OS section 9 man pages. See <a href="http://docs.sun.com/doc/819-2255/intro-9e?a=view"><tt>Intro</tt>(9E)</a>, <a href="http://docs.sun.com/doc/819-2256/intro-9f?a=view"><tt>Intro</tt>(9F)</a>, and <a href="http://docs.sun.com/doc/819-2257/intro-9s?a=view"><tt>Intro</tt>(9S)</a>.</p><p><a name="indexterm-818"></a><a name="indexterm-819"></a><a name="indexterm-820"></a><a name="indexterm-821"></a>The difference between USB drivers and other Solaris drivers is that USB drivers
call USBA&nbsp;2.0 framework functions to access the device instead of directly accessing the
device. The USBA&nbsp;2.0 framework supplements the standard Solaris DDI routines. See the following
figure.</p><a name="euxbg"></a><h6>Figure&nbsp;20-2 Driver and Controller Interfaces</h6><img src="figures/usb.drv.ctrl.int.gif" alt="Diagram shows DDI and USBAI functions, different versions of the USBA framework, and different types of host controllers."></img><p><a href="#euxbg">Figure&nbsp;20-2</a> shows interfaces in more detail than <a href="#euxbt">Figure&nbsp;20-1</a> does. <a href="#euxbg">Figure&nbsp;20-2</a> shows that the
USBA is a kernel subsystem into which a client driver can call, just
as a client driver can call DDI functions.</p><p>Not all systems have all of the host controller interfaces shown in
<a href="#euxbg">Figure&nbsp;20-2</a>. OHCI (Open Host Controller Interface) hardware is most prevalent on SPARC systems
and third-party USB PCI cards. UHCI (Universal Host Controller Interface) hardware is most
prevalent on x86 systems.  However, both OHCI and UHCI hardware can be
used on any system. When EHCI (Enhanced Host Controller Interface) hardware is present,
the EHCI hardware is on the same card and shares the same ports
with either OHCI or UHCI.</p><p>The host controllers, host controller drivers, and HCDI make up a transport layer
that is commanded by the USBA. You cannot directly call into the
OHCI, EHCI, or UHCI. You call into them indirectly through the platform-independent USBA interface.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="usb-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="usb-7.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

