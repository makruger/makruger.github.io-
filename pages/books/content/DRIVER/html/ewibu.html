<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Developing, Testing, and Debugging Console Frame Buffer Drivers - Writing Device Drivers</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">Writing Device Drivers</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="gcbrg.html">Previous</a>
             </td>
             <td align="right">
                 <a href="idx-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="eqbvu.html">Part&nbsp;I&nbsp;Designing Device Drivers for the Solaris Platform</a></p>
<p class="toc level2"><a href="eqbqn.html">1.&nbsp;&nbsp;Overview of Solaris Device Drivers</a></p>
<p class="toc level2"><a href="kernelovr-77198.html">2.&nbsp;&nbsp;Solaris Kernel and Device Tree</a></p>
<p class="toc level2"><a href="mt-17026.html">3.&nbsp;&nbsp;Multithreading</a></p>
<p class="toc level2"><a href="properties-1.html">4.&nbsp;&nbsp;Properties</a></p>
<p class="toc level2"><a href="events-1.html">5.&nbsp;&nbsp;Managing Events and Queueing Tasks</a></p>
<p class="toc level2"><a href="autoconf-17.html">6.&nbsp;&nbsp;Driver Autoconfiguration</a></p>
<p class="toc level2"><a href="devaccess-3.html">7.&nbsp;&nbsp;Device Access: Programmed I/O</a></p>
<p class="toc level2"><a href="interrupt-15678.html">8.&nbsp;&nbsp;Interrupt Handlers</a></p>
<p class="toc level2"><a href="dma-29901.html">9.&nbsp;&nbsp;Direct Memory Access (DMA)</a></p>
<p class="toc level2"><a href="devmap-24338.html">10.&nbsp;&nbsp;Mapping Device and Kernel Memory</a></p>
<p class="toc level2"><a href="devcnmgt-19679.html">11.&nbsp;&nbsp;Device Context Management</a></p>
<p class="toc level2"><a href="powermgt-37437.html">12.&nbsp;&nbsp;Power Management</a></p>
<p class="toc level2"><a href="gevsi.html">13.&nbsp;&nbsp;Hardening Solaris Drivers</a></p>
<p class="toc level2"><a href="ldi-1.html">14.&nbsp;&nbsp;Layered Driver Interface (LDI)</a></p>
<p class="toc level1 tocsp"><a href="eqbvb.html">Part&nbsp;II&nbsp;Designing Specific Kinds of Device Drivers</a></p>
<p class="toc level2"><a href="character-21002.html">15.&nbsp;&nbsp;Drivers for Character Devices</a></p>
<p class="toc level2"><a href="block-34861.html">16.&nbsp;&nbsp;Drivers for Block Devices</a></p>
<p class="toc level2"><a href="scsi-36812.html">17.&nbsp;&nbsp;SCSI Target Drivers</a></p>
<p class="toc level2"><a href="scsihba-32898.html">18.&nbsp;&nbsp;SCSI Host Bus Adapter Drivers</a></p>
<p class="toc level2"><a href="gld-1.html">19.&nbsp;&nbsp;Drivers for Network Devices</a></p>
<p class="toc level2"><a href="usb-1.html">20.&nbsp;&nbsp;USB Drivers</a></p>
<p class="toc level1 tocsp"><a href="eqbvo.html">Part&nbsp;III&nbsp;Building a Device Driver</a></p>
<p class="toc level2"><a href="loading-15035.html">21.&nbsp;&nbsp;Compiling, Loading, Packaging, and Testing Drivers</a></p>
<p class="toc level2"><a href="debug-60.html">22.&nbsp;&nbsp;Debugging, Testing, and Tuning Device Drivers</a></p>
<p class="toc level2"><a href="coding-practices.html">23.&nbsp;&nbsp;Recommended Coding Practices</a></p>
<p class="toc level1 tocsp"><a href="eqbva.html">Part&nbsp;IV&nbsp;Appendixes</a></p>
<p class="toc level2"><a href="hwovr-18191.html">A.&nbsp;&nbsp;Hardware Overview</a></p>
<p class="toc level2"><a href="ddidkisvc-29227.html">B.&nbsp;&nbsp;Summary of Solaris DDI/DKI Services</a></p>
<p class="toc level2"><a href="lp64-35004.html">C.&nbsp;&nbsp;Making a Device Driver 64-Bit Ready</a></p>
<p class="toc level2"><a href="euazz.html">D.&nbsp;&nbsp;Console Frame Buffer Drivers</a></p>
<p class="toc level3"><a href="eveno.html">Solaris Consoles and the Kernel Terminal Emulator</a></p>
<p class="toc level3"><a href="ewibs.html">Console Visual I/O Interfaces</a></p>
<p class="toc level3"><a href="ewibr.html">Implementing the Visual I/O Interfaces in Console Frame Buffer Drivers</a></p>
<p class="toc level3"><a href="gcbpn.html">Implementing Polled I/O in Console Frame Buffer Drivers</a></p>
<p class="toc level3"><a href="gcbpl.html">Frame Buffer Specific Configuration Module</a></p>
<p class="toc level3"><a href="gcbrg.html">The X Window System Frame Buffer Specific DDX Module</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Developing, Testing, and Debugging Console Frame Buffer Drivers</a></p>
</div>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="ewibu"></a><h3>Developing, Testing, and Debugging Console Frame Buffer Drivers</h3>
<p><a name="indexterm-1403"></a><a name="indexterm-1404"></a><a name="indexterm-1405"></a>Debugging a console frame buffer driver on an active system can be problematic.</p>
<ul><li><p>Errors that are encountered in the early stages of booting the system do not generate a core dump.</p></li>
<li><p>Error or informative messages might not be displayed correctly on the screen.</p></li>
<li><p>USB keyboard input might fail.</p></li></ul>
<p>This section offers some suggestions to help you develop, test, and debug console
frame buffer drivers.</p>

<a name="gcdeo"></a><h4>Testing the I/O Control Interfaces</h4>
<p>To test the <tt>ioctl</tt> commands, create additional <tt>ioctl</tt> entry points that are
callable from a user application. Be sure to copy in the arguments appropriately.
Use the <a href="http://docs.sun.com/doc/819-2256/ddi-copyin-9f?a=view"><tt>ddi_copyin</tt>(9F)</a> and <a href="http://docs.sun.com/doc/819-2256/ddi-copyout-9f?a=view"><tt>ddi_copyout</tt>(9F)</a> routines to transfer data to and from
user address space. Then write an application to validate rendering, scrolling, and cursor behavior.
This way, these <tt>ioctl</tt> commands do not affect your console while you develop
and test the commands.</p><p>To ensure that the <tt>ioctl</tt> commands are working correctly, boot the system and
log in. Check whether you get expected behavior when you execute commands such
as <tt>prstat</tt>(1M), <tt>ls</tt>(1), <tt>vi</tt>(1), and <tt>man</tt>(1).</p><p>Execute the following script to validate that ANSI color is working correctly:</p><pre>#!/bin/bash
printf "\n\n\n\e[37;40m             Color List       \e[m\n\n"
printf "\e[30m Color 30 black\e[m\n"
printf "\e[31m Color 31 red\e[m\n"
printf "\e[32m Color 32 green\e[m\n"
printf "\e[33m Color 33 yellow\e[m\n"
printf "\e[34m Color 34 blue\e[m\n"
printf "\e[35m Color 35 purple\e[m\n"
printf "\e[36m Color 36 cyan\e[m\n"
printf "\e[37m Color 37 white\e[m\n\n"
printf "\e[40m Backlight 40 black \e[m\n"
printf "\e[41m Backlight 41 red   \e[m\n"
printf "\e[34;42m Backlight 42 green \e[m\n"
printf "\e[43m Backlight 43 yellow\e[m\n"
printf "\e[37;44m Backlight 44 blue  \e[m\n"
printf "\e[45m Backlight 45 purple\e[m\n"
printf "\e[30;46m Backlight 46 cyan  \e[m\n"
printf "\e[30;47m Backlight 47 white \e[m\n\n"</pre>

<a name="gcdds"></a><h4>Testing the Polled I/O Interfaces</h4>
<p>The polled I/O interfaces are only available under the following circumstances:</p>
<ul><li><p>When you enter the OpenBoot PROM by using the L1+A keystroke sequence</p></li>
<li><p>When you boot the system with a standalone debugger such as <a href="http://docs.sun.com/doc/819-2239/kmdb-1?a=view"><tt>kmdb</tt>(1)</a></p></li>
<li><p>When the system panics</p></li></ul>
<p>The polled I/O interfaces only become available at a certain point in the
boot process. Polled I/O requests issued from the OpenBoot PROM before the system
is running are not rendered. Similarly, <tt>kmdb</tt> prompts issued before the console is
configured are not rendered.</p><p>To test the polled I/O interfaces, enter the OpenBoot PROM by using the
L1+A keystroke sequence. To validate that the polled I/O interfaces are being used,
type the following command at the OpenBoot PROM <tt>ok</tt> prompt:</p><pre>ok <tt><b>1b emit ." [32m This is a test" 1b emit ." [m"</b></tt></pre><p>The polled I/O interfaces are working properly if the following statements are true:</p>
<ul><li><p>The result of the above command is that the phrase <tt>This is a test</tt> is displayed in green.</p></li>
<li><p>The OpenBoot PROM continues to function correctly.</p></li>
<li><p>Scrolling performs as expected.</p></li>
<li><p>The cursor displays correctly.</p></li>
<li><p>The system can be reentered and continued repeatedly.</p></li></ul>


<a name="gcdeb"></a><h4>Testing the Video Mode Change Callback Function</h4>
<p><a name="indexterm-1406"></a>To determine whether the video mode change callback function is working properly, log
in to the system and use <a href="http://docs.sun.com/doc/819-2240/fbconfig-1m?a=view"><tt>fbconfig</tt>(1M)</a> to change the resolution and depth
of the frame buffer several times. If the console continues to display text
properly, the video mode change callback function is working correctly. The kernel terminal
emulator might adjust the font size to accommodate different screen sizes, but that
is not significant to the console frame buffer driver.</p><p>To determine whether the X Window System and the console frame buffer driver
interact correctly, switch between the X Window System and the command line several
times while modifying the X Window System's video resolution and the command line
resolution in different ways. If the X Window System exits and the console
characters are not displayed correctly, either the X Window System did not notify
the driver console code that the video mode changed or the driver did
not call the kernel terminal emulator's video mode change callback function.</p>

<a name="gcdeu"></a><h4>Additional Suggestions for Testing Console Frame Buffer Drivers</h4>
<p><a name="indexterm-1407"></a>During boot, the system sends messages to <tt>/var/adm/messages</tt> if the system fails
to locate or successfully load a kernel terminal emulator compatible frame buffer driver.
To monitor these messages, type the following command in a separate window:</p><pre>% <tt><b>tail -f /var/adm/messages</b></tt></pre><p><a name="indexterm-1408"></a>To avoid problems with USB while debugging the driver, change the EEPROM <tt>input-device</tt>
NVRAM configuration parameter to use a serial port instead of the keyboard. See
the <a href="http://docs.sun.com/doc/819-2240/eeprom-1m?a=view"><tt>eeprom</tt>(1M)</a> man page for more information about this parameter.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="gcbrg.html">Previous</a>
             </td>
             <td align="right">
                 <a href="idx-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

