<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Device Issues - Writing Device Drivers</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">Writing Device Drivers</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="hwovr-25520.html">Previous</a>
             </td>
             <td align="right">
                 <a href="hwovr-101.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="eqbvu.html">Part&nbsp;I&nbsp;Designing Device Drivers for the Solaris Platform</a></p>
<p class="toc level2"><a href="eqbqn.html">1.&nbsp;&nbsp;Overview of Solaris Device Drivers</a></p>
<p class="toc level2"><a href="kernelovr-77198.html">2.&nbsp;&nbsp;Solaris Kernel and Device Tree</a></p>
<p class="toc level2"><a href="mt-17026.html">3.&nbsp;&nbsp;Multithreading</a></p>
<p class="toc level2"><a href="properties-1.html">4.&nbsp;&nbsp;Properties</a></p>
<p class="toc level2"><a href="events-1.html">5.&nbsp;&nbsp;Managing Events and Queueing Tasks</a></p>
<p class="toc level2"><a href="autoconf-17.html">6.&nbsp;&nbsp;Driver Autoconfiguration</a></p>
<p class="toc level2"><a href="devaccess-3.html">7.&nbsp;&nbsp;Device Access: Programmed I/O</a></p>
<p class="toc level2"><a href="interrupt-15678.html">8.&nbsp;&nbsp;Interrupt Handlers</a></p>
<p class="toc level2"><a href="dma-29901.html">9.&nbsp;&nbsp;Direct Memory Access (DMA)</a></p>
<p class="toc level2"><a href="devmap-24338.html">10.&nbsp;&nbsp;Mapping Device and Kernel Memory</a></p>
<p class="toc level2"><a href="devcnmgt-19679.html">11.&nbsp;&nbsp;Device Context Management</a></p>
<p class="toc level2"><a href="powermgt-37437.html">12.&nbsp;&nbsp;Power Management</a></p>
<p class="toc level2"><a href="gevsi.html">13.&nbsp;&nbsp;Hardening Solaris Drivers</a></p>
<p class="toc level2"><a href="ldi-1.html">14.&nbsp;&nbsp;Layered Driver Interface (LDI)</a></p>
<p class="toc level1 tocsp"><a href="eqbvb.html">Part&nbsp;II&nbsp;Designing Specific Kinds of Device Drivers</a></p>
<p class="toc level2"><a href="character-21002.html">15.&nbsp;&nbsp;Drivers for Character Devices</a></p>
<p class="toc level2"><a href="block-34861.html">16.&nbsp;&nbsp;Drivers for Block Devices</a></p>
<p class="toc level2"><a href="scsi-36812.html">17.&nbsp;&nbsp;SCSI Target Drivers</a></p>
<p class="toc level2"><a href="scsihba-32898.html">18.&nbsp;&nbsp;SCSI Host Bus Adapter Drivers</a></p>
<p class="toc level2"><a href="gld-1.html">19.&nbsp;&nbsp;Drivers for Network Devices</a></p>
<p class="toc level2"><a href="usb-1.html">20.&nbsp;&nbsp;USB Drivers</a></p>
<p class="toc level1 tocsp"><a href="eqbvo.html">Part&nbsp;III&nbsp;Building a Device Driver</a></p>
<p class="toc level2"><a href="loading-15035.html">21.&nbsp;&nbsp;Compiling, Loading, Packaging, and Testing Drivers</a></p>
<p class="toc level2"><a href="debug-60.html">22.&nbsp;&nbsp;Debugging, Testing, and Tuning Device Drivers</a></p>
<p class="toc level2"><a href="coding-practices.html">23.&nbsp;&nbsp;Recommended Coding Practices</a></p>
<p class="toc level1 tocsp"><a href="eqbva.html">Part&nbsp;IV&nbsp;Appendixes</a></p>
<p class="toc level2"><a href="hwovr-18191.html">A.&nbsp;&nbsp;Hardware Overview</a></p>
<p class="toc level3"><a href="hwovr-1.html">SPARC Processor Issues</a></p>
<p class="toc level3"><a href="hwovr-35423.html">x86 Processor Issues</a></p>
<p class="toc level3"><a href="hwovr-66.html">Endianness</a></p>
<p class="toc level3"><a href="hwovr-14.html">Store Buffers</a></p>
<p class="toc level3"><a href="hwovr-15.html">System Memory Model</a></p>
<p class="toc level3"><a href="hwovr-18.html">Bus Architectures</a></p>
<p class="toc level3"><a href="hwovr-25520.html">Bus Specifics</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Device Issues</a></p>
</div>
<p class="toc level3"><a href="hwovr-101.html">PROM on SPARC Machines</a></p>
<p class="toc level2 tocsp"><a href="ddidkisvc-29227.html">B.&nbsp;&nbsp;Summary of Solaris DDI/DKI Services</a></p>
<p class="toc level2"><a href="lp64-35004.html">C.&nbsp;&nbsp;Making a Device Driver 64-Bit Ready</a></p>
<p class="toc level2"><a href="euazz.html">D.&nbsp;&nbsp;Console Frame Buffer Drivers</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="hwovr-100"></a><h3>Device Issues</h3>
<p>This section describes issues with special devices.</p>

<a name="hwovr-78"></a><h4>Timing-Critical Sections</h4>
<p><a name="indexterm-1236"></a>While most driver operations can be performed without mechanisms for synchronization and protection
beyond those provided by the locking primitives, some devices require that a sequence
of events occur in order without interruption. In conjunction with the locking primitives,
the function <a href="http://docs.sun.com/doc/819-2256/ddi-enter-critical-9f?a=view"><tt>ddi_enter_critical</tt>(9F)</a> asks the system to guarantee, to the best of
its ability, that the current thread will neither be preempted nor interrupted. This
guarantee stays in effect until a closing call to <a href="http://docs.sun.com/doc/819-2256/ddi-exit-critical-9f?a=view"><tt>ddi_exit_critical</tt>(9F)</a> is made. See
the <a href="http://docs.sun.com/doc/819-2256/ddi-enter-critical-9f?a=view"><tt>ddi_enter_critical</tt>(9F)</a> man page for details.</p>

<a name="hwovr-79"></a><h4>Delays</h4>
<p><a name="indexterm-1237"></a>Many chips specify that they can be accessed only at specified intervals. For
example, the Zilog Z8530 SCC has a &ldquo;write recovery time&rdquo; of 1.6 microseconds.
This specification means that a delay must be enforced with <a href="http://docs.sun.com/doc/819-2256/drv-usecwait-9f?a=view"><tt>drv_usecwait</tt>(9F)</a> when writing
characters with an 8530. In some instances, the specifications do not make explicit
what delays are needed, so the delays must be determined empirically.</p><p>Be careful not to compound delays for parts of devices that might
exist in large numbers, for example, thousands of SCSI disk drives.</p>

<a name="hwovr-80"></a><h4>Internal Sequencing Logic</h4>
<p><a name="indexterm-1238"></a>Devices with internal sequencing logic map multiple internal registers to the same external address.
The various kinds of internal sequencing logic include the following types:</p>
<ul><li><p><a name="indexterm-1239"></a><a name="indexterm-1240"></a>The Intel 8251A and the Signetics 2651 alternate the same external register between <b>two</b> internal mode registers. Writing to the first internal register is accomplished by writing to the external register. This write, however, has the side effect of setting up the sequencing logic in the chip so that the next read/write operation refers to the second internal register.</p></li>
<li><p>The NEC PD7201 PCC has multiple internal data registers. To write a byte into a particular register, two steps must be performed. The first step is to write into register zero the number of the register into which the following byte of data will go. The data is then written to the specified data register. The sequencing logic automatically sets up the chip so that the next byte sent will go into data register zero.</p></li>
<li><p>The AMD 9513 timer has a data pointer register that points at the data register into which a data byte will go. When sending a byte to the data register, the pointer is incremented. The current value of the pointer register <b>cannot</b> be read.</p></li></ul>


<a name="hwovr-81"></a><h4>Interrupt Issues</h4>
<p><a name="indexterm-1241"></a>Note the following common interrupt-related issues:</p>
<ul><li><p>A controller interrupt does <b>not</b> necessarily indicate that <b>both</b> the controller <b>and</b> one of its slave devices are ready. For some controllers, an interrupt can indicate that either the controller is ready or one of its devices is ready but not both.</p></li>
<li><p>Not all devices power up with interrupts disabled and can begin interrupting at any time.</p></li>
<li><p>Some devices do not provide a way to determine that the board has generated an interrupt.</p></li>
<li><p>Not all interrupting boards shut off interrupts when told to do so or after a bus reset.</p></li></ul>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="hwovr-25520.html">Previous</a>
             </td>
             <td align="right">
                 <a href="hwovr-101.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

