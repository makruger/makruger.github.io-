<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>SPARC Processor Issues - Writing Device Drivers</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">Writing Device Drivers</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="hwovr-18191.html">Previous</a>
             </td>
             <td align="right">
                 <a href="hwovr-35423.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="eqbvu.html">Part&nbsp;I&nbsp;Designing Device Drivers for the Solaris Platform</a></p>
<p class="toc level2"><a href="eqbqn.html">1.&nbsp;&nbsp;Overview of Solaris Device Drivers</a></p>
<p class="toc level2"><a href="kernelovr-77198.html">2.&nbsp;&nbsp;Solaris Kernel and Device Tree</a></p>
<p class="toc level2"><a href="mt-17026.html">3.&nbsp;&nbsp;Multithreading</a></p>
<p class="toc level2"><a href="properties-1.html">4.&nbsp;&nbsp;Properties</a></p>
<p class="toc level2"><a href="events-1.html">5.&nbsp;&nbsp;Managing Events and Queueing Tasks</a></p>
<p class="toc level2"><a href="autoconf-17.html">6.&nbsp;&nbsp;Driver Autoconfiguration</a></p>
<p class="toc level2"><a href="devaccess-3.html">7.&nbsp;&nbsp;Device Access: Programmed I/O</a></p>
<p class="toc level2"><a href="interrupt-15678.html">8.&nbsp;&nbsp;Interrupt Handlers</a></p>
<p class="toc level2"><a href="dma-29901.html">9.&nbsp;&nbsp;Direct Memory Access (DMA)</a></p>
<p class="toc level2"><a href="devmap-24338.html">10.&nbsp;&nbsp;Mapping Device and Kernel Memory</a></p>
<p class="toc level2"><a href="devcnmgt-19679.html">11.&nbsp;&nbsp;Device Context Management</a></p>
<p class="toc level2"><a href="powermgt-37437.html">12.&nbsp;&nbsp;Power Management</a></p>
<p class="toc level2"><a href="gevsi.html">13.&nbsp;&nbsp;Hardening Solaris Drivers</a></p>
<p class="toc level2"><a href="ldi-1.html">14.&nbsp;&nbsp;Layered Driver Interface (LDI)</a></p>
<p class="toc level1 tocsp"><a href="eqbvb.html">Part&nbsp;II&nbsp;Designing Specific Kinds of Device Drivers</a></p>
<p class="toc level2"><a href="character-21002.html">15.&nbsp;&nbsp;Drivers for Character Devices</a></p>
<p class="toc level2"><a href="block-34861.html">16.&nbsp;&nbsp;Drivers for Block Devices</a></p>
<p class="toc level2"><a href="scsi-36812.html">17.&nbsp;&nbsp;SCSI Target Drivers</a></p>
<p class="toc level2"><a href="scsihba-32898.html">18.&nbsp;&nbsp;SCSI Host Bus Adapter Drivers</a></p>
<p class="toc level2"><a href="gld-1.html">19.&nbsp;&nbsp;Drivers for Network Devices</a></p>
<p class="toc level2"><a href="usb-1.html">20.&nbsp;&nbsp;USB Drivers</a></p>
<p class="toc level1 tocsp"><a href="eqbvo.html">Part&nbsp;III&nbsp;Building a Device Driver</a></p>
<p class="toc level2"><a href="loading-15035.html">21.&nbsp;&nbsp;Compiling, Loading, Packaging, and Testing Drivers</a></p>
<p class="toc level2"><a href="debug-60.html">22.&nbsp;&nbsp;Debugging, Testing, and Tuning Device Drivers</a></p>
<p class="toc level2"><a href="coding-practices.html">23.&nbsp;&nbsp;Recommended Coding Practices</a></p>
<p class="toc level1 tocsp"><a href="eqbva.html">Part&nbsp;IV&nbsp;Appendixes</a></p>
<p class="toc level2"><a href="hwovr-18191.html">A.&nbsp;&nbsp;Hardware Overview</a></p>
<div class="onpage">
<p class="toc level3"><a href="">SPARC Processor Issues</a></p>
</div>
<p class="toc level3"><a href="hwovr-35423.html">x86 Processor Issues</a></p>
<p class="toc level3"><a href="hwovr-66.html">Endianness</a></p>
<p class="toc level3"><a href="hwovr-14.html">Store Buffers</a></p>
<p class="toc level3"><a href="hwovr-15.html">System Memory Model</a></p>
<p class="toc level3"><a href="hwovr-18.html">Bus Architectures</a></p>
<p class="toc level3"><a href="hwovr-25520.html">Bus Specifics</a></p>
<p class="toc level3"><a href="hwovr-100.html">Device Issues</a></p>
<p class="toc level3"><a href="hwovr-101.html">PROM on SPARC Machines</a></p>
<p class="toc level2 tocsp"><a href="ddidkisvc-29227.html">B.&nbsp;&nbsp;Summary of Solaris DDI/DKI Services</a></p>
<p class="toc level2"><a href="lp64-35004.html">C.&nbsp;&nbsp;Making a Device Driver 64-Bit Ready</a></p>
<p class="toc level2"><a href="euazz.html">D.&nbsp;&nbsp;Console Frame Buffer Drivers</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="hwovr-1"></a><h3>SPARC Processor Issues</h3>
<p><a name="indexterm-1225"></a><a name="hwovr-ix33"></a>This section describes a number of SPARC processor-specific topics such as data alignment,
byte ordering, register windows, and availability of floating-point instructions. For information on x86 processor-specific
topics, see <a href="hwovr-35423.html">x86 Processor Issues</a>.</p>
<hr><p><b>Note - </b>Drivers should never perform floating-point operations, because these operations are not supported in
the kernel.</p>
<hr>


<a name="hwovr-2"></a><h4>SPARC Data Alignment</h4>
<a name="hwovr-ix29"></a><a name="indexterm-1226"></a><p>All quantities must be aligned on their natural boundaries, using standard C data
types:</p>
<ul><li><p><tt>short</tt> integers are aligned on 16-bit boundaries.</p></li>
<li><p><tt>int</tt> integers are aligned on 32-bit boundaries.</p></li>
<li><p><tt>long</tt> integers are aligned on 64-bit boundaries for SPARC systems. For information on data models, see <a href="lp64-35004.html">Appendix&nbsp;C, Making a Device Driver 64-Bit Ready</a>.</p></li>
<li><p><tt>long long</tt> integers are aligned on 64-bit boundaries.</p></li></ul>
<p>Usually, the compiler handles any alignment issues. However, driver writers are more likely
to be concerned about alignment because the proper data types must be used
to access the devices. Because device registers are commonly accessed through a pointer
reference, drivers must ensure that pointers are properly aligned when accessing the device.</p>

<a name="hwovr-3"></a><h4>Member Alignment in SPARC Structures</h4>
<a name="hwovr-ix30"></a><p>Because of the data alignment restrictions imposed by the SPARC processor, C structures
also have alignment requirements. Structure alignment requirements are imposed by the most strictly
aligned structure component. For example, a structure containing only characters has no alignment
restrictions, while a structure containing a <tt>long</tt> <tt>long</tt> member must be constructed to guarantee
that this member falls on a 64-bit boundary.</p>

<a name="hwovr-4"></a><h4>SPARC Byte Ordering</h4>
<a name="hwovr-ix31"></a><p>The SPARC processor uses <b>big-endian</b> byte ordering. The most significant byte (MSB) of
an integer is stored at the lowest address of the integer. The least
significant byte is stored at the highest address for words in this processor.
For example, byte 63 is the least significant byte for 64-bit processors.</p><img src="figures/hwovr.sparcbyteorder.gif" alt="Diagram shows how bytes are ordered in big-endian architectures, that is, byte 0 is the most significant byte."></img>

<a name="hwovr-5"></a><h4>SPARC Register Windows</h4>
<a name="hwovr-ix32"></a><p>SPARC processors use register windows. Each register window consists of eight <b>in</b> registers,
eight <b>local</b> registers, eight <b>out</b> registers, and eight <b>global</b> registers. Out registers are the
in registers for the next window. The number of register windows ranges from
2 to 32, depending on the processor implementation.</p><p><a name="indexterm-1227"></a>Because drivers are normally written in C, the compiler usually hides the fact
that register windows are used. However, you might have to use register windows
when debugging the driver.</p>

<a name="hwovr-165"></a><h4>SPARC Multiply and Divide Instructions</h4>
<a name="indexterm-1228"></a><p><a name="indexterm-1229"></a>The Version 7 SPARC processors do not have multiply or divide instructions. The
multiply and divide instructions are emulated in software. Because a driver might run
on a Version 7, Version 8, or Version 9 processor, avoid intensive integer
multiplication and division. Instead, use bitwise left and right shifts to multiply and
divide by powers of two.</p><p>The <i>SPARC Architecture Manual, Version 9</i>, contains more specific information on the SPARC CPU. The <i>SPARC Compliance Definition</i>, Version
2.4, contains details of the application binary interface (ABI) for SPARC V9. The
manual describes the 32-bit SPARC V8 ABI and the 64-bit SPARC V9 ABI.
You can obtain this document from SPARC International at <a href="http://www.sparc.com">http://www.sparc.com</a>.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="hwovr-18191.html">Previous</a>
             </td>
             <td align="right">
                 <a href="hwovr-35423.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

