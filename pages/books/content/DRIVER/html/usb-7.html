<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Binding Client Drivers - Writing Device Drivers</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">Writing Device Drivers</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="usb-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="usb-8.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="eqbvu.html">Part&nbsp;I&nbsp;Designing Device Drivers for the Solaris Platform</a></p>
<p class="toc level2"><a href="eqbqn.html">1.&nbsp;&nbsp;Overview of Solaris Device Drivers</a></p>
<p class="toc level2"><a href="kernelovr-77198.html">2.&nbsp;&nbsp;Solaris Kernel and Device Tree</a></p>
<p class="toc level2"><a href="mt-17026.html">3.&nbsp;&nbsp;Multithreading</a></p>
<p class="toc level2"><a href="properties-1.html">4.&nbsp;&nbsp;Properties</a></p>
<p class="toc level2"><a href="events-1.html">5.&nbsp;&nbsp;Managing Events and Queueing Tasks</a></p>
<p class="toc level2"><a href="autoconf-17.html">6.&nbsp;&nbsp;Driver Autoconfiguration</a></p>
<p class="toc level2"><a href="devaccess-3.html">7.&nbsp;&nbsp;Device Access: Programmed I/O</a></p>
<p class="toc level2"><a href="interrupt-15678.html">8.&nbsp;&nbsp;Interrupt Handlers</a></p>
<p class="toc level2"><a href="dma-29901.html">9.&nbsp;&nbsp;Direct Memory Access (DMA)</a></p>
<p class="toc level2"><a href="devmap-24338.html">10.&nbsp;&nbsp;Mapping Device and Kernel Memory</a></p>
<p class="toc level2"><a href="devcnmgt-19679.html">11.&nbsp;&nbsp;Device Context Management</a></p>
<p class="toc level2"><a href="powermgt-37437.html">12.&nbsp;&nbsp;Power Management</a></p>
<p class="toc level2"><a href="gevsi.html">13.&nbsp;&nbsp;Hardening Solaris Drivers</a></p>
<p class="toc level2"><a href="ldi-1.html">14.&nbsp;&nbsp;Layered Driver Interface (LDI)</a></p>
<p class="toc level1 tocsp"><a href="eqbvb.html">Part&nbsp;II&nbsp;Designing Specific Kinds of Device Drivers</a></p>
<p class="toc level2"><a href="character-21002.html">15.&nbsp;&nbsp;Drivers for Character Devices</a></p>
<p class="toc level2"><a href="block-34861.html">16.&nbsp;&nbsp;Drivers for Block Devices</a></p>
<p class="toc level2"><a href="scsi-36812.html">17.&nbsp;&nbsp;SCSI Target Drivers</a></p>
<p class="toc level2"><a href="scsihba-32898.html">18.&nbsp;&nbsp;SCSI Host Bus Adapter Drivers</a></p>
<p class="toc level2"><a href="gld-1.html">19.&nbsp;&nbsp;Drivers for Network Devices</a></p>
<p class="toc level2"><a href="usb-1.html">20.&nbsp;&nbsp;USB Drivers</a></p>
<p class="toc level3"><a href="usb-2.html">USB in the Solaris Environment</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Binding Client Drivers</a></p>
</div>
<p class="toc level3"><a href="usb-8.html">Basic Device Access</a></p>
<p class="toc level3"><a href="usb-16.html">Device Communication</a></p>
<p class="toc level3"><a href="usb-43.html">Device State Management</a></p>
<p class="toc level3"><a href="usb-17.html">Utility Functions</a></p>
<p class="toc level3"><a href="ewavr.html">Sample USB Device Driver</a></p>
<p class="toc level1 tocsp"><a href="eqbvo.html">Part&nbsp;III&nbsp;Building a Device Driver</a></p>
<p class="toc level2"><a href="loading-15035.html">21.&nbsp;&nbsp;Compiling, Loading, Packaging, and Testing Drivers</a></p>
<p class="toc level2"><a href="debug-60.html">22.&nbsp;&nbsp;Debugging, Testing, and Tuning Device Drivers</a></p>
<p class="toc level2"><a href="coding-practices.html">23.&nbsp;&nbsp;Recommended Coding Practices</a></p>
<p class="toc level1 tocsp"><a href="eqbva.html">Part&nbsp;IV&nbsp;Appendixes</a></p>
<p class="toc level2"><a href="hwovr-18191.html">A.&nbsp;&nbsp;Hardware Overview</a></p>
<p class="toc level2"><a href="ddidkisvc-29227.html">B.&nbsp;&nbsp;Summary of Solaris DDI/DKI Services</a></p>
<p class="toc level2"><a href="lp64-35004.html">C.&nbsp;&nbsp;Making a Device Driver 64-Bit Ready</a></p>
<p class="toc level2"><a href="euazz.html">D.&nbsp;&nbsp;Console Frame Buffer Drivers</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="usb-7"></a><h3>Binding Client Drivers</h3>
<p>This section discusses binding a driver to a device. It discusses compatible device
names for devices with single interfaces and devices with multiple interfaces.</p>

<a name="usb-46"></a><h4>How USB Devices Appear to the System</h4>
<a name="indexterm-822"></a><a name="indexterm-823"></a><a name="indexterm-824"></a><a name="indexterm-825"></a><a name="indexterm-826"></a><a name="indexterm-827"></a><a name="indexterm-828"></a><a name="indexterm-829"></a><a name="indexterm-830"></a><a name="indexterm-831"></a><a name="indexterm-832"></a><p>A USB device can support multiple configurations. Only one configuration is active at
any given time. The active configuration is called the <b>current configuration</b>.</p><p>A configuration can have more than one <b>interface</b>, possibly with intervening interface-associations that
group two or more interfaces for a function. All interfaces of a configuration
are active simultaneously. Different interfaces might be operated by different device drivers.</p><p>An interface can represent itself to the host system in different ways by
using <b>alternate settings</b>. Only one alternate setting is active for any given interface.</p><p>Each alternate setting provides device access through <b>endpoints</b>. Each endpoint has a specific
purpose. The host system communicates with the device by establishing a communication channel
to an endpoint. This communication channel is called a <b>pipe</b>.</p>

<a name="usb-47"></a><h4>USB Devices and the Solaris Device Tree</h4>
<a name="indexterm-833"></a><a name="indexterm-834"></a><p>If a USB device has  one configuration, one interface, and device
class zero, the device is represented as a single <b>device node</b>. If a USB device
has multiple interfaces, the device is represented as a hierarchical device structure. In
a hierarchical device structure, the device node for each interface is a child
of the top-level device node. An example of a device with multiple interfaces
is an audio device that presents simultaneously to the host computer both an
audio control interface and an audio streaming interface. The audio control interface and
the audio streaming interface each could be controlled by its own driver.</p>

<a name="erfbb"></a><h4>Compatible Device Names</h4>
<a name="indexterm-835"></a><a name="indexterm-836"></a><a name="indexterm-837"></a><a name="indexterm-838"></a><a name="indexterm-839"></a><a name="indexterm-840"></a><p>The Solaris software builds an ordered list of compatible device names for USB
binding based on identification information kept within each device. This information includes device
class, subclass, vendor ID, product ID, revision, and protocol. See <a href="http://www.usb.org/">http://www.usb.org/</a> for a list
of USB classes and subclasses.</p><p>This name hierarchy enables binding to a general driver if a more
device-specific driver is not available. An example of a general driver is a
class-specific driver. Device names that begin with <tt>usbif</tt> designate single interface devices. See <a href="#usb-fig-27">Example&nbsp;20-1</a>
for examples. The USBA&nbsp;2.0 framework defines all compatible names for a device. Use
the <tt>prtconf</tt> command to display these device names, as shown in <a href="#ewatq">Example&nbsp;20-2</a>.</p><p>The following example shows an example of compatible device names for a USB
mouse device. This mouse device represents a combined node entirely operated by a
single driver. The USBA&nbsp;2.0 framework gives this device node the names shown in
the example, in the order shown.</p><a name="usb-fig-27"></a><h6>Example&nbsp;20-1 USB Mouse Compatible Device Names</h6><pre>1. 'usb430,100.102'      Vendor 430, product 100, revision 102
2. 'usb430,100'      Vendor 430, product 100
3. 'usbif430,class3.1.2' Vendor 430, class 3, subclass 1, protocol 2
4. 'usbif430,class3.1'   Vendor 430, class 3, subclass 1
5. 'usbif430,class3'     Vendor 430, class 3
6. 'usbif,class3.1.2'    Class 3, subclass 1, protocol 2
7. 'usbif,class3.1'      Class 3, subclass 1
8. 'usbif,class3'    Class 3</pre><p><a name="indexterm-841"></a>Note that the names in the above example progress from the most specific
to the most general. Entry 1 binds only to a particular revision of
a specific product from a particular vendor. Entries 3, 4, and 5 are
for class&nbsp;3 devices manufactured by vendor 430. Entries 6, 7, and 8 are
for class&nbsp;3 devices from any vendor. The binding process looks for a match
on the name from the top name down. To bind, drivers must be
added to the system with an alias that matches one of these names.
To get a list of compatible device names to which to bind
when you add your driver, check the <tt>compatible</tt> property of the device in the
output from the <tt>prtconf</tt>&nbsp;<tt>-vp</tt> command.</p><p>The following example shows compatible property lists for a keyboard and a mouse.
Use the <tt>prtconf</tt>&nbsp;<tt>-D</tt> command to display the bound driver.</p><a name="ewatq"></a><h6>Example&nbsp;20-2 Compatible Device Names Shown by the Print Configuration Command</h6><pre># <tt><b>prtconf -vD | grep compatible</b></tt>
            compatible: 'usb430,5.200' + 'usb430,5' + 'usbif430,class3.1.1'
+ 'usbif430,class3.1' + 'usbif430,class3' + 'usbif,class3.1.1' +
'usbif,class3.1' + 'usbif,class3'
            compatible: 'usb2222,2071.200' + 'usb2222,2071' +
'usbif2222,class3.1.2' + 'usbif2222,class3.1' + 'usbif2222,class3' +
'usbif,class3.1.2' + 'usbif,class3.1' + 'usbif,class3'</pre><p><a name="indexterm-842"></a>Use the most specific name you can to more accurately identify a driver
for a device or group of devices. To bind drivers written for a
specific revision of a specific product, use the most specific name match possible.
For example, if you have a USB mouse driver written by vendor&nbsp;430 for
revision&nbsp;102 of their product&nbsp;100, use the following command to add that driver to
the system:</p><pre>add_drv -n -i '"usb430,100.102"' specific_mouse_driver</pre><p>To add a driver written for any USB mouse (class 3, subclass
1, protocol 2) from vendor&nbsp;430, use the following command:</p><pre>add_drv -n -i '"usbif430,class3.1.2"' more_generic_mouse_driver</pre><p>If you install both of these drivers and then connect a compatible
device, the system binds the correct driver to the connected device. For example, if
you install both of these drivers and then connect a vendor 430,
model 100, revision 102 device, this device is bound to <tt>specific_mouse_driver</tt>. If you connect
a vendor 430, model 98 device, this device is bound to <tt>more_generic_mouse_driver</tt>.
If you connect a mouse from another vendor, this device also is bound
to <tt>more_generic_mouse_driver</tt>. If multiple drivers are available for a specific device, the driver
binding framework selects the driver with the first matching compatible name in the
compatible names list.</p>

<a name="erfbd"></a><h4>Devices With Multiple Interfaces</h4>
<a name="indexterm-843"></a><a name="indexterm-844"></a><p><b>Composite devices</b> are devices that support multiple interfaces. Composite devices have a list of
compatible names for each interface. This compatible names list ensures that the best
available driver is bound to the interface. The most general multiple interface entry
is <tt>usb,device</tt>.</p><p>For a USB audio composite device, the compatible names are as follows:</p><pre>1. 'usb471,101.100'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Vendor 471, product 101, revision 100
2. 'usb471,101'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Vendor 471, product 101
3. 'usb,device'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Generic USB device</pre><p><a name="indexterm-845"></a><a name="indexterm-846"></a><a name="indexterm-847"></a>The name <tt>usb,device</tt> is a compatible name that represents any whole USB device.
The <a href="http://docs.sun.com/doc/819-2254/usb-mid-7d?a=view"><tt>usb_mid</tt>(7D)</a> driver (USB multiple-interface driver) binds to the <tt>usb,device</tt> device node if
no other driver has claimed the whole device. The <tt>usb_mid</tt> driver creates a child
device node for each interface of the physical device. The <tt>usb_mid</tt> driver
also generates a set of compatible names for each interface. Each of these
generated compatible names begins with <tt>usbif</tt>. The system then uses these generated compatible
names to find the best driver for each interface. In this way, different
interfaces of one physical device can be bound to different drivers.</p><p>For example, the <tt>usb_mid</tt> driver binds to a multiple-interface audio device through the
<tt>usb,device</tt> node name of that audio device. The <tt>usb_mid</tt> driver then creates interface-specific device
nodes. Each of these interface-specific device nodes has its own compatible name list.
For an audio control interface node, the compatible name list might look like
the list shown in the following example.</p><a name="ekyic"></a><h6>Example&nbsp;20-3 USB Audio Compatible Device Names</h6><pre>1. 'usbif471,101.100.config1.0' Vend 471, prod 101, rev 100, cnfg 1, iface 0
2. 'usbif471,101.config1.0'     Vend 471, product 101, config 1, interface 0
3. 'usbif471,class1.1.0'    Vend 471, class 1, subclass 1, protocol 0
4. 'usbif471,class1.1'      Vend 471, class 1, subclass 1
5. 'usbif471,class1'        Vend 471, class 1
6. 'usbif,class1.1.0'       Class 1, subclass 1, protocol 0
7. 'usbif,class1.1'         Class 1, subclass 1
8. 'usbif,class1'           Class 1</pre><p>Use the following command to bind a vendor-specific, device-specific client driver named <tt>vendor_model_audio_usb</tt>
to the vendor-specific, device-specific configuration 1, interface 0 interface compatible name shown in <a href="#ekyic">Example&nbsp;20-3</a>.</p><pre>add_drv -n -i '"usbif471,101.config1.0"' vendor_model_audio_usb</pre><p>Use the following command to bind a class driver named <tt>audio_class_usb_if_driver</tt> to
the more general class 1, subclass 1 interface compatible name shown in <a href="#ekyic">Example&nbsp;20-3</a>:</p><pre>add_drv -n -i '"usbif,class1.1"' audio_class_usb_if_driver</pre><p><a name="indexterm-848"></a><a name="indexterm-849"></a><a name="indexterm-850"></a>Use the <tt>prtconf</tt> <tt>-D</tt> command to show a list of devices and
their drivers. In the following example, the <tt>prtconf</tt> <tt>-D</tt> command shows that the <tt>usb_mid</tt>
driver manages the <tt>audio</tt> device. The <tt>usb_mid</tt> driver is splitting the <tt>audio</tt> device into
interfaces. Each interface is indented under the <tt>audio</tt> device name. For each interface
shown in the indented list, the <tt>prtconf</tt> <tt>-D</tt> command shows which driver
manages the interface.</p><pre>audio, instance #0 (driver name: usb_mid)
    sound-control, instance #2 (driver name: usb_ac)
    sound, instance #2 (driver name: usb_as)
    input, instance #8 (driver name: hid)</pre>

<a name="usb-50"></a><h4>Devices With Interface-Association Descriptors</h4>
<a name="indexterm-851"></a><a name="indexterm-852"></a><a name="indexterm-853"></a><a name="indexterm-854"></a><a name="indexterm-855"></a><a name="indexterm-856"></a><a name="indexterm-857"></a><a name="indexterm-858"></a><p>If the device includes an interface-association descriptor, the device tree can be parsed
at the following three levels:</p>
<ul><li><p>The <a href="http://docs.sun.com/doc/819-2254/usb-mid-7d?a=view"><tt>usb_mid</tt>(7D)</a> USB multi-interface driver binds to device level nodes of a composite device if no vendor or class-specific driver is available.</p></li>
<li><p>A client driver is bound to the interface association nodes.</p></li>
<li><p>The <a href="http://docs.sun.com/doc/819-2254/usb-ia-7d?a=view"><tt>usb_ia</tt>(7D)</a> USB interface association driver is bound by default if no client driver is found. Then client drivers can be bound to the interface level of this interface association.</p></li></ul>
<p>The <tt>usb_mid</tt> driver creates an <tt>ia</tt> (interface association) node for each <tt>ia</tt>. The
compatible names of <tt>ia</tt> nodes generally begin with <tt>usbia</tt>. The name <tt>usb,ia</tt>
is a compatible name that represents any <tt>ia</tt> as the tail of the
compatible names. The <tt>usb_ia</tt> driver is bound to an <tt>ia</tt> node if no
other driver has claimed this <tt>ia</tt>. The <tt>usb_ia</tt> driver creates a child
node for each interface. An interface node as the child node of an
<tt>ia</tt> node has the same properties with an interface node as the child
of a device node.</p><a name="usb-51"></a><h6>Example&nbsp;20-4 USB Video Interface Association Compatible Names</h6><pre>1. 'usbia46d,8c9.5.config1.0' vend 46d, prod 8c9, rev 5, cnfg 1, first_if_in_ia 0
2. 'usbia46d,8c9.config1.0'   vend 46d, prod 8c9, cnfg 1, first_if_in_ia 0
3. 'usbia46d,classe.3.0'      vend 46d, class e, subclass 3, protocol 0
4. 'usbia46d,classe.3'        vend 46d, class e, subclass 3
5. 'usbia46d,classe'          vend 46d, class e
6. 'usbia,classe.3.0'         class e, subclass 3, protocol 0
7. 'usbia,classe.3'           class e, subclass 3
8. 'usbia,classe'             class e
9. 'usb,ia'                   by default</pre><p>Use the following command to bind a vendor-specific, device-specific client driver named <tt>vendor_model_video_usb</tt>
to the vendor-specific, device-specific configuration 1, first_if_in_ia 0 compatible name shown in <a href="#usb-51">Example&nbsp;20-4</a>:</p><pre>add_drv -n -i '"usbia46d,8c9.config1.0"' vendor_model_video_usb</pre><p>Use the following command to bind a class driver named <tt>video_class_usb_ia_driver</tt> to
the more general class e compatible names shown in <a href="#usb-51">Example&nbsp;20-4</a>:</p><pre>add_drv -n -i '"usbia,classee"' video_class_usb_ia_driver</pre><p>In the following example, the <tt>prtconf</tt>&nbsp;<tt>-D</tt> command shows a device tree of a
webcam with <tt>ia</tt> of <tt>video</tt> and <tt>audio</tt>. The <tt>usb_mid</tt> driver manages the
device and creates two <tt>ia</tt> respectively for video and audio. A video driver <tt>usbvc</tt>
is bound to the video <tt>ia</tt>, and audio drivers are bound to the
interface of the audio <tt>ia</tt>.</p><pre>miscellaneous, instance #28 (driver name: usb_mid)
    video, instance #24 (driver name: usbvc)
    audio, instance #30 (driver name: usb_ia)
        sound-control, instance #38 (driver name: usb_ac)
        sound, instance #47 (driver name: usb_as)</pre>

<a name="erfbg"></a><h4>Checking Device Driver Bindings</h4>
<a name="indexterm-859"></a><a name="indexterm-860"></a><a name="indexterm-861"></a><a name="indexterm-862"></a><p>The file <tt>/etc/driver_aliases</tt> contains entries for the bindings that already exist on a
system. Each line of the <tt>/etc/driver_aliases</tt> file shows a driver name, followed
by a space, followed by a device name. Use this file to check
existing device driver bindings.</p>
<hr><p><b>Note - </b>Do not edit the <tt>/etc/driver_aliases</tt> file manually. Use the <a href="http://docs.sun.com/doc/819-2240/add-drv-1m?a=view"><tt>add_drv</tt>(1M)</a> command to establish a
binding. Use the <a href="http://docs.sun.com/doc/819-2240/update-drv-1m?a=view"><tt>update_drv</tt>(1M)</a> command to change a binding.</p>
<hr>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="usb-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="usb-8.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

