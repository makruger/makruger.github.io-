<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Declarations and Data Structures - Writing Device Drivers</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">Writing Device Drivers</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="gld-overview.html">Previous</a>
             </td>
             <td align="right">
                 <a href="gld-args.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="eqbvu.html">Part&nbsp;I&nbsp;Designing Device Drivers for the Solaris Platform</a></p>
<p class="toc level2"><a href="eqbqn.html">1.&nbsp;&nbsp;Overview of Solaris Device Drivers</a></p>
<p class="toc level2"><a href="kernelovr-77198.html">2.&nbsp;&nbsp;Solaris Kernel and Device Tree</a></p>
<p class="toc level2"><a href="mt-17026.html">3.&nbsp;&nbsp;Multithreading</a></p>
<p class="toc level2"><a href="properties-1.html">4.&nbsp;&nbsp;Properties</a></p>
<p class="toc level2"><a href="events-1.html">5.&nbsp;&nbsp;Managing Events and Queueing Tasks</a></p>
<p class="toc level2"><a href="autoconf-17.html">6.&nbsp;&nbsp;Driver Autoconfiguration</a></p>
<p class="toc level2"><a href="devaccess-3.html">7.&nbsp;&nbsp;Device Access: Programmed I/O</a></p>
<p class="toc level2"><a href="interrupt-15678.html">8.&nbsp;&nbsp;Interrupt Handlers</a></p>
<p class="toc level2"><a href="dma-29901.html">9.&nbsp;&nbsp;Direct Memory Access (DMA)</a></p>
<p class="toc level2"><a href="devmap-24338.html">10.&nbsp;&nbsp;Mapping Device and Kernel Memory</a></p>
<p class="toc level2"><a href="devcnmgt-19679.html">11.&nbsp;&nbsp;Device Context Management</a></p>
<p class="toc level2"><a href="powermgt-37437.html">12.&nbsp;&nbsp;Power Management</a></p>
<p class="toc level2"><a href="gevsi.html">13.&nbsp;&nbsp;Hardening Solaris Drivers</a></p>
<p class="toc level2"><a href="ldi-1.html">14.&nbsp;&nbsp;Layered Driver Interface (LDI)</a></p>
<p class="toc level1 tocsp"><a href="eqbvb.html">Part&nbsp;II&nbsp;Designing Specific Kinds of Device Drivers</a></p>
<p class="toc level2"><a href="character-21002.html">15.&nbsp;&nbsp;Drivers for Character Devices</a></p>
<p class="toc level2"><a href="block-34861.html">16.&nbsp;&nbsp;Drivers for Block Devices</a></p>
<p class="toc level2"><a href="scsi-36812.html">17.&nbsp;&nbsp;SCSI Target Drivers</a></p>
<p class="toc level2"><a href="scsihba-32898.html">18.&nbsp;&nbsp;SCSI Host Bus Adapter Drivers</a></p>
<p class="toc level2"><a href="gld-1.html">19.&nbsp;&nbsp;Drivers for Network Devices</a></p>
<p class="toc level3"><a href="gld-overview.html">Generic LAN Driver Overview</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Declarations and Data Structures</a></p>
</div>
<p class="toc level3"><a href="gld-args.html">GLD Arguments</a></p>
<p class="toc level3"><a href="gld-ep.html">GLD Entry Points</a></p>
<p class="toc level3"><a href="gld-13.html">GLD Service Routines</a></p>
<p class="toc level2 tocsp"><a href="usb-1.html">20.&nbsp;&nbsp;USB Drivers</a></p>
<p class="toc level1 tocsp"><a href="eqbvo.html">Part&nbsp;III&nbsp;Building a Device Driver</a></p>
<p class="toc level2"><a href="loading-15035.html">21.&nbsp;&nbsp;Compiling, Loading, Packaging, and Testing Drivers</a></p>
<p class="toc level2"><a href="debug-60.html">22.&nbsp;&nbsp;Debugging, Testing, and Tuning Device Drivers</a></p>
<p class="toc level2"><a href="coding-practices.html">23.&nbsp;&nbsp;Recommended Coding Practices</a></p>
<p class="toc level1 tocsp"><a href="eqbva.html">Part&nbsp;IV&nbsp;Appendixes</a></p>
<p class="toc level2"><a href="hwovr-18191.html">A.&nbsp;&nbsp;Hardware Overview</a></p>
<p class="toc level2"><a href="ddidkisvc-29227.html">B.&nbsp;&nbsp;Summary of Solaris DDI/DKI Services</a></p>
<p class="toc level2"><a href="lp64-35004.html">C.&nbsp;&nbsp;Making a Device Driver 64-Bit Ready</a></p>
<p class="toc level2"><a href="euazz.html">D.&nbsp;&nbsp;Console Frame Buffer Drivers</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="gld-decdata"></a><h3>Declarations and Data Structures</h3>
<p><a name="indexterm-765"></a>This section describes the <tt>gld_mac_info</tt>(9S) and <tt>gld_stats</tt> structures.</p>

<a name="gld-macinfo"></a><h4><tt>gld_mac_info</tt> Structure</h4>
<a name="indexterm-766"></a><a name="indexterm-767"></a><p>The GLD MAC information (<tt>gld_mac_info</tt>) structure is the main data interface that links
the device-specific driver with GLD. This structure contains data required by GLD and
a pointer to an optional additional driver-specific information structure.</p><p>Allocate the <tt>gld_mac_info</tt> structure using <tt>gld_mac_alloc()</tt>. Deallocate the structure using <tt>gld_mac_free()</tt>. Drivers must
not make any assumptions about the length of this structure, which might vary
in different releases of the Solaris OS, GLD, or both. Structure members private
to GLD, not documented here, should neither be set nor be read by
the device-specific driver.</p><p>The <tt>gld_mac_info</tt>(9S) structure contains the following fields.</p><pre>caddr_t              gldm_private;              /* Driver private data */
int                  (*gldm_reset)();           /* Reset device */
int                  (*gldm_start)();           /* Start device */
int                  (*gldm_stop)();            /* Stop device */
int                  (*gldm_set_mac_addr)();    /* Set device phys addr */
int                  (*gldm_set_multicast)();   /* Set/delete multicast addr */
int                  (*gldm_set_promiscuous)(); /* Set/reset promiscuous mode */
int                  (*gldm_send)();            /* Transmit routine */
uint_t               (*gldm_intr)();            /* Interrupt handler */
int                  (*gldm_get_stats)();       /* Get device statistics */
int                  (*gldm_ioctl)();           /* Driver-specific ioctls */
char                 *gldm_ident;               /* Driver identity string */
uint32_t             gldm_type;                 /* Device type */
uint32_t             gldm_minpkt;               /* Minimum packet size */
                                                /* accepted by driver */
uint32_t             gldm_maxpkt;               /* Maximum packet size */
                                                /* accepted by driver */
uint32_t             gldm_addrlen;              /* Physical address length */
int32_t              gldm_saplen;               /* SAP length for DL_INFO_ACK */
unsigned char        *gldm_broadcast_addr;      /* Physical broadcast addr */
unsigned char        *gldm_vendor_addr;         /* Factory MAC address */
t_uscalar_t          gldm_ppa;                  /* Physical Point of */
                                                /* Attachment (PPA) number */
dev_info_t           *gldm_devinfo;             /* Pointer to device's */
                                                /* dev_info node */
ddi_iblock_cookie_t  gldm_cookie;               /* Device's interrupt */
                                                /* block cookie */</pre><p>The <tt>gldm_private</tt> structure member is visible to the device driver. <tt>gldm_private</tt> is also
private to the device-specific driver. <tt>gldm_private</tt> is not used or modified by GLD. Conventionally,
<tt>gldm_private</tt> is used as a pointer to private data, pointing to a per-instance
data structure that is both defined and allocated by the driver.</p><p><a name="indexterm-768"></a>The following group of structure members must be set by the driver before
calling <tt>gld_register()</tt>, and should not thereafter be modified by the driver. Because <tt>gld_register()</tt>
might use or cache the values of structure members, changes made by the
driver after calling <tt>gld_register()</tt> might cause unpredictable results. For more information on these structures,
see the <a href="http://docs.sun.com/doc/819-2255/gld-9e?a=view"><tt>gld</tt>(9E)</a> man page.</p><dl><dt><tt>gldm_reset</tt></dt>
<dd><p>Pointer to driver entry point.</p></dd>
<dt><tt>gldm_start</tt></dt>
<dd><p>Pointer to driver entry point.</p></dd>
<dt><tt>gldm_stop</tt></dt>
<dd><p>Pointer to driver entry point.</p></dd>
<dt><tt>gldm_set_mac_addr</tt></dt>
<dd><p>Pointer to driver entry point.</p></dd>
<dt><tt>gldm_set_multicast</tt></dt>
<dd><p>Pointer to driver entry point.</p></dd>
<dt><tt>gldm_set_promiscuous</tt></dt>
<dd><p>Pointer to driver entry point.</p></dd>
<dt><tt>gldm_send</tt></dt>
<dd><p>Pointer to driver entry point.</p></dd>
<dt><tt>gldm_intr</tt></dt>
<dd><p>Pointer to driver entry point.</p></dd>
<dt><tt>gldm_get_stats</tt></dt>
<dd><p>Pointer to driver entry point.</p></dd>
<dt><tt>gldm_ioctl</tt></dt>
<dd><p>Pointer to driver entry point. This pointer is allowed to be null.</p></dd>
<dt><tt>gldm_ident</tt></dt>
<dd><p>Pointer to a string that contains a short description of the device. This pointer is used to identify the device in system messages.</p></dd>
<dt><tt>gldm_type</tt></dt>
<dd><p>Type of device the driver handles. GLD currently supports the following values:</p>
<ul><li><p><tt>DL_ETHER</tt> (ISO 8802-3 (IEEE 802.3) and Ethernet Bus)</p></li>
<li><p><tt>DL_TPR</tt> (IEEE 802.5 Token Passing Ring)</p></li>
<li><p><tt>DL_FDDI</tt> (ISO 9314-2 Fibre Distributed Data Interface)</p></li></ul>
<p>This structure member must be correctly set for GLD to function properly.</p></dd>
<dt><tt>gldm_minpkt</tt></dt>
<dd><p>Minimum <i>Service</i> <i>Data</i> <i>Unit</i> size: the minimum packet size, not including the MAC header, that the device can transmit. This size is allowed to be zero if the device-specific driver handles any required padding.</p></dd>
<dt><tt>gldm_maxpkt</tt></dt>
<dd><p>Maximum <i>Service</i> <i>Data</i> <i>Unit</i> size: the maximum size of packet, not including the MAC header, that can be transmitted by the device. For Ethernet, this number is 1500.</p></dd>
<dt><tt>gldm_addrlen</tt></dt>
<dd><p>The length in bytes of physical addresses handled by the device. For Ethernet, Token Ring, and FDDI, the value of this structure member should be 6.</p></dd>
<dt><tt>gldm_saplen</tt></dt>
<dd><p>The length in bytes of the SAP address used by the driver. For GLD-based drivers, the length should always be set to <tt>-2</tt>. A length of <tt>-2</tt> indicates that 2-byte SAP values are supported and that the SAP appears <i>after</i> the physical address in a DLSAP address. See Appendix A.2, &ldquo;Message DL_INFO_ACK,&rdquo; in the DLPI specification for more details.</p></dd>
<dt><tt>gldm_broadcast_addr</tt></dt>
<dd><p>Pointer to an array of bytes of length <tt>gldm_addrlen</tt> containing the broadcast address to be used for transmit. The driver must provide space to hold the broadcast address, fill the space with the appropriate value, and set <tt>gldm_broadcast_addr</tt> to point to the address. For Ethernet, Token Ring, and FDDI, the broadcast address is normally <tt>0xFF-FF-FF-FF-FF-FF</tt>.</p></dd>
<dt><tt>gldm_vendor_addr</tt></dt>
<dd><p>Pointer to an array of bytes of length <tt>gldm_addrlen</tt> that contains the vendor-provided network physical address of the device. The driver must provide space to hold the address, fill the space with information  from the device, and set <tt>gldm_vendor_addr</tt> to point to the address.</p></dd>
<dt><tt>gldm_ppa</tt></dt>
<dd><p><a name="indexterm-769"></a>PPA number for this instance of the device. The PPA number should always be set to the instance number that is returned from <a href="http://docs.sun.com/doc/819-2256/ddi-get-instance-9f?a=view"><tt>ddi_get_instance</tt>(9F)</a>.</p></dd>
<dt><tt>gldm_devinfo</tt></dt>
<dd><p>Pointer to the <tt>dev_info</tt> node for this device.</p></dd>
<dt><tt>gldm_cookie</tt></dt>
<dd><p>Interrupt block cookie returned by one of the following routines:</p>
<ul><li><p><a href="http://docs.sun.com/doc/819-2256/ddi-get-iblock-cookie-9f?a=view"><tt>ddi_get_iblock_cookie</tt>(9F)</a></p></li>
<li><p><a href="http://docs.sun.com/doc/819-2256/ddi-add-intr-9f?a=view"><tt>ddi_add_intr</tt>(9F)</a></p></li>
<li><p><a href="http://docs.sun.com/doc/819-2256/ddi-get-soft-iblock-cookie-9f?a=view"><tt>ddi_get_soft_iblock_cookie</tt>(9F)</a></p></li>
<li><p><a href="http://docs.sun.com/doc/819-2256/ddi-add-softintr-9f?a=view"><tt>ddi_add_softintr</tt>(9F)</a></p></li></ul>
<p>This cookie must correspond to the device's receive-interrupt, from which <tt>gld_recv()</tt> is called.</p></dd>
</dl>


<a name="gld-stats"></a><h4><tt>gld_stats</tt> Structure</h4>
<a name="indexterm-770"></a><a name="indexterm-771"></a><p>After calling <tt>gldm_get_stats()</tt>, a GLD-based driver uses the (<tt>gld_stats</tt>) structure to communicate statistics and
state information to GLD. See the <tt>gld</tt>(9E) and <tt>gld</tt>(7D) man pages. The
members of this structure, having been filled in by the GLD-based driver, are
used when GLD reports the statistics. In the tables below, the name of
the statistics variable reported by GLD is noted in the comments. See the
<a href="http://docs.sun.com/doc/819-2254/gld-7d?a=view"><tt>gld</tt>(7D)</a> man page for a more detailed description of the meaning of each
statistic.</p><p>Drivers must not make any assumptions about the length of this structure. The
structure length might vary in different releases of the Solaris OS, GLD, or
both. Structure members private to GLD, which are not documented here, should not
be set or be read by the device-specific driver.</p><p>The following structure members are defined for all media types:</p><pre>uint64_t    glds_speed;                   /* ifspeed */
uint32_t    glds_media;                   /* media */
uint32_t    glds_intr;                    /* intr */
uint32_t    glds_norcvbuf;                /* norcvbuf */
uint32_t    glds_errrcv;                  /* ierrors */
uint32_t    glds_errxmt;                  /* oerrors */
uint32_t    glds_missed;                  /* missed */
uint32_t    glds_underflow;               /* uflo */
uint32_t    glds_overflow;                /* oflo */</pre><p>The following structure members are defined for media type <tt>DL_ETHER</tt>:</p><pre>uint32_t    glds_frame;                   /* align_errors */
uint32_t    glds_crc;                     /* fcs_errors */
uint32_t    glds_duplex;                  /* duplex */
uint32_t    glds_nocarrier;               /* carrier_errors */
uint32_t    glds_collisions;              /* collisions */
uint32_t    glds_excoll;                  /* ex_collisions */
uint32_t    glds_xmtlatecoll;             /* tx_late_collisions */
uint32_t    glds_defer;                   /* defer_xmts */
uint32_t    glds_dot3_first_coll;         /* first_collisions */
uint32_t    glds_dot3_multi_coll;         /* multi_collisions */
uint32_t    glds_dot3_sqe_error;          /* sqe_errors */
uint32_t    glds_dot3_mac_xmt_error;      /* macxmt_errors */
uint32_t    glds_dot3_mac_rcv_error;      /* macrcv_errors */
uint32_t    glds_dot3_frame_too_long;     /* toolong_errors */
uint32_t    glds_short;                   /* runt_errors */</pre><p>The following structure members are defined for media type <tt>DL_TPR</tt>:</p><pre>uint32_t    glds_dot5_line_error          /* line_errors */
uint32_t    glds_dot5_burst_error         /* burst_errors */
uint32_t    glds_dot5_signal_loss         /* signal_losses */
uint32_t    glds_dot5_ace_error           /* ace_errors */
uint32_t    glds_dot5_internal_error      /* internal_errors */
uint32_t    glds_dot5_lost_frame_error    /* lost_frame_errors */
uint32_t    glds_dot5_frame_copied_error  /* frame_copied_errors */
uint32_t    glds_dot5_token_error         /* token_errors */
uint32_t    glds_dot5_freq_error          /* freq_errors */</pre><p>The following structure members are defined for media type <tt>DL_FDDI</tt>:</p><pre>uint32_t    glds_fddi_mac_error;          /* mac_errors */
uint32_t    glds_fddi_mac_lost;           /* mac_lost_errors */
uint32_t    glds_fddi_mac_token;          /* mac_tokens */
uint32_t    glds_fddi_mac_tvx_expired;    /* mac_tvx_expired */
uint32_t    glds_fddi_mac_late;           /* mac_late */
uint32_t    glds_fddi_mac_ring_op;        /* mac_ring_ops */</pre><p>Most of the above statistics variables are counters that denote the number of
times that the particular event was observed. The following statistics do not represent
the number of times:</p><dl><dt><tt>glds_speed</tt></dt>
<dd><p>Estimate of the interface's current bandwidth in bits per second. This object should contain the nominal bandwidth for those interfaces that do not vary in bandwidth or where an accurate estimate cannot be made.</p></dd>
<dt><tt>glds_media</tt></dt>
<dd><p>Type of media (wiring) or connector used by the hardware. The following media names are supported:</p>
<ul><li><p><tt>GLDM_AUI</tt></p></li>
<li><p><tt>GLDM_BNC</tt></p></li>
<li><p><tt>GLDM_TP</tt></p></li>
<li><p><tt>GLDM_10BT</tt></p></li>
<li><p><tt>GLDM_100BT</tt></p></li>
<li><p><tt>GLDM_100BTX</tt></p></li>
<li><p><tt>GLDM_100BT4</tt></p></li>
<li><p><tt>GLDM_RING4</tt></p></li>
<li><p><tt>GLDM_RING16</tt></p></li>
<li><p><tt>GLDM_FIBER</tt></p></li>
<li><p><tt>GLDM_PHYMII</tt></p></li>
<li><p><tt>GLDM_UNKNOWN</tt></p></li></ul>
</dd>
<dt><tt>glds_duplex</tt></dt>
<dd><p>Current duplex state of the interface. Supported values are <tt>GLD_DUPLEX_HALF</tt> and <tt>GLD_DUPLEX_FULL</tt>. <tt>GLD_DUPLEX_UNKNOWN</tt> is also allowed.</p></dd>
</dl>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="gld-overview.html">Previous</a>
             </td>
             <td align="right">
                 <a href="gld-args.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

