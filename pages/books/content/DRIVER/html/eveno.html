<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Solaris Consoles and the Kernel Terminal Emulator - Writing Device Drivers</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">Writing Device Drivers</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="euazz.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ewibs.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="eqbvu.html">Part&nbsp;I&nbsp;Designing Device Drivers for the Solaris Platform</a></p>
<p class="toc level2"><a href="eqbqn.html">1.&nbsp;&nbsp;Overview of Solaris Device Drivers</a></p>
<p class="toc level2"><a href="kernelovr-77198.html">2.&nbsp;&nbsp;Solaris Kernel and Device Tree</a></p>
<p class="toc level2"><a href="mt-17026.html">3.&nbsp;&nbsp;Multithreading</a></p>
<p class="toc level2"><a href="properties-1.html">4.&nbsp;&nbsp;Properties</a></p>
<p class="toc level2"><a href="events-1.html">5.&nbsp;&nbsp;Managing Events and Queueing Tasks</a></p>
<p class="toc level2"><a href="autoconf-17.html">6.&nbsp;&nbsp;Driver Autoconfiguration</a></p>
<p class="toc level2"><a href="devaccess-3.html">7.&nbsp;&nbsp;Device Access: Programmed I/O</a></p>
<p class="toc level2"><a href="interrupt-15678.html">8.&nbsp;&nbsp;Interrupt Handlers</a></p>
<p class="toc level2"><a href="dma-29901.html">9.&nbsp;&nbsp;Direct Memory Access (DMA)</a></p>
<p class="toc level2"><a href="devmap-24338.html">10.&nbsp;&nbsp;Mapping Device and Kernel Memory</a></p>
<p class="toc level2"><a href="devcnmgt-19679.html">11.&nbsp;&nbsp;Device Context Management</a></p>
<p class="toc level2"><a href="powermgt-37437.html">12.&nbsp;&nbsp;Power Management</a></p>
<p class="toc level2"><a href="gevsi.html">13.&nbsp;&nbsp;Hardening Solaris Drivers</a></p>
<p class="toc level2"><a href="ldi-1.html">14.&nbsp;&nbsp;Layered Driver Interface (LDI)</a></p>
<p class="toc level1 tocsp"><a href="eqbvb.html">Part&nbsp;II&nbsp;Designing Specific Kinds of Device Drivers</a></p>
<p class="toc level2"><a href="character-21002.html">15.&nbsp;&nbsp;Drivers for Character Devices</a></p>
<p class="toc level2"><a href="block-34861.html">16.&nbsp;&nbsp;Drivers for Block Devices</a></p>
<p class="toc level2"><a href="scsi-36812.html">17.&nbsp;&nbsp;SCSI Target Drivers</a></p>
<p class="toc level2"><a href="scsihba-32898.html">18.&nbsp;&nbsp;SCSI Host Bus Adapter Drivers</a></p>
<p class="toc level2"><a href="gld-1.html">19.&nbsp;&nbsp;Drivers for Network Devices</a></p>
<p class="toc level2"><a href="usb-1.html">20.&nbsp;&nbsp;USB Drivers</a></p>
<p class="toc level1 tocsp"><a href="eqbvo.html">Part&nbsp;III&nbsp;Building a Device Driver</a></p>
<p class="toc level2"><a href="loading-15035.html">21.&nbsp;&nbsp;Compiling, Loading, Packaging, and Testing Drivers</a></p>
<p class="toc level2"><a href="debug-60.html">22.&nbsp;&nbsp;Debugging, Testing, and Tuning Device Drivers</a></p>
<p class="toc level2"><a href="coding-practices.html">23.&nbsp;&nbsp;Recommended Coding Practices</a></p>
<p class="toc level1 tocsp"><a href="eqbva.html">Part&nbsp;IV&nbsp;Appendixes</a></p>
<p class="toc level2"><a href="hwovr-18191.html">A.&nbsp;&nbsp;Hardware Overview</a></p>
<p class="toc level2"><a href="ddidkisvc-29227.html">B.&nbsp;&nbsp;Summary of Solaris DDI/DKI Services</a></p>
<p class="toc level2"><a href="lp64-35004.html">C.&nbsp;&nbsp;Making a Device Driver 64-Bit Ready</a></p>
<p class="toc level2"><a href="euazz.html">D.&nbsp;&nbsp;Console Frame Buffer Drivers</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Solaris Consoles and the Kernel Terminal Emulator</a></p>
</div>
<p class="toc level3"><a href="ewibs.html">Console Visual I/O Interfaces</a></p>
<p class="toc level3"><a href="ewibr.html">Implementing the Visual I/O Interfaces in Console Frame Buffer Drivers</a></p>
<p class="toc level3"><a href="gcbpn.html">Implementing Polled I/O in Console Frame Buffer Drivers</a></p>
<p class="toc level3"><a href="gcbpl.html">Frame Buffer Specific Configuration Module</a></p>
<p class="toc level3"><a href="gcbrg.html">The X Window System Frame Buffer Specific DDX Module</a></p>
<p class="toc level3"><a href="ewibu.html">Developing, Testing, and Debugging Console Frame Buffer Drivers</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="eveno"></a><h3>Solaris Consoles and the Kernel Terminal Emulator</h3>
<p><a name="indexterm-1368"></a><a name="indexterm-1369"></a><a name="indexterm-1370"></a><a name="indexterm-1371"></a><a name="indexterm-1372"></a><a name="indexterm-1373"></a>The role of the kernel terminal emulator is to render text onto the
console frame buffer in the proper position and representation determined by the frame
buffer's screen height, width, and pixel depth mode. The terminal emulator also drives
scrolling, controls a software cursor, and interprets ANSI terminal escape sequences. The terminal
emulator accesses the console frame buffer in either VGA text mode or pixel
mode, depending upon the graphics card. To be used as a Solaris console
frame buffer driver, your frame buffer driver must be compatible with the Solaris
kernel terminal emulator. The target platform is the most significant factor that determines
whether you need to modify your frame buffer driver to make your driver
compatible with the Solaris kernel terminal emulator.</p>
<ul><li><p>x86 platforms &ndash; Console frame buffer drivers do not need to be modified because x86 console frame buffer drivers already support the console frame buffer interfaces.</p></li>
<li><p>SPARC platforms &ndash; Console frame buffer drivers should use the interfaces described in this appendix to enable the driver to interact with the Solaris kernel terminal emulator.</p></li></ul>


<a name="ewavn"></a><h4>x86 Platform Console Communication</h4>
<a name="indexterm-1374"></a><a name="indexterm-1375"></a><a name="indexterm-1376"></a><p>On x86 platforms, the Solaris kernel terminal emulator module (<tt>tem</tt>) uses VGA
text mode exclusively to interact with the <tt>vgatext</tt> module. The <tt>vgatext</tt> module uses
industry standard VGA text mode to interact with x86 compatible frame buffer devices.
Because the <tt>vgatext</tt> module already supports the console frame buffer interfaces, x86 frame
buffer drivers are compatible with the kernel <tt>tem</tt> module. You do not need
to add special  interfaces to x86 frame buffer drivers.</p><p>The remainder of this appendix applies to SPARC platforms only.</p>

<a name="ewaua"></a><h4>SPARC Platform Console Communication</h4>
<a name="indexterm-1377"></a><p>SPARC frame buffer drivers typically do not operate in VGA text mode. SPARC
frame buffer drivers typically are required to send pixel patterns that depict the
text and images displayed. The kernel <tt>tem</tt> requires SPARC drivers to support specific
interfaces to facilitate rendering data to the screen, perform scrolling, and display a
text cursor. How the driver actually renders data sent from the <tt>tem</tt> onto
the screen depends on the device. The driver typically draws the data into
video memory according to the hardware and video mode.</p><p>The Solaris OS provides interfaces that enable the kernel terminal emulator to drive
compatible console frame buffers directly. The advantages of converting a driver to be
compatible with the kernel terminal emulator are:</p>
<ul><li><p>Dramatically improved performance, particularly for scrolling</p></li>
<li><p>Enhanced ANSI text color capabilities</p></li>
<li><p>The ability to start a login session on the console frame buffer even when the system console stream is directed out the serial port</p></li></ul>
<p>SPARC console frame buffer drivers are not required to be compatible with the
kernel terminal emulator. If the console frame buffer driver is not compatible with
the kernel terminal emulator, the system uses the FCode terminal emulator in the
OpenBoot PROM.</p><p><a name="indexterm-1378"></a><a name="indexterm-1379"></a>The console frame buffer is identified through the EEPROM <tt>screen</tt> environment variable. The
system determines whether the console frame buffer is compatible with the kernel terminal
emulator module by checking whether the frame buffer driver exports the <tt>tem-support</tt> DDI
property. If the <tt>tem-support</tt> property is exported, then the system issues the <tt>VIS_DEVINIT</tt>
I/O control (<tt>ioctl</tt>) command to the frame buffer driver during system boot, while configuring
the console. If the <tt>tem-support</tt> DDI property is exported and the <tt>VIS_DEVINIT</tt> <tt>ioctl</tt>
command succeeds and returns a compatible version number to the <tt>tem</tt>, the system configures
the system console to utilize that frame buffer driver through the kernel terminal
emulator. See the <a href="http://docs.sun.com/doc/819-2255/ioctl-9e?a=view"><tt>ioctl</tt>(9E)</a> man page for information about the I/O control driver
entry point.</p><p>SPARC drivers that support the kernel terminal emulator should export the <tt>tem-support</tt> DDI
property.  This property indicates that the driver supports the kernel terminal emulator.
If a frame buffer driver exports the <tt>tem-support</tt> DDI property, then that driver will
be handled early in the boot process, while the console is being
configured. If a frame buffer driver does not export the <tt>tem-support</tt> property, then that
driver might not be handled early enough in the boot process.</p><dl><dt><tt>tem-support</tt></dt>
<dd><p>When set to 1, this DDI property indicates that this driver is compatible with the console kernel frame buffer interface.</p></dd>
</dl>
<p>The kernel terminal emulator module interacts with the console frame buffer driver through
two major interfaces:</p>
<ul><li><p>Through <tt>ioctl</tt> interfaces during normal system operation</p></li>
<li><p>Through polled I/O interfaces during standalone mode</p></li></ul>
<p>The following section provides detailed information.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="euazz.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ewibs.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

