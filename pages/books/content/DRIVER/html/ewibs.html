<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Console Visual I/O Interfaces - Writing Device Drivers</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-08-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">Writing Device Drivers</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="eveno.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ewibr.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="eqbvu.html">Part&nbsp;I&nbsp;Designing Device Drivers for the Solaris Platform</a></p>
<p class="toc level2"><a href="eqbqn.html">1.&nbsp;&nbsp;Overview of Solaris Device Drivers</a></p>
<p class="toc level2"><a href="kernelovr-77198.html">2.&nbsp;&nbsp;Solaris Kernel and Device Tree</a></p>
<p class="toc level2"><a href="mt-17026.html">3.&nbsp;&nbsp;Multithreading</a></p>
<p class="toc level2"><a href="properties-1.html">4.&nbsp;&nbsp;Properties</a></p>
<p class="toc level2"><a href="events-1.html">5.&nbsp;&nbsp;Managing Events and Queueing Tasks</a></p>
<p class="toc level2"><a href="autoconf-17.html">6.&nbsp;&nbsp;Driver Autoconfiguration</a></p>
<p class="toc level2"><a href="devaccess-3.html">7.&nbsp;&nbsp;Device Access: Programmed I/O</a></p>
<p class="toc level2"><a href="interrupt-15678.html">8.&nbsp;&nbsp;Interrupt Handlers</a></p>
<p class="toc level2"><a href="dma-29901.html">9.&nbsp;&nbsp;Direct Memory Access (DMA)</a></p>
<p class="toc level2"><a href="devmap-24338.html">10.&nbsp;&nbsp;Mapping Device and Kernel Memory</a></p>
<p class="toc level2"><a href="devcnmgt-19679.html">11.&nbsp;&nbsp;Device Context Management</a></p>
<p class="toc level2"><a href="powermgt-37437.html">12.&nbsp;&nbsp;Power Management</a></p>
<p class="toc level2"><a href="gevsi.html">13.&nbsp;&nbsp;Hardening Solaris Drivers</a></p>
<p class="toc level2"><a href="ldi-1.html">14.&nbsp;&nbsp;Layered Driver Interface (LDI)</a></p>
<p class="toc level1 tocsp"><a href="eqbvb.html">Part&nbsp;II&nbsp;Designing Specific Kinds of Device Drivers</a></p>
<p class="toc level2"><a href="character-21002.html">15.&nbsp;&nbsp;Drivers for Character Devices</a></p>
<p class="toc level2"><a href="block-34861.html">16.&nbsp;&nbsp;Drivers for Block Devices</a></p>
<p class="toc level2"><a href="scsi-36812.html">17.&nbsp;&nbsp;SCSI Target Drivers</a></p>
<p class="toc level2"><a href="scsihba-32898.html">18.&nbsp;&nbsp;SCSI Host Bus Adapter Drivers</a></p>
<p class="toc level2"><a href="gld-1.html">19.&nbsp;&nbsp;Drivers for Network Devices</a></p>
<p class="toc level2"><a href="usb-1.html">20.&nbsp;&nbsp;USB Drivers</a></p>
<p class="toc level1 tocsp"><a href="eqbvo.html">Part&nbsp;III&nbsp;Building a Device Driver</a></p>
<p class="toc level2"><a href="loading-15035.html">21.&nbsp;&nbsp;Compiling, Loading, Packaging, and Testing Drivers</a></p>
<p class="toc level2"><a href="debug-60.html">22.&nbsp;&nbsp;Debugging, Testing, and Tuning Device Drivers</a></p>
<p class="toc level2"><a href="coding-practices.html">23.&nbsp;&nbsp;Recommended Coding Practices</a></p>
<p class="toc level1 tocsp"><a href="eqbva.html">Part&nbsp;IV&nbsp;Appendixes</a></p>
<p class="toc level2"><a href="hwovr-18191.html">A.&nbsp;&nbsp;Hardware Overview</a></p>
<p class="toc level2"><a href="ddidkisvc-29227.html">B.&nbsp;&nbsp;Summary of Solaris DDI/DKI Services</a></p>
<p class="toc level2"><a href="lp64-35004.html">C.&nbsp;&nbsp;Making a Device Driver 64-Bit Ready</a></p>
<p class="toc level2"><a href="euazz.html">D.&nbsp;&nbsp;Console Frame Buffer Drivers</a></p>
<p class="toc level3"><a href="eveno.html">Solaris Consoles and the Kernel Terminal Emulator</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Console Visual I/O Interfaces</a></p>
</div>
<p class="toc level3"><a href="ewibr.html">Implementing the Visual I/O Interfaces in Console Frame Buffer Drivers</a></p>
<p class="toc level3"><a href="gcbpn.html">Implementing Polled I/O in Console Frame Buffer Drivers</a></p>
<p class="toc level3"><a href="gcbpl.html">Frame Buffer Specific Configuration Module</a></p>
<p class="toc level3"><a href="gcbrg.html">The X Window System Frame Buffer Specific DDX Module</a></p>
<p class="toc level3"><a href="ewibu.html">Developing, Testing, and Debugging Console Frame Buffer Drivers</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="ewibs"></a><h3>Console Visual I/O Interfaces</h3>
<p><a name="indexterm-1380"></a><a name="indexterm-1381"></a><a name="indexterm-1382"></a><a name="indexterm-1383"></a><a name="indexterm-1384"></a>The kernel terminal emulator interacts with the console frame buffer driver through two interfaces.
During normal system activity (after a successful boot of the system), communication between
the kernel terminal emulator and the console frame buffer driver is through <tt>ioctl</tt>
interfaces. During standalone mode (before system boot or during debugging), communication between the kernel
terminal emulator and the console frame buffer driver is through polled I/O interfaces.
All activity between the kernel terminal emulator and the console frame buffer driver
is initiated by the kernel terminal emulator, with the exception of a callback
function used by the console frame buffer driver to notify the kernel terminal
emulator of changes in the video mode.</p><p>The console visual I/O interfaces are documented in detail in the <a href="http://docs.sun.com/doc/819-2254/visual-io-7i?a=view"><tt>visual_io</tt>(7I)</a>
man page. For more information on the video mode change callback function, see
<a href="#ewprh">Video Mode Change Callback Interface</a>.</p>

<a name="ewpql"></a><h4>I/O Control Interfaces</h4>
<p>During normal system activity, the kernel terminal emulator communicates with the console frame
buffer driver through the <tt>ioctl</tt> interfaces listed in the following table:</p><table><col width="33%"><col width="33%"><col width="33%"><tr><th align="left" valign="top" scope="column"><p><tt>ioctl</tt> Name</p></th>
<th align="left" valign="top" scope="column"><p>Corresponding Data
Structure</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>VIS_DEVINIT</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>vis_devinit</tt></p></td>
<td align="left" valign="top" scope="row"><p>Initializes the session between the terminal emulator module and the frame buffer. See
<a href="ewibr.html#exehb"><tt>VIS_DEVINIT</tt></a>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>VIS_DEVFINI</tt></p></td>
<td align="left" valign="top" scope="row"><p>Not Applicable</p></td>
<td align="left" valign="top" scope="row"><p>Terminates the session between the terminal emulator module and the frame buffer.
See <a href="ewibr.html#exeht"><tt>VIS_DEFINI</tt></a>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>VIS_CONSDISPLAY</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>vis_consdisplay</tt></p></td>
<td align="left" valign="top" scope="row"><p>Displays pixels as a rectangle. See <a href="ewibr.html#exehz"><tt>VIS_CONSDISPLAY</tt></a>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>VIS_CONSCOPY</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>vis_conscopy</tt></p></td>
<td align="left" valign="top" scope="row"><p>Copies a rectangle of pixels
(scroll). See <a href="ewibr.html#exeib"><tt>VIS_CONSCOPY</tt></a>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>VIS_CONSCURSOR</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>vis_conscursor</tt></p></td>
<td align="left" valign="top" scope="row"><p>Displays or hides a text cursor. See <a href="ewibr.html#exeix"><tt>VIS_CONSCURSOR</tt></a>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>VIS_PUTCMAP</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>vis_cmap</tt></p></td>
<td align="left" valign="top" scope="row"><p>Sends the terminal
emulator module color map to the frame buffer driver. See <a href="ewibr.html#exejd"><tt>VIS_PUTCMAP</tt></a>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>VIS_GETCMAP</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>vis_cmap</tt></p></td>
<td align="left" valign="top" scope="row"><p>Reads the terminal
emulator module color map from the frame buffer. See <a href="ewibr.html#exlrl"><tt>VIS_GETCMAP</tt></a>.</p></td>
</tr>
</table>

<a name="ewpqm"></a><h4>Polled I/O Interfaces</h4>
<p><a name="indexterm-1385"></a><a name="indexterm-1386"></a><a name="indexterm-1387"></a><a name="indexterm-1388"></a>The polled I/O interfaces provide the same functionality as the <tt>VIS_CONSDISPLAY</tt>, <tt>VIS_CONSCOPY</tt>, and
<tt>VIS_CONSCURSOR</tt> <tt>ioctl</tt> interfaces. The polled I/O interfaces are called only when the operating
system is quiesced and in <b>standalone</b> mode. See <a href="gcbpn.html">Implementing Polled I/O in Console Frame Buffer Drivers</a> for more information.</p><p>While in standalone mode, the kernel terminal emulator communicates with the console frame
buffer driver through the polled I/O interfaces listed in the following table:</p><table><col width="33%"><col width="33%"><col width="33%"><tr><th align="left" valign="top" scope="column"><p>Polled I/O
Function</p></th>
<th align="left" valign="top" scope="column"><p>Corresponding Data Structure</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>(*display)()</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>vis_consdisplay</tt></p></td>
<td align="left" valign="top" scope="row"><p>Displays pixels as a rectangle.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>(*copy)()</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>vis_conscopy</tt></p></td>
<td align="left" valign="top" scope="row"><p>Copies a rectangle of pixels (scroll).</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>(*cursor)()</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>vis_conscursor</tt></p></td>
<td align="left" valign="top" scope="row"><p>Displays
or hides a text cursor.</p></td>
</tr>
</table>

<a name="ewprh"></a><h4>Video Mode Change Callback Interface</h4>
<p><a name="indexterm-1389"></a><a name="indexterm-1390"></a>The console frame buffer driver and the kernel terminal emulator must be in
agreement about the video mode at all times. <b>Video mode</b> includes the console
screen height, width, and depth in pixels. Video mode also includes whether communication
between the kernel terminal emulator and the console frame buffer is in VGA
text mode or pixel mode.</p><p>In order for the console frame buffer driver to notify the kernel
terminal emulator of changes in the video mode, the console frame buffer driver
is initialized with the address of the <tt>(*modechg_cb)()</tt> kernel terminal emulator callback function described
in the following table:</p><table><col width="33%"><col width="33%"><col width="33%"><tr><th align="left" valign="top" scope="column"><p>Callback Function</p></th>
<th align="left" valign="top" scope="column"><p>Corresponding Data Structures</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>(*modechg_cb)()</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>vis_modechg_arg</tt></p><p><tt>vis_devinit</tt></p></td>
<td align="left" valign="top" scope="row"><p>Keep the terminal emulator module synchronized
with the driver video mode (screen height, width, and pixel depth).</p></td>
</tr>
</table>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="eveno.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ewibr.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

