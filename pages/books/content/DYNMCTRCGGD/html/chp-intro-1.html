<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Getting Started - Solaris Dynamic Tracing Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-11-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">Solaris Dynamic Tracing Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="chp-intro.html">Previous</a>
             </td>
             <td align="right">
                 <a href="chp-intro-2.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="chp-intro.html">1.&nbsp;&nbsp;Introduction</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Getting Started</a></p>
</div>
<p class="toc level2"><a href="chp-intro-2.html">Providers and Probes</a></p>
<p class="toc level2"><a href="chp-intro-3.html">Compilation and Instrumentation</a></p>
<p class="toc level2"><a href="chp-intro-4.html">Variables and Arithmetic Expressions</a></p>
<p class="toc level2"><a href="chp-intro-5.html">Predicates</a></p>
<p class="toc level2"><a href="chp-intro-6.html">Output Formatting</a></p>
<p class="toc level2"><a href="chp-intro-7.html">Arrays</a></p>
<p class="toc level2"><a href="chp-intro-8.html">External Symbols and Types</a></p>
<p class="toc level1 tocsp"><a href="chp-typeopexpr.html">2.&nbsp;&nbsp;Types, Operators, and Expressions</a></p>
<p class="toc level1 tocsp"><a href="chp-variables.html">3.&nbsp;&nbsp;Variables</a></p>
<p class="toc level1 tocsp"><a href="chp-prog.html">4.&nbsp;&nbsp;D Program Structure</a></p>
<p class="toc level1 tocsp"><a href="chp-pointers.html">5.&nbsp;&nbsp;Pointers and Arrays</a></p>
<p class="toc level1 tocsp"><a href="chp-strings.html">6.&nbsp;&nbsp;Strings</a></p>
<p class="toc level1 tocsp"><a href="chp-structs.html">7.&nbsp;&nbsp;Structs and Unions</a></p>
<p class="toc level1 tocsp"><a href="chp-types.html">8.&nbsp;&nbsp;Type and Constant Definitions</a></p>
<p class="toc level1 tocsp"><a href="chp-aggs.html">9.&nbsp;&nbsp;Aggregations</a></p>
<p class="toc level1 tocsp"><a href="chp-actsub.html">10.&nbsp;&nbsp;Actions and Subroutines</a></p>
<p class="toc level1 tocsp"><a href="chp-buf.html">11.&nbsp;&nbsp;Buffers and Buffering</a></p>
<p class="toc level1 tocsp"><a href="chp-fmt.html">12.&nbsp;&nbsp;Output Formatting</a></p>
<p class="toc level1 tocsp"><a href="chp-spec.html">13.&nbsp;&nbsp;Speculative Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-dtrace1m.html">14.&nbsp;&nbsp;<tt>dtrace</tt>(1M) Utility</a></p>
<p class="toc level1 tocsp"><a href="chp-script.html">15.&nbsp;&nbsp;Scripting</a></p>
<p class="toc level1 tocsp"><a href="chp-opt.html">16.&nbsp;&nbsp;Options and Tunables</a></p>
<p class="toc level1 tocsp"><a href="chp-dtrace.html">17.&nbsp;&nbsp;<tt>dtrace</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-lockstat.html">18.&nbsp;&nbsp;<tt>lockstat</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-profile.html">19.&nbsp;&nbsp;<tt>profile</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fbt.html">20.&nbsp;&nbsp;<tt>fbt</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-syscall.html">21.&nbsp;&nbsp;<tt>syscall</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sdt.html">22.&nbsp;&nbsp;<tt>sdt</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sysinfo.html">23.&nbsp;&nbsp;<tt>sysinfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-vminfo.html">24.&nbsp;&nbsp;<tt>vminfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-proc.html">25.&nbsp;&nbsp;<tt>proc</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sched.html">26.&nbsp;&nbsp;<tt>sched</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-io.html">27.&nbsp;&nbsp;<tt>io</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-mib.html">28.&nbsp;&nbsp;<tt>mib</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fpuinfo.html">29.&nbsp;&nbsp;<tt>fpuinfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-pid.html">30.&nbsp;&nbsp;<tt>pid</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-plockstat.html">31.&nbsp;&nbsp;<tt>plockstat</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fasttrap.html">32.&nbsp;&nbsp;<tt>fasttrap</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-user.html">33.&nbsp;&nbsp;User Process Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-usdt.html">34.&nbsp;&nbsp;Statically Defined Tracing for User Applications</a></p>
<p class="toc level1 tocsp"><a href="chp-sec.html">35.&nbsp;&nbsp;Security</a></p>
<p class="toc level1 tocsp"><a href="chp-anon.html">36.&nbsp;&nbsp;Anonymous Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-post.html">37.&nbsp;&nbsp;Postmortem Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-perf.html">38.&nbsp;&nbsp;Performance Considerations</a></p>
<p class="toc level1 tocsp"><a href="chp-stab.html">39.&nbsp;&nbsp;Stability</a></p>
<p class="toc level1 tocsp"><a href="chp-xlate.html">40.&nbsp;&nbsp;Translators</a></p>
<p class="toc level1 tocsp"><a href="chp-vers.html">41.&nbsp;&nbsp;Versioning</a></p>
<p class="toc level1 tocsp"><a href="gloss01.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="chp-intro-1"></a><h3>Getting Started</h3>
<p>DTrace helps you understand a software system by enabling you to dynamically modify
the operating system kernel and user processes to record additional data that you
specify at locations of interest, called <b>probes</b>. A probe is a location or
activity to which DTrace can bind a request to perform a set of
<b>actions</b>, like recording a stack trace, a timestamp, or the argument to a
function. Probes are like programmable sensors scattered all over your Solaris system in
interesting places. If you want to figure out what's going on, you use
DTrace to program the appropriate sensors to record the information that is of
interest to you. Then, as each probe <b>fires</b>, DTrace gathers the data
from your probes and reports it back to you. If you don't specify
any actions for a probe, DTrace will just take note of each time
the probe fires.</p><p>Every probe in DTrace has two names: a unique integer ID and
a human-readable string name. We're going to start learning DTrace by building some
very simple requests using the probe named <tt>BEGIN</tt>, which fires once each time you
start a new tracing request. You can use the <a href="http://docs.sun.com/doc/819-2240/dtrace-1m?a=view"><tt>dtrace</tt>(1M)</a> utility's <tt>-n</tt>
option to enable a probe using its string name. Type the following command:</p><pre><tt><b># dtrace -n BEGIN</b></tt></pre><p>After a brief pause, you will see DTrace tell you that one
probe was enabled and you will see a line of output indicating that
the <tt>BEGIN</tt> probe fired. Once you see this output, <tt>dtrace</tt> remains paused waiting for
other probes to fire. Since you haven't enabled any other probes and <tt>BEGIN</tt>
only fires once, press Control-C in your shell to exit <tt>dtrace</tt> and return
to your shell prompt:</p><pre><tt><b># dtrace -n BEGIN</b></tt>
dtrace: description 'BEGIN' matched 1 probe
CPU     ID              FUNCTION:NAME
  0      1                  :BEGIN
<tt><b>^C</b></tt>
#</pre><p>The output tells you that the probe named <tt>BEGIN</tt> fired once and both
its name and integer ID, 1, are printed. Notice that by default, the
integer name of the CPU on which this probe fired is displayed.
In this example, the CPU column indicates that the <tt>dtrace</tt> command was executing on
CPU 0 when the probe fired.</p><p>You can construct DTrace requests using arbitrary numbers of probes and actions. Let's
create a simple request using two probes by adding the <tt>END</tt> probe
to the previous example command. The <tt>END</tt> probe fires once when tracing is
completed. Type the following command, and then again press Control-C in your shell
after you see the line of output for the <tt>BEGIN</tt> probe:</p><pre><tt><b># dtrace -n BEGIN -n END</b></tt>
dtrace: description 'BEGIN' matched 1 probe
dtrace: description 'END' matched 1 probe
CPU     ID              FUNCTION:NAME
  0      1                  :BEGIN
<tt><b>^C</b></tt>
  0      2                    :END
#</pre><p>As you can see, pressing Control-C to exit <tt>dtrace</tt> triggers the <tt>END</tt> probe.
<tt>dtrace</tt> reports this probe firing before exiting.</p><p>Now that you understand a little bit about naming and enabling probes, you're
ready to write the DTrace version of everyone's first program, &ldquo;Hello, World.&rdquo; In
addition to constructing DTrace experiments on the command line, you can also write
them in text files using the D programming language. In a text editor,
create a new file called <tt>hello.d</tt> and type in your first D program:</p><a name="ex-hello.d"></a><h6>Example&nbsp;1-1 <tt>hello.d</tt>: Hello, World from the D Programming Language</h6><pre>BEGIN
{
    trace("hello, world");
    exit(0);
}</pre><p>After you have saved your program, you can run it using the
<tt>dtrace</tt> <tt>-s</tt> option. Type the following command:</p><pre><tt><b># dtrace -s hello.d</b></tt>
dtrace: script 'hello.d' matched 1 probe
CPU     ID              FUNCTION:NAME
  0        1                  :BEGIN   hello, world
#</pre><p>As you can see, <tt>dtrace</tt> printed the same output as before followed by
the text &ldquo;<tt>hello, world</tt>&rdquo;. Unlike the previous example, you did not have to wait
and press Control-C, either. These changes were the result of the <b>actions</b> you specified
for your <tt>BEGIN</tt> probe in <tt>hello.d</tt>. Let's explore the structure of your D
program in more detail in order to understand what happened.</p><p>Each D program consists of a series of <b>clauses</b>, each clause describing one
or more probes to enable, and an optional set of actions to perform
when the probe fires. The actions are listed as a series of statements
enclosed in braces <tt>{ }</tt> following the probe name. Each statement ends with a
semicolon (<tt>;</tt>). Your first statement uses the function <tt>trace()</tt> to indicate that DTrace should
record the specified argument, the string &ldquo;<tt>hello, world</tt>&rdquo;, when the <tt>BEGIN</tt> probe fires, and
then print it out. The second statement uses the function <tt>exit()</tt> to indicate
that DTrace should cease tracing and exit the <tt>dtrace</tt> command. DTrace provides a set
of useful functions like <tt>trace()</tt> and <tt>exit()</tt> for you to call in
your D programs. To call a function, you specify its name followed by
a parenthesized list of arguments. The complete set of D functions is described
in <a href="chp-actsub.html">Chapter&nbsp;10, Actions and Subroutines</a>.</p><p>By now, if you're familiar with the C programming language, you've probably realized
from the name and our examples that DTrace's D programming language is very
similar to C. Indeed, D is derived from a large subset of
C combined with a special set of functions and variables to help make
tracing easy. You'll learn more about these features in subsequent chapters. If you've
written a C program before, you will be able to immediately transfer most
of your knowledge to building tracing programs in D. If you've never written
a C program before, learning D is still very easy. You will understand
all of the syntax by the end of this chapter. But first, let's
take a step back from language rules and learn more about how DTrace
works, and then we'll return to learning how to build more interesting D
programs.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="chp-intro.html">Previous</a>
             </td>
             <td align="right">
                 <a href="chp-intro-2.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

