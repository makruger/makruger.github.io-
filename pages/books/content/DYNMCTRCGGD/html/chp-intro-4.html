<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Variables and Arithmetic Expressions - Solaris Dynamic Tracing Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-11-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">Solaris Dynamic Tracing Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="chp-intro-3.html">Previous</a>
             </td>
             <td align="right">
                 <a href="chp-intro-5.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="chp-intro.html">1.&nbsp;&nbsp;Introduction</a></p>
<p class="toc level2"><a href="chp-intro-1.html">Getting Started</a></p>
<p class="toc level2"><a href="chp-intro-2.html">Providers and Probes</a></p>
<p class="toc level2"><a href="chp-intro-3.html">Compilation and Instrumentation</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Variables and Arithmetic Expressions</a></p>
</div>
<p class="toc level2"><a href="chp-intro-5.html">Predicates</a></p>
<p class="toc level2"><a href="chp-intro-6.html">Output Formatting</a></p>
<p class="toc level2"><a href="chp-intro-7.html">Arrays</a></p>
<p class="toc level2"><a href="chp-intro-8.html">External Symbols and Types</a></p>
<p class="toc level1 tocsp"><a href="chp-typeopexpr.html">2.&nbsp;&nbsp;Types, Operators, and Expressions</a></p>
<p class="toc level1 tocsp"><a href="chp-variables.html">3.&nbsp;&nbsp;Variables</a></p>
<p class="toc level1 tocsp"><a href="chp-prog.html">4.&nbsp;&nbsp;D Program Structure</a></p>
<p class="toc level1 tocsp"><a href="chp-pointers.html">5.&nbsp;&nbsp;Pointers and Arrays</a></p>
<p class="toc level1 tocsp"><a href="chp-strings.html">6.&nbsp;&nbsp;Strings</a></p>
<p class="toc level1 tocsp"><a href="chp-structs.html">7.&nbsp;&nbsp;Structs and Unions</a></p>
<p class="toc level1 tocsp"><a href="chp-types.html">8.&nbsp;&nbsp;Type and Constant Definitions</a></p>
<p class="toc level1 tocsp"><a href="chp-aggs.html">9.&nbsp;&nbsp;Aggregations</a></p>
<p class="toc level1 tocsp"><a href="chp-actsub.html">10.&nbsp;&nbsp;Actions and Subroutines</a></p>
<p class="toc level1 tocsp"><a href="chp-buf.html">11.&nbsp;&nbsp;Buffers and Buffering</a></p>
<p class="toc level1 tocsp"><a href="chp-fmt.html">12.&nbsp;&nbsp;Output Formatting</a></p>
<p class="toc level1 tocsp"><a href="chp-spec.html">13.&nbsp;&nbsp;Speculative Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-dtrace1m.html">14.&nbsp;&nbsp;<tt>dtrace</tt>(1M) Utility</a></p>
<p class="toc level1 tocsp"><a href="chp-script.html">15.&nbsp;&nbsp;Scripting</a></p>
<p class="toc level1 tocsp"><a href="chp-opt.html">16.&nbsp;&nbsp;Options and Tunables</a></p>
<p class="toc level1 tocsp"><a href="chp-dtrace.html">17.&nbsp;&nbsp;<tt>dtrace</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-lockstat.html">18.&nbsp;&nbsp;<tt>lockstat</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-profile.html">19.&nbsp;&nbsp;<tt>profile</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fbt.html">20.&nbsp;&nbsp;<tt>fbt</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-syscall.html">21.&nbsp;&nbsp;<tt>syscall</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sdt.html">22.&nbsp;&nbsp;<tt>sdt</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sysinfo.html">23.&nbsp;&nbsp;<tt>sysinfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-vminfo.html">24.&nbsp;&nbsp;<tt>vminfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-proc.html">25.&nbsp;&nbsp;<tt>proc</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sched.html">26.&nbsp;&nbsp;<tt>sched</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-io.html">27.&nbsp;&nbsp;<tt>io</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-mib.html">28.&nbsp;&nbsp;<tt>mib</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fpuinfo.html">29.&nbsp;&nbsp;<tt>fpuinfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-pid.html">30.&nbsp;&nbsp;<tt>pid</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-plockstat.html">31.&nbsp;&nbsp;<tt>plockstat</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fasttrap.html">32.&nbsp;&nbsp;<tt>fasttrap</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-user.html">33.&nbsp;&nbsp;User Process Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-usdt.html">34.&nbsp;&nbsp;Statically Defined Tracing for User Applications</a></p>
<p class="toc level1 tocsp"><a href="chp-sec.html">35.&nbsp;&nbsp;Security</a></p>
<p class="toc level1 tocsp"><a href="chp-anon.html">36.&nbsp;&nbsp;Anonymous Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-post.html">37.&nbsp;&nbsp;Postmortem Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-perf.html">38.&nbsp;&nbsp;Performance Considerations</a></p>
<p class="toc level1 tocsp"><a href="chp-stab.html">39.&nbsp;&nbsp;Stability</a></p>
<p class="toc level1 tocsp"><a href="chp-xlate.html">40.&nbsp;&nbsp;Translators</a></p>
<p class="toc level1 tocsp"><a href="chp-vers.html">41.&nbsp;&nbsp;Versioning</a></p>
<p class="toc level1 tocsp"><a href="gloss01.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="chp-intro-4"></a><h3>Variables and Arithmetic Expressions</h3>
<p>Our next example program makes use of the DTrace <tt>profile</tt> provider to implement
a simple time-based counter. The profile provider is able to create new probes
based on the descriptions found in your D program. If you create a
probe named <tt>profile:::tick-</tt><i>n</i><tt>sec</tt> for some integer <i>n</i>, the profile provider will create a
probe that fires every <i>n</i> seconds. Type the following source code and save
it in a file named <tt>counter.d</tt>:</p><pre>/*
 * Count off and report the number of seconds elapsed
 */
dtrace:::BEGIN
{
    i = 0;
}

profile:::tick-1sec
{
    i = i + 1;
    trace(i);
}

dtrace:::END
{
    trace(i);
}</pre><p>When executed, the program counts off the number of elapsed seconds until you
press Control-C, and then prints the total at the end:</p><pre><tt><b># dtrace -s counter.d</b></tt>
dtrace: script 'counter.d' matched 3 probes
CPU     ID                    FUNCTION:NAME
  0  25499                       :tick-1sec         1
  0  25499                       :tick-1sec         2
  0  25499                       :tick-1sec         3
  0  25499                       :tick-1sec         4
  0  25499                       :tick-1sec         5
  0  25499                       :tick-1sec         6
<tt><b>^C</b></tt>
  0      2                             :END         6
#</pre><p>The first three lines of the program are a comment to explain
what the program does. Similar to C, C++, and the Java programming language,
the D compiler ignores any characters between the <tt>/*</tt> and <tt>*/</tt> symbols. Comments
can be used anywhere in a D program, including both inside and outside
your probe clauses.</p><p>The <tt>BEGIN</tt> probe clause defines a new variable named <tt>i</tt> and assigns
it the integer value zero using the statement:</p><pre>i = 0;</pre><p>Unlike C, C++, and the Java programming language, D variables can be created
by simply using them in a program statement; explicit variable declarations are not
required. When a variable is used for the first time in a
program, the type of the variable is set based on the type of
its first assignment. Each variable has only one type over the lifetime of
the program, so subsequent references must conform to the same type as the
initial assignment. In <tt>counter.d</tt>, the variable <tt>i</tt> is first assigned the integer constant
zero, so its type is set to <tt>int</tt>. D provides the same basic
integer data types as C, including:</p><table><col width="50%"><col width="50%"><tr><td align="left" valign="top" scope="row"><p><tt>char</tt></p></td>
<td align="left" valign="top" scope="row"><p>Character or single byte integer</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>int</tt></p></td>
<td align="left" valign="top" scope="row"><p>Default integer</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>short</tt></p></td>
<td align="left" valign="top" scope="row"><p>Short integer</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>long</tt></p></td>
<td align="left" valign="top" scope="row"><p>Long
integer</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>long long</tt></p></td>
<td align="left" valign="top" scope="row"><p>Extended long integer</p></td>
</tr>
</table><p>The sizes of these types are dependent on the operating system kernel's data
model, described in <a href="chp-typeopexpr.html">Chapter&nbsp;2, Types, Operators, and Expressions</a>. D also provides built-in friendly names for signed and
unsigned integer types of various fixed sizes, as well as thousands of other
types that are defined by the operating system.</p><p>The central part of <tt>counter.d</tt> is the probe clause that increments the counter
<tt>i</tt>:</p><pre>profile:::tick-1sec
{
    i = i + 1;
    trace(i);
}</pre><p>This clause names the probe <tt>profile:::tick-1sec</tt>, which tells the <tt>profile</tt> provider to create
a new probe which fires once per second on an available processor. The
clause contains two statements, the first assigning <tt>i</tt> to the previous value plus one,
and the second tracing the new value of <tt>i</tt>. All the usual C
arithmetic operators are available in D; the complete list is found in <a href="chp-typeopexpr.html">Chapter&nbsp;2, Types, Operators, and Expressions</a>.
Also as in C, the <tt>++</tt> operator can be used as shorthand for
incrementing the corresponding variable by one. The <tt>trace()</tt> function takes any D expression
as its argument, so you could write <tt>counter.d</tt> more concisely as follows:</p><pre>profile:::tick-1sec
{
    trace(++i);
}</pre><p>If you want to explicitly control the type of the variable <tt>i</tt>, you
can surround the desired type in parentheses when you assign it in
order to <b>cast</b> the integer zero to a specific type. For example, if you
wanted to determine the maximum size of a <tt>char</tt> in D, you could
change the <tt>BEGIN</tt> clause as follows:</p><pre>dtrace:::BEGIN
{
    i = (char)0;
}</pre><p>After running <tt>counter.d</tt> for a while, you should see the traced value grow
and then wrap around back to zero. If you grow impatient waiting for
the value to wrap, try changing the <tt>profile</tt> probe name to <tt>profile:::tick-100msec</tt> to
make a counter that increments once every 100 milliseconds, or 10 times per
second.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="chp-intro-3.html">Previous</a>
             </td>
             <td align="right">
                 <a href="chp-intro-5.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

