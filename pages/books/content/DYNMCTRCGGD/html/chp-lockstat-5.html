<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Spin Lock Probes - Solaris Dynamic Tracing Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-11-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">Solaris Dynamic Tracing Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="chp-lockstat-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="chp-lockstat-7.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="chp-intro.html">1.&nbsp;&nbsp;Introduction</a></p>
<p class="toc level1 tocsp"><a href="chp-typeopexpr.html">2.&nbsp;&nbsp;Types, Operators, and Expressions</a></p>
<p class="toc level1 tocsp"><a href="chp-variables.html">3.&nbsp;&nbsp;Variables</a></p>
<p class="toc level1 tocsp"><a href="chp-prog.html">4.&nbsp;&nbsp;D Program Structure</a></p>
<p class="toc level1 tocsp"><a href="chp-pointers.html">5.&nbsp;&nbsp;Pointers and Arrays</a></p>
<p class="toc level1 tocsp"><a href="chp-strings.html">6.&nbsp;&nbsp;Strings</a></p>
<p class="toc level1 tocsp"><a href="chp-structs.html">7.&nbsp;&nbsp;Structs and Unions</a></p>
<p class="toc level1 tocsp"><a href="chp-types.html">8.&nbsp;&nbsp;Type and Constant Definitions</a></p>
<p class="toc level1 tocsp"><a href="chp-aggs.html">9.&nbsp;&nbsp;Aggregations</a></p>
<p class="toc level1 tocsp"><a href="chp-actsub.html">10.&nbsp;&nbsp;Actions and Subroutines</a></p>
<p class="toc level1 tocsp"><a href="chp-buf.html">11.&nbsp;&nbsp;Buffers and Buffering</a></p>
<p class="toc level1 tocsp"><a href="chp-fmt.html">12.&nbsp;&nbsp;Output Formatting</a></p>
<p class="toc level1 tocsp"><a href="chp-spec.html">13.&nbsp;&nbsp;Speculative Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-dtrace1m.html">14.&nbsp;&nbsp;<tt>dtrace</tt>(1M) Utility</a></p>
<p class="toc level1 tocsp"><a href="chp-script.html">15.&nbsp;&nbsp;Scripting</a></p>
<p class="toc level1 tocsp"><a href="chp-opt.html">16.&nbsp;&nbsp;Options and Tunables</a></p>
<p class="toc level1 tocsp"><a href="chp-dtrace.html">17.&nbsp;&nbsp;<tt>dtrace</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-lockstat.html">18.&nbsp;&nbsp;<tt>lockstat</tt> Provider</a></p>
<p class="toc level2"><a href="chp-lockstat-1.html">Overview</a></p>
<p class="toc level2"><a href="chp-lockstat-2.html">Adaptive Lock Probes</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Spin Lock Probes</a></p>
</div>
<p class="toc level2"><a href="chp-lockstat-7.html">Thread Locks</a></p>
<p class="toc level2"><a href="chp-lockstat-9.html">Readers/Writer Lock Probes</a></p>
<p class="toc level2"><a href="chp-lockstat-stability.html">Stability</a></p>
<p class="toc level1 tocsp"><a href="chp-profile.html">19.&nbsp;&nbsp;<tt>profile</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fbt.html">20.&nbsp;&nbsp;<tt>fbt</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-syscall.html">21.&nbsp;&nbsp;<tt>syscall</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sdt.html">22.&nbsp;&nbsp;<tt>sdt</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sysinfo.html">23.&nbsp;&nbsp;<tt>sysinfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-vminfo.html">24.&nbsp;&nbsp;<tt>vminfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-proc.html">25.&nbsp;&nbsp;<tt>proc</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sched.html">26.&nbsp;&nbsp;<tt>sched</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-io.html">27.&nbsp;&nbsp;<tt>io</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-mib.html">28.&nbsp;&nbsp;<tt>mib</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fpuinfo.html">29.&nbsp;&nbsp;<tt>fpuinfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-pid.html">30.&nbsp;&nbsp;<tt>pid</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-plockstat.html">31.&nbsp;&nbsp;<tt>plockstat</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fasttrap.html">32.&nbsp;&nbsp;<tt>fasttrap</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-user.html">33.&nbsp;&nbsp;User Process Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-usdt.html">34.&nbsp;&nbsp;Statically Defined Tracing for User Applications</a></p>
<p class="toc level1 tocsp"><a href="chp-sec.html">35.&nbsp;&nbsp;Security</a></p>
<p class="toc level1 tocsp"><a href="chp-anon.html">36.&nbsp;&nbsp;Anonymous Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-post.html">37.&nbsp;&nbsp;Postmortem Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-perf.html">38.&nbsp;&nbsp;Performance Considerations</a></p>
<p class="toc level1 tocsp"><a href="chp-stab.html">39.&nbsp;&nbsp;Stability</a></p>
<p class="toc level1 tocsp"><a href="chp-xlate.html">40.&nbsp;&nbsp;Translators</a></p>
<p class="toc level1 tocsp"><a href="chp-vers.html">41.&nbsp;&nbsp;Versioning</a></p>
<p class="toc level1 tocsp"><a href="gloss01.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="chp-lockstat-5"></a><h3>Spin Lock Probes</h3>
<p><a name="indexterm-306"></a><a name="indexterm-307"></a>Threads cannot block in some contexts in the kernel, such as high-level interrupt context
and any context manipulating dispatcher state. In these contexts, this restriction prevents the
use of adaptive locks. <b>Spin locks</b> are instead used to effect mutual exclusion to
critical sections in these contexts. As the name implies, the behavior of these
locks in the presence of contention is to spin until the lock is
released by the owning thread. The three probes pertaining to spin locks are
in <a href="#tbl-spin">Table&nbsp;18-2</a>.</p><a name="tbl-spin"></a><h6>Table&nbsp;18-2 Spin Lock Probes</h6><table><col width="20%"><col width="80%"><tr><td align="left" valign="top" scope="row"><p><tt>spin-acquire</tt></p></td>
<td align="left" valign="top" scope="row"><p>Hold-event probe that fires immediately after a spin lock is acquired.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>spin-spin</tt></p></td>
<td align="left" valign="top" scope="row"><p>Contention-event
probe that fires after a thread that has spun on a held spin
lock has successfully acquired the spin lock. If both are enabled, <tt>spin-spin</tt>
fires <b>before</b> <tt>spin-acquire</tt>. <tt>arg1</tt> for <tt>spin-spin</tt> contains the <b>spin time</b>: the number of
nanoseconds that were spent in the spin state before the lock was acquired.
The spin count has little meaning on its own, but can be used
to compare spin times.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>spin-release</tt></p></td>
<td align="left" valign="top" scope="row"><p>Hold-event probe that fires immediately after a spin lock
is released.</p></td>
</tr>
</table><p>Adaptive locks are much more common than spin locks. The following script displays
totals for both lock types to provide data to support this observation.</p><pre>lockstat:::adaptive-acquire
/execname == "date"/
{
    @locks["adaptive"] = count();
}

lockstat:::spin-acquire
/execname == "date"/
{
    @locks["spin"] = count();
}</pre><p>Run this script in one window, and a <a href="http://docs.sun.com/doc/819-2239/date-1?a=view"><tt>date</tt>(1)</a> command in another.
When you terminate the DTrace script, you will see output similar to the
following example:</p><pre><tt><b># dtrace -s ./whatlock.d</b></tt>
dtrace: script './whatlock.d' matched 5 probes 
<tt><b>^C</b></tt>
spin                                                             26
adaptive                                                       2981</pre><p>As this output indicates, over 99 percent of the locks acquired in
running the <tt>date</tt> command are adaptive locks. It may be surprising that <b>so</b> many
locks are acquired in doing something as simple as a <tt>date</tt>. The large
number of locks is a natural artifact of the fine-grained locking required of
an extremely scalable system like the Solaris kernel.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="chp-lockstat-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="chp-lockstat-7.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

