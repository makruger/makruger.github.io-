<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Associative Arrays - Solaris Dynamic Tracing Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-11-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">Solaris Dynamic Tracing Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="chp-variables-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="chp-variables-3.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="chp-intro.html">1.&nbsp;&nbsp;Introduction</a></p>
<p class="toc level1 tocsp"><a href="chp-typeopexpr.html">2.&nbsp;&nbsp;Types, Operators, and Expressions</a></p>
<p class="toc level1 tocsp"><a href="chp-variables.html">3.&nbsp;&nbsp;Variables</a></p>
<p class="toc level2"><a href="chp-variables-1.html">Scalar Variables</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Associative Arrays</a></p>
</div>
<p class="toc level2"><a href="chp-variables-3.html">Thread-Local Variables</a></p>
<p class="toc level2"><a href="chp-variables-4.html">Clause-Local Variables</a></p>
<p class="toc level2"><a href="chp-variables-5.html">Built-in Variables</a></p>
<p class="toc level2"><a href="chp-variables-6.html">External Variables</a></p>
<p class="toc level1 tocsp"><a href="chp-prog.html">4.&nbsp;&nbsp;D Program Structure</a></p>
<p class="toc level1 tocsp"><a href="chp-pointers.html">5.&nbsp;&nbsp;Pointers and Arrays</a></p>
<p class="toc level1 tocsp"><a href="chp-strings.html">6.&nbsp;&nbsp;Strings</a></p>
<p class="toc level1 tocsp"><a href="chp-structs.html">7.&nbsp;&nbsp;Structs and Unions</a></p>
<p class="toc level1 tocsp"><a href="chp-types.html">8.&nbsp;&nbsp;Type and Constant Definitions</a></p>
<p class="toc level1 tocsp"><a href="chp-aggs.html">9.&nbsp;&nbsp;Aggregations</a></p>
<p class="toc level1 tocsp"><a href="chp-actsub.html">10.&nbsp;&nbsp;Actions and Subroutines</a></p>
<p class="toc level1 tocsp"><a href="chp-buf.html">11.&nbsp;&nbsp;Buffers and Buffering</a></p>
<p class="toc level1 tocsp"><a href="chp-fmt.html">12.&nbsp;&nbsp;Output Formatting</a></p>
<p class="toc level1 tocsp"><a href="chp-spec.html">13.&nbsp;&nbsp;Speculative Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-dtrace1m.html">14.&nbsp;&nbsp;<tt>dtrace</tt>(1M) Utility</a></p>
<p class="toc level1 tocsp"><a href="chp-script.html">15.&nbsp;&nbsp;Scripting</a></p>
<p class="toc level1 tocsp"><a href="chp-opt.html">16.&nbsp;&nbsp;Options and Tunables</a></p>
<p class="toc level1 tocsp"><a href="chp-dtrace.html">17.&nbsp;&nbsp;<tt>dtrace</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-lockstat.html">18.&nbsp;&nbsp;<tt>lockstat</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-profile.html">19.&nbsp;&nbsp;<tt>profile</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fbt.html">20.&nbsp;&nbsp;<tt>fbt</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-syscall.html">21.&nbsp;&nbsp;<tt>syscall</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sdt.html">22.&nbsp;&nbsp;<tt>sdt</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sysinfo.html">23.&nbsp;&nbsp;<tt>sysinfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-vminfo.html">24.&nbsp;&nbsp;<tt>vminfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-proc.html">25.&nbsp;&nbsp;<tt>proc</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sched.html">26.&nbsp;&nbsp;<tt>sched</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-io.html">27.&nbsp;&nbsp;<tt>io</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-mib.html">28.&nbsp;&nbsp;<tt>mib</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fpuinfo.html">29.&nbsp;&nbsp;<tt>fpuinfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-pid.html">30.&nbsp;&nbsp;<tt>pid</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-plockstat.html">31.&nbsp;&nbsp;<tt>plockstat</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fasttrap.html">32.&nbsp;&nbsp;<tt>fasttrap</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-user.html">33.&nbsp;&nbsp;User Process Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-usdt.html">34.&nbsp;&nbsp;Statically Defined Tracing for User Applications</a></p>
<p class="toc level1 tocsp"><a href="chp-sec.html">35.&nbsp;&nbsp;Security</a></p>
<p class="toc level1 tocsp"><a href="chp-anon.html">36.&nbsp;&nbsp;Anonymous Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-post.html">37.&nbsp;&nbsp;Postmortem Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-perf.html">38.&nbsp;&nbsp;Performance Considerations</a></p>
<p class="toc level1 tocsp"><a href="chp-stab.html">39.&nbsp;&nbsp;Stability</a></p>
<p class="toc level1 tocsp"><a href="chp-xlate.html">40.&nbsp;&nbsp;Translators</a></p>
<p class="toc level1 tocsp"><a href="chp-vers.html">41.&nbsp;&nbsp;Versioning</a></p>
<p class="toc level1 tocsp"><a href="gloss01.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="chp-variables-2"></a><h3>Associative Arrays</h3>
<p><a name="indexterm-7"></a><a name="indexterm-8"></a><a name="indexterm-9"></a>Associative arrays are used to represent collections of data elements that can be
retrieved by specifying a name called a <b>key</b>. D associative array keys are
formed by a list of scalar expression values called a <b>tuple</b>. You can
think of the array tuple itself as an imaginary parameter list to a
function that is called to retrieve the corresponding array value when you reference
the array. Each D associative array has a fixed <b>key signature</b> consisting of a
fixed number of tuple elements where each element has a given, fixed type.
You can define different key signatures for each array in your D program.</p><p><a name="indexterm-10"></a><a name="indexterm-11"></a>Associative arrays differ from normal, fixed-size arrays in that they have no predefined
limit on the number of elements, the elements can be indexed by any
tuple as opposed to just using integers as keys, and the elements are
not stored in preallocated consecutive storage locations. Associative arrays are useful in situations where
you would use a hash table or other simple dictionary data structure in
a C, C++, or Java<sup>TM</sup> language program. Associative arrays give you the ability
to create a dynamic history of events and state captured in your D
program that you can use to create more complex control flows.</p><p><a name="indexterm-12"></a>To define an associative array, you write an assignment expression of the form:</p><p><i>name</i> <tt>[</tt> <i>key</i> <tt>] =</tt> <i>expression</i> <tt>;</tt></p><p>where <i>name</i> is any valid D identifier and <i>key</i> is a comma-separated
list of one or more expressions. For example, the following statement defines an
associative array <tt>a</tt> with key signature <tt>[ int, string ]</tt> and stores the integer value 456 in
a location named by the tuple <tt>[ 123, "hello" ]</tt>:</p><pre>a[123, "hello"] = 456;</pre><p><a name="indexterm-13"></a>The type of each object contained in the array is also fixed
for all elements in a given array. Because <tt>a</tt> was first assigned using the
integer 456, every subsequent value stored in the array will also be of
type <tt>int</tt>. You can use any of the assignment operators defined in Chapter
2 to modify associative array elements, subject to the operand rules defined for
each operator. The D compiler will produce an appropriate error message if you
attempt an incompatible assignment. You can use any type with an associative array
key or value that you can use with a scalar variable. You cannot
nest an associative array within another associative array as a key or value.</p><p><a name="indexterm-14"></a>You can reference an associative array using any tuple that is compatible with
the array key signature. The rules for tuple compatibility are similar to those
for function calls and variable assignments: the tuple must be of the same
length and each type in the list of actual parameters must be compatible
with the corresponding type in the formal key signature. For example, if an
associative array <tt>x</tt> is defined as follows:</p><pre>x[123ull] = 0;</pre><p>then the key signature is of type <tt>unsigned long long</tt> and the values are of
type <tt>int</tt>. This array can also be referenced using the expression <tt>x['a']</tt> because
the tuple consisting of the character constant <tt>'a'</tt> of type <tt>int</tt> and length one
is compatible with the key signature <tt>unsigned long long</tt> according to the arithmetic conversion rules
described in <a href="chp-typeopexpr-11.html">Type Conversions</a>.</p><p><a name="indexterm-15"></a><a name="indexterm-16"></a>If you need to explicitly declare a D associative array before using it,
you can create a declaration of the array name and key signature outside
of the probe clauses in your program source code:</p><pre>int x[unsigned long long, char];

BEGIN
{
    x[123ull, 'a'] = 456;
}</pre><p><a name="indexterm-17"></a><a name="indexterm-18"></a><a name="indexterm-19"></a>Once an associative array is defined, references to any tuple of a compatible
key signature are permitted, even if the tuple in question has not been
previously assigned. Accessing an unassigned associative array element is defined to return a
zero-filled object. A consequence of this definition is that underlying storage is not allocated
for an associative array element until a non-zero value is assigned to that
element. Conversely, assigning an associative array element to zero causes DTrace to deallocate
the underlying storage. This behavior is important because the dynamic variable space out
of which associative array elements are allocated is finite; if it is exhausted
when an allocation is attempted, the allocation will fail and an error message
will be generated indicating a dynamic variable drop. Always assign zero to associative
array elements that are no longer in use. See <a href="chp-opt.html">Chapter&nbsp;16, Options and Tunables</a> for other techniques
to eliminate dynamic variable drops. </p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="chp-variables-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="chp-variables-3.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

