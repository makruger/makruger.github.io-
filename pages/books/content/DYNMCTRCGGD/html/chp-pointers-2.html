<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Pointer Safety - Solaris Dynamic Tracing Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-11-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">Solaris Dynamic Tracing Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="chp-pointers-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="chp-pointers-3.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="chp-intro.html">1.&nbsp;&nbsp;Introduction</a></p>
<p class="toc level1 tocsp"><a href="chp-typeopexpr.html">2.&nbsp;&nbsp;Types, Operators, and Expressions</a></p>
<p class="toc level1 tocsp"><a href="chp-variables.html">3.&nbsp;&nbsp;Variables</a></p>
<p class="toc level1 tocsp"><a href="chp-prog.html">4.&nbsp;&nbsp;D Program Structure</a></p>
<p class="toc level1 tocsp"><a href="chp-pointers.html">5.&nbsp;&nbsp;Pointers and Arrays</a></p>
<p class="toc level2"><a href="chp-pointers-1.html">Pointers and Addresses</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Pointer Safety</a></p>
</div>
<p class="toc level2"><a href="chp-pointers-3.html">Array Declarations and Storage</a></p>
<p class="toc level2"><a href="chp-pointers-4.html">Pointer and Array Relationship</a></p>
<p class="toc level2"><a href="chp-pointers-5.html">Pointer Arithmetic</a></p>
<p class="toc level2"><a href="chp-pointers-6.html">Generic Pointers</a></p>
<p class="toc level2"><a href="chp-pointers-7.html">Multi-Dimensional Arrays</a></p>
<p class="toc level2"><a href="chp-pointers-8.html">Pointers to DTrace Objects</a></p>
<p class="toc level2"><a href="chp-pointers-9.html">Pointers and Address Spaces</a></p>
<p class="toc level1 tocsp"><a href="chp-strings.html">6.&nbsp;&nbsp;Strings</a></p>
<p class="toc level1 tocsp"><a href="chp-structs.html">7.&nbsp;&nbsp;Structs and Unions</a></p>
<p class="toc level1 tocsp"><a href="chp-types.html">8.&nbsp;&nbsp;Type and Constant Definitions</a></p>
<p class="toc level1 tocsp"><a href="chp-aggs.html">9.&nbsp;&nbsp;Aggregations</a></p>
<p class="toc level1 tocsp"><a href="chp-actsub.html">10.&nbsp;&nbsp;Actions and Subroutines</a></p>
<p class="toc level1 tocsp"><a href="chp-buf.html">11.&nbsp;&nbsp;Buffers and Buffering</a></p>
<p class="toc level1 tocsp"><a href="chp-fmt.html">12.&nbsp;&nbsp;Output Formatting</a></p>
<p class="toc level1 tocsp"><a href="chp-spec.html">13.&nbsp;&nbsp;Speculative Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-dtrace1m.html">14.&nbsp;&nbsp;<tt>dtrace</tt>(1M) Utility</a></p>
<p class="toc level1 tocsp"><a href="chp-script.html">15.&nbsp;&nbsp;Scripting</a></p>
<p class="toc level1 tocsp"><a href="chp-opt.html">16.&nbsp;&nbsp;Options and Tunables</a></p>
<p class="toc level1 tocsp"><a href="chp-dtrace.html">17.&nbsp;&nbsp;<tt>dtrace</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-lockstat.html">18.&nbsp;&nbsp;<tt>lockstat</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-profile.html">19.&nbsp;&nbsp;<tt>profile</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fbt.html">20.&nbsp;&nbsp;<tt>fbt</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-syscall.html">21.&nbsp;&nbsp;<tt>syscall</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sdt.html">22.&nbsp;&nbsp;<tt>sdt</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sysinfo.html">23.&nbsp;&nbsp;<tt>sysinfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-vminfo.html">24.&nbsp;&nbsp;<tt>vminfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-proc.html">25.&nbsp;&nbsp;<tt>proc</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sched.html">26.&nbsp;&nbsp;<tt>sched</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-io.html">27.&nbsp;&nbsp;<tt>io</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-mib.html">28.&nbsp;&nbsp;<tt>mib</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fpuinfo.html">29.&nbsp;&nbsp;<tt>fpuinfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-pid.html">30.&nbsp;&nbsp;<tt>pid</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-plockstat.html">31.&nbsp;&nbsp;<tt>plockstat</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fasttrap.html">32.&nbsp;&nbsp;<tt>fasttrap</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-user.html">33.&nbsp;&nbsp;User Process Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-usdt.html">34.&nbsp;&nbsp;Statically Defined Tracing for User Applications</a></p>
<p class="toc level1 tocsp"><a href="chp-sec.html">35.&nbsp;&nbsp;Security</a></p>
<p class="toc level1 tocsp"><a href="chp-anon.html">36.&nbsp;&nbsp;Anonymous Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-post.html">37.&nbsp;&nbsp;Postmortem Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-perf.html">38.&nbsp;&nbsp;Performance Considerations</a></p>
<p class="toc level1 tocsp"><a href="chp-stab.html">39.&nbsp;&nbsp;Stability</a></p>
<p class="toc level1 tocsp"><a href="chp-xlate.html">40.&nbsp;&nbsp;Translators</a></p>
<p class="toc level1 tocsp"><a href="chp-vers.html">41.&nbsp;&nbsp;Versioning</a></p>
<p class="toc level1 tocsp"><a href="gloss01.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="chp-pointers-2"></a><h3>Pointer Safety</h3>
<p><a name="indexterm-98"></a>If you are a C or C++ programmer, you may be a
bit frightened after reading the previous section because you know that misuse
of pointers in your programs can cause your programs to crash. DTrace
is a robust, safe environment for executing your D programs where these
mistakes cannot cause program crashes. You may indeed write a buggy D
program, but invalid D pointer accesses will not cause DTrace or the
operating system kernel to fail or crash in any way. Instead, the
DTrace software will detect any invalid pointer accesses, disable your instrumentation, and
report the problem back to you for debugging.</p><p>If you have programmed in the Java programming language, you probably know
that the Java language does not support pointers for precisely the same
reasons of safety. Pointers are needed in D because they are an
intrinsic part of the operating system's implementation in C, but DTrace implements
the same kind of safety mechanisms found in the Java programming language
that prevent buggy programs from damaging themselves or each other. DTrace's error
reporting is similar to the run-time environment for the Java programming language
that detects a programming error and reports an exception back to you.</p><p>To see DTrace's error handling and reporting, write a deliberately bad D
program using pointers. In an editor, type the following D program and
save it in a file named <tt>badptr.d</tt>:</p><a name="ex-badptr.d"></a><h6>Example&nbsp;5-1 <tt>badptr.d</tt>: Demonstration of DTrace Error Handling</h6><pre>BEGIN
{
    x = (int *)NULL;
    y = *x;
    trace(y);
}</pre><p>The <tt>badptr.d</tt> program creates a D pointer named <tt>x</tt> that is a
pointer to <tt>int</tt>. The program assigns this pointer the special invalid pointer
value <tt>NULL</tt>, which is a built-in alias for address 0. By convention,
address 0 is always defined to be invalid so that <tt>NULL</tt> can
be used as a sentinel value in C and D programs. The
program uses a cast expression to convert <tt>NULL</tt> to be a pointer
to an integer. The program then dereferences the pointer using the expression
<tt>*x</tt>, and assigns the result to another variable <tt>y</tt>, and then attempts
to trace <tt>y</tt>. When the D program is executed, DTrace detects an
invalid pointer access when the statement <tt>y = *x</tt> is executed and reports the
error:</p><pre><tt><b># dtrace -s badptr.d</b></tt>
dtrace: script '/dev/stdin' matched 1 probe
CPU     ID                    FUNCTION:NAME
dtrace: error on enabled probe ID 1 (ID 1: dtrace:::BEGIN): invalid address
(0x0) in action #2 at DIF offset 4
dtrace: 1 error on CPU 0
<tt><b>^C</b></tt>
#</pre><p>The other problem that can arise from programs that use invalid pointers
is an <b>alignment error</b>. By architectural convention, fundamental data objects such as integers
are aligned in memory according to their size. For example, 2-byte integers
are aligned on addresses that are multiples of 2, 4-byte integers on
multiples of 4, and so on. If you dereference a pointer to
a 4-byte integer and your pointer address is an invalid value that
is not a multiple of 4, your access will fail with an
alignment error. Alignment errors in D almost always indicate that your pointer
has an invalid or corrupt value due to a bug in your
D program. You can create an example alignment error by changing the
source code of <tt>badptr.d</tt> to use the address <tt>(int *)2</tt> instead of <tt>NULL</tt>.
Because <tt>int</tt> is 4 bytes and 2 is not a multiple of
4, the expression <tt>*x</tt> results in a DTrace alignment error.</p><p>For details about the DTrace error mechanism, see <a href="chp-dtrace-error.html"><tt>ERROR</tt> Probe</a>.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="chp-pointers-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="chp-pointers-3.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

