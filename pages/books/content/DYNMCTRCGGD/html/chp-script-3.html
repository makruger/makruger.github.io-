<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Macro Arguments - Solaris Dynamic Tracing Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-11-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">Solaris Dynamic Tracing Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="chp-script-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="chp-script-4.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="chp-intro.html">1.&nbsp;&nbsp;Introduction</a></p>
<p class="toc level1 tocsp"><a href="chp-typeopexpr.html">2.&nbsp;&nbsp;Types, Operators, and Expressions</a></p>
<p class="toc level1 tocsp"><a href="chp-variables.html">3.&nbsp;&nbsp;Variables</a></p>
<p class="toc level1 tocsp"><a href="chp-prog.html">4.&nbsp;&nbsp;D Program Structure</a></p>
<p class="toc level1 tocsp"><a href="chp-pointers.html">5.&nbsp;&nbsp;Pointers and Arrays</a></p>
<p class="toc level1 tocsp"><a href="chp-strings.html">6.&nbsp;&nbsp;Strings</a></p>
<p class="toc level1 tocsp"><a href="chp-structs.html">7.&nbsp;&nbsp;Structs and Unions</a></p>
<p class="toc level1 tocsp"><a href="chp-types.html">8.&nbsp;&nbsp;Type and Constant Definitions</a></p>
<p class="toc level1 tocsp"><a href="chp-aggs.html">9.&nbsp;&nbsp;Aggregations</a></p>
<p class="toc level1 tocsp"><a href="chp-actsub.html">10.&nbsp;&nbsp;Actions and Subroutines</a></p>
<p class="toc level1 tocsp"><a href="chp-buf.html">11.&nbsp;&nbsp;Buffers and Buffering</a></p>
<p class="toc level1 tocsp"><a href="chp-fmt.html">12.&nbsp;&nbsp;Output Formatting</a></p>
<p class="toc level1 tocsp"><a href="chp-spec.html">13.&nbsp;&nbsp;Speculative Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-dtrace1m.html">14.&nbsp;&nbsp;<tt>dtrace</tt>(1M) Utility</a></p>
<p class="toc level1 tocsp"><a href="chp-script.html">15.&nbsp;&nbsp;Scripting</a></p>
<p class="toc level2"><a href="chp-script-1.html">Interpreter Files</a></p>
<p class="toc level2"><a href="chp-script-2.html">Macro Variables</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Macro Arguments</a></p>
</div>
<p class="toc level2"><a href="chp-script-4.html">Target Process ID</a></p>
<p class="toc level1 tocsp"><a href="chp-opt.html">16.&nbsp;&nbsp;Options and Tunables</a></p>
<p class="toc level1 tocsp"><a href="chp-dtrace.html">17.&nbsp;&nbsp;<tt>dtrace</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-lockstat.html">18.&nbsp;&nbsp;<tt>lockstat</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-profile.html">19.&nbsp;&nbsp;<tt>profile</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fbt.html">20.&nbsp;&nbsp;<tt>fbt</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-syscall.html">21.&nbsp;&nbsp;<tt>syscall</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sdt.html">22.&nbsp;&nbsp;<tt>sdt</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sysinfo.html">23.&nbsp;&nbsp;<tt>sysinfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-vminfo.html">24.&nbsp;&nbsp;<tt>vminfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-proc.html">25.&nbsp;&nbsp;<tt>proc</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sched.html">26.&nbsp;&nbsp;<tt>sched</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-io.html">27.&nbsp;&nbsp;<tt>io</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-mib.html">28.&nbsp;&nbsp;<tt>mib</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fpuinfo.html">29.&nbsp;&nbsp;<tt>fpuinfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-pid.html">30.&nbsp;&nbsp;<tt>pid</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-plockstat.html">31.&nbsp;&nbsp;<tt>plockstat</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fasttrap.html">32.&nbsp;&nbsp;<tt>fasttrap</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-user.html">33.&nbsp;&nbsp;User Process Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-usdt.html">34.&nbsp;&nbsp;Statically Defined Tracing for User Applications</a></p>
<p class="toc level1 tocsp"><a href="chp-sec.html">35.&nbsp;&nbsp;Security</a></p>
<p class="toc level1 tocsp"><a href="chp-anon.html">36.&nbsp;&nbsp;Anonymous Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-post.html">37.&nbsp;&nbsp;Postmortem Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-perf.html">38.&nbsp;&nbsp;Performance Considerations</a></p>
<p class="toc level1 tocsp"><a href="chp-stab.html">39.&nbsp;&nbsp;Stability</a></p>
<p class="toc level1 tocsp"><a href="chp-xlate.html">40.&nbsp;&nbsp;Translators</a></p>
<p class="toc level1 tocsp"><a href="chp-vers.html">41.&nbsp;&nbsp;Versioning</a></p>
<p class="toc level1 tocsp"><a href="gloss01.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="chp-script-3"></a><h3>Macro Arguments</h3>
<p><a name="indexterm-278"></a>The D compiler also provides a set of macro variables corresponding to
any additional argument operands specified as part of the <tt>dtrace</tt> command invocation.
These <b>macro arguments</b> are accessed using the built-in names <tt>$0</tt> for name of
the D program file or <tt>dtrace</tt> command, <tt>$1</tt> for the first additional
operand, <tt>$2</tt> for the second operand, and so on. If you use
the <tt>dtrace</tt> <tt>-s</tt> option, <tt>$0</tt> expands to the value of the name
of the input file used with this option. For D programs specified
on the command-line, <tt>$0</tt> expands to the value of <tt>argv[0]</tt> used to
exec <tt>dtrace</tt> itself.</p><p>Macro arguments can expand to integers, identifiers, or strings, depending on the
form of the corresponding text. As with all macro variables, macro arguments
can be used anywhere integer, identifier, and string tokens can be used
in a D program. All of the following examples could form valid
D expressions assuming appropriate macro argument values:</p><pre>execname == $1    /* with a string macro argument */
x += $1           /* with an integer macro argument */
trace(x-&gt;$1)      /* with an identifier macro argument */</pre><p>Macro arguments can be used to create <tt>dtrace</tt> interpreter files that act
like real Solaris commands and use information specified by a user or
by another tool to modify their behavior. For example, the following D
interpreter file traces <a href="http://docs.sun.com/doc/819-2241/write-2?a=view"><tt>write</tt>(2)</a> system calls executed by a particular process ID:</p><pre>#!/usr/sbin/dtrace -s

syscall::write:entry
/pid == $1/
{
}</pre><p>If you make this interpreter file executable, you can specify the value
of <tt>$1</tt> using an additional command-line argument to your interpreter file:</p><pre><tt><b># chmod a+rx ./tracewrite</b></tt>
<tt><b># ./tracewrite 12345</b></tt></pre><p>The resulting command invocation counts each <a href="http://docs.sun.com/doc/819-2241/write-2?a=view"><tt>write</tt>(2)</a> system call executed by process
ID 12345.</p><p>If your D program references a macro argument that is not provided
on the command-line, an appropriate error message will be printed and your
program will fail to compile:</p><pre><tt><b># ./tracewrite</b></tt>
dtrace: failed to compile script ./tracewrite: line 4:
  macro argument $1 is not defined</pre><p>D programs can reference unspecified macro arguments if the <tt>defaultargs</tt> option is
set. If <tt>defaultargs</tt> is set, unspecified arguments will have the value <tt>0</tt>.
See <a href="chp-opt.html">Chapter&nbsp;16, Options and Tunables</a> for more information about D compiler options. The D compiler
will also produce an error message if additional arguments are specified on
the command line that are not referenced by your D program.</p><p>The macro argument values must match the form of an integer, identifier,
or string. If the argument does not match any of these forms,
the D compiler will report an appropriate error message. When specifying string
macro arguments to a DTrace interpreter file, surround the argument in an
extra pair of single quotes to avoid interpretation of the double quotes
and string contents by your shell:</p><pre><tt><b># ./foo '"a string argument"'</b></tt></pre><p>If you want your D macro arguments to be interpreted as string
tokens even if they match the form of an integer or identifier,
prefix the macro variable or argument name with two leading dollar signs
(for example, <tt>$$1</tt>) to force the D compiler to interpret the argument
value as if it were a string surrounded by double quotes. All
the usual D string escape sequences (see <a href="chp-typeopexpr-3.html#tbl-escs">Table&nbsp;2-5</a>) are expanded inside of
any string macro arguments, regardless of whether they are referenced using the
<tt>$</tt><i>arg</i><tt></tt> or <tt>$$</tt><i>arg</i><tt></tt> form of the macro. If the <tt>defaultargs</tt> option is
set, unspecified arguments that are referenced with the <tt>$$</tt><i>arg</i><tt></tt> form have the
value of the empty string (<tt>""</tt>).</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="chp-script-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="chp-script-4.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

