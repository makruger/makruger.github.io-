<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Subroutines - Solaris Dynamic Tracing Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-11-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">Solaris Dynamic Tracing Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="chp-actsub-5.html">Previous</a>
             </td>
             <td align="right">
                 <a href="chp-buf.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="chp-intro.html">1.&nbsp;&nbsp;Introduction</a></p>
<p class="toc level1 tocsp"><a href="chp-typeopexpr.html">2.&nbsp;&nbsp;Types, Operators, and Expressions</a></p>
<p class="toc level1 tocsp"><a href="chp-variables.html">3.&nbsp;&nbsp;Variables</a></p>
<p class="toc level1 tocsp"><a href="chp-prog.html">4.&nbsp;&nbsp;D Program Structure</a></p>
<p class="toc level1 tocsp"><a href="chp-pointers.html">5.&nbsp;&nbsp;Pointers and Arrays</a></p>
<p class="toc level1 tocsp"><a href="chp-strings.html">6.&nbsp;&nbsp;Strings</a></p>
<p class="toc level1 tocsp"><a href="chp-structs.html">7.&nbsp;&nbsp;Structs and Unions</a></p>
<p class="toc level1 tocsp"><a href="chp-types.html">8.&nbsp;&nbsp;Type and Constant Definitions</a></p>
<p class="toc level1 tocsp"><a href="chp-aggs.html">9.&nbsp;&nbsp;Aggregations</a></p>
<p class="toc level1 tocsp"><a href="chp-actsub.html">10.&nbsp;&nbsp;Actions and Subroutines</a></p>
<p class="toc level2"><a href="chp-actsub-1.html">Actions</a></p>
<p class="toc level2"><a href="chp-actsub-2.html">Default Action</a></p>
<p class="toc level2"><a href="chp-actsub-3.html">Data Recording Actions</a></p>
<p class="toc level2"><a href="chp-actsub-4.html">Destructive Actions</a></p>
<p class="toc level2"><a href="chp-actsub-5.html">Special Actions</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Subroutines</a></p>
</div>
<p class="toc level1 tocsp"><a href="chp-buf.html">11.&nbsp;&nbsp;Buffers and Buffering</a></p>
<p class="toc level1 tocsp"><a href="chp-fmt.html">12.&nbsp;&nbsp;Output Formatting</a></p>
<p class="toc level1 tocsp"><a href="chp-spec.html">13.&nbsp;&nbsp;Speculative Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-dtrace1m.html">14.&nbsp;&nbsp;<tt>dtrace</tt>(1M) Utility</a></p>
<p class="toc level1 tocsp"><a href="chp-script.html">15.&nbsp;&nbsp;Scripting</a></p>
<p class="toc level1 tocsp"><a href="chp-opt.html">16.&nbsp;&nbsp;Options and Tunables</a></p>
<p class="toc level1 tocsp"><a href="chp-dtrace.html">17.&nbsp;&nbsp;<tt>dtrace</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-lockstat.html">18.&nbsp;&nbsp;<tt>lockstat</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-profile.html">19.&nbsp;&nbsp;<tt>profile</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fbt.html">20.&nbsp;&nbsp;<tt>fbt</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-syscall.html">21.&nbsp;&nbsp;<tt>syscall</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sdt.html">22.&nbsp;&nbsp;<tt>sdt</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sysinfo.html">23.&nbsp;&nbsp;<tt>sysinfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-vminfo.html">24.&nbsp;&nbsp;<tt>vminfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-proc.html">25.&nbsp;&nbsp;<tt>proc</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sched.html">26.&nbsp;&nbsp;<tt>sched</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-io.html">27.&nbsp;&nbsp;<tt>io</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-mib.html">28.&nbsp;&nbsp;<tt>mib</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fpuinfo.html">29.&nbsp;&nbsp;<tt>fpuinfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-pid.html">30.&nbsp;&nbsp;<tt>pid</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-plockstat.html">31.&nbsp;&nbsp;<tt>plockstat</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fasttrap.html">32.&nbsp;&nbsp;<tt>fasttrap</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-user.html">33.&nbsp;&nbsp;User Process Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-usdt.html">34.&nbsp;&nbsp;Statically Defined Tracing for User Applications</a></p>
<p class="toc level1 tocsp"><a href="chp-sec.html">35.&nbsp;&nbsp;Security</a></p>
<p class="toc level1 tocsp"><a href="chp-anon.html">36.&nbsp;&nbsp;Anonymous Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-post.html">37.&nbsp;&nbsp;Postmortem Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-perf.html">38.&nbsp;&nbsp;Performance Considerations</a></p>
<p class="toc level1 tocsp"><a href="chp-stab.html">39.&nbsp;&nbsp;Stability</a></p>
<p class="toc level1 tocsp"><a href="chp-xlate.html">40.&nbsp;&nbsp;Translators</a></p>
<p class="toc level1 tocsp"><a href="chp-vers.html">41.&nbsp;&nbsp;Versioning</a></p>
<p class="toc level1 tocsp"><a href="gloss01.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="chp-actsub-6"></a><h3>Subroutines</h3>
<p><a name="indexterm-189"></a>Subroutines differ from actions because they generally only affect internal DTrace state. Therefore, there
are no destructive subroutines, and subroutines never trace data into buffers. Many subroutines
have analogs in the Section 9F or Section 3C interfaces. See <tt>Intro</tt>(9F) and
<a href="http://docs.sun.com/doc/819-2242/intro-3?a=view"><tt>Intro</tt>(3)</a> for more information on the corresponding subroutines.</p>

<a name="gelrf"></a><h4><tt>alloca()</tt></h4>
<pre>void *alloca(size_t <i>size</i>)</pre><p><a name="indexterm-190"></a><tt>alloca()</tt> allocates <i>size</i> bytes out of scratch space, and returns a pointer to
the allocated memory. The returned pointer is guaranteed to have 8&ndash;byte alignment. Scratch
space is only valid for the duration of a clause. Memory allocated with
<tt>alloca()</tt> will be deallocated when the clause completes. If insufficient scratch space is available,
no memory is allocated and an error is generated.</p>

<a name="gelsa"></a><h4><tt>basename()</tt></h4>
<pre>string basename(char *<i>str</i>)</pre><p><a name="indexterm-191"></a><tt>basename()</tt> is a D analogue for <a href="http://docs.sun.com/doc/819-2239/basename-1?a=view"><tt>basename</tt>(1)</a>. This subroutine creates a string that
consists of a copy of the specified string, but without any prefix that
ends in <tt>/</tt>. The returned string is allocated out of scratch memory, and
is therefore valid only for the duration of the clause. If insufficient scratch
space is available, <tt>basename</tt> does not execute and an error is generated.</p>

<a name="gelsq"></a><h4><tt>bcopy()</tt></h4>
<pre>void bcopy(void *<i>src</i>, void *<i>dest</i>, size_t <i>size</i>)</pre><p><a name="indexterm-192"></a><tt>bcopy()</tt> copies <i>size</i> bytes from the memory pointed to by <i>src</i> to the
memory pointed to by <i>dest</i>. All of the source memory must lie outside of
scratch memory and all of the destination memory must lie within it. If
these conditions are not met, no copying takes place and an error
is generated.</p>

<a name="gelsc"></a><h4><tt>cleanpath()</tt></h4>
<pre>string cleanpath(char *<i>str</i>)</pre><p><a name="indexterm-193"></a><tt>cleanpath()</tt> creates a string that consists of a copy of the path indicated
by <i>str</i>, but with certain redundant elements eliminated. In particular &ldquo;<tt>/./</tt>&rdquo; elements in the
path are removed, and &ldquo;<tt>/../</tt>&rdquo; elements are collapsed. The collapsing of <tt>/../</tt> elements in
the path occurs without regard to symbolic links. Therefore, it is possible that
<tt>cleanpath()</tt> could take a valid path and return a shorter, invalid one.</p><p>For example, if <i>str</i> were &ldquo;<tt>/foo/../bar</tt>&rdquo; and <tt>/foo</tt> were a symbolic link
to <tt>/net/foo/export</tt>, <tt>cleanpath()</tt> would return the string &ldquo;<tt>/bar</tt>&rdquo; even though <tt>bar</tt> might
only be in <tt>/net/foo</tt> not <tt>/</tt>. This limitation is due to the fact
that <tt>cleanpath()</tt> is called in the context of a firing probe, where full
symbolic link resolution or arbitrary names is not possible. The returned string is
allocated out of scratch memory, and is therefore valid only for the duration
of the clause. If insufficient scratch space is available, <tt>cleanpath</tt> does not
execute and an error is generated.</p>

<a name="chp-actsub-copyin"></a><h4><tt>copyin()</tt></h4>
<pre>void *copyin(uintptr_t <i>addr</i>, size_t <i>size</i>)</pre><p><a name="indexterm-194"></a><tt>copyin()</tt>copies the specified size in bytes from the specified user address into a
DTrace scratch buffer, and returns the address of this buffer. The user address
is interpreted as an address in the space of the process associated with
the current thread. The resulting buffer pointer is guaranteed to have 8-byte alignment.
The address in question <b>must</b> correspond to a faulted-in page in the
current process. If the address does not correspond to a faulted-in page, or
if insufficient scratch space is available, <tt>NULL</tt> is returned, and an error is
generated. See <a href="chp-user.html">Chapter&nbsp;33, User Process Tracing</a> for techniques to reduce the likelihood of <tt>copyin</tt> errors.</p>

<a name="chp-actsub-copyinstr"></a><h4><tt>copyinstr()</tt></h4>
<pre>string copyinstr(uintptr_t <i>addr</i>)</pre><p><a name="indexterm-195"></a><tt>copyinstr()</tt> copies a null-terminated C string from the specified user address into a
DTrace scratch buffer, and returns the address of this buffer. The user address
is interpreted as an address in the space of the process associated with
the current thread. The string length is limited to the value set by
the <tt>strsize</tt> option; see <a href="chp-opt.html">Chapter&nbsp;16, Options and Tunables</a> for details. As with <tt>copyin</tt>, the specified address <b>must</b>
correspond to a faulted-in page in the current process. If the address does
not correspond to a faulted-in page, or if insufficient scratch space is available,
<tt>NULL</tt> is returned, and an error is generated. See <a href="chp-user.html">Chapter&nbsp;33, User Process Tracing</a> for techniques to
reduce the likelihood of <tt>copyinstr</tt> errors.</p>

<a name="gelrx"></a><h4><tt>copyinto()</tt></h4>
<pre>void copyinto(uintptr_t <i>addr</i>, size_t <i>size</i>, void *<i>dest</i>)</pre><p><a name="indexterm-196"></a><tt>copyinto()</tt>copies the specified size in bytes from the specified user address into the
DTrace scratch buffer specified by <i>dest</i>. The user address is interpreted as
an address in the space of the process associated with the current thread.
The address in question <b>must</b> correspond to a faulted-in page in the
current process. If the address does not correspond to a faulted-in page, or
if any of the destination memory lies outside scratch space, no copying takes
place, and an error is generated. See <a href="chp-user.html">Chapter&nbsp;33, User Process Tracing</a> for techniques to reduce the likelihood
of <tt>copyinto</tt> errors.</p>

<a name="gelrv"></a><h4><tt>dirname()</tt></h4>
<pre>string dirname(char *<i>str</i>)</pre><p><a name="indexterm-197"></a><tt>dirname()</tt> is a D analogue for <a href="http://docs.sun.com/doc/819-2239/dirname-1?a=view"><tt>dirname</tt>(1)</a>. This subroutine creates a string that
consists of all but the last level of the pathname specified by
<i>str</i>. The returned string is allocated out of scratch memory, and is therefore
valid only for the duration of the clause. If insufficient scratch space is
available, <tt>dirname</tt> does not execute and an error is generated.</p>

<a name="gelsp"></a><h4><tt>msgdsize()</tt></h4>
<pre>size_t msgdsize(mblk_t *<i>mp</i>)</pre><p><tt>msgdsize()</tt> returns the number of bytes in the data message pointed to by
<i>mp</i>. See <tt>msgdsize</tt>(9F) for details. <tt>msgdsize()</tt> only includes data blocks of type
<tt>M_DATA</tt> in the count.</p>

<a name="gelsh"></a><h4><tt>msgsize()</tt></h4>
<pre>size_t msgsize(mblk_t *<i>mp</i>)</pre><p><a name="indexterm-198"></a><tt>msgsize()</tt> returns the number of bytes in the message pointed to by <i>mp</i>.
Unlike <tt>msgdsize()</tt>, which returns only the number of <b>data</b> bytes, <tt>msgsize()</tt> returns the
<b>total</b> number of bytes in the message.</p>

<a name="chp-actsub-owned"></a><h4><tt>mutex_owned()</tt></h4>
<pre>int mutex_owned(kmutex_t *<i>mutex</i>)</pre><p><a name="indexterm-199"></a><tt>mutex_owned()</tt> is an implementation of <tt>mutex_owned</tt>(9F). <tt>mutex_owned()</tt> returns non-zero if the calling
thread currently holds the specified kernel mutex, or zero if the specified adaptive
mutex is currently unowned.</p>

<a name="chp-actsub-owner"></a><h4><tt>mutex_owner()</tt></h4>
<pre>kthread_t *mutex_owner(kmutex_t *<i>mutex</i>)</pre><p><a name="indexterm-200"></a><tt>mutex_owner()</tt> returns the thread pointer of the current owner of the specified adaptive
kernel mutex. <tt>mutex_owner()</tt> returns <tt>NULL</tt> if the specified adaptive mutex is currently
unowned, or if the specified mutex is a spin mutex. See <tt>mutex_owned</tt>(9F).</p>

<a name="chp-actsub-adapt"></a><h4><tt>mutex_type_adaptive()</tt></h4>
<pre>int mutex_type_adaptive(kmutex_t *<i>mutex</i>)</pre><p><a name="indexterm-201"></a><tt>mutex_type_adaptive()</tt> returns non-zero if the specified kernel mutex is of type <tt>MUTEX_ADAPTIVE</tt>, or zero
if it is not. Mutexes are adaptive if they meet one or
more of the following conditions:</p>
<ul><li><p>The mutex is declared statically</p></li>
<li><p>The mutex is created with an interrupt block cookie of NULL</p></li>
<li><p>The mutex is created with an interrupt block cookie that does not correspond to a high-level interrupt</p></li></ul>
<p>See <tt>mutex_init</tt>(9F) for more details on mutexes. The majority of mutexes in the
Solaris kernel are adaptive.</p>

<a name="chp-actsub-progenyof"></a><h4><tt>progenyof()</tt></h4>
<pre>int progenyof(pid_t <i>pid</i>)</pre><p><a name="indexterm-202"></a><tt>progenyof()</tt> returns non-zero if the calling process (the process associated with the thread
that is currently triggering the matched probe) is among the progeny of the
specified process ID.</p>

<a name="chp-actsub-rand"></a><h4><tt>rand()</tt></h4>
<pre>int rand(void)</pre><p><a name="indexterm-203"></a><tt>rand()</tt> returns a pseudo-random integer. The number returned is a weak pseudo-random number,
and should not be used for any cryptographic application.</p>

<a name="chp-actsub-rw1"></a><h4><tt>rw_iswriter()</tt></h4>
<pre>int rw_iswriter(krwlock_t *<i>rwlock</i>)</pre><p><a name="indexterm-204"></a><tt>rw_iswriter()</tt> returns non-zero if the specified reader-writer lock is either held or desired
by a writer. If the lock is held only by readers and no
writer is blocked, or if the lock is not held at all,
<tt>rw_iswriter()</tt> returns zero. See <tt>rw_init</tt>(9F).</p>

<a name="chp-actsub-rw2"></a><h4><tt>rw_write_held()</tt></h4>
<pre>int rw_write_held(krwlock_t *<i>rwlock</i>)</pre><p><a name="indexterm-205"></a><tt>rw_write_held()</tt> returns non-zero if the specified reader-writer lock is currently held by a
writer. If the lock is held only by readers or not held at
all, <tt>rw_write_held()</tt> returns zero. See <tt>rw_init</tt>(9F).</p>

<a name="chp-actsub-speculation"></a><h4><tt>speculation()</tt></h4>
<pre>int speculation(void)</pre><p><a name="indexterm-206"></a><tt>speculation()</tt> reserves a speculative trace buffer for use with <tt>speculate()</tt> and returns an
identifier for this buffer. See <a href="chp-spec.html">Chapter&nbsp;13, Speculative Tracing</a> for details.</p>

<a name="gelrb"></a><h4><tt>strjoin()</tt></h4>
<pre>string strjoin(char *<i>str1</i>, char *<i>str2</i>)</pre><p><a name="indexterm-207"></a><tt>strjoin()</tt> creates a string that consists of <i>str1</i> concatenated with <i>str2</i>. The returned
string is allocated out of scratch memory, and is therefore valid only for
the duration of the clause. If insufficient scratch space is available, <tt>strjoin</tt>
does not execute and an error is generated.</p>

<a name="chp-actsub-strlen"></a><h4><tt>strlen()</tt></h4>
<pre>size_t strlen(string <i>str</i>)</pre><p><a name="indexterm-208"></a><tt>strlen()</tt> returns the length of the specified string in bytes, excluding the terminating
null byte.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="chp-actsub-5.html">Previous</a>
             </td>
             <td align="right">
                 <a href="chp-buf.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

