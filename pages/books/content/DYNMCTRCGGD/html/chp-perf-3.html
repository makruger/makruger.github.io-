<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Use Cacheable Predicates - Solaris Dynamic Tracing Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-11-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">Solaris Dynamic Tracing Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="chp-perf-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="chp-stab.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="chp-intro.html">1.&nbsp;&nbsp;Introduction</a></p>
<p class="toc level1 tocsp"><a href="chp-typeopexpr.html">2.&nbsp;&nbsp;Types, Operators, and Expressions</a></p>
<p class="toc level1 tocsp"><a href="chp-variables.html">3.&nbsp;&nbsp;Variables</a></p>
<p class="toc level1 tocsp"><a href="chp-prog.html">4.&nbsp;&nbsp;D Program Structure</a></p>
<p class="toc level1 tocsp"><a href="chp-pointers.html">5.&nbsp;&nbsp;Pointers and Arrays</a></p>
<p class="toc level1 tocsp"><a href="chp-strings.html">6.&nbsp;&nbsp;Strings</a></p>
<p class="toc level1 tocsp"><a href="chp-structs.html">7.&nbsp;&nbsp;Structs and Unions</a></p>
<p class="toc level1 tocsp"><a href="chp-types.html">8.&nbsp;&nbsp;Type and Constant Definitions</a></p>
<p class="toc level1 tocsp"><a href="chp-aggs.html">9.&nbsp;&nbsp;Aggregations</a></p>
<p class="toc level1 tocsp"><a href="chp-actsub.html">10.&nbsp;&nbsp;Actions and Subroutines</a></p>
<p class="toc level1 tocsp"><a href="chp-buf.html">11.&nbsp;&nbsp;Buffers and Buffering</a></p>
<p class="toc level1 tocsp"><a href="chp-fmt.html">12.&nbsp;&nbsp;Output Formatting</a></p>
<p class="toc level1 tocsp"><a href="chp-spec.html">13.&nbsp;&nbsp;Speculative Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-dtrace1m.html">14.&nbsp;&nbsp;<tt>dtrace</tt>(1M) Utility</a></p>
<p class="toc level1 tocsp"><a href="chp-script.html">15.&nbsp;&nbsp;Scripting</a></p>
<p class="toc level1 tocsp"><a href="chp-opt.html">16.&nbsp;&nbsp;Options and Tunables</a></p>
<p class="toc level1 tocsp"><a href="chp-dtrace.html">17.&nbsp;&nbsp;<tt>dtrace</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-lockstat.html">18.&nbsp;&nbsp;<tt>lockstat</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-profile.html">19.&nbsp;&nbsp;<tt>profile</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fbt.html">20.&nbsp;&nbsp;<tt>fbt</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-syscall.html">21.&nbsp;&nbsp;<tt>syscall</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sdt.html">22.&nbsp;&nbsp;<tt>sdt</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sysinfo.html">23.&nbsp;&nbsp;<tt>sysinfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-vminfo.html">24.&nbsp;&nbsp;<tt>vminfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-proc.html">25.&nbsp;&nbsp;<tt>proc</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-sched.html">26.&nbsp;&nbsp;<tt>sched</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-io.html">27.&nbsp;&nbsp;<tt>io</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-mib.html">28.&nbsp;&nbsp;<tt>mib</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fpuinfo.html">29.&nbsp;&nbsp;<tt>fpuinfo</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-pid.html">30.&nbsp;&nbsp;<tt>pid</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-plockstat.html">31.&nbsp;&nbsp;<tt>plockstat</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-fasttrap.html">32.&nbsp;&nbsp;<tt>fasttrap</tt> Provider</a></p>
<p class="toc level1 tocsp"><a href="chp-user.html">33.&nbsp;&nbsp;User Process Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-usdt.html">34.&nbsp;&nbsp;Statically Defined Tracing for User Applications</a></p>
<p class="toc level1 tocsp"><a href="chp-sec.html">35.&nbsp;&nbsp;Security</a></p>
<p class="toc level1 tocsp"><a href="chp-anon.html">36.&nbsp;&nbsp;Anonymous Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-post.html">37.&nbsp;&nbsp;Postmortem Tracing</a></p>
<p class="toc level1 tocsp"><a href="chp-perf.html">38.&nbsp;&nbsp;Performance Considerations</a></p>
<p class="toc level2"><a href="chp-perf-1.html">Limit Enabled Probes</a></p>
<p class="toc level2"><a href="chp-perf-2.html">Use Aggregations</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Use Cacheable Predicates</a></p>
</div>
<p class="toc level1 tocsp"><a href="chp-stab.html">39.&nbsp;&nbsp;Stability</a></p>
<p class="toc level1 tocsp"><a href="chp-xlate.html">40.&nbsp;&nbsp;Translators</a></p>
<p class="toc level1 tocsp"><a href="chp-vers.html">41.&nbsp;&nbsp;Versioning</a></p>
<p class="toc level1 tocsp"><a href="gloss01.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="chp-perf-3"></a><h3>Use Cacheable Predicates</h3>
<p><a name="indexterm-498"></a><a name="indexterm-499"></a>DTrace predicates are used to filter unwanted data from the experiment by
tracing data is only traced if a specified condition is found to
be true. When enabling many probes, you generally use predicates of a
form that identifies a specific thread or threads of interest, such as
<tt>/self-&gt;traceme/</tt> or <tt>/pid == 12345/</tt>. Although many of these predicates evaluate to a false
value for most threads in most probes, the evaluation itself can become
costly when done for many thousands of probes. To reduce this cost,
DTrace caches the evaluation of a predicate if it includes only thread-local
variables (for example, <tt>/self-&gt;traceme/</tt>) or immutable variables (for example, <tt>/pid == 12345/</tt>). The cost
of evaluating a cached predicate is much smaller than the cost of
evaluating a non-cached predicate, especially if the predicate involves thread-local variables, string
comparisons, or other relatively costly operations. While predicate caching is transparent to
the user, it does imply some guidelines for constructing optimal predicates, as
shown in the following table:</p><table><col width="25%"><col width="75%"><tr><th align="left" valign="top" scope="column"><p>Cacheable</p></th>
<th align="left" valign="top" scope="column"><p>Uncacheable</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>self-&gt;mumble</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>mumble[curthread]</tt>, <tt>mumble[pid, tid]</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>execname</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>curpsinfo-&gt;pr_fname</tt>, <tt>curthread-&gt;t_procp-&gt;p_user.u_comm</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>pid</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>curpsinfo-&gt;pr_pid</tt>, <tt>curthread-&gt;t_procp-&gt;p_pipd-&gt;pid_id</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>tid</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>curlwpsinfo-&gt;pr_lwpid</tt>, <tt>curthread-&gt;t_tid</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>curthread</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>curthread-&gt;</tt><i>any member</i><tt></tt>, <tt>curlwpsinfo-&gt;</tt><i>any member</i><tt></tt>, <tt>curpsinfo-&gt;</tt><i>any member</i><tt></tt></p></td>
</tr>
</table><p>The following example is not recommended:</p><pre>syscall::read:entry
{
    follow[pid, tid] = 1;
}

fbt:::
/follow[pid, tid]/
{}

syscall::read:return
/follow[pid, tid]/
{
    follow[pid, tid] = 0;
}</pre><p>The following example using thread-local variables is preferable:</p><pre>syscall::read:entry
{
    self-&gt;follow = 1;
}

fbt:::
/self-&gt;follow/
{}

syscall::read:return
/self-&gt;follow/
{
    self-&gt;follow = 0;
}</pre><p>A predicate must consist <b>exclusively</b> of cacheable expressions in order to be
cacheable. The following predicates are all cacheable:</p><pre>/execname == "myprogram"/
/execname == $$1/
/pid == 12345/
/pid == $1/
/self-&gt;traceme == 1/</pre><p>The following examples, which use global variables, are not cacheable:</p><pre>/execname == one_to_watch/
/traceme[execname]/
/pid == pid_i_care_about/
/self-&gt;traceme == my_global/</pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="chp-perf-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="chp-stab.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

