<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Networking in Shared-IP Non-Global Zones - System Administration Guide:  Virtualization Using the Solaris Operating System</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-04-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide:  Virtualization Using the Solaris Operating System</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="z.admin.ov-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="gelkh.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="preface-3.html">Solaris Virtualization Product Overview</a></p>
<p class="toc level1 tocsp"><a href="resource.html">Part&nbsp;I&nbsp;Resource Management</a></p>
<p class="toc level2"><a href="rmintro-1.html">1.&nbsp;&nbsp;Introduction to Solaris Resource Management</a></p>
<p class="toc level2"><a href="rmtaskproj-1.html">2.&nbsp;&nbsp;Projects and Tasks (Overview)</a></p>
<p class="toc level2"><a href="rmtaskproj.task-37.html">3.&nbsp;&nbsp;Administering Projects and Tasks</a></p>
<p class="toc level2"><a href="rmacct-1.html">4.&nbsp;&nbsp;Extended Accounting (Overview)</a></p>
<p class="toc level2"><a href="rmacct.task.sgm.html">5.&nbsp;&nbsp;Administering Extended Accounting (Tasks)</a></p>
<p class="toc level2"><a href="rmctrls-1.html">6.&nbsp;&nbsp;Resource Controls (Overview)</a></p>
<p class="toc level2"><a href="rmctrls.task-1.html">7.&nbsp;&nbsp;Administering Resource Controls (Tasks)</a></p>
<p class="toc level2"><a href="rmfss-1.html">8.&nbsp;&nbsp;Fair Share Scheduler (Overview)</a></p>
<p class="toc level2"><a href="rmfss.task-1.html">9.&nbsp;&nbsp;Administering the Fair Share Scheduler (Tasks)</a></p>
<p class="toc level2"><a href="rm.rcapd-1.html">10.&nbsp;&nbsp;Physical Memory Control Using the Resource Capping Daemon (Overview)</a></p>
<p class="toc level2"><a href="rm.rcapd.task-1.html">11.&nbsp;&nbsp;Administering the Resource Capping Daemon (Tasks)</a></p>
<p class="toc level2"><a href="rmpool-1.html">12.&nbsp;&nbsp;Resource Pools (Overview)</a></p>
<p class="toc level2"><a href="rmpool.task-1.html">13.&nbsp;&nbsp;Creating and Administering Resource Pools (Tasks)</a></p>
<p class="toc level2"><a href="rmconfig-1.html">14.&nbsp;&nbsp;Resource Management Configuration Example</a></p>
<p class="toc level2"><a href="rmconsole-1.html">15.&nbsp;&nbsp;Resource Control Functionality in the Solaris Management Console</a></p>
<p class="toc level1 tocsp"><a href="zone.html">Part&nbsp;II&nbsp;Zones</a></p>
<p class="toc level2"><a href="zones.intro-1.html">16.&nbsp;&nbsp;Introduction to Solaris Zones</a></p>
<p class="toc level2"><a href="z.config.ov-1.html">17.&nbsp;&nbsp;Non-Global Zone Configuration (Overview)</a></p>
<p class="toc level2"><a href="z.conf.start-1.html">18.&nbsp;&nbsp;Planning and Configuring Non-Global Zones (Tasks)</a></p>
<p class="toc level2"><a href="z.inst.ov-1.html">19.&nbsp;&nbsp;About Installing, Halting, Cloning, and Uninstalling Non-Global Zones (Overview)</a></p>
<p class="toc level2"><a href="z.inst.task-1.html">20.&nbsp;&nbsp;Installing, Booting, Halting, Uninstalling,  and Cloning Non-Global Zones (Tasks)</a></p>
<p class="toc level2"><a href="z.login.ov-1.html">21.&nbsp;&nbsp;Non-Global Zone Login (Overview)</a></p>
<p class="toc level2"><a href="z.login.task-1.html">22.&nbsp;&nbsp;Logging In to Non-Global Zones (Tasks)</a></p>
<p class="toc level2"><a href="gcgnc.html">23.&nbsp;&nbsp;Moving and Migrating Non-Global Zones (Tasks)</a></p>
<p class="toc level2"><a href="z.pkginst.ov-1.html">24.&nbsp;&nbsp;About Packages and Patches on a Solaris System With Zones Installed (Overview)</a></p>
<p class="toc level2"><a href="z.pkginst.task-1.html">25.&nbsp;&nbsp;Adding and Removing Packages and Patches on a Solaris System With Zones Installed (Tasks)</a></p>
<p class="toc level2"><a href="z.admin.ov-1.html">26.&nbsp;&nbsp;Solaris Zones Administration (Overview)</a></p>
<p class="toc level3"><a href="z.admin.ov-4.html">Global Zone Visibility and Access</a></p>
<p class="toc level3"><a href="z.admin.ov-22.html">Process ID Visibility in Zones</a></p>
<p class="toc level3"><a href="z.admin.ov-24.html">System Observability in Zones</a></p>
<p class="toc level3"><a href="z.admin.ov-11.html">Non-Global Zone Node Name</a></p>
<p class="toc level3"><a href="z.admin.ov-2.html">File Systems and Non-Global Zones</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Networking in Shared-IP Non-Global Zones</a></p>
</div>
<p class="toc level3"><a href="gelkh.html">Networking in Exclusive-IP Non-Global Zones</a></p>
<p class="toc level3"><a href="z.admin.ov-13.html">Device Use in Non-Global Zones</a></p>
<p class="toc level3"><a href="z.admin.ov-42.html">Running Applications in Non-Global Zones</a></p>
<p class="toc level3"><a href="z.admin.ov-3.html">Resource Controls Used in Non-Global Zones</a></p>
<p class="toc level3"><a href="z.admin.ov-43.html">Fair Share Scheduler on a Solaris System With Zones Installed</a></p>
<p class="toc level3"><a href="z.admin.ov-6.html">Extended Accounting on a Solaris System With Zones Installed</a></p>
<p class="toc level3"><a href="z.admin.ov-18.html">Privileges in a Non-Global Zone</a></p>
<p class="toc level3"><a href="z.admin.ov-29.html">Using IP Security Architecture in Zones</a></p>
<p class="toc level3"><a href="z.admin.ov-20.html">Using Solaris Auditing in Zones</a></p>
<p class="toc level3"><a href="z.admin.ov-21.html">Core Files in Zones</a></p>
<p class="toc level3"><a href="gcogk.html">Running DTrace in a Non-Global Zone</a></p>
<p class="toc level3"><a href="gbrho.html">About Backing Up a Solaris System With Zones Installed</a></p>
<p class="toc level3"><a href="gbrhi.html">Determining What to Back Up in Non-Global Zones</a></p>
<p class="toc level3"><a href="gbrip.html">About Restoring Non-Global Zones</a></p>
<p class="toc level3"><a href="z.admin.ov-32.html">Commands Used on a Solaris System With Zones Installed</a></p>
<p class="toc level2 tocsp"><a href="z.admin.task-1.html">27.&nbsp;&nbsp;Administering Solaris Zones (Tasks)</a></p>
<p class="toc level2"><a href="gclkx.html">28.&nbsp;&nbsp;Troubleshooting Miscellaneous Solaris Zones Problems</a></p>
<p class="toc level1 tocsp"><a href="gchhk.html">Part&nbsp;III&nbsp;Branded Zones</a></p>
<p class="toc level2"><a href="gchhy.html">29.&nbsp;&nbsp;About Branded Zones and the Linux Branded Zone</a></p>
<p class="toc level2"><a href="gcwwm.html">30.&nbsp;&nbsp;Planning the <tt>lx</tt> Branded Zone Configuration (Overview)</a></p>
<p class="toc level2"><a href="gdajn.html">31.&nbsp;&nbsp;Configuring the <tt>lx</tt> Branded Zone (Tasks)</a></p>
<p class="toc level2"><a href="gdbki.html">32.&nbsp;&nbsp;About Installing, Booting, Halting, Cloning, and Uninstalling <tt>lx</tt> Branded Zones (Overview)</a></p>
<p class="toc level2"><a href="gdduh.html">33.&nbsp;&nbsp;Installing, Booting, Halting, Uninstalling and Cloning <tt>lx</tt> Branded Zones (Tasks)</a></p>
<p class="toc level2"><a href="gdgck.html">34.&nbsp;&nbsp;Logging In to <tt>lx</tt> Branded Zones (Tasks)</a></p>
<p class="toc level2"><a href="gdqnv.html">35.&nbsp;&nbsp;Moving and Migrating <tt>lx</tt> Branded Zones (Tasks)</a></p>
<p class="toc level2"><a href="gdgif.html">36.&nbsp;&nbsp;Administering and Running Applications in <tt>lx</tt> Branded Zones (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="gefwp.html">Part&nbsp;IV&nbsp;Sun xVM</a></p>
<p class="toc level2"><a href="gfwrc.html">37.&nbsp;&nbsp;Sun xVM Hypervisor System Requirements</a></p>
<p class="toc level2"><a href="gefwo.html">38.&nbsp;&nbsp;Booting and Running the Sun xVM Hypervisor</a></p>
<p class="toc level2"><a href="gfwcu.html">39.&nbsp;&nbsp;Xvnc</a></p>
<p class="toc level2"><a href="gfqke.html">40.&nbsp;&nbsp;Using <tt>virt-install</tt> to Install a Domain</a></p>
<p class="toc level2"><a href="gfwlm.html">41.&nbsp;&nbsp;xVM System Administration</a></p>
<p class="toc level2"><a href="gefzh.html">42.&nbsp;&nbsp;Troubleshooting Miscellaneous Sun xVM Problems</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="z.admin.ov-9"></a><h3>Networking in Shared-IP Non-Global Zones</h3>
<p><a name="indexterm-317"></a><a name="indexterm-318"></a>On a Solaris system with zones installed, the zones can communicate with each other
over the network. The zones all have separate bindings, or connections, and the
zones can all run their own server daemons. These daemons can listen on
the same port numbers without any conflict. The IP stack resolves conflicts by
considering the IP addresses for incoming connections. The IP addresses identify the zone.</p>

<a name="z.admin.ov-10"></a><h4>Shared-IP Zone Partitioning</h4>
<p>The IP stack in a system supporting zones implements the separation of network
traffic between zones. Applications that receive IP traffic can only receive traffic sent
to the same zone.</p><p>Each logical interface on the system belongs to a specific zone, the global
zone by default. Logical network interfaces assigned to zones though the <tt>zonecfg</tt> utility
are used to communicate over the network. Each stream and connection belongs to
the zone of the process that opened it.</p><p>Bindings between upper-layer streams and logical interfaces are restricted. A stream can only
establish bindings to logical interfaces in the same zone. Likewise, packets from a
logical interface can only be passed to upper-layer streams in the same zone
as the logical interface.</p><p>Each zone has its own set of binds. Each zone can be
running the same application listening on the same port number without binds failing
because the address is already in use. Each zone can run its own
version of the following services:</p>
<ul><li><p>Internet services daemon with a full configuration file (see the <a href="http://docs.sun.com/doc/819-2240/inetd-1m?a=view"><tt>inetd</tt>(1M)</a> man page)</p></li>
<li><p><tt>sendmail</tt> (see the <a href="http://docs.sun.com/doc/819-2240/sendmail-1m?a=view"><tt>sendmail</tt>(1M)</a> man page)</p></li>
<li><p><tt>apache</tt> (see the <a href="http://docs.sun.com/doc/819-2240/apache-1m?a=view"><tt>apache</tt>(1M)</a> man page)</p></li></ul>
<p>Zones other than the global zone have restricted access to the network. The
standard TCP and UDP socket interfaces are available, but <tt>SOCK_RAW</tt> socket interfaces are
restricted to Internet Control Message Protocol (ICMP). ICMP is necessary for detecting and
reporting network error conditions or using the <tt>ping</tt> command.</p>

<a name="z.admin.ov-12"></a><h4>Shared-IP Network Interfaces</h4>
<p>Each non-global zone that requires network connectivity has one or more dedicated IP
addresses. These addresses are associated with logical network interfaces that can be placed
in a zone by using the <tt>ifconfig</tt> command. Zone network interfaces configured by
<tt>zonecfg</tt> will automatically be set up and placed in the zone when it
is booted. The <tt>ifconfig</tt> command can be used to add or remove logical
interfaces when the zone is running. Only the global administrator can modify the
interface configuration and the network routes.</p><p>Within a non-global zone, only that zone's interfaces will be visible to <tt>ifconfig</tt>.</p><p>For more information, see the <a href="http://docs.sun.com/doc/819-2240/ifconfig-1m?a=view"><tt>ifconfig</tt>(1M)</a> and <a href="http://docs.sun.com/doc/819-2254/if-tcp-7p?a=view"><tt>if_tcp</tt>(7P)</a> man pages.</p>

<a name="z.admin.ov-38"></a><h4>IP Traffic Between Shared-IP Zones on the Same Machine</h4>
<p>Between two zones on the same machine, packet delivery is only allowed if
there is a &ldquo;matching route&rdquo; for the destination and the zone in the
forwarding table.</p><p>The matching information is implemented as follows:</p>
<ul><li><p>The source address for the packets is selected on the output interface specified by the matching route.</p></li>
<li><p>By default, traffic is permitted between two zones that have addresses on the same subnet. The matching route in this case is the interface route for the subnet.</p></li>
<li><p>If there is a default route for a given zone, where the gateway is on one of the zone's subnets, traffic from that zone to all other zones is allowed. The matching route in this case is the default route.</p></li>
<li><p>If there is a matching route with the <tt>RTF_REJECT</tt> flag, packets trigger an ICMP unreachable message. If there is a matching route with the <tt>RTF_BLACKHOLE</tt> flag, packets are discarded. The global administrator can use the <tt>route</tt> command options described in the following table to create routes with these flags.</p><table><col width="33*"><col width="33*"><col width="33*"><tr><th align="left" valign="top" scope="column"><p>Modifier</p></th>
<th align="left" valign="top" scope="column"><p>Flag</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>-reject</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>RTF_REJECT</tt></p></td>
<td align="left" valign="top" scope="row"><p>Emit an ICMP unreachable message when matched.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>-blackhole</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>RTF_BLACKHOLE</tt></p></td>
<td align="left" valign="top" scope="row"><p>Silently discard packets during updates.</p></td>
</tr>
</table><p>For more information, see the <a href="http://docs.sun.com/doc/819-2240/route-1m?a=view"><tt>route</tt>(1M)</a></p></li></ul>


<a name="gedyy"></a><h4>Solaris IP Filter in Shared-IP Zones</h4>
<p>Solaris IP Filter provides stateful packet filtering and network address translation (NAT). A
stateful packet filter can monitor the state of active connections and use the
information obtained to determine which network packets to allow through the firewall. Solaris
IP Filter also includes stateless packet filtering and the ability to create and
manage address pools. See <a href="http://docs.sun.com/doc/819-3000/eupsq?a=view">Chapter 25, Solaris IP Filter (Overview), in <i>System Administration Guide: IP Services</i></a> for additional information.</p><p>Solaris IP Filter can be enabled in non-global zones by turning on
loopback filtering as described in <a href="http://docs.sun.com/doc/819-3000/ipfilter-admin-1?a=view">Chapter 26, Solaris IP Filter (Tasks), in <i>System Administration Guide: IP Services</i></a>. </p><p>Solaris IP Filter is derived from open source IP Filter software.</p>

<a name="z.admin.ov-36"></a><h4>IP Network Multipathing in Shared-IP Zones</h4>
<p>IP network multipathing (IPMP) provides physical interface failure detection and transparent network access
failover for a system with multiple interfaces on the same IP link. IPMP
also provides load spreading of packets for systems with multiple interfaces.</p><p>All network configuration is done in the global zone. You can configure IPMP
in the global zone, then extend the functionality to non-global zones. The functionality
is extended by placing the zone's address in an IPMP group when you
configure the zone. Then, if one of the interfaces in the global zone
fails, the non-global zone addresses will migrate to another network interface card.</p><p>In a given non-global zone, only the interfaces associated with the zone are
visible through the <tt>ifconfig</tt> command.</p><p>See <a href="z.admin.task-54.html#z.admin.task-60">How to Extend IP Network Multipathing Functionality to Shared-IP Non-Global Zones</a>. The zones configuration procedure is covered in <a href="z.conf.start-85.html#z.conf.start-29">How to Configure the Zone</a>. For information on
IPMP features, components, and usage, see <a href="http://docs.sun.com/doc/819-3000/mpoverview?a=view">Chapter 27, Introducing IPMP (Overview), in <i>System Administration Guide: IP Services</i></a>.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="z.admin.ov-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="gelkh.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

