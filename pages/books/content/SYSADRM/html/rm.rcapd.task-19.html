<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Producing Reports With <tt>rcapstat</tt> - System Administration Guide:  Virtualization Using the Solaris Operating System</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-04-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide:  Virtualization Using the Solaris Operating System</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="rm.rcapd.task-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="rmpool-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="preface-3.html">Solaris Virtualization Product Overview</a></p>
<p class="toc level1 tocsp"><a href="resource.html">Part&nbsp;I&nbsp;Resource Management</a></p>
<p class="toc level2"><a href="rmintro-1.html">1.&nbsp;&nbsp;Introduction to Solaris Resource Management</a></p>
<p class="toc level2"><a href="rmtaskproj-1.html">2.&nbsp;&nbsp;Projects and Tasks (Overview)</a></p>
<p class="toc level2"><a href="rmtaskproj.task-37.html">3.&nbsp;&nbsp;Administering Projects and Tasks</a></p>
<p class="toc level2"><a href="rmacct-1.html">4.&nbsp;&nbsp;Extended Accounting (Overview)</a></p>
<p class="toc level2"><a href="rmacct.task.sgm.html">5.&nbsp;&nbsp;Administering Extended Accounting (Tasks)</a></p>
<p class="toc level2"><a href="rmctrls-1.html">6.&nbsp;&nbsp;Resource Controls (Overview)</a></p>
<p class="toc level2"><a href="rmctrls.task-1.html">7.&nbsp;&nbsp;Administering Resource Controls (Tasks)</a></p>
<p class="toc level2"><a href="rmfss-1.html">8.&nbsp;&nbsp;Fair Share Scheduler (Overview)</a></p>
<p class="toc level2"><a href="rmfss.task-1.html">9.&nbsp;&nbsp;Administering the Fair Share Scheduler (Tasks)</a></p>
<p class="toc level2"><a href="rm.rcapd-1.html">10.&nbsp;&nbsp;Physical Memory Control Using the Resource Capping Daemon (Overview)</a></p>
<p class="toc level2"><a href="rm.rcapd.task-1.html">11.&nbsp;&nbsp;Administering the Resource Capping Daemon (Tasks)</a></p>
<p class="toc level3"><a href="fxcau.html">Setting the Resident Set Size Cap</a></p>
<p class="toc level4"><a href="fxcau.html#fxcey">How to Add an <tt>rcap.max-rss</tt> Attribute for a Project</a></p>
<p class="toc level4"><a href="fxcau.html#fxcfa">How to Use the <tt>projmod</tt> Command to Add an <tt>rcap.max-rss</tt> Attribute for a Project</a></p>
<p class="toc level3 tocsp"><a href="rm.rcapd.task-26.html">Configuring and Using the Resource Capping Daemon (Task Map)</a></p>
<p class="toc level3"><a href="rm.rcapd.task-2.html">Administering the Resource Capping Daemon With <tt>rcapadm</tt></a></p>
<p class="toc level4"><a href="rm.rcapd.task-2.html#rm.rcapd.task-3">How to Set the Memory Cap Enforcement Threshold</a></p>
<p class="toc level4"><a href="rm.rcapd.task-2.html#rm.rcapd.task-6">How to Set Operation Intervals</a></p>
<p class="toc level4"><a href="rm.rcapd.task-2.html#rm.rcapd.task-10">How to Enable Resource Capping</a></p>
<p class="toc level4"><a href="rm.rcapd.task-2.html#rm.rcapd.task-14">How to Disable Resource Capping</a></p>
<div class="onpage">
<p class="toc level3 tocsp"><a href="">Producing Reports With <tt>rcapstat</tt></a></p>
</div>
<p class="toc level2 tocsp"><a href="rmpool-1.html">12.&nbsp;&nbsp;Resource Pools (Overview)</a></p>
<p class="toc level2"><a href="rmpool.task-1.html">13.&nbsp;&nbsp;Creating and Administering Resource Pools (Tasks)</a></p>
<p class="toc level2"><a href="rmconfig-1.html">14.&nbsp;&nbsp;Resource Management Configuration Example</a></p>
<p class="toc level2"><a href="rmconsole-1.html">15.&nbsp;&nbsp;Resource Control Functionality in the Solaris Management Console</a></p>
<p class="toc level1 tocsp"><a href="zone.html">Part&nbsp;II&nbsp;Zones</a></p>
<p class="toc level2"><a href="zones.intro-1.html">16.&nbsp;&nbsp;Introduction to Solaris Zones</a></p>
<p class="toc level2"><a href="z.config.ov-1.html">17.&nbsp;&nbsp;Non-Global Zone Configuration (Overview)</a></p>
<p class="toc level2"><a href="z.conf.start-1.html">18.&nbsp;&nbsp;Planning and Configuring Non-Global Zones (Tasks)</a></p>
<p class="toc level2"><a href="z.inst.ov-1.html">19.&nbsp;&nbsp;About Installing, Halting, Cloning, and Uninstalling Non-Global Zones (Overview)</a></p>
<p class="toc level2"><a href="z.inst.task-1.html">20.&nbsp;&nbsp;Installing, Booting, Halting, Uninstalling,  and Cloning Non-Global Zones (Tasks)</a></p>
<p class="toc level2"><a href="z.login.ov-1.html">21.&nbsp;&nbsp;Non-Global Zone Login (Overview)</a></p>
<p class="toc level2"><a href="z.login.task-1.html">22.&nbsp;&nbsp;Logging In to Non-Global Zones (Tasks)</a></p>
<p class="toc level2"><a href="gcgnc.html">23.&nbsp;&nbsp;Moving and Migrating Non-Global Zones (Tasks)</a></p>
<p class="toc level2"><a href="z.pkginst.ov-1.html">24.&nbsp;&nbsp;About Packages and Patches on a Solaris System With Zones Installed (Overview)</a></p>
<p class="toc level2"><a href="z.pkginst.task-1.html">25.&nbsp;&nbsp;Adding and Removing Packages and Patches on a Solaris System With Zones Installed (Tasks)</a></p>
<p class="toc level2"><a href="z.admin.ov-1.html">26.&nbsp;&nbsp;Solaris Zones Administration (Overview)</a></p>
<p class="toc level2"><a href="z.admin.task-1.html">27.&nbsp;&nbsp;Administering Solaris Zones (Tasks)</a></p>
<p class="toc level2"><a href="gclkx.html">28.&nbsp;&nbsp;Troubleshooting Miscellaneous Solaris Zones Problems</a></p>
<p class="toc level1 tocsp"><a href="gchhk.html">Part&nbsp;III&nbsp;Branded Zones</a></p>
<p class="toc level2"><a href="gchhy.html">29.&nbsp;&nbsp;About Branded Zones and the Linux Branded Zone</a></p>
<p class="toc level2"><a href="gcwwm.html">30.&nbsp;&nbsp;Planning the <tt>lx</tt> Branded Zone Configuration (Overview)</a></p>
<p class="toc level2"><a href="gdajn.html">31.&nbsp;&nbsp;Configuring the <tt>lx</tt> Branded Zone (Tasks)</a></p>
<p class="toc level2"><a href="gdbki.html">32.&nbsp;&nbsp;About Installing, Booting, Halting, Cloning, and Uninstalling <tt>lx</tt> Branded Zones (Overview)</a></p>
<p class="toc level2"><a href="gdduh.html">33.&nbsp;&nbsp;Installing, Booting, Halting, Uninstalling and Cloning <tt>lx</tt> Branded Zones (Tasks)</a></p>
<p class="toc level2"><a href="gdgck.html">34.&nbsp;&nbsp;Logging In to <tt>lx</tt> Branded Zones (Tasks)</a></p>
<p class="toc level2"><a href="gdqnv.html">35.&nbsp;&nbsp;Moving and Migrating <tt>lx</tt> Branded Zones (Tasks)</a></p>
<p class="toc level2"><a href="gdgif.html">36.&nbsp;&nbsp;Administering and Running Applications in <tt>lx</tt> Branded Zones (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="gefwp.html">Part&nbsp;IV&nbsp;Sun xVM</a></p>
<p class="toc level2"><a href="gfwrc.html">37.&nbsp;&nbsp;Sun xVM Hypervisor System Requirements</a></p>
<p class="toc level2"><a href="gefwo.html">38.&nbsp;&nbsp;Booting and Running the Sun xVM Hypervisor</a></p>
<p class="toc level2"><a href="gfwcu.html">39.&nbsp;&nbsp;Xvnc</a></p>
<p class="toc level2"><a href="gfqke.html">40.&nbsp;&nbsp;Using <tt>virt-install</tt> to Install a Domain</a></p>
<p class="toc level2"><a href="gfwlm.html">41.&nbsp;&nbsp;xVM System Administration</a></p>
<p class="toc level2"><a href="gefzh.html">42.&nbsp;&nbsp;Troubleshooting Miscellaneous Sun xVM Problems</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="rm.rcapd.task-19"></a><h3>Producing Reports With <tt>rcapstat</tt></h3>
<p>Use <tt>rcapstat</tt> to report resource capping statistics. <a href="rm.rcapd-22.html">Monitoring Resource Utilization With <tt>rcapstat</tt></a> explains how to use the
<tt>rcapstat</tt> command to generate reports. That section also describes the column headings in
the report. The <a href="http://docs.sun.com/doc/819-2239/rcapstat-1?a=view"><tt>rcapstat</tt>(1)</a> man page also contains this information.</p><p>The following subsections use examples to illustrate how to produce reports for specific
purposes.</p>

<a name="rm.rcapd.task-20"></a><h4>Reporting Cap and Project Information</h4>
<p>In this example, caps are defined for two projects associated with two users.
<tt>user1</tt> has a cap of 50 megabytes, and <tt>user2</tt> has a cap of
10 megabytes.</p><p>The following command produces five reports at 5-second sampling intervals.</p><pre>user1machine% <tt><b>rcapstat 5 5</b></tt>
    id project  nproc     vm    rss   cap    at avgat    pg avgpg
112270   user1     24   123M    35M   50M   50M    0K 3312K    0K
 78194   user2      1  2368K  1856K   10M    0K    0K    0K    0K
    id project  nproc     vm    rss   cap    at avgat    pg avgpg
112270   user1     24   123M    35M   50M    0K    0K    0K    0K
 78194   user2      1  2368K  1856K   10M    0K    0K    0K    0K
    id project  nproc     vm    rss   cap    at avgat    pg avgpg
112270   user1     24   123M    35M   50M    0K    0K    0K    0K
 78194   user2      1  2368K  1928K   10M    0K    0K    0K    0K
    id project  nproc     vm    rss   cap    at avgat    pg avgpg
112270   user1     24   123M    35M   50M    0K    0K    0K    0K
 78194   user2      1  2368K  1928K   10M    0K    0K    0K    0K
    id project  nproc     vm    rss   cap    at avgat    pg avgpg
112270   user1     24   123M    35M   50M    0K    0K    0K    0K
 78194   user2      1  2368K  1928K   10M    0K    0K    0K    0K </pre><p>The first three lines of output constitute the first report, which contains the
cap and project information for the two projects and paging statistics since <tt>rcapd</tt>
was started. The <tt>at</tt> and <tt>pg</tt> columns are a number greater than
zero for <tt>user1</tt> and zero for <tt>user2</tt>, which indicates that at some time
in the daemon's history, <tt>user1</tt> exceeded its cap but <tt>user2</tt> did not.</p><p>The subsequent reports show no significant activity.</p>

<a name="rm.rcapd.task-21"></a><h4>Monitoring the RSS of a Project</h4>
<p>The following example uses project <tt>user1</tt>, which has an RSS in excess of
its RSS cap.</p><p>The following command produces five reports at 5-second sampling intervals.</p><pre>user1machine% <tt><b>rcapstat 5 5</b></tt></pre><pre>    id project  nproc    vm   rss   cap    at avgat     pg  avgpg
376565   user1      3 6249M 6144M 6144M  690M  220M  5528K  2764K
376565   user1      3 6249M 6144M 6144M    0M  131M  4912K  1637K
376565   user1      3 6249M 6171M 6144M   27M  147M  6048K  2016K
376565   user1      3 6249M 6146M 6144M 4872M  174M  4368K  1456K
376565   user1      3 6249M 6156M 6144M   12M  161M  3376K  1125K</pre><p>The <tt>user1</tt> project has three processes that are actively using physical memory. The
positive values in the <tt>pg</tt> column indicate that <tt>rcapd</tt> is consistently paging out
memory as it attempts to meet the cap by lowering the physical memory
utilization of the project's processes. However, <tt>rcapd</tt> does not succeed in keeping the RSS
below the cap value. This is indicated by the varying <tt>rss</tt> values
that do not show a corresponding decrease. As soon as memory is paged
out, the workload uses it again and the RSS count goes back up.
This means that all of the project's resident memory is being actively used
and the working set size (<b>WSS</b>) is greater than the cap. Thus, <tt>rcapd</tt>
is forced to page out some of the working set to meet the
cap. Under this condition, the system will continue to experience high page fault
rates, and associated I/O, until one of the following occurs:</p>
<ul><li><p>The WSS becomes smaller.</p></li>
<li><p>The cap is raised.</p></li>
<li><p>The application changes its memory access pattern.</p></li></ul>
<p>In this situation, shortening the sample interval might reduce the discrepancy between the
RSS value and the cap value by causing <tt>rcapd</tt> to sample the workload
and enforce caps more frequently.</p>
<hr><p><b>Note - </b>A page fault occurs when either a new page must be created
or the system must copy in a page from a swap device.</p>
<hr>


<a name="rm.rcapd.task-22"></a><h4>Determining the Working Set Size of a Project</h4>
<p>The following example is a continuation of the previous example, and it uses
the same project.</p><p>The previous example shows that the <tt>user1</tt> project is using more physical memory
than its cap allows. This example shows how much memory the project workload
requires.</p><pre>user1machine% <tt><b>rcapstat 5 5</b></tt>
    id project  nproc    vm   rss   cap    at avgat     pg  avgpg
376565   user1      3 6249M 6144M 6144M  690M    0K   689M     0K
376565   user1      3 6249M 6144M 6144M    0K    0K     0K     0K
376565   user1      3 6249M 6171M 6144M   27M    0K    27M     0K
376565   user1      3 6249M 6146M 6144M 4872K    0K  4816K     0K
376565   user1      3 6249M 6156M 6144M   12M    0K    12M     0K
376565   user1      3 6249M 6150M 6144M 5848K    0K  5816K     0K
376565   user1      3 6249M 6155M 6144M   11M    0K    11M     0K
376565   user1      3 6249M 6150M   10G   32K    0K    32K     0K
376565   user1      3 6249M 6214M   10G    0K    0K     0K     0K
376565   user1      3 6249M 6247M   10G    0K    0K     0K     0K
376565   user1      3 6249M 6247M   10G    0K    0K     0K     0K
376565   user1      3 6249M 6247M   10G    0K    0K     0K     0K
376565   user1      3 6249M 6247M   10G    0K    0K     0K     0K
376565   user1      3 6249M 6247M   10G    0K    0K     0K     0K
376565   user1      3 6249M 6247M   10G    0K    0K     0K     0K</pre><p>Halfway through the cycle, the cap on the <tt>user1</tt> project was increased from
6 Gbytes to 10 Gbytes. This increase stops cap enforcement and allows the
resident set size to grow, limited only by other processes and the amount
of memory in the machine. The <tt>rss</tt> column might stabilize to reflect the
project working set size (WSS), 6247M in this example. This is the minimum
cap value that allows the project's processes to operate without continuously incurring page
faults.</p><p>While the cap on <tt>user1</tt> is 6 Gbytes, in every 5&ndash;second sample interval
the RSS decreases and I/O increases as <tt>rcapd</tt> pages out some of the
workload's memory. Shortly after a page out completes, the workload, needing those pages,
pages them back in as it continues running. This cycle repeats until the
cap is raised to 10 Gbytes, approximately halfway through the example. The RSS
then stabilizes at 6.1 Gbytes. Since the workload's RSS is now below the
cap, no more paging occurs. The I/O associated with paging stops as well.
Thus, the project required 6.1 Gbytes to perform the work it was doing
at the time it was being observed.</p><p>Also see the <a href="http://docs.sun.com/doc/819-2240/vmstat-1m?a=view"><tt>vmstat</tt>(1M)</a> and <a href="http://docs.sun.com/doc/819-2240/iostat-1m?a=view"><tt>iostat</tt>(1M)</a> man pages.</p>

<a name="rm.rcapd.task-23"></a><h4>Reporting Memory Utilization and the Memory Cap Enforcement Threshold</h4>
<p>You can use the <tt>-g</tt> option of <tt>rcapstat</tt> to report the following:</p>
<ul><li><p>Current physical memory utilization as a percentage of physical memory installed on the system</p></li>
<li><p>System memory cap enforcement threshold set by <tt>rcapadm</tt></p></li></ul>
<p>The <tt>-g</tt> option causes a memory utilization and cap enforcement line to be
printed at the end of the report for each interval.</p><pre># <tt><b>rcapstat -g</b></tt>
    id project   nproc    vm   rss   cap    at avgat   pg  avgpg
376565    rcap       0    0K    0K   10G    0K    0K   0K     0K
physical memory utilization: 55%   cap enforcement threshold: 0%
    id project   nproc    vm   rss   cap    at avgat   pg  avgpg
376565    rcap       0    0K    0K   10G    0K    0K   0K     0K
physical memory utilization: 55%   cap enforcement threshold: 0%</pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="rm.rcapd.task-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="rmpool-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

