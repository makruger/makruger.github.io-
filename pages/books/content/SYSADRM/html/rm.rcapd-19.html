<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title><tt>rcapd</tt> Configuration - System Administration Guide:  Virtualization Using the Solaris Operating System</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-04-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide:  Virtualization Using the Solaris Operating System</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="rm.rcapd-4.html">Previous</a>
             </td>
             <td align="right">
                 <a href="rm.rcapd-22.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="preface-3.html">Solaris Virtualization Product Overview</a></p>
<p class="toc level1 tocsp"><a href="resource.html">Part&nbsp;I&nbsp;Resource Management</a></p>
<p class="toc level2"><a href="rmintro-1.html">1.&nbsp;&nbsp;Introduction to Solaris Resource Management</a></p>
<p class="toc level2"><a href="rmtaskproj-1.html">2.&nbsp;&nbsp;Projects and Tasks (Overview)</a></p>
<p class="toc level2"><a href="rmtaskproj.task-37.html">3.&nbsp;&nbsp;Administering Projects and Tasks</a></p>
<p class="toc level2"><a href="rmacct-1.html">4.&nbsp;&nbsp;Extended Accounting (Overview)</a></p>
<p class="toc level2"><a href="rmacct.task.sgm.html">5.&nbsp;&nbsp;Administering Extended Accounting (Tasks)</a></p>
<p class="toc level2"><a href="rmctrls-1.html">6.&nbsp;&nbsp;Resource Controls (Overview)</a></p>
<p class="toc level2"><a href="rmctrls.task-1.html">7.&nbsp;&nbsp;Administering Resource Controls (Tasks)</a></p>
<p class="toc level2"><a href="rmfss-1.html">8.&nbsp;&nbsp;Fair Share Scheduler (Overview)</a></p>
<p class="toc level2"><a href="rmfss.task-1.html">9.&nbsp;&nbsp;Administering the Fair Share Scheduler (Tasks)</a></p>
<p class="toc level2"><a href="rm.rcapd-1.html">10.&nbsp;&nbsp;Physical Memory Control Using the Resource Capping Daemon (Overview)</a></p>
<p class="toc level3"><a href="rm.rcapd-2.html">Introduction to the Resource Capping Daemon</a></p>
<p class="toc level3"><a href="rm.rcapd-3.html">How Resource Capping Works</a></p>
<p class="toc level3"><a href="rm.rcapd-4.html">Attribute to Limit Physical Memory Usage</a></p>
<div class="onpage">
<p class="toc level3"><a href=""><tt>rcapd</tt> Configuration</a></p>
</div>
<p class="toc level3"><a href="rm.rcapd-22.html">Monitoring Resource Utilization With <tt>rcapstat</tt></a></p>
<p class="toc level3"><a href="rm.rcapd-43.html">Commands Used With <tt>rcapd</tt></a></p>
<p class="toc level2 tocsp"><a href="rm.rcapd.task-1.html">11.&nbsp;&nbsp;Administering the Resource Capping Daemon (Tasks)</a></p>
<p class="toc level2"><a href="rmpool-1.html">12.&nbsp;&nbsp;Resource Pools (Overview)</a></p>
<p class="toc level2"><a href="rmpool.task-1.html">13.&nbsp;&nbsp;Creating and Administering Resource Pools (Tasks)</a></p>
<p class="toc level2"><a href="rmconfig-1.html">14.&nbsp;&nbsp;Resource Management Configuration Example</a></p>
<p class="toc level2"><a href="rmconsole-1.html">15.&nbsp;&nbsp;Resource Control Functionality in the Solaris Management Console</a></p>
<p class="toc level1 tocsp"><a href="zone.html">Part&nbsp;II&nbsp;Zones</a></p>
<p class="toc level2"><a href="zones.intro-1.html">16.&nbsp;&nbsp;Introduction to Solaris Zones</a></p>
<p class="toc level2"><a href="z.config.ov-1.html">17.&nbsp;&nbsp;Non-Global Zone Configuration (Overview)</a></p>
<p class="toc level2"><a href="z.conf.start-1.html">18.&nbsp;&nbsp;Planning and Configuring Non-Global Zones (Tasks)</a></p>
<p class="toc level2"><a href="z.inst.ov-1.html">19.&nbsp;&nbsp;About Installing, Halting, Cloning, and Uninstalling Non-Global Zones (Overview)</a></p>
<p class="toc level2"><a href="z.inst.task-1.html">20.&nbsp;&nbsp;Installing, Booting, Halting, Uninstalling,  and Cloning Non-Global Zones (Tasks)</a></p>
<p class="toc level2"><a href="z.login.ov-1.html">21.&nbsp;&nbsp;Non-Global Zone Login (Overview)</a></p>
<p class="toc level2"><a href="z.login.task-1.html">22.&nbsp;&nbsp;Logging In to Non-Global Zones (Tasks)</a></p>
<p class="toc level2"><a href="gcgnc.html">23.&nbsp;&nbsp;Moving and Migrating Non-Global Zones (Tasks)</a></p>
<p class="toc level2"><a href="z.pkginst.ov-1.html">24.&nbsp;&nbsp;About Packages and Patches on a Solaris System With Zones Installed (Overview)</a></p>
<p class="toc level2"><a href="z.pkginst.task-1.html">25.&nbsp;&nbsp;Adding and Removing Packages and Patches on a Solaris System With Zones Installed (Tasks)</a></p>
<p class="toc level2"><a href="z.admin.ov-1.html">26.&nbsp;&nbsp;Solaris Zones Administration (Overview)</a></p>
<p class="toc level2"><a href="z.admin.task-1.html">27.&nbsp;&nbsp;Administering Solaris Zones (Tasks)</a></p>
<p class="toc level2"><a href="gclkx.html">28.&nbsp;&nbsp;Troubleshooting Miscellaneous Solaris Zones Problems</a></p>
<p class="toc level1 tocsp"><a href="gchhk.html">Part&nbsp;III&nbsp;Branded Zones</a></p>
<p class="toc level2"><a href="gchhy.html">29.&nbsp;&nbsp;About Branded Zones and the Linux Branded Zone</a></p>
<p class="toc level2"><a href="gcwwm.html">30.&nbsp;&nbsp;Planning the <tt>lx</tt> Branded Zone Configuration (Overview)</a></p>
<p class="toc level2"><a href="gdajn.html">31.&nbsp;&nbsp;Configuring the <tt>lx</tt> Branded Zone (Tasks)</a></p>
<p class="toc level2"><a href="gdbki.html">32.&nbsp;&nbsp;About Installing, Booting, Halting, Cloning, and Uninstalling <tt>lx</tt> Branded Zones (Overview)</a></p>
<p class="toc level2"><a href="gdduh.html">33.&nbsp;&nbsp;Installing, Booting, Halting, Uninstalling and Cloning <tt>lx</tt> Branded Zones (Tasks)</a></p>
<p class="toc level2"><a href="gdgck.html">34.&nbsp;&nbsp;Logging In to <tt>lx</tt> Branded Zones (Tasks)</a></p>
<p class="toc level2"><a href="gdqnv.html">35.&nbsp;&nbsp;Moving and Migrating <tt>lx</tt> Branded Zones (Tasks)</a></p>
<p class="toc level2"><a href="gdgif.html">36.&nbsp;&nbsp;Administering and Running Applications in <tt>lx</tt> Branded Zones (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="gefwp.html">Part&nbsp;IV&nbsp;Sun xVM</a></p>
<p class="toc level2"><a href="gfwrc.html">37.&nbsp;&nbsp;Sun xVM Hypervisor System Requirements</a></p>
<p class="toc level2"><a href="gefwo.html">38.&nbsp;&nbsp;Booting and Running the Sun xVM Hypervisor</a></p>
<p class="toc level2"><a href="gfwcu.html">39.&nbsp;&nbsp;Xvnc</a></p>
<p class="toc level2"><a href="gfqke.html">40.&nbsp;&nbsp;Using <tt>virt-install</tt> to Install a Domain</a></p>
<p class="toc level2"><a href="gfwlm.html">41.&nbsp;&nbsp;xVM System Administration</a></p>
<p class="toc level2"><a href="gefzh.html">42.&nbsp;&nbsp;Troubleshooting Miscellaneous Sun xVM Problems</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="rm.rcapd-19"></a><h3><tt>rcapd</tt> Configuration</h3>
<p><a name="indexterm-77"></a><a name="indexterm-78"></a><a name="indexterm-79"></a>You use the <tt>rcapadm</tt> command to configure the resource capping daemon. You can
perform the following actions:</p>
<ul><li><p>Set the threshold value for cap enforcement</p></li>
<li><p>Set intervals for the operations performed by <tt>rcapd</tt></p></li>
<li><p>Enable or disable resource capping</p></li>
<li><p>Display the current status of the configured resource capping daemon</p></li></ul>
<p>To configure the daemon, you must have superuser privileges or have the Process
Management profile in your list of profiles. The System Administrator role includes the
Process Management profile.</p><p>Configuration changes can be incorporated into <tt>rcapd</tt> according to the configuration interval (see
<a href="#rm.rcapd-21"><tt>rcapd</tt> Operation Intervals</a>) or on demand by sending a <tt>SIGHUP</tt> (see the <tt>kill</tt>(1) man page).</p><p>If used without arguments, <tt>rcapadm</tt> displays the current status of the resource capping
daemon if it has been configured.</p><p>The following subsections discuss cap enforcement, cap values, and <tt>rcapd</tt> operation intervals.</p>

<a name="fpjwn"></a><h4>Using the Resource Capping Daemon on a System With Zones Installed</h4>
<p>You can control resident set size (RSS) usage of a zone by
setting the <tt>capped-memory</tt> resource when you configure the zone. For more information, see
<a href="z.config.ov-3.html#gejkz">Physical Memory Control and the <tt>capped-memory</tt> Resource</a>. You can run <tt>rcapd</tt> <b>in</b> a zone, including the global zone, to
enforce memory caps on projects in that zone.</p><p>If you are using <tt>rcapd</tt> on a zone to regulate physical memory consumption
by processes running in projects that have resource caps defined, you must configure
the daemon in those zones.</p><p>When choosing memory caps for applications in different zones, you generally do not
have to consider that the applications reside in different zones. The exception is
per-zone services. Per-zone services consume memory. This memory consumption must be considered when
determining the amount of physical memory for a system, as well as memory
caps.</p>
<hr><p><b>Note - </b>You cannot run <tt>rcapd</tt> in an <tt>lx</tt> branded zone. However, you can use
the daemon from the global zone to cap memory in the branded zone.</p>
<hr>


<a name="rm.rcapd-17"></a><h4>Memory Cap Enforcement Threshold</h4>
<p><a name="indexterm-80"></a>The <b>memory cap enforcement threshold</b> is the percentage of physical memory utilization on the system that
triggers cap enforcement. When the system exceeds this utilization, caps are enforced. The
physical memory used by applications and the kernel is included in this percentage.
The percentage of utilization determines the way in which memory caps are enforced.</p><p>To enforce caps, memory can be paged out from project workloads.</p>
<ul><li><p>Memory can be paged out to reduce the size of the portion of memory that is over its cap for a given workload.</p></li>
<li><p>Memory can be paged out to reduce the proportion of physical memory used that is over the memory cap enforcement threshold on the system.</p></li></ul>
<p>A workload is permitted to use physical memory up to its cap.
A workload can use additional memory as long as the system's memory utilization
stays below the memory cap enforcement threshold.</p><p>To set the value for cap enforcement, see <a href="rm.rcapd.task-2.html#rm.rcapd.task-3">How to Set the Memory Cap Enforcement Threshold</a>.</p>

<a name="rm.rcapd-25"></a><h4>Determining Cap Values</h4>
<p>If a project cap is set too low, there might not be
enough memory for the workload to proceed effectively under normal conditions. The paging
that occurs because the workload requires more memory has a negative effect on system
performance.</p><p>Projects that have caps set too high can consume available physical memory before
their caps are exceeded. In this case, physical memory is effectively managed by
the kernel and not by <tt>rcapd</tt>.</p><p>In determining caps on projects, consider these factors.</p><dl><dt>Impact on I/O system</dt>
<dd><p>The daemon can attempt to reduce a project workload's physical memory usage whenever the sampled usage exceeds the project's cap. During cap enforcement, the swap devices and other devices that contain files that the workload has mapped are used. The performance of the swap devices is a critical factor in determining the performance of a workload that routinely exceeds its cap. The execution of the workload is similar to running it on a machine with the same amount of physical memory as the workload's cap.</p></dd>
<dt>Impact on CPU usage</dt>
<dd><p>The daemon's CPU usage varies with the number of processes in the project workloads it is capping and the sizes of the workloads' address spaces.</p><p>A small portion of the daemon's CPU time is spent sampling the usage of each workload. Adding processes to workloads increases the time spent sampling usage.</p><p>Another portion of the daemon's CPU time is spent enforcing caps when they are exceeded. The time spent is proportional to the amount of virtual memory involved. CPU time spent increases or decreases in response to corresponding changes in the total size of a workload's address space. This information is reported in the <tt>vm</tt> column of <tt>rcapstat</tt> output. See <a href="rm.rcapd-22.html">Monitoring Resource Utilization With <tt>rcapstat</tt></a> and the <a href="http://docs.sun.com/doc/819-2239/rcapstat-1?a=view"><tt>rcapstat</tt>(1)</a> man page for more information.</p></dd>
<dt>Reporting on shared memory</dt>
<dd><p>The <tt>rcapd</tt> daemon reports the RSS of pages of memory that are shared with other processes or mapped multiple times within the same process as a reasonably accurate estimate. If processes in different projects share the same memory, then that memory will be counted towards the RSS total for all projects sharing the memory.</p><p>The estimate is usable with workloads such as databases, which utilize shared memory extensively. For database workloads, you can also sample a project's regular usage to determine a suitable initial cap value by using output from the <tt>-J</tt> or <tt>-Z</tt> options of the <tt>prstat</tt> command. For more information, see the <a href="http://docs.sun.com/doc/819-2240/prstat-1m?a=view"><tt>prstat</tt>(1M)</a> man page.</p></dd>
</dl>


<a name="rm.rcapd-21"></a><h4><tt>rcapd</tt> Operation Intervals</h4>
<p>You can tune the intervals for the periodic operations performed by <tt>rcapd</tt>.</p><p>All intervals are specified in seconds. The <tt>rcapd</tt> operations and their default interval
values are described in the following table.</p><table><col width="33*"><col width="33*"><col width="33*"><tr><th align="left" valign="top" scope="column"><p>Operation</p></th>
<th align="left" valign="top" scope="column"><p>Default Interval Value in Seconds</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>scan</tt></p></td>
<td align="left" valign="top" scope="row"><p>15</p></td>
<td align="left" valign="top" scope="row"><p>Number of
seconds between scans for processes that have joined or left a project workload.
Minimum value is 1 second.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>sample</tt></p></td>
<td align="left" valign="top" scope="row"><p>5</p></td>
<td align="left" valign="top" scope="row"><p>Number of seconds between samplings of resident set
size and subsequent cap enforcements. Minimum value is 1 second.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>report</tt></p></td>
<td align="left" valign="top" scope="row"><p>5 </p></td>
<td align="left" valign="top" scope="row"><p>Number of seconds
between updates to paging statistics. If set to <tt>0</tt>, statistics are not
updated, and output from <tt>rcapstat</tt> is not current.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>config</tt></p></td>
<td align="left" valign="top" scope="row"><p>60</p></td>
<td align="left" valign="top" scope="row"><p>Number of seconds between reconfigurations. In
a reconfiguration event, <tt>rcapadm</tt> reads the configuration file for updates, and scans
the <tt>project</tt> database for new or revised project caps. Sending a <tt>SIGHUP</tt>
to <tt>rcapd</tt> causes an immediate reconfiguration.</p></td>
</tr>
</table><p>To tune intervals, see <a href="rm.rcapd.task-2.html#rm.rcapd.task-6">How to Set Operation Intervals</a>.</p>

<a name="rm.rcapd-24"></a><h5>Determining <tt>rcapd</tt> Scan Intervals</h5>
<p><a name="indexterm-81"></a>The scan interval controls how often <tt>rcapd</tt> looks for new processes. On
systems with many processes running, the scan through the list takes more time,
so it might be preferable to lengthen the interval in order to reduce
the overall CPU time spent. However, the scan interval also represents the minimum
amount of time that a process must exist to be attributed to a
capped workload. If there are workloads that run many short-lived processes, <tt>rcapd</tt> might
not attribute the processes to a workload if the scan interval is lengthened.</p>

<a name="rm.rcapd-23"></a><h5>Determining Sample Intervals</h5>
<p><a name="indexterm-82"></a>The sample interval configured with <tt>rcapadm</tt> is the shortest amount of time
<tt>rcapd</tt> waits between sampling a workload's usage and enforcing the cap if it
is exceeded. If you reduce this interval, <tt>rcapd</tt> will, under most conditions, enforce caps
more frequently, possibly resulting in increased I/O due to paging. However, a shorter
sample interval can also lessen the impact  that a sudden increase in
a particular workload's physical memory usage might have on other workloads. The window
between samplings, in which the workload can consume memory unhindered and possibly take
memory from other capped workloads, is narrowed.</p><p>If the sample interval specified to <tt>rcapstat</tt> is shorter than the interval specified
to <tt>rcapd</tt> with <tt>rcapadm</tt>, the output for some intervals can be zero. This
situation occurs because <tt>rcapd</tt> does not update statistics more frequently than the
interval specified with <tt>rcapadm</tt>. The interval specified with <tt>rcapadm</tt> is independent of the
sampling interval used by <tt>rcapstat</tt>.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="rm.rcapd-4.html">Previous</a>
             </td>
             <td align="right">
                 <a href="rm.rcapd-22.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

