<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Migrating an <tt>lx</tt> Branded Zone to a Different Machine - System Administration Guide:  Virtualization Using the Solaris Operating System</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-04-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide:  Virtualization Using the Solaris Operating System</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="gentextid-20513.html">Previous</a>
             </td>
             <td align="right">
                 <a href="gdgif.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="preface-3.html">Solaris Virtualization Product Overview</a></p>
<p class="toc level1 tocsp"><a href="resource.html">Part&nbsp;I&nbsp;Resource Management</a></p>
<p class="toc level2"><a href="rmintro-1.html">1.&nbsp;&nbsp;Introduction to Solaris Resource Management</a></p>
<p class="toc level2"><a href="rmtaskproj-1.html">2.&nbsp;&nbsp;Projects and Tasks (Overview)</a></p>
<p class="toc level2"><a href="rmtaskproj.task-37.html">3.&nbsp;&nbsp;Administering Projects and Tasks</a></p>
<p class="toc level2"><a href="rmacct-1.html">4.&nbsp;&nbsp;Extended Accounting (Overview)</a></p>
<p class="toc level2"><a href="rmacct.task.sgm.html">5.&nbsp;&nbsp;Administering Extended Accounting (Tasks)</a></p>
<p class="toc level2"><a href="rmctrls-1.html">6.&nbsp;&nbsp;Resource Controls (Overview)</a></p>
<p class="toc level2"><a href="rmctrls.task-1.html">7.&nbsp;&nbsp;Administering Resource Controls (Tasks)</a></p>
<p class="toc level2"><a href="rmfss-1.html">8.&nbsp;&nbsp;Fair Share Scheduler (Overview)</a></p>
<p class="toc level2"><a href="rmfss.task-1.html">9.&nbsp;&nbsp;Administering the Fair Share Scheduler (Tasks)</a></p>
<p class="toc level2"><a href="rm.rcapd-1.html">10.&nbsp;&nbsp;Physical Memory Control Using the Resource Capping Daemon (Overview)</a></p>
<p class="toc level2"><a href="rm.rcapd.task-1.html">11.&nbsp;&nbsp;Administering the Resource Capping Daemon (Tasks)</a></p>
<p class="toc level2"><a href="rmpool-1.html">12.&nbsp;&nbsp;Resource Pools (Overview)</a></p>
<p class="toc level2"><a href="rmpool.task-1.html">13.&nbsp;&nbsp;Creating and Administering Resource Pools (Tasks)</a></p>
<p class="toc level2"><a href="rmconfig-1.html">14.&nbsp;&nbsp;Resource Management Configuration Example</a></p>
<p class="toc level2"><a href="rmconsole-1.html">15.&nbsp;&nbsp;Resource Control Functionality in the Solaris Management Console</a></p>
<p class="toc level1 tocsp"><a href="zone.html">Part&nbsp;II&nbsp;Zones</a></p>
<p class="toc level2"><a href="zones.intro-1.html">16.&nbsp;&nbsp;Introduction to Solaris Zones</a></p>
<p class="toc level2"><a href="z.config.ov-1.html">17.&nbsp;&nbsp;Non-Global Zone Configuration (Overview)</a></p>
<p class="toc level2"><a href="z.conf.start-1.html">18.&nbsp;&nbsp;Planning and Configuring Non-Global Zones (Tasks)</a></p>
<p class="toc level2"><a href="z.inst.ov-1.html">19.&nbsp;&nbsp;About Installing, Halting, Cloning, and Uninstalling Non-Global Zones (Overview)</a></p>
<p class="toc level2"><a href="z.inst.task-1.html">20.&nbsp;&nbsp;Installing, Booting, Halting, Uninstalling,  and Cloning Non-Global Zones (Tasks)</a></p>
<p class="toc level2"><a href="z.login.ov-1.html">21.&nbsp;&nbsp;Non-Global Zone Login (Overview)</a></p>
<p class="toc level2"><a href="z.login.task-1.html">22.&nbsp;&nbsp;Logging In to Non-Global Zones (Tasks)</a></p>
<p class="toc level2"><a href="gcgnc.html">23.&nbsp;&nbsp;Moving and Migrating Non-Global Zones (Tasks)</a></p>
<p class="toc level2"><a href="z.pkginst.ov-1.html">24.&nbsp;&nbsp;About Packages and Patches on a Solaris System With Zones Installed (Overview)</a></p>
<p class="toc level2"><a href="z.pkginst.task-1.html">25.&nbsp;&nbsp;Adding and Removing Packages and Patches on a Solaris System With Zones Installed (Tasks)</a></p>
<p class="toc level2"><a href="z.admin.ov-1.html">26.&nbsp;&nbsp;Solaris Zones Administration (Overview)</a></p>
<p class="toc level2"><a href="z.admin.task-1.html">27.&nbsp;&nbsp;Administering Solaris Zones (Tasks)</a></p>
<p class="toc level2"><a href="gclkx.html">28.&nbsp;&nbsp;Troubleshooting Miscellaneous Solaris Zones Problems</a></p>
<p class="toc level1 tocsp"><a href="gchhk.html">Part&nbsp;III&nbsp;Branded Zones</a></p>
<p class="toc level2"><a href="gchhy.html">29.&nbsp;&nbsp;About Branded Zones and the Linux Branded Zone</a></p>
<p class="toc level2"><a href="gcwwm.html">30.&nbsp;&nbsp;Planning the <tt>lx</tt> Branded Zone Configuration (Overview)</a></p>
<p class="toc level2"><a href="gdajn.html">31.&nbsp;&nbsp;Configuring the <tt>lx</tt> Branded Zone (Tasks)</a></p>
<p class="toc level2"><a href="gdbki.html">32.&nbsp;&nbsp;About Installing, Booting, Halting, Cloning, and Uninstalling <tt>lx</tt> Branded Zones (Overview)</a></p>
<p class="toc level2"><a href="gdduh.html">33.&nbsp;&nbsp;Installing, Booting, Halting, Uninstalling and Cloning <tt>lx</tt> Branded Zones (Tasks)</a></p>
<p class="toc level2"><a href="gdgck.html">34.&nbsp;&nbsp;Logging In to <tt>lx</tt> Branded Zones (Tasks)</a></p>
<p class="toc level2"><a href="gdqnv.html">35.&nbsp;&nbsp;Moving and Migrating <tt>lx</tt> Branded Zones (Tasks)</a></p>
<p class="toc level3"><a href="gentextid-20513.html">Moving an <tt>lx</tt> Branded Zone</a></p>
<p class="toc level4"><a href="gentextid-20513.html#gdqsp">How to Move a Zone</a></p>
<div class="onpage">
<p class="toc level3 tocsp"><a href="">Migrating an <tt>lx</tt> Branded Zone to a Different Machine</a></p>
<p class="toc level4"><a href="#gdqtd">How to Migrate an <tt>lx</tt> Branded Zone</a></p>
<p class="toc level4"><a href="#gdqse">How to Move the <tt>zonepath</tt> to a new Host</a></p>
<p class="toc level4"><a href="#gdqsm">How to Validate an <tt>lx</tt> Branded Zone Migration Before the Migration Is  Performed</a></p>
</div>
<p class="toc level2 tocsp"><a href="gdgif.html">36.&nbsp;&nbsp;Administering and Running Applications in <tt>lx</tt> Branded Zones (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="gefwp.html">Part&nbsp;IV&nbsp;Sun xVM</a></p>
<p class="toc level2"><a href="gfwrc.html">37.&nbsp;&nbsp;Sun xVM Hypervisor System Requirements</a></p>
<p class="toc level2"><a href="gefwo.html">38.&nbsp;&nbsp;Booting and Running the Sun xVM Hypervisor</a></p>
<p class="toc level2"><a href="gfwcu.html">39.&nbsp;&nbsp;Xvnc</a></p>
<p class="toc level2"><a href="gfqke.html">40.&nbsp;&nbsp;Using <tt>virt-install</tt> to Install a Domain</a></p>
<p class="toc level2"><a href="gfwlm.html">41.&nbsp;&nbsp;xVM System Administration</a></p>
<p class="toc level2"><a href="gefzh.html">42.&nbsp;&nbsp;Troubleshooting Miscellaneous Sun xVM Problems</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="gdqsr"></a><h3>Migrating an <tt>lx</tt> Branded Zone to a Different Machine</h3>
<p>You can do a trial run of a zone migration before you
actually move the zone to a different machine. For more information, see <a href="gentextid-12247.html#gcxfx">About Validating a Zone Migration Before the Migration Is  Performed</a>.</p><p>Note that the trial run does not validate the processor type, so
you must verify that the target machine is running a supported processor.</p>

<a name="gdqsz"></a><h4>About Migrating an <tt>lx</tt> Branded Zone</h4>
<p><a name="indexterm-437"></a><a name="indexterm-438"></a>The <tt>zonecfg</tt> and <tt>zoneadm</tt> commands can be used to migrate an existing
non-global zone from one system to another. The zone is halted and detached
from its current host. The <tt>zonepath</tt> is moved to the target host, where
it is attached.</p><p>The following requirements apply to <tt>lx</tt> branded zone migration:</p>
<ul><li><p>The global zone on the target system must be running the same Solaris release as the original host.</p></li>
<li><p>To ensure that the zone will run properly, the target system must have the same versions of the required operating system packages and patches that were installed on the original host.</p></li>
<li><p>The brand must be the same on the original host and on the target system.</p></li>
<li><p>The target system must have one of the following supported i686 processor types:</p>
<ul><li><p>Intel</p>
<ul><li><p>Pentium Pro</p></li>
<li><p>Pentium II</p></li>
<li><p>Pentium III</p></li>
<li><p>Celeron</p></li>
<li><p>Xeon</p></li>
<li><p>Pentium 4</p></li>
<li><p>Pentium M</p></li>
<li><p>Pentium D</p></li>
<li><p>Pentium Extreme Edition</p></li>
<li><p>Core</p></li>
<li><p>Core 2</p></li></ul>
<p>AMD</p>
<ul><li><p>Opteron</p></li>
<li><p>Athlon XP</p></li>
<li><p>Athlon 64</p></li>
<li><p>Athlon 64 X2</p></li>
<li><p>Athlon FX</p></li>
<li><p>Duron</p></li>
<li><p>Sempron</p></li>
<li><p>Turion 64</p></li>
<li><p>Turion 64 X2</p></li></ul>
</li></ul>
</li></ul>
<p>The <tt>zoneadm</tt> <tt>detach</tt> process creates the information necessary to attach the zone on
a different system. The <tt>zoneadm</tt> <tt>attach</tt> process verifies that the target machine has
the correct configuration to host the zone. Because there are several ways to
make the <tt>zonepath</tt> available on the new host, the actual movement of the
<tt>zonepath</tt> from one system to another is a manual process that is performed
by the global administrator.</p><p>When attached to the new system, the zone is in the installed
state.</p>

<a name="gdqtd"></a><h4>How to Migrate an <tt>lx</tt> Branded Zone</h4><ol>
<li><b>Become superuser, or assume the Primary Administrator role.</b><p>To create the role and assign the role to a user, see
<a href="http://docs.sun.com/doc/819-2379/smcover-95?a=view">Using the Solaris Management Tools With RBAC (Task Map) in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><b>Halt the zone to be migrated, <tt>lx-zone</tt> in this procedure.</b><pre>host1# <tt><b>zoneadm -z lx-zone halt</b></tt></pre></li>
<li><b>Detach the zone.</b><pre>host1# <tt><b>zoneadm -z lx-zone detach</b></tt></pre><p>The detached zone is now in the configured state.</p></li>
<li><b>Move the <tt>zonepath</tt> for <tt>lx-zone</tt> to the new host.</b><p>See <a href="#gdqse">How to Move the <tt>zonepath</tt> to a new Host</a> for more information.</p></li>
<li><b>On the new host, configure the zone.</b><pre>host2# <tt><b>zonecfg -z lx-zone</b></tt></pre><p>You will see the following system message:</p><pre>lx-zone: No such zone configured
Use 'create' to begin configuring a new zone.</pre></li>
<li><b>To create the zone <tt>lx-zone</tt> on the new host, use the <tt>zonecfg</tt> command
with the <tt>-a</tt> option and the <tt>zonepath</tt> on the new host.</b><pre>zonecfg:lx-zone> <tt><b>create -a /export/zones/lx-zone</b></tt></pre></li>
<li><b>View the configuration.</b><pre>zonecfg:lx-zone> <tt><b>info</b></tt>
zonename: lx-zone
zonepath: /export/zones/lx-zone
brand: lx
autoboot: false
bootargs:
pool:
limitpriv:
net:
         address: 192.168.0.90
         physical: bge0</pre></li>
<li><b>(Optional) Make any required adjustments to the configuration.</b><p>For example, the network physical device might be different on the new host,
or devices that are part of the configuration might have different names on
the new host.</p><pre>zonecfg:lx-zone> <tt><b>select net physical=bge0</b></tt>
zonecfg:lx-zone:net> <tt><b>set physical=e1000g0</b></tt>
zonecfg:lx-zone:net> <tt><b>end</b></tt></pre></li>
<li><b>Commit the configuration and exit.</b><pre>zonecfg:lx-zone> <tt><b>commit</b></tt>
zonecfg:lx-zone> <tt><b>exit</b></tt></pre></li>
<li><b>Attach the zone on the new host.</b><ul>
<li><b>Attach the zone with a validation check. </b><pre>host2# <tt><b>zoneadm -z lx-zone attach</b></tt></pre><p>The system administrator is notified of required actions to be taken if either
or both of the following conditions are present:</p>
<ul><li><p>Required packages and patches are not present on the new machine.</p></li>
<li><p>The software levels are different between machines.</p></li></ul>
</li>
<li><b>Force the attach operation without performing the validation.</b><pre>host2# <tt><b>zoneadm -z lx-zone attach -F</b></tt></pre>
<hr><p><b>Caution - </b>The <tt>-F</tt> option allows you to force the <tt>attach</tt> with no validation
performed. This is useful in certain cases, such as in a clustered environment
or for backup and restore operations, but it does require that the system
be properly configured to host the zone. An incorrect configuration could result in
undefined behavior later.</p>
<hr>
</li></ul></li></ol>

<a name="gdqse"></a><h4>How to Move the <tt>zonepath</tt> to a new Host</h4><p>There are many ways to create an archive of the <tt>zonepath</tt>. For example,
you can use the <tt>cpio</tt> or <tt>pax</tt> commands described in the <a href="http://docs.sun.com/doc/819-2239/cpio-1?a=view"><tt>cpio</tt>(1)</a>) and <a href="http://docs.sun.com/doc/819-2239/pax-1?a=view"><tt>pax</tt>(1)</a>
man pages.</p><p>There are also several ways to transfer the archive to the new
host. The mechanism used to transfer the <tt>zonepath</tt> from the source host to the
destination depends on the local configuration. In some cases, such as a SAN,
the <tt>zonepath</tt> data might not actually move. The SAN might simply be reconfigured
so the <tt>zonepath</tt> is visible on the new host.  In other cases,
the <tt>zonepath</tt> might be written to tape, and the tape mailed to a
new site.</p><p>For these reasons, this step is not automated. The system administrator must choose
the most appropriate technique to move the <tt>zonepath</tt> to the new host.</p><ol>
<li><b>Become superuser, or assume the Primary Administrator role.</b><p>To create the role and assign the role to a user, see
<a href="http://docs.sun.com/doc/819-2379/smcover-95?a=view">Using the Solaris Management Tools With RBAC (Task Map) in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><b>Move the <tt>zonepath</tt> to the new host. You can use the method described
in this procedure, or use another method of your choice.</b></li></ol><a name="gdqsd"></a>Example&nbsp;35-1 Archiving and Moving the <tt>zonepath</tt> Using the <tt>tar</tt> Command
<ol><li><p>Create a <tt>tar</tt> file of the <tt>zonepath</tt> on <tt>host1</tt> and transfer it to <tt>host2</tt> by using the <tt>sftp</tt> command.</p><pre>host1# <tt><b>cd /export/zones</b></tt>
host1# <tt><b>tar cf lx-zone.tar lx-zone</b></tt>
host1# <tt><b>sftp host2</b></tt>
Connecting to host2...
Password:
sftp> <tt><b>cd /export/zones</b></tt>
sftp> <tt><b>put lx-zone.tar</b></tt>
Uploading lx-zone.tar to /export/zones/lx-zone.tar
sftp> <tt><b>quit</b></tt></pre></li>
<li><p>On <tt>host2</tt>, unpack the <tt>tar</tt> file.</p><pre>host2# cd <tt><b>/export/zones</b></tt>
host2# <tt><b>tar xf lx-zone.tar</b></tt></pre></li></ol>
<p>For more information, see <a href="http://docs.sun.com/doc/819-2239/sftp-1?a=view"><tt>sftp</tt>(1)</a> and <a href="http://docs.sun.com/doc/819-2239/tar-1?a=view"><tt>tar</tt>(1)</a>.</p><h6>Troubleshooting</h6><p>See <a href="gchbp.html">Resolving Problems With a <tt>zoneadm</tt> <tt>attach</tt> Operation</a> for troubleshooting information on the following:</p>
<ul><li><p>Patches and packages are out of sync.</p></li>
<li><p>Operating system releases do not match.</p></li></ul>
<p>The user must verify that the processor type in the new machine
is supported. See <a href="#gdqsz">About Migrating an <tt>lx</tt> Branded Zone</a> for more information.</p>

<a name="gdqtm"></a><h4>About Validating an <tt>lx</tt> Branded  Zone Migration Before the Migration Is Performed</h4>
<p><a name="indexterm-439"></a><a name="indexterm-440"></a>You can perform a trial run before the zone is moved to the
new machine by using the &ldquo;no execute&rdquo; option, <tt>-n</tt>.</p><p>The <tt>zoneadm</tt> <tt>detach</tt> subcommand is used with the <tt>-n</tt> option to generate a
manifest on a running zone without actually detaching the zone. The state of
the zone on the originating system is not changed. The zone manifest is
sent to <tt>stdout</tt>. The global administrator can direct this output to a file
or pipe it to a remote command to be immediately validated on the
target host. The <tt>zoneadm</tt> <tt>attach</tt> subcommand is used with the <tt>-n</tt> option to
read this manifest and verify that the target machine has the correct
configuration to host the zone without actually doing an attach.</p><p>The zone on the target system does <b>not</b> have to be configured on
the new host before doing a trial-run attach.</p>

<a name="gdqsm"></a><h4>How to Validate an <tt>lx</tt> Branded Zone Migration Before the Migration Is Performed</h4><p>You must be the global administrator in the global zone to perform
this procedure.</p><ol>
<li><b>Become superuser, or assume the Primary Administrator role.</b><p>To create the role and assign the role to a user, see
<a href="http://docs.sun.com/doc/819-2379/smcover-95?a=view">Using the Solaris Management Tools With RBAC (Task Map) in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><b>Use one of the following methods.</b><ul>
<li><b>Generate the manifest on a source host named <tt>lx-zone</tt> and pipe the output
to a remote command that will  immediately validate the target host:</b><pre>global# <tt><b>zoneadm -z lx-zone detach -n | ssh remotehost zoneadm attach -n -</b></tt></pre><p>The hyphen (<tt>&mdash;</tt>) at the end of the line specifies <tt>stdin</tt> for
the path.</p></li>
<li><b>Generate the manifest on a source host named <tt>lx-zone</tt> and direct the output
to a file:</b><pre>global# <tt><b>zoneadm -z lx-zone detach -n </b></tt></pre><p><b>Copy the manifest to the new host system as described in </b><a href="#gdqse">How to Move the <tt>zonepath</tt> to a new Host</a><b>, and perform the validation:</b></p><pre>global# <tt><b>zoneadm attach -n path_to_manifest</b></tt></pre><p>The path can be <tt>&mdash;</tt> to specify <tt>stdin</tt>.</p></li></ul></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="gentextid-20513.html">Previous</a>
             </td>
             <td align="right">
                 <a href="gdgif.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

