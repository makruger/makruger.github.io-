<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Using the Perl Interface to <tt>libexacct</tt> - System Administration Guide:  Virtualization Using the Solaris Operating System</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-04-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide:  Virtualization Using the Solaris Operating System</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="rmacct.task-3.html">Previous</a>
             </td>
             <td align="right">
                 <a href="rmctrls-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="preface-3.html">Solaris Virtualization Product Overview</a></p>
<p class="toc level1 tocsp"><a href="resource.html">Part&nbsp;I&nbsp;Resource Management</a></p>
<p class="toc level2"><a href="rmintro-1.html">1.&nbsp;&nbsp;Introduction to Solaris Resource Management</a></p>
<p class="toc level2"><a href="rmtaskproj-1.html">2.&nbsp;&nbsp;Projects and Tasks (Overview)</a></p>
<p class="toc level2"><a href="rmtaskproj.task-37.html">3.&nbsp;&nbsp;Administering Projects and Tasks</a></p>
<p class="toc level2"><a href="rmacct-1.html">4.&nbsp;&nbsp;Extended Accounting (Overview)</a></p>
<p class="toc level2"><a href="rmacct.task.sgm.html">5.&nbsp;&nbsp;Administering Extended Accounting (Tasks)</a></p>
<p class="toc level3"><a href="rmacct.task-25.html">Administering the Extended Accounting Facility (Task Map)</a></p>
<p class="toc level3"><a href="rmacct.task-3.html">Using Extended Accounting Functionality</a></p>
<p class="toc level4"><a href="rmacct.task-3.html#rmacct.task-2">How to Activate Extended Accounting for Processes, Tasks, and Flows</a></p>
<p class="toc level4"><a href="rmacct.task-3.html#rmacct.task-8">How to Activate Extended Accounting With a Startup Script</a></p>
<p class="toc level4"><a href="rmacct.task-3.html#rmacct.task-11">How to Deactivate Process, Task, and Flow Accounting</a></p>
<div class="onpage">
<p class="toc level3 tocsp"><a href="">Using the Perl Interface to <tt>libexacct</tt></a></p>
</div>
<p class="toc level2 tocsp"><a href="rmctrls-1.html">6.&nbsp;&nbsp;Resource Controls (Overview)</a></p>
<p class="toc level2"><a href="rmctrls.task-1.html">7.&nbsp;&nbsp;Administering Resource Controls (Tasks)</a></p>
<p class="toc level2"><a href="rmfss-1.html">8.&nbsp;&nbsp;Fair Share Scheduler (Overview)</a></p>
<p class="toc level2"><a href="rmfss.task-1.html">9.&nbsp;&nbsp;Administering the Fair Share Scheduler (Tasks)</a></p>
<p class="toc level2"><a href="rm.rcapd-1.html">10.&nbsp;&nbsp;Physical Memory Control Using the Resource Capping Daemon (Overview)</a></p>
<p class="toc level2"><a href="rm.rcapd.task-1.html">11.&nbsp;&nbsp;Administering the Resource Capping Daemon (Tasks)</a></p>
<p class="toc level2"><a href="rmpool-1.html">12.&nbsp;&nbsp;Resource Pools (Overview)</a></p>
<p class="toc level2"><a href="rmpool.task-1.html">13.&nbsp;&nbsp;Creating and Administering Resource Pools (Tasks)</a></p>
<p class="toc level2"><a href="rmconfig-1.html">14.&nbsp;&nbsp;Resource Management Configuration Example</a></p>
<p class="toc level2"><a href="rmconsole-1.html">15.&nbsp;&nbsp;Resource Control Functionality in the Solaris Management Console</a></p>
<p class="toc level1 tocsp"><a href="zone.html">Part&nbsp;II&nbsp;Zones</a></p>
<p class="toc level2"><a href="zones.intro-1.html">16.&nbsp;&nbsp;Introduction to Solaris Zones</a></p>
<p class="toc level2"><a href="z.config.ov-1.html">17.&nbsp;&nbsp;Non-Global Zone Configuration (Overview)</a></p>
<p class="toc level2"><a href="z.conf.start-1.html">18.&nbsp;&nbsp;Planning and Configuring Non-Global Zones (Tasks)</a></p>
<p class="toc level2"><a href="z.inst.ov-1.html">19.&nbsp;&nbsp;About Installing, Halting, Cloning, and Uninstalling Non-Global Zones (Overview)</a></p>
<p class="toc level2"><a href="z.inst.task-1.html">20.&nbsp;&nbsp;Installing, Booting, Halting, Uninstalling,  and Cloning Non-Global Zones (Tasks)</a></p>
<p class="toc level2"><a href="z.login.ov-1.html">21.&nbsp;&nbsp;Non-Global Zone Login (Overview)</a></p>
<p class="toc level2"><a href="z.login.task-1.html">22.&nbsp;&nbsp;Logging In to Non-Global Zones (Tasks)</a></p>
<p class="toc level2"><a href="gcgnc.html">23.&nbsp;&nbsp;Moving and Migrating Non-Global Zones (Tasks)</a></p>
<p class="toc level2"><a href="z.pkginst.ov-1.html">24.&nbsp;&nbsp;About Packages and Patches on a Solaris System With Zones Installed (Overview)</a></p>
<p class="toc level2"><a href="z.pkginst.task-1.html">25.&nbsp;&nbsp;Adding and Removing Packages and Patches on a Solaris System With Zones Installed (Tasks)</a></p>
<p class="toc level2"><a href="z.admin.ov-1.html">26.&nbsp;&nbsp;Solaris Zones Administration (Overview)</a></p>
<p class="toc level2"><a href="z.admin.task-1.html">27.&nbsp;&nbsp;Administering Solaris Zones (Tasks)</a></p>
<p class="toc level2"><a href="gclkx.html">28.&nbsp;&nbsp;Troubleshooting Miscellaneous Solaris Zones Problems</a></p>
<p class="toc level1 tocsp"><a href="gchhk.html">Part&nbsp;III&nbsp;Branded Zones</a></p>
<p class="toc level2"><a href="gchhy.html">29.&nbsp;&nbsp;About Branded Zones and the Linux Branded Zone</a></p>
<p class="toc level2"><a href="gcwwm.html">30.&nbsp;&nbsp;Planning the <tt>lx</tt> Branded Zone Configuration (Overview)</a></p>
<p class="toc level2"><a href="gdajn.html">31.&nbsp;&nbsp;Configuring the <tt>lx</tt> Branded Zone (Tasks)</a></p>
<p class="toc level2"><a href="gdbki.html">32.&nbsp;&nbsp;About Installing, Booting, Halting, Cloning, and Uninstalling <tt>lx</tt> Branded Zones (Overview)</a></p>
<p class="toc level2"><a href="gdduh.html">33.&nbsp;&nbsp;Installing, Booting, Halting, Uninstalling and Cloning <tt>lx</tt> Branded Zones (Tasks)</a></p>
<p class="toc level2"><a href="gdgck.html">34.&nbsp;&nbsp;Logging In to <tt>lx</tt> Branded Zones (Tasks)</a></p>
<p class="toc level2"><a href="gdqnv.html">35.&nbsp;&nbsp;Moving and Migrating <tt>lx</tt> Branded Zones (Tasks)</a></p>
<p class="toc level2"><a href="gdgif.html">36.&nbsp;&nbsp;Administering and Running Applications in <tt>lx</tt> Branded Zones (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="gefwp.html">Part&nbsp;IV&nbsp;Sun xVM</a></p>
<p class="toc level2"><a href="gfwrc.html">37.&nbsp;&nbsp;Sun xVM Hypervisor System Requirements</a></p>
<p class="toc level2"><a href="gefwo.html">38.&nbsp;&nbsp;Booting and Running the Sun xVM Hypervisor</a></p>
<p class="toc level2"><a href="gfwcu.html">39.&nbsp;&nbsp;Xvnc</a></p>
<p class="toc level2"><a href="gfqke.html">40.&nbsp;&nbsp;Using <tt>virt-install</tt> to Install a Domain</a></p>
<p class="toc level2"><a href="gfwlm.html">41.&nbsp;&nbsp;xVM System Administration</a></p>
<p class="toc level2"><a href="gefzh.html">42.&nbsp;&nbsp;Troubleshooting Miscellaneous Sun xVM Problems</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="rmacct.task-19"></a><h3>Using the Perl Interface to <tt>libexacct</tt></h3>


<a name="rmacct.task-20"></a><h4>How to Recursively Print the Contents of an <tt>exacct</tt> Object</h4>
<p>Use the following code to recursively print the contents of an <tt>exacct</tt>
object. Note that this capability is provided by the library as the <tt>Sun::Solaris::Exacct::Object::dump()</tt>
function. This capability is also available through the <tt>ea_dump_object()</tt> convenience function.</p><pre>sub dump_object
     {
             my ($obj, $indent) = @_;
             my $istr = '  ' x $indent;

             #
             # Retrieve the catalog tag.  Because we are 
             # doing this in an array context, the
             # catalog tag will be returned as a (type, catalog, id) 
             # triplet, where each member of the triplet will behave as 
             # an integer or a string, depending on context.
             # If instead this next line provided a scalar context, e.g.
             #    my $cat  = $obj->catalog()->value();
             # then $cat would be set to the integer value of the 
             # catalog tag.
             #
             my @cat = $obj->catalog()->value();

             #
             # If the object is a plain item
             #
             if ($obj->type() == &amp;EO_ITEM) {
                     #
                     # Note: The '%s' formats provide s string context, so
                     # the components of the catalog tag will be displayed
                     # as the symbolic values. If we changed the '%s'
                     # formats to '%d', the numeric value of the components
                     # would be displayed.
                     #
                     printf("%sITEM\n%s  Catalog = %s|%s|%s\n", 
                        $istr, $istr, @cat);
                     $indent++;

                     #
                     # Retrieve the value of the item.  If the item contains
                     # in turn a nested exacct object (i.e., an item or
                     # group),then the value method will return a reference
                     # to the appropriate sort of perl object
                     # (Exacct::Object::Item or Exacct::Object::Group).
                     # We could of course figure out that the item contained
                     # a nested item orgroup by examining the catalog tag in
                     # @cat and looking for a type of EXT_EXACCT_OBJECT or
                     # EXT_GROUP.
                     #
                     my $val = $obj->value();
                     if (ref($val)) {
                             # If it is a nested object, recurse to dump it.
                             dump_object($val, $indent);
                     } else {
                             # Otherwise it is just a 'plain' value, so
                             # display it.
                             printf("%s  Value = %s\n", $istr, $val);
                     }

             #
             # Otherwise we know we are dealing with a group.  Groups
             # represent contents as a perl list or array (depending on
             # context), so we can process the contents of the group
             # with a 'foreach' loop, which provides a list context.
             # In a list context the value method returns the content
             # of the group as a perl list, which is the quickest
             # mechanism, but doesn't allow the group to be modified.
             # If we wanted to modify the contents of the group we could
             # do so like this:
             #    my $grp = $obj->value();   # Returns an array reference
             #    $grp->[0] = $newitem;
             # but accessing the group elements this way is much slower.
             #
             } else {
                     printf("%sGROUP\n%s  Catalog = %s|%s|%s\n",
                         $istr, $istr, @cat);
                     $indent++;
                     # 'foreach' provides a list context.
                     foreach my $val ($obj->value()) {
                             dump_object($val, $indent);
                     }
                     printf("%sENDGROUP\n", $istr);
             }
     }</pre>

<a name="rmacct.task-21"></a><h4>How to Create a New Group Record and Write It to a File</h4>
<p>Use this script to create a new group record and write it
to a file named <tt>/tmp/exacct</tt>.</p><pre>#!/usr/bin/perl

use strict;
use warnings;
use Sun::Solaris::Exacct qw(:EXACCT_ALL);
# Prototype list of catalog tags and values.
     my @items = (
             [ &amp;EXT_STRING | &amp;EXC_DEFAULT | &amp;EXD_CREATOR      => "me"       ],
             [ &amp;EXT_UINT32 | &amp;EXC_DEFAULT | &amp;EXD_PROC_PID     => $$         ],
             [ &amp;EXT_UINT32 | &amp;EXC_DEFAULT | &amp;EXD_PROC_UID     => $&lt;         ],
             [ &amp;EXT_UINT32 | &amp;EXC_DEFAULT | &amp;EXD_PROC_GID     => $(         ],
             [ &amp;EXT_STRING | &amp;EXC_DEFAULT | &amp;EXD_PROC_COMMAND => "/bin/rec" ],
     );

     # Create a new group catalog object.
     my $cat = ea_new_catalog(&amp;EXT_GROUP | &amp;EXC_DEFAULT | &amp;EXD_NONE)

     # Create a new Group object and retrieve its data array.
     my $group = ea_new_group($cat);
     my $ary = $group->value();

     # Push the new Items onto the Group array.
     foreach my $v (@items) {
             push(@$ary, ea_new_item(ea_new_catalog($v->[0]), $v->[1]));
     }

     # Open the exacct file, write the record &amp; close.
     my $f = ea_new_file('/tmp/exacct', &amp;O_RDWR | &amp;O_CREAT | &amp;O_TRUNC)
        || die("create /tmp/exacct failed: ", ea_error_str(), "\n");
     $f->write($group);
     $f = undef;</pre>

<a name="rmacct.task-22"></a><h4>How to Print the Contents of an <tt>exacct</tt> File</h4>
<p>Use the following Perl script to print the contents of an <tt>exacct</tt>
file.</p><pre>#!/usr/bin/perl

     use strict;
     use warnings;
     use Sun::Solaris::Exacct qw(:EXACCT_ALL);

     die("Usage is dumpexacct &lt;exacct file>\n") unless (@ARGV == 1);

     # Open the exact file and display the header information.
     my $ef = ea_new_file($ARGV[0], &amp;O_RDONLY) || die(error_str());
     printf("Creator:  %s\n", $ef->creator());
     printf("Hostname: %s\n\n", $ef->hostname());

     # Dump the file contents
     while (my $obj = $ef->get()) {
             ea_dump_object($obj);
     }

     # Report any errors
     if (ea_error() != EXR_OK &amp;&amp; ea_error() != EXR_EOF)  {
             printf("\nERROR: %s\n", ea_error_str());
             exit(1);
     }
     exit(0);</pre>

<a name="rmacct.task-24"></a><h4>Example Output From <tt>Sun::Solaris::Exacct::Object->dump()</tt></h4>
<p>Here is example output produced by running <tt>Sun::Solaris::Exacct::Object->dump()</tt> on the file created
in <a href="#rmacct.task-21">How to Create a New Group Record and Write It to a File</a>.</p><pre>Creator:  root
Hostname: localhost
GROUP
       Catalog = EXT_GROUP|EXC_DEFAULT|EXD_NONE
       ITEM
         Catalog = EXT_STRING|EXC_DEFAULT|EXD_CREATOR
         Value = me
       ITEM
         Catalog = EXT_UINT32|EXC_DEFAULT|EXD_PROC_PID
         Value = 845523
       ITEM
         Catalog = EXT_UINT32|EXC_DEFAULT|EXD_PROC_UID
         Value = 37845
       ITEM
         Catalog = EXT_UINT32|EXC_DEFAULT|EXD_PROC_GID
         Value = 10
       ITEM
         Catalog = EXT_STRING|EXC_DEFAULT|EXD_PROC_COMMAND
         Value = /bin/rec
ENDGROUP</pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="rmacct.task-3.html">Previous</a>
             </td>
             <td align="right">
                 <a href="rmctrls-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

