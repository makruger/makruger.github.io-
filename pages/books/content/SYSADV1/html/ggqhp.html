<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Booting From a ZFS Root File System - System Administration Guide: Basic Administration</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-12-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Basic Administration</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ghsbc.html">Previous</a>
             </td>
             <td align="right">
                 <a href="hbsyshalt-84412.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol1preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="saroadmap-1.html">1.&nbsp;&nbsp;Solaris Management Tools (Road Map)</a></p>
<p class="toc level1 tocsp"><a href="smcover-1.html">2.&nbsp;&nbsp;Working With the Solaris Management Console (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ewpor.html">3.&nbsp;&nbsp;Working With the Sun Java Web Console (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="userconcept-97366.html">4.&nbsp;&nbsp;Managing User Accounts and Groups (Overview)</a></p>
<p class="toc level1 tocsp"><a href="usersetup-92366.html">5.&nbsp;&nbsp;Managing User Accounts and Groups (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="clientconcept-15236.html">6.&nbsp;&nbsp;Managing Client-Server Support (Overview)</a></p>
<p class="toc level1 tocsp"><a href="clientsetup-1.html">7.&nbsp;&nbsp;Managing Diskless Clients (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="hbintro-66644.html">8.&nbsp;&nbsp;Introduction to Shutting Down and Booting a System</a></p>
<p class="toc level1 tocsp"><a href="hboverview-25463.html">9.&nbsp;&nbsp;Shutting Down and Booting a System (Overview)</a></p>
<p class="toc level2"><a href="ggjcp.html">Fundamentals of the Solaris Boot Design</a></p>
<p class="toc level2"><a href="ggefi.html">Understanding the New Solaris SPARC Boot Architecture</a></p>
<p class="toc level2"><a href="getpo.html">Implementation of the Boot Archives on Solaris SPARC</a></p>
<p class="toc level2"><a href="fvbsc.html">x86: Administering the GRUB Bootloader</a></p>
<p class="toc level2"><a href="ghsbc.html">x86: Introducing Fast Reboot</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Booting From a ZFS Root File System</a></p>
</div>
<p class="toc level1 tocsp"><a href="hbsyshalt-84412.html">10.&nbsp;&nbsp;Shutting Down a System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="grubtasks-1.html">11.&nbsp;&nbsp;Modifying Solaris Boot Behavior (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="hbsparcboot-79782.html">12.&nbsp;&nbsp;Booting a Solaris System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="hbtsboot-1.html">13.&nbsp;&nbsp;Troubleshooting Booting a Solaris System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="archive-123.html">14.&nbsp;&nbsp;Managing the Solaris Boot Archives (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="hbsysboot-76719.html">15.&nbsp;&nbsp;x86: GRUB Based Booting (Reference)</a></p>
<p class="toc level1 tocsp"><a href="hbrunlevels-25516.html">16.&nbsp;&nbsp;Managing Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="faauf.html">17.&nbsp;&nbsp;Managing Services (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="swmgrpkgsconcepts-52619.html">18.&nbsp;&nbsp;Managing Software (Overview)</a></p>
<p class="toc level1 tocsp"><a href="swmgrpkgsgui-1.html">19.&nbsp;&nbsp;Managing Software With Solaris System Administration Tools (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="swmgrpkgscli-1.html">20.&nbsp;&nbsp;Managing Software by Using Package Commands (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="swmgrpatchtasks-1.html">21.&nbsp;&nbsp;Managing Solaris Patches by Using the <tt>patchadd</tt> Command (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fddwm.html">A.&nbsp;&nbsp;SMF Services</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="ggqhp"></a><h3>Booting From a ZFS Root File System</h3>
<p>Support for booting a system from a ZFS root file system has
been added to the Solaris OS. The Solaris installation software also includes support for
system upgrades and patching of systems with ZFS roots. Booting, system operations, and
installation procedures have been modified to support this change. Changes to booting include
the implementation of boot loaders the SPARC boot architecture to increase commonality with
the Solaris x86 boot architecture. This implementation is described in the following sections.</p><p>For more information about ZFS, including a complete list of terms, see <a href="http://docs.sun.com/doc/817-2271/ftyue?a=view">ZFS Terminology in <i>Solaris ZFS Administration Guide</i></a>.</p>

<a name="ggwiv"></a><h4>Solaris Installation Requirements for ZFS</h4>
<p>Before performing a new installation of the Solaris software or using Solaris Live
Upgrade to migrate a UFS root file system to a ZFS root
file system, make sure the following requirements are met:</p>
<ul><li><p><b>Solaris release information:</b></p><p>The ability to install and boot from a ZFS root file system is available in the Solaris 10 11/06 release. To perform a Solaris Live Upgrade operation to migrate to a ZFS root file system, you must have installed or upgraded to the Solaris 10 11/06 release.</p></li>
<li><p><b>ZFS storage pool space requirements:</b></p><p>The minimum amount of available pool space that is required for a bootable ZFS root file system is larger than for a bootable UFS root file system because swap and dump devices are not shared in a ZFS root environment.</p><p>If you select a ZFS root file system during an initial software installation, or if you use Solaris Live Upgrade to migrate from a UFS root file system to a ZFS root file system, a swap area is created on a ZFS volume in the ZFS root pool. The default swap area is sized at 1/2 the size of physical memory, but no more than 2 Gbytes. A ZFS volume is also created for the dump device. The dump device is sized at 1/2 the size of physical memory, but no more than 2 Gbytes. Currently, the swap area and the dump device must reside on separate ZFS volumes.</p><p>For more information, see <a href="http://docs.sun.com/doc/817-2271/ggrln?a=view">ZFS Support for Swap and Dump Devices in <i>Solaris ZFS Administration Guide</i></a>.</p></li></ul>


<a name="ggqcx"></a><h4>How Booting From a ZFS Root File System Works</h4>
<p>Booting from a ZFS root file system works differently than booting from a
UFS file system. Because ZFS applies several new concepts for installation and booting,
some basic administrative practices for booting a system have changed. The most significant
difference between booting from a ZFS root file system and booting from a
UFS root file system is that with ZFS a device identifier does <b>not</b>
uniquely identify a root file system, and thus a BE.  With ZFS,
a device identifier uniquely identifies a <b>storage pool</b>. A storage pool can contain
multiple bootable datasets (root file systems). Therefore, in addition to specifying a boot
device, a root file system within the pool that was identified by the
boot device must also be specified.</p><p>On an x86 based system, if the boot device that is identified
by GRUB contains a ZFS storage pool, the <tt>menu.lst</tt> file that is used to
create the GRUB menu is located in the dataset at the root
of that pool's dataset hierachy.  This dataset has the same name as
the pool.  There is one such dataset in each pool.</p><p>A <b>default bootable dataset</b> is the bootable dataset for the pool that is mounted at
boot time and is defined by the root pool's <tt>bootfs</tt> property. When
a device in a root pool is booted, the dataset that is specified
by this property is then mounted as the root file system.</p><p>The new <tt>bootfs</tt> pool property is a mechanism that is used by the
system to specify the default bootable dataset for a given pool. When a
device in a root pool is booted, the dataset that is mounted by
default as the root file system is the one that is identified
by the <tt>bootfs</tt> pool property.<a name="indexterm-125"></a></p><p>On a SPARC based system, the default <tt>bootfs</tt> pool property is overridden by
using the new <tt>-Z</tt> <i>dataset</i> option of the <tt>boot</tt> command.</p><p>On an x86 based system, the default <tt>bootfs</tt> pool property is overridden by
selecting an alternate boot environment in the GRUB menu at boot time.</p>

<a name="ggyxv"></a><h4>SPARC: Boot Options That Support Booting From a ZFS Root File System</h4>
<a name="indexterm-126"></a><a name="indexterm-127"></a><a name="indexterm-128"></a><a name="indexterm-129"></a><a name="indexterm-130"></a><p>On the SPARC platform, the following two boot options are new:</p>
<ul><li><p>The <tt>-L </tt> option, which is used to print a list of all the available BEs on a system.</p><pre>ok <tt><b>boot -L</b></tt></pre>
<hr><p><b>Note - </b>The <tt>-L</tt> option is run from the <tt>ok</tt> prompt. This option only presents the list of available BEs on the system. To boot the system, use the<tt>- Z</tt> boot option.</p>
<hr>
</li>
<li><p>The <tt>-Z</tt> option of the <tt>boot</tt> command enables you to specify a bootable dataset other than the default dataset that is specified by the <tt>bootfs</tt> pool property.</p><pre>ok <tt><b>boot -Z </tt><i>dataset</i><tt></b></tt></pre></li></ul>
<p>The list of BEs that are displayed when you use the <tt>-L</tt>
option on a device that has a ZFS boot loader reflect the <tt>menu.lst</tt>
entries that are available on that particular system.  Along with the list
of available BEs, instructions for selecting a BE and using the <tt>-Z</tt> option to
boot the system are also provided.  The dataset specified by the
<tt>bootfs</tt> value for the menu item is used for all subsequent files
that are read by the booter, for example, the boot archive and various
configuration files that are located in the <tt>/etc</tt> directory. This dataset is then mounted
as the root file system.</p><p>For step-by-step instructions, see <a href="ggqhf.html">Booting From a ZFS Root File System on a SPARC Based System</a>.</p>

<a name="ghcqu"></a><h4>x86: Boot Options That Support Booting From a ZFS Root File System</h4>
<a name="indexterm-131"></a><a name="indexterm-132"></a><a name="indexterm-133"></a><p>On the x86 platform, a new GRUB keyword, <tt>$ZFS-BOOTFS</tt> has been introduced. When
booting an x86 based system, if the root file system that corresponds with
the GRUB menu entry is a ZFS dataset, the GRUB menu entry contains
the <tt>-B</tt> option with the <tt>$ZFS-BOOTFS</tt> token by default. If you install or
upgrade your system with a Solaris release that supports a ZFS boot loader,
the GRUB <tt>menu.lst</tt> file is updated with this information automatically. The default bootable
dataset is identified by the <tt>bootfs</tt> property.</p><p>On x86 based systems that are running a Solaris release that supports a
ZFS boot loader, this information is included in the GRUB menu.</p><p>The following is an example of a default <tt>menu.lst</tt> file for a GRUB
implementation that supports a ZFS boot loader:</p><pre>title Solaris 11 s10x_90 X86
findroot (pool_rpool,0,a)
kernel$ /platform/i86pc/kernel/$ISADIR/unix -B $ZFS-BOOTFS
module$ /platform/i86pc/$ISADIR/boot_archive

title Solaris 11 failsafe
findroot (pool_rpool,0,a)
kernel /boot/platform/i86pc/kernel/unix -s -B console=ttyb
module /boot/x86.miniroot-safe</pre><p>This example shows a <tt>menu.lst</tt> file that has been manually edited to include
an alternate bootable dataset entry:</p><pre>title Solaris-alternate-dataset
bootfs myrootpool/bootenv-alt
kernel$ /platform/i86pc/kernel/$ISADIR/unix -B $ZFS-BOOTFS
module$ /platform/i86pc/$ISADIR/boot_archive</pre><p>For step-by-step instructions on booting a system from ZFS, see <a href="ggqaa.html">Booting From a ZFS Root File System on an x86 Based System</a>.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ghsbc.html">Previous</a>
             </td>
             <td align="right">
                 <a href="hbsyshalt-84412.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

