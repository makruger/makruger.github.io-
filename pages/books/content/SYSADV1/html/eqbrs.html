<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Managing SMF Services - System Administration Guide: Basic Administration</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-12-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Basic Administration</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="gdqyb.html">Previous</a>
             </td>
             <td align="right">
                 <a href="eqbwh.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol1preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="saroadmap-1.html">1.&nbsp;&nbsp;Solaris Management Tools (Road Map)</a></p>
<p class="toc level1 tocsp"><a href="smcover-1.html">2.&nbsp;&nbsp;Working With the Solaris Management Console (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ewpor.html">3.&nbsp;&nbsp;Working With the Sun Java Web Console (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="userconcept-97366.html">4.&nbsp;&nbsp;Managing User Accounts and Groups (Overview)</a></p>
<p class="toc level1 tocsp"><a href="usersetup-92366.html">5.&nbsp;&nbsp;Managing User Accounts and Groups (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="clientconcept-15236.html">6.&nbsp;&nbsp;Managing Client-Server Support (Overview)</a></p>
<p class="toc level1 tocsp"><a href="clientsetup-1.html">7.&nbsp;&nbsp;Managing Diskless Clients (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="hbintro-66644.html">8.&nbsp;&nbsp;Introduction to Shutting Down and Booting a System</a></p>
<p class="toc level1 tocsp"><a href="hboverview-25463.html">9.&nbsp;&nbsp;Shutting Down and Booting a System (Overview)</a></p>
<p class="toc level1 tocsp"><a href="hbsyshalt-84412.html">10.&nbsp;&nbsp;Shutting Down a System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="grubtasks-1.html">11.&nbsp;&nbsp;Modifying Solaris Boot Behavior (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="hbsparcboot-79782.html">12.&nbsp;&nbsp;Booting a Solaris System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="hbtsboot-1.html">13.&nbsp;&nbsp;Troubleshooting Booting a Solaris System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="archive-123.html">14.&nbsp;&nbsp;Managing the Solaris Boot Archives (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="hbsysboot-76719.html">15.&nbsp;&nbsp;x86: GRUB Based Booting (Reference)</a></p>
<p class="toc level1 tocsp"><a href="hbrunlevels-25516.html">16.&nbsp;&nbsp;Managing Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="faauf.html">17.&nbsp;&nbsp;Managing Services (Tasks)</a></p>
<p class="toc level2"><a href="eqbrp.html">Managing Services (Task Map)</a></p>
<p class="toc level2"><a href="dzhaq.html">Monitoring SMF Services</a></p>
<p class="toc level2"><a href="gdqyb.html">Managing SMF Services (Task Map)</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Managing SMF Services</a></p>
</div>
<p class="toc level2"><a href="eqbwh.html">Configuring SMF Services</a></p>
<p class="toc level2"><a href="etesg.html">Using Run Control Scripts (Task Map)</a></p>
<p class="toc level2"><a href="fahqr.html">Using Run Control Scripts</a></p>
<p class="toc level2"><a href="ecdps.html">Troubleshooting the Service Management Facility</a></p>
<p class="toc level1 tocsp"><a href="swmgrpkgsconcepts-52619.html">18.&nbsp;&nbsp;Managing Software (Overview)</a></p>
<p class="toc level1 tocsp"><a href="swmgrpkgsgui-1.html">19.&nbsp;&nbsp;Managing Software With Solaris System Administration Tools (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="swmgrpkgscli-1.html">20.&nbsp;&nbsp;Managing Software by Using Package Commands (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="swmgrpatchtasks-1.html">21.&nbsp;&nbsp;Managing Solaris Patches by Using the <tt>patchadd</tt> Command (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fddwm.html">A.&nbsp;&nbsp;SMF Services</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="eqbrs"></a><h3>Managing SMF Services</h3>
<p>This section includes information on managing SMF services.</p>

<a name="fddwy"></a><h4>Using RBAC Rights Profiles With SMF</h4>
<p>You can use RBAC rights profiles to allow users to manage some
of the SMF services, without having to give the user <tt>root</tt> access. The rights
profiles define what commands the user can run. For SMF, the following profiles
have been created:</p>
<ul><li><p><tt>Service Management</tt>: User can add, delete or modify services.</p></li>
<li><p><tt>Service Operator</tt>: User can request state changes of any service instance, such as restart and refresh.</p></li></ul>
<p>For specific information about the authorizations, see the <a href="http://docs.sun.com/doc/819-2252/smf-security-5?a=view"><tt>smf_security</tt>(5)</a> man page. For instructions
to assign a rights profile, see <a href="http://docs.sun.com/doc/819-3321/rbactask-25?a=view">How to Change the RBAC Properties of a User in <i>System Administration Guide: Security Services</i></a>.</p>

<a name="ecdqs"></a><h4>How to Disable a Service Instance</h4><p>Use the following procedure to disable a service. The service status change is
recorded in the service configuration repository. Once the service is disabled, the disabled
state will persist across reboots. The only way to get the service running
again is to enable it.</p><ol>
<li><b>Become superuser or assume a role that includes the <tt>Service Management</tt> rights profile.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-30?a=view">Configuring RBAC in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Check the dependents of the service you want to disable.</b><p>If this service has dependents that you need, then you cannot disable this
service.</p><pre># svcs -D FMRI</pre></li>
<li><b>Disable the service.</b><pre># svcadm disable <i>FMRI</i></pre></li></ol><a name="eqbry"></a><h6>Example&nbsp;17-7 Disabling the <tt>rlogin</tt> Service</h6><p>The output from the first command shows that the <tt>rlogin</tt> service has no
dependents. The second command in this example disables the <tt>rlogin</tt> service. The
third command shows that the state of the <tt>rlogin</tt> service instance is
disabled.</p><pre># <tt><b>svcs -D network/login:rlogin</b></tt>
# <tt><b>svcadm disable network/login:rlogin</b></tt>
STATE          STIME    FMRI
# <tt><b>svcs network/login:rlogin</b></tt>
STATE          STIME    FMRI
disabled         11:17:24 svc:/network/login:rlogin</pre>

<a name="ecdia"></a><h4>How to Enable a Service Instance</h4><p>Use the following procedure to enable a service. The service status change is
recorded in the service configuration repository. Once the service is enabled, the enabled
state will persist across system reboots if the service dependencies are met.</p><ol>
<li><b>Become superuser or assume a role that includes the <tt>Service Management</tt> rights profile.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-30?a=view">Configuring RBAC in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Determine whether service dependencies are satisfied.</b><p>If the service is enabled, then the service dependencies are satisfied. If not, use
<tt>svcadm enable</tt> <tt>-r</tt> FMRI to recursively enable all dependencies.</p><pre># svcs -l FMRI|grep enabled</pre></li>
<li><b>Enable a service.</b><pre># svcadm enable <i>FMRI</i></pre></li></ol><a name="eqbro"></a><h6>Example&nbsp;17-8 Enabling the <tt>rlogin</tt> Service</h6><p>The second command in this example enables the <tt>rlogin</tt> service. The third command
shows that the state of the <tt>rlogin</tt> service instance is online.</p><pre># <tt><b>svcs -l network/login:rlogin|grep enabled</b></tt>
enabled      false
# <tt><b>svcadm enable network/login:rlogin</b></tt>
# <tt><b>svcs network/login:rlogin</b></tt>
STATE          STIME    FMRI
online         12:09:16 svc:/network/login:rlogin</pre><a name="gbaur"></a><h6>Example&nbsp;17-9 Enabling a Service in Single-user Mode</h6><p>The following command enables rpcbind. The <tt>-t</tt> option starts the service in temporary
mode which does not change the service repository. The repository is not writable
in single-user mode. The <tt>-r</tt> option recursively starts all the dependencies of the
named service.</p><pre># svcadm enable -rt rpc/bind</pre>

<a name="eywvo"></a><h4>How to Restart a Service</h4><p>If a service is currently running but needs to be restarted due
to a configuration change or some other reason, the service can be restarted
without you having to type separate commands to stop and start the service.
The only reason to specifically disable and then enable a service is if
changes need to be made before the service is enabled, and after the
service is disabled.</p><ol>
<li><b>Become superuser or assume a role that includes the <tt>Service Management</tt> rights profile.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-30?a=view">Configuring RBAC in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Restart a service.</b><pre># svcadm restart <i>FMRI</i></pre></li></ol>

<a name="ecdna"></a><h4>How to Restore a Service That Is in the Maintenance State</h4><ol>
<li><b>Become superuser or assume a role that includes the <tt>Service Management</tt> rights profile.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-30?a=view">Configuring RBAC in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Determine if any process that are dependent to the service have not stopped.</b><p>Normally, when a service instance is in a maintenance state, all processes associated
with that instance have stopped. However, you should make sure before you proceed.
The following command lists all of the processes that are associated with a
service instance as well as the PIDs for those processes.</p><pre># svcs -p <i>FMRI</i></pre></li>
<li>(Optional) <b>Kill any remaining processes.</b><p>Repeat this step for all processes that are displayed by the <tt>svcs</tt> command.</p><pre># pkill -9 <i>PID</i></pre></li>
<li><b>If necessary, repair the service configuration.</b><p>Consult the appropriate service log files in <tt>/var/svc/log</tt> for a list of errors.</p></li>
<li><b>Restore the service.</b><pre># svcadm clear <i>FMRI</i></pre></li></ol>

<a name="ecdpn"></a><h4>How to Revert to Another SMF Snapshot</h4><p>If the service configuration is wrong, the problem can be fixed by
reverting to the last snapshot that started successfully. In this procedure, a previous snapshot
of the <tt>console-login</tt> service is used.</p><ol>
<li><b>Become superuser or assume a role that includes the <tt>Service Management</tt> rights profile.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-30?a=view">Configuring RBAC in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Run the <tt>svccfg</tt> command.</b><pre># <tt><b>svccfg</b></tt>
svc:&gt;</pre><ol style="list-style-type: lower-alpha">
				 
<li><b>Select the service instance that you want to fix.</b>
<hr><p><b>Note - </b>You must use an FMRI that fully defines the instance. No shortcuts are
allowed.</p>
<hr>
<pre>svc:&gt; <tt><b>select system/console-login:default</b></tt>
svc:/system/console-login:default&gt;</pre></li>
<li><b>Generate a list of available snapshots.</b><pre>svc:/system/console-login:default&gt; <tt><b>listsnap</b></tt>
initial
running
start
svc:/system/console-login:default&gt;</pre></li>
<li><b>Select to revert to the <tt>start</tt> snapshot.</b><p>The <tt>start</tt> snapshot is the last snapshot in which the service successfully started.</p><pre>svc:/system/console-login:default&gt; <tt><b>revert start</b></tt>
svc:/system/console-login:default&gt;</pre></li>
<li><b>Quit <tt>svccfg</tt>.</b><pre>svc:/system/console-login:default&gt; <tt><b>quit</b></tt>
#</pre></li></ol></li>
<li><b>Update the information in the service configuration repository.</b><p>This step updates the repository with the configuration information from the <tt>start</tt> snapshot.</p><pre># <tt><b>svcadm refresh system/console-login</b></tt></pre></li>
<li><b>Restart the service instance.</b><pre># <tt><b>svcadm restart system/console-login</b></tt></pre></li></ol>

<a name="gdavi"></a><h4>How to Create an SMF Profile</h4><p>A profile is an XML file which lists SMF services and whether
each should be enabled or disabled. Profiles are used to enable or disable
many services at once. Not all services need to be listed in a
profile. Each profile only needs to include those services that need to be
enabled or disabled to make the profile useful.</p><ol>
<li><b>Create a profile.</b><p>In this example, the <tt>svccfg</tt> command is used to create a profile which
reflects which services are enabled or disabled on the current system. Alternately, you
could make a copy of an existing profile to edit.</p><pre># <tt><b>svccfg extract&gt; profile.xml</b></tt></pre><p>If you are using JumpStart, if you have large numbers of identical
systems, or if you want to archive the system configuration for later restoration, you
may want to use this procedure to create a unique version of
a SMF profile.</p></li>
<li><b>Edit the <tt>profile.xml</tt> file to make any required changes.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Change the name of the profile in the <tt>service_bundle</tt> declaration.</b><p>In this example the name is changed to <tt>profile</tt>.</p><pre># <tt><b>cat profile.xml</b></tt>
  ...
&lt;service_bundle type=`profile` name=`<tt><b>profile</b></tt>`
    xmIns::xi='http://www.w3.org/2003/XInclude'
  ...</pre></li>
<li><b>Remove any services that should not be managed by this profile.</b><p>For each service, remove the three lines that describe the service. Each service
description starts with <tt>&lt;service</tt> and ends with <tt>&lt;/service</tt>. This example shows the lines
for the LDAP client service.</p><pre># <tt><b>cat profile.xml</b></tt>
 ...
 &lt;service name='network/ldap/client' version='1' type='service'&gt;
         &lt;instance  name='default' enabled='true'/&gt;
 &lt;/service&gt;</pre></li>
<li><b>Add any services that should be managed by this profile.</b><p>Each service needs to be defined using the three line syntax shown
above.</p></li>
<li><b>If necessary, change the enabled flag for selected services.</b><p>In this example, the <tt>sendmail</tt> service is disabled.</p><pre># <tt><b>cat profile.xml</b></tt>
  ...
  &lt;service  name='network/smtp' version='1' type='service'&gt;
    &lt;instance  name='sendmail' enabled='<tt><b>false</b></tt>'/&gt;
  &lt;/service&gt;
  ...</pre></li></ol></li>
<li><b>When necessary, apply the new profile.</b><p>See <a href="#fgour">How to Apply an SMF Profile</a> for instructions.</p></li></ol>

<a name="fgour"></a><h4>How to Apply an SMF Profile</h4><ol>
<li><b>Become superuser or assume a role that includes the <tt>Service Management</tt> rights profile.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-30?a=view">Configuring RBAC in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Apply an profile.</b><p>In this example, the <tt>profile.xml</tt> profile is used.</p><pre># <tt><b>svccfg apply profile.xml</b></tt></pre>
<hr><p><b>Note - </b>For specific instructions for switching between the <tt>generic_limited_net.xml</tt> and <tt>generic_open.xml</tt> and the
properties that need to be applied when making this switch, please see <a href="#gdavv">Changing Services Offered to the Network with <tt>generic*.xml</tt></a></p>
<hr>
</li></ol>

<a name="gdavv"></a><h4>Changing Services Offered to the Network with <tt>generic*.xml</tt></h4><p>The <tt>netservices</tt> command switches system services between minimal network exposure and the traditional
network exposure (as in previous Solaris releases). The switch is done with the
<tt>generic_limited.xml</tt> and <tt>generic_open.xml</tt> profiles. In addition, some services properties are changed by the
command to limit some services to a local-only mode or to the traditional
mode, as appropriate.</p>
<hr><p><b>Note - </b>In the Solaris Express 7/06 release, the <tt>generic_limited_net</tt> profile and the local-mode
only service properties are applied by default.</p>
<hr>
<ol>
<li><b>Become superuser or assume a role that includes the <tt>Service Management</tt> rights profile.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-30?a=view">Configuring RBAC in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Run the <tt>netservices</tt> command.</b><p>In this example, the open or traditional network exposure is selected.</p><pre># <tt><b>/usr/sbin/netservices open</b></tt></pre></li></ol><a name="gdawj"></a><h6>Example&nbsp;17-10 Limiting Network Service Exposure</h6><p>This command changes properties to run some services in local mode, as well
as restricts which services are enabled with the <tt>generic_limited_net</tt> profile. The command
should only be used if the <tt>generic_open.xml</tt> profile had been applied.</p><pre># <tt><b>/usr/sbin/netservices limited</b></tt></pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="gdqyb.html">Previous</a>
             </td>
             <td align="right">
                 <a href="eqbwh.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

