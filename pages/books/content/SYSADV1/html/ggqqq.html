<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Booting the Failsafe Archive on a SPARC Based System - System Administration Guide: Basic Administration</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-12-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Basic Administration</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ggqhf.html">Previous</a>
             </td>
             <td align="right">
                 <a href="hbsparcboot-60.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol1preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="saroadmap-1.html">1.&nbsp;&nbsp;Solaris Management Tools (Road Map)</a></p>
<p class="toc level1 tocsp"><a href="smcover-1.html">2.&nbsp;&nbsp;Working With the Solaris Management Console (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ewpor.html">3.&nbsp;&nbsp;Working With the Sun Java Web Console (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="userconcept-97366.html">4.&nbsp;&nbsp;Managing User Accounts and Groups (Overview)</a></p>
<p class="toc level1 tocsp"><a href="usersetup-92366.html">5.&nbsp;&nbsp;Managing User Accounts and Groups (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="clientconcept-15236.html">6.&nbsp;&nbsp;Managing Client-Server Support (Overview)</a></p>
<p class="toc level1 tocsp"><a href="clientsetup-1.html">7.&nbsp;&nbsp;Managing Diskless Clients (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="hbintro-66644.html">8.&nbsp;&nbsp;Introduction to Shutting Down and Booting a System</a></p>
<p class="toc level1 tocsp"><a href="hboverview-25463.html">9.&nbsp;&nbsp;Shutting Down and Booting a System (Overview)</a></p>
<p class="toc level1 tocsp"><a href="hbsyshalt-84412.html">10.&nbsp;&nbsp;Shutting Down a System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="grubtasks-1.html">11.&nbsp;&nbsp;Modifying Solaris Boot Behavior (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="hbsparcboot-79782.html">12.&nbsp;&nbsp;Booting a Solaris System (Tasks)</a></p>
<p class="toc level2"><a href="hbsparcboot-69.html">Booting a SPARC Based System (Task Map)</a></p>
<p class="toc level2"><a href="hbsparcboot-9.html">Booting a SPARC Based System</a></p>
<p class="toc level2"><a href="ggqhf.html">Booting From a ZFS Root File System on a SPARC Based System</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Booting the Failsafe Archive on a SPARC Based System</a></p>
</div>
<p class="toc level2"><a href="hbsparcboot-60.html">Booting a SPARC Based System From the Network</a></p>
<p class="toc level2"><a href="hbx86boot-68676.html">Booting an x86 Based System by Using GRUB (Task Map)</a></p>
<p class="toc level2"><a href="ggqaa.html">Booting From a ZFS Root File System on an x86 Based System</a></p>
<p class="toc level2"><a href="ggqdn.html">Booting the Failsafe Archive on an x86 Based System</a></p>
<p class="toc level2"><a href="ghsut.html">Using Fast Reboot on the x86 Platform (Task Map)</a></p>
<p class="toc level2"><a href="fvzok.html">Booting an x86 Based System from the Network</a></p>
<p class="toc level1 tocsp"><a href="hbtsboot-1.html">13.&nbsp;&nbsp;Troubleshooting Booting a Solaris System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="archive-123.html">14.&nbsp;&nbsp;Managing the Solaris Boot Archives (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="hbsysboot-76719.html">15.&nbsp;&nbsp;x86: GRUB Based Booting (Reference)</a></p>
<p class="toc level1 tocsp"><a href="hbrunlevels-25516.html">16.&nbsp;&nbsp;Managing Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="faauf.html">17.&nbsp;&nbsp;Managing Services (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="swmgrpkgsconcepts-52619.html">18.&nbsp;&nbsp;Managing Software (Overview)</a></p>
<p class="toc level1 tocsp"><a href="swmgrpkgsgui-1.html">19.&nbsp;&nbsp;Managing Software With Solaris System Administration Tools (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="swmgrpkgscli-1.html">20.&nbsp;&nbsp;Managing Software by Using Package Commands (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="swmgrpatchtasks-1.html">21.&nbsp;&nbsp;Managing Solaris Patches by Using the <tt>patchadd</tt> Command (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fddwm.html">A.&nbsp;&nbsp;SMF Services</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="ggqqq"></a><h3>Booting the Failsafe Archive on a SPARC Based System</h3>
<p>Booting a system from a root (<tt>/</tt>) file system image that is a
boot archive, and then remounting this file system on the actual root device
can sometimes result in a boot archive and root file system that do
not match, or are <b>inconsistent</b>.  Under these conditions, the proper operation and
integrity of the system is compromised.  After the root (<tt>/</tt>) file system
is mounted, and before relinquishing the in-memory file system, the system performs a
consistency verification against the two files systems. If an inconsistency is detected, the
normal boot sequence is suspended and the system reverts to <b>failsafe mode</b>.</p><p>Also, if a system failure, a power failure, or a kernel panic
occurs immediately following a kernel file update, the boot archives and the root (<tt>/</tt>)
file system might not be synchronized. Although the system might still boot with
the inconsistent boot archives, it is recommended that you boot the failsafe archive
to update the boot archives. You can also use the <tt>bootadm</tt> command to
manually update the boot archives. For more information, see <a href="gglaj.html">Using the <tt>bootadm</tt> Command to Manage the Boot Archives</a>.</p><p>The failsafe archive can be booted for recovery purposes or to update the
boot archive on both the SPARC and x86 platforms.</p><p>On the SPARC platform the failsafe archive is:</p><p><tt>/platform/`uname -m`/failsafe</tt></p><p>You would boot the failsafe archive by using the following syntax:</p><pre><tt><b>ok boot -F failsafe</b></tt></pre><p>Failsafe booting is also supported on systems that are booted from ZFS. When
booting from a ZFS-rooted BE, each BE has its own failsafe archive.
 The failsafe archive is located where the root (<tt>/</tt>) file system is located,
as is the case with a UFS-rooted BE.  The default failsafe archive
is the archive that is in the default bootable file system. The
default bootable file system (dataset) is indicated by the value of the pool's
<tt>bootfs</tt> property.</p><p>For information about booting an x86 based failsafe archive, see <a href="ggqdn.html">Booting the Failsafe Archive on an x86 Based System</a>.</p><p>Another method that can be used to update the boot archives is
to clear the boot-archive service. However, the preferred methods for updating the boot archives
are to boot the failsafe archive or use the <tt>bootadm</tt> command. For more
information, see <a href="ggngq.html#gglbw">How to Update an Inconsistent Boot Archive by Clearing the <tt>boot-archive</tt> Service</a>.</p>

<a name="ggqgc"></a><h4>How to Boot the Failsafe Archive on a SPARC Based System</h4><a name="indexterm-176"></a><a name="indexterm-177"></a><p>Use this procedure to boot the failsafe archive on a SPARC based
system. If the system does not boot after the boot archive is updated,
you might need to boot the system in single-user mode. For more information,
see <a href="hbsparcboot-9.html#hbsparcboot-83723">SPARC: How to Boot a System to Run Level S (Single-User Level)</a>.</p>
<hr><p><b>Note - </b>This procedures also includes instructions for booting the failsafe archive for a specific
ZFS dataset.</p>
<hr>
<ol>
<li><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Bring the system to the <tt>ok</tt> prompt:</b><pre># <tt><b>init 0</b></tt></pre></li>
<li><b>Boot the failsafe archive.</b><ul>
<li><b>To boot the default failsafe archive, type:</b><pre>ok <tt><b>boot -F failsafe</b></tt></pre></li>
<li><b>To boot the failsafe archive of a specific ZFS dataset:</b><pre>ok <tt><b>boot -F failsafe -Z </tt><i>dataset</i><tt></b></tt></pre><p>For example:</p><pre>ok  <tt><b>boot -F failsafe -Z rpool/ROOT/zfsBE2</b></tt></pre>
<hr><p><b>Note - </b>To determine the name of the dataset to boot, first use the
<tt>boot</tt> <tt>-L</tt> command to display a list of the available BEs on the
system. For more information, see <a href="ggqhf.html#ggqgy">SPARC: How to List Available Bootable Datasets Within a ZFS Root Pool</a>.</p>
<hr>
</li></ul><p>If an inconsistent boot archive is detected a message is displayed.</p></li>
<li><b>To update the boot archive, type <tt>y</tt> and press Return.</b><pre>An out of sync boot archive was detected on rpool.
The boot archive is a cache of files used during boot
and should be kept in sync to ensure proper system operation.

Do you wish to automatically update this boot archive? [y,n,?] <tt><b>y</b></tt></pre><p>If the archive was updated successfully, a message is displayed:</p><pre>The boot archive on rpool was updated successfully.</pre></li></ol><a name="ggqch"></a><h6>Example&nbsp;12-7 SPARC: Booting the Failsafe Archive</h6><p>This example shows how to boot the failsafe archive on a SPARC
based system. If no device is specified, the failsafe archive for the default
boot device is booted.</p><pre>ok <tt><b>boot -F failsafe</b></tt>
Resetting ...
screen not found.
Can't open input device. Keyboard not present.  Using ttya for input and output.

Sun Enterprise 220R (2 X UltraSPARC-II 450MHz), No Keyboard
OpenBoot 3.23, 1024 MB memory installed, Serial #13116682.
Ethernet address 8:0:20:c8:25:a, Host ID: 80c8250a.

Rebooting with command: boot -F failsafe
Boot device: /pci@1f,4000/scsi@3/disk@1,0:a  File and args: -F failsafe
SunOS Release 5.10t
Copyright 1983-2007 Sun Microsystems, Inc.  All rights reserved.
Use is subject to license terms.
Configuring /dev Searching for installed OS instances...

An out of sync boot archive was detected on /dev/dsk/c0t1d0s0.
The boot archive is a cache of files used during boot and
should be kept in syncto ensure proper system operation.

Do you wish to automatically update this boot archive? [y,n,?] <tt><b>y</b></tt> 
Updating boot archive on /dev/dsk/c0t1d0s0.
The boot archive on /dev/dsk/c0t1d0s0 was updated successfully.

Solaris 5.10 was found on /dev/dsk/c0t1d0s0.
Do you wish to have it mounted read-write on /a? [y,n,?] <tt><b>n</b></tt>
Starting shell.
#</pre><a name="ggvjn"></a><h6>Example&nbsp;12-8 SPARC: Booting the Failsafe Archive for a Specified ZFS Dataset</h6><p>This example shows how to boot the failsafe archive of a ZFS
dataset. Note that the <tt>boot</tt> <tt>-L</tt> command is first used to display a list
of available boot environments. This command must be run at the <tt>ok</tt> prompt.</p><pre>ok <tt><b>boot -L</b></tt>
Rebooting with command: boot -L                                       
Boot device: /pci@1f,4000/scsi@3/disk@1,0  File and args: -L
1 zfsBE2
Select environment to boot: [ 1 - 1 ]: <tt><b>1</b></tt>

To boot the selected entry, invoke:
boot [&lt;root-device&gt;] -Z rpool/ROOT/zfsBE2

Program terminated
{0} ok 





Resetting ... 

screen not found.
Can't open input device.
Keyboard not present.  Using ttya for input and output.

Sun Enterprise 220R (2 X UltraSPARC-II 450MHz), No Keyboard
OpenBoot 3.23, 1024 MB memory installed, Serial #13116682.
Ethernet address 8:0:20:c8:25:a, Host ID: 80c8250a.



                                                                      
{0} ok  <tt><b>boot -F failsafe -Z rpool/ROOT/zfsBE2</b></tt>
Boot device: /pci@1f,4000/scsi@3/disk@1,0  File and args: -F failsafe -Z 
rpool/ROOT/zfsBE2
SunOS Release 5.10
Copyright 1983-2008 Sun Microsystems, Inc.  All rights reserved.
Use is subject to license terms.
Configuring /dev
Searching for installed OS instances...

ROOT/zfsBE2 was found on rpool.
Do you wish to have it mounted read-write on /a? [y,n,?] <tt><b>y</b></tt>
mounting rpool on /a

Starting shell.
# 
# 
# 
# <tt><b>zpool list</b></tt>
NAME    SIZE   USED  AVAIL    CAP  HEALTH  ALTROOT
rpool  16.8G  6.26G  10.5G    37%  ONLINE  /a
# 
# <tt><b>zpool status</b></tt>
  pool: rpool
 state: ONLINE
 scrub: none requested
config:

        NAME        STATE     READ WRITE CKSUM
        rpool       ONLINE       0     0     0
          c0t1d0s0  ONLINE       0     0     0

errors: No known data errors
# 
# df -h
Filesystem             size   used  avail capacity  Mounted on
/ramdisk-root:a        163M   153M     0K   100%    /
/devices                 0K     0K     0K     0%    /devices
/dev                     0K     0K     0K     0%    /dev
ctfs                     0K     0K     0K     0%    /system/contract
proc                     0K     0K     0K     0%    /proc
mnttab                   0K     0K     0K     0%    /etc/mnttab
swap                   601M   344K   601M     1%    /etc/svc/volatile
objfs                    0K     0K     0K     0%    /system/object
sharefs                  0K     0K     0K     0%    /etc/dfs/sharetab
swap                   602M   1.4M   601M     1%    /tmp
/tmp/root/etc          602M   1.4M   601M     1%    /.tmp_proto/root/etc
fd                       0K     0K     0K     0%    /dev/fd
rpool/ROOT/zfsBE2       16G   5.7G   9.8G    37%    /a
rpool/export            16G    20K   9.8G     1%    /a/export
rpool/export/home       16G    18K   9.8G     1%    /a/export/home
rpool                   16G    63K   9.8G     1%    /a/rpool</pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ggqhf.html">Previous</a>
             </td>
             <td align="right">
                 <a href="hbsparcboot-60.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

