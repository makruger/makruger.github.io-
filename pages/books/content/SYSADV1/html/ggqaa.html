<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Booting From a ZFS Root File System on an x86 Based System - System Administration Guide: Basic Administration</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-12-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Basic Administration</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="hbx86boot-68676.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ggqdn.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol1preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="saroadmap-1.html">1.&nbsp;&nbsp;Solaris Management Tools (Road Map)</a></p>
<p class="toc level1 tocsp"><a href="smcover-1.html">2.&nbsp;&nbsp;Working With the Solaris Management Console (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ewpor.html">3.&nbsp;&nbsp;Working With the Sun Java Web Console (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="userconcept-97366.html">4.&nbsp;&nbsp;Managing User Accounts and Groups (Overview)</a></p>
<p class="toc level1 tocsp"><a href="usersetup-92366.html">5.&nbsp;&nbsp;Managing User Accounts and Groups (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="clientconcept-15236.html">6.&nbsp;&nbsp;Managing Client-Server Support (Overview)</a></p>
<p class="toc level1 tocsp"><a href="clientsetup-1.html">7.&nbsp;&nbsp;Managing Diskless Clients (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="hbintro-66644.html">8.&nbsp;&nbsp;Introduction to Shutting Down and Booting a System</a></p>
<p class="toc level1 tocsp"><a href="hboverview-25463.html">9.&nbsp;&nbsp;Shutting Down and Booting a System (Overview)</a></p>
<p class="toc level1 tocsp"><a href="hbsyshalt-84412.html">10.&nbsp;&nbsp;Shutting Down a System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="grubtasks-1.html">11.&nbsp;&nbsp;Modifying Solaris Boot Behavior (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="hbsparcboot-79782.html">12.&nbsp;&nbsp;Booting a Solaris System (Tasks)</a></p>
<p class="toc level2"><a href="hbsparcboot-69.html">Booting a SPARC Based System (Task Map)</a></p>
<p class="toc level2"><a href="hbsparcboot-9.html">Booting a SPARC Based System</a></p>
<p class="toc level2"><a href="ggqhf.html">Booting From a ZFS Root File System on a SPARC Based System</a></p>
<p class="toc level2"><a href="ggqqq.html">Booting the Failsafe Archive on a SPARC Based System</a></p>
<p class="toc level2"><a href="hbsparcboot-60.html">Booting a SPARC Based System From the Network</a></p>
<p class="toc level2"><a href="hbx86boot-68676.html">Booting an x86 Based System by Using GRUB (Task Map)</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Booting From a ZFS Root File System on an x86 Based System</a></p>
</div>
<p class="toc level2"><a href="ggqdn.html">Booting the Failsafe Archive on an x86 Based System</a></p>
<p class="toc level2"><a href="ghsut.html">Using Fast Reboot on the x86 Platform (Task Map)</a></p>
<p class="toc level2"><a href="fvzok.html">Booting an x86 Based System from the Network</a></p>
<p class="toc level1 tocsp"><a href="hbtsboot-1.html">13.&nbsp;&nbsp;Troubleshooting Booting a Solaris System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="archive-123.html">14.&nbsp;&nbsp;Managing the Solaris Boot Archives (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="hbsysboot-76719.html">15.&nbsp;&nbsp;x86: GRUB Based Booting (Reference)</a></p>
<p class="toc level1 tocsp"><a href="hbrunlevels-25516.html">16.&nbsp;&nbsp;Managing Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="faauf.html">17.&nbsp;&nbsp;Managing Services (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="swmgrpkgsconcepts-52619.html">18.&nbsp;&nbsp;Managing Software (Overview)</a></p>
<p class="toc level1 tocsp"><a href="swmgrpkgsgui-1.html">19.&nbsp;&nbsp;Managing Software With Solaris System Administration Tools (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="swmgrpkgscli-1.html">20.&nbsp;&nbsp;Managing Software by Using Package Commands (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="swmgrpatchtasks-1.html">21.&nbsp;&nbsp;Managing Solaris Patches by Using the <tt>patchadd</tt> Command (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fddwm.html">A.&nbsp;&nbsp;SMF Services</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="ggqaa"></a><h3>Booting From a ZFS Root File System on an x86 Based System</h3>
<p>To support booting a ZFS root file system on the x86 platform,
a new GRUB keyword, <tt>$ZFS-BOOTFS</tt>, has been introduced.  If a root device contains
a ZFS pool, this keyword is assigned a value, which is then
passed to the kernel by using the <tt>-B</tt> option to identify the dataset to
boot. If you install or upgrade your system with a Solaris release that
supports a ZFS boot loader, the GRUB <tt>menu.lst</tt> file, as well as the
GRUB boot menu, contains this information by default.</p>

<a name="ggvjb"></a><h4>How to Display a List of the Available ZFS Boot Environments on an x86 Based System</h4><ol>
<li><b>Become superuser or assume an equivalent role.</b></li>
<li><b>To display a list of available BEs on the system, type the
following command:</b><pre># <tt><b>lustatus</b></tt></pre><p>Note that the <tt>lustatus</tt> command can also be used on SPARC based systems.</p>
<hr><p><b>Note - </b>If the following error is displayed when you run the <tt>lustatus</tt> command,
it is an indication that a new installation was performed and that Solaris
Live Upgrade was not used. Before any BEs can be acknowledged in the
<tt>lustatus</tt> output, a new BE must be first created on the system.</p><pre># <tt><b>lustatus</b></tt>
ERROR: No boot environments are configured on this system
ERROR: cannot determine list of all boot environment names</pre>
<hr>
<p>For more information about using Solaris Live Upgrade to migrate a UFS root
file system to a ZFS root file system, see <a href="http://docs.sun.com/doc/817-2271/ggpdm?a=view">Migrating a UFS Root File System to a ZFS Root File System (Solaris Live Upgrade) in <i>Solaris ZFS Administration Guide</i></a>.</p></li></ol><a name="ggvjy"></a><h6>Example&nbsp;12-12 Displaying a List of Available ZFS Bootable Datasets by Using the <tt>lustatus</tt> Command</h6><p>In this example, the output of the <tt>lustatus</tt> command shows the status of
three ZFS bootable datasets. The default boot environment is <tt>be1</tt> and therefore cannot
be deleted.</p><pre># <tt><b>lustatus</b></tt>
Boot Environment           Is       Active Active    Can    Copy
Name                       Complete Now    On Reboot Delete Status
-------------------------- -------- ------ --------- ------ ----------
s10s_nbu6wos               yes      no     no        yes    -
zfs2BE                     yes      yes    yes       no     -
zfsbe3                     no       no     no        yes    -
#</pre><p>If the BE has been created and is bootable, a &ldquo;yes&rdquo; appears in
the <tt>Is Complete</tt> column. If a BE has been created, but is not yet
activated, a 'no&rdquo; appears in this column. To activate a BE, use the
<tt>luactivate</tt> command. Run the <tt>lustatus</tt> command afterwards to verify that the BE was
successfully activated.</p><p>For more information see the <a href="http://docs.sun.com/doc/819-2240/lustatus-1m?a=view"><tt>lustatus</tt>(1M)</a> and the <a href="http://docs.sun.com/doc/819-2240/luactivate-1m?a=view"><tt>luactivate</tt>(1M)</a>man pages.</p>

<a name="ggqgk"></a><h4>How to Boot From a ZFS Root File System on an x86 Based System</h4><a name="indexterm-184"></a><a name="indexterm-185"></a><a name="indexterm-186"></a><p>This procedure describes how to boot from a ZFS root file system
on an x86 system that supports a ZFS boot loader.</p><p>Note that if you install or upgrade your system to a Solaris
release that supports a ZFS boot loader, the GRUB menu entry contains the
<tt>-B $ZFS-BOOTFS</tt> boot argument by default, so the system boots from ZFS without requiring
any additional boot arguments.</p><ol>
<li><a name="ggqdq"></a><b>Reboot the system.</b><pre># <tt><b>reboot</b></tt></pre><p>If the system displays the <tt>Press any key to reboot</tt> prompt, press any key to reboot the
system.</p><p>You can also use the Reset button at this prompt. If the
system is shut down, turn the system on with the power switch.</p><p>When the boot sequence begins, the GRUB main menu is displayed. If
the default boot entry is a ZFS file system menu is similar to
the following:</p><pre>GNU GRUB  version 0.95  (637K lower / 3144640K upper memory)
 +----------------------------------------------------------------+
| be1
| be1 failsafe
| be3
| be3 failsafe
| be2
| be2 failfafe
  +---------------------------------------------------------------+
      Use the ^ and v keys to select which entry is highlighted.
      Press enter to boot the selected OS, 'e' to edit the
      commands before booting, or 'c' for a command-line.</pre></li>
<li><b>When the GRUB menu is displayed, press Enter to boot the default OS
instance.</b><p>If you do not choose an entry within 10 seconds, the system automatically
boots to run level 3.</p></li>
<li><b>To boot another BE, use the arrow keys to highlight the specified boot
entry.</b></li>
<li><b>Type <tt>b</tt> to boot this entry or <tt>e</tt> to edit the entry.</b><p>If you type <tt>e</tt> to edit the entry, the default menu for booting
a system with a ZFS root would appear as follows:</p><pre>findroot (BE_be10,0,a)
kernel$ /platform/i86pc/kernel/$ISADIR/unix -B $ZFS-BOOTFS
module$ /platform/i86pc/$ISADIR/boot-archive</pre><p>For more information about GRUB menu entries at boot time, see<a href="getov.html#fwbme">x86: How to Modify Boot Behavior by Editing the GRUB Menu at Boot Time</a>.</p></li></ol><a name="ggyac"></a><h6>Example&nbsp;12-13 x86: Activating a New Boot Environment on an x86 Based System</h6><p>This example shows the steps that are followed to activate a boot
environment, <tt>be10</tt>, on a system. Note that the l<tt>ustatus</tt> command is run first,
to determine which BEs on the system are active and which BEs require
activation.</p><pre># <tt><b>lustatus</b></tt>
Boot Environment           Is       Active Active    Can    Copy
Name                      Complete Now    On Reboot Delete Status
-----------------------------------------------------------------
be1                        yes      yes    yes       no     
be10                       yes      no     no        yes



# <tt><b>luactivate be10</b></tt>
System has findroot enabled GRUB Generating boot-sign, partition and slice
information for PBE &lt;be1&gt;
WARNING: The following file s have change on both the current boot environment
&lt;be1&gt; zone &lt;global&gt; and the boot environment to be activitate &lt;be10&gt;
        /etc/zfs/zpool.cache
INFORMATION: The files listed above are in conflict between the current
boot environment &lt;be1&gt; zone &lt;global&gt; and the boot environment to be
activated &lt;be10&gt;. These files will not be automatically synchronized from
the current boot environment &lt;be1&gt; when boot environment &lt;be10&gt; is activated.

Setting failsafe console to &lt;ttyb&gt;
Generating boot-sign for ABE &lt;be10&gt;
Generating partition and slice information for ABE &lt;be10&gt;
Copied boot menu from top level dataset.
Generating direct boot menu entries for PBE.
Generating direct boot menu entries for ABE.
Disabling splashimage
Current GRUB menu default setting is not valid
title Solaris bootenv rc
No more bootadm entries. Deletion of bootadm entries is complete.
GRUB menu default setting is unchanged
Done eliding bootadm entries.
**************************************************************
The target boot environment has been activated. It will be used when you
reboot. NOTE: You MUST NOT USE the reboot, halt, or uadmin commands. You
MUST USE either the init or the shutdown command when you reboot. If you
do not use either init or shutdown, the system will not boot using the
target BE.
***************************************************************
,,,


# <tt><b>reboot</b></tt>
May 30 09:52:32 pups reboot: initiated by root on /dev/console
syncing file systems... done
rebooting...

CE SDRAM BIOS P/N GR-xlint.007-4.330
*

BIOS Lan-Console 2.0
Copyright (C) 1999-2001 Intel Corporation
.
.
.
GNU GRUB  version 0.95  (637K lower / 3144640K upper memory)
 +-------------------------------------------------------------------+
| be1
| be1 failsafe
| be10
| be10 failsafe
+------------------------------------------------------------------+
      Use the ^ and v keys to select which entry is highlighted.
      Press enter to boot the selected OS, 'e' to edit the
      commands before booting, or 'c' for a command-line.

SunOS Release 5.10 32-bit
Copyright 1983-2008 Sun Microsystems, Inc.  All rights reserved.
Use is subject to license terms.

Hostname: pups
NIS domain name is sunsoft.eng.sun.com
Reading ZFS config: done.
Mounting ZFS filesystems: (8/8)

pups console login:
# <tt><b>lustatus</b></tt>
Boot Environment           Is       Active Active    Can    Copy
Name                      Complete Now    On Reboot Delete Status
-----------------------------------------------------------------
be1                        yes      yes    yes       no     
be10                       yes      yes    yes       no
# </pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="hbx86boot-68676.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ggqdn.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

