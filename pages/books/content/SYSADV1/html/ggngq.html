<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Managing the boot-archive Service - System Administration Guide: Basic Administration</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-12-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Basic Administration</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ggnke.html">Previous</a>
             </td>
             <td align="right">
                 <a href="gglaj.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol1preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="saroadmap-1.html">1.&nbsp;&nbsp;Solaris Management Tools (Road Map)</a></p>
<p class="toc level1 tocsp"><a href="smcover-1.html">2.&nbsp;&nbsp;Working With the Solaris Management Console (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ewpor.html">3.&nbsp;&nbsp;Working With the Sun Java Web Console (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="userconcept-97366.html">4.&nbsp;&nbsp;Managing User Accounts and Groups (Overview)</a></p>
<p class="toc level1 tocsp"><a href="usersetup-92366.html">5.&nbsp;&nbsp;Managing User Accounts and Groups (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="clientconcept-15236.html">6.&nbsp;&nbsp;Managing Client-Server Support (Overview)</a></p>
<p class="toc level1 tocsp"><a href="clientsetup-1.html">7.&nbsp;&nbsp;Managing Diskless Clients (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="hbintro-66644.html">8.&nbsp;&nbsp;Introduction to Shutting Down and Booting a System</a></p>
<p class="toc level1 tocsp"><a href="hboverview-25463.html">9.&nbsp;&nbsp;Shutting Down and Booting a System (Overview)</a></p>
<p class="toc level1 tocsp"><a href="hbsyshalt-84412.html">10.&nbsp;&nbsp;Shutting Down a System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="grubtasks-1.html">11.&nbsp;&nbsp;Modifying Solaris Boot Behavior (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="hbsparcboot-79782.html">12.&nbsp;&nbsp;Booting a Solaris System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="hbtsboot-1.html">13.&nbsp;&nbsp;Troubleshooting Booting a Solaris System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="archive-123.html">14.&nbsp;&nbsp;Managing the Solaris Boot Archives (Tasks)</a></p>
<p class="toc level2"><a href="gglbi.html">Managing the Solaris Boot Archives (Task Map)</a></p>
<p class="toc level2"><a href="ggnke.html">Description of the Solaris Boot Archives</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Managing the <tt>boot-archive</tt> Service</a></p>
</div>
<p class="toc level2"><a href="gglaj.html">Using the <tt>bootadm</tt> Command to Manage the Boot Archives</a></p>
<p class="toc level1 tocsp"><a href="hbsysboot-76719.html">15.&nbsp;&nbsp;x86: GRUB Based Booting (Reference)</a></p>
<p class="toc level1 tocsp"><a href="hbrunlevels-25516.html">16.&nbsp;&nbsp;Managing Services (Overview)</a></p>
<p class="toc level1 tocsp"><a href="faauf.html">17.&nbsp;&nbsp;Managing Services (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="swmgrpkgsconcepts-52619.html">18.&nbsp;&nbsp;Managing Software (Overview)</a></p>
<p class="toc level1 tocsp"><a href="swmgrpkgsgui-1.html">19.&nbsp;&nbsp;Managing Software With Solaris System Administration Tools (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="swmgrpkgscli-1.html">20.&nbsp;&nbsp;Managing Software by Using Package Commands (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="swmgrpatchtasks-1.html">21.&nbsp;&nbsp;Managing Solaris Patches by Using the <tt>patchadd</tt> Command (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fddwm.html">A.&nbsp;&nbsp;SMF Services</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="ggngq"></a><h3>Managing the <tt>boot-archive</tt> Service</h3>
<a name="indexterm-248"></a><a name="indexterm-249"></a><a name="indexterm-250"></a><p>The <tt>boot-archive</tt> service is controlled by the Service Management Facility (SMF). The boot-archive
service instance is <tt>svc:/system/boot-archive:default</tt>. The <tt>svcadm</tt> command is used to enable and
disable services.</p><p>To verify whether the <tt>boot-archive</tt> service is running, use the <tt>svcs</tt> command.</p><p>For more information, see the <a href="http://docs.sun.com/doc/819-2240/svcadm-1m?a=view"><tt>svcadm</tt>(1M)</a> and the <a href="http://docs.sun.com/doc/819-2239/svcs-1?a=view"><tt>svcs</tt>(1)</a> man pages.</p>

<a name="ggnih"></a><h4>How to Enable or Disable the <tt>boot-archive</tt> Service</h4><ol>
<li><b>Become superuser or assume an equivalent role.</b></li>
<li><b>To enable or disable the <tt>boot-archive</tt> service, type:</b><pre># <tt><b>svcadm enable | disable system/boot-archive</b></tt></pre></li>
<li><b>To verify the state of the <tt>boot-archive</tt> service, type:</b><pre>% <tt>svcs boot-archive</tt></pre><p>If the service is running, the output displays an online service state.</p><pre>STATE          STIME    FMRI
online          9:02:38 svc:/system/boot-archive:default</pre><p>If the service is not running, the output indicates the service is
offline.</p></li></ol><h6>Troubleshooting</h6><p>For information about updating the boot archive by clearing the <tt>boot-archive</tt> service,
see <a href="#gglbw">How to Update an Inconsistent Boot Archive by Clearing the <tt>boot-archive</tt> Service</a>.</p>

<a name="gglbw"></a><h4>How to Update an Inconsistent Boot Archive by Clearing the <tt>boot-archive</tt> Service</h4><p>The boot-archive service, <tt>svc:/system/boot-archive</tt>, is managed by SMF. This procedure shows how to
update the boot archive when an inconsistent archive is detected during the boot
process. Clearing the service works the same as running the <tt>boot</tt> <tt>-F</tt> <tt>failsafe</tt>
command. Note that when you use this method to update the boot archives,
there is no need to boot the failsafe archive or run the
<tt>bootadm update-archive</tt> command. This command runs silently after the boot-archive service has been cleared.</p>
<hr><p><b>Caution - </b>The preferred method for correcting an inconsistent boot archive is to boot the
system in failsafe mode. See the following references for instructions on booting the
failsafe archive:</p><p>For SPARC based systems, see <a href="hbsparcboot-60.html">Booting a SPARC Based System From the Network</a>.</p><p>For x86 based systems, see <a href="ggqdn.html">Booting the Failsafe Archive on an x86 Based System</a>.</p>
<hr>
<ol>
<li><b>During the process of booting the system, if a warning similar to the
following is displayed, ignore the warning.</b><pre>WARNING: The following files in / differ from the boot archive:

    changed <i>file-name</i></pre><p>The system will enter system maintenance mode.</p></li>
<li><b>Clear the boot-archive service by typing the following command:</b><pre># <tt><b>svcadm clear system/boot-archive</b></tt></pre><p>After this command is run, the <tt>bootadm update-archive</tt> command runs silently. If the boot
archive is updated successfully, the system is rebooted.</p></li>
<li><b>Verify the service is running.</b><pre># <tt><b>svcs boot-archive</b></tt>
STATE          STIME    FMRI
online          9:02:38 svc:/system/boot-archive:default</pre></li></ol><a name="gglcq"></a><h6>Example&nbsp;14-1 SPARC: Updating an inconsistent Boot Archive by Clearing the Boot-Archive Service</h6><pre>screen not found.
Can't open input device.
Keyboard not present.  Using ttya for input and output.

Sun Enterprise 220R (2 X UltraSPARC-II 450MHz), No Keyboard
OpenBoot 3.23, 1024 MB memory installed, Serial #13116682.
Ethernet address 8:0:20:c8:25:a, Host ID: 80c8250a.



Rebooting with command: boot                                          
Boot device: /pci@1f,4000/scsi@3/disk@1,0:a  File and args: 
SunOS Release 5.10 64-bit
Copyright 1983-2007 Sun Microsystems, Inc.  All rights reserved.
Use is subject to license terms.
DEBUG enabled
misc/forthdebug (507204 bytes) loaded
Hostname: marnie

WARNING: The following files in / differ from the boot archive:

    changed /kernel/drv/sd.conf

The recommended action is to reboot to the failsafe archive to correct
the above inconsistency. To accomplish this, on a GRUB-based platform,
reboot and select the "Solaris failsafe" option from the boot menu.
On an OBP-based platform, reboot then type "boot -F failsafe". Then
follow the prompts to update the boot archive. Alternately, to continue
booting at your own risk, you may clear the service by running:
"svcadm clear system/boot-archive"

Nov 21 15:47:20 svc.startd[100004]: svc:/system/boot-archive:default: Method 
"/lib/svc/method/boot-archive" failed with exit status 95.
Nov 21 15:47:20 svc.startd[100004]: system/boot-archive:default failed fatally: 
transitioned to maintenance (see 'svcs -xv' for details)
Requesting System Maintenance Mode
(See /lib/svc/share/README for more information.)
Console login service(s) cannot run

Root password for system maintenance (control-d to bypass): 
single-user privilege assigned to /dev/console.
Entering System Maintenance Mode

Nov 21 15:48:36 su: 'su root' succeeded for root on /dev/console
Sun Microsystems Inc.   SunOS 5.10, 
2007
.
.
.# 
# 
# <tt><b>svcadm clear system/boot-archive</b></tt>
# 
# NIS domain name is mpklab.sfbay.sun.com
/dev/rdsk/c0t1d0s5 is clean
Reading ZFS config: done.
#
# bootadm update-archive
# <tt><b>svcs boot-archive</b></tt>
STATE          STIME    FMRI
online          9:02:38 svc:/system/boot-archive:default</pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ggnke.html">Previous</a>
             </td>
             <td align="right">
                 <a href="gglaj.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

