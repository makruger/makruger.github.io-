<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Transport and Tunnel Modes in IPsec - System Administration Guide: IP Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: IP Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ipsec-ov-12.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ipsec-ov-15.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="iptm-1.html">Part&nbsp;I&nbsp;TCP/IP Administration</a></p>
<p class="toc level2"><a href="ipov-1.html">1.&nbsp;&nbsp;Solaris TCPIP Protocol Suite (Overview)</a></p>
<p class="toc level2"><a href="ipplan-1.html">2.&nbsp;&nbsp;Planning an IPv4 Addressing Scheme (Tasks</a></p>
<p class="toc level2"><a href="ipv6-overview-7.html">3.&nbsp;&nbsp;Planning an IPv6 Addressing Scheme (Overview)</a></p>
<p class="toc level2"><a href="ipv6-planning-1.html">4.&nbsp;&nbsp;Planning an IPv6 Network (Tasks)</a></p>
<p class="toc level2"><a href="ipconfig-1.html">5.&nbsp;&nbsp;Configuring TCP/IP Network Services and IPv4 Addressing (Tasks)</a></p>
<p class="toc level2"><a href="fwawf.html">6.&nbsp;&nbsp;Administering Network Interfaces (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-config-tasks-1.html">7.&nbsp;&nbsp;Enabling IPv6 on a Network (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-admintasks-1.html">8.&nbsp;&nbsp;Administering a TCP/IP Network (Tasks)</a></p>
<p class="toc level2"><a href="gegel.html">9.&nbsp;&nbsp;Troubleshooting Network Problems (Tasks)</a></p>
<p class="toc level2"><a href="ipref-8.html">10.&nbsp;&nbsp;TCP/IP and IPv4 in Depth (Reference)</a></p>
<p class="toc level2"><a href="ipv6-ref-76.html">11.&nbsp;&nbsp;IPv6 in Depth (Reference)</a></p>
<p class="toc level1 tocsp"><a href="dhcptm-1.html">Part&nbsp;II&nbsp;DHCP</a></p>
<p class="toc level2"><a href="dhcp-overview-1.html">12.&nbsp;&nbsp;About Solaris DHCP (Overview)</a></p>
<p class="toc level2"><a href="chap2-26.html">13.&nbsp;&nbsp;Planning for DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="chapter3-20.html">14.&nbsp;&nbsp;Configuring the DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="dhcp-admin-9.html">15.&nbsp;&nbsp;Administering DHCP (Tasks)</a></p>
<p class="toc level2"><a href="eyatl.html">16.&nbsp;&nbsp;Configuring and Administering  DHCP Clients</a></p>
<p class="toc level2"><a href="dhcp-trouble-1.html">17.&nbsp;&nbsp;Troubleshooting DHCP (Reference)</a></p>
<p class="toc level2"><a href="dhcp-ref-4.html">18.&nbsp;&nbsp;DHCP Commands and Files (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipsectm-1.html">Part&nbsp;III&nbsp;IP Security</a></p>
<p class="toc level2"><a href="ipsec-ov-1.html">19.&nbsp;&nbsp;IP Security Architecture (Overview)</a></p>
<p class="toc level3"><a href="ipsec-ov-25.html">What's New in IPsec?</a></p>
<p class="toc level3"><a href="ipsec-ov-2.html">Introduction to IPsec</a></p>
<p class="toc level3"><a href="ipsec-ov-54.html">IPsec Packet Flow</a></p>
<p class="toc level3"><a href="ipsec-ov-5.html">IPsec Security Associations</a></p>
<p class="toc level3"><a href="ipsec-ov-7.html">IPsec Protection Mechanisms</a></p>
<p class="toc level3"><a href="ipsec-ov-12.html">IPsec Protection Policies</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Transport and Tunnel Modes in IPsec</a></p>
</div>
<p class="toc level3"><a href="ipsec-ov-15.html">Virtual Private Networks and IPsec</a></p>
<p class="toc level3"><a href="ipsec-ov-24.html">IPsec and NAT Traversal</a></p>
<p class="toc level3"><a href="ipsec-ov-22.html">IPsec and SCTP</a></p>
<p class="toc level3"><a href="ipsec-ov-18.html">IPsec and Solaris Zones</a></p>
<p class="toc level3"><a href="ipsec-ov-21.html">IPsec Utilities and Files</a></p>
<p class="toc level3"><a href="ipsec-ov-16.html">Changes to IPsec for the Solaris 10 Release</a></p>
<p class="toc level2 tocsp"><a href="ipsec-mgtasks-1.html">20.&nbsp;&nbsp;Configuring IPsec (Tasks)</a></p>
<p class="toc level2"><a href="ipsecref-1.html">21.&nbsp;&nbsp;IP Security Architecture (Reference)</a></p>
<p class="toc level2"><a href="ike-1.html">22.&nbsp;&nbsp;Internet Key Exchange (Overview)</a></p>
<p class="toc level2"><a href="ike-task-1.html">23.&nbsp;&nbsp;Configuring IKE (Tasks)</a></p>
<p class="toc level2"><a href="ikeref-1.html">24.&nbsp;&nbsp;Internet Key Exchange (Reference)</a></p>
<p class="toc level2"><a href="eupsq.html">25.&nbsp;&nbsp;Solaris IP Filter (Overview)</a></p>
<p class="toc level2"><a href="ipfilter-admin-1.html">26.&nbsp;&nbsp;Solaris IP Filter (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="miptm-1.html">Part&nbsp;IV&nbsp;Mobile IP</a></p>
<p class="toc level2"><a href="mipoverview-1.html">27.&nbsp;&nbsp;Mobile IP (Overview)</a></p>
<p class="toc level2"><a href="mipimplementing-1.html">28.&nbsp;&nbsp;Administering Mobile IP (Tasks)</a></p>
<p class="toc level2"><a href="mipmanaging-22.html">29.&nbsp;&nbsp;Mobile IP Files and Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipmptm-1.html">Part&nbsp;V&nbsp;IPMP</a></p>
<p class="toc level2"><a href="mpoverview.html">30.&nbsp;&nbsp;Introducing IPMP (Overview)</a></p>
<p class="toc level2"><a href="deploynetmult-56.html">31.&nbsp;&nbsp;Administering IPMP (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ipqostm-1.html">Part&nbsp;VI&nbsp;IP Quality of Service (IPQoS)</a></p>
<p class="toc level2"><a href="ipqos-intro-1.html">32.&nbsp;&nbsp;Introducing IPQoS (Overview)</a></p>
<p class="toc level2"><a href="ipqos-config-planning-1.html">33.&nbsp;&nbsp;Planning for an IPQoS-Enabled Network (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-policy-planning-1.html">34.&nbsp;&nbsp;Creating the IPQoS Configuration File (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-isp-setup-1.html">35.&nbsp;&nbsp;Starting and Maintaining IPQoS (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-accounting-1.html">36.&nbsp;&nbsp;Using Flow Accounting and Statistics Gathering (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-reference-1.html">37.&nbsp;&nbsp;IPQoS in Detail (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="ipsec-ov-13"></a><h3>Transport and Tunnel Modes in IPsec</h3>
<a name="indexterm-1691"></a><a name="indexterm-1692"></a><a name="indexterm-1693"></a><a name="indexterm-1694"></a><a name="indexterm-1695"></a><p>The IPsec standards define two distinct modes of IPsec operation, transport mode and
tunnel mode. The modes do not affect the encoding of packets. The packets
are protected by AH, ESP, or both in each mode. The modes differ
in policy application when the inner packet is an IP packet.</p>
<ul><li><p>In transport mode, the outer header determines the IPsec policy that protects the inner IP packet.</p></li>
<li><p>In tunnel mode, the inner IP packet determines the IPsec policy that protects its contents.</p></li></ul>
<p><a name="indexterm-1696"></a>In transport mode, the outer header, the next header, and any ports that
the next header supports, can be used to determine IPsec policy. In effect,
IPsec can enforce different transport mode policies between two IP addresses to the
granularity of a single port. For example, if the next header is TCP,
which supports ports, IPsec policy can be set for a TCP port of
the outer IP address. Similarly, if the next header is an IP
header, the outer header and the inner IP header can be used to
determine IPsec policy.</p><p><a name="indexterm-1697"></a>Tunnel mode works only on IP-in-IP datagrams. Tunneling in tunnel mode can be
useful when computer workers at home are connecting to a central computer location.
In tunnel mode, IPsec policy is enforced on the contents of the inner
IP datagram. Different IPsec policies can be enforced for different inner IP addresses.
That is, the inner IP header, its next header, and the ports that
the next header supports, can enforce a policy. Unlike transport mode, in tunnel
mode the outer IP header does not dictate the policy of its inner
IP datagram.</p><p>Therefore, in tunnel mode, IPsec policy can be specified for subnets of a
LAN behind a router and can be specified for ports on those subnets.
IPsec policy can also be specified for particular IP addresses, that is, hosts,
on those subnets. The ports of those hosts can also have a specific
IPsec policy. However, if a dynamic routing protocol is run over a tunnel,
neither subnet selection nor address selection should be used, because the view of
the network topology on the peer network could change.  Changes would invalidate
the static IPsec policy.  For examples of tunneling procedures that include configuring
static routes, see  <a href="ipsec-mgtasks-vpn-4.html">Protecting a VPN With IPsec</a>.</p><p><a name="indexterm-1698"></a><a name="indexterm-1699"></a>In Solaris, tunnel mode can be enforced only on an IP tunneling network
interface. The <tt>ipsecconf</tt> command provides a <tt>tunnel</tt> keyword to select an IP
tunneling network interface. When the <tt>tunnel</tt> keyword is present in a rule,
all selectors that are specified in that rule apply to the inner packet.</p><p>In transport mode, ESP, AH, or both ESP and AH, can protect the
datagram.</p><p><a href="#ipsec-ov-fig-5">Figure&nbsp;19-3</a> shows an IP header with an unprotected TCP packet.</p><a name="ipsec-ov-fig-5"></a><h6>Figure&nbsp;19-3 Unprotected IP Packet Carrying TCP Information</h6><img src="figures/IPsecHdr1.gif" alt="Diagram shows the IP header followed by the TCP header. The TCP header is not protected."></img><p><a name="indexterm-1700"></a>In transport mode, ESP protects the data as shown in <a href="#ipsec-ov-fig-7">Figure&nbsp;19-4</a>.</p><a name="ipsec-ov-fig-7"></a><h6>Figure&nbsp;19-4 Protected IP Packet Carrying TCP Information</h6><img src="figures/IPsecHdr2.gif" alt="Diagram shows the ESP header between the IP header and the TCP header. The TCP header is encrypted by the ESP header."></img><p><a name="indexterm-1701"></a>In transport mode, AH protects the data as shown in <a href="#ipsec-ov-fig-8">Figure&nbsp;19-5</a>.</p><a name="ipsec-ov-fig-8"></a><h6>Figure&nbsp;19-5 Packet Protected by an Authentication Header</h6><img src="figures/IPsecHdr3.gif" alt="Diagram shows the AH header between the IP header and the TCP header."></img><p>AH actually covers the data before the data appears in the datagram. Consequently,
the protection that is provided by AH, even in transport mode, covers some
of the IP header.</p><p><a name="indexterm-1702"></a>In tunnel mode, the entire datagram is <b>inside</b> the protection of an IPsec header.
The datagram in <a href="#ipsec-ov-fig-5">Figure&nbsp;19-3</a> is protected in tunnel mode by an outer
IPsec header, and in this case ESP, as is shown in <a href="#ipsec-ov-fig-6">Figure&nbsp;19-6</a>.</p><a name="ipsec-ov-fig-6"></a><h6>Figure&nbsp;19-6 IPsec Packet Protected in Tunnel Mode</h6><img src="figures/IPsecHdr4.gif" alt="Diagram shows the ESP header after the IP header and before an IP header and a TCP header. The last 2 headers are protected by encryption."></img><p>The <tt>ipsecconf</tt> command includes keywords to set tunnels in tunnel mode or in
transport mode.</p>
<ul><li><p>For details on per-socket policy, see the <a href="http://docs.sun.com/doc/819-2254/ipsec-7p?a=view"><tt>ipsec</tt>(7P)</a> man page.</p></li>
<li><p>For an example of per-socket policy, see <a href="ipsec-mgtasks-4.html#ipsec-mgtasks-16">How to Secure a Web Server With IPsec</a>.</p></li>
<li><p>For more information about tunnels, see the <a href="http://docs.sun.com/doc/819-2240/ipsecconf-1m?a=view"><tt>ipsecconf</tt>(1M)</a> man page.</p></li>
<li><p>For an example of tunnel configuration, see <a href="ipsec-mgtasks-vpn-4.html#ipsec-mgtasks-23">How to Protect a VPN With an IPsec Tunnel in Tunnel Mode Over IPv4</a>.</p></li></ul>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ipsec-ov-12.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ipsec-ov-15.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

