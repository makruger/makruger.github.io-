<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Differentiated Services Model - System Administration Guide: IP Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: IP Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ipqos-intro-90.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ipqos-intro-54.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="iptm-1.html">Part&nbsp;I&nbsp;TCP/IP Administration</a></p>
<p class="toc level2"><a href="ipov-1.html">1.&nbsp;&nbsp;Solaris TCPIP Protocol Suite (Overview)</a></p>
<p class="toc level2"><a href="ipplan-1.html">2.&nbsp;&nbsp;Planning an IPv4 Addressing Scheme (Tasks</a></p>
<p class="toc level2"><a href="ipv6-overview-7.html">3.&nbsp;&nbsp;Planning an IPv6 Addressing Scheme (Overview)</a></p>
<p class="toc level2"><a href="ipv6-planning-1.html">4.&nbsp;&nbsp;Planning an IPv6 Network (Tasks)</a></p>
<p class="toc level2"><a href="ipconfig-1.html">5.&nbsp;&nbsp;Configuring TCP/IP Network Services and IPv4 Addressing (Tasks)</a></p>
<p class="toc level2"><a href="fwawf.html">6.&nbsp;&nbsp;Administering Network Interfaces (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-config-tasks-1.html">7.&nbsp;&nbsp;Enabling IPv6 on a Network (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-admintasks-1.html">8.&nbsp;&nbsp;Administering a TCP/IP Network (Tasks)</a></p>
<p class="toc level2"><a href="gegel.html">9.&nbsp;&nbsp;Troubleshooting Network Problems (Tasks)</a></p>
<p class="toc level2"><a href="ipref-8.html">10.&nbsp;&nbsp;TCP/IP and IPv4 in Depth (Reference)</a></p>
<p class="toc level2"><a href="ipv6-ref-76.html">11.&nbsp;&nbsp;IPv6 in Depth (Reference)</a></p>
<p class="toc level1 tocsp"><a href="dhcptm-1.html">Part&nbsp;II&nbsp;DHCP</a></p>
<p class="toc level2"><a href="dhcp-overview-1.html">12.&nbsp;&nbsp;About Solaris DHCP (Overview)</a></p>
<p class="toc level2"><a href="chap2-26.html">13.&nbsp;&nbsp;Planning for DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="chapter3-20.html">14.&nbsp;&nbsp;Configuring the DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="dhcp-admin-9.html">15.&nbsp;&nbsp;Administering DHCP (Tasks)</a></p>
<p class="toc level2"><a href="eyatl.html">16.&nbsp;&nbsp;Configuring and Administering  DHCP Clients</a></p>
<p class="toc level2"><a href="dhcp-trouble-1.html">17.&nbsp;&nbsp;Troubleshooting DHCP (Reference)</a></p>
<p class="toc level2"><a href="dhcp-ref-4.html">18.&nbsp;&nbsp;DHCP Commands and Files (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipsectm-1.html">Part&nbsp;III&nbsp;IP Security</a></p>
<p class="toc level2"><a href="ipsec-ov-1.html">19.&nbsp;&nbsp;IP Security Architecture (Overview)</a></p>
<p class="toc level2"><a href="ipsec-mgtasks-1.html">20.&nbsp;&nbsp;Configuring IPsec (Tasks)</a></p>
<p class="toc level2"><a href="ipsecref-1.html">21.&nbsp;&nbsp;IP Security Architecture (Reference)</a></p>
<p class="toc level2"><a href="ike-1.html">22.&nbsp;&nbsp;Internet Key Exchange (Overview)</a></p>
<p class="toc level2"><a href="ike-task-1.html">23.&nbsp;&nbsp;Configuring IKE (Tasks)</a></p>
<p class="toc level2"><a href="ikeref-1.html">24.&nbsp;&nbsp;Internet Key Exchange (Reference)</a></p>
<p class="toc level2"><a href="eupsq.html">25.&nbsp;&nbsp;Solaris IP Filter (Overview)</a></p>
<p class="toc level2"><a href="ipfilter-admin-1.html">26.&nbsp;&nbsp;Solaris IP Filter (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="miptm-1.html">Part&nbsp;IV&nbsp;Mobile IP</a></p>
<p class="toc level2"><a href="mipoverview-1.html">27.&nbsp;&nbsp;Mobile IP (Overview)</a></p>
<p class="toc level2"><a href="mipimplementing-1.html">28.&nbsp;&nbsp;Administering Mobile IP (Tasks)</a></p>
<p class="toc level2"><a href="mipmanaging-22.html">29.&nbsp;&nbsp;Mobile IP Files and Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipmptm-1.html">Part&nbsp;V&nbsp;IPMP</a></p>
<p class="toc level2"><a href="mpoverview.html">30.&nbsp;&nbsp;Introducing IPMP (Overview)</a></p>
<p class="toc level2"><a href="deploynetmult-56.html">31.&nbsp;&nbsp;Administering IPMP (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ipqostm-1.html">Part&nbsp;VI&nbsp;IP Quality of Service (IPQoS)</a></p>
<p class="toc level2"><a href="ipqos-intro-1.html">32.&nbsp;&nbsp;Introducing IPQoS (Overview)</a></p>
<p class="toc level3"><a href="ipqos-intro-52.html">IPQoS Basics</a></p>
<p class="toc level3"><a href="ipqos-intro-6.html">Providing Quality of Service With IPQoS</a></p>
<p class="toc level3"><a href="ipqos-intro-90.html">Improving Network Efficiency With IPQoS</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Differentiated Services Model</a></p>
</div>
<p class="toc level3"><a href="ipqos-intro-54.html">Traffic Forwarding on an IPQoS-Enabled Network</a></p>
<p class="toc level2 tocsp"><a href="ipqos-config-planning-1.html">33.&nbsp;&nbsp;Planning for an IPQoS-Enabled Network (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-policy-planning-1.html">34.&nbsp;&nbsp;Creating the IPQoS Configuration File (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-isp-setup-1.html">35.&nbsp;&nbsp;Starting and Maintaining IPQoS (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-accounting-1.html">36.&nbsp;&nbsp;Using Flow Accounting and Statistics Gathering (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-reference-1.html">37.&nbsp;&nbsp;IPQoS in Detail (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="ipqos-intro-11"></a><h3>Differentiated Services Model</h3>
<p><a name="indexterm-2999"></a><a name="indexterm-3000"></a><a name="indexterm-3001"></a>IPQoS includes the following modules, which are part of the <b>Differentiated Services (Diffserv)</b> architecture
that is defined in RFC 2475:</p>
<ul><li><p>Classifier</p></li>
<li><p>Meter</p></li>
<li><p>Marker</p></li></ul>
<p>IPQoS adds the following enhancements to the Diffserv model:</p>
<ul><li><p>Flow-accounting module</p></li>
<li><p>802.1D datagram marker</p></li></ul>
<p>This section introduces the Diffserv modules as they are used by IPQoS. You
need to know about these modules, their names, and their uses to
set up the QoS policy. For detailed information about each module, refer to
<a href="ipqos-reference-2.html">IPQoS Architecture and the Diffserv Model</a>. </p>

<a name="ipqos-intro-17"></a><h4>Classifier <tt>(ipgpc)</tt> Overview</h4>
<p><a name="indexterm-3002"></a><a name="indexterm-3003"></a><a name="indexterm-3004"></a>In the Diffserv model, the <b>classifier</b> selects packets from a network traffic
flow. A <b>traffic flow</b> consists of a group of packets with identical information in
the following IP header fields:</p>
<ul><li><p>Source address</p></li>
<li><p>Destination address</p></li>
<li><p>Source port</p></li>
<li><p>Destination port</p></li>
<li><p><a name="indexterm-3005"></a>Protocol number</p></li></ul>
<p>In IPQoS, these fields are referred to as the <b>5-tuple</b>.</p><p>The IPQoS classifier module is named <tt>ipgpc</tt>. The <tt>ipgpc</tt> classifier arranges traffic
flows into classes that are based on characteristics you configure in the IPQoS
configuration file.</p><p>For detailed information about <tt>ipgpc</tt>, refer to <a href="ipqos-reference-2.html#ipqos-reference-3">Classifier Module</a>.</p>

<a name="ipqos-intro-26"></a><h5>IPQoS Classes</h5>
<p><a name="indexterm-3006"></a><a name="indexterm-3007"></a>A <b>class</b> is a group of network flows that share similar characteristics. For
example, an ISP might define classes to represent the different service levels that
are offered to customers. An ASP might define SLAs that give different levels
of service to various applications. For an ASP's QoS policy, a class might
include outgoing FTP traffic that is bound for a particular destination IP address.
Outgoing traffic from a company's external web site might also be defined as
a class. </p><p>Grouping traffic into classes is a major part of planning your QoS
policy. When you create classes by using the <tt>ipqosconf</tt> utility, you are actually configuring
the <tt>ipgpc</tt> classifier.</p><p>For information on how to define classes, see <a href="ipqos-config-planning-7.html#ipqos-config-planning-14">How to Define the Classes for Your QoS Policy</a>.</p>

<a name="ipqos-intro-27"></a><h5>IPQoS Filters</h5>
<p><a name="indexterm-3008"></a><a name="indexterm-3009"></a><b>Filters</b> are sets of rules that contain parameters called <b>selectors</b>. Each filter must
point to a class. IPQoS matches packets against the selectors of each filter
to determine if the packet belongs to the filter's class. You can filter
on a packet by using a variety of selectors, for example, the IPQoS
5-tuple and other common parameters:</p>
<ul><li><p>Source address and destination addresses</p></li>
<li><p>Source port and destination port </p></li>
<li><p>Protocol numbers</p></li>
<li><p>User IDs</p></li>
<li><p>Project IDs</p></li>
<li><p>Differentiated Services Codepoint (DSCP)</p></li>
<li><p>Interface index</p></li></ul>
<p>For example, a simple filter might include the destination port with the value
of 80. The <tt>ipgpc</tt> classifier then selects all packets that are bound for
destination port 80 (HTTP) and handles the packets as directed in the QoS
policy.</p><p>For information on creating filters, see <a href="ipqos-config-planning-7.html#ipqos-config-planning-42">How to Define Filters in the QoS Policy</a>.</p>

<a name="ipqos-intro-19"></a><h4>Meter <tt>(tokenmt</tt> and <tt>tswtclmt)</tt> Overview</h4>
<p><a name="indexterm-3010"></a><a name="indexterm-3011"></a><a name="indexterm-3012"></a><a name="indexterm-3013"></a>In the Diffserv model, the <b>meter</b> tracks the transmission rate of traffic flows
on a per-class basis. The meter evaluates  how much the actual rate
of the flow conforms to the configured rates to determine the appropriate outcome.
Based on the traffic flow's outcome, the meter selects a subsequent action. Subsequent
actions might include sending the packet to another action or returning the packet
to the network without further processing.</p><p><a name="indexterm-3014"></a>The IPQoS meters determine whether a network flow conforms to the transmission rate
that is defined for its class in the QoS policy. IPQoS includes two
metering modules:</p>
<ul><li><p><a name="indexterm-3015"></a><a name="indexterm-3016"></a><tt>tokenmt</tt> &ndash; Uses a two-token bucket metering scheme</p></li>
<li><p><a name="indexterm-3017"></a><a name="indexterm-3018"></a><tt>tswtclmt</tt> &ndash; Uses a time-sliding window metering scheme</p></li></ul>
<p><a name="indexterm-3019"></a><a name="indexterm-3020"></a>Both metering modules recognize three outcomes: red, yellow, and green. You define the
actions to be taken for each outcome in the parameters <tt>red_action_name</tt>, <tt>yellow_action_name</tt>,
and <tt>green_action_name</tt>.</p><p><a name="indexterm-3021"></a><a name="indexterm-3022"></a>In addition, you can configure <tt>tokenmt</tt> to be color aware. A color-aware metering
instance uses the packet's size, DSCP, traffic rate, and configured parameters to determine
the outcome.  The meter uses the DSCP to map the packet's outcome
to a green, yellow, or red.</p><p>For information on defining parameters for the IPQoS meters, refer to <a href="ipqos-config-planning-7.html#ipqos-config-planning-16">How to Plan Flow Control</a>.</p>

<a name="ipqos-intro-20"></a><h4>Marker (<tt>dscpmk</tt> and <tt>dlcosmk</tt>) Overview</h4>
<p><a name="indexterm-3023"></a><a name="indexterm-3024"></a>In the Diffserv model, the <b>marker</b> marks a packet with a value that
reflects a forwarding behavior. <b>Marking</b> is the process of placing a value in
the packet's header to indicate how to forward the packet to the network.
IPQoS contains two marker modules:</p>
<ul><li><p><a name="indexterm-3025"></a><a name="indexterm-3026"></a><a name="indexterm-3027"></a><tt>dscpmk</tt> &ndash; Marks the DS field in an IP packet header with a numeric value that is called the <b>Differentiated Services codepoint</b>, or <b>DSCP</b>. A Diffserv-aware router can then use the DS codepoint to apply the appropriate forwarding behavior to the packet.</p></li>
<li><p><a name="indexterm-3028"></a><a name="indexterm-3029"></a><a name="indexterm-3030"></a><a name="indexterm-3031"></a><tt>dlcosmk</tt> &ndash; Marks the virtual local area network (VLAN) tag of an Ethernet frame header with a numeric value that is called the <b>user priority</b>. The user priority indicates the <b>class of service (CoS)</b>, which defines the appropriate forwarding behavior to be applied to the datagram.</p><p><tt>dlcosmk</tt> is an IPQoS addition that is not part of the Diffserv model, as designed by the IETF.</p></li></ul>
<p>For information on implementing a marker strategy for the QoS policy, see <a href="ipqos-config-planning-7.html#ipqos-config-planning-45">How to Plan Forwarding Behavior</a>.</p>

<a name="ipqos-intro-505"></a><h4>Flow Accounting (<tt>flowacct</tt>) Overview</h4>
<p><a name="indexterm-3032"></a><a name="indexterm-3033"></a>IPQoS adds the <tt>flowacct</tt> accounting module to the Diffserv model. You can use
<tt>flowacct</tt> to gather statistics on traffic flows, and bill customers in agreement with
their SLAs. Flow accounting is also useful for capacity planning and system monitoring.</p><p><a name="indexterm-3034"></a>The <tt>flowacct</tt> module works with the <tt>acctadm</tt> command to create an accounting
log file. A basic log includes the IPQoS 5-tuple and two additional attributes,
as shown in the following list:</p>
<ul><li><p>Source address</p></li>
<li><p>Source port</p></li>
<li><p>Destination address</p></li>
<li><p>Destination port</p></li>
<li><p>Protocol number</p></li>
<li><p>Number of packets</p></li>
<li><p>Number of bytes</p></li></ul>
<p>You can also gather statistics on other attributes, as described in <a href="ipqos-accounting-2.html">Recording Information About Traffic Flows</a>, and
in the <tt>flowacct</tt>(7ipp) and <tt>acctadm</tt>(1M) man pages.</p><p>For information on planning a flow-accounting strategy, see <a href="ipqos-config-planning-7.html#ipqos-config-planning-18">How to Plan for Flow Accounting</a>.</p>

<a name="ipqos-intro-120"></a><h4>How Traffic Flows Through the IPQoS Modules</h4>
<p><a name="indexterm-3035"></a><a name="indexterm-3036"></a>The next figure shows a path that incoming traffic might take through some
of the IPQoS modules.</p><a name="ipqos-intro-fig-2"></a><h6>Figure&nbsp;32-1 Traffic Flow Through the IPQoS Implementation of the Diffserv Model</h6><img src="figures/diffserv-mod.gif" alt="The context follows the graphic, which is a flow diagram."></img><p>This figure illustrates a common traffic flow sequence on an IPQoS-enabled machine:</p>
<ol><li><p>The classifier selects from the packet stream all packets that match the filtering criteria in the system's QoS policy.</p></li>
<li><p>The selected packets are then evaluated for the next action to be taken.</p></li>
<li><p>The classifier sends to the marker any traffic that does not require flow control.</p></li>
<li><p>Traffic to be flow-controlled is sent to the meter.</p></li>
<li><p>The meter enforces the configured rate. Then, the meter assigns a traffic conformance value to the flow-controlled packets.</p></li>
<li><p>The flow-controlled packets are then evaluated to determine if any packets require accounting.</p></li>
<li><p>The meter sends to the marker any traffic that does not require flow accounting.</p></li>
<li><p>The flow-accounting module gathers statistics on received packets. The module then sends the packets to the marker.</p></li>
<li><p>The marker assigns a DS codepoint to the packet header. This DSCP indicates the per-hop behavior that a Diffserv-aware system must apply to the packet.</p></li></ol>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ipqos-intro-90.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ipqos-intro-54.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

