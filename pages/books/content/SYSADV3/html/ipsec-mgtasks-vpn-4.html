<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Protecting a VPN With IPsec - System Administration Guide: IP Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: IP Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ipsec-mgtasks-vpn-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ipsecref-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="iptm-1.html">Part&nbsp;I&nbsp;TCP/IP Administration</a></p>
<p class="toc level2"><a href="ipov-1.html">1.&nbsp;&nbsp;Solaris TCPIP Protocol Suite (Overview)</a></p>
<p class="toc level2"><a href="ipplan-1.html">2.&nbsp;&nbsp;Planning an IPv4 Addressing Scheme (Tasks</a></p>
<p class="toc level2"><a href="ipv6-overview-7.html">3.&nbsp;&nbsp;Planning an IPv6 Addressing Scheme (Overview)</a></p>
<p class="toc level2"><a href="ipv6-planning-1.html">4.&nbsp;&nbsp;Planning an IPv6 Network (Tasks)</a></p>
<p class="toc level2"><a href="ipconfig-1.html">5.&nbsp;&nbsp;Configuring TCP/IP Network Services and IPv4 Addressing (Tasks)</a></p>
<p class="toc level2"><a href="fwawf.html">6.&nbsp;&nbsp;Administering Network Interfaces (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-config-tasks-1.html">7.&nbsp;&nbsp;Enabling IPv6 on a Network (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-admintasks-1.html">8.&nbsp;&nbsp;Administering a TCP/IP Network (Tasks)</a></p>
<p class="toc level2"><a href="gegel.html">9.&nbsp;&nbsp;Troubleshooting Network Problems (Tasks)</a></p>
<p class="toc level2"><a href="ipref-8.html">10.&nbsp;&nbsp;TCP/IP and IPv4 in Depth (Reference)</a></p>
<p class="toc level2"><a href="ipv6-ref-76.html">11.&nbsp;&nbsp;IPv6 in Depth (Reference)</a></p>
<p class="toc level1 tocsp"><a href="dhcptm-1.html">Part&nbsp;II&nbsp;DHCP</a></p>
<p class="toc level2"><a href="dhcp-overview-1.html">12.&nbsp;&nbsp;About Solaris DHCP (Overview)</a></p>
<p class="toc level2"><a href="chap2-26.html">13.&nbsp;&nbsp;Planning for DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="chapter3-20.html">14.&nbsp;&nbsp;Configuring the DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="dhcp-admin-9.html">15.&nbsp;&nbsp;Administering DHCP (Tasks)</a></p>
<p class="toc level2"><a href="eyatl.html">16.&nbsp;&nbsp;Configuring and Administering  DHCP Clients</a></p>
<p class="toc level2"><a href="dhcp-trouble-1.html">17.&nbsp;&nbsp;Troubleshooting DHCP (Reference)</a></p>
<p class="toc level2"><a href="dhcp-ref-4.html">18.&nbsp;&nbsp;DHCP Commands and Files (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipsectm-1.html">Part&nbsp;III&nbsp;IP Security</a></p>
<p class="toc level2"><a href="ipsec-ov-1.html">19.&nbsp;&nbsp;IP Security Architecture (Overview)</a></p>
<p class="toc level2"><a href="ipsec-mgtasks-1.html">20.&nbsp;&nbsp;Configuring IPsec (Tasks)</a></p>
<p class="toc level3"><a href="ipsec-mgtasks-2.html">Protecting Traffic With IPsec (Task Map)</a></p>
<p class="toc level3"><a href="ipsec-mgtasks-4.html">Protecting Traffic With IPsec</a></p>
<p class="toc level4"><a href="ipsec-mgtasks-4.html#ipsec-mgtasks-3">How to Secure Traffic Between Two Systems With IPsec</a></p>
<p class="toc level4"><a href="ipsec-mgtasks-4.html#ipsec-mgtasks-16">How to Secure a Web Server With IPsec</a></p>
<p class="toc level4"><a href="ipsec-mgtasks-4.html#ipsec-mgtasks-14">How to Display IPsec Policies</a></p>
<p class="toc level4"><a href="ipsec-mgtasks-4.html#ipsec-mgtasks-12">How to Generate Random Numbers on a Solaris System</a></p>
<p class="toc level4"><a href="ipsec-mgtasks-4.html#ipsec-mgtasks-13">How to Manually Create IPsec Security Associations</a></p>
<p class="toc level4"><a href="ipsec-mgtasks-4.html#ipsec-mgtasks-11">How to Verify That Packets Are Protected With IPsec</a></p>
<p class="toc level4"><a href="ipsec-mgtasks-4.html#ipsec-mgtasks-18">How to Create a Role for Configuring Network Security</a></p>
<p class="toc level3 tocsp"><a href="ipsec-mgtasks-vpn-2.html">Protecting a VPN With IPsec (Task Map)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Protecting a VPN With IPsec</a></p>
<p class="toc level4"><a href="#ipsec-mgtasks-23">How to Protect a VPN With an IPsec Tunnel in Tunnel Mode Over IPv4</a></p>
<p class="toc level4"><a href="#ipsec-mgtasks-15">How to Protect a VPN With an IPsec Tunnel in Tunnel Mode Over IPv6</a></p>
<p class="toc level4"><a href="#ipsec-mgtasks-24">How to Protect a VPN With an IPsec Tunnel in Transport Mode Over IPv4</a></p>
<p class="toc level4"><a href="#ipsec-mgtasks-26">How to Protect a VPN With an IPsec Tunnel  in Transport Mode Over IPv6</a></p>
</div>
<p class="toc level2 tocsp"><a href="ipsecref-1.html">21.&nbsp;&nbsp;IP Security Architecture (Reference)</a></p>
<p class="toc level2"><a href="ike-1.html">22.&nbsp;&nbsp;Internet Key Exchange (Overview)</a></p>
<p class="toc level2"><a href="ike-task-1.html">23.&nbsp;&nbsp;Configuring IKE (Tasks)</a></p>
<p class="toc level2"><a href="ikeref-1.html">24.&nbsp;&nbsp;Internet Key Exchange (Reference)</a></p>
<p class="toc level2"><a href="eupsq.html">25.&nbsp;&nbsp;Solaris IP Filter (Overview)</a></p>
<p class="toc level2"><a href="ipfilter-admin-1.html">26.&nbsp;&nbsp;Solaris IP Filter (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="miptm-1.html">Part&nbsp;IV&nbsp;Mobile IP</a></p>
<p class="toc level2"><a href="mipoverview-1.html">27.&nbsp;&nbsp;Mobile IP (Overview)</a></p>
<p class="toc level2"><a href="mipimplementing-1.html">28.&nbsp;&nbsp;Administering Mobile IP (Tasks)</a></p>
<p class="toc level2"><a href="mipmanaging-22.html">29.&nbsp;&nbsp;Mobile IP Files and Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipmptm-1.html">Part&nbsp;V&nbsp;IPMP</a></p>
<p class="toc level2"><a href="mpoverview.html">30.&nbsp;&nbsp;Introducing IPMP (Overview)</a></p>
<p class="toc level2"><a href="deploynetmult-56.html">31.&nbsp;&nbsp;Administering IPMP (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ipqostm-1.html">Part&nbsp;VI&nbsp;IP Quality of Service (IPQoS)</a></p>
<p class="toc level2"><a href="ipqos-intro-1.html">32.&nbsp;&nbsp;Introducing IPQoS (Overview)</a></p>
<p class="toc level2"><a href="ipqos-config-planning-1.html">33.&nbsp;&nbsp;Planning for an IPQoS-Enabled Network (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-policy-planning-1.html">34.&nbsp;&nbsp;Creating the IPQoS Configuration File (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-isp-setup-1.html">35.&nbsp;&nbsp;Starting and Maintaining IPQoS (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-accounting-1.html">36.&nbsp;&nbsp;Using Flow Accounting and Statistics Gathering (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-reference-1.html">37.&nbsp;&nbsp;IPQoS in Detail (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="ipsec-mgtasks-vpn-4"></a><h3>Protecting a VPN With IPsec</h3>
<p><a name="indexterm-1827"></a>IPsec tunnels can protect a VPN. In Solaris Express, Developer Edition 2/07, a
tunnel can be in tunnel mode, or in transport mode. Tunnel mode
is interoperable with the implementation of IPsec by other vendors. Transport mode is
interoperable with earlier versions of the Solaris OS. For a discussion of tunnel
modes, see <a href="ipsec-ov-13.html">Transport and Tunnel Modes in IPsec</a>.</p><p><a name="indexterm-1828"></a>Tunnels in tunnel mode offer more fine-grained control of the traffic. In tunnel
mode, for an inner IP address, you can specify the particular protection you
want down to a single port. For possible IPsec policies, see the examples
that follow the tunnel diagram in <a href="#ipsec-mgtasks-fig-tunnel-1">Figure&nbsp;20-1</a>.</p><a name="ipsec-mgtasks-fig-tunnel-1"></a><h6>Figure&nbsp;20-1 IPsec Tunnel Diagram</h6><img src="figures/IPsecTunnel.gif" alt="Diagram shows a VPN that connects two LANs. Each LAN has four subnets."></img><p>The following examples assume that the tunnel is configured for all subnets of
the LANs:</p><pre>## Tunnel configuration ##
ifconfig ip.tun0 10.1.2.1 10.2.3.1 tsrc 192.168.1.10 tdst 192.168.2.10</pre><a name="ipsec-mgtasks-31"></a>Example&nbsp;20-3 Creating a Tunnel That All Subnets Can Use<p><a name="indexterm-1829"></a>In this example, all traffic from the local LANs in Central in
<a href="#ipsec-mgtasks-fig-tunnel-1">Figure&nbsp;20-1</a>, can be tunneled through Router 1 to Router 2, and then delivered
to all local LANs of Overseas. The traffic is encrypted with AES. </p><pre>## IPsec policy ##
{tunnel ip.tun0 negotiate tunnel} 
 ipsec {encr_algs aes encr_auth_algs md5 sa shared}</pre><a name="ipsec-mgtasks-33"></a>Example&nbsp;20-4 Creating a Tunnel That Connects Two Subnets Only<p>In this example, only traffic between subnet <tt>10.1.2.0/24</tt> of Central and subnet <tt>10.2.3.0/24</tt>
of Overseas is tunneled and encrypted. In the absence of other IPsec policies
for Central, if Central attempts to route any traffic for other LANs over
this tunnel, the traffic is dropped at Router 1.</p><pre>## IPsec policy ##
{tunnel ip.tun0 negotiate tunnel laddr 10.1.2.0/24 raddr 10.2.3.0/24} 
 ipsec {encr_algs aes encr_auth_algs md5 sa shared}</pre><a name="ipsec-mgtasks-35"></a>Example&nbsp;20-5 Creating a Tunnel for Only Email Traffic Between Two Subnets<p>In this example, a tunnel is created for email traffic only. The
traffic is delivered from <tt>10.1.2.0/24</tt> of Central to the email server on the <tt>10.2.3.0/24</tt>
subnet of the Overseas LAN. The email is encrypted with Blowfish. The policies
apply to the remote and local email ports. The <tt>rport</tt> policy protects mail
that Central sends to the remote email port of Overseas. The <tt>lport</tt> policy protects
mail Central receives from Overseas on local port 25.</p><pre>## IPsec policy for email from Central to Overseas ##
{tunnel ip.tun0 negotiate tunnel ulp tcp rport 25 
 laddr 10.1.2.0/24 raddr 10.2.3.0/24} 
 ipsec {encr_algs blowfish encr_auth_algs md5 sa shared}</pre><pre>## IPsec policy for email from Overseas to Central ##
{tunnel ip.tun0 negotiate tunnel ulp tcp lport 25 
 laddr 10.1.2.0/24 raddr 10.2.3.0/24} 
 ipsec {encr_algs blowfish encr_auth_algs md5 sa shared}</pre><a name="ipsec-mgtasks-37"></a>Example&nbsp;20-6 Creating a Tunnel for FTP Traffic for All Subnets<p>In this example, IPsec policy protects the FTP ports in <a href="#ipsec-mgtasks-fig-tunnel-1">Figure&nbsp;20-1</a> with
3DES for all subnets of Central to all subnets of Overseas. This configuration works
for the active mode of FTP.</p><pre>## IPsec policy for outbound FTP from Central to Overseas ##
{tunnel ip.tun0 negotiate tunnel ulp tcp rport 21} 
  ipsec {encr_algs 3des encr_auth_algs md5 sa shared}
{tunnel ip.tun0 negotiate tunnel ulp tcp lport 20} 
  ipsec {encr_algs 3des encr_auth_algs md5 sa shared}</pre><pre>## IPsec policy for inbound FTP from Central to Overseas ##
{tunnel ip.tun0 negotiate tunnel ulp tcp lport 21} 
  ipsec {encr_algs 3des encr_auth_algs md5 sa shared}
{tunnel ip.tun0 negotiate tunnel ulp tcp rport 20} 
  ipsec {encr_algs 3des encr_auth_algs md5 sa shared}</pre><p>The IPv4 procedures in this section assume the following setup. For a depiction
of the network, see <a href="#ipsec-mgtasks-fig-2">Figure&nbsp;20-2</a>.</p>
<ul><li><p>Each system is using an IPv4 address space.</p><p>For a similar example with IPv6 addresses, see <a href="#ipsec-mgtasks-15">How to Protect a VPN With an IPsec Tunnel in Tunnel Mode Over IPv6</a>.</p></li>
<li><p>Each system has two interfaces. The <tt>hme0</tt> interface connects to the Internet. In this example, Internet IP addresses begin with <tt>192.168</tt>. The <tt>hme1</tt> interface connects to the company's local area network (LAN), its intranet. In this example, intranet IP addresses begin with the number <tt>10</tt>.</p></li>
<li><p>Each system invokes AH protection with the MD5 algorithm. The MD5 algorithm requires a 128-bit key.</p></li>
<li><p>Each system invokes ESP protection with the 3DES algorithm. The 3DES algorithm requires a 192-bit key.</p></li>
<li><p>Each system can connect to a router that has direct access to the Internet.</p></li>
<li><p>Each system uses shared security associations.</p></li></ul>
<p>For a description of VPNs, see <a href="ipsec-ov-15.html">Virtual Private Networks and IPsec</a>. <a href="#ipsec-mgtasks-fig-2">Figure&nbsp;20-2</a> describes the VPN that this
procedure configures.</p><a name="ipsec-mgtasks-fig-2"></a><h6>Figure&nbsp;20-2 Sample VPN Between Offices Separated by the Internet</h6><img src="figures/example-vpn.gif" alt="Diagram shows details of VPN between Europe and California offices."></img><p>This procedure uses the following configuration parameters.</p><table><col width="62.84*"><col width="17.79*"><col width="18.37*"><tr><th align="left" valign="top" scope="column"><p>Parameter</p></th>
<th align="left" valign="top" scope="column"><p>Europe</p></th>
<th align="left" valign="top" scope="column"><p>California</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>System name</p></td>
<td align="left" valign="top" scope="row"><p>enigma</p></td>
<td align="left" valign="top" scope="row"><p>partym</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>System intranet interface</p></td>
<td align="left" valign="top" scope="row"><p>hme1</p></td>
<td align="left" valign="top" scope="row"><p>hme1</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>System Internet interface</p></td>
<td align="left" valign="top" scope="row"><p>hme0</p></td>
<td align="left" valign="top" scope="row"><p>hme0</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>System
intranet address, also the <i>-point</i> address in <a href="#ipsec-mgtask-iptun-1">Step&nbsp;5</a></p></td>
<td align="left" valign="top" scope="row"><p>10.16.16.6</p></td>
<td align="left" valign="top" scope="row"><p>10.1.3.3</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>System Internet address, also the <i>tsrc</i>
address in <a href="#ipsec-mgtask-iptun-1">Step&nbsp;5</a></p></td>
<td align="left" valign="top" scope="row"><p>192.168.116.16</p></td>
<td align="left" valign="top" scope="row"><p>192.168.13.213</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Name of Internet router</p></td>
<td align="left" valign="top" scope="row"><p>router-E</p></td>
<td align="left" valign="top" scope="row"><p>router-C</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Address of Internet router</p></td>
<td align="left" valign="top" scope="row"><p>192.168.116.4</p></td>
<td align="left" valign="top" scope="row"><p>192.168.13.5</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Tunnel name</p></td>
<td align="left" valign="top" scope="row"><p>ip.tun0</p></td>
<td align="left" valign="top" scope="row"><p>ip.tun0</p></td>
</tr>
</table>

<a name="ipsec-mgtasks-23"></a><h4>How to Protect a VPN With an IPsec Tunnel in Tunnel Mode Over IPv4</h4><a name="indexterm-1830"></a><a name="indexterm-1831"></a><a name="indexterm-1832"></a><a name="indexterm-1833"></a><a name="indexterm-1834"></a><a name="indexterm-1835"></a><a name="indexterm-1836"></a><a name="indexterm-1837"></a><p>This procedure extends the procedure, <a href="ipsec-mgtasks-4.html#ipsec-mgtasks-3">How to Secure Traffic Between Two Systems With IPsec</a>. In addition to connecting two systems, you
are connecting two intranets that connect to these two systems. The systems in
this procedure function as gateways.</p>
<hr><p><b>Note - </b>You configure IPsec policy in the global zone.</p>
<hr>
<ol>
<li><b>On the system console on one of the systems, assume the Primary Administrator
role or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role and
assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p>
<hr><p><b>Note - </b>Logging in remotely exposes security-critical traffic to eavesdropping. Even if you somehow protect
the remote login, the security of the system is reduced to the security
of the remote login session.</p>
<hr>
</li>
<li><a name="ipsec-mgtasks-packetctrl-1"></a><b>Control the flow of packets before configuring IPsec.</b><ol style="list-style-type: lower-alpha">
				 
<li><b><a name="indexterm-1838"></a>Ensure that IP forwarding and IP dynamic routing are disabled.</b><pre># <tt><b>routeadm</b></tt>
Configuration       Current         Current
       Option       Configuration  System State
--------------------------------------------------
IPv4 forwarding     disabled           disabled
   IPv4 routing     default (enabled)   enabled
&hellip;</pre><p>If forwarding and routing are enabled, you can disable them by typing:</p><pre># <tt><b>routeadm -d ipv4-routing -d ipv4-forwarding</b></tt>
# <tt><b>routeadm -u</b></tt></pre><p><a name="indexterm-1839"></a><a name="indexterm-1840"></a>Turning off IP forwarding prevents packets from being forwarded from one network to
another network through this system. For a description of the <tt>routeadm</tt> command, see
the <a href="http://docs.sun.com/doc/819-2240/routeadm-1m?a=view"><tt>routeadm</tt>(1M)</a> man page.</p></li>
<li><b>Turn on IP strict destination multihoming.</b><pre># <tt><b>ndd -set /dev/ip ip_strict_dst_multihoming 1</b></tt></pre><p>Turning on IP strict destination multihoming ensures that packets for one of the
system's destination addresses arrive at the correct destination address.</p><p>When you turn off IP forwarding and turn on IP strict destination multihoming,
fewer packets flow all the way through the system.  When strict destination
multihoming is enabled, packets that arrive on a particular interface must be addressed
to one of the local IP addresses of that interface. All other packets,
even ones that are addressed to other local addresses of the system, are
dropped.</p></li>
<li><b>Disable most network services, and possibly all network services.</b>
<hr><p><b>Note - </b>If your system was installed with the &ldquo;limited&rdquo; SMF profile, then you can
skip this step. Network services, with the exception of Solaris Secure Shell, are
disabled.</p>
<hr>
<p><a name="indexterm-1841"></a><a name="indexterm-1842"></a>The disabling of network services prevents IP packets from doing any harm to
the system. For example, an SNMP daemon, a <tt>telnet</tt> connection, or an <tt>rlogin</tt>
connection could be exploited.</p><p>You have two options.</p>
<ul><li><p>Run the &ldquo;limited&rdquo; SMF profile.</p><pre># <tt><b>netservices limited</b></tt></pre></li>
<li><p>Or, individually disable network services.</p><pre># <tt><b>svcadm disable network/ftp:default</b></tt>
# <tt><b>svcadm disable network/finger:default</b></tt>
# <tt><b>svcadm disable network/login:rlogin</b></tt>
# <tt><b>svcadm disable network/nfs/server:default</b></tt>
# <tt><b>svcadm disable network/rpc/rstat:default</b></tt>
# <tt><b>svcadm disable network/smtp:sendmail</b></tt>
# <tt><b>svcadm disable network/telnet:default</b></tt>
# <tt><b>svcs | grep network</b></tt>
online         Aug_02   svc:/network/loopback:default
&hellip;
online         Aug_09   svc:/network/ssh:default
&hellip;</pre></li></ul>
</li></ol></li>
<li><a name="ipsec-mgtasks-sa-1"></a><b>On each system, add a pair of SAs between the two systems.</b><p>Choose one of the following options:</p>
<ul><li><p>Configure IKE to manage the keys for the SAs. Use one of the procedures in <a href="ike-task-7.html">Configuring IKE (Task Map)</a> to configure IKE for the VPN.</p></li>
<li><p>If you have an overriding reason to manually manage the keys, see <a href="ipsec-mgtasks-4.html#ipsec-mgtasks-13">How to Manually Create IPsec Security Associations</a>.</p></li></ul>
</li>
<li><a name="ipsec-mgtasks-nobypass-1"></a><b>On each system, add IPsec policy.</b><p>Edit the <tt>/etc/inet/ipsecinit.conf</tt> file to add the IPsec policy for the VPN. To
strengthen the policy, see <a href="#ipsec-mgtasks-17">Example&nbsp;20-7</a>. For additional examples, see <a href="#ipsec-mgtasks-31">Example&nbsp;20-3</a> and following.</p><ol style="list-style-type: lower-alpha">
				 
<li><b><a name="indexterm-1843"></a><a name="indexterm-1844"></a><a name="indexterm-1845"></a><a name="indexterm-1846"></a>For example, on the <tt>enigma</tt> system, type the following entry into the <tt>ipsecinit.conf</tt>
file:</b><pre># LAN traffic to and from this host can bypass IPsec.
{laddr 10.1.3.3 dir both} bypass {}

# WAN traffic uses ESP with 3DES and MD5.
{tunnel ip.tun0 negotiate tunnel} 
 ipsec {encr_algs 3des encr_auth_algs md5 sa shared}</pre></li>
<li><b>On the <tt>partym</tt> system, type the following entry into the <tt>ipsecinit.conf</tt> file:</b><pre># LAN traffic to and from this host can bypass IPsec.
{laddr 10.1.3.3 dir both} bypass {}

# WAN traffic uses ESP with 3DES and MD5.
{tunnel ip.tun0 negotiate tunnel} 
 ipsec {encr_algs 3des encr_auth_algs md5 sa shared}</pre></li></ol></li>
<li><a name="ipsec-mgtask-iptun-1"></a><b><a name="indexterm-1847"></a>On each system, configure the tunnel, <tt>ip.tun0</tt>.</b><p>Use the following <tt>ifconfig</tt> commands to create the point-to-point interface:</p><pre># ifconfig ip.tun0 plumb

# ifconfig ip.tun0 <i>system1-point</i> <i>system2-point</i> \
tsrc <i>system1-taddr</i> tdst <i>system2-taddr</i></pre><ol style="list-style-type: lower-alpha">
				 
<li><b>For example, on the <tt>enigma</tt> system, type the following commands:</b><pre># <tt><b>ifconfig ip.tun0 plumb</b></tt>

# <tt><b>ifconfig ip.tun0 10.16.16.6 10.1.3.3 \</b></tt>
<tt><b>tsrc 192.168.116.16 tdst 192.168.13.213</b></tt></pre></li>
<li><b>On the <tt>partym</tt> system, type the following commands:</b><pre># <tt><b>ifconfig ip.tun0 plumb</b></tt>

# <tt><b>ifconfig ip.tun0 10.1.3.3 10.16.16.6 \</b></tt>
<tt><b>tsrc 192.168.13.213 tdst 192.168.116.16</b></tt></pre></li></ol></li>
<li><a name="ipsec-mgtasks-transp-1"></a><b>Protect the tunnel with the IPsec policy that you created.</b><pre># <tt><b>ipsecconf</b></tt></pre></li>
<li><b>Bring up the router for the tunnel.</b><pre># <tt><b>ifconfig ip.tun0 router up</b></tt></pre></li>
<li><b><a name="indexterm-1848"></a>On each system, turn on IP forwarding for the <tt>hme1</tt> interface.</b><pre># <tt><b>ifconfig hme1 router</b></tt></pre><p>IP forwarding means that packets that arrive from somewhere else can be forwarded.
IP forwarding also means that packets that leave this interface might have originated
somewhere else. To successfully forward a packet, both the receiving interface and the
transmitting interface must have IP forwarding turned on.</p><p>Because the <tt>hme1</tt> interface is <b>inside</b> the intranet, IP forwarding must be
turned on for <tt>hme1</tt>. Because <tt>ip.tun0</tt> connects the two systems through the Internet,
IP forwarding must be turned on for <tt>ip.tun0</tt>.</p><p>The <tt>hme0</tt> interface has its IP forwarding turned off to prevent an <b>outside</b>
adversary from injecting packets into the protected intranet. The <b>outside</b> refers to the Internet.</p></li>
<li><b>On each system, ensure that routing protocols do not advertise the default route
within the intranet.</b><pre># <tt><b>ifconfig hme0 private</b></tt></pre><p>Even if <tt>hme0</tt> has IP forwarding turned off, a routing protocol implementation might
still advertise the interface. For example, the <tt>in.routed</tt> protocol might still advertise that
<tt>hme0</tt> is available to  forward packets to its peers inside the
intranet. By setting the interface's <b>private</b> flag, these advertisements are prevented.</p></li>
<li><b>Manually, add a default route over <tt>hme0</tt>.</b><p>The default route should be a router with direct access to the
Internet.</p><pre># route add default <i>router-on-hme0-subnet</i></pre><ol style="list-style-type: lower-alpha">
				 
<li><b>For example, on the <tt>enigma</tt> system, add the following route:</b><pre># <tt><b>route add default 192.168.116.4</b></tt></pre></li>
<li><b><a name="indexterm-1849"></a><a name="indexterm-1850"></a>On the <tt>partym</tt> system, add the following route:</b><pre># <tt><b>route add default 192.168.13.5</b></tt></pre><p>Even though the <tt>hme0</tt> interface is not part of the intranet, <tt>hme0</tt> does
need to reach across the Internet to its peer system. To find its
peer, <tt>hme0</tt> needs information about Internet routing. The VPN system appears to be
a host, rather than a router, to the rest of the Internet. Therefore,
you can use a default router or run the router discovery protocol to
find a peer system. For more information, see the <a href="http://docs.sun.com/doc/819-2240/route-1m?a=view"><tt>route</tt>(1M)</a> and <a href="http://docs.sun.com/doc/819-2240/in.routed-1m?a=view"><tt>in.routed</tt>(1M)</a> man
pages.</p></li></ol></li>
<li><b>Ensure that the VPN starts after a reboot by adding an entry to
the <tt>/etc/hostname.ip.tun0</tt> file.</b><pre><i>system1-point system2-point</i> tsrc <i>system1-taddr</i> tdst <i>system2-taddr</i> router up</pre><ol style="list-style-type: lower-alpha">
				 
<li><b>For example, on the <tt>enigma</tt> system, add the following entry to the <tt>hostname.ip.tun0</tt>
file:</b><pre>10.16.16.6 10.1.3.3 tsrc 192.168.116.16 tdst 192.168.13.213 router up</pre></li>
<li><b>On the <tt>partym</tt> system, add the following entry to the <tt>hostname.ip.tun0</tt> file:</b><pre>10.1.3.3 10.16.16.6 tsrc 192.168.13.213 tdst 192.168.116.16 router up</pre></li></ol></li>
<li><b>On each system, configure the interface files to pass the correct parameters to
the routing daemon.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>On the enigma system, modify the <tt>/etc/hostname.</tt><i>interface</i> files.</b><pre># <tt><b>cat enigma hostname.hme0</b></tt>
10.16.16.6 private</pre><pre># <tt><b>cat enigma hostname.hme1</b></tt>
192.168.116.16 router</pre></li>
<li><b>On the partym system, modify the <tt>/etc/hostname.</tt><i>interface</i> files.</b><pre># <tt><b>cat partym hostname.hme0</b></tt>
10.1.3.3 private</pre><pre># <tt><b>cat partym hostname.hme1</b></tt>
192.168.13.213 router</pre></li></ol></li>
<li><b>On each system, run a routing protocol.</b><p><a name="indexterm-1851"></a><a name="indexterm-1852"></a>You might need to configure the routing protocol before enabling routing. For more
information, see <a href="ipref-13.html">Routing Protocols in the Solaris OS</a>. For a procedure, see <a href="gcvjj.html#ipconfig-118">How to Configure an IPv4 Router</a>.</p><pre># <tt><b>routeadm -e ipv4-routing</b></tt>
# <tt><b>routeadm -u</b></tt></pre></li></ol><a name="ipsec-mgtasks-17"></a>Example&nbsp;20-7 Requiring IPsec Policy on All Systems on a LAN<p><a name="indexterm-1853"></a><a name="indexterm-1854"></a><a name="indexterm-1855"></a>In this example, the administrator comments out the <tt>bypass</tt> policy that was configured
in <a href="#ipsec-mgtasks-nobypass-1">Step&nbsp;4</a>, thereby strengthening the protection. With this policy configuration, each system on the
LAN must activate IPsec to communicate with the router.</p><pre># LAN traffic must implement IPsec.
# {laddr 10.1.3.3 dir both} bypass {}

# WAN traffic uses ESP with 3DES and MD5.
{tunnel ip.tun0 negotiate tunnel} ipsec {encr_algs 3des encr_auth_algs md5}</pre><a name="ipsecmgtasks-25"></a>Example&nbsp;20-8 Using IPsec to Protect Telnet Traffic Differently From SMTP Traffic<p>The first rule protects <tt>telnet</tt> traffic on port 23 with Blowfish and Sha-1.
The second rule protects SMTP traffic on port 25 with AES and MD5.</p><pre>{laddr 10.1.3.3 ulp tcp dport 23 dir both} 
  ipsec {encr_algs blowfish encr_auth_algs sha1 sa unique}
{laddr 10.1.3.3 ulp tcp dport 25 dir both} 
 ipsec {encr_algs aes encr_auth_algs md5 sa unique}</pre><a name="ipsecmgtasks-27"></a>Example&nbsp;20-9 Using an IPsec Tunnel in Tunnel Mode to Protect a Subnet Differently From Other Network Traffic<p>The following tunnel configuration protects all traffic from subnet <tt>10.1.3.0/24</tt> across the
tunnel.</p><pre>{tunnel ip.tun0 negotiate tunnel laddr 10.1.3.0/24} 
  ipsec {encr_algs aes encr_auth_algs md5 sa shared}</pre><p>The following tunnel configurations protect traffic from subnet <tt>10.1.3.0/24</tt> to different subnets
across the tunnel. Subnets that begin with <tt>10.2.</tt><i>x.x</i> are across the tunnel.</p><pre>{tunnel ip.tun0 negotiate tunnel laddr 10.1.3.0/24 raddr 10.2.1.0/24} 
  ipsec {encr_algs blowfish encr_auth_algs md5 sa shared}</pre><pre>{tunnel ip.tun0 negotiate tunnel laddr 10.1.3.0/24 raddr 10.2.2.0/24} 
  ipsec {encr_algs blowfish encr_auth_algs sha1 sa shared}</pre><pre>{tunnel ip.tun0 negotiate tunnel laddr 10.1.3.0/24 raddr 10.2.3.0/24} 
  ipsec {encr_algs aes encr_auth_algs sha1 sa shared}</pre>

<a name="ipsec-mgtasks-15"></a><h4>How to Protect a VPN With an IPsec Tunnel in Tunnel Mode Over IPv6</h4><a name="indexterm-1856"></a><a name="indexterm-1857"></a><a name="indexterm-1858"></a><p>To set up a VPN on an IPv6 network, you follow the
same steps as for an IPv4 network. However, the syntax of the commands
is slightly different. For a fuller description of the reasons for running particular
commands, see <a href="#ipsec-mgtasks-23">How to Protect a VPN With an IPsec Tunnel in Tunnel Mode Over IPv4</a>.</p><p>This procedure uses the following configuration parameters.</p><table><col width="39.57*"><col width="29.15*"><col width="30.28*"><tr><th align="left" valign="top" scope="column"><p>Parameter</p></th>
<th align="left" valign="top" scope="column"><p>Europe</p></th>
<th align="left" valign="top" scope="column"><p>California</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>System name</p></td>
<td align="left" valign="top" scope="row"><p>enigma</p></td>
<td align="left" valign="top" scope="row"><p>partym</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>System intranet interface</p></td>
<td align="left" valign="top" scope="row"><p>hme1</p></td>
<td align="left" valign="top" scope="row"><p>hme1</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>System Internet interface</p></td>
<td align="left" valign="top" scope="row"><p>hme0</p></td>
<td align="left" valign="top" scope="row"><p>hme0</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>System
intranet address</p></td>
<td align="left" valign="top" scope="row"><p>6000:6666::aaaa:1116</p></td>
<td align="left" valign="top" scope="row"><p>6000:3333::eeee:1113</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>System Internet address</p></td>
<td align="left" valign="top" scope="row"><p>2001::aaaa:6666:6666</p></td>
<td align="left" valign="top" scope="row"><p>2001::eeee:3333:3333</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Name of Internet router</p></td>
<td align="left" valign="top" scope="row"><p>router-E</p></td>
<td align="left" valign="top" scope="row"><p>router-C</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Address of Internet router</p></td>
<td align="left" valign="top" scope="row"><p>2001::aaaa:0:4</p></td>
<td align="left" valign="top" scope="row"><p>2001::eeee:0:1</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Tunnel name</p></td>
<td align="left" valign="top" scope="row"><p>ip6.tun0</p></td>
<td align="left" valign="top" scope="row"><p>ip6.tun0</p></td>
</tr>
</table><ol>
<li><b>On the system console on one of the systems, assume the Primary Administrator
role or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role and
assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p>
<hr><p><b>Note - </b>Logging in remotely exposes security-critical traffic to eavesdropping. Even if you somehow protect
the remote login, the security of the system is reduced to the security
of the remote login session.</p>
<hr>
</li>
<li><b>Control the flow of packets before configuring IPsec.</b><p>For the effects of these commands, see <a href="#ipsec-mgtasks-packetctrl-1">Step&nbsp;2</a> in <a href="#ipsec-mgtasks-23">How to Protect a VPN With an IPsec Tunnel in Tunnel Mode Over IPv4</a>.</p><ol style="list-style-type: lower-alpha">
				 
<li><b><a name="indexterm-1859"></a>Ensure that IP forwarding and IP dynamic routing are disabled.</b><pre># <tt><b>routeadm</b></tt>
Configuration       Current         Current
       Option       Configuration  System State
--------------------------------------------------
&hellip;
IPv6 forwarding     disabled          disabled
   IPv6 routing     disabled          disabled</pre><p>If forwarding and routing are enabled, you can disable them by typing:</p><pre># <tt><b>routeadm -d ipv6-forwarding -d ipv6-routing</b></tt>
# <tt><b>routeadm -u</b></tt></pre></li>
<li><b>Turn on IP strict destination multihoming.</b><pre># <tt><b>ndd -set /dev/ip ip6_strict_dst_multihoming 1</b></tt></pre></li>
<li><b>Disable most network services, and possibly all network services.</b>
<hr><p><b>Note - </b>If your system was installed with the &ldquo;limited&rdquo; SMF profile, then you can
skip this step. Network services, with the exception of Solaris Secure Shell, are
disabled.</p>
<hr>
<p><a name="indexterm-1860"></a><a name="indexterm-1861"></a>The disabling of network services prevents IP packets from doing any harm to
the system. For example, an SNMP daemon, a <tt>telnet</tt> connection, or an <tt>rlogin</tt>
connection could be exploited.</p><p>You have two options.</p>
<ul><li><p>Run the &ldquo;limited&rdquo; SMF profile.</p><pre># <tt><b>netservices limited</b></tt></pre></li>
<li><p>Or, individually disable network services.</p><pre># <tt><b>svcadm disable network/ftp:default</b></tt>
# <tt><b>svcadm disable network/finger:default</b></tt>
# <tt><b>svcadm disable network/login:rlogin</b></tt>
# <tt><b>svcadm disable network/nfs/server:default</b></tt>
# <tt><b>svcadm disable network/rpc/rstat:default</b></tt>
# <tt><b>svcadm disable network/smtp:sendmail</b></tt>
# <tt><b>svcadm disable network/telnet:default</b></tt>
# <tt><b>svcs | grep network</b></tt>
online         Aug_02   svc:/network/loopback:default
&hellip;
online         Aug_09   svc:/network/ssh:default
&hellip;</pre></li></ul>
</li></ol></li>
<li><b>On each system, add a pair of SAs between the two systems.</b><p>Choose one of the following options.</p>
<ul><li><p>Configure IKE to manage the keys for the SAs. Use one of the procedures in <a href="ike-task-7.html">Configuring IKE (Task Map)</a> to configure IKE for the VPN.</p></li>
<li><p>If you have an overriding reason to manually manage the keys, see <a href="ipsec-mgtasks-4.html#ipsec-mgtasks-13">How to Manually Create IPsec Security Associations</a>.</p></li></ul>
</li>
<li><b><a name="indexterm-1862"></a>On each system, add IPsec policy.</b><p>Edit the <tt>/etc/inet/ipsecinit.conf</tt> file to add the IPsec policy for the VPN.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>For example, on the <tt>enigma</tt> system, type the following entry into the <tt>ipsecinit.conf</tt>
file:</b><pre># IPv6 Neighbor Discovery messages bypass IPsec.
{ulp ipv6-icmp type 133-137 dir both} pass {}

# LAN traffic to and from this host can bypass IPsec.
{laddr 6000:6666::aaaa:1116 dir both} bypass {}

# WAN traffic uses ESP with 3DES and MD5.
{tunnel ip6.tun0 negotiate tunnel} 
  ipsec {encr_algs 3des encr_auth_algs md5 sa shared}</pre></li>
<li><b>On the <tt>partym</tt> system, type the following entry into the <tt>ipsecinit.conf</tt> file:</b><pre># IPv6 Neighbor Discovery messages bypass IPsec.
{ulp ipv6-icmp type 133-137 dir both} pass {}

# LAN traffic to and from this host can bypass IPsec.
{laddr 6000:3333::eeee:1113 dir both} bypass {}

# WAN traffic uses ESP with 3DES and MD5.
{tunnel ip6.tun0 negotiate tunnel} 
  ipsec {encr_algs 3des encr_auth_algs md5 sa shared}</pre></li></ol></li>
<li><a name="ipsec-mgtask-iptun-2"></a><b><a name="indexterm-1863"></a>On each system, configure a secure tunnel, <tt>ip6.tun0</tt>.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>For example, on the <tt>enigma</tt> system, type the following commands:</b><pre># <tt><b>ifconfig ip6.tun0 inet6 plumb</b></tt>

# <tt><b>ifconfig ip6.tun0 inet6 6000:6666::aaaa:1116 6000:3333::eeee:1113 \</b></tt>
<tt><b>tsrc 2001::aaaa:6666:6666 tdst 2001::eeee:3333:3333</b></tt></pre></li>
<li><b>On the <tt>partym</tt> system, type the following commands:</b><pre># <tt><b>ifconfig ip6.tun0 inet6 plumb</b></tt>

# <tt><b>ifconfig ip6.tun0 inet6 6000:3333::eeee:1113 6000:6666::aaaa:1116 \</b></tt>
<tt><b>tsrc 2001::eeee:3333:3333 tdst 2001::aaaa:6666:6666</b></tt></pre></li></ol></li>
<li><b>Protect the tunnel with the IPsec policy that you created.</b><pre># <tt><b>ipsecconf</b></tt></pre></li>
<li><b>Bring up the router for the tunnel.</b><pre># <tt><b>ifconfig ip6.tun0 router up</b></tt></pre></li>
<li><b><a name="indexterm-1864"></a>On each system, turn on IP forwarding for the <tt>hme1</tt> interface. </b><pre># <tt><b>ifconfig hme1 router</b></tt></pre></li>
<li><b>On each system, ensure that routing protocols do not advertise the default route
within the intranet.</b><pre># <tt><b>ifconfig hme0 private</b></tt></pre></li>
<li><b>Manually, add a default route over <tt>hme0</tt>.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>For example, on the <tt>enigma</tt> system, add the following route:</b><pre># <tt><b>route add -inet6 default 2001::aaaa:0:4</b></tt></pre></li>
<li><b><a name="indexterm-1865"></a><a name="indexterm-1866"></a>On the <tt>partym</tt> system, add the following route:</b><pre># <tt><b>route add -inet6 default 2001::eeee:0:1</b></tt></pre></li></ol></li>
<li><b>Ensure that the VPN starts after a reboot by adding an entry
to the <tt>/etc/hostname6.ip6.tun0</tt> file. </b><p>The entry replicates the parameters that were passed to the <tt>ifconfig</tt> command in <a href="#ipsec-mgtask-iptun-2">Step&nbsp;5</a>.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>For example, on the <tt>enigma</tt> system, add the following entry to the <tt>hostname6.ip6.tun0</tt>
file:</b><pre>6000:6666::aaaa:1116 6000:3333::eeee:1113 \
tsrc 2001::aaaa:6666:6666  tdst 2001::eeee:3333:3333 router up</pre></li>
<li><b>On the <tt>partym</tt> system, add the following entry to the <tt>hostname6.ip6.tun0</tt> file:</b><pre>6000:3333::eeee:1113 6000:6666::aaaa:1116 \
tsrc 2001::eeee:3333:3333   tdst 2001::aaaa:6666:6666  router up</pre></li></ol></li>
<li><b>On each system, configure the interface files to pass the correct parameters to
the routing daemon.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>On the enigma system, modify the <tt>/etc/hostname6.</tt><i>interface</i> files.</b><pre># <tt><b>cat enigma hostname6.hme0</b></tt>
6000:6666::aaaa:1116 inet6 private</pre><pre>#  <tt><b>cat enigma hostname6.hme1</b></tt>
2001::aaaa:6666:6666 inet6 router</pre></li>
<li><b>On the partym system, modify the <tt>/etc/hostname6.</tt><i>interface</i> files.</b><pre># <tt><b>cat partym hostname6.hme0</b></tt>
6000:3333::eeee:1113 inet6 private</pre><pre># <tt><b>cat partym hostname6.hme1</b></tt>
2001::eeee:3333:3333 inet6 router</pre></li></ol></li>
<li><b>On each system, run a routing protocol.</b><pre># <tt><b>routeadm -e ipv6-routing</b></tt>
# <tt><b>routeadm -u</b></tt></pre></li></ol>

<a name="ipsec-mgtasks-24"></a><h4>How to Protect a VPN With an IPsec Tunnel in Transport Mode Over IPv4</h4><a name="indexterm-1867"></a><a name="indexterm-1868"></a><a name="indexterm-1869"></a><p>This procedure extends the procedure, <a href="ipsec-mgtasks-4.html#ipsec-mgtasks-3">How to Secure Traffic Between Two Systems With IPsec</a>. In addition to connecting two systems, you
are connecting two intranets that connect to these two systems. The systems in
this procedure function as gateways.</p><p>This procedure assumes the same setup as in <a href="#ipsec-mgtasks-15">How to Protect a VPN With an IPsec Tunnel in Tunnel Mode Over IPv6</a>.</p><ol>
<li><b>On the system console on one of the systems, assume the Primary Administrator
role or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role and
assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p>
<hr><p><b>Note - </b>Logging in remotely exposes security-critical traffic to eavesdropping. Even if you somehow protect
the remote login, the security of the system is reduced to the security
of the remote login session.</p>
<hr>
</li>
<li><b>Control the flow of packets before configuring IPsec.</b><ol style="list-style-type: lower-alpha">
				 
<li><b><a name="indexterm-1870"></a>Ensure that IP forwarding and IP dynamic routing are disabled.</b><pre># <tt><b>routeadm</b></tt>
Configuration       Current         Current
       Option       Configuration  System State
--------------------------------------------------
IPv4 forwarding     disabled           disabled
   IPv4 routing     default (enabled)   enabled
&hellip;</pre><p>If forwarding and routing are enabled, you can disable them by typing:</p><pre># <tt><b>routeadm -d ipv4-routing -d ipv4-forwarding</b></tt>
# <tt><b>routeadm -u</b></tt></pre><p><a name="indexterm-1871"></a><a name="indexterm-1872"></a>Turning off IP forwarding prevents packets from being forwarded from one network to
another network through this system. For a description of the <tt>routeadm</tt> command, see
the <a href="http://docs.sun.com/doc/819-2240/routeadm-1m?a=view"><tt>routeadm</tt>(1M)</a> man page.</p></li>
<li><b>Turn on IP strict destination multihoming.</b><pre># <tt><b>ndd -set /dev/ip ip_strict_dst_multihoming 1</b></tt></pre><p>Turning on IP strict destination multihoming ensures that packets for one of the
system's destination addresses arrive at the correct destination address.</p><p>When you turn off IP forwarding and turn on IP strict destination multihoming,
fewer packets flow all the way through the system.  When strict destination
multihoming is enabled, packets that arrive on a particular interface must be addressed
to one of the local IP addresses of that interface. All other packets,
even ones that are addressed to other local addresses of the system, are
dropped.</p></li>
<li><b>Disable most network services, and possibly all network services.</b>
<hr><p><b>Note - </b>If your system was installed with the &ldquo;limited&rdquo; SMF profile, then you can
skip this step. Network services, with the exception of Solaris Secure Shell, are
disabled.</p>
<hr>
<p><a name="indexterm-1873"></a><a name="indexterm-1874"></a>The disabling of network services prevents IP packets from doing any harm to
the system. For example, an SNMP daemon, a <tt>telnet</tt> connection, or an <tt>rlogin</tt>
connection could be exploited.</p><p>You have two options.</p>
<ul><li><p>Run the &ldquo;limited&rdquo; SMF profile.</p><pre># <tt><b>netservices limited</b></tt></pre></li>
<li><p>Or, individually disable network services.</p><pre># <tt><b>svcadm disable network/ftp:default</b></tt>
# <tt><b>svcadm disable network/finger:default</b></tt>
# <tt><b>svcadm disable network/login:rlogin</b></tt>
# <tt><b>svcadm disable network/nfs/server:default</b></tt>
# <tt><b>svcadm disable network/rpc/rstat:default</b></tt>
# <tt><b>svcadm disable network/smtp:sendmail</b></tt>
# <tt><b>svcadm disable network/telnet:default</b></tt>
# <tt><b>svcs | grep network</b></tt>
online         Aug_02   svc:/network/loopback:default
&hellip;
online         Aug_09   svc:/network/ssh:default
&hellip;</pre></li></ul>
</li></ol></li>
<li><b>On each system, add a pair of SAs between the two systems.</b><p>Choose one of the following options:</p>
<ul><li><p>Configure IKE to manage the keys for the SAs. Use one of the procedures in <a href="ike-task-7.html">Configuring IKE (Task Map)</a> to configure IKE for the VPN.</p></li>
<li><p>If you have an overriding reason to manually manage the keys, see <a href="ipsec-mgtasks-4.html#ipsec-mgtasks-13">How to Manually Create IPsec Security Associations</a>.</p></li></ul>
</li>
<li><a name="ipsec-mgtasks-deprec-syntax-1"></a><b>On each system, add IPsec policy.</b><p>Edit the <tt>/etc/inet/ipsecinit.conf</tt> file to add the IPsec policy for the VPN. To
strengthen the policy, see <a href="#ipsec-mgtasks-27">Example&nbsp;20-10</a>.</p><ol style="list-style-type: lower-alpha">
				 
<li><b><a name="indexterm-1875"></a><a name="indexterm-1876"></a><a name="indexterm-1877"></a>For example, on the <tt>enigma</tt> system, type the following entry into the <tt>ipsecinit.conf</tt>
file:</b><pre># LAN traffic to and from this host can bypass IPsec.
{laddr 10.1.3.3 dir both} bypass {}

# WAN traffic uses ESP with 3DES and MD5.
{tunnel ip.tun0 negotiate transport} 
 ipsec {encr_algs 3des encr_auth_algs md5 sa shared}</pre></li>
<li><b>On the <tt>partym</tt> system, type the following entry into the <tt>ipsecinit.conf</tt> file:</b><pre># LAN traffic to and from this host can bypass IPsec.
{laddr 10.1.3.3 dir both} bypass {}

# WAN traffic uses ESP with 3DES and MD5.
{tunnel ip.tun0 negotiate transport} 
 ipsec {encr_algs 3des encr_auth_algs md5 sa shared}</pre></li></ol></li>
<li><a name="ipsec-mgtasks-deprec-syntax-2"></a><b>On each system, configure the tunnel, <tt>ip.tun0</tt>.</b><p>Use the following <tt>ifconfig</tt> commands to create the point-to-point interface:</p><pre># ifconfig ip.tun0 plumb

# ifconfig ip.tun0 <i>system1-point</i> <i>system2-point</i> \
tsrc <i>system1-taddr</i> tdst <i>system2-taddr</i></pre><ol style="list-style-type: lower-alpha">
				 
<li><b>For example, on the <tt>enigma</tt> system, type the following commands:</b><pre># <tt><b>ifconfig ip.tun0 plumb</b></tt>

# <tt><b>ifconfig ip.tun0 10.16.16.6 10.1.3.3 \</b></tt>
<tt><b>tsrc 192.168.116.16 tdst 192.168.13.213</b></tt></pre></li>
<li><b>On the <tt>partym</tt> system, type the following commands:</b><pre># <tt><b>ifconfig ip.tun0 plumb</b></tt>

# <tt><b>ifconfig ip.tun0 10.1.3.3 10.16.16.6 \</b></tt>
<tt><b>tsrc 192.168.13.213 tdst 192.168.116.16</b></tt></pre></li></ol></li>
<li><a name="ipsec-mgtasks-deprec-syntax-3"></a><b>Protect the tunnel with the IPsec policy that you created.</b><pre># <tt><b>ipsecconf</b></tt></pre></li>
<li><a name="ipsec-mgtasks-deprec-syntax-4"></a><b>Bring up the router for the tunnel.</b><pre># <tt><b>ifconfig ip.tun0 router up</b></tt></pre></li>
<li><b>On each system, turn on IP forwarding for the <tt>hme1</tt> interface.</b><pre># <tt><b>ifconfig hme1 router</b></tt></pre><p>IP forwarding means that packets that arrive from somewhere else can be forwarded.
IP forwarding also means that packets that leave this interface might have originated
somewhere else. To successfully forward a packet, both the receiving interface and the
transmitting interface must have IP forwarding turned on.</p><p>Because the <tt>hme1</tt> interface is <b>inside</b> the intranet, IP forwarding must be
turned on for <tt>hme1</tt>. Because <tt>ip.tun0</tt> connects the two systems through the Internet,
IP forwarding must be turned on for <tt>ip.tun0</tt>.</p><p>The <tt>hme0</tt> interface has its IP forwarding turned off to prevent an <b>outside</b>
adversary from injecting packets into the protected intranet. The <b>outside</b> refers to the Internet.</p></li>
<li><b>On each system, ensure that routing protocols do not advertise the default route
within the intranet.</b><pre># <tt><b>ifconfig hme0 private</b></tt></pre><p>Even if <tt>hme0</tt> has IP forwarding turned off, a routing protocol implementation might
still advertise the interface. For example, the <tt>in.routed</tt> protocol might still advertise that
<tt>hme0</tt> is available to  forward packets to its peers inside the
intranet. By setting the interface's <b>private</b> flag, these advertisements are prevented.</p></li>
<li><b>Manually, add a default route over <tt>hme0</tt>.</b><p>The default route should be a router with direct access to the
Internet.</p><pre># route add default <i>router-on-hme0-subnet</i></pre><ol style="list-style-type: lower-alpha">
				 
<li><b>For example, on the <tt>enigma</tt> system, add the following route:</b><pre># <tt><b>route add default 192.168.116.4</b></tt></pre></li>
<li><b><a name="indexterm-1878"></a><a name="indexterm-1879"></a>On the <tt>partym</tt> system, add the following route:</b><pre># <tt><b>route add default 192.168.13.5</b></tt></pre><p>Even though the <tt>hme0</tt> interface is not part of the intranet, <tt>hme0</tt> does
need to reach across the Internet to its peer system. To find its
peer, <tt>hme0</tt> needs information about Internet routing. The VPN system appears to be
a host, rather than a router, to the rest of the Internet. Therefore,
you can use a default router or run the router discovery protocol to
find a peer system. For more information, see the <a href="http://docs.sun.com/doc/819-2240/route-1m?a=view"><tt>route</tt>(1M)</a> and <a href="http://docs.sun.com/doc/819-2240/in.routed-1m?a=view"><tt>in.routed</tt>(1M)</a> man
pages.</p></li></ol></li>
<li><a name="ipsec-mgtasks-deprec-syntax-5"></a><b>Ensure that the VPN starts after a reboot by adding an entry to
the <tt>/etc/hostname.ip.tun0</tt> file.</b><pre><i>system1-point system2-point</i> tsrc <i>system1-taddr</i> \
tdst <i>system2-taddr</i> encr_algs 3des encr_auth_algs md5 router up</pre><ol style="list-style-type: lower-alpha">
				 
<li><b>For example, on the <tt>enigma</tt> system, add the following entry to the <tt>hostname.ip.tun0</tt>
file:</b><pre>10.16.16.6 10.1.3.3 tsrc 192.168.116.16 \
tdst 192.168.13.213 router up</pre></li>
<li><b>On the <tt>partym</tt> system, add the following entry to the <tt>hostname.ip.tun0</tt> file:</b><pre>10.1.3.3 10.16.16.6 tsrc 192.168.13.213 \
tdst 192.168.116.16 router up</pre></li></ol></li>
<li><b>On each system, configure the interface files to pass the correct parameters to
the routing daemon.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>On the enigma system, modify the <tt>/etc/hostname.</tt><i>interface</i> files.</b><pre># <tt><b>cat enigma hostname.hme0</b></tt>
10.16.16.6 private</pre><pre># <tt><b>cat enigma hostname.hme1</b></tt>
192.168.116.16 router</pre></li>
<li><b>On the partym system, modify the <tt>/etc/hostname.</tt><i>interface</i> files.</b><pre># <tt><b>cat partym hostname.hme0</b></tt>
10.1.3.3 private</pre><pre># <tt><b>cat partym hostname.hme1</b></tt>
192.168.13.213 router</pre></li></ol></li>
<li><b>On each system, run a routing protocol.</b><p><a name="indexterm-1880"></a><a name="indexterm-1881"></a>You might need to configure the routing protocol before enabling routing. For more
information, see <a href="ipref-13.html">Routing Protocols in the Solaris OS</a>. For a procedure, see <a href="gcvjj.html#ipconfig-118">How to Configure an IPv4 Router</a>.</p><pre># <tt><b>routeadm -e ipv4-routing</b></tt>
# <tt><b>routeadm -u</b></tt></pre></li></ol><a name="ipsec-mgtasks-27"></a>Example&nbsp;20-10 Requiring IPsec Policy on All Systems in Transport Mode<p><a name="indexterm-1882"></a><a name="indexterm-1883"></a><a name="indexterm-1884"></a>In this example, the administrator comments out the <tt>bypass</tt> policy that was configured
in <a href="#ipsec-mgtasks-nobypass-1">Step&nbsp;4</a>, thereby strengthening the protection. With this policy configuration, each system on the
LAN must activate IPsec to communicate with the router.</p><pre># LAN traffic must implement IPsec.
# {laddr 10.1.3.3 dir both} bypass {}

# WAN traffic uses ESP with 3DES and MD5.
{tunnel ip.tun0 negotiate transport} ipsec {encr_algs 3des encr_auth_algs md5}</pre><a name="ipsec-mgtasks-29"></a>Example&nbsp;20-11 Using Deprecated Syntax to Configure an IPsec Tunnel in Transport Mode<p>In this example, administrator is connecting a  Solaris Express system with a
system that is running the Solaris 10 release. Therefore, the administrator uses Solaris
10 syntax in the configuration file, and includes the IPsec algorithms in the
<tt>ifconfig</tt> command.</p>
<ol><li><p>In <a href="#ipsec-mgtasks-deprec-syntax-1">Step&nbsp;4</a>, the syntax is the following:</p><pre># LAN traffic to and from this address can bypass IPsec.
{laddr 10.1.3.3 dir both} bypass {}

# WAN traffic uses ESP with 3DES and MD5.
{} ipsec {encr_algs 3des encr_auth_algs md5}</pre></li>
<li><p>For <a href="#ipsec-mgtasks-deprec-syntax-2">Step&nbsp;5</a> to <a href="#ipsec-mgtasks-deprec-syntax-4">Step&nbsp;7</a>, the syntax is the following:</p><pre># <tt><b>ifconfig ip.tun0 plumb</b></tt>

# <tt><b>ifconfig ip.tun0 10.16.16.6 10.1.3.3 \</b></tt>
<tt><b>tsrc 192.168.116.16 tdst 192.168.13.213 \</b></tt>
<tt><b>encr_algs 3des encr_auth_algs md5</b></tt>

# <tt><b>ifconfig ip.tun0 router up</b></tt></pre><pre># <tt><b>ifconfig ip.tun0 plumb</b></tt>

# <tt><b>ifconfig ip.tun0 10.16.16.6 10.1.3.3 \</b></tt>
<tt><b>tsrc 192.168.116.16 tdst 192.168.13.213 \</b></tt>
<tt><b>encr_algs 3des encr_auth_algs md5</b></tt></pre><p>The IPsec policy that is passed to the <tt>ifconfig</tt> commands must be the same as the IPsec policy in the <tt>ipsecinit.conf</tt> file. Upon reboot, each system reads the <tt>ipsecinit.conf</tt> file for its policy.</p></li>
<li><p>In <a href="#ipsec-mgtasks-deprec-syntax-5">Step&nbsp;11</a>, the syntax is the following:</p><pre>10.16.16.6 10.1.3.3 tsrc 192.168.116.16 \
tdst 192.168.13.213 encr_algs 3des encr_auth_algs md5 router up</pre></li></ol>


<a name="ipsec-mgtasks-26"></a><h4>How to Protect a VPN With an IPsec Tunnel  in Transport Mode Over IPv6</h4><a name="indexterm-1885"></a><p>To set up a VPN on an IPv6 network, you follow the
same steps as for an IPv4 network. However, the syntax of the commands
is slightly different. For a fuller description of the reasons for running particular
commands, see <a href="#ipsec-mgtasks-23">How to Protect a VPN With an IPsec Tunnel in Tunnel Mode Over IPv4</a>.</p><p>This procedure uses the following configuration parameters.</p><table><col width="39.57*"><col width="29.15*"><col width="30.28*"><tr><th align="left" valign="top" scope="column"><p>Parameter</p></th>
<th align="left" valign="top" scope="column"><p>Europe</p></th>
<th align="left" valign="top" scope="column"><p>California</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>System name</p></td>
<td align="left" valign="top" scope="row"><p>enigma</p></td>
<td align="left" valign="top" scope="row"><p>partym</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>System intranet interface</p></td>
<td align="left" valign="top" scope="row"><p>hme1</p></td>
<td align="left" valign="top" scope="row"><p>hme1</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>System Internet interface</p></td>
<td align="left" valign="top" scope="row"><p>hme0</p></td>
<td align="left" valign="top" scope="row"><p>hme0</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>System
intranet address</p></td>
<td align="left" valign="top" scope="row"><p>6000:6666::aaaa:1116</p></td>
<td align="left" valign="top" scope="row"><p>6000:3333::eeee:1113</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>System Internet address</p></td>
<td align="left" valign="top" scope="row"><p>2001::aaaa:6666:6666</p></td>
<td align="left" valign="top" scope="row"><p>2001::eeee:3333:3333</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Name of Internet router</p></td>
<td align="left" valign="top" scope="row"><p>router-E</p></td>
<td align="left" valign="top" scope="row"><p>router-C</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Address of Internet router</p></td>
<td align="left" valign="top" scope="row"><p>2001::aaaa:0:4</p></td>
<td align="left" valign="top" scope="row"><p>2001::eeee:0:1</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Tunnel name</p></td>
<td align="left" valign="top" scope="row"><p>ip6.tun0</p></td>
<td align="left" valign="top" scope="row"><p>ip6.tun0</p></td>
</tr>
</table><ol>
<li><b>On the system console on one of the systems, assume the Primary Administrator
role or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role and
assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p>
<hr><p><b>Note - </b>Logging in remotely exposes security-critical traffic to eavesdropping. Even if you somehow protect
the remote login, the security of the system is reduced to the security
of the remote login session.</p>
<hr>
</li>
<li><b>Control the flow of packets before configuring IPsec.</b><p>For the effects of these commands, see <a href="#ipsec-mgtasks-packetctrl-1">Step&nbsp;2</a> in <a href="#ipsec-mgtasks-23">How to Protect a VPN With an IPsec Tunnel in Tunnel Mode Over IPv4</a>.</p><ol style="list-style-type: lower-alpha">
				 
<li><b><a name="indexterm-1886"></a>Ensure that IP forwarding and IP dynamic routing are disabled.</b><pre># <tt><b>routeadm</b></tt>
Configuration       Current         Current
       Option       Configuration  System State
--------------------------------------------------
&hellip;
IPv6 forwarding     disabled          disabled
   IPv6 routing     disabled          disabled</pre><p>If forwarding and routing are enabled, you can disable them by typing:</p><pre># <tt><b>routeadm -d ipv6-forwarding -d ipv6-routing</b></tt>
# <tt><b>routeadm -u</b></tt></pre></li>
<li><b>Turn on IP strict destination multihoming.</b><pre># <tt><b>ndd -set /dev/ip ip6_strict_dst_multihoming 1</b></tt></pre></li>
<li><b>Disable most network services, and possibly all network services.</b>
<hr><p><b>Note - </b>If your system was installed with the &ldquo;limited&rdquo; SMF profile, then you can
skip this step. Network services, with the exception of Solaris Secure Shell, are
disabled.</p>
<hr>
<p><a name="indexterm-1887"></a><a name="indexterm-1888"></a>The disabling of network services prevents IP packets from doing any harm to
the system. For example, an SNMP daemon, a <tt>telnet</tt> connection, or an <tt>rlogin</tt>
connection could be exploited.</p><p>You have two options.</p>
<ul><li><p>Run the &ldquo;limited&rdquo; SMF profile.</p><pre># <tt><b>netservices limited</b></tt></pre></li>
<li><p>Or, individually disable network services.</p><pre># <tt><b>svcadm disable network/ftp:default</b></tt>
# <tt><b>svcadm disable network/finger:default</b></tt>
# <tt><b>svcadm disable network/login:rlogin</b></tt>
# <tt><b>svcadm disable network/nfs/server:default</b></tt>
# <tt><b>svcadm disable network/rpc/rstat:default</b></tt>
# <tt><b>svcadm disable network/smtp:sendmail</b></tt>
# <tt><b>svcadm disable network/telnet:default</b></tt>
# <tt><b>svcs | grep network</b></tt>
online         Aug_02   svc:/network/loopback:default
&hellip;
online         Aug_09   svc:/network/ssh:default
&hellip;</pre></li></ul>
</li></ol></li>
<li><b>On each system, add a pair of SAs between the two systems.</b><p>Choose one of the following options.</p>
<ul><li><p>Configure IKE to manage the keys for the SAs. Use one of the procedures in <a href="ike-task-7.html">Configuring IKE (Task Map)</a> to configure IKE for the VPN.</p></li>
<li><p>If you have an overriding reason to manually manage the keys, see <a href="ipsec-mgtasks-4.html#ipsec-mgtasks-13">How to Manually Create IPsec Security Associations</a>.</p></li></ul>
</li>
<li><b>On each system, add IPsec policy.</b><p>Edit the <tt>/etc/inet/ipsecinit.conf</tt> file to add the IPsec policy for the VPN.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>For example, on the <tt>enigma</tt> system, type the following entry into the <tt>ipsecinit.conf</tt>
file:</b><pre># IPv6 Neighbor Discovery messages bypass IPsec.
{ulp ipv6-icmp type 133-137 dir both} pass {}

# LAN traffic can bypass IPsec.
{laddr 6000:6666::aaaa:1116 dir both} bypass {}

# WAN traffic uses ESP with 3DES and MD5.
{tunnel ip6.tun0 negotiate transport} 
 ipsec {encr_algs 3des encr_auth_algs md5}</pre></li>
<li><b>On the <tt>partym</tt> system, type the following entry into the <tt>ipsecinit.conf</tt> file:</b><pre># IPv6 Neighbor Discovery messages bypass IPsec.
{ulp ipv6-icmp type 133-137 dir both} pass {}

# LAN traffic can bypass IPsec.
{laddr 6000:3333::eeee:1113 dir both} bypass {}

# WAN traffic uses ESP with 3DES and MD5.
{tunnel ip6.tun0 negotiate transport} 
 ipsec {encr_algs 3des encr_auth_algs md5}</pre></li></ol></li>
<li><a name="ipsec-tun-6"></a><b><a name="indexterm-1889"></a>On each system, configure a secure tunnel, <tt>ip6.tun0</tt>.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>For example, on the <tt>enigma</tt> system, type the following commands:</b><pre># <tt><b>ifconfig ip6.tun0 inet6 plumb</b></tt>

# <tt><b>ifconfig ip6.tun0 inet6 6000:6666::aaaa:1116 6000:3333::eeee:1113 \</b></tt>
<tt><b>tsrc 2001::aaaa:6666:6666 tdst 2001::eeee:3333:3333</b></tt></pre></li>
<li><b>On the <tt>partym</tt> system, type the following commands:</b><pre># <tt><b>ifconfig ip6.tun0 inet6 plumb</b></tt>

# <tt><b>ifconfig ip6.tun0 inet6 6000:3333::eeee:1113 6000:6666::aaaa:1116 \</b></tt>
<tt><b>tsrc 2001::eeee:3333:3333 tdst 2001::aaaa:6666:6666</b></tt></pre></li></ol></li>
<li><b><a name="indexterm-1890"></a>On each system, turn on IP forwarding for the <tt>hme1</tt> interface. </b><pre># <tt><b>ifconfig hme1 router</b></tt></pre></li>
<li><b>On each system, ensure that routing protocols do not advertise the default route
within the intranet.</b><pre># <tt><b>ifconfig hme0 private</b></tt></pre></li>
<li><b>Manually, add a default route over <tt>hme0</tt>.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>For example, on the <tt>enigma</tt> system, add the following route:</b><pre># <tt><b>route add -inet6 default 2001::aaaa:0:4</b></tt></pre></li>
<li><b><a name="indexterm-1891"></a><a name="indexterm-1892"></a>On the <tt>partym</tt> system, add the following route:</b><pre># <tt><b>route add -inet6 default 2001::eeee:0:1</b></tt></pre></li></ol></li>
<li><a name="ipsec-mgtasks-ipv6-deprec-2"></a><b>Ensure that the VPN starts after a reboot by adding an entry to
the <tt>/etc/hostname6.ip6.tun0</tt> file. </b><p>The entry replicates the parameters that were passed to the <tt>ifconfig</tt> command
in <a href="#ipsec-mgtask-iptun-2">Step&nbsp;5</a>.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>For example, on the <tt>enigma</tt> system, add the following entry to the <tt>hostname6.ip6.tun0</tt>
file:</b><pre>6000:6666::aaaa:1116  6000:3333::eeee:1113 \
tsrc 2001::aaaa:6666:6666   tdst 2001::eeee:3333:3333  router up</pre></li>
<li><b>On the <tt>partym</tt> system, add the following entry to the <tt>hostname6.ip6.tun0</tt> file:</b><pre>6000:3333::eeee:1113  6000:6666::aaaa:1116 \
tsrc 2001::eeee:3333:3333   tdst 2001::aaaa:6666:6666  router up</pre></li></ol></li>
<li><b>On each system, configure the interface files to pass the correct parameters to
the routing daemon.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>On the enigma system, modify the <tt>/etc/hostname6.</tt><i>interface</i> files.</b><pre># <tt><b>cat enigma hostname6.hme0</b></tt>
6000:6666::aaaa:1116 inet6 private</pre><pre>#  <tt><b>cat enigma hostname6.hme1</b></tt>
2001::aaaa:6666:6666 inet6 router</pre></li>
<li><b>On the partym system, modify the <tt>/etc/hostname6.</tt><i>interface</i> files.</b><pre># <tt><b>cat partym hostname6.hme0</b></tt>
6000:3333::eeee:1113 inet6 private</pre><pre># <tt><b>cat partym hostname6.hme1</b></tt>
2001::eeee:3333:3333 inet6 router</pre></li></ol></li>
<li><b>On each system, run a routing protocol.</b><pre># <tt><b>routeadm -e ipv6-routing</b></tt>
# <tt><b>routeadm -u</b></tt></pre></li></ol><a name="ipsec-mgtasks-39"></a>Example&nbsp;20-12 Using Deprecated Syntax to Configure IPsec in Transport Mode Over IPv6<p>In this example, administrator is connecting a  Solaris Express system with a
system that is running the Solaris 10 release. Therefore, the administrator uses Solaris
10 syntax in the configuration file, and includes the IPsec algorithms in the
<tt>ifconfig</tt> command. The steps are performed in the same order, but uses the
 Solaris 10 syntax.</p>
<ol><li><p>In <a href="#ipsec-mgtasks-deprec-syntax-1">Step&nbsp;4</a>, the syntax is the following:</p><pre># IPv6 Neighbor Discovery messages bypass IPsec.
{ulp ipv6-icmp type 133-137 dir both} pass {}

# LAN traffic can bypass IPsec.
{laddr 6000:3333::eeee:1113 dir both} bypass {}

# WAN traffic uses ESP with 3DES and MD5.
{} ipsec {encr_algs 3des encr_auth_algs md5}</pre></li>
<li><p>For <a href="#ipsec-mgtasks-deprec-syntax-2">Step&nbsp;5</a> to <a href="#ipsec-mgtasks-deprec-syntax-4">Step&nbsp;7</a>, the syntax is the following:</p><pre># <tt><b>ifconfig ip6.tun0 inet6 plumb</b></tt>

# <tt><b>ifconfig ip6.tun0 inet6 6000:6666::aaaa:1116 6000:3333::eeee:1113 \</b></tt>
<tt><b>tsrc 2001::aaaa:6666:6666 tdst 2001::eeee:3333:3333 \</b></tt>
<tt><b>encr_algs 3des encr_auth_algs md5</b></tt>

# <tt><b>ifconfig ip6.tun0 inet6 router up</b></tt></pre><p>The IPsec policy that is passed to the <tt>ifconfig</tt> commands must be the same as the IPsec policy in the <tt>ipsecinit.conf</tt> file. Upon reboot, each system reads the <tt>ipsecinit.conf</tt> file for its policy.</p></li>
<li><p>In <a href="#ipsec-mgtasks-ipv6-deprec-2">Step&nbsp;9</a>, the syntax is the following:</p><pre>6000:6666::aaaa:1116  6000:3333::eeee:1113 \
tsrc 2001::aaaa:6666:6666   tdst 2001::eeee:3333:3333 \
encr_algs 3des encr_auth_algs md5 router up</pre></li></ol>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ipsec-mgtasks-vpn-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ipsecref-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

