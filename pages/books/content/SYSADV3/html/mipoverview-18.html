<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Routing Datagrams to and From Mobile Nodes - System Administration Guide: IP Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: IP Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="mipoverview-12.html">Previous</a>
             </td>
             <td align="right">
                 <a href="mipoverview-23.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="iptm-1.html">Part&nbsp;I&nbsp;TCP/IP Administration</a></p>
<p class="toc level2"><a href="ipov-1.html">1.&nbsp;&nbsp;Solaris TCPIP Protocol Suite (Overview)</a></p>
<p class="toc level2"><a href="ipplan-1.html">2.&nbsp;&nbsp;Planning an IPv4 Addressing Scheme (Tasks</a></p>
<p class="toc level2"><a href="ipv6-overview-7.html">3.&nbsp;&nbsp;Planning an IPv6 Addressing Scheme (Overview)</a></p>
<p class="toc level2"><a href="ipv6-planning-1.html">4.&nbsp;&nbsp;Planning an IPv6 Network (Tasks)</a></p>
<p class="toc level2"><a href="ipconfig-1.html">5.&nbsp;&nbsp;Configuring TCP/IP Network Services and IPv4 Addressing (Tasks)</a></p>
<p class="toc level2"><a href="fwawf.html">6.&nbsp;&nbsp;Administering Network Interfaces (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-config-tasks-1.html">7.&nbsp;&nbsp;Enabling IPv6 on a Network (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-admintasks-1.html">8.&nbsp;&nbsp;Administering a TCP/IP Network (Tasks)</a></p>
<p class="toc level2"><a href="gegel.html">9.&nbsp;&nbsp;Troubleshooting Network Problems (Tasks)</a></p>
<p class="toc level2"><a href="ipref-8.html">10.&nbsp;&nbsp;TCP/IP and IPv4 in Depth (Reference)</a></p>
<p class="toc level2"><a href="ipv6-ref-76.html">11.&nbsp;&nbsp;IPv6 in Depth (Reference)</a></p>
<p class="toc level1 tocsp"><a href="dhcptm-1.html">Part&nbsp;II&nbsp;DHCP</a></p>
<p class="toc level2"><a href="dhcp-overview-1.html">12.&nbsp;&nbsp;About Solaris DHCP (Overview)</a></p>
<p class="toc level2"><a href="chap2-26.html">13.&nbsp;&nbsp;Planning for DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="chapter3-20.html">14.&nbsp;&nbsp;Configuring the DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="dhcp-admin-9.html">15.&nbsp;&nbsp;Administering DHCP (Tasks)</a></p>
<p class="toc level2"><a href="eyatl.html">16.&nbsp;&nbsp;Configuring and Administering  DHCP Clients</a></p>
<p class="toc level2"><a href="dhcp-trouble-1.html">17.&nbsp;&nbsp;Troubleshooting DHCP (Reference)</a></p>
<p class="toc level2"><a href="dhcp-ref-4.html">18.&nbsp;&nbsp;DHCP Commands and Files (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipsectm-1.html">Part&nbsp;III&nbsp;IP Security</a></p>
<p class="toc level2"><a href="ipsec-ov-1.html">19.&nbsp;&nbsp;IP Security Architecture (Overview)</a></p>
<p class="toc level2"><a href="ipsec-mgtasks-1.html">20.&nbsp;&nbsp;Configuring IPsec (Tasks)</a></p>
<p class="toc level2"><a href="ipsecref-1.html">21.&nbsp;&nbsp;IP Security Architecture (Reference)</a></p>
<p class="toc level2"><a href="ike-1.html">22.&nbsp;&nbsp;Internet Key Exchange (Overview)</a></p>
<p class="toc level2"><a href="ike-task-1.html">23.&nbsp;&nbsp;Configuring IKE (Tasks)</a></p>
<p class="toc level2"><a href="ikeref-1.html">24.&nbsp;&nbsp;Internet Key Exchange (Reference)</a></p>
<p class="toc level2"><a href="eupsq.html">25.&nbsp;&nbsp;Solaris IP Filter (Overview)</a></p>
<p class="toc level2"><a href="ipfilter-admin-1.html">26.&nbsp;&nbsp;Solaris IP Filter (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="miptm-1.html">Part&nbsp;IV&nbsp;Mobile IP</a></p>
<p class="toc level2"><a href="mipoverview-1.html">27.&nbsp;&nbsp;Mobile IP (Overview)</a></p>
<p class="toc level3"><a href="mipoverview-25.html">Introduction to Mobile IP</a></p>
<p class="toc level3"><a href="mipoverview-29.html">Mobile IP Functional Entities</a></p>
<p class="toc level3"><a href="mipoverview-2.html">How Mobile IP Works</a></p>
<p class="toc level3"><a href="mipoverview-5.html">Agent Discovery</a></p>
<p class="toc level3"><a href="mipoverview-30.html">Care-of Addresses</a></p>
<p class="toc level3"><a href="mipoverview-45.html">Mobile IP With Reverse Tunneling</a></p>
<p class="toc level3"><a href="mipoverview-12.html">Mobile IP Registration</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Routing Datagrams to and From Mobile Nodes</a></p>
</div>
<p class="toc level3"><a href="mipoverview-23.html">Security Considerations for Mobile IP</a></p>
<p class="toc level2 tocsp"><a href="mipimplementing-1.html">28.&nbsp;&nbsp;Administering Mobile IP (Tasks)</a></p>
<p class="toc level2"><a href="mipmanaging-22.html">29.&nbsp;&nbsp;Mobile IP Files and Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipmptm-1.html">Part&nbsp;V&nbsp;IPMP</a></p>
<p class="toc level2"><a href="mpoverview.html">30.&nbsp;&nbsp;Introducing IPMP (Overview)</a></p>
<p class="toc level2"><a href="deploynetmult-56.html">31.&nbsp;&nbsp;Administering IPMP (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ipqostm-1.html">Part&nbsp;VI&nbsp;IP Quality of Service (IPQoS)</a></p>
<p class="toc level2"><a href="ipqos-intro-1.html">32.&nbsp;&nbsp;Introducing IPQoS (Overview)</a></p>
<p class="toc level2"><a href="ipqos-config-planning-1.html">33.&nbsp;&nbsp;Planning for an IPQoS-Enabled Network (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-policy-planning-1.html">34.&nbsp;&nbsp;Creating the IPQoS Configuration File (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-isp-setup-1.html">35.&nbsp;&nbsp;Starting and Maintaining IPQoS (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-accounting-1.html">36.&nbsp;&nbsp;Using Flow Accounting and Statistics Gathering (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-reference-1.html">37.&nbsp;&nbsp;IPQoS in Detail (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="mipoverview-18"></a><h3>Routing Datagrams to and From Mobile Nodes</h3>
<p>This section describes how mobile nodes, home agents, and foreign agents cooperate to
route datagrams for mobile nodes that are connected to a foreign network.
See <a href="mipmanaging-23.html">Overview of the Solaris Mobile IP Implementation</a> for Mobile IP functions that are supported in the Solaris OS.</p>

<a name="mipoverview-19"></a><h4>Encapsulation Methods</h4>
<a name="indexterm-2595"></a><a name="indexterm-2596"></a><p><a name="indexterm-2597"></a><a name="indexterm-2598"></a><a name="indexterm-2599"></a>Home agents and foreign agents use one of the available encapsulation methods to
support datagrams that use a tunnel. Defined encapsulation methods are IP-in-IP Encapsulation, Minimal
Encapsulation, and Generic Routing Encapsulation. Foreign agent and home agent cases, or indirect
colocated mobile node and home agent cases, must support the same encapsulation method.
All Mobile IP entities are required to support IP-in-IP Encapsulation.</p>

<a name="mipoverview-20"></a><h4>Unicast Datagram Routing</h4>
<a name="indexterm-2600"></a><a name="indexterm-2601"></a><p><a name="indexterm-2602"></a><a name="indexterm-2603"></a><a name="indexterm-2604"></a>When registered on a foreign network, the mobile node uses the following rules
to choose a default router:</p>
<ul><li><p>If the mobile node is registered and uses a foreign agent care-of address, the process is straightforward. The mobile node chooses its default router from among the router addresses that are advertised in the ICMP router advertisement portion of that agent advertisement. The mobile node can also consider the IP source address of the agent advertisement as another possible choice for the IP address of a default router.</p></li>
<li><p><a name="indexterm-2605"></a><a name="indexterm-2606"></a>The mobile node might be registered directly with the home agent by using a colocated care-of address. Then, the mobile node chooses its default router from among those routers that are advertised in any ICMP router advertisement message that it receives. The network prefix of the chosen default router must match the network prefix of the care-of address of the mobile node that is externally obtained. The address might match the IP source address of the agent advertisement under the network prefix. Then, the mobile node can also consider that IP source address as another possible choice for the IP address of a default router.</p></li>
<li><p><a name="indexterm-2607"></a><a name="indexterm-2608"></a>If the mobile node is registered, a foreign agent that supports reverse tunnels routes unicast datagrams from the mobile node to the home agent through the reverse tunnel. If the mobile node is registered with a foreign agent that provides reverse tunnel support, the mobile node must use that foreign agent as its default router.</p></li></ul>


<a name="mipoverview-21"></a><h4>Broadcast Datagrams</h4>
<a name="indexterm-2609"></a><a name="indexterm-2610"></a><a name="indexterm-2611"></a><a name="indexterm-2612"></a><p>When a home agent receives a broadcast datagram or multicast datagram, the
home agent only forwards the datagram to mobile nodes that have specifically requested that
they receive them. How the home agent forwards broadcast and multicast datagrams to
mobile nodes depends primarily on two factors. Either that mobile node is
using a foreign-agent provided care-of address, or the mobile node is using its
own colocated care-of address. The former means that the datagram must be double
encapsulated. The first IP header identifies the mobile node for which the datagram
is to be delivered. This first IP header is not present in the
broadcast or multicast datagram. The second IP header identifies the care-of address, and
is the usual tunnel header. In the latter instance, the mobile node is
decapsulating its own datagrams, and the datagram needs only to be sent through
the regular tunnel.</p>

<a name="mipoverview-22"></a><h4>Multicast Datagram Routing</h4>
<a name="indexterm-2613"></a><a name="indexterm-2614"></a><p>To begin receiving multicast traffic when a mobile node is visiting a
foreign subnet, a mobile node can join a multicast group in any of
the following ways:</p>
<ul><li><p><a name="indexterm-2615"></a>If the mobile node is using a colocated care-of address, the mobile node can use this address as the source IP address of any Internet Group Management Protocol (IGMP) join messages. However, a multicast router must be present on the visited subnet.</p></li>
<li><p>If the mobile node wants to join the ICMP group from its home subnet, the mobile node must use a reverse tunnel to send IGMP join messages to the home agent. However, the mobile node's home agent must be a multicast router. The home agent then forwards multicast datagrams through the tunnel to the mobile node.</p></li>
<li><p>If the mobile node is using a colocated care-of address, the mobile node can use this address as the source IP address of any IGMP join messages. However, a multicast router must be present on the visited subnet. After the mobile node has joined the group, the mobile node can participate by sending its own multicast packets directly on the visited network.</p></li></ul>

<ul><li><p>Send directly on the visited network.</p></li>
<li><p>Send through a tunnel to the home agent.</p></li></ul>
<p>Multicast routing depends on the IP source address.  A mobile node
that is sending a multicast datagram must send the datagram from a valid
source address on that link.  So a mobile node that is sending
multicast datagrams directly on the visited network must use a colocated care-of address
as the IP source address. Also, the mobile node must have joined the
multicast group that is associated with the address.  Similarly, a mobile node
that joined a multicast group while on its home subnet before roaming, or
joined the multicast group while roaming through a reverse tunnel to its
home agent, must use its home address as the IP source address of
the multicast datagram. Thus, the mobile node must have these datagrams reverse-tunneled to
its home subnet as well, either through itself by using its colocated care-of
address, or through a foreign agent reverse tunnel.</p><p><a name="indexterm-2616"></a><a name="indexterm-2617"></a>While it seems more efficient for a mobile node to always join
from the subnet that the mobile node is visiting, it is still a
mobile node. Consequently, the mobile node would have to repeat the join every
time the mobile node switches subnets. The more efficient way is for the
mobile node to join through its home agent, and not have to carry
this overhead. Also, multicast sessions might be present that are only available from
the home subnet. Other considerations might also force the  mobile node to
participate in a specific way.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="mipoverview-12.html">Previous</a>
             </td>
             <td align="right">
                 <a href="mipoverview-23.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

