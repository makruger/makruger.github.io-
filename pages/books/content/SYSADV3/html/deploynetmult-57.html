<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Configuring IPMP Groups - System Administration Guide: IP Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: IP Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="deploynetmult-58.html">Previous</a>
             </td>
             <td align="right">
                 <a href="enflg.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="iptm-1.html">Part&nbsp;I&nbsp;TCP/IP Administration</a></p>
<p class="toc level2"><a href="ipov-1.html">1.&nbsp;&nbsp;Solaris TCPIP Protocol Suite (Overview)</a></p>
<p class="toc level2"><a href="ipplan-1.html">2.&nbsp;&nbsp;Planning an IPv4 Addressing Scheme (Tasks</a></p>
<p class="toc level2"><a href="ipv6-overview-7.html">3.&nbsp;&nbsp;Planning an IPv6 Addressing Scheme (Overview)</a></p>
<p class="toc level2"><a href="ipv6-planning-1.html">4.&nbsp;&nbsp;Planning an IPv6 Network (Tasks)</a></p>
<p class="toc level2"><a href="ipconfig-1.html">5.&nbsp;&nbsp;Configuring TCP/IP Network Services and IPv4 Addressing (Tasks)</a></p>
<p class="toc level2"><a href="fwawf.html">6.&nbsp;&nbsp;Administering Network Interfaces (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-config-tasks-1.html">7.&nbsp;&nbsp;Enabling IPv6 on a Network (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-admintasks-1.html">8.&nbsp;&nbsp;Administering a TCP/IP Network (Tasks)</a></p>
<p class="toc level2"><a href="gegel.html">9.&nbsp;&nbsp;Troubleshooting Network Problems (Tasks)</a></p>
<p class="toc level2"><a href="ipref-8.html">10.&nbsp;&nbsp;TCP/IP and IPv4 in Depth (Reference)</a></p>
<p class="toc level2"><a href="ipv6-ref-76.html">11.&nbsp;&nbsp;IPv6 in Depth (Reference)</a></p>
<p class="toc level1 tocsp"><a href="dhcptm-1.html">Part&nbsp;II&nbsp;DHCP</a></p>
<p class="toc level2"><a href="dhcp-overview-1.html">12.&nbsp;&nbsp;About Solaris DHCP (Overview)</a></p>
<p class="toc level2"><a href="chap2-26.html">13.&nbsp;&nbsp;Planning for DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="chapter3-20.html">14.&nbsp;&nbsp;Configuring the DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="dhcp-admin-9.html">15.&nbsp;&nbsp;Administering DHCP (Tasks)</a></p>
<p class="toc level2"><a href="eyatl.html">16.&nbsp;&nbsp;Configuring and Administering  DHCP Clients</a></p>
<p class="toc level2"><a href="dhcp-trouble-1.html">17.&nbsp;&nbsp;Troubleshooting DHCP (Reference)</a></p>
<p class="toc level2"><a href="dhcp-ref-4.html">18.&nbsp;&nbsp;DHCP Commands and Files (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipsectm-1.html">Part&nbsp;III&nbsp;IP Security</a></p>
<p class="toc level2"><a href="ipsec-ov-1.html">19.&nbsp;&nbsp;IP Security Architecture (Overview)</a></p>
<p class="toc level2"><a href="ipsec-mgtasks-1.html">20.&nbsp;&nbsp;Configuring IPsec (Tasks)</a></p>
<p class="toc level2"><a href="ipsecref-1.html">21.&nbsp;&nbsp;IP Security Architecture (Reference)</a></p>
<p class="toc level2"><a href="ike-1.html">22.&nbsp;&nbsp;Internet Key Exchange (Overview)</a></p>
<p class="toc level2"><a href="ike-task-1.html">23.&nbsp;&nbsp;Configuring IKE (Tasks)</a></p>
<p class="toc level2"><a href="ikeref-1.html">24.&nbsp;&nbsp;Internet Key Exchange (Reference)</a></p>
<p class="toc level2"><a href="eupsq.html">25.&nbsp;&nbsp;Solaris IP Filter (Overview)</a></p>
<p class="toc level2"><a href="ipfilter-admin-1.html">26.&nbsp;&nbsp;Solaris IP Filter (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="miptm-1.html">Part&nbsp;IV&nbsp;Mobile IP</a></p>
<p class="toc level2"><a href="mipoverview-1.html">27.&nbsp;&nbsp;Mobile IP (Overview)</a></p>
<p class="toc level2"><a href="mipimplementing-1.html">28.&nbsp;&nbsp;Administering Mobile IP (Tasks)</a></p>
<p class="toc level2"><a href="mipmanaging-22.html">29.&nbsp;&nbsp;Mobile IP Files and Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipmptm-1.html">Part&nbsp;V&nbsp;IPMP</a></p>
<p class="toc level2"><a href="mpoverview.html">30.&nbsp;&nbsp;Introducing IPMP (Overview)</a></p>
<p class="toc level2"><a href="deploynetmult-56.html">31.&nbsp;&nbsp;Administering IPMP (Tasks)</a></p>
<p class="toc level3"><a href="deploynetmult-58.html">Configuring IPMP (Task Maps)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Configuring IPMP Groups</a></p>
</div>
<p class="toc level3"><a href="enflg.html">Maintaining IPMP Groups</a></p>
<p class="toc level4"><a href="enflg.html#deploynetmult-6">How to Display the IPMP Group Membership of an Interface</a></p>
<p class="toc level4"><a href="enflg.html#deploynetmult-103">How to Add an Interface to an IPMP Group</a></p>
<p class="toc level4"><a href="enflg.html#deploynetmult-7">How to Remove an Interface From an IPMP Group</a></p>
<p class="toc level4"><a href="enflg.html#deploynetmult-8">How to Move an Interface From One IPMP Group to Another Group</a></p>
<p class="toc level3 tocsp"><a href="deploynetmult-92.html">Replacing a Failed Physical Interface on Systems That Support Dynamic Reconfiguration</a></p>
<p class="toc level4"><a href="deploynetmult-92.html#deploynetmult-93">How to Remove a Physical Interface That Has Failed (DR-Detach)</a></p>
<p class="toc level4"><a href="deploynetmult-92.html#deploynetmult-97">How to Replace a Physical Interface That Has Failed (DR-Attach)</a></p>
<p class="toc level3 tocsp"><a href="deploynetmult-116.html">Recovering a Physical Interface That Was Not Present at System Boot</a></p>
<p class="toc level4"><a href="deploynetmult-116.html#deploynetmult-107">How to Recover a Physical Interface That Was Not Present at System Boot</a></p>
<p class="toc level3 tocsp"><a href="gbdbr.html">Modifying the <tt>/etc/default/mpathd</tt> IPMP Configuration File</a></p>
<p class="toc level4"><a href="gbdbr.html#gbdbf">How to Configure the <tt>/etc/default/mpathd</tt> File</a></p>
<p class="toc level3 tocsp"><a href="deploynetmult-47.html">Modifying IPMP Configurations</a></p>
<p class="toc level4"><a href="deploynetmult-47.html#deploynetmult-48">How to Configure the <tt>/etc/default/mpathd</tt> File</a></p>
<p class="toc level1 tocsp"><a href="ipqostm-1.html">Part&nbsp;VI&nbsp;IP Quality of Service (IPQoS)</a></p>
<p class="toc level2"><a href="ipqos-intro-1.html">32.&nbsp;&nbsp;Introducing IPQoS (Overview)</a></p>
<p class="toc level2"><a href="ipqos-config-planning-1.html">33.&nbsp;&nbsp;Planning for an IPQoS-Enabled Network (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-policy-planning-1.html">34.&nbsp;&nbsp;Creating the IPQoS Configuration File (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-isp-setup-1.html">35.&nbsp;&nbsp;Starting and Maintaining IPQoS (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-accounting-1.html">36.&nbsp;&nbsp;Using Flow Accounting and Statistics Gathering (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-reference-1.html">37.&nbsp;&nbsp;IPQoS in Detail (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="deploynetmult-57"></a><h3>Configuring IPMP Groups</h3>
<p>This section provides procedures for configuring IPMP groups. It also describes how to
configure an interface as a standby.</p>

<a name="eoxzz"></a><h4>Planning for an IPMP Group</h4>
<p>Before you configure interfaces on a system as part of an IPMP
group, you need to do some preconfiguration planning. </p>

<a name="emyil"></a><h5>How to Plan for an IPMP Group</h5>
<a name="indexterm-2919"></a><a name="indexterm-2920"></a><p>The following procedure includes the planning tasks and information to be gathered prior
to configuring the IPMP group. The tasks do not have to be performed
in sequence.</p><ol>
<li><b>Decide which interfaces on the system are to be part of the
IPMP group.</b><p>An IPMP group usually consists of at least two physical interfaces that are
connected to the same IP link. However, you can configure a single interface
IPMP group, if required. For an introduction to IPMP groups, refer to <a href="eobra.html">IPMP Interface Configurations</a>.
For example, you can configure the same Ethernet switch or the same IP
subnet  under the same IPMP group. You can configure any number of
interfaces into the same IPMP group.</p><p>You cannot use the <tt>group</tt> parameter of the <tt>ifconfig</tt> command with logical interfaces.
For example, you can use the <tt>group</tt> parameter with <tt>hme0</tt>, but not with <tt>hme0:1</tt>.</p></li>
<li><b>Verify that each interface in the group has a unique MAC address.</b><p>For instructions, refer to <a href="#mac11">SPARC: How to Ensure That the MAC Address of an Interface Is Unique, in Solaris 10 3/05 ONLY</a> or <a href="fpcso.html#eyprp">SPARC: How to Ensure That the MAC Address of an Interface Is Unique</a>.</p></li>
<li><b>Choose a name for the IPMP group.</b><p>Any non-null name is appropriate for the group. You might want to use
a name that identifies the IP link to which the interfaces are attached.</p></li>
<li><b>Ensure that the same set of <tt>STREAMS</tt> modules is pushed and configured on
all interfaces in the IPMP group.</b><p>All interfaces in the same group must have the same <tt>STREAMS</tt> modules configured in
the same order.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>Check the order of STREAMS modules on all interfaces in the prospective IPMP
group.<a name="indexterm-2921"></a><a name="indexterm-2922"></a></b><p>You can print out a list of <tt>STREAMS</tt> modules by using the <tt>ifconfig <i>interface</i> modlist</tt>
command. For example, here is the <tt>ifconfig</tt> output for an <tt>hme0</tt> interface:</p><pre># <tt><b>ifconfig hme0 modlist</b></tt>
    0 arp
    1 ip
    2 hme</pre><p>Interfaces normally exist as network drivers directly below the IP module, as shown
in the output from <tt>ifconfig hme0 modlist</tt>. They should not require additional configuration.</p><p>However, certain technologies, such as NCA or IP Filter, insert themselves as STREAMS
modules between the IP module and the network driver. Problems can result in
the way interfaces of the same IPMP group behave.</p><p>If a STREAMS module is stateful, then unexpected behavior can occur on failover,
even if you push the same module onto all of the interfaces in
a group.  However, you can use stateless STREAMS modules, provided that you
push them in the same order on all interfaces in the IPMP group.</p></li>
<li><b>Push the modules of an interface in the standard order for the IPMP
group.</b><pre><tt><b>ifconfig</b></tt> <i>interface</i> <tt><b>modinsert</b></tt> <i>module-name</i></pre><pre>ifconfig hme0 modinsert ip</pre></li></ol></li>
<li><b>Use the same IP addressing format on all interfaces of the IPMP group.</b><p>If one interface is configured for IPv4, then all interfaces of the group
must be configured for IPv4. Suppose you have an IPMP group that is
composed of interfaces from several NICs. If you add IPv6 addressing to the
interfaces of one NIC, then all interfaces in the IPMP group must
be configured for IPv6 support.<a name="indexterm-2923"></a><a name="indexterm-2924"></a><a name="indexterm-2925"></a><a name="indexterm-2926"></a><a name="indexterm-2927"></a><a name="indexterm-2928"></a></p></li>
<li><b>Check that all interfaces in the IPMP group are connected to the same
IP link.</b></li>
<li><b>Verify that the IPMP group does not contain interfaces with different network media
types.</b><p>The interfaces that are grouped together should be of the same interface type,
as defined in <tt>/usr/include/net/if_types.h</tt>. For example, you cannot combine Ethernet and Token
ring interfaces in an IPMP group. As another example, you cannot combine a
Token bus interface with asynchronous transfer mode (ATM) interfaces in the same IPMP
group.</p></li>
<li><b>For IPMP with ATM interfaces, configure the ATM interfaces  in LAN emulation
mode. </b><p>IPMP is not supported for interfaces using Classical IP over ATM.</p></li></ol>

<a name="mac11"></a><h5>SPARC: How to Ensure That the MAC Address of an Interface Is Unique, in Solaris 10 3/05 ONLY</h5>
<a name="indexterm-2929"></a><a name="indexterm-2930"></a><a name="indexterm-2931"></a><p>Before you configure an IPMP group, you must verify that every interface in
the prospective group has a unique MAC address. Almost all interfaces come configured
with a factory-set unique MAC address. However, every SPARC-based system has a system-wide
MAC address, which by default is used by all interfaces. In an IPMP
group, each interface must have a unique MAC address. Therefore, you must ensure
that the EEPROM parameter <tt>local-mac-address?</tt> is set to <tt>true</tt> so that the interfaces
use their factory-set MAC addresses.  You can use the <tt>eeprom</tt> command to
check the current value of <tt>local-mac-address?</tt> and change it, if necessary.</p><ol>
<li><b>On the system with the interfaces to be configured, assume the Primary Administrator
role or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role
and assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><b>Determine whether all interfaces on the system currently use the system-wide MAC address.</b><pre># <tt><b>eeprom local-mac-address?</b></tt>
local-mac-address?=false</pre><p>In the example, the value of <tt>local-mac-address?=false</tt> indicates that all interfaces do use
the system-wide MAC address. The value of <tt>local-mac-address?=false</tt> must  be changed
to <tt>true</tt> before the interfaces can become members of an IPMP group. </p></li>
<li><b>If necessary, change the value of  <tt>local-mac-address?</tt> as follows:</b><pre># <tt><b>eeprom local-mac-address?=true</b></tt></pre><p>When you reboot the system, the interfaces with factory-set MAC addresses instead use
these factory settings. Interfaces without factory-set MAC addresses continue to use the system-wide
MAC address.</p></li>
<li><b>Check the MAC addresses of the interfaces on the system.</b><pre><tt><b>ifconfig -a</b></tt>
lo0: flags=1000849 &lt;UP,LOOPBACK,RUNNING,MULTICAST,IPv4> mtu 8232 index 1
     inet 127.0.0.1 netmask ff000000 
hme0: flags=1004843 &lt;UP,BROADCAST,RUNNING,MULTICAST,IPv4> mtu 1500 index 2
     inet 10.0.0.112 netmask ffffff80 broadcast 10.0.0.127
     ether 8:0:20:0:0:1
hme1: flags=1004843 &lt;UP,BROADCAST,RUNNING,MULTICAST,IPv4> mtu 1500 index 2
     inet 10.0.0.114 netmask ffffff80 broadcast 10.0.0.127
     ether 8:0:20:0:0:1
ge0: flags=1004843 &lt;UP,BROADCAST,RUNNING,MULTICAST,IPv4> mtu 1500 index 2
     inet 10.0.0.118 netmask ffffff80 broadcast 10.0.0.127
     ether 8:0:20:1:1:1</pre><p>Look for cases where multiple interfaces have the same MAC address. In the
previous example, <tt>hme0</tt> and <tt>hme1</tt> both have the same MAC address.</p>
<hr><p><b>Note - </b>Continue to the next step only if more than one network interface still
has the same MAC address.</p>
<hr>
</li>
<li><b>If necessary, manually configure the remaining interfaces so that all interfaces have unique
MAC addresses.</b><p>Place a unique MAC address in the <tt>/etc/hostname.</tt><i>interface</i> for the particular interface. </p>
<hr><p><b>Note - </b>To prevent any risk of manually configured MAC addresses conflicting with other MAC
addresses on your network, you must always configure <b>locally administered</b> MAC addresses, as
defined by the IEEE 802.3 standard.</p>
<hr>
<p>In the previous example, you must configure either <tt>hme0</tt> or <tt>hme1</tt> with
a  locally-administered MAC address.  For example, to reconfigure <tt>hme1</tt>  with
the locally-administered MAC address <tt>06:05:04:03:02</tt>, you would add the following line to
<tt>/etc/hostname.hme1</tt>: </p><pre><tt><b>ether 06:05:04:03:02</b></tt> </pre><p>You also can use the <tt>ifconfig ether</tt> command to configure an interface's MAC address
for the current session. However, any changes made directly with <tt>ifconfig</tt> are not
preserved across reboots. Refer to the <a href="http://docs.sun.com/doc/819-2240/ifconfig-1m?a=view"><tt>ifconfig</tt>(1M)</a> man page for details.</p></li>
<li><b>Reboot the system.</b></li></ol>

<a name="emybr"></a><h4>Configuring IPMP Groups</h4>
<p>This section contains configuration tasks for a typical IPMP group with at least
two physical interfaces.</p>
<ul><li><p>For an introduction to multiple interface IPMP groups, refer to <a href="chapter1-2.html#emjid">IPMP Group</a>. </p></li>
<li><p>For planning tasks, refer to <a href="#eoxzz">Planning for an IPMP Group</a>.</p></li>
<li><p>To configure an IPMP group with only one physical interface, refer to <a href="#mpoverview-10">Configuring IPMP Groups With a Single Physical Interface</a>. </p></li></ul>


<a name="emqul"></a><h5>How to Configure an IPMP Group With Multiple Interfaces</h5>
<a name="indexterm-2932"></a><a name="indexterm-2933"></a><h6>Before You Begin</h6><p>You need to have already configured the IPv4 addresses, and, if appropriate, the
IPv6 addresses of all interfaces in the prospective IPMP group.</p><ol>
<li><b>On the system with the interfaces to be configured, assume the Primary Administrator
role, or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role
and assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><a name="emqup"></a><b>Place each physical interface into an IPMP group.</b><pre># <tt><b>ifconfig</b></tt> <i>interface</i> <tt><b>group</b></tt> <i>group-name</i></pre><p><a name="indexterm-2934"></a><a name="indexterm-2935"></a><a name="indexterm-2936"></a><a name="indexterm-2937"></a>For example, to place <tt>hme0</tt> and <tt>hme1</tt> under group <tt>testgroup1</tt>, you would type
the following commands:</p><pre># <tt><b>ifconfig hme0 group testgroup1</b></tt>
# <tt><b>ifconfig hme1 group testgroup1</b></tt></pre><p>Avoid using spaces in group names. The <tt>ifconfig</tt> status display does not show
spaces. Consequently, do not create two similar group names where the only difference
is that one name also contains a space. If one of the group
names contains a space, these group names look the same in the status
display.</p><p>In a dual-stack environment, placing the IPv4 instance of an interface under a
particular group automatically places the IPv6 instance under the same group.</p></li>
<li><a name="emquq"></a><b><a name="indexterm-2938"></a>(Optional) Configure an IPv4 test address on one or more physical interfaces.</b><p>You need to configure a test address only if you want to use
probe-based failure detection on a particular interface. Test addresses are configured as logical
interfaces of the physical interface that you specify to the <tt>ifconfig</tt> command.</p><p>If one interface in the group is to become the standby interface, do
not configure a test address for that interface at this time. You configure
a test address for the standby interface as part of the task <a href="#enfiu">How to Configure a Standby Interface for an IPMP Group</a>.</p><p>Use the following syntax of the <tt>ifconfig</tt> command for configuring a test address:</p><pre># ifconfig <i>interface</i> addif <i>ip-address</i> &lt;parameters> -failover deprecated up</pre><p>For example, you would create the following test address for the primary network
interface <tt>hme0</tt>:</p><pre># <tt><b>ifconfig hme0 addif 192.168.85.21 netmask + broadcast + -failover deprecated up</b></tt></pre><p>This command sets the following parameters for the primary network interface <tt>hme0</tt>:</p>
<ul><li><p>Address set to <tt>192.168.85.21</tt></p></li>
<li><p>Netmask and broadcast address set to the default value</p></li>
<li><p><tt>-failover</tt> and <tt>deprecated</tt> options set</p>
<hr><p><b>Note - </b>You must mark an IPv4 test address as <tt>deprecated</tt> to prevent applications from using the test address.</p>
<hr>
</li></ul>
</li>
<li><b>Check the IPv4 configuration for a specific interface.</b><p>You can always view the current status of an interface by typing <tt>ifconfig</tt>
<i>interface</i>. For more information on viewing an interface's status, refer to <a href="ipconfig-141.html#ipconfig-46">How to Get Information About a Specific Interface</a>.</p><p>You can get information about test address configuration for a physical interface by
specifying the logical interface that is assigned to the test address.</p><pre># <tt><b>ifconfig hme0:1</b></tt>
    hme0:1: flags=9000843&lt;UP,BROADCAST,RUNNING,MULTICAST,DEPRECATED,IPv4,NOFAILOVER>
    mtu 1500 index 2 
    inet 192.168.85.21 netmask ffffff00 broadcast 192.168.85.255</pre></li>
<li><b>(Optional) If applicable, configure an IPv6 test address.<a name="indexterm-2939"></a></b><pre># ifconfig <i>interface</i> inet6 -failover</pre><p>Physical interfaces with IPv6 addresses are placed into the same IPMP group as
the interfaces' IPv4 addresses. This happens when you configure the physical interface with
IPv4 addresses into an IPMP group.  If you first place physical interfaces
with IPv6 addresses into an IPMP group, physical interfaces with IPv4 addresses are
also implicitly placed in the same IPMP group.</p><p>For example, to configure <tt>hme0</tt> with an IPv6 test address, you would type
the following:</p><pre># <tt><b>ifconfig hme0 inet6 -failover</b></tt></pre><p>You do not need to mark an IPv6 test address as deprecated
to prevent applications from using the test address. </p></li>
<li><b>Check the IPv6 configuration.</b><pre># <tt><b>ifconfig hme0 inet6</b></tt>
    hme0: flags=a000841&lt;UP,RUNNING,MULTICAST,IPv6,NOFAILOVER> mtu 1500 index 2
            inet6 fe80::a00:20ff:feb9:17fa/10 
            groupname test</pre><p>The IPv6 test address is the link-local address of the interface.</p></li>
<li><a name="emqus"></a><b><a name="indexterm-2940"></a>(Optional) Preserve the IPMP group configuration across reboots.</b>
<ul><li><p>For IPv4, add the following line to the <tt>/etc/hostname.</tt><i>interface</i> file:</p><pre><i>interface-address</i> &lt;parameters> group <i>group-name</i> up \
    addif <i>logical-interface</i> -failover deprecated &lt;parameters> up</pre><p>In this instance, the test IPv4 address is configured only on the next reboot. If you want the configuration to be invoked in the current session, do steps 1, 2, and, optionally 3.</p></li>
<li><p>For IPv6, add the following line to the <tt>/etc/hostname6.</tt><i>interface</i> file:</p><pre>-failover group <i>group-name</i> up</pre><p>This test IPv6 address is configured only on the next reboot. If you want the configuration to be invoked in the current session, do steps 1, 2, and, optionally, 5.</p></li></ul>
</li>
<li><b>(Optional) Add more interfaces to the IPMP group by repeating steps 1 through
6. </b><p>You can add new interfaces to an existing group on a live system.
However, changes are lost across reboots.</p></li></ol><a name="emquk"></a>Example&nbsp;31-1 Configuring an IPMP Group With Two Interfaces<p>Suppose you want to do the following:</p>
<ul><li><p>Have the netmask and broadcast address set to the default value.</p></li>
<li><p>Configure the interface with a test address <tt>192.168.85.21</tt>.</p></li></ul>
<p>You would type the following command:</p><pre># ifconfig hme0 addif 192.168.85.21 netmask + broadcast + -failover deprecated up</pre><p>You must mark an IPv4 test address as <tt>deprecated</tt> to prevent applications from
using the test address. See <a href="#emqul">How to Configure an IPMP Group With Multiple Interfaces</a>. </p><p>To turn on the failover attribute of the address, you would use
the <tt>failover</tt> option without the dash </p><p>All test IP addresses in an IPMP group must use the same
network prefix. The test IP addresses must belong to a single IP subnet.</p><a name="emylj"></a>Example&nbsp;31-2 Preserving an IPv4 IPMP Group Configuration Across Reboots<a name="indexterm-2941"></a><p>Suppose you want to create an IPMP group called <tt>testgroup1</tt> with the following
configuration:</p>
<ul><li><p>Physical interface <tt>hme0</tt> with address <tt>192.168.85.19</tt></p></li>
<li><p>A logical interface address of <tt>192.168.85.21</tt></p></li>
<li><p><tt>deprecated</tt> and <tt>-failover</tt> options set</p></li>
<li><p>Netmask and broadcast address set to the default value</p></li></ul>
<p>You would add the following line to the <tt>/etc/hostname.hme0</tt> file:</p><pre>192.168.85.19 netmask + broadcast + group testgroup1 up \
    addif 192.168.85.21 deprecated -failover netmask + broadcast + up</pre><p>Similarly, to place the second interface <tt>hme1</tt> under the same group <tt>testgroup1</tt> and
to configure a test address, you would add the following line:</p><pre>192.168.85.20 netmask + broadcast + group testgroup1 up \
    addif 192.168.85.22 deprecated -failover netmask + broadcast + up</pre><a name="emylm"></a>Example&nbsp;31-3 Preserving an IPv6 IPMP Group Configuration Across Reboots<p>To create a test group for interface <tt>hme0</tt> with an IPv6 address, you
would add the following line to the <tt>/etc/hostname6.hme0</tt> file:</p><pre>-failover group testgroup1 up</pre><p>Similarly, to place the second interface <tt>hme1</tt> in group <tt>testgroup1</tt> and to configure
a test address, you would add the following line to the <tt>/etc/hostname6.hme1</tt> file:</p><pre>-failover group testgroup1 up</pre><h6>Troubleshooting</h6><p><a name="indexterm-2942"></a><a name="indexterm-2943"></a>During IPMP group configuration, <tt>in.mpathd</tt> outputs a number of messages to the system
console or to the <tt>syslog</tt> file. These messages are informational in nature and
indicate that the IPMP configuration functions correctly.</p>
<ul><li><p>This message indicates that interface <tt>hme0</tt> was added to IPMP group <tt>testgroup1</tt>. However, <tt>hme0</tt> does not have a test address configured. To enable probe-based failure detection, you need to assign a test address to the interface.</p><pre>May 24 14:09:57 host1 in.mpathd[101180]: No test address configured on interface hme0;
disabling probe-based failure detection on it.
testgroup1</pre></li>
<li><p>This message appears for all interfaces with only IPv4 addresses that are added to an IPMP group. </p><pre>May 24 14:10:42 host4 in.mpathd[101180]: NIC qfe0 of group testgroup1 is not 
plumbed for IPv6 and may affect failover capability</pre></li>
<li><p>This message should appear when you have configured a test address for an interface.</p><pre>Created new logical interface hme0:1
May 24 14:16:53 host1 in.mpathd[101180]: Test address now configured on interface hme0;
 enabling probe-based failure detection on it</pre></li></ul>
<h6>See Also</h6><p>If you want the IPMP group to have an active-standby configuration, go on
to <a href="#enfiu">How to Configure a Standby Interface for an IPMP Group</a>. </p>

<a name="etmkd"></a><h5>Configuring Target Systems</h5>
<a name="indexterm-2944"></a><a name="indexterm-2945"></a><p>Probe-based failure detection involves the use of target systems, as explained in <a href="emqqq.html#emqra">Probe-Based Failure Detection</a>. For
some IPMP groups, the default targets used by <tt>in.mpathd</tt> is sufficient. However, for
some IPMP groups, you might want to configure specific targets for probe-based failure
detection. You accomplish probe-based failure detection by setting up host routes in the
routing table as probe targets. Any host routes that are configured in the
routing table are listed before the default router. Therefore, IPMP uses the explicitly
defined host routes for target selection. You can use either of two methods
for directly specifying targets: manually setting host routes or creating a shell script
that can become a startup script. </p><p>Consider the following criteria when evaluating which hosts on your network might make
good targets. </p>
<ul><li><p>Make sure that the prospective targets are available and running. Make a list of their IP addresses.</p></li>
<li><p>Ensure that the target interfaces are on the same network as the IPMP group that you are configuring.</p></li>
<li><p>The netmask and broadcast address of the target systems must be the same as the addresses in the IPMP group.</p></li>
<li><p>The target host must be able to answer ICMP requests from the interface that is using probe-based failure detection. </p></li></ul>


<a name="etmem"></a><h5>How to Manually Specify Target Systems for Probe-Based Failure Detection</h5>
<a name="indexterm-2946"></a><a name="indexterm-2947"></a><ol>
<li><b>Log in with your user account to the system where you are
configuring probe-based failure detection.</b></li>
<li><b>Add a route to a particular host to be used as a
target in probe-based failure detection.</b><pre>$ <tt><b>route add -host</b></tt> <i>destination-IP</i> <i>gateway-IP</i> <tt><b>-static</b></tt></pre><p>Replace the values of <i>destination-IP</i> and <i>gateway-IP</i> with the IPv4 address of
the host to be used as a target. For example, you would type
the following to specify the target system <tt>192.168.85.137</tt>, which is on the
same subnet as the interfaces in IPMP group <tt>testgroup1</tt>.</p><pre>$ <tt><b>route add -host 192.168.85.137 192.168.85.137 -static</b></tt> </pre></li>
<li><b>Add routes to additional hosts on the network to be used as
target systems.</b></li></ol>

<a name="etmis"></a><h5>How to Specify Target Systems in a Shell Script</h5>
<a name="indexterm-2948"></a><a name="indexterm-2949"></a><ol>
<li><b>On the system where you have configured an IPMP group, assume the Primary
Administrator role or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role and
assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><b>Create a shell script that sets up static routes to  your
proposed targets. </b><p>For example, you could create a shell script called  <tt>ipmp.targets</tt> with the
following contents:</p><pre>TARGETS="192.168.85.117 192.168.85.127 192.168.85.137"

case "$1" in
        'start')
            /usr/bin/echo "Adding static routes for use as IPMP targets"
        for target in $TARGETS; do
      /usr/sbin/route add -host $target $target
        done
                  ;;
        'stop')
              /usr/bin/echo "Removing static routes for use as IPMP targets"
         for target in $TARGETS; do
        /usr/sbin/route delete -host $target $target
         done
                  ;;
  esac  </pre></li>
<li><b>Copy the shell script to the startup script directory. </b><pre> # <tt><b>cp ipmp.targets /etc/init.d</b></tt>  </pre></li>
<li><b>Change the permissions on the new startup script.  </b><pre># <tt><b>chmod 744 /etc/init.d/ipmp.targets</b></tt></pre></li>
<li><b>Change ownership of the new startup script.  </b><pre># <tt><b>chown root:sys /etc/init.d/ipmp.targets</b></tt></pre></li>
<li><b>Create a link for the startup script in the <tt>/etc/init.d</tt> directory.</b><pre># ln <tt><b>/etc/init.d/ipmp.targets /etc/rc2.d/S70ipmp.targets</b></tt></pre><p>The S70 prefix in the file name <tt>S70ipmp.targets</tt> orders the new script properly
with respect to other startup scripts.</p></li></ol>

<a name="ettlz"></a><h5>Configuring Standby Interfaces</h5>
<p>Use this procedure if you want the IPMP group to have an
active-standby configuration. For more information on this type of configuration, refer to <a href="eobra.html">IPMP Interface Configurations</a>.
</p>

<a name="enfiu"></a><h5>How to Configure a Standby Interface for an IPMP Group</h5>
<a name="indexterm-2950"></a><a name="indexterm-2951"></a><a name="indexterm-2952"></a><h6>Before You Begin</h6>
<ul><li><p>You must have configured all interfaces as members of the IPMP group.</p></li>
<li><p>You should not have configured a test address on the interface to become the standby interface.</p></li></ul>
<p>For information on configuring an IPMP group and assigning test addresses, refer to
<a href="#emqul">How to Configure an IPMP Group With Multiple Interfaces</a>.</p><ol>
<li><b>On the system with the standby interfaces to be configured, assume the Primary
Administrator role or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role and
assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><a name="enfja"></a><b>Configure an interface as a standby and assign the test address.</b><pre># ifconfig <i>interface</i> plumb <i>ip-address</i> &lt;other-parameters> deprecated -failover standby up</pre><p>A standby interface can have only one IP address, the test address. You
must set the <tt>-failover</tt> option before you set the <tt>standby up</tt> option. For
<tt>&lt;other-parameters></tt>, use the parameters that are required by your configuration, as described in
the <a href="http://docs.sun.com/doc/819-2240/ifconfig-1m?a=view"><tt>ifconfig</tt>(1M)</a> man page. </p>
<ul><li><p>For example, to create an IPv4 test address, you would type the following command:</p><pre># <tt><b>ifconfig hme1 plumb 192.168.85.22 netmask + broadcast + deprecated -failover standby up</b></tt></pre><dl><dt><tt>hme1</tt></dt>
<dd><p>Defines <tt>hme1</tt> as the physical interface to be configured as the standby interface.</p></dd>
<dt><tt>192.168.85.22</tt></dt>
<dd><p>Assigns this test address to the standby interface.</p></dd>
<dt><tt>deprecated</tt></dt>
<dd><p>Indicates that the test address is not used for outbound packets. </p></dd>
<dt><tt>-failover</tt></dt>
<dd><p>Indicates that the test address does not fail over if the interface fails.</p></dd>
<dt><tt>standby</tt></dt>
<dd><p>Marks the interface as a standby interface.</p></dd>
</dl>
</li>
<li><p>For example, to create an IPv6 test address, you would type the following command:</p><pre># <tt><b>ifconfig hme1 plumb -failover standby up</b></tt></pre></li></ul>
</li>
<li><b>Check the results of the standby interface configuration.</b><pre># <tt><b>ifconfig hme1</b></tt>
hme1: flags=69040843&lt;UP,BROADCAST,RUNNING,MULTICAST,DEPRECATED,IPv4,NOFAILOVER,
      STANDBY,INACTIVE mtu 1500 
         index 4 inet 192.168.85.22 netmask ffffff00 broadcast 19.16.85.255
         groupname test</pre><p>The <tt>INACTIVE</tt> flag indicates that this interface is not used for any outbound
packets. When a failover occurs on this standby interface, the <tt>INACTIVE</tt> flag is
cleared.</p>
<hr><p><b>Note - </b>You can always view the current status of an interface by typing the
<tt>ifconfig</tt> <i>interface</i> command. For more information on viewing interface status, refer to <a href="ipconfig-141.html#ipconfig-46">How to Get Information About a Specific Interface</a>.</p>
<hr>
</li>
<li><a name="enfjb"></a><b><a name="indexterm-2953"></a><a name="indexterm-2954"></a><a name="indexterm-2955"></a><a name="indexterm-2956"></a><a name="indexterm-2957"></a><a name="indexterm-2958"></a><a name="indexterm-2959"></a>(Optional) Preserve the IPv4 standby interface across reboots.</b><p>Assign the standby interface to the same IPMP group, and configure a test
address for the standby interface.</p><p>For example, to configure <tt>hme1</tt> as the standby interface, you would add
the following line to the <tt>/etc/hostname.hme1</tt> file:</p><pre>192.168.85.22 netmask + broadcast + deprecated group test -failover standby up </pre></li>
<li><b>(Optional) Preserve the IPv6 standby interface across reboots.</b><p>Assign the standby interface to the same IPMP group, and configure a test
address for the standby interface.</p><p>For example, to configure <tt>hme1</tt> as the standby interface, add the following
line to the <tt>/etc/hostname6.hme1</tt> file:</p><pre>-failover group test standby up</pre></li></ol><a name="enfjf"></a>Example&nbsp;31-4 Configuring a Standby Interface for an IPMP Group<p>Suppose you want to  create a test address with the following
configuration:</p>
<ul><li><p>Physical interface <tt>hme2</tt> as a standby interface</p></li>
<li><p>Test address of <tt>192.168.85.22</tt></p></li>
<li><p><tt>deprecated</tt> and <tt>-failover</tt> options set</p></li>
<li><p>Netmask and broadcast address set to the default value</p></li></ul>
<p>You would type the following:</p><pre># ifconfig hme2 plumb 192.168.85.22 netmask + broadcast + deprecated -failover standby up</pre><p>The interface is marked as a standby interface only after the address is
marked as a <tt>NOFAILOVER</tt> address.</p><p>You would remove the standby status of an interface by typing the
following:</p><pre># ifconfig <i>interface</i> -standby</pre>

<a name="mpoverview-10"></a><h4>Configuring IPMP Groups With a Single Physical Interface</h4>
<a name="indexterm-2960"></a><p>When you have only one interface in an IPMP group, failover is
not possible. However, you can enable failure detection on that interface by assigning
the interface to an IPMP group. You do not have to configure a
dedicated test IP address to establish failure detection for a single interface IPMP
group. You can use a single IP address for sending data and detecting
failure. </p>

<a name="enfoy"></a><h5>How to Configure a Single Interface IPMP Group</h5>
<ol>
<li><b>On the system with the prospective single interface IPMP group, assume the Primary
Administrator role or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role and
assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p></li>
<li><b>For IPv4, create the single interface IPMP group.</b><p>You can use either of the following methods:</p>
<ul><li><p>Use the following syntax to assign the single interface to an IPMP group.</p><pre># ifconfig <i>interface</i> -failover group <i>group-name</i></pre><p>The following example assigns the interface <tt>hme0</tt> into the IPMP group <tt>v4test</tt>:</p><pre># <tt><b>ifconfig hme0 -failover group v4test</b></tt></pre><p>Unlike the multiple physical interface configuration, you would not mark a single physical interface as <tt>deprecated</tt>. </p><p>This example includes the use of the <tt>-failover</tt> option of the <tt>ifconfig</tt> command to create an <tt>IFF_NOFAILOVER</tt> flag for the interface. Consider using <tt>-failover</tt> if you might later add more interfaces to the group. The <tt>in.mpathd</tt> daemon sends probe packets by using that address. Later, when you add more interfaces, the configuration should work properly.</p></li>
<li><p>Alternatively, you can use the following syntax to add a single physical interface to an IPMP group:</p><pre># ifconfig <i>interface</i> group <i>group-name</i></pre><p>When you use this configuration, <tt>in.mpathd</tt> chooses a data address to send probe packets. </p></li></ul>
</li>
<li><b>For IPv6, create the single interface IPMP group.</b><p>Use either of the following two methods:</p>
<ul><li><p>Use the following syntax to assign the single interface to an IPMP group:</p><pre># ifconfig <i>interface</i> inet6 -failover group <i>group-name</i></pre><p>For example, you would type the following to add the single interface <tt>hme0</tt> into the IPMP group <tt>v6test</tt>:</p><pre># <tt><b>ifconfig hme0 inet6 -failover group v6test</b></tt></pre></li>
<li><p>Use the following syntax if you do not want to set the <tt>NOFAILOVER</tt> flag:</p><pre># ifconfig <i>interface</i> inet6 group <i>group-name</i></pre><p>When the <tt>in.mpathd</tt> daemon detects failures, the interface is marked and logged appropriately on the console.</p></li></ul>
<p>In a single physical interface configuration, you cannot verify whether the target system
that is being probed has failed or whether the interface has failed. The
target system can be probed through only one physical interface. If only one
default router is on the subnet, turn off IPMP if a single
physical interface is in the group. If a separate IPv4 and IPv6 default
router exists, or multiple default routers exist, more than one target system needs
to be probed. Hence, you can safely turn on IPMP.</p></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="deploynetmult-58.html">Previous</a>
             </td>
             <td align="right">
                 <a href="enflg.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

