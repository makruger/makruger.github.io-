<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Traffic Forwarding on an IPQoS-Enabled Network - System Administration Guide: IP Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: IP Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ipqos-intro-11.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ipqos-config-planning-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="iptm-1.html">Part&nbsp;I&nbsp;TCP/IP Administration</a></p>
<p class="toc level2"><a href="ipov-1.html">1.&nbsp;&nbsp;Solaris TCPIP Protocol Suite (Overview)</a></p>
<p class="toc level2"><a href="ipplan-1.html">2.&nbsp;&nbsp;Planning an IPv4 Addressing Scheme (Tasks</a></p>
<p class="toc level2"><a href="ipv6-overview-7.html">3.&nbsp;&nbsp;Planning an IPv6 Addressing Scheme (Overview)</a></p>
<p class="toc level2"><a href="ipv6-planning-1.html">4.&nbsp;&nbsp;Planning an IPv6 Network (Tasks)</a></p>
<p class="toc level2"><a href="ipconfig-1.html">5.&nbsp;&nbsp;Configuring TCP/IP Network Services and IPv4 Addressing (Tasks)</a></p>
<p class="toc level2"><a href="fwawf.html">6.&nbsp;&nbsp;Administering Network Interfaces (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-config-tasks-1.html">7.&nbsp;&nbsp;Enabling IPv6 on a Network (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-admintasks-1.html">8.&nbsp;&nbsp;Administering a TCP/IP Network (Tasks)</a></p>
<p class="toc level2"><a href="gegel.html">9.&nbsp;&nbsp;Troubleshooting Network Problems (Tasks)</a></p>
<p class="toc level2"><a href="ipref-8.html">10.&nbsp;&nbsp;TCP/IP and IPv4 in Depth (Reference)</a></p>
<p class="toc level2"><a href="ipv6-ref-76.html">11.&nbsp;&nbsp;IPv6 in Depth (Reference)</a></p>
<p class="toc level1 tocsp"><a href="dhcptm-1.html">Part&nbsp;II&nbsp;DHCP</a></p>
<p class="toc level2"><a href="dhcp-overview-1.html">12.&nbsp;&nbsp;About Solaris DHCP (Overview)</a></p>
<p class="toc level2"><a href="chap2-26.html">13.&nbsp;&nbsp;Planning for DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="chapter3-20.html">14.&nbsp;&nbsp;Configuring the DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="dhcp-admin-9.html">15.&nbsp;&nbsp;Administering DHCP (Tasks)</a></p>
<p class="toc level2"><a href="eyatl.html">16.&nbsp;&nbsp;Configuring and Administering  DHCP Clients</a></p>
<p class="toc level2"><a href="dhcp-trouble-1.html">17.&nbsp;&nbsp;Troubleshooting DHCP (Reference)</a></p>
<p class="toc level2"><a href="dhcp-ref-4.html">18.&nbsp;&nbsp;DHCP Commands and Files (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipsectm-1.html">Part&nbsp;III&nbsp;IP Security</a></p>
<p class="toc level2"><a href="ipsec-ov-1.html">19.&nbsp;&nbsp;IP Security Architecture (Overview)</a></p>
<p class="toc level2"><a href="ipsec-mgtasks-1.html">20.&nbsp;&nbsp;Configuring IPsec (Tasks)</a></p>
<p class="toc level2"><a href="ipsecref-1.html">21.&nbsp;&nbsp;IP Security Architecture (Reference)</a></p>
<p class="toc level2"><a href="ike-1.html">22.&nbsp;&nbsp;Internet Key Exchange (Overview)</a></p>
<p class="toc level2"><a href="ike-task-1.html">23.&nbsp;&nbsp;Configuring IKE (Tasks)</a></p>
<p class="toc level2"><a href="ikeref-1.html">24.&nbsp;&nbsp;Internet Key Exchange (Reference)</a></p>
<p class="toc level2"><a href="eupsq.html">25.&nbsp;&nbsp;Solaris IP Filter (Overview)</a></p>
<p class="toc level2"><a href="ipfilter-admin-1.html">26.&nbsp;&nbsp;Solaris IP Filter (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="miptm-1.html">Part&nbsp;IV&nbsp;Mobile IP</a></p>
<p class="toc level2"><a href="mipoverview-1.html">27.&nbsp;&nbsp;Mobile IP (Overview)</a></p>
<p class="toc level2"><a href="mipimplementing-1.html">28.&nbsp;&nbsp;Administering Mobile IP (Tasks)</a></p>
<p class="toc level2"><a href="mipmanaging-22.html">29.&nbsp;&nbsp;Mobile IP Files and Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipmptm-1.html">Part&nbsp;V&nbsp;IPMP</a></p>
<p class="toc level2"><a href="mpoverview.html">30.&nbsp;&nbsp;Introducing IPMP (Overview)</a></p>
<p class="toc level2"><a href="deploynetmult-56.html">31.&nbsp;&nbsp;Administering IPMP (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ipqostm-1.html">Part&nbsp;VI&nbsp;IP Quality of Service (IPQoS)</a></p>
<p class="toc level2"><a href="ipqos-intro-1.html">32.&nbsp;&nbsp;Introducing IPQoS (Overview)</a></p>
<p class="toc level3"><a href="ipqos-intro-52.html">IPQoS Basics</a></p>
<p class="toc level3"><a href="ipqos-intro-6.html">Providing Quality of Service With IPQoS</a></p>
<p class="toc level3"><a href="ipqos-intro-90.html">Improving Network Efficiency With IPQoS</a></p>
<p class="toc level3"><a href="ipqos-intro-11.html">Differentiated Services Model</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Traffic Forwarding on an IPQoS-Enabled Network</a></p>
</div>
<p class="toc level2 tocsp"><a href="ipqos-config-planning-1.html">33.&nbsp;&nbsp;Planning for an IPQoS-Enabled Network (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-policy-planning-1.html">34.&nbsp;&nbsp;Creating the IPQoS Configuration File (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-isp-setup-1.html">35.&nbsp;&nbsp;Starting and Maintaining IPQoS (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-accounting-1.html">36.&nbsp;&nbsp;Using Flow Accounting and Statistics Gathering (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-reference-1.html">37.&nbsp;&nbsp;IPQoS in Detail (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="ipqos-intro-54"></a><h3>Traffic Forwarding on an IPQoS-Enabled Network</h3>
<p><a name="indexterm-3037"></a>This section introduces the elements that are involved in forwarding packets on an
IPQoS-enabled network. An IPQoS-enabled system handles any packets on the network stream with
the system's IP address as the destination. The IPQoS system then applies its
QoS policy to the packet to establish differentiated services.</p>

<a name="ipqos-intro-99"></a><h4>DS Codepoint</h4>
<p><a name="indexterm-3038"></a><a name="indexterm-3039"></a>The DS codepoint (DSCP) defines in the packet header the action that any
Diffserv-aware system should take on a marked packet. The diffserv architecture defines a
set of DS codepoints for the IPQoS-enabled system and diffserv router to use.
The Diffserv architecture also defines a set of  actions that are called
<b>forwarding behaviors</b>, which correspond to the DSCPs. The IPQoS-enabled system marks the precedence bits
of the DS field in the packet header with the DSCP. When a
router receives a packet with a DSCP value, the router applies the forwarding
behavior that is associated with that DSCP. The packet is then released onto
the network. </p>
<hr><p><b>Note - </b>The <tt>dlcosmk</tt> marker does not use the DSCP. Rather, <tt>dlcosmk</tt> marks Ethernet
frame headers with a CoS value. If you plan to configure IPQoS on
a network that uses VLAN devices, refer to <a href="ipqos-reference-2.html#ipqos-reference-11">Marker Module</a>.</p>
<hr>


<a name="ipqos-intro-10"></a><h4>Per-Hop Behaviors</h4>
<p><a name="indexterm-3040"></a><a name="indexterm-3041"></a><a name="indexterm-3042"></a>In Diffserv terminology, the forwarding behavior that is assigned to a DSCP is
called the <b>per-hop behavior (PHB)</b>. The PHB defines the forwarding precedence that a marked packet
receives in relation to other traffic on the Diffserv-aware system. This precedence ultimately determines
whether the IPQoS-enabled system or Diffserv router forwards or drops the marked packet.
For a forwarded packet, each Diffserv router that the packet encounters en route
to its destination applies the same PHB. The exception is if another Diffserv
system changes the DSCP. For more information on PHBs, refer to <a href="ipqos-reference-2.html#ipqos-reference-330">Using the <tt>dscpmk</tt> Marker for Forwarding Packets</a>.</p><p>The goal of a PHB is to provide a specified amount of
network resources to a class of traffic on the contiguous network. You can
achieve this goal in the QoS policy. Define DSCPs that indicate the precedence
levels for traffic classes when the traffic flows leave the IPQoS-enabled system. Precedences can
 range from high-precedence/low-drop probability to low-precedence/high-drop probability. </p><p>For example, your QoS policy can assign to one class of traffic
a DSCP that guarantees a low-drop PHB. This traffic class then receives a
low-drop precedence PHB from any Diffserv-aware router, which guarantees bandwidth to packets of this
class. You can add to the QoS policy other DSCPs that assign varying
levels of precedence to other traffic classes. The lower-precedence packets are given bandwidth
by Diffserv systems in agreement with the priorities that are indicated in the
packets' DSCPs.</p><p>IPQoS supports two types of forwarding behaviors, which are defined in the Diffserv
architecture, expedited forwarding and assured forwarding. </p>

<a name="ipqos-intro-100"></a><h5>Expedited Forwarding</h5>
<p><a name="indexterm-3043"></a><a name="indexterm-3044"></a><a name="indexterm-3045"></a><a name="indexterm-3046"></a>The <b>expedited forwarding (EF)</b> per-hop behavior assures that any traffic class with EFs related DSCP
is given highest priority.  Traffic with an EF DSCP is not queued.
EF provides low loss, latency, and jitter. The recommended DSCP for EF is
101110. A packet that is marked with 101110 receives guaranteed low-drop precedence as
the packet traverses Diffserv-aware networks en route to its destination. Use the EF
DSCP when assigning priority to customers or applications with a premium SLA.</p>

<a name="ipqos-intro-110"></a><h5>Assured Forwarding</h5>
<p><a name="indexterm-3047"></a><a name="indexterm-3048"></a><a name="indexterm-3049"></a>The <b>assured forwarding (AF)</b> per-hop behavior provides four different forwarding classes that you can assign
to a packet. Every forwarding class provides three drop precedences, as shown in
<a href="ipqos-reference-2.html#ipqos-reference-tbl-16">Table&nbsp;37-2</a>. </p><p>The various AF codepoints provide the ability to assign different levels of service
to customers and applications. In the QoS policy,  you can prioritize traffic
and services  on your network when you plan the QoS policy.
You can then assign different AF levels to the prioritized traffic.</p>

<a name="ipqos-intro-86"></a><h5>Packet Forwarding in a Diffserv Environment</h5>
<p><a name="indexterm-3050"></a><a name="indexterm-3051"></a>The following figure shows part of an intranet at a company with a
partially Diffserv-enabled environment. In this scenario, all hosts on networks <tt>10.10.0.0</tt> and
<tt>10.14.0.0</tt> are IPQoS enabled, and the local routers on both networks are Diffserv
aware. However, the interim networks are not configured for Diffserv.</p><a name="ipqos-intro-fig-13"></a><h6>Figure&nbsp;32-2 Packet Forwarding Across Diffserv-Aware Network Hops</h6><img src="figures/diffserv-aware-intra.gif" alt="The context follows the graphic, which is a flow diagram"></img><p><a name="indexterm-3052"></a>The next steps trace the flow of the packet that is shown
in this figure. The steps begin with the progress of a packet that
originates at host <tt>ipqos1</tt>. The steps then  continue through several hops
to host <tt>ipqos2</tt>.</p>
<ol><li><p>The user on <tt>ipqos1</tt> runs the <tt>ftp</tt> command to access host <tt>ipqos2</tt>, which is three hops away.</p></li>
<li><p><tt>ipqos1</tt> applies its QoS policy to the resulting packet flow. <tt>ipqos1</tt> then successfully classifies the <tt>ftp</tt> traffic.</p><p>The system administrator has created a class for all outgoing <tt>ftp</tt> traffic that originates on the local network 10.10.0.0. Traffic for the <tt>ftp</tt> class is assigned the AF22 per-hop behavior: class two, medium-drop precedence. A traffic flow rate of 2Mb/sec is configured for the <tt>ftp</tt> class.</p></li>
<li><p><tt>ipqos-1</tt> meters the <tt>ftp</tt> flow to determine if the flow exceeds the committed rate of 2 Mbit/sec.</p></li>
<li><p>The marker on <tt>ipqos1</tt> marks the DS fields in the outgoing <tt>ftp</tt> packets with the 010100 DSCP, corresponding to the AF22 PHB.</p></li>
<li><p>The router <tt>diffrouter1</tt> receives the <tt>ftp</tt> packets. <tt>diffrouter1</tt> then checks the DSCP. If <tt>diffrouter1</tt> is congested, packets that are marked with AF22 are dropped.</p></li>
<li><p><tt>ftp</tt> traffic is forwarded to the next hop in agreement with the per-hop behavior that is configured for AF22 in <tt>diffrouter1</tt>'s files.</p></li>
<li><p>The <tt>ftp</tt> traffic traverses network <tt>10.12.0.0</tt> to <tt>genrouter</tt>, which is not Diffserv aware. As a result, the traffic receives &ldquo;best-effort&rdquo; forwarding behavior.</p></li>
<li><p><tt>genrouter</tt> passes the <tt>ftp</tt> traffic to network <tt>10.13.0.0</tt>, where the traffic is received by <tt>diffrouter2</tt>.</p></li>
<li><p><tt>diffrouter2</tt> is Diffserv aware. Therefore, the router forwards the <tt>ftp</tt> packets to the network in agreement with the PHB that is defined in the router policy for AF22 packets.</p></li>
<li><p><tt>ipqos2</tt> receives the <tt>ftp</tt> traffic. <tt>ipqos2</tt> then prompts the user on <tt>ipqos1</tt> for a user name and password.</p></li></ol>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ipqos-intro-11.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ipqos-config-planning-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

