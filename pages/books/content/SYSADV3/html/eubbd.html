<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Working With Solaris IP Filter Rule Sets - System Administration Guide: IP Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: IP Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="fabar.html">Previous</a>
             </td>
             <td align="right">
                 <a href="faaxo.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="iptm-1.html">Part&nbsp;I&nbsp;TCP/IP Administration</a></p>
<p class="toc level2"><a href="ipov-1.html">1.&nbsp;&nbsp;Solaris TCPIP Protocol Suite (Overview)</a></p>
<p class="toc level2"><a href="ipplan-1.html">2.&nbsp;&nbsp;Planning an IPv4 Addressing Scheme (Tasks</a></p>
<p class="toc level2"><a href="ipv6-overview-7.html">3.&nbsp;&nbsp;Planning an IPv6 Addressing Scheme (Overview)</a></p>
<p class="toc level2"><a href="ipv6-planning-1.html">4.&nbsp;&nbsp;Planning an IPv6 Network (Tasks)</a></p>
<p class="toc level2"><a href="ipconfig-1.html">5.&nbsp;&nbsp;Configuring TCP/IP Network Services and IPv4 Addressing (Tasks)</a></p>
<p class="toc level2"><a href="fwawf.html">6.&nbsp;&nbsp;Administering Network Interfaces (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-config-tasks-1.html">7.&nbsp;&nbsp;Enabling IPv6 on a Network (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-admintasks-1.html">8.&nbsp;&nbsp;Administering a TCP/IP Network (Tasks)</a></p>
<p class="toc level2"><a href="gegel.html">9.&nbsp;&nbsp;Troubleshooting Network Problems (Tasks)</a></p>
<p class="toc level2"><a href="ipref-8.html">10.&nbsp;&nbsp;TCP/IP and IPv4 in Depth (Reference)</a></p>
<p class="toc level2"><a href="ipv6-ref-76.html">11.&nbsp;&nbsp;IPv6 in Depth (Reference)</a></p>
<p class="toc level1 tocsp"><a href="dhcptm-1.html">Part&nbsp;II&nbsp;DHCP</a></p>
<p class="toc level2"><a href="dhcp-overview-1.html">12.&nbsp;&nbsp;About Solaris DHCP (Overview)</a></p>
<p class="toc level2"><a href="chap2-26.html">13.&nbsp;&nbsp;Planning for DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="chapter3-20.html">14.&nbsp;&nbsp;Configuring the DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="dhcp-admin-9.html">15.&nbsp;&nbsp;Administering DHCP (Tasks)</a></p>
<p class="toc level2"><a href="eyatl.html">16.&nbsp;&nbsp;Configuring and Administering  DHCP Clients</a></p>
<p class="toc level2"><a href="dhcp-trouble-1.html">17.&nbsp;&nbsp;Troubleshooting DHCP (Reference)</a></p>
<p class="toc level2"><a href="dhcp-ref-4.html">18.&nbsp;&nbsp;DHCP Commands and Files (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipsectm-1.html">Part&nbsp;III&nbsp;IP Security</a></p>
<p class="toc level2"><a href="ipsec-ov-1.html">19.&nbsp;&nbsp;IP Security Architecture (Overview)</a></p>
<p class="toc level2"><a href="ipsec-mgtasks-1.html">20.&nbsp;&nbsp;Configuring IPsec (Tasks)</a></p>
<p class="toc level2"><a href="ipsecref-1.html">21.&nbsp;&nbsp;IP Security Architecture (Reference)</a></p>
<p class="toc level2"><a href="ike-1.html">22.&nbsp;&nbsp;Internet Key Exchange (Overview)</a></p>
<p class="toc level2"><a href="ike-task-1.html">23.&nbsp;&nbsp;Configuring IKE (Tasks)</a></p>
<p class="toc level2"><a href="ikeref-1.html">24.&nbsp;&nbsp;Internet Key Exchange (Reference)</a></p>
<p class="toc level2"><a href="eupsq.html">25.&nbsp;&nbsp;Solaris IP Filter (Overview)</a></p>
<p class="toc level2"><a href="ipfilter-admin-1.html">26.&nbsp;&nbsp;Solaris IP Filter (Tasks)</a></p>
<p class="toc level3"><a href="etmhi.html">Configuring Solaris IP Filter</a></p>
<p class="toc level4"><a href="etmhi.html#gdwzk">How to Enable Solaris IP Filter</a></p>
<p class="toc level4"><a href="etmhi.html#eubbr">How to Re-Enable Solaris IP Filter</a></p>
<p class="toc level4"><a href="etmhi.html#gdwzr">How to Enable Loopback Filtering</a></p>
<p class="toc level3 tocsp"><a href="fabar.html">Deactivating and Disabling Solaris IP Filter</a></p>
<p class="toc level4"><a href="fabar.html#ettms">How to Deactivate Packet Filtering</a></p>
<p class="toc level4"><a href="fabar.html#ettmt">How to Deactivate NAT</a></p>
<p class="toc level4"><a href="fabar.html#ettmo">How to Disable Packet Filtering</a></p>
<div class="onpage">
<p class="toc level3 tocsp"><a href="">Working With Solaris IP Filter Rule Sets</a></p>
</div>
<p class="toc level3"><a href="faaxo.html">Displaying Statistics and Information for Solaris IP Filter</a></p>
<p class="toc level4"><a href="faaxo.html#faapk">How to View State Tables for Solaris IP Filter</a></p>
<p class="toc level4"><a href="faaxo.html#faapx">How to View State Statistics for Solaris IP Filter</a></p>
<p class="toc level4"><a href="faaxo.html#faapy">How to View NAT Statistics for Solaris IP Filter</a></p>
<p class="toc level4"><a href="faaxo.html#faapz">How to View Address Pool Statistics for Solaris IP Filter</a></p>
<p class="toc level3 tocsp"><a href="faavk.html">Working With Log Files for Solaris IP Filter</a></p>
<p class="toc level4"><a href="faavk.html#gdfwa">How to Set Up a Log File for Solaris IP Filter</a></p>
<p class="toc level4"><a href="faavk.html#faaqc">How to View Solaris IP Filter Log Files</a></p>
<p class="toc level4"><a href="faavk.html#faaqf">How to Flush the Packet Log File</a></p>
<p class="toc level4"><a href="faavk.html#faard">How to Save Logged Packets to a File</a></p>
<p class="toc level3 tocsp"><a href="ipfilter-admin-2.html">Creating and Editing Solaris IP Filter Configuration Files</a></p>
<p class="toc level4"><a href="ipfilter-admin-2.html#fahpp">How to Create a Configuration File for Solaris IP Filter</a></p>
<p class="toc level1 tocsp"><a href="miptm-1.html">Part&nbsp;IV&nbsp;Mobile IP</a></p>
<p class="toc level2"><a href="mipoverview-1.html">27.&nbsp;&nbsp;Mobile IP (Overview)</a></p>
<p class="toc level2"><a href="mipimplementing-1.html">28.&nbsp;&nbsp;Administering Mobile IP (Tasks)</a></p>
<p class="toc level2"><a href="mipmanaging-22.html">29.&nbsp;&nbsp;Mobile IP Files and Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipmptm-1.html">Part&nbsp;V&nbsp;IPMP</a></p>
<p class="toc level2"><a href="mpoverview.html">30.&nbsp;&nbsp;Introducing IPMP (Overview)</a></p>
<p class="toc level2"><a href="deploynetmult-56.html">31.&nbsp;&nbsp;Administering IPMP (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ipqostm-1.html">Part&nbsp;VI&nbsp;IP Quality of Service (IPQoS)</a></p>
<p class="toc level2"><a href="ipqos-intro-1.html">32.&nbsp;&nbsp;Introducing IPQoS (Overview)</a></p>
<p class="toc level2"><a href="ipqos-config-planning-1.html">33.&nbsp;&nbsp;Planning for an IPQoS-Enabled Network (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-policy-planning-1.html">34.&nbsp;&nbsp;Creating the IPQoS Configuration File (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-isp-setup-1.html">35.&nbsp;&nbsp;Starting and Maintaining IPQoS (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-accounting-1.html">36.&nbsp;&nbsp;Using Flow Accounting and Statistics Gathering (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-reference-1.html">37.&nbsp;&nbsp;IPQoS in Detail (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="eubbd"></a><h3>Working With Solaris IP Filter Rule Sets</h3>
<p>The following task map identifies the procedures associated with Solaris IP Filter rule
sets.</p><a name="euazw"></a><h6>Table&nbsp;26-3 Working With Solaris IP Filter Rule Sets (Task Map)</h6><table><col width="33*"><col width="33*"><col width="33*"><tr><th align="left" valign="top" scope="column"><p>Task</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
<th align="left" valign="top" scope="column"><p>For Instructions</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Manage, view and modify Solaris IP Filter packet filtering rule sets.</p></td>
<td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p><a href="#ettma">Managing Packet Filtering Rule Sets for Solaris IP Filter</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>View
an active packet filtering rule set.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#ezsvx">How to View the Active Packet Filtering Rule Set</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>View an inactive packet filtering rule set.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#fahqf">How to View the Inactive Packet Filtering Rule Set</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>Activate
a different active rule set.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#ettmd">How to Activate a Different or Updated Packet Filtering Rule Set</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>Remove a rule set.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#faaff">How to Remove a Packet Filtering Rule Set</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>Add rules to the rule
sets.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#ettmc">How to Append Rules to the Active Packet Filtering Rule Set</a></p><p><a href="#ettmk">How to Append Rules to the Inactive Packet Filtering Rule Set</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>Move between active and inactive rule sets.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#ettmj">How to Switch Between Active and Inactive Packet Filtering Rule Sets</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>Delete an inactive rule set from
the kernel.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#ettmp">How to Remove an Inactive Packet Filtering Rule Set From the Kernel</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Manage, view and modify Solaris IP Filter NAT rules.</p></td>
<td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p><a href="#faafj">Managing NAT Rules for Solaris IP Filter</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>View active NAT
rules.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#faafa">How to View Active NAT Rules</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>Remove NAT rules.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#faafc">How to Remove NAT Rules</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>Add additional rules to NAT rules.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#faafd">How to Append Rules to the NAT Rules</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Manage, view and modify Solaris
IP Filter address pools.</p></td>
<td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p><a href="#faafi">Managing Address Pools for Solaris IP Filter</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>View active address pools.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#faaez">How to View Active Address Pools</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>Remove an address pool.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#faaey">How to Remove an Address Pool</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>Add additional rules
to an address pool.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#faafn">How to Append Rules to an Address Pool</a></p></td>
</tr>
</table>

<a name="ettma"></a><h4>Managing Packet Filtering Rule Sets for Solaris IP Filter</h4>
<a name="indexterm-2361"></a><a name="indexterm-2362"></a><p>When Solaris IP Filter is enabled, both active and inactive packet filtering
rule sets can reside in the kernel. The active rule set determines what
filtering is being done on incoming packets and outgoing packets. The inactive rule set
also stores rules. These rules are not used unless you make the
inactive rule set the active rule set. You can manage, view, and modify
both active and inactive packet filtering rule sets.</p>

<a name="ezsvx"></a><h5>How to View the Active Packet Filtering Rule Set</h5>
<a name="indexterm-2363"></a><a name="indexterm-2364"></a><a name="indexterm-2365"></a><a name="indexterm-2366"></a><a name="indexterm-2367"></a><a name="indexterm-2368"></a><ol>
<li><b>Assume a role that includes the IP Filter Management rights profile, or become
superuser.</b><p>You can assign the IP Filter Management rights profile to a role that
you create. To create the role and assign the role to a user,
see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>View the active packet filtering rule set that is loaded in the kernel.</b><pre># <tt><b>ipfstat -io</b></tt></pre></li></ol><a name="fahpj"></a>Example&nbsp;26-1 Viewing the Active Packet Filtering Rule Set<p>The following example shows output from the active packet filtering rule set that
is loaded in the kernel.</p><pre># <tt><b>ipfstat -io</b></tt>
empty list for ipfilter(out)
pass in quick on dmfe1 from 192.168.1.0/24 to any
pass in all
block in on dmfe1 from 192.168.1.10/32 to any</pre>

<a name="fahqf"></a><h5>How to View the Inactive Packet Filtering Rule Set</h5>
<a name="indexterm-2369"></a><a name="indexterm-2370"></a><a name="indexterm-2371"></a><a name="indexterm-2372"></a><a name="indexterm-2373"></a><a name="indexterm-2374"></a><ol>
<li><b>Assume a role that includes the IP Filter Management rights profile, or become
superuser.</b><p>You can assign the IP Filter Management rights profile to a role that
you create. To create the role and assign the role to a user,
see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>View the inactive packet filtering rule set.</b><pre># <tt><b>ipfstat -I -io</b></tt></pre></li></ol><a name="fahqh"></a>Example&nbsp;26-2 Viewing the Inactive Packet Filtering Rule Set<p>The following example shows output from the inactive packet filtering rule set.</p><pre># <tt><b>ipfstat -I -io</b></tt>
pass out quick on dmfe1 all
pass in quick on dmfe1 all</pre>

<a name="ettmd"></a><h5>How to Activate a Different or Updated Packet Filtering Rule Set</h5>
<a name="indexterm-2375"></a><a name="indexterm-2376"></a><a name="indexterm-2377"></a><a name="indexterm-2378"></a><a name="indexterm-2379"></a><a name="indexterm-2380"></a><a name="indexterm-2381"></a><p>Use the following procedure if you want to perform either of the
following tasks:</p>
<ul><li><p>Activate a packet filtering rule set other than the one that is currently in use by Solaris IP Filter.</p></li>
<li><p>Reload the same filtering rule set that has been newly updated.</p></li></ul>
<ol>
<li><b>Assume a role that includes the IP Filter Management rights profile, or become
superuser.</b><p>You can assign the IP Filter Management rights profile to a role that
you create. To create the role and assign the role to a user,
see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Choose one of the following steps:</b>
<ul><li><p>Create a new rule set in a separate file of your choice if you want to activate an entirely different rule set.</p></li>
<li><p>Update the current rule set by editing the configuration file that contains that rule set.</p></li></ul>
</li>
<li><b>Remove the current rule set and load the new rule set.</b><pre># <tt><b>ipf -Fa -f </tt><i>filename</i><tt></b></tt></pre><p>The <i>filename</i> can either be the new file with the new rule set
or the updated file that contains the active rule set.</p><p>The active rule set is removed from the kernel. The rules in
the <i>filename</i> file become the active rule set.</p>
<hr><p><b>Note - </b>You still need to issue the command even if you are reloading the
current configuration file. Otherwise, the old rule set continues to be operative, and
the modified rule set in the updated configuration file is not applied.</p><p>Do not use commands such as <tt>ipf <tt>-D</tt></tt> or <tt>svcadm restart</tt> to load the
updated rule set. Such commands expose your network by disabling the firewall first
before loading the new rule set.</p>
<hr>
</li></ol><a name="fahsf"></a>Example&nbsp;26-3 Activating a Different Packet Filtering Rule Set<p>The following example shows how to replace one packet filtering rule set with
another packet filtering rule set in a separate configuration file, <tt>/etc/ipf/ipf.conf</tt>.</p><pre># <tt><b>ipfstat -io</b></tt>
empty list for ipfilter(out)
pass in quick on dmfe all
# <tt><b>ipf -Fa -f /etc/ipf/ipf.conf</b></tt>
# <tt><b>ipfstat -io</b></tt>
empty list for ipfilter(out)
block in log quick from 10.0.0.0/8 to any</pre><a name="gdltk"></a>Example&nbsp;26-4 Reloading an Updated Packet Filtering Rule Set<p>The following example shows how to reload a packet filtering rule set that
is currently active and which is then updated. In this example, the
file in use is <tt>/etc/ipf/ipf.conf</tt>.</p><pre># <tt><b>ipfstat -io</b></tt> (Optional)
empty list for ipfilter (out)
block in log quick from 10.0.0.0/8 to any

(Edit the <tt>/etc/ipf/ipf.conf</tt> configuration file.)

# <tt><b>ip -Fa -f /etc/ipf/ipf.conf</b></tt>
# <tt><b>ipfstat -io</b></tt> (Optional)
empty list for ipfilter (out)
block in log quick from 10.0.0.0/8 to any
block in quick on elx10 from 192.168.0.0/12 to any</pre>

<a name="faaff"></a><h5>How to Remove a Packet Filtering Rule Set</h5>
<a name="indexterm-2382"></a><a name="indexterm-2383"></a><a name="indexterm-2384"></a><ol>
<li><b>Assume a role that includes the IP Filter Management rights profile, or become
superuser.</b><p>You can assign the IP Filter Management rights profile to a role that
you create. To create the role and assign the role to a user,
see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Remove the rule set.</b><pre># <tt><b>ipf -F [a|i|o]</b></tt></pre><dl><dt><tt>-a</tt></dt>
<dd><p>Removes all filtering rules from the rule set.</p></dd>
<dt><tt>-i</tt></dt>
<dd><p>Removes the filtering rules for incoming packets.</p></dd>
<dt><tt>-o</tt></dt>
<dd><p>Removes the filtering rules for outgoing packets.</p></dd>
</dl>
</li></ol><a name="fahsh"></a>Example&nbsp;26-5 Removing a Packet Filtering Rule Set<p>The following example shows how to remove all filtering rules from the active
filtering rule set.</p><pre># <tt><b>ipfstat -io</b></tt>
block out log on dmf0 all
block in log quick from 10.0.0.0/8 to any
# <tt><b>ipf -Fa</b></tt>
# <tt><b>ipfstat -io</b></tt>
empty list for ipfilter(out)
empty list for ipfilter(in)</pre>

<a name="ettmc"></a><h5>How to Append Rules to the Active Packet Filtering Rule Set</h5>
<a name="indexterm-2385"></a><a name="indexterm-2386"></a><a name="indexterm-2387"></a><a name="indexterm-2388"></a><ol>
<li><b>Assume a role that includes the IP Filter Management rights profile, or become
superuser.</b><p>You can assign the IP Filter Management rights profile to a role that
you create. To create the role and assign the role to a user,
see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Use one of the following methods to append rules to the active rule
set:</b>
<ul><li><p>Append rules to the rule set at the command line using the <tt>ipf <tt>-f</tt> -</tt> command.</p><pre># <tt><b>echo "block in on dmfe1 proto tcp from 10.1.1.1/32 to any" | ipf -f -</b></tt></pre></li>
<li><p>Perform the following commands:</p>
<ol><li><p>Create a rule set in a file of your choice.</p></li>
<li><p>Add the rules you have created to the active rule set.</p><pre># <tt><b>ipf -f </tt><i>filename</i><tt></b></tt></pre><p>The rules in <i>filename</i> are added to the end of the active rule set. Because Solaris IP Filter uses a &ldquo;last matching rule&rdquo; algorithm, the added rules determine filtering priorities, unless you use the <tt>quick</tt> keyword. If the packet matches a rule containing the <tt>quick</tt> keyword, the action for that rule is taken, and no subsequent rules are checked.</p></li></ol>
</li></ul>
</li></ol><a name="fahsj"></a>Example&nbsp;26-6 Appending Rules to the Active Packet Filtering Rule Set<p>The following example shows how to add a rule to the active
packet filtering rule set from the command line.</p><pre># <tt><b>ipfstat -io</b></tt>
empty list for ipfilter(out)
block in log quick from 10.0.0.0/8 to any
# <tt><b>echo "block in on dmfe1 proto tcp from 10.1.1.1/32 to any" | ipf -f -</b></tt>
# <tt><b>ipfstat -io</b></tt>
empty list for ipfilter(out)
block in log quick from 10.0.0.0/8 to any
block in on dmfe1 proto tcp from 10.1.1.1/32 to any</pre>

<a name="ettmk"></a><h5>How to Append Rules to the Inactive Packet Filtering Rule Set</h5>
<a name="indexterm-2389"></a><a name="indexterm-2390"></a><a name="indexterm-2391"></a><a name="indexterm-2392"></a><ol>
<li><b>Assume a role that includes the IP Filter Management rights profile, or become
superuser.</b><p>You can assign the IP Filter Management rights profile to a role that
you create. To create the role and assign the role to a user,
see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Create a rule set in a file of your choice.</b></li>
<li><b>Add the rules you have created to the inactive rule set.</b><pre># <tt><b>ipf -I -f </tt><i>filename</i><tt></b></tt></pre><p>The rules in <i>filename</i> are added to the end of the inactive rule
set. Because Solaris IP Filter uses a &ldquo;last matching rule&rdquo; algorithm, the added
rules determine filtering priorities, unless you use the <tt>quick</tt> keyword. If the packet
matches a rule containing the <tt>quick</tt> keyword, the action for that rule is
taken, and no subsequent rules are checked.</p></li></ol><a name="fahsl"></a>Example&nbsp;26-7 Appending Rules to the Inactive Rule Set<p>The following example shows how to add a rule to the inactive
rule set from a file.</p><pre># <tt><b>ipfstat -I -io</b></tt>
pass out quick on dmfe1 all
pass in quick on dmfe1 all
# <tt><b>ipf -I -f /etc/ipf/ipf.conf</b></tt>
# <tt><b>ipfstat -I -io</b></tt>
pass out quick on dmfe1 all
pass in quick on dmfe1 all
block in log quick from 10.0.0.0/8 to any</pre>

<a name="ettmj"></a><h5>How to Switch Between Active and Inactive Packet Filtering Rule Sets</h5>
<a name="indexterm-2393"></a><a name="indexterm-2394"></a><a name="indexterm-2395"></a><ol>
<li><b>Assume a role that includes the IP Filter Management rights profile, or become
superuser.</b><p>You can assign the IP Filter Management rights profile to a role that
you create. To create the role and assign the role to a user,
see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Switch the active and inactive rule sets.</b><pre># <tt><b>ipf -s</b></tt></pre><p>This command enables you to switch between the active and inactive rule sets
in the kernel. Note that if the inactive rule set is empty,
there is no packet filtering.</p></li></ol><a name="fahsk"></a>Example&nbsp;26-8 Switching Between the Active and Inactive Packet Filtering Rule Sets<p>The following example shows how using the <tt>ipf</tt> <tt>-s</tt> command results in the
inactive rule set becoming the active rule set and the active rule set
becoming the inactive rule set.</p>
<ul><li><p>Before running the <tt>ipf</tt> <tt>-s</tt> command, the output from the <tt>ipfstat</tt> <tt>-I</tt> <tt>-io</tt> command shows the rules in the inactive rule set. The output from the <tt>ipfstat</tt> <tt>-io</tt> command shows the rules in the active rule set.</p><pre># <tt><b>ipfstat -io</b></tt>
empty list for ipfilter(out)
block in log quick from 10.0.0.0/8 to any
block in on dmfe1 proto tcp from 10.1.1.1/32 to any
# <tt><b>ipfstat -I -io</b></tt>
pass out quick on dmfe1 all
pass in quick on dmfe1 all
block in log quick from 10.0.0.0/8 to any</pre></li>
<li><p>After running the <tt>ipf</tt> <tt>-s</tt> command, the output from the <tt>ipfstat</tt> <tt>-I</tt> <tt>-io</tt> and  the <tt>ipfstat</tt> <tt>-io</tt> command show that the content of the two rules sets have switched.</p><pre># <tt><b>ipf -s</b></tt>
Set 1 now inactive
# <tt><b>ipfstat -io</b></tt>
pass out quick on dmfe1 all
pass in quick on dmfe1 all
block in log quick from 10.0.0.0/8 to any
# <tt><b>ipfstat -I -io</b></tt>
empty list for inactive ipfilter(out)
block in log quick from 10.0.0.0/8 to any
block in on dmfe1 proto tcp from 10.1.1.1/32 to any</pre></li></ul>


<a name="ettmp"></a><h5>How to Remove an Inactive Packet Filtering Rule Set From the Kernel</h5>
<a name="indexterm-2396"></a><a name="indexterm-2397"></a><a name="indexterm-2398"></a><a name="indexterm-2399"></a><ol>
<li><b>Assume a role that includes the IP Filter Management rights profile, or become
superuser.</b><p>You can assign the IP Filter Management rights profile to a role that
you create. To create the role and assign the role to a user,
see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Specify the inactive rule set in the &ldquo;flush all&rdquo; command.</b><pre># <tt><b>ipf -I -Fa</b></tt></pre><p>This command flushes the inactive rule set from the kernel. </p>
<hr><p><b>Note - </b>If you subsequently run <tt>ipf</tt> <tt>-s</tt>, the empty inactive rule set will become
the active rule set. An empty active rule set means that <b>no</b> filtering
will be done. </p>
<hr>
</li></ol><a name="fahsn"></a>Example&nbsp;26-9 Removing an Inactive Packet Filtering Rule Set From the Kernel<p>The following example shows how to flush the inactive packet filtering rule set
so that all rules have been removed.</p><pre># <tt><b>ipfstat -I -io</b></tt>
empty list for inactive ipfilter(out)
block in log quick from 10.0.0.0/8 to any
block in on dmfe1 proto tcp from 10.1.1.1/32 to any
# <tt><b>ipf -I -Fa</b></tt>
# <tt><b>ipfstat -I -io</b></tt>
empty list for inactive ipfilter(out)
empty list for inactive ipfilter(in)</pre>

<a name="faafj"></a><h4>Managing NAT Rules for Solaris IP Filter</h4>
<p>Use the following procedures to manage, view, and modify NAT rules.</p>

<a name="faafa"></a><h5>How to View Active NAT Rules</h5>
<a name="indexterm-2400"></a><a name="indexterm-2401"></a><a name="indexterm-2402"></a><ol>
<li><b>Assume a role that includes the IP Filter Management rights profile, or become
superuser.</b><p>You can assign the IP Filter Management rights profile to a role that
you create. To create the role and assign the role to a user,
see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>View the active NAT rules.</b><pre># <tt><b>ipnat -l</b></tt></pre></li></ol><a name="fahsm"></a>Example&nbsp;26-10 Viewing Active NAT Rules<p>The following example shows the output from the active NAT rules set.</p><pre># <tt><b>ipnat -l</b></tt>
List of active MAP/Redirect filters:
map dmfe0 192.168.1.0/24 -> 20.20.20.1/32

List of active sessions:</pre>

<a name="faafc"></a><h5>How to Remove NAT Rules</h5>
<a name="indexterm-2403"></a><a name="indexterm-2404"></a><a name="indexterm-2405"></a><ol>
<li><b>Assume a role that includes the IP Filter Management rights profile, or become
superuser.</b><p>You can assign the IP Filter Management rights profile to a role that
you create. To create the role and assign the role to a user,
see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Remove the current NAT rules.</b><pre># <tt><b>ipnat -C</b></tt></pre></li></ol><a name="fahsr"></a>Example&nbsp;26-11 Removing NAT Rules<p>The following example shows how to remove the entries in the current NAT
rules.</p><pre># <tt><b>ipnat -l</b></tt>
List of active MAP/Redirect filters:
map dmfe0 192.168.1.0/24 -> 20.20.20.1/32

List of active sessions:
# <tt><b>ipnat -C</b></tt>
1 entries flushed from NAT list
# <tt><b>ipnat -l</b></tt>
List of active MAP/Redirect filters:

List of active sessions:</pre>

<a name="faafd"></a><h5>How to Append Rules to the NAT Rules</h5>
<a name="indexterm-2406"></a><a name="indexterm-2407"></a><a name="indexterm-2408"></a><a name="indexterm-2409"></a><ol>
<li><b>Assume a role that includes the IP Filter Management rights profile, or become
superuser.</b><p>You can assign the IP Filter Management rights profile to a role that
you create. To create the role and assign the role to a user,
see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Use one of the following methods to append rules to the active rule
set:</b>
<ul><li><p>Append rules to the NAT rule set at the command line using the <tt>ipnat <tt>-f</tt> -</tt> command.</p><pre># <tt><b>echo "map dmfe0 192.168.1.0/24 -> 20.20.20.1/32" | ipnat -f -</b></tt></pre></li>
<li><p>Perform the following commands:</p>
<ol><li><p>Create additional NAT rules in a file of your choice.</p></li>
<li><p>Add the rules you have created to the active NAT rules.</p><pre># <tt><b>ipnat -f </tt><i>filename</i><tt></b></tt></pre><p>The rules in <i>filename</i> are added to the end of the NAT rules.</p></li></ol>
</li></ul>
</li></ol><a name="fahso"></a>Example&nbsp;26-12 Appending Rules to the NAT Rule Set<p>The following example shows how to add a rule to the NAT
rule set from the command line.</p><pre># <tt><b>ipnat -l</b></tt>
List of active MAP/Redirect filters:

List of active sessions:
# <tt><b>echo "map dmfe0 192.168.1.0/24 -> 20.20.20.1/32" | ipnat -f -</b></tt>
# <tt><b>ipnat -l</b></tt>
List of active MAP/Redirect filters:
map dmfe0 192.168.1.0/24 -> 20.20.20.1/32

List of active sessions:</pre>

<a name="faafi"></a><h4>Managing Address Pools for Solaris IP Filter</h4>
<p>Use the following procedures to manage, view, and modify address pools.</p>

<a name="faaez"></a><h5>How to View Active Address Pools</h5>
<a name="indexterm-2410"></a><a name="indexterm-2411"></a><a name="indexterm-2412"></a><a name="indexterm-2413"></a><ol>
<li><b>Assume a role that includes the IP Filter Management rights profile, or become
superuser.</b><p>You can assign the IP Filter Management rights profile to a role that
you create. To create the role and assign the role to a user,
see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>View the active address pool.</b><pre># <tt><b>ippool -l</b></tt></pre></li></ol><a name="fahsp"></a>Example&nbsp;26-13 Viewing the Active Address Pool<p>The following example shows how to view the contents of the active
address pool.</p><pre># <tt><b>ippool -l</b></tt>
table role = ipf type = tree number = 13
        { 10.1.1.1/32, 10.1.1.2/32, 192.168.1.0/24; };</pre>

<a name="faaey"></a><h5>How to Remove an Address Pool</h5>
<a name="indexterm-2414"></a><a name="indexterm-2415"></a><a name="indexterm-2416"></a><ol>
<li><b>Assume a role that includes the IP Filter Management rights profile, or become
superuser.</b><p>You can assign the IP Filter Management rights profile to a role that
you create. To create the role and assign the role to a user,
see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Remove the entries in the current address pool.</b><pre># <tt><b>ippool -F</b></tt></pre></li></ol><a name="fahsq"></a>Example&nbsp;26-14 Removing an Address Pool<p>The following example shows how to remove an address pool.</p><pre># <tt><b>ippool -l</b></tt>
table role = ipf type = tree number = 13
        { 10.1.1.1/32, 10.1.1.2/32, 192.168.1.0/24; };
# <tt><b>ippool -F</b></tt>
1 object flushed
# <tt><b>ippool -l</b></tt></pre>

<a name="faafn"></a><h5>How to Append Rules to an Address Pool</h5>
<a name="indexterm-2417"></a><a name="indexterm-2418"></a><a name="indexterm-2419"></a><a name="indexterm-2420"></a><ol>
<li><b>Assume a role that includes the IP Filter Management rights profile, or become
superuser.</b><p>You can assign the IP Filter Management rights profile to a role that
you create. To create the role and assign the role to a user,
see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Use one of the following methods to append rules to the active rule
set:</b>
<ul><li><p>Append rules to the rule set at the command line using the <tt>ippool <tt>-f</tt> -</tt> command.</p><pre># <tt><b>echo "table role = ipf type = tree number = 13 {10.1.1.1/32, 10.1.1.2/32, 192.168.1.0/24};" | ippool -f -</b></tt></pre></li>
<li><p>Perform the following commands:</p>
<ol><li><p>Create additional address pools in a file of your choice.</p></li>
<li><p>Add the rules you have created to the active address pool.</p><pre># <tt><b>ippool -f </tt><i>filename</i><tt></b></tt></pre><p>The rules in <i>filename</i> are added to the end of the active address pool.</p></li></ol>
</li></ul>
</li></ol><a name="fahss"></a>Example&nbsp;26-15 Appending Rules to an Address Pool<p>The following example shows how to add an address pool to the
address pool rule set from the command line.</p><pre># <tt><b>ippool -l</b></tt>
table role = ipf type = tree number = 13
        { 10.1.1.1/32, 10.1.1.2/32, 192.168.1.0/24; };
# <tt><b>echo "table role = ipf type = tree number = 100 {10.0.0.0/32, 172.16.1.2/32, 192.168.1.0/24};" | ippool -f -</b></tt>
# <tt><b>ippool -l</b></tt>
table role = ipf type = tree number = 100
        { 10.0.0.0/32, 172.16.1.2/32, 192.168.1.0/24; };
table role = ipf type = tree number = 13
        { 10.1.1.1/32, 10.1.1.2/32, 192.168.1.0/24; };</pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="fabar.html">Previous</a>
             </td>
             <td align="right">
                 <a href="faaxo.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

