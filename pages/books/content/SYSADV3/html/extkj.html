<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>DHCP Client Event Scripts - System Administration Guide: IP Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: IP Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="dhcp-overview-5.html">Previous</a>
             </td>
             <td align="right">
                 <a href="dhcp-trouble-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="iptm-1.html">Part&nbsp;I&nbsp;TCP/IP Administration</a></p>
<p class="toc level2"><a href="ipov-1.html">1.&nbsp;&nbsp;Solaris TCPIP Protocol Suite (Overview)</a></p>
<p class="toc level2"><a href="ipplan-1.html">2.&nbsp;&nbsp;Planning an IPv4 Addressing Scheme (Tasks</a></p>
<p class="toc level2"><a href="ipv6-overview-7.html">3.&nbsp;&nbsp;Planning an IPv6 Addressing Scheme (Overview)</a></p>
<p class="toc level2"><a href="ipv6-planning-1.html">4.&nbsp;&nbsp;Planning an IPv6 Network (Tasks)</a></p>
<p class="toc level2"><a href="ipconfig-1.html">5.&nbsp;&nbsp;Configuring TCP/IP Network Services and IPv4 Addressing (Tasks)</a></p>
<p class="toc level2"><a href="fwawf.html">6.&nbsp;&nbsp;Administering Network Interfaces (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-config-tasks-1.html">7.&nbsp;&nbsp;Enabling IPv6 on a Network (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-admintasks-1.html">8.&nbsp;&nbsp;Administering a TCP/IP Network (Tasks)</a></p>
<p class="toc level2"><a href="gegel.html">9.&nbsp;&nbsp;Troubleshooting Network Problems (Tasks)</a></p>
<p class="toc level2"><a href="ipref-8.html">10.&nbsp;&nbsp;TCP/IP and IPv4 in Depth (Reference)</a></p>
<p class="toc level2"><a href="ipv6-ref-76.html">11.&nbsp;&nbsp;IPv6 in Depth (Reference)</a></p>
<p class="toc level1 tocsp"><a href="dhcptm-1.html">Part&nbsp;II&nbsp;DHCP</a></p>
<p class="toc level2"><a href="dhcp-overview-1.html">12.&nbsp;&nbsp;About Solaris DHCP (Overview)</a></p>
<p class="toc level2"><a href="chap2-26.html">13.&nbsp;&nbsp;Planning for DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="chapter3-20.html">14.&nbsp;&nbsp;Configuring the DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="dhcp-admin-9.html">15.&nbsp;&nbsp;Administering DHCP (Tasks)</a></p>
<p class="toc level2"><a href="eyatl.html">16.&nbsp;&nbsp;Configuring and Administering  DHCP Clients</a></p>
<p class="toc level3"><a href="geflo.html">About the Solaris DHCP Client</a></p>
<p class="toc level3"><a href="dhcp-config-67.html">Enabling and Disabling a Solaris DHCP Client</a></p>
<p class="toc level4"><a href="dhcp-config-67.html#dhcp-config-105">How to Enable the Solaris DHCP Client</a></p>
<p class="toc level4"><a href="dhcp-config-67.html#dhcp-config-104">How to Disable a Solaris DHCP Client</a></p>
<p class="toc level3 tocsp"><a href="dhcp-overview-33a.html">DHCP Client Administration</a></p>
<p class="toc level3"><a href="dhcp-overview-35a.html">DHCP Client Systems With Multiple Network Interfaces</a></p>
<p class="toc level3"><a href="eyhuv.html">DHCP Client Host Names</a></p>
<p class="toc level4"><a href="eyhuv.html#dhcp-admin-1058sm">How to Enable a Solaris Client to Request a Specific Host Name</a></p>
<p class="toc level3 tocsp"><a href="dhcp-overview-5.html">DHCP Client Systems and Name Services</a></p>
<div class="onpage">
<p class="toc level3"><a href="">DHCP Client Event Scripts</a></p>
</div>
<p class="toc level2 tocsp"><a href="dhcp-trouble-1.html">17.&nbsp;&nbsp;Troubleshooting DHCP (Reference)</a></p>
<p class="toc level2"><a href="dhcp-ref-4.html">18.&nbsp;&nbsp;DHCP Commands and Files (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipsectm-1.html">Part&nbsp;III&nbsp;IP Security</a></p>
<p class="toc level2"><a href="ipsec-ov-1.html">19.&nbsp;&nbsp;IP Security Architecture (Overview)</a></p>
<p class="toc level2"><a href="ipsec-mgtasks-1.html">20.&nbsp;&nbsp;Configuring IPsec (Tasks)</a></p>
<p class="toc level2"><a href="ipsecref-1.html">21.&nbsp;&nbsp;IP Security Architecture (Reference)</a></p>
<p class="toc level2"><a href="ike-1.html">22.&nbsp;&nbsp;Internet Key Exchange (Overview)</a></p>
<p class="toc level2"><a href="ike-task-1.html">23.&nbsp;&nbsp;Configuring IKE (Tasks)</a></p>
<p class="toc level2"><a href="ikeref-1.html">24.&nbsp;&nbsp;Internet Key Exchange (Reference)</a></p>
<p class="toc level2"><a href="eupsq.html">25.&nbsp;&nbsp;Solaris IP Filter (Overview)</a></p>
<p class="toc level2"><a href="ipfilter-admin-1.html">26.&nbsp;&nbsp;Solaris IP Filter (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="miptm-1.html">Part&nbsp;IV&nbsp;Mobile IP</a></p>
<p class="toc level2"><a href="mipoverview-1.html">27.&nbsp;&nbsp;Mobile IP (Overview)</a></p>
<p class="toc level2"><a href="mipimplementing-1.html">28.&nbsp;&nbsp;Administering Mobile IP (Tasks)</a></p>
<p class="toc level2"><a href="mipmanaging-22.html">29.&nbsp;&nbsp;Mobile IP Files and Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipmptm-1.html">Part&nbsp;V&nbsp;IPMP</a></p>
<p class="toc level2"><a href="mpoverview.html">30.&nbsp;&nbsp;Introducing IPMP (Overview)</a></p>
<p class="toc level2"><a href="deploynetmult-56.html">31.&nbsp;&nbsp;Administering IPMP (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ipqostm-1.html">Part&nbsp;VI&nbsp;IP Quality of Service (IPQoS)</a></p>
<p class="toc level2"><a href="ipqos-intro-1.html">32.&nbsp;&nbsp;Introducing IPQoS (Overview)</a></p>
<p class="toc level2"><a href="ipqos-config-planning-1.html">33.&nbsp;&nbsp;Planning for an IPQoS-Enabled Network (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-policy-planning-1.html">34.&nbsp;&nbsp;Creating the IPQoS Configuration File (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-isp-setup-1.html">35.&nbsp;&nbsp;Starting and Maintaining IPQoS (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-accounting-1.html">36.&nbsp;&nbsp;Using Flow Accounting and Statistics Gathering (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-reference-1.html">37.&nbsp;&nbsp;IPQoS in Detail (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="extkj"></a><h3>DHCP Client Event Scripts</h3>
<a name="indexterm-1542"></a><a name="indexterm-1543"></a><a name="indexterm-1544"></a><a name="indexterm-1545"></a><p>You can set up the Solaris DHCP client to run an executable
program or script that can perform any action that is appropriate for the
client system. The program or script, which is called an <b>event script</b>, is automatically executed
after certain DHCP lease events occur. The event script can be used to
run other commands, programs, or scripts in response to specific lease events. You
must provide your own event script to use this feature.</p><p>The following event keywords are used by <tt>dhcpagent</tt> to signify DHCP lease events:</p><dl><dt><b>Event Keyword</b></dt>
<dd><p><b>Description</b></p></dd>
<dt><tt>BOUND</tt></dt>
<dd><p>The interface is configured for DHCP. The client receives the acknowledgement message (<tt>ACK</tt>) from the DHCP server, which grants the lease request for an IP address. The event script is invoked immediately after the interface is configured successfully.</p></dd>
<dt><tt>EXTEND</tt></dt>
<dd><p>The client successfully extends a lease. The event script is invoked immediately after the client receives the acknowledgement message from the DHCP server for the renew request.</p></dd>
<dt><tt>EXPIRE</tt></dt>
<dd><p>The lease expires when the lease time is up. The event script is invoked immediately before the leased address is removed from the interface and the interface is marked as down.</p></dd>
<dt><tt>DROP</tt></dt>
<dd><p>The client drops the lease to remove the interface from DHCP control. The event script is invoked immediately before the interface is removed from DHCP control.</p></dd>
<dt><tt>RELEASE</tt></dt>
<dd><p>The client relinquishes the IP address. The event script is invoked immediately before the client releases the address on the interface and sends the <tt>RELEASE</tt> packet to the DHCP server.</p></dd>
</dl>
<p><a name="indexterm-1546"></a><a name="indexterm-1547"></a>With each of these events, <tt>dhcpagent</tt> invokes the following command:</p><pre>/etc/dhcp/eventhook <i>interface event</i></pre><p>where <i>interface</i> is the interface that is using DHCP and <i>event</i> is one
of the event keywords described previously. For example, when the <tt>ce0</tt> interface is first
configured for DHCP, the <tt>dhcpagent</tt> invokes the event script as follows:</p><pre>/etc/dhcp/eventhook ce0 BOUND</pre><p>To use the event script feature, you must do the following:</p>
<ul><li><p>Name the executable file <tt>/etc/dhcp/eventhook</tt>.</p></li>
<li><p>Set the owner of the file to be <tt>root</tt>.</p></li>
<li><p>Set permissions to <tt>755</tt> (<tt>rwxr-xr-x</tt>).</p></li>
<li><p>Write the script or program to perform a sequence of actions in response to any of the documented events. Because Sun might add new events, the program must silently ignore any events that are not recognized or do not require action. For example, the program or script might write to a log file when the event is <tt>RELEASE</tt>, and ignore all other events.</p></li>
<li><p>Make the script or program noninteractive. Before the event script is invoked, <tt>stdin</tt>, <tt>stdout</tt>, and <tt>stderr</tt> are connected to <tt>/dev/null</tt>. To see the output or errors, you must redirect to a file.</p></li>
<li><p>Enable the script or program to be run with the following command:</p><pre>/etc/dhcp/eventhook <i>interface event</i></pre></li></ul>
<p>The event script inherits its program environment from <tt>dhcpagent</tt>, and runs with <tt>root</tt>
privileges. The script can use the <tt>dhcpinfo</tt> utility to obtain more information
about the interface, if necessary. See the <a href="http://docs.sun.com/doc/819-2239/dhcpinfo-1?a=view"><tt>dhcpinfo</tt>(1)</a> man page for more information.</p><p>The <tt>dhcpagent</tt> daemon waits for the event script to exit on all events.
If the event script does not exit after 55 seconds, <tt>dhcpagent</tt> sends
a <tt>SIGTERM</tt> signal to the script process. If the process still does not
exit after three additional seconds, the daemon sends a <tt>SIGKILL</tt> signal to kill
the process.</p><p>The <a href="http://docs.sun.com/doc/819-2240/dhcpagent-1m?a=view"><tt>dhcpagent</tt>(1M)</a> man page includes one example of an event script.</p><p><a href="#fapgt">Example&nbsp;16-3</a> shows how to use a DHCP event script to keep the content
of the <tt>/etc/resolv.conf</tt> file up to date. When the <tt>BOUND</tt> and <tt>EXTEND</tt> events occur,
the script replaces the names of the domain server and name server. When
the <tt>EXPIRE</tt>, <tt>DROP</tt> and <tt>RELEASE</tt> events occur, the script removes the names of
the domain server and name server from the file.</p>
<hr><p><b>Note - </b>The example script assumes that DHCP is the authoritative source for the names
of the domain server and the name server. The script also assumes that
all interfaces under DHCP control return consistent and current information. These assumptions might
not reflect conditions on your system.</p>
<hr>
<a name="fapgt"></a>Example&nbsp;16-3 Event Script for Updating the <tt>/etc/resolv.conf</tt> File<pre>#!/bin/ksh -p

PATH=/bin:/sbin export PATH
umask 0222

# Refresh the domain and name servers on /etc/resolv.conf

insert ()
{
    dnsservers=`dhcpinfo -i $1 DNSserv`
    if [ -n "$dnsservers" ]; then
        # remove the old domain and name servers
        if [ -f /etc/resolv.conf ]; then
            rm -f /tmp/resolv.conf.$$
            sed -e '/^domain/d' -e '/^nameserver/d' \
                /etc/resolv.conf > /tmp/resolv.conf.$$
        fi

        # add the new domain
        dnsdomain=`dhcpinfo -i $1 DNSdmain`
        if [ -n "$dnsdomain" ]; then
            echo "domain $dnsdomain" >> /tmp/resolv.conf.$$
        fi

        # add new name servers
        for name in $dnsservers; do
            echo nameserver $name >> /tmp/resolv.conf.$$
        done
        mv -f /tmp/resolv.conf.$$ /etc/resolv.conf
    fi
}

# Remove the domain and name servers from /etc/resolv.conf

remove ()
{
    if [ -f /etc/resolv.conf ]; then
        rm -f /tmp/resolv.conf.$$
        sed -e '/^domain/d' -e '/^nameserver/d' \
            /etc/resolv.conf > /tmp/resolv.conf.$$
        mv -f /tmp/resolv.conf.$$ /etc/resolv.conf
    fi
}

case $2 in
BOUND | EXTEND)
    insert $1
    exit 0
    ;;
EXPIRE | DROP | RELEASE)
    remove
    exit 0
    ;;
*)
    exit 0
    ;;
esac</pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="dhcp-overview-5.html">Previous</a>
             </td>
             <td align="right">
                 <a href="dhcp-trouble-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

