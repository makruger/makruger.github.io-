<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>How the TCP/IP Protocols Handle Data Communications - System Administration Guide: IP Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: IP Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ipov-6.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ipov-43.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="iptm-1.html">Part&nbsp;I&nbsp;TCP/IP Administration</a></p>
<p class="toc level2"><a href="ipov-1.html">1.&nbsp;&nbsp;Solaris TCPIP Protocol Suite (Overview)</a></p>
<p class="toc level3"><a href="ipov-6.html">Introducing the TCP/IP Protocol Suite</a></p>
<div class="onpage">
<p class="toc level3"><a href="">How the TCP/IP Protocols Handle Data Communications</a></p>
</div>
<p class="toc level3"><a href="ipov-43.html">Finding Out More About TCP/IP and the Internet</a></p>
<p class="toc level2 tocsp"><a href="ipplan-1.html">2.&nbsp;&nbsp;Planning an IPv4 Addressing Scheme (Tasks</a></p>
<p class="toc level2"><a href="ipv6-overview-7.html">3.&nbsp;&nbsp;Planning an IPv6 Addressing Scheme (Overview)</a></p>
<p class="toc level2"><a href="ipv6-planning-1.html">4.&nbsp;&nbsp;Planning an IPv6 Network (Tasks)</a></p>
<p class="toc level2"><a href="ipconfig-1.html">5.&nbsp;&nbsp;Configuring TCP/IP Network Services and IPv4 Addressing (Tasks)</a></p>
<p class="toc level2"><a href="fwawf.html">6.&nbsp;&nbsp;Administering Network Interfaces (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-config-tasks-1.html">7.&nbsp;&nbsp;Enabling IPv6 on a Network (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-admintasks-1.html">8.&nbsp;&nbsp;Administering a TCP/IP Network (Tasks)</a></p>
<p class="toc level2"><a href="gegel.html">9.&nbsp;&nbsp;Troubleshooting Network Problems (Tasks)</a></p>
<p class="toc level2"><a href="ipref-8.html">10.&nbsp;&nbsp;TCP/IP and IPv4 in Depth (Reference)</a></p>
<p class="toc level2"><a href="ipv6-ref-76.html">11.&nbsp;&nbsp;IPv6 in Depth (Reference)</a></p>
<p class="toc level1 tocsp"><a href="dhcptm-1.html">Part&nbsp;II&nbsp;DHCP</a></p>
<p class="toc level2"><a href="dhcp-overview-1.html">12.&nbsp;&nbsp;About Solaris DHCP (Overview)</a></p>
<p class="toc level2"><a href="chap2-26.html">13.&nbsp;&nbsp;Planning for DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="chapter3-20.html">14.&nbsp;&nbsp;Configuring the DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="dhcp-admin-9.html">15.&nbsp;&nbsp;Administering DHCP (Tasks)</a></p>
<p class="toc level2"><a href="eyatl.html">16.&nbsp;&nbsp;Configuring and Administering  DHCP Clients</a></p>
<p class="toc level2"><a href="dhcp-trouble-1.html">17.&nbsp;&nbsp;Troubleshooting DHCP (Reference)</a></p>
<p class="toc level2"><a href="dhcp-ref-4.html">18.&nbsp;&nbsp;DHCP Commands and Files (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipsectm-1.html">Part&nbsp;III&nbsp;IP Security</a></p>
<p class="toc level2"><a href="ipsec-ov-1.html">19.&nbsp;&nbsp;IP Security Architecture (Overview)</a></p>
<p class="toc level2"><a href="ipsec-mgtasks-1.html">20.&nbsp;&nbsp;Configuring IPsec (Tasks)</a></p>
<p class="toc level2"><a href="ipsecref-1.html">21.&nbsp;&nbsp;IP Security Architecture (Reference)</a></p>
<p class="toc level2"><a href="ike-1.html">22.&nbsp;&nbsp;Internet Key Exchange (Overview)</a></p>
<p class="toc level2"><a href="ike-task-1.html">23.&nbsp;&nbsp;Configuring IKE (Tasks)</a></p>
<p class="toc level2"><a href="ikeref-1.html">24.&nbsp;&nbsp;Internet Key Exchange (Reference)</a></p>
<p class="toc level2"><a href="eupsq.html">25.&nbsp;&nbsp;Solaris IP Filter (Overview)</a></p>
<p class="toc level2"><a href="ipfilter-admin-1.html">26.&nbsp;&nbsp;Solaris IP Filter (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="miptm-1.html">Part&nbsp;IV&nbsp;Mobile IP</a></p>
<p class="toc level2"><a href="mipoverview-1.html">27.&nbsp;&nbsp;Mobile IP (Overview)</a></p>
<p class="toc level2"><a href="mipimplementing-1.html">28.&nbsp;&nbsp;Administering Mobile IP (Tasks)</a></p>
<p class="toc level2"><a href="mipmanaging-22.html">29.&nbsp;&nbsp;Mobile IP Files and Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipmptm-1.html">Part&nbsp;V&nbsp;IPMP</a></p>
<p class="toc level2"><a href="mpoverview.html">30.&nbsp;&nbsp;Introducing IPMP (Overview)</a></p>
<p class="toc level2"><a href="deploynetmult-56.html">31.&nbsp;&nbsp;Administering IPMP (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ipqostm-1.html">Part&nbsp;VI&nbsp;IP Quality of Service (IPQoS)</a></p>
<p class="toc level2"><a href="ipqos-intro-1.html">32.&nbsp;&nbsp;Introducing IPQoS (Overview)</a></p>
<p class="toc level2"><a href="ipqos-config-planning-1.html">33.&nbsp;&nbsp;Planning for an IPQoS-Enabled Network (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-policy-planning-1.html">34.&nbsp;&nbsp;Creating the IPQoS Configuration File (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-isp-setup-1.html">35.&nbsp;&nbsp;Starting and Maintaining IPQoS (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-accounting-1.html">36.&nbsp;&nbsp;Using Flow Accounting and Statistics Gathering (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-reference-1.html">37.&nbsp;&nbsp;IPQoS in Detail (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="ipov-29"></a><h3>How the TCP/IP Protocols Handle Data Communications</h3>
<p><a name="indexterm-126"></a><a name="indexterm-127"></a>When a user issues a command that uses a TCP/IP application layer protocol,
a series of events is initiated. The user's command or message passes through
the TCP/IP protocol stack on the local system. Then, the command or message
passes across the network media to the protocols on the remote system. The
protocols at each layer on the sending host add information to the
original data. </p><p>Protocols on each layer of the sending host also interact with their peers
on the receiving host. <a href="#ipov-fig-30">Figure&nbsp;1-1</a> shows this interaction.</p>

<a name="ipov-32"></a><h4>Data Encapsulation and the TCP/IP Protocol Stack</h4>
<p><a name="indexterm-128"></a><a name="indexterm-129"></a><a name="indexterm-130"></a><a name="indexterm-131"></a><a name="indexterm-132"></a>The packet is the basic unit of information that is transferred across a
network. The basic packet consists of a header with the sending and receiving
systems' addresses, and a body, or <b>payload</b>, with the data to be transferred.
As the packet travels through the TCP/IP protocol stack, the protocols at each
layer either add or remove fields from the basic header. When a protocol
on the sending system adds data to the packet header, the process is
called <b>data encapsulation</b>. Moreover, each layer has a different term for the altered packet,
as shown in the following figure. </p><a name="ipov-fig-30"></a><h6>Figure&nbsp;1-1 How a Packet Travels Through the TCP/IP Stack</h6><img src="figures/ipov.fig88.gif" alt="Diagram shows how a packet travels through the TCP/IP stack from the sending host to the receiving host."></img><p><a name="indexterm-133"></a><a name="indexterm-134"></a><a name="indexterm-135"></a>This section summarizes the life cycle of a packet. The life cycle starts
when you issue a command or send a message. The life cycle
finishes when the appropriate application on the receiving system receives the packet. </p>

<a name="ipov-33"></a><h5>Application Layer: Where a Communication Originates</h5>
<p><a name="indexterm-136"></a><a name="indexterm-137"></a><a name="indexterm-138"></a><a name="indexterm-139"></a>The packet's history begins when a user on one system sends a message
or issues a command that must access a remote system. The application protocol
formats the packet so that the appropriate transport layer protocol, TCP or UDP,
can handle the packet. </p><p><a name="indexterm-140"></a>Suppose the user issues an <tt>rlogin</tt> command to log in to the remote
system, as shown in <a href="#ipov-fig-30">Figure&nbsp;1-1</a>. The <tt>rlogin</tt> command uses the TCP transport layer
protocol. TCP expects to receive data in the form of a stream
of bytes that contain the information in the command. Therefore, <tt>rlogin</tt> sends this data
as a TCP stream. </p>

<a name="ipov-34"></a><h5>Transport Layer: Where Data Encapsulation Begins</h5>
<p><a name="indexterm-141"></a><a name="indexterm-142"></a><a name="indexterm-143"></a><a name="indexterm-144"></a>When the data arrives at the transport layer, the protocols at the layer
start the process of data encapsulation. The transport layer encapsulates the application data
into transport protocol data units. </p><p>The transport layer protocol creates a virtual flow of data between the sending
and receiving application, differentiated by the transport port number.  The port number
identifies a <b>port</b>, a dedicated location in memory for receiving or sending data.
In addition, the transport protocol layer might provide other services, such as reliable,
in order data delivery. The end result depends on whether TCP, SCTP, or
UDP handles the information.</p>

<a name="ipov-35"></a><h5>TCP Segmentation</h5>
<p><a name="indexterm-145"></a>TCP is often called a &ldquo;connection-oriented&rdquo; protocol because TCP ensures the successful delivery
of data to the receiving host. <a href="#ipov-fig-30">Figure&nbsp;1-1</a> shows how the TCP protocol receives
the stream from the <tt>rlogin</tt> command. TCP then divides the data that is
received from the application layer into segments and attaches a header to each
segment. </p><p>Segment headers contain sending and receiving ports, segment ordering information, and a data
field that is known as a <b>checksum</b>. The TCP protocols on both hosts
use the checksum data to determine if the data transfers without error.</p>

<a name="ipov-36"></a><h5>Establishing a TCP Connection</h5>
<p><a name="indexterm-146"></a><a name="indexterm-147"></a><a name="indexterm-148"></a><a name="indexterm-149"></a><a name="indexterm-150"></a>TCP uses segments to determine whether the receiving system is ready to receive
the data. When the sending TCP wants to establish connections, TCP sends a
segment that is called a <b>SYN</b> to the TCP protocol on the receiving
host. The receiving TCP returns a segment that is called an <b>ACK</b> to
acknowledge the successful receipt of the segment. The sending TCP sends another ACK
segment, then proceeds to send the data. This exchange of control information is
referred to as a <b>three-way handshake</b>. </p>

<a name="ipov-37"></a><h5>UDP Packets</h5>
<p><a name="indexterm-151"></a><a name="indexterm-152"></a>UDP is a &ldquo;connectionless&rdquo; protocol. Unlike TCP, UDP does not check that data
arrived at the receiving host. Instead, UDP formats the message that is received
from the application layer into <b>UDP packets</b>. UDP attaches a header to each
packet. The header contains the sending and receiving ports, a field with the
length of the packet, and a checksum. </p><p><a name="indexterm-153"></a><a name="indexterm-154"></a><a name="indexterm-155"></a><a name="indexterm-156"></a>The sending UDP process attempts to send the packet to its peer UDP
process on the receiving host. The application layer determines whether the receiving UDP
process acknowledges the reception of the packet. UDP requires no notification of receipt.
UDP does not use the three-way handshake. </p>

<a name="ipov-38"></a><h5>Internet Layer: Where Packets Are Prepared for Delivery</h5>
<p><a name="indexterm-157"></a><a name="indexterm-158"></a>The transport protocols TCP, UDP, and SCTP pass their segments and packets down
to the Internet layer, where the IP protocol handles the segments and packets.
IP prepares them for delivery by formatting them into units called <b>IP datagrams</b>. IP
then determines the IP addresses for the datagrams, so that they can be
delivered effectively to the receiving host. </p>

<a name="ipov-39"></a><h5>IP Datagrams</h5>
<p><a name="indexterm-159"></a><a name="indexterm-160"></a><a name="indexterm-161"></a><a name="indexterm-162"></a><a name="indexterm-163"></a><a name="indexterm-164"></a>IP attaches an <b>IP header</b> to the segment or packet's header, in addition to
the information that is added by TCP or UDP. Information in the IP
header includes the IP addresses of the sending and receiving hosts, the datagram
length, and the datagram sequence order. This information is provided if the datagram
exceeds the allowable byte size for network packets and must be fragmented. </p>

<a name="ipov-40"></a><h5>Data-Link Layer: Where Framing Takes Place</h5>
<p><a name="indexterm-165"></a><a name="indexterm-166"></a><a name="indexterm-167"></a><a name="indexterm-168"></a><a name="indexterm-169"></a>Data-link layer protocols, such as PPP, format the IP datagram into a <b>frame</b>.
These protocols attach a third header and a footer to &ldquo;frame&rdquo; the datagram.
The frame header includes a <b>cyclic redundancy check</b> (CRC) field that checks for errors
as the frame travels over the network media. Then, the data-link layer passes
the frame to the physical layer. </p>

<a name="ipov-41"></a><h5>Physical Network Layer: Where Frames Are Sent and Received</h5>
<p><a name="indexterm-170"></a><a name="indexterm-171"></a><a name="indexterm-172"></a><a name="indexterm-173"></a>The physical network layer on the sending host receives the frames and converts
the IP addresses into the hardware addresses appropriate to the network media. The
physical network layer then sends the frame out over the network media. </p>

<a name="ipov-42"></a><h5>How the Receiving Host Handles the Packet</h5>
<p><a name="indexterm-174"></a><a name="indexterm-175"></a><a name="indexterm-176"></a>When the packet arrives on the receiving host, the packet travels through the
TCP/IP protocol stack in the reverse order from which it was sent.
<a href="#ipov-fig-30">Figure&nbsp;1-1</a> illustrates this path. Moreover, each protocol on the receiving host strips off
header information that is attached to the packet by its peer on the
sending host. The following process occurs:</p>
<ol><li><p><a name="indexterm-177"></a><a name="indexterm-178"></a><a name="indexterm-179"></a><a name="indexterm-180"></a>The physical network layer receives the packet in its frame form. The physical network layer computes the CRC of the packet, then sends the frame to the data link layer.</p></li>
<li><p><a name="indexterm-181"></a><a name="indexterm-182"></a>The data-link layer verifies that the CRC for the frame is correct and strips off the frame header and the CRC. Finally, the data-link protocol sends the frame to the Internet layer.</p></li>
<li><p><a name="indexterm-183"></a>The Internet layer reads information in the header to identify the transmission. Then, the Internet layer determines if the packet is a fragment. If the transmission is fragmented, IP reassembles the fragments into the original datagram. IP then strips off the IP header and passes the datagram on to transport layer protocols.</p></li>
<li><p><a name="indexterm-184"></a>The transport layer (TCP, SCTP, and UDP) reads the header to determine which application layer protocol must receive the data. Then, TCP, SCTP, or UDP strips off its related header. TCP, SCTP, or UDP sends the message or stream to the receiving application.</p></li>
<li><p><a name="indexterm-185"></a><a name="indexterm-186"></a><a name="indexterm-187"></a><a name="indexterm-188"></a><a name="indexterm-189"></a><a name="indexterm-190"></a><a name="indexterm-191"></a><a name="indexterm-192"></a><a name="indexterm-193"></a><a name="indexterm-194"></a><a name="indexterm-195"></a><a name="indexterm-196"></a>The application layer receives the message. The application layer then performs the operation that the sending host requested.</p></li></ol>


<a name="ipov-100"></a><h4>TCP/IP Internal Trace Support</h4>
<a name="indexterm-197"></a><p>TCP/IP provides internal trace support by logging TCP communication when an RST packet
terminates a connection. When an RST packet is transmitted or received, information on
as many as 10 packets, which were just transmitted, is logged with the
connection information.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ipov-6.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ipov-43.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

