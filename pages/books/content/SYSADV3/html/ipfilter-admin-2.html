<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Creating and Editing Solaris IP Filter Configuration Files - System Administration Guide: IP Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: IP Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="faavk.html">Previous</a>
             </td>
             <td align="right">
                 <a href="miptm-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="iptm-1.html">Part&nbsp;I&nbsp;TCP/IP Administration</a></p>
<p class="toc level2"><a href="ipov-1.html">1.&nbsp;&nbsp;Solaris TCPIP Protocol Suite (Overview)</a></p>
<p class="toc level2"><a href="ipplan-1.html">2.&nbsp;&nbsp;Planning an IPv4 Addressing Scheme (Tasks</a></p>
<p class="toc level2"><a href="ipv6-overview-7.html">3.&nbsp;&nbsp;Planning an IPv6 Addressing Scheme (Overview)</a></p>
<p class="toc level2"><a href="ipv6-planning-1.html">4.&nbsp;&nbsp;Planning an IPv6 Network (Tasks)</a></p>
<p class="toc level2"><a href="ipconfig-1.html">5.&nbsp;&nbsp;Configuring TCP/IP Network Services and IPv4 Addressing (Tasks)</a></p>
<p class="toc level2"><a href="fwawf.html">6.&nbsp;&nbsp;Administering Network Interfaces (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-config-tasks-1.html">7.&nbsp;&nbsp;Enabling IPv6 on a Network (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-admintasks-1.html">8.&nbsp;&nbsp;Administering a TCP/IP Network (Tasks)</a></p>
<p class="toc level2"><a href="gegel.html">9.&nbsp;&nbsp;Troubleshooting Network Problems (Tasks)</a></p>
<p class="toc level2"><a href="ipref-8.html">10.&nbsp;&nbsp;TCP/IP and IPv4 in Depth (Reference)</a></p>
<p class="toc level2"><a href="ipv6-ref-76.html">11.&nbsp;&nbsp;IPv6 in Depth (Reference)</a></p>
<p class="toc level1 tocsp"><a href="dhcptm-1.html">Part&nbsp;II&nbsp;DHCP</a></p>
<p class="toc level2"><a href="dhcp-overview-1.html">12.&nbsp;&nbsp;About Solaris DHCP (Overview)</a></p>
<p class="toc level2"><a href="chap2-26.html">13.&nbsp;&nbsp;Planning for DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="chapter3-20.html">14.&nbsp;&nbsp;Configuring the DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="dhcp-admin-9.html">15.&nbsp;&nbsp;Administering DHCP (Tasks)</a></p>
<p class="toc level2"><a href="eyatl.html">16.&nbsp;&nbsp;Configuring and Administering  DHCP Clients</a></p>
<p class="toc level2"><a href="dhcp-trouble-1.html">17.&nbsp;&nbsp;Troubleshooting DHCP (Reference)</a></p>
<p class="toc level2"><a href="dhcp-ref-4.html">18.&nbsp;&nbsp;DHCP Commands and Files (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipsectm-1.html">Part&nbsp;III&nbsp;IP Security</a></p>
<p class="toc level2"><a href="ipsec-ov-1.html">19.&nbsp;&nbsp;IP Security Architecture (Overview)</a></p>
<p class="toc level2"><a href="ipsec-mgtasks-1.html">20.&nbsp;&nbsp;Configuring IPsec (Tasks)</a></p>
<p class="toc level2"><a href="ipsecref-1.html">21.&nbsp;&nbsp;IP Security Architecture (Reference)</a></p>
<p class="toc level2"><a href="ike-1.html">22.&nbsp;&nbsp;Internet Key Exchange (Overview)</a></p>
<p class="toc level2"><a href="ike-task-1.html">23.&nbsp;&nbsp;Configuring IKE (Tasks)</a></p>
<p class="toc level2"><a href="ikeref-1.html">24.&nbsp;&nbsp;Internet Key Exchange (Reference)</a></p>
<p class="toc level2"><a href="eupsq.html">25.&nbsp;&nbsp;Solaris IP Filter (Overview)</a></p>
<p class="toc level2"><a href="ipfilter-admin-1.html">26.&nbsp;&nbsp;Solaris IP Filter (Tasks)</a></p>
<p class="toc level3"><a href="etmhi.html">Configuring Solaris IP Filter</a></p>
<p class="toc level4"><a href="etmhi.html#gdwzk">How to Enable Solaris IP Filter</a></p>
<p class="toc level4"><a href="etmhi.html#eubbr">How to Re-Enable Solaris IP Filter</a></p>
<p class="toc level4"><a href="etmhi.html#gdwzr">How to Enable Loopback Filtering</a></p>
<p class="toc level3 tocsp"><a href="fabar.html">Deactivating and Disabling Solaris IP Filter</a></p>
<p class="toc level4"><a href="fabar.html#ettms">How to Deactivate Packet Filtering</a></p>
<p class="toc level4"><a href="fabar.html#ettmt">How to Deactivate NAT</a></p>
<p class="toc level4"><a href="fabar.html#ettmo">How to Disable Packet Filtering</a></p>
<p class="toc level3 tocsp"><a href="eubbd.html">Working With Solaris IP Filter Rule Sets</a></p>
<p class="toc level3"><a href="faaxo.html">Displaying Statistics and Information for Solaris IP Filter</a></p>
<p class="toc level4"><a href="faaxo.html#faapk">How to View State Tables for Solaris IP Filter</a></p>
<p class="toc level4"><a href="faaxo.html#faapx">How to View State Statistics for Solaris IP Filter</a></p>
<p class="toc level4"><a href="faaxo.html#faapy">How to View NAT Statistics for Solaris IP Filter</a></p>
<p class="toc level4"><a href="faaxo.html#faapz">How to View Address Pool Statistics for Solaris IP Filter</a></p>
<p class="toc level3 tocsp"><a href="faavk.html">Working With Log Files for Solaris IP Filter</a></p>
<p class="toc level4"><a href="faavk.html#gdfwa">How to Set Up a Log File for Solaris IP Filter</a></p>
<p class="toc level4"><a href="faavk.html#faaqc">How to View Solaris IP Filter Log Files</a></p>
<p class="toc level4"><a href="faavk.html#faaqf">How to Flush the Packet Log File</a></p>
<p class="toc level4"><a href="faavk.html#faard">How to Save Logged Packets to a File</a></p>
<div class="onpage">
<p class="toc level3 tocsp"><a href="">Creating and Editing Solaris IP Filter Configuration Files</a></p>
<p class="toc level4"><a href="#fahpp">How to Create a Configuration File for Solaris IP Filter</a></p>
</div>
<p class="toc level1 tocsp"><a href="miptm-1.html">Part&nbsp;IV&nbsp;Mobile IP</a></p>
<p class="toc level2"><a href="mipoverview-1.html">27.&nbsp;&nbsp;Mobile IP (Overview)</a></p>
<p class="toc level2"><a href="mipimplementing-1.html">28.&nbsp;&nbsp;Administering Mobile IP (Tasks)</a></p>
<p class="toc level2"><a href="mipmanaging-22.html">29.&nbsp;&nbsp;Mobile IP Files and Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipmptm-1.html">Part&nbsp;V&nbsp;IPMP</a></p>
<p class="toc level2"><a href="mpoverview.html">30.&nbsp;&nbsp;Introducing IPMP (Overview)</a></p>
<p class="toc level2"><a href="deploynetmult-56.html">31.&nbsp;&nbsp;Administering IPMP (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ipqostm-1.html">Part&nbsp;VI&nbsp;IP Quality of Service (IPQoS)</a></p>
<p class="toc level2"><a href="ipqos-intro-1.html">32.&nbsp;&nbsp;Introducing IPQoS (Overview)</a></p>
<p class="toc level2"><a href="ipqos-config-planning-1.html">33.&nbsp;&nbsp;Planning for an IPQoS-Enabled Network (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-policy-planning-1.html">34.&nbsp;&nbsp;Creating the IPQoS Configuration File (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-isp-setup-1.html">35.&nbsp;&nbsp;Starting and Maintaining IPQoS (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-accounting-1.html">36.&nbsp;&nbsp;Using Flow Accounting and Statistics Gathering (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-reference-1.html">37.&nbsp;&nbsp;IPQoS in Detail (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="ipfilter-admin-2"></a><h3>Creating and Editing Solaris IP Filter Configuration Files</h3>
<p>You must directly edit the configuration files to create and modify rule sets
and address pools. Configuration files follow standard UNIX syntax rules:</p>
<ul><li><p>The pound sign (<tt>#</tt>) indicates a line containing comments.</p></li>
<li><p>Rules and comments can coexist on the same line.</p></li>
<li><p>Extraneous white space is allowed to keep rules easy to read.</p></li>
<li><p>Rules can be more than one line long. Use the backslash (\) at the end of a line to indicate that the rule continues on the next line.</p></li></ul>


<a name="fahpp"></a><h4>How to Create a Configuration File for Solaris IP Filter</h4><a name="indexterm-2449"></a><a name="indexterm-2450"></a><a name="indexterm-2451"></a><a name="indexterm-2452"></a><a name="indexterm-2453"></a><a name="indexterm-2454"></a><a name="indexterm-2455"></a><a name="indexterm-2456"></a><a name="indexterm-2457"></a><a name="indexterm-2458"></a><a name="indexterm-2459"></a><p>The following procedure describes how to set up the following:</p>
<ul><li><p>Packet filtering configuration files</p></li>
<li><p>NAT rules configuration files</p></li>
<li><p>Address pool configuration files</p></li></ul>
<ol>
<li><b>Assume a role that includes the IP Filter Management rights profile, or become
superuser.</b><p>You can assign the IP Filter Management rights profile to a role that
you create. To create the role and assign the role to a user,
see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Start the file editor of your choice. Create or edit the configuration file
for the feature you want to configure.</b>
<ul><li><p>To create a configuration file for packet filtering rules, edit the <tt>ipf.conf</tt> file.</p><p>Solaris IP Filter uses the packet filtering rules that you put in to the <tt>ipf.conf</tt> file. If you locate the rules file for packet filtering in the <tt>/etc/ipf/ipf.conf</tt> file, this file is loaded when the system is booted. If you do not want the filtering rules to be loaded at boot time, put the in a file of your choice. You can then activate the rules with the <tt>ipf</tt> command, as described in <a href="eubbd.html#ettmd">How to Activate a Different or Updated Packet Filtering Rule Set</a>.</p><p>See <a href="ezecx.html#euqfb">Using Solaris IP Filter's Packet Filtering Feature</a> for information about creating packet filtering rules.</p>
<hr><p><b>Note - </b>If the <tt>ipf.conf</tt> file is empty, there is no filtering. An empty <tt>ipf.conf</tt> file is the same as having a rule set that reads:</p><pre>pass in all
pass out all</pre>
<hr>
</li>
<li><p>To create a configuration file for NAT rules, edit the <tt>ipnat.conf</tt> file.</p><p>Solaris IP Filter uses the NAT rules that you put in to the <tt>ipnat.conf</tt> file. If you locate the rules file for NAT in the <tt>/etc/ipf/ipnat.conf</tt> file, this file is loaded when the system is booted. If you do not want the NAT rules loaded at boot time, put the <tt>ipnat.conf</tt> file in a location of your choice. You can then activate the NAT rules with the <tt>ipnat</tt> command.</p><p>See <a href="ezecx.html#euqfc">Using Solaris IP Filter's NAT Feature</a> for information about creating rules for NAT.</p></li>
<li><p>To create a configuration file for address pools, edit the <tt>ippool.conf</tt> file.</p><p>Solaris IP Filter uses the pool of addresses that you put in to the <tt>ippool.conf</tt> file. If you locate the rules file for the pool of addresses in the <tt>/etc/ipf/ippool.conf</tt> file, this file is loaded when the system is booted. If you do not want the pool of addresses loaded at boot time, put the <tt>ippool.conf</tt> file in a location of your choice. You can then activate the pool of addresses with the <tt>ippool</tt> command.</p><p>See <a href="ezecx.html#euqfe">Using Solaris IP Filter's Address Pools Feature</a> for information about creating address pools.</p></li></ul>
</li></ol>

<a name="ezecy"></a><h4>Solaris IP Filter Configuration File Examples</h4>
<p>The following examples provide an illustration of packet filtering rules used in filtering
configurations.</p><a name="eywvr"></a>Example&nbsp;26-24 Solaris IP Filter Host Configuration<p>This example shows a configuration on a host machine with an <tt>elxl</tt>
network interface.</p><pre># pass and log everything by default
pass in log on elxl0 all
pass out log on elxl0 all

# block, but don't log, incoming packets from other reserved addresses
block in quick on elxl0 from 10.0.0.0/8 to any
block in quick on elxl0 from 172.16.0.0/12 to any

# block and log untrusted internal IPs. 0/32 is notation that replaces 
# address of the machine running Solaris IP Filter.
block in log quick from 192.168.1.15 to &lt;thishost>
block in log quick from 192.168.1.43 to &lt;thishost>

# block and log X11 (port 6000) and remote procedure call 
# and portmapper (port 111) attempts
block in log quick on elxl0 proto tcp from any to elxl0/32 port = 6000 keep state
block in log quick on elxl0 proto tcp/udp from any to elxl0/32 port = 111 keep state</pre><p>This rule set begins with two unrestricted rules that allow everything to pass
into and out of the <tt>elxl</tt> interface. The second set of rules blocks
any incoming packets from the private address spaces <tt>10.0.0.0</tt> and <tt>172.16.0.0</tt> from
entering the firewall. The next set of rules blocks specific internal addresses from
the host machine. Finally, the last set of rules blocks packets coming in
on port 6000 and port 111.</p><a name="eywvs"></a>Example&nbsp;26-25 Solaris IP Filter Server Configuration<p>This example shows a configuration for a host machine acting as a
web server. This machine has an <tt>eri</tt> network interface.</p><pre># web server with an eri interface
# block and log everything by default; then allow specific services
# group 100 - inbound rules
# group 200 - outbound rules
# (0/32) resolves to our IP address)
*** FTP proxy ***


# block short packets which are packets fragmented too short to be real.
block in log quick all with short


# block and log inbound and outbound by default, group by destination
block in log on eri0 from any to any head 100
block out log on eri0 from any to any head 200


# web rules that get hit most often
pass in quick on eri0 proto tcp from any \
to eri0/32 port = http flags S keep state group 100
pass in quick on eri0 proto tcp from any \
to eri0/32 port = https flags S keep state group 100


# inbound traffic - ssh, auth
pass in quick on eri0 proto tcp from any \
to eri0/32 port = 22 flags S keep state group 100
pass in log quick on eri0 proto tcp from any \
to eri0/32 port = 113 flags S keep state group 100
pass in log quick on eri0 proto tcp from any port = 113 \
to eri0/32 flags S keep state group 100


# outbound traffic - DNS, auth, NTP, ssh, WWW, smtp
pass out quick on eri0 proto tcp/udp from eri0/32 \
to any port = domain flags S keep state group 200
pass in quick on eri0 proto udp from any port = domain to eri0/32 group 100

pass out quick on eri0 proto tcp from eri0/32 \
to any port = 113 flags S keep state group 200
pass out quick on eri0 proto tcp from eri0/32 port = 113 \
to any flags S keep state group 200

pass out quick on eri0 proto udp from eri0/32 to any port = ntp group 200
pass in quick on eri0 proto udp from any port = ntp to eri0/32 port = ntp group 100

pass out quick on eri0 proto tcp from eri0/32 \
to any port = ssh flags S keep state group 200

pass out quick on eri0 proto tcp from eri0/32 \
to any port = http flags S keep state group 200
pass out quick on eri0 proto tcp from eri0/32 \
to any port = https flags S keep state group 200

pass out quick on eri0 proto tcp from eri0/32 \
to any port = smtp flags S keep state group 200


# pass icmp packets in and out
pass in quick on eri0 proto icmp from any to eri0/32  keep state group 100
pass out quick on eri0 proto icmp from eri0/32 to any keep state group 200


# block and ignore NETBIOS packets
block in quick on eri0 proto tcp from any \
to any port = 135 flags S keep state group 100

block in quick on eri0 proto tcp from any port = 137 \
to any flags S keep state group 100
block in quick on eri0 proto udp from any to any port = 137 group 100
block in quick on eri0 proto udp from any port = 137 to any group 100

block in quick on eri0 proto tcp from any port = 138 \
to any flags S keep state group 100
block in quick on eri0 proto udp from any port = 138 to any group 100

block in quick on eri0 proto tcp from any port = 139 to any flags S keep state
group 100
block in quick on eri0 proto udp from any port = 139 to any group 100</pre><a name="eywvu"></a>Example&nbsp;26-26 Solaris IP Filter Router Configuration<p>This example shows a configuration for a router that has an internal interface,
<tt>ce0</tt>, and an external interface, <tt>ce1</tt>.</p><pre># internal interface is ce0 at 192.168.1.1
# external interface is ce1 IP obtained via DHCP
# block all packets and allow specific services
*** NAT ***
*** POOLS ***


# Short packets which are fragmented too short to be real.
block in log quick all with short


# By default, block and log everything.
block in log on ce0 all
block in log on ce1 all
block out log on ce0 all
block out log on ce1 all


# Packets going in/out of network interfaces that aren't on the loopback
# interface should not exist.
block in log quick on ce0 from 127.0.0.0/8 to any
block in log quick on ce0 from any to 127.0.0.0/8
block in log quick on ce1 from 127.0.0.0/8 to any
block in log quick on ce1 from any to 127.0.0.0/8


# Deny reserved addresses.
block in quick on ce1 from 10.0.0.0/8 to any
block in quick on ce1 from 172.16.0.0/12 to any
block in log quick on ce1 from 192.168.1.0/24 to any
block in quick on ce1 from 192.168.0.0/16 to any


# Allow internal traffic
pass in quick on ce0 from 192.168.1.0/24 to 192.168.1.0/24
pass out quick on ce0 from 192.168.1.0/24 to 192.168.1.0/24


# Allow outgoing DNS requests from our servers on .1, .2, and .3
pass out quick on ce1 proto tcp/udp from ce1/32 to any port = domain keep state
pass in quick on ce0 proto tcp/udp from 192.168.1.2 to any port = domain keep state
pass in quick on ce0 proto tcp/udp from 192.168.1.3 to any port = domain keep state


# Allow NTP from any internal hosts to any external NTP server.
pass in quick on ce0 proto udp from 192.168.1.0/24 to any port = 123 keep state
pass out quick on ce1 proto udp from any to any port = 123 keep state


# Allow incoming mail
pass in quick on ce1 proto tcp from any to ce1/32 port = smtp keep state
pass in quick on ce1 proto tcp from any to ce1/32 port = smtp keep state
pass out quick on ce1 proto tcp from 192.168.1.0/24 to any port = smtp keep state


# Allow outgoing connections: SSH, WWW, NNTP, mail, whois
pass in quick on ce0 proto tcp from 192.168.1.0/24 to any port = 22 keep state
pass out quick on ce1 proto tcp from 192.168.1.0/24 to any port = 22 keep state

pass in quick on ce0 proto tcp from 192.168.1.0/24 to any port = 80 keep state
pass out quick on ce1 proto tcp from 192.168.1.0/24 to any port = 80 keep state
pass in quick on ce0 proto tcp from 192.168.1.0/24 to any port = 443 keep state
pass out quick on ce1 proto tcp from 192.168.1.0/24 to any port = 443 keep state

pass in quick on ce0 proto tcp from 192.168.1.0/24 to any port = nntp keep state
block in quick on ce1 proto tcp from any to any port = nntp keep state
pass out quick on ce1 proto tcp from 192.168.1.0/24 to any port = nntp keep state

pass in quick on ce0 proto tcp from 192.168.1.0/24 to any port = smtp keep state

pass in quick on ce0 proto tcp from 192.168.1.0/24 to any port = whois keep state
pass out quick on ce1 proto tcp from any to any port = whois keep state


# Allow ssh from offsite
pass in quick on ce1 proto tcp from any to ce1/32 port = 22 keep state


# Allow ping out
pass in quick on ce0 proto icmp all keep state
pass out quick on ce1 proto icmp all keep state


# allow auth out
pass out quick on ce1 proto tcp from ce1/32 to any port = 113 keep state
pass out quick on ce1 proto tcp from ce1/32 port = 113 to any keep state


# return rst for incoming auth
block return-rst in quick on ce1 proto tcp from any to any port = 113 flags S/SA


# log and return reset for any TCP packets with S/SA
block return-rst in log on ce1 proto tcp from any to any flags S/SA


# return ICMP error packets for invalid UDP packets
block return-icmp(net-unr) in proto udp all </pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="faavk.html">Previous</a>
             </td>
             <td align="right">
                 <a href="miptm-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

