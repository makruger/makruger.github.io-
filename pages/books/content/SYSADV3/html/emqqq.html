<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>IPMP Failure Detection and Recovery Features - System Administration Guide: IP Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: IP Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="eobra.html">Previous</a>
             </td>
             <td align="right">
                 <a href="esqdy.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="iptm-1.html">Part&nbsp;I&nbsp;TCP/IP Administration</a></p>
<p class="toc level2"><a href="ipov-1.html">1.&nbsp;&nbsp;Solaris TCPIP Protocol Suite (Overview)</a></p>
<p class="toc level2"><a href="ipplan-1.html">2.&nbsp;&nbsp;Planning an IPv4 Addressing Scheme (Tasks</a></p>
<p class="toc level2"><a href="ipv6-overview-7.html">3.&nbsp;&nbsp;Planning an IPv6 Addressing Scheme (Overview)</a></p>
<p class="toc level2"><a href="ipv6-planning-1.html">4.&nbsp;&nbsp;Planning an IPv6 Network (Tasks)</a></p>
<p class="toc level2"><a href="ipconfig-1.html">5.&nbsp;&nbsp;Configuring TCP/IP Network Services and IPv4 Addressing (Tasks)</a></p>
<p class="toc level2"><a href="fwawf.html">6.&nbsp;&nbsp;Administering Network Interfaces (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-config-tasks-1.html">7.&nbsp;&nbsp;Enabling IPv6 on a Network (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-admintasks-1.html">8.&nbsp;&nbsp;Administering a TCP/IP Network (Tasks)</a></p>
<p class="toc level2"><a href="gegel.html">9.&nbsp;&nbsp;Troubleshooting Network Problems (Tasks)</a></p>
<p class="toc level2"><a href="ipref-8.html">10.&nbsp;&nbsp;TCP/IP and IPv4 in Depth (Reference)</a></p>
<p class="toc level2"><a href="ipv6-ref-76.html">11.&nbsp;&nbsp;IPv6 in Depth (Reference)</a></p>
<p class="toc level1 tocsp"><a href="dhcptm-1.html">Part&nbsp;II&nbsp;DHCP</a></p>
<p class="toc level2"><a href="dhcp-overview-1.html">12.&nbsp;&nbsp;About Solaris DHCP (Overview)</a></p>
<p class="toc level2"><a href="chap2-26.html">13.&nbsp;&nbsp;Planning for DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="chapter3-20.html">14.&nbsp;&nbsp;Configuring the DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="dhcp-admin-9.html">15.&nbsp;&nbsp;Administering DHCP (Tasks)</a></p>
<p class="toc level2"><a href="eyatl.html">16.&nbsp;&nbsp;Configuring and Administering  DHCP Clients</a></p>
<p class="toc level2"><a href="dhcp-trouble-1.html">17.&nbsp;&nbsp;Troubleshooting DHCP (Reference)</a></p>
<p class="toc level2"><a href="dhcp-ref-4.html">18.&nbsp;&nbsp;DHCP Commands and Files (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipsectm-1.html">Part&nbsp;III&nbsp;IP Security</a></p>
<p class="toc level2"><a href="ipsec-ov-1.html">19.&nbsp;&nbsp;IP Security Architecture (Overview)</a></p>
<p class="toc level2"><a href="ipsec-mgtasks-1.html">20.&nbsp;&nbsp;Configuring IPsec (Tasks)</a></p>
<p class="toc level2"><a href="ipsecref-1.html">21.&nbsp;&nbsp;IP Security Architecture (Reference)</a></p>
<p class="toc level2"><a href="ike-1.html">22.&nbsp;&nbsp;Internet Key Exchange (Overview)</a></p>
<p class="toc level2"><a href="ike-task-1.html">23.&nbsp;&nbsp;Configuring IKE (Tasks)</a></p>
<p class="toc level2"><a href="ikeref-1.html">24.&nbsp;&nbsp;Internet Key Exchange (Reference)</a></p>
<p class="toc level2"><a href="eupsq.html">25.&nbsp;&nbsp;Solaris IP Filter (Overview)</a></p>
<p class="toc level2"><a href="ipfilter-admin-1.html">26.&nbsp;&nbsp;Solaris IP Filter (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="miptm-1.html">Part&nbsp;IV&nbsp;Mobile IP</a></p>
<p class="toc level2"><a href="mipoverview-1.html">27.&nbsp;&nbsp;Mobile IP (Overview)</a></p>
<p class="toc level2"><a href="mipimplementing-1.html">28.&nbsp;&nbsp;Administering Mobile IP (Tasks)</a></p>
<p class="toc level2"><a href="mipmanaging-22.html">29.&nbsp;&nbsp;Mobile IP Files and Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipmptm-1.html">Part&nbsp;V&nbsp;IPMP</a></p>
<p class="toc level2"><a href="mpoverview.html">30.&nbsp;&nbsp;Introducing IPMP (Overview)</a></p>
<p class="toc level3"><a href="chapter1-2.html">Why You Should Use IPMP</a></p>
<p class="toc level3"><a href="eyprl.html">Basic Requirements of IPMP</a></p>
<p class="toc level3"><a href="emqwq.html">IPMP Addressing</a></p>
<p class="toc level3"><a href="eobra.html">IPMP Interface Configurations</a></p>
<div class="onpage">
<p class="toc level3"><a href="">IPMP Failure Detection and Recovery Features</a></p>
</div>
<p class="toc level3"><a href="esqdy.html">IPMP and Dynamic Reconfiguration</a></p>
<p class="toc level2 tocsp"><a href="deploynetmult-56.html">31.&nbsp;&nbsp;Administering IPMP (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ipqostm-1.html">Part&nbsp;VI&nbsp;IP Quality of Service (IPQoS)</a></p>
<p class="toc level2"><a href="ipqos-intro-1.html">32.&nbsp;&nbsp;Introducing IPQoS (Overview)</a></p>
<p class="toc level2"><a href="ipqos-config-planning-1.html">33.&nbsp;&nbsp;Planning for an IPQoS-Enabled Network (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-policy-planning-1.html">34.&nbsp;&nbsp;Creating the IPQoS Configuration File (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-isp-setup-1.html">35.&nbsp;&nbsp;Starting and Maintaining IPQoS (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-accounting-1.html">36.&nbsp;&nbsp;Using Flow Accounting and Statistics Gathering (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-reference-1.html">37.&nbsp;&nbsp;IPQoS in Detail (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="emqqq"></a><h3>IPMP Failure Detection and Recovery Features</h3>
<p><a name="indexterm-2879"></a><a name="indexterm-2880"></a>The <tt>in.mpathd</tt> daemon handles the following types of failure detection:</p>
<ul><li><p>Link-based failure detection, if supported by the NIC driver</p></li>
<li><p>Probe-based failure detection, when test addresses are configured</p></li>
<li><p>Detection of interfaces that were missing at boot time</p></li></ul>
<p>The <a href="http://docs.sun.com/doc/819-2240/in.mpathd-1m?a=view"><tt>in.mpathd</tt>(1M)</a> man page completely describes how the <tt>in.mpathd</tt> daemon handles the detection of
interface failures.</p>

<a name="mpoverview-23"></a><h4>Link-Based Failure Detection</h4>
<a name="indexterm-2881"></a><a name="indexterm-2882"></a><a name="indexterm-2883"></a><p>Link-based failure detection is always enabled, provided that the interface supports this type
of failure detection. The following Sun network drivers are supported in the current
release of the Solaris OS:<a name="indexterm-2884"></a><a name="indexterm-2885"></a></p>
<ul><li><p><tt>hme</tt></p></li>
<li><p><tt>eri</tt></p></li>
<li><p><tt>ce</tt></p></li>
<li><p><tt>ge</tt></p></li>
<li><p><tt>bge</tt></p></li>
<li><p><tt>qfe</tt></p></li>
<li><p><tt>dmfe</tt></p></li></ul>
<p>To determine whether a third-party interface supports link-based failure detection, refer to the
manufacturer's documentation.</p><p>These network interface drivers monitor the interface's link state and notify the networking
subsystem when that link state changes. When  notified of a change, the
networking subsystem either sets or clears the  <tt>RUNNING</tt> flag for that
interface, as appropriate. When the daemon detects that the interface's <tt>RUNNING</tt> flag has
been cleared, the  daemon immediately fails the interface. </p>

<a name="emqra"></a><h4>Probe-Based Failure Detection</h4>
<a name="indexterm-2886"></a><a name="indexterm-2887"></a><p>The <tt>in.mpathd</tt> daemon performs probe-based failure detection on each interface in the IPMP
group that has a test address. Probe-based failure detection involves the sending and
receiving of ICMP probe messages that use test addresses. These messages go out
over the interface to one or more target systems on the same IP
link. For an introduction to test addresses, refer to <a href="emqwq.html#emqvv">Test Addresses</a>. For information on configuring
test addresses, refer to <a href="deploynetmult-57.html#emqul">How to Configure an IPMP Group With Multiple Interfaces</a>.</p><p><a name="indexterm-2888"></a><a name="indexterm-2889"></a>The <tt>in.mpathd</tt> daemon determines which target systems to probe dynamically. Routers that are
connected to the IP link are automatically selected as targets for probing. If
no routers exist on the link, <tt>in.mpathd</tt> sends probes to neighbor hosts on
the link. A multicast packet that is sent to the all hosts multicast
address, <tt>224.0.0.1</tt> in IPv4 and <tt>ff02::1</tt> in IPv6, determines which hosts to use
as target systems. The first few hosts that respond to the echo packets
are chosen as targets for probing. If <tt>in.mpathd</tt> cannot find routers or hosts
that responded to the ICMP echo packets, <tt>in.mpathd</tt> cannot detect probe-based failures.
</p><p>You can use host routes to explicitly configure a list of target
systems to be used by <tt>in.mpathd</tt>. For instructions, refer to <a href="deploynetmult-57.html#etmkd">Configuring Target Systems</a>.</p><p>To ensure that each interface in the IPMP group functions properly, <tt>in.mpathd</tt>
probes all the targets separately through all the interfaces in the IPMP group.
If no replies are made in response to five consecutive probes, <tt>in.mpathd</tt> considers
the interface to have failed. The probing rate depends on the <b>failure detection time</b> (FDT). The
default value for failure detection time is 10 seconds. However, you can tune
the failure detection time in the <tt>/etc/default/mpathd</tt> file. For instructions, go to <a href="deploynetmult-47.html#deploynetmult-48">How to Configure the <tt>/etc/default/mpathd</tt> File</a>.<a name="indexterm-2890"></a><a name="indexterm-2891"></a><a name="indexterm-2892"></a></p><p>For a repair detection time of 10 seconds, the probing rate is
 approximately one probe every two seconds. The minimum repair detection time is
twice the failure detection time , 20 seconds by default, because replies to
10 consecutive probes must be received. The failure  and repair detection times
apply only to probe-based failure detection.</p>

<a name="mpoverview-29"></a><h4>Group Failures</h4>
<a name="indexterm-2893"></a><a name="indexterm-2894"></a><p>A <b>group failure</b> occurs when all interfaces in an IPMP group appear to fail
at the same time. The <tt>in.mpathd</tt> daemon does not perform failovers for a
group failure. Also, no failover occurs when all the target systems fail at
the same time. In this instance, <tt>in.mpathd</tt> flushes all of its current
target systems and discovers new target systems.</p>

<a name="mpoverview-24"></a><h4>Detecting Physical Interface Repairs</h4>
<p><a name="indexterm-2895"></a><a name="indexterm-2896"></a>For the <tt>in.mpathd</tt> daemon to consider an interface to be repaired, the <tt>RUNNING</tt>
flag must be set for the interface. If probe-based failure detection is used,
the <tt>in.mpathd</tt> daemon must receive responses to 10 consecutive probe packets from the
interface before that interface is considered repaired. When an interface is considered repaired, any
addresses that failed over to another interface then fail back to the repaired
interface. If the interface was configured as &ldquo;active&rdquo; before it failed, after repair
that interface can resume sending and receiving traffic.</p>

<a name="eoqse"></a><h4>What Happens During Interface Failover</h4>
<p><a name="indexterm-2897"></a><a name="indexterm-2898"></a>The following two examples show a typical configuration and how that configuration automatically
changes when an interface fails. When the <tt>hme0</tt> interface fails, notice that
all data addresses move from <tt>hme0</tt> to <tt>hme1</tt>.</p><a name="mpoverview-ex-12"></a>Example&nbsp;30-1 Interface Configuration Before an Interface Failure<pre>hme0: flags=9000843&lt;UP,BROADCAST,RUNNING,MULTICAST,IPv4> mtu 1500 index 2
     inet 192.168.85.19 netmask ffffff00 broadcast 192.168.85.255
     groupname test
hme0:1: flags=9000843&lt;UP,BROADCAST,RUNNING,MULTICAST,DEPRECATED,IPv4,NOFAILOVER> mtu 1500 
     index 2 inet 192.168.85.21 netmask ffffff00 broadcast 192.168.85.255
hme1: flags=9000843&lt;UP,BROADCAST,RUNNING,MULTICAST,IPv4> mtu 1500 index 2
8     inet 192.168.85.20 netmask ffffff00 broadcast 192.168.85.255
     groupname test
hme1:1: flags=9000843&lt;UP,BROADCAST,RUNNING,MULTICAST,DEPRECATED,IPv4,NOFAILOVER> mtu 1500 
     index 2 inet 192.168.85.22 netmask ffffff00 broadcast 192.168.85.255
hme0: flags=a000841&lt;UP,RUNNING,MULTICAST,IPv6,NOFAILOVER> mtu 1500 index 2
     inet6 fe80::a00:20ff:feb9:19fa/10
     groupname test
hme1: flags=a000841&lt;UP,RUNNING,MULTICAST,IPv6,NOFAILOVER> mtu 1500 index 2
     inet6 fe80::a00:20ff:feb9:1bfc/10
     groupname test</pre><a name="mpoverview-ex-13"></a>Example&nbsp;30-2 Interface Configuration After an Interface Failure<pre>hme0: flags=19000842&lt;BROADCAST,RUNNING,MULTICAST,IPv4,NOFAILOVER,FAILED> mtu 0 index 2
        inet 0.0.0.0 netmask 0 
        groupname test
hme0:1: flags=19040843&lt;UP,BROADCAST,RUNNING,MULTICAST,DEPRECATED,IPv4,NOFAILOVER,FAILED> 
        mtu 1500 index 2 inet 192.168.85.21 netmask ffffff00 broadcast 10.0.0.255
hme1: flags=9000843&lt;UP,BROADCAST,RUNNING,MULTICAST,IPv4> mtu 1500 index 2
        inet 192.168.85.20 netmask ffffff00 broadcast 192.168.85.255
        groupname test
hme1:1: flags=9000843&lt;UP,BROADCAST,RUNNING,MULTICAST,DEPRECATED,IPv4,NOFAILOVER> mtu 1500 
        index 2 inet 192.168.85.22 netmask ffffff00 broadcast 10.0.0.255
hme1:2: flags=1000843&lt;UP,BROADCAST,RUNNING,MULTICAST,IPv4> mtu 1500 index 6
        inet 192.168.85.19 netmask ffffff00 broadcast 192.168.18.255
hme0: flags=a000841&lt;UP,RUNNING,MULTICAST,IPv6,NOFAILOVER,FAILED> mtu 1500 index 2
        inet6 fe80::a00:20ff:feb9:19fa/10 
        groupname test
hme1: flags=a000841&lt;UP,RUNNING,MULTICAST,IPv6,NOFAILOVER> mtu 1500 index 2
        inet6 fe80::a00:20ff:feb9:1bfc/10 
        groupname test</pre><p>You can see that the <tt>FAILED</tt> flag is set on <tt>hme0</tt> to
indicate that this interface has failed. You can also see that <tt>hme1:2</tt>
has been created. <tt>hme1:2</tt> was originally <tt>hme0</tt>. The address <tt>192.168.85.19</tt> then becomes accessible
through <tt>hme1</tt>. </p><p>Multicast memberships that are associated with <tt>192.168.85.19</tt> can still receive packets, but they
now receive packets through <tt>hme1</tt>. When the failover of address <tt>192.168.85.19</tt> from <tt>hme0</tt>
to <tt>hme1</tt> occurred, a dummy address <tt>0.0.0.0</tt> was created on <tt>hme0</tt>. The dummy
address was created so that <tt>hme0</tt> can still be accessed. <tt>hme0:1</tt> cannot exist
without <tt>hme0</tt>. The dummy address is removed when a subsequent failback takes place.</p><p>Similarly, failover of the IPv6 address from <tt>hme0</tt> to <tt>hme1</tt> occurred. In
IPv6, multicast memberships are associated with interface indexes. Multicast memberships also fail over
from <tt>hme0</tt> to <tt>hme1</tt>. All the addresses that <tt>in.ndpd</tt> configured also moved. This
action is not shown in the examples.</p><p>The <tt>in.mpathd</tt> daemon continues to probe through the failed interface <tt>hme0</tt>. After the
daemon receives 10 consecutive replies for a default repair detection time of 20
seconds, the daemon determines that the interface is repaired. Because the <tt>RUNNING</tt> flag is
also set on <tt>hme0</tt>, the daemon invokes the failback. After failback, the original
configuration is restored.</p><p>For a description of all error messages that are logged on the
console during failures and repairs, see the <tt>in.mpathd</tt>(1M) man page. </p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="eobra.html">Previous</a>
             </td>
             <td align="right">
                 <a href="esqdy.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

