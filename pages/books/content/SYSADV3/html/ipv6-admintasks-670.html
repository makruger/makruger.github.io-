<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Monitoring Packet Transfers With the <tt>snoop</tt> Command - System Administration Guide: IP Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: IP Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ipv6-admintasks-72.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ipv6-admintasks-43.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="iptm-1.html">Part&nbsp;I&nbsp;TCP/IP Administration</a></p>
<p class="toc level2"><a href="ipov-1.html">1.&nbsp;&nbsp;Solaris TCPIP Protocol Suite (Overview)</a></p>
<p class="toc level2"><a href="ipplan-1.html">2.&nbsp;&nbsp;Planning an IPv4 Addressing Scheme (Tasks</a></p>
<p class="toc level2"><a href="ipv6-overview-7.html">3.&nbsp;&nbsp;Planning an IPv6 Addressing Scheme (Overview)</a></p>
<p class="toc level2"><a href="ipv6-planning-1.html">4.&nbsp;&nbsp;Planning an IPv6 Network (Tasks)</a></p>
<p class="toc level2"><a href="ipconfig-1.html">5.&nbsp;&nbsp;Configuring TCP/IP Network Services and IPv4 Addressing (Tasks)</a></p>
<p class="toc level2"><a href="fwawf.html">6.&nbsp;&nbsp;Administering Network Interfaces (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-config-tasks-1.html">7.&nbsp;&nbsp;Enabling IPv6 on a Network (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-admintasks-1.html">8.&nbsp;&nbsp;Administering a TCP/IP Network (Tasks)</a></p>
<p class="toc level3"><a href="ipv6-admintasks-2.html">Major TCP/IP Administrative Tasks (Task Map)</a></p>
<p class="toc level3"><a href="ipconfig-141.html">Monitoring the Interface Configuration With the <tt>ifconfig</tt> Command</a></p>
<p class="toc level4"><a href="ipconfig-141.html#ipconfig-46">How to Get Information About a Specific Interface</a></p>
<p class="toc level4"><a href="ipconfig-141.html#ipconfig-171">How to Display Interface Address Assignments</a></p>
<p class="toc level3 tocsp"><a href="ipconfig-142.html">Monitoring Network Status With the <tt>netstat</tt> Command</a></p>
<p class="toc level4"><a href="ipconfig-142.html#ipconfig-143">How to Display Statistics by Protocol</a></p>
<p class="toc level4"><a href="ipconfig-142.html#esbee">How to Display the Status of Transport Protocols</a></p>
<p class="toc level4"><a href="ipconfig-142.html#ipconfig-144">How to Display Network Interface Status</a></p>
<p class="toc level4"><a href="ipconfig-142.html#ipv6-admintasks-16">How to Display the Status of Sockets</a></p>
<p class="toc level4"><a href="ipconfig-142.html#ipv6-admintasks-48">How to Display the Status of Transmissions for Packets of a Specific Address Type</a></p>
<p class="toc level4"><a href="ipconfig-142.html#ipconfig-145">How to Display the Status of Known Routes</a></p>
<p class="toc level3 tocsp"><a href="ipv6-admintasks-53.html">Probing Remote Hosts With the <tt>ping</tt> Command</a></p>
<p class="toc level4"><a href="ipv6-admintasks-53.html#ipv6-admintasks-54">How to Determine if a Remote Host Is Running</a></p>
<p class="toc level4"><a href="ipv6-admintasks-53.html#ipv6-admintasks-56">How to Determine if a Host Is Dropping Packets</a></p>
<p class="toc level3 tocsp"><a href="ipv6-admintasks-5.html">Administering and Logging Network Status Displays</a></p>
<p class="toc level4"><a href="ipv6-admintasks-5.html#ipv6-admintasks-22">How to Control the Display Output of IP-Related Commands</a></p>
<p class="toc level4"><a href="ipv6-admintasks-5.html#ipv6-admintasks-59">How to Log Actions of the IPv4 Routing Daemon</a></p>
<p class="toc level4"><a href="ipv6-admintasks-5.html#ipv6-admintasks-62">How to Trace the Activities of the IPv6 Neighbor Discovery Daemon</a></p>
<p class="toc level3 tocsp"><a href="ipv6-admintasks-72.html">Displaying Routing Information With the <tt>traceroute</tt> Command</a></p>
<p class="toc level4"><a href="ipv6-admintasks-72.html#ipv6-admintasks-73">How to Find Out the Route to a Remote Host</a></p>
<p class="toc level4"><a href="ipv6-admintasks-72.html#ipv6-admintasks-29">How to Trace All Routes</a></p>
<div class="onpage">
<p class="toc level3 tocsp"><a href="">Monitoring Packet Transfers With the <tt>snoop</tt> Command</a></p>
<p class="toc level4"><a href="#ipv6-admintasks-67">How to Check Packets From All Interfaces</a></p>
<p class="toc level4"><a href="#ipv6-admintasks-674">How to Capture <tt>snoop</tt> Output Into a File</a></p>
<p class="toc level4"><a href="#ipv6-admintasks-676">How to Check Packets Between an IPv4 Server and a Client</a></p>
<p class="toc level4"><a href="#ipv6-admintasks-10">How to Monitor IPv6 Network Traffic</a></p>
</div>
<p class="toc level3 tocsp"><a href="ipv6-admintasks-43.html">Administering Default Address Selection</a></p>
<p class="toc level4"><a href="ipv6-admintasks-43.html#ipv6-admintasks-77">How to Administer the IPv6 Address Selection Policy Table</a></p>
<p class="toc level4"><a href="ipv6-admintasks-43.html#ipv6-admintasks-87">How to Modify the IPv6 Address Selection Table for the Current Session Only</a></p>
<p class="toc level2 tocsp"><a href="gegel.html">9.&nbsp;&nbsp;Troubleshooting Network Problems (Tasks)</a></p>
<p class="toc level2"><a href="ipref-8.html">10.&nbsp;&nbsp;TCP/IP and IPv4 in Depth (Reference)</a></p>
<p class="toc level2"><a href="ipv6-ref-76.html">11.&nbsp;&nbsp;IPv6 in Depth (Reference)</a></p>
<p class="toc level1 tocsp"><a href="dhcptm-1.html">Part&nbsp;II&nbsp;DHCP</a></p>
<p class="toc level2"><a href="dhcp-overview-1.html">12.&nbsp;&nbsp;About Solaris DHCP (Overview)</a></p>
<p class="toc level2"><a href="chap2-26.html">13.&nbsp;&nbsp;Planning for DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="chapter3-20.html">14.&nbsp;&nbsp;Configuring the DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="dhcp-admin-9.html">15.&nbsp;&nbsp;Administering DHCP (Tasks)</a></p>
<p class="toc level2"><a href="eyatl.html">16.&nbsp;&nbsp;Configuring and Administering  DHCP Clients</a></p>
<p class="toc level2"><a href="dhcp-trouble-1.html">17.&nbsp;&nbsp;Troubleshooting DHCP (Reference)</a></p>
<p class="toc level2"><a href="dhcp-ref-4.html">18.&nbsp;&nbsp;DHCP Commands and Files (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipsectm-1.html">Part&nbsp;III&nbsp;IP Security</a></p>
<p class="toc level2"><a href="ipsec-ov-1.html">19.&nbsp;&nbsp;IP Security Architecture (Overview)</a></p>
<p class="toc level2"><a href="ipsec-mgtasks-1.html">20.&nbsp;&nbsp;Configuring IPsec (Tasks)</a></p>
<p class="toc level2"><a href="ipsecref-1.html">21.&nbsp;&nbsp;IP Security Architecture (Reference)</a></p>
<p class="toc level2"><a href="ike-1.html">22.&nbsp;&nbsp;Internet Key Exchange (Overview)</a></p>
<p class="toc level2"><a href="ike-task-1.html">23.&nbsp;&nbsp;Configuring IKE (Tasks)</a></p>
<p class="toc level2"><a href="ikeref-1.html">24.&nbsp;&nbsp;Internet Key Exchange (Reference)</a></p>
<p class="toc level2"><a href="eupsq.html">25.&nbsp;&nbsp;Solaris IP Filter (Overview)</a></p>
<p class="toc level2"><a href="ipfilter-admin-1.html">26.&nbsp;&nbsp;Solaris IP Filter (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="miptm-1.html">Part&nbsp;IV&nbsp;Mobile IP</a></p>
<p class="toc level2"><a href="mipoverview-1.html">27.&nbsp;&nbsp;Mobile IP (Overview)</a></p>
<p class="toc level2"><a href="mipimplementing-1.html">28.&nbsp;&nbsp;Administering Mobile IP (Tasks)</a></p>
<p class="toc level2"><a href="mipmanaging-22.html">29.&nbsp;&nbsp;Mobile IP Files and Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipmptm-1.html">Part&nbsp;V&nbsp;IPMP</a></p>
<p class="toc level2"><a href="mpoverview.html">30.&nbsp;&nbsp;Introducing IPMP (Overview)</a></p>
<p class="toc level2"><a href="deploynetmult-56.html">31.&nbsp;&nbsp;Administering IPMP (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ipqostm-1.html">Part&nbsp;VI&nbsp;IP Quality of Service (IPQoS)</a></p>
<p class="toc level2"><a href="ipqos-intro-1.html">32.&nbsp;&nbsp;Introducing IPQoS (Overview)</a></p>
<p class="toc level2"><a href="ipqos-config-planning-1.html">33.&nbsp;&nbsp;Planning for an IPQoS-Enabled Network (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-policy-planning-1.html">34.&nbsp;&nbsp;Creating the IPQoS Configuration File (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-isp-setup-1.html">35.&nbsp;&nbsp;Starting and Maintaining IPQoS (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-accounting-1.html">36.&nbsp;&nbsp;Using Flow Accounting and Statistics Gathering (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-reference-1.html">37.&nbsp;&nbsp;IPQoS in Detail (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="ipv6-admintasks-670"></a><h3>Monitoring Packet Transfers With the <tt>snoop</tt> Command</h3>
<p><a name="indexterm-885"></a><a name="indexterm-886"></a><a name="indexterm-887"></a><a name="indexterm-888"></a><a name="indexterm-889"></a>You can use the <tt>snoop</tt> command to monitor the state of data transfers.
<tt>snoop</tt> captures network packets and displays their contents in the format that you
specify. Packets can be displayed as soon as they are received, or saved
to a file.  When <tt>snoop</tt> writes to an intermediate file, packet loss
under busy trace conditions is unlikely.  <tt>snoop</tt> itself is then used to
interpret the file. </p><p>To capture packets to and from the default interface in promiscuous mode, you
must assume the Network Management role or become superuser. In summary form, <tt>snoop</tt>
displays only the data that pertains to the highest-level protocol. For example, an
NFS packet only displays NFS information. The underlying RPC, UDP, IP, and Ethernet
frame information is suppressed but can be displayed if either of the verbose
options is chosen.</p><p>Use <tt>snoop</tt> frequently and consistently to become familiar with normal system behavior. For
assistance in analyzing packets, look for a recent white paper and RFC, and
seek the advice of an expert in a particular area, such as NFS
or NIS. For details on using <tt>snoop</tt> and its options, refer to the
<a href="http://docs.sun.com/doc/819-2240/snoop-1m?a=view"><tt>snoop</tt>(1M)</a> man page. <a name="indexterm-890"></a><a name="indexterm-891"></a><a name="indexterm-892"></a></p>

<a name="ipv6-admintasks-67"></a><h4>How to Check Packets From All Interfaces</h4><a name="indexterm-893"></a><ol>
<li><b>On the local host, assume the Network Management role or become superuser.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Print information about the interfaces that are attached to the system. </b><pre># <tt><b>ifconfig -a</b></tt></pre><p>The <tt>snoop</tt> command normally uses the first non-loopback device, typically the primary network
interface.</p></li>
<li><b>Begin packet capture by typing <tt>snoop</tt> without arguments, as shown in <a href="#eojbm">Example&nbsp;8-19</a></b></li>
<li><a name="ipv6-admintasks-step-70"></a><b>Use Control-C to halt the process.</b></li></ol><a name="eojbm"></a>Example&nbsp;8-19 Output From the snoop Command<p>The basic <tt>snoop</tt> command returns output that resembles the following, for a dual-stack
host.</p><pre>% <tt><b>snoop</b></tt>
Using device /dev/hme (promiscuous mode)
farhost.remote.com -> myhost       RLOGIN C port=993 
    myhost -> farhost.remote.com   RLOGIN R port=993 Using device /dev/hme
router5.local.com -> router5.local.com ARP R 10.0.0.13, router5.local.com is
    0:10:7b:31:37:80
router5.local.com -> BROADCAST     TFTP Read "network-confg" (octet)
myhost -> DNSserver.local.com      DNS C 192.168.10.10.in-addr.arpa. Internet PTR ?
DNSserver.local.com  myhost        DNS R 192.168.10.10.in-addr.arpa. Internet PTR niserve2.
.
.
farhost.remote.com-> myhost        RLOGIN C port=993 
    myhost -> farhost.remote.com   RLOGIN R port=993 fe80::a00:20ff:febb:
.
fe80::a00:20ff:febb:e09 -> ff02::9 RIPng R (5 destinations)</pre><p>The packets that are captured in this output show a remote login
section, including lookups to the NIS and DNS servers for address resolution. Also included
are periodic ARP packets from the local router and advertisements of the IPv6
link-local address to <tt>in.ripngd</tt>.</p>

<a name="ipv6-admintasks-674"></a><h4>How to Capture <tt>snoop</tt> Output Into a File</h4><ol>
<li><b>On the local host, assume the Network Management role or become superuser.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Capture a <tt>snoop</tt> session into a file.</b><pre># <tt><b>snoop -o</b></tt> <i>filename</i></pre><p>For example:</p><pre># <tt><b>snoop /tmp/cap</b></tt>
Using device /dev/eri (promiscuous mode)
30 snoop: 30 packets captured</pre><p>In the example, 30 packets have been captured in a file named
<tt>/tmp/cap</tt>. The file can be in any directory with enough disk space.
The number of packets that are captured is displayed on the command line,
enabling you to press Control-C to abort at any time.</p><p><tt>snoop</tt> creates a noticeable networking load on the host machine, which can distort
the results. To see the actual results, run <tt>snoop</tt> from a third system.</p></li>
<li><b>Inspect the <tt>snoop</tt> output captures file.</b><pre># <tt><b>snoop -i</b></tt> <i>filename</i></pre></li></ol><a name="eojbn"></a>Example&nbsp;8-20 Contents of a <tt>snoop</tt> Output Captures File<p>The following output shows a variety of captures such as you might
receive as output from the <tt>snoop -i</tt> command.</p><pre># <tt><b>snoop -i /tmp/cap</b></tt>
1   0.00000 fe80::a00:20ff:fee9:2d27 -> fe80::a00:20ff:fecd:4375 
    ICMPv6 Neighbor advertisement
2   0.16198 farhost.com   -> myhost     RLOGIN C port=985 
3   0.00008 myhost -> farhost.com       RLOGIN R port=985 
10  0.91493    10.0.0.40 -> (broadcast)  ARP C Who is 10.0.0.40, 10.0.0.40 ?
34  0.43690 nearserver.here.com  -> 224.0.1.1  IP  D=224.0.1.1 S=10.0.0.40 LEN=28, 
      ID=47453, TO =0x0, TTL=1
35  0.00034  10.0.0.40 -> 224.0.1.1    IP  D=224.0.1.1 S=10.0.0.40 LEN=28, ID=57376, 
     TOS=0x0, TTL=47  </pre>

<a name="ipv6-admintasks-676"></a><h4>How to Check Packets Between an IPv4 Server and a Client</h4><a name="indexterm-894"></a><ol>
<li><b>Establish a <tt>snoop</tt> system off a hub that is connected to either the
client or the server. </b><p>The third system (the <tt>snoop</tt> system) checks all the intervening traffic, so the <tt>snoop</tt>
trace reflects what is actually happening on the wire.</p></li>
<li><b>On the <tt>snoop</tt> system, assume the Network Management role or become superuser.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Type <tt>snoop</tt> with options and save the output to a file.</b></li>
<li><b>Inspect and interpret the output. </b><p><a name="indexterm-895"></a><a name="indexterm-896"></a>Refer to <a href="http://www.ietf.org/rfc/rfc1761.txt?number=1761">RFC 1761, Snoop Version 2 Packet Capture File Format</a> for details of the <tt>snoop</tt> capture file. </p></li></ol>

<a name="ipv6-admintasks-10"></a><h4>How to Monitor IPv6 Network Traffic</h4><a name="indexterm-897"></a><a name="indexterm-898"></a><p>You can use the <tt>snoop</tt> command to display only IPv6 packets.</p><ol>
<li><b>On the local node, assume the Network Management role or become superuser.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Capture IPv6 packets.</b><pre># <tt><b>snoop ip6</b></tt></pre><p>For more information on the <tt>snoop</tt> command, see the <a href="http://docs.sun.com/doc/819-2240/snoop-1m?a=view"><tt>snoop</tt>(1M)</a> man page.</p></li></ol><a name="ipv6-admintasks-26"></a>Example&nbsp;8-21 Displaying Only IPv6 Network Traffic<p>The following example shows typical output such as you might receive from running
the <tt>snoop ip6</tt> command on a node.</p><pre># <tt><b>snoop ip6</b></tt>
fe80::a00:20ff:fecd:4374 -> ff02::1:ffe9:2d27 ICMPv6 Neighbor solicitation
fe80::a00:20ff:fee9:2d27 -> fe80::a00:20ff:fecd:4375 ICMPv6 Neighbor 
      solicitation
fe80::a00:20ff:fee9:2d27 -> fe80::a00:20ff:fecd:4375 ICMPv6 Neighbor 
      solicitation
fe80::a00:20ff:febb:e09 -> ff02::9      RIPng R (11 destinations)
fe80::a00:20ff:fee9:2d27 -> ff02::1:ffcd:4375 ICMPv6 Neighbor solicitation</pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ipv6-admintasks-72.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ipv6-admintasks-43.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

