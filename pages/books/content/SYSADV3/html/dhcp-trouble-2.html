<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Troubleshooting DHCP Server Problems - System Administration Guide: IP Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: IP Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="dhcp-trouble-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="dhcp-trouble-5.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="iptm-1.html">Part&nbsp;I&nbsp;TCP/IP Administration</a></p>
<p class="toc level2"><a href="ipov-1.html">1.&nbsp;&nbsp;Solaris TCPIP Protocol Suite (Overview)</a></p>
<p class="toc level2"><a href="ipplan-1.html">2.&nbsp;&nbsp;Planning an IPv4 Addressing Scheme (Tasks</a></p>
<p class="toc level2"><a href="ipv6-overview-7.html">3.&nbsp;&nbsp;Planning an IPv6 Addressing Scheme (Overview)</a></p>
<p class="toc level2"><a href="ipv6-planning-1.html">4.&nbsp;&nbsp;Planning an IPv6 Network (Tasks)</a></p>
<p class="toc level2"><a href="ipconfig-1.html">5.&nbsp;&nbsp;Configuring TCP/IP Network Services and IPv4 Addressing (Tasks)</a></p>
<p class="toc level2"><a href="fwawf.html">6.&nbsp;&nbsp;Administering Network Interfaces (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-config-tasks-1.html">7.&nbsp;&nbsp;Enabling IPv6 on a Network (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-admintasks-1.html">8.&nbsp;&nbsp;Administering a TCP/IP Network (Tasks)</a></p>
<p class="toc level2"><a href="gegel.html">9.&nbsp;&nbsp;Troubleshooting Network Problems (Tasks)</a></p>
<p class="toc level2"><a href="ipref-8.html">10.&nbsp;&nbsp;TCP/IP and IPv4 in Depth (Reference)</a></p>
<p class="toc level2"><a href="ipv6-ref-76.html">11.&nbsp;&nbsp;IPv6 in Depth (Reference)</a></p>
<p class="toc level1 tocsp"><a href="dhcptm-1.html">Part&nbsp;II&nbsp;DHCP</a></p>
<p class="toc level2"><a href="dhcp-overview-1.html">12.&nbsp;&nbsp;About Solaris DHCP (Overview)</a></p>
<p class="toc level2"><a href="chap2-26.html">13.&nbsp;&nbsp;Planning for DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="chapter3-20.html">14.&nbsp;&nbsp;Configuring the DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="dhcp-admin-9.html">15.&nbsp;&nbsp;Administering DHCP (Tasks)</a></p>
<p class="toc level2"><a href="eyatl.html">16.&nbsp;&nbsp;Configuring and Administering  DHCP Clients</a></p>
<p class="toc level2"><a href="dhcp-trouble-1.html">17.&nbsp;&nbsp;Troubleshooting DHCP (Reference)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Troubleshooting DHCP Server Problems</a></p>
</div>
<p class="toc level3"><a href="dhcp-trouble-5.html">Troubleshooting DHCP Client Configuration Problems</a></p>
<p class="toc level2 tocsp"><a href="dhcp-ref-4.html">18.&nbsp;&nbsp;DHCP Commands and Files (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipsectm-1.html">Part&nbsp;III&nbsp;IP Security</a></p>
<p class="toc level2"><a href="ipsec-ov-1.html">19.&nbsp;&nbsp;IP Security Architecture (Overview)</a></p>
<p class="toc level2"><a href="ipsec-mgtasks-1.html">20.&nbsp;&nbsp;Configuring IPsec (Tasks)</a></p>
<p class="toc level2"><a href="ipsecref-1.html">21.&nbsp;&nbsp;IP Security Architecture (Reference)</a></p>
<p class="toc level2"><a href="ike-1.html">22.&nbsp;&nbsp;Internet Key Exchange (Overview)</a></p>
<p class="toc level2"><a href="ike-task-1.html">23.&nbsp;&nbsp;Configuring IKE (Tasks)</a></p>
<p class="toc level2"><a href="ikeref-1.html">24.&nbsp;&nbsp;Internet Key Exchange (Reference)</a></p>
<p class="toc level2"><a href="eupsq.html">25.&nbsp;&nbsp;Solaris IP Filter (Overview)</a></p>
<p class="toc level2"><a href="ipfilter-admin-1.html">26.&nbsp;&nbsp;Solaris IP Filter (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="miptm-1.html">Part&nbsp;IV&nbsp;Mobile IP</a></p>
<p class="toc level2"><a href="mipoverview-1.html">27.&nbsp;&nbsp;Mobile IP (Overview)</a></p>
<p class="toc level2"><a href="mipimplementing-1.html">28.&nbsp;&nbsp;Administering Mobile IP (Tasks)</a></p>
<p class="toc level2"><a href="mipmanaging-22.html">29.&nbsp;&nbsp;Mobile IP Files and Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipmptm-1.html">Part&nbsp;V&nbsp;IPMP</a></p>
<p class="toc level2"><a href="mpoverview.html">30.&nbsp;&nbsp;Introducing IPMP (Overview)</a></p>
<p class="toc level2"><a href="deploynetmult-56.html">31.&nbsp;&nbsp;Administering IPMP (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ipqostm-1.html">Part&nbsp;VI&nbsp;IP Quality of Service (IPQoS)</a></p>
<p class="toc level2"><a href="ipqos-intro-1.html">32.&nbsp;&nbsp;Introducing IPQoS (Overview)</a></p>
<p class="toc level2"><a href="ipqos-config-planning-1.html">33.&nbsp;&nbsp;Planning for an IPQoS-Enabled Network (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-policy-planning-1.html">34.&nbsp;&nbsp;Creating the IPQoS Configuration File (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-isp-setup-1.html">35.&nbsp;&nbsp;Starting and Maintaining IPQoS (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-accounting-1.html">36.&nbsp;&nbsp;Using Flow Accounting and Statistics Gathering (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-reference-1.html">37.&nbsp;&nbsp;IPQoS in Detail (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="dhcp-trouble-2"></a><h3>Troubleshooting DHCP Server Problems</h3>
<p><a name="indexterm-1548"></a><a name="indexterm-1549"></a>The problems that you might encounter when you configure the server fall into
the following categories:</p>
<ul><li><p><a href="#dhcp-trouble-7">NIS+ Problems and the DHCP Data Store</a></p></li>
<li><p><a href="#dhcp-trouble-35">IP Address Allocation Errors in DHCP</a></p></li></ul>


<a name="dhcp-trouble-7"></a><h4>NIS+ Problems and the DHCP Data Store</h4>
<a name="indexterm-1550"></a><p>If you use NIS+ as the DHCP data store, problems that you
might encounter can be categorized as follows:</p>
<ul><li><p><a href="#dhcp-trouble-3">Cannot Select NIS+ as the DHCP Data Store</a></p></li>
<li><p><a href="#dhcp-trouble-6">NIS+ Is Not Adequately Configured for DHCP Data Store</a></p></li>
<li><p><a href="#dhcp-trouble-11">NIS+ Access Problems for the DHCP Data Store</a></p></li></ul>


<a name="dhcp-trouble-3"></a><h5>Cannot Select NIS+ as the DHCP Data Store</h5>
<p>If you try to use NIS+ as your data store, DHCP Manager
might not offer NIS+ as a choice for the data store. If you
use the <tt>dhcpconfig</tt> command, you might see a message stating that NIS+ does
not appear to be installed and running. Both these symptoms mean that NIS+
has not been configured for this server, although NIS+ might be in use
on the network. Before you can select NIS+ as a data store,
the server system must be configured as an NIS+ client.</p><p>Before you set up the DHCP server system as an NIS+ client,
the following statements must be true:</p>
<ul><li><p>The domain must have already been configured.</p></li>
<li><p>The NIS+ domain's master server must be running.</p></li>
<li><p>The master server's tables must be populated.</p></li>
<li><p>The hosts table must have an entry for the new client system, the DHCP server system.</p></li></ul>
<p><a href="http://docs.sun.com/doc/819-3195/c2setup-14140?a=view">Setting Up NIS+ Client Machines in <i>System Administration Guide: Naming and Directory Services (NIS+)</i></a> provides detailed information about configuring an NIS+ client.</p>

<a name="dhcp-trouble-6"></a><h5>NIS+ Is Not Adequately Configured for DHCP Data Store</h5>
<p>After you successfully use NIS+ with DHCP, you might encounter errors if
changes are made to NIS+. The changes could introduce configuration problems. Use the
following explanations of problems and solutions to help you determine the cause of
configuration problems.</p>
<p><b>Problem: </b>Root object does not exist in the NIS+ domain.</p>
<p><b>Solution: </b>Type the following command: 
<p><tt>/usr/lib/nis/nisstat</tt></p>
<p><a name="indexterm-1551"></a>This command displays statistics for the domain. If the root object does not
exist, no statistics are returned.</p>
<p>Set up the NIS+ domain using the <a href="http://docs.sun.com/doc/819-3195"><i>System Administration Guide: Naming and Directory Services (NIS+)</i></a>.</p></p>
<p><b>Problem: </b>NIS+ is not used for <tt>passwd</tt> and <tt>publickey</tt> information.</p>
<p><b>Solution: </b>Type the following command to view the configuration file for the name service
switch:
<p><tt>cat /etc/nsswitch.conf</tt></p>
<p>Check the <tt>passwd</tt> and <tt>publickey</tt> entries for the &ldquo;nisplus&rdquo; keyword. Refer to the
<a href="http://docs.sun.com/doc/819-3195"><i>System Administration Guide: Naming and Directory Services (NIS+)</i></a> for information about configuring the name service switch.</p></p>
<p><b>Problem: </b>The domain name is empty.</p>
<p><b>Solution: </b>Type the following command:
<p><tt>domainname</tt></p>
<p>If the command lists an empty string, no domain name has been
set for the domain. Use local files for your data store, or set
up an NIS+ domain for your network. Refer to the <a href="http://docs.sun.com/doc/819-3195"><i>System Administration Guide: Naming and Directory Services (NIS+)</i></a>.</p></p>
<p><b>Problem: </b>The <tt>NIS_COLD_START</tt> file does not exist.</p>
<p><b>Solution: </b>Type the following command on the server system to determine if the file
exists:
<p><tt>cat /var/nis/NIS_COLD_START</tt></p>
<p>Use local files for your data store, or create an NIS+ client.
Refer to the <a href="http://docs.sun.com/doc/819-3195"><i>System Administration Guide: Naming and Directory Services (NIS+)</i></a>.</p></p>

<a name="dhcp-trouble-11"></a><h5>NIS+ Access Problems for the DHCP Data Store</h5>
<p>NIS+ access problems might cause error messages about incorrect DES credentials, or inadequate
permissions to update NIS+ objects or tables. Use the following explanations of problems
and solutions to determine the cause of NIS+ access errors you receive.</p>
<p><b>Problem: </b>The DHCP server system does not have create access to the <tt>org_dir</tt>
object in the NIS+ domain.</p>
<p><b>Solution: </b>Type the following command:<pre><tt><b>nisls -ld org_dir</b></tt></pre>
<p><a name="indexterm-1552"></a>The access rights are listed in the form <tt>r---rmcdrmcdr---</tt>, where the permissions apply
respectively to nobody, owner, group, and world. The owner of the object is
listed next.</p>
<p>Normally, the <tt>org_dir</tt> directory object provides full rights to both the owner and
the group. Full rights consist of read, modify, create, and destroy. The <tt>org_dir</tt>
directory object provides only read access to the world and nobody classes.</p>
<p>The DHCP server name must either be listed as the owner of the
<tt>org_dir</tt> object, or be listed as a principal in the group. The group
must have create access. List the group with the command: </p><pre><tt><b>nisls -ldg org_dir</b></tt></pre>
<p><a name="indexterm-1553"></a>Use the <tt>nischmod</tt> command to change the permissions for <tt>org_dir</tt> if necessary. For
example, to add create access to the group, you would type the following
command:</p><pre><tt><b>nischmod g+c org_dir</b></tt></pre>
<p>See the <a href="http://docs.sun.com/doc/819-2239/nischmod-1?a=view"><tt>nischmod</tt>(1)</a> man page for more information.</p></p>
<p><b>Problem: </b>The DHCP server does not have access rights to create a table
under the <tt>org_dir</tt> object.
<p>Usually, this problem means the server system's principal name is not a member
of the owning group for the <tt>org_dir</tt> object, or no owning group
exists.</p></p>
<p><b>Solution: </b>Type this command to find the owning group name:<pre><tt><b>niscat -o org_dir</b></tt></pre>
<p>Look for a line that is similar to:</p>
<p><tt>Group : "admin.example.com."</tt></p>
<p>List the principal names in the group using the command:</p><pre><tt><b>nisgrpadm -l</b></tt> <i>groupname</i></pre>
<p>For example, this command lists the principal names of the group <tt>admin.example.com</tt>:</p>
<p><tt>nisgrpadm -l admin.example.com</tt></p>
<p>The server system's name should be listed as an explicit member of
the group or included as an implicit member of the group. If necessary,
add the server system's name to the group using the <tt>nisgrpadm</tt> command.</p>
<p>For example, to add the server name <tt>pacific</tt> to the group <tt>admin.example.com</tt>, you
would type the following command:</p><pre>nisgrpadm -a admin.example.com pacific.example.com</pre>
<p>See the <a href="http://docs.sun.com/doc/819-2239/nisgrpadm-1?a=view"><tt>nisgrpadm</tt>(1)</a> man page for more information.</p></p>
<p><b>Problem: </b>The DHCP server does not have valid Data Encryption Standard (DES) credentials in
the NIS+ <tt>cred</tt> table.</p>
<p><b>Solution: </b>If there is a credential problem, an error message states that the
user does not have DES credentials in the NIS+ name service. 
<p><a name="indexterm-1554"></a>Use the <tt>nisaddcred</tt> command to add security credentials for the DHCP server system.</p>
<p>The following example shows how to add DES credentials for the system <tt>mercury</tt>
in the domain <tt>example.com</tt>:</p><pre>nisaddcred -p unix.mercury@example.com \
-P mercury.example.com. DES example.com.</pre>
<p>The command prompts for the root password, which is required to generate
an encrypted secret key.</p>
<p>See the <a href="http://docs.sun.com/doc/819-2240/nisaddcred-1m?a=view"><tt>nisaddcred</tt>(1M)</a> man page for more information.</p></p>

<a name="dhcp-trouble-35"></a><h4>IP Address Allocation Errors in DHCP</h4>
<p><a name="indexterm-1555"></a><a name="indexterm-1556"></a>When a client attempts to obtain or verify an IP address, you
might see problems logged to <tt>syslog</tt> or in server debugging mode output. The following
list of common error messages indicates the possible causes and solutions.</p><p>There is no <i>n.n.n.n</i> dhcp-network table for DHCP client's network</p>Cause: <p>A client is requesting a specific IP address or seeking to extend a
lease on its current IP address. The DHCP server cannot find the
DHCP network table for that address.</p>Solution: <p>The DHCP network table might have been deleted mistakenly. You can recreate the
network table by adding the network again using DHCP Manager or the <tt>dhcpconfig</tt>
command.</p><p>ICMP ECHO reply to OFFER candidate: <i>n.n.n.n</i>, disabling</p>Cause: <p>The IP address considered for offering to a DHCP client is already in
use. This problem might occur if more than one DHCP server owns
the address. The problem might also occur if an address was manually configured
for a non-DHCP network client.</p>Solution: <p>Determine the proper ownership of the address. Correct either the DHCP server database
or the host's network configuration.</p><p>ICMP ECHO reply to OFFER candidate: <i>n.n.n.n</i>. No corresponding dhcp network record.</p>Cause: <p>The IP address considered for offering to a DHCP client does not have
a record in a network table. This error indicates that the IP
address record was deleted from the DHCP network table after the address was
selected. This error can only happen in the brief period before the duplicate
address check is completed.</p>Solution: <p>Use DHCP Manager or the <tt>pntadm</tt> command to view the DHCP network table.
If the IP address is missing, create the address with DHCP Manager by
choosing Create from the Edit menu on the Address tab. You can
also use <tt>pntadm</tt> to create the IP address.</p><p>DHCP network record for <i>n.n.n.n</i>is unavailable, ignoring request.</p>Cause: <p>The record for the requested IP address is not in the DHCP network
table, so the server is dropping the request.</p>Solution: <p>Use DHCP Manager or the <tt>pntadm</tt> command to view the DHCP network table.
If the IP address is missing, create the address with DHCP Manager by
choosing Create from the Edit menu on the Address tab. You can
also use <tt>pntadm</tt> to create the address.</p><p><i>n.n.n.n</i> currently marked as unusable.</p>Cause: <p>The requested IP address cannot be offered because the address has been marked
in the network table as unusable.</p>Solution: <p>You can use DHCP Manager or the <tt>pntadm</tt> command to make the address
usable.</p><p><i>n.n.n.n</i> was manually allocated. No dynamic address will be allocated.</p>Cause: <p>The client ID has been assigned a manually allocated address, and that address
is marked as unusable. The server cannot allocate a different address to this
client.</p>Solution: <p>You can use DHCP Manager or the <tt>pntadm</tt> command to make the address
usable, or manually allocate a different address to the client.</p><p>Manual allocation (<i>n.n.n.n, client ID</i>) has <i>n</i> other records. Should have 0.</p>Cause: <p>The client that has the specified client ID has been manually assigned more
than one IP address. A client should be assigned only one address. The
server selects the last manually assigned address that is found in the
network table.</p>Solution: <p>Use DHCP Manager or the <tt>pntadm</tt> command to modify IP addresses to remove
the additional manual allocations. </p><p>No more IP addresses on <i>n.n.n.n</i>network.</p>Cause: <p>All IP addresses currently managed by DHCP on the specified network have been
allocated. </p>Solution: <p>Use DHCP Manager or the <tt>pntadm</tt> command to create new IP addresses for
this network.</p><p>Client: <i>clientid</i> lease on <i>n.n.n.n</i> expired.</p>Cause: <p>The lease was not negotiable and timed out. </p>Solution: <p>The client should automatically restart the protocol to obtain a new lease.</p><p>Offer expired for client: <i>n.n.n.n</i></p>Cause: <p>The server made an IP address offer to the client, but the client
took too long to respond and the offer expired.</p>Solution: <p>The client should automatically issue another  discover message. If this message also
times out, increase the cache offer time out for the DHCP server. In
DHCP Manager, choose Modify from the Service menu. </p><p>Client: <i>clientid</i> REQUEST is missing requested IP option.</p>Cause: <p>The client's request did not specify the offered IP address, so the DHCP
server ignored the request. This problem might occur if you use a third-party
DHCP client that is not compliant with the updated DHCP protocol, RFC 2131.</p>Solution: <p>Update the client software.</p><p>Client: <i>clientid</i> is trying to renew <i>n.n.n.n</i>, an IP address it has
not leased.</p>Cause: <p>The IP address for this client in the DHCP network table does not
match the IP address that the client specified in its renewal request.
The DHCP server does not renew the lease. This problem might occur if
you delete a client's record while the client is still using the IP
address.</p>Solution: <p>Use DHCP Manager or the <tt>pntadm</tt> command to examine the network table, and
correct the client's record, if necessary. The client ID should be bound to
the specified IP address. If the client ID is not bound, edit the
address properties to add the client ID.</p><p>Client: <i>clientid</i> is trying to verify unrecorded address: <i>n.n.n.n</i>, ignored.</p>Cause: <p>The specified client has not been registered in the DHCP network table with
this address, so the request is ignored by this DHCP server.</p><p>Another DHCP server on the network might have assigned this client the address.
However, you might also have deleted the client's record while the client was
still using the IP address.</p>Solution: <p>Use DHCP Manager or the <tt>pntadm</tt> command to examine the network table on
this server and any other DHCP servers on the network. Make corrections, if
necessary.</p><p>You can also do nothing and allow the lease to expire. The client
automatically requests a new address lease.</p><p>If you want the client to get a new lease immediately, restart
the DHCP protocol on the client by typing the following commands:</p><pre>ifconfig <i>interface</i> dhcp release
ifconfig <i>interface</i> dhcp start</pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="dhcp-trouble-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="dhcp-trouble-5.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

