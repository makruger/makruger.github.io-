<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Troubleshooting DHCP Client Configuration Problems - System Administration Guide: IP Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: IP Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="dhcp-trouble-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="dhcp-ref-4.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="iptm-1.html">Part&nbsp;I&nbsp;TCP/IP Administration</a></p>
<p class="toc level2"><a href="ipov-1.html">1.&nbsp;&nbsp;Solaris TCPIP Protocol Suite (Overview)</a></p>
<p class="toc level2"><a href="ipplan-1.html">2.&nbsp;&nbsp;Planning an IPv4 Addressing Scheme (Tasks</a></p>
<p class="toc level2"><a href="ipv6-overview-7.html">3.&nbsp;&nbsp;Planning an IPv6 Addressing Scheme (Overview)</a></p>
<p class="toc level2"><a href="ipv6-planning-1.html">4.&nbsp;&nbsp;Planning an IPv6 Network (Tasks)</a></p>
<p class="toc level2"><a href="ipconfig-1.html">5.&nbsp;&nbsp;Configuring TCP/IP Network Services and IPv4 Addressing (Tasks)</a></p>
<p class="toc level2"><a href="fwawf.html">6.&nbsp;&nbsp;Administering Network Interfaces (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-config-tasks-1.html">7.&nbsp;&nbsp;Enabling IPv6 on a Network (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-admintasks-1.html">8.&nbsp;&nbsp;Administering a TCP/IP Network (Tasks)</a></p>
<p class="toc level2"><a href="gegel.html">9.&nbsp;&nbsp;Troubleshooting Network Problems (Tasks)</a></p>
<p class="toc level2"><a href="ipref-8.html">10.&nbsp;&nbsp;TCP/IP and IPv4 in Depth (Reference)</a></p>
<p class="toc level2"><a href="ipv6-ref-76.html">11.&nbsp;&nbsp;IPv6 in Depth (Reference)</a></p>
<p class="toc level1 tocsp"><a href="dhcptm-1.html">Part&nbsp;II&nbsp;DHCP</a></p>
<p class="toc level2"><a href="dhcp-overview-1.html">12.&nbsp;&nbsp;About Solaris DHCP (Overview)</a></p>
<p class="toc level2"><a href="chap2-26.html">13.&nbsp;&nbsp;Planning for DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="chapter3-20.html">14.&nbsp;&nbsp;Configuring the DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="dhcp-admin-9.html">15.&nbsp;&nbsp;Administering DHCP (Tasks)</a></p>
<p class="toc level2"><a href="eyatl.html">16.&nbsp;&nbsp;Configuring and Administering  DHCP Clients</a></p>
<p class="toc level2"><a href="dhcp-trouble-1.html">17.&nbsp;&nbsp;Troubleshooting DHCP (Reference)</a></p>
<p class="toc level3"><a href="dhcp-trouble-2.html">Troubleshooting DHCP Server Problems</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Troubleshooting DHCP Client Configuration Problems</a></p>
</div>
<p class="toc level2 tocsp"><a href="dhcp-ref-4.html">18.&nbsp;&nbsp;DHCP Commands and Files (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipsectm-1.html">Part&nbsp;III&nbsp;IP Security</a></p>
<p class="toc level2"><a href="ipsec-ov-1.html">19.&nbsp;&nbsp;IP Security Architecture (Overview)</a></p>
<p class="toc level2"><a href="ipsec-mgtasks-1.html">20.&nbsp;&nbsp;Configuring IPsec (Tasks)</a></p>
<p class="toc level2"><a href="ipsecref-1.html">21.&nbsp;&nbsp;IP Security Architecture (Reference)</a></p>
<p class="toc level2"><a href="ike-1.html">22.&nbsp;&nbsp;Internet Key Exchange (Overview)</a></p>
<p class="toc level2"><a href="ike-task-1.html">23.&nbsp;&nbsp;Configuring IKE (Tasks)</a></p>
<p class="toc level2"><a href="ikeref-1.html">24.&nbsp;&nbsp;Internet Key Exchange (Reference)</a></p>
<p class="toc level2"><a href="eupsq.html">25.&nbsp;&nbsp;Solaris IP Filter (Overview)</a></p>
<p class="toc level2"><a href="ipfilter-admin-1.html">26.&nbsp;&nbsp;Solaris IP Filter (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="miptm-1.html">Part&nbsp;IV&nbsp;Mobile IP</a></p>
<p class="toc level2"><a href="mipoverview-1.html">27.&nbsp;&nbsp;Mobile IP (Overview)</a></p>
<p class="toc level2"><a href="mipimplementing-1.html">28.&nbsp;&nbsp;Administering Mobile IP (Tasks)</a></p>
<p class="toc level2"><a href="mipmanaging-22.html">29.&nbsp;&nbsp;Mobile IP Files and Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipmptm-1.html">Part&nbsp;V&nbsp;IPMP</a></p>
<p class="toc level2"><a href="mpoverview.html">30.&nbsp;&nbsp;Introducing IPMP (Overview)</a></p>
<p class="toc level2"><a href="deploynetmult-56.html">31.&nbsp;&nbsp;Administering IPMP (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ipqostm-1.html">Part&nbsp;VI&nbsp;IP Quality of Service (IPQoS)</a></p>
<p class="toc level2"><a href="ipqos-intro-1.html">32.&nbsp;&nbsp;Introducing IPQoS (Overview)</a></p>
<p class="toc level2"><a href="ipqos-config-planning-1.html">33.&nbsp;&nbsp;Planning for an IPQoS-Enabled Network (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-policy-planning-1.html">34.&nbsp;&nbsp;Creating the IPQoS Configuration File (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-isp-setup-1.html">35.&nbsp;&nbsp;Starting and Maintaining IPQoS (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-accounting-1.html">36.&nbsp;&nbsp;Using Flow Accounting and Statistics Gathering (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-reference-1.html">37.&nbsp;&nbsp;IPQoS in Detail (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="dhcp-trouble-5"></a><h3>Troubleshooting DHCP Client Configuration Problems</h3>
<p><a name="indexterm-1557"></a>The problems that you might encounter with a DHCP client fall into
the following categories:</p>
<ul><li><p><a href="#dhcp-trouble-12">Problems Communicating With the DHCP Server</a></p></li>
<li><p><a href="#dhcp-trouble-38">Problems With Inaccurate DHCP Configuration Information</a></p></li></ul>


<a name="dhcp-trouble-12"></a><h4>Problems Communicating With the DHCP Server</h4>
<p>This section describes problems that you might encounter as you add DHCP
clients to the network.</p><p>After you enable the client software and reboot the system, the client
tries to reach the DHCP server to obtain its network configuration. If the
client fails to reach the server, you might see error messages such as
the following: </p><pre>DHCP or BOOTP server not responding </pre><p>Before you can determine the problem, you must gather diagnostic information from both
the client and the server. To gather information, you can perform the
following tasks:</p>
<ol><li><p><a href="#dhcp-trouble-proc-14">How to Run the DHCP Client in Debugging Mode</a></p></li>
<li><p><a href="#dhcp-trouble-proc-18">How to Run the DHCP Server in Debugging Mode</a></p></li>
<li><p><a href="#dhcp-trouble-proc-21">How to Use <tt>snoop</tt> to Monitor DHCP Network Traffic</a></p></li></ol>
<p>You can do these things separately or concurrently.</p><p>The information that you gather can help you determine if the problem
is with the client, server, or a relay agent. Then, you can find
a solution.</p>

<a name="dhcp-trouble-proc-14"></a><h5>How to Run the DHCP Client in Debugging Mode</h5>
<a name="indexterm-1558"></a><p>If the client is not a Solaris DHCP client, refer to the
client's documentation for information about how to run the client in debugging mode.
</p><p>If you have a Solaris DHCP client, use the following steps.</p><ol>
<li><a name="dhcp-trouble-step-16"></a><b>Become superuser on the DHCP client system.</b></li>
<li><a name="dhcp-trouble-step-17"></a><b>Kill the DHCP client daemon.</b><pre># <tt><b>pkill -x dhcpagent</b></tt></pre></li>
<li><b>Restart the daemon in debugging mode.</b><pre># <tt><b>/sbin/dhcpagent -d1 -f &amp;</b></tt></pre><p>The <tt>-d</tt> switch puts the DHCP client in debugging mode with level 1
verbosity. The <tt>-f</tt> switch causes output to be sent to the console instead
of to <tt>syslog</tt>.</p></li>
<li><b>Configure the interface to start DHCP negotiation.</b><pre># <tt><b>ifconfig </tt><i>interface</i><tt> dhcp start</b></tt></pre><p>Replace <i>interface</i> with the name of the network interface of the client, such
as <tt>ge0</tt>.</p><p>When run in debugging mode, the client daemon displays messages to your screen
while performing DHCP requests. See <a href="#dhcp-trouble-13">Output from DHCP Client in Debugging Mode</a> for information about client debugging mode output.</p></li></ol>

<a name="dhcp-trouble-proc-18"></a><h5>How to Run the DHCP Server in Debugging Mode</h5>
<a name="indexterm-1559"></a><a name="indexterm-1560"></a><ol>
<li><a name="dhcp-trouble-step-19"></a><b>Become superuser on the server system.</b></li>
<li><a name="dhcp-trouble-step-20"></a><b>Stop the DHCP server temporarily.</b><pre># <tt><b>svcadm disable -t svc:/network/dhcp-server</b></tt></pre><p>You can also use DHCP Manager or <tt>dhcpconfig</tt> to stop the server.</p></li>
<li><b>Restart the daemon in debugging mode.</b><pre># <tt><b>/usr/lib/inet/in.dhcpd -d -v</b></tt></pre><p>You should also use any <tt>in.dhcpd</tt> command-line options that you normally use when
you run the daemon. For example, if you run the daemon as
a BOOTP relay agent, include the <tt>-r</tt> option with the <tt>in.dhcpd -d -v</tt> command.</p><p>When run in debugging mode, the daemon displays messages to your screen while
processing DHCP or BOOTP requests. See <a href="#dhcp-trouble-20">Output from the DHCP Server in Debugging Mode</a> for information about server debugging mode
output.</p></li></ol>

<a name="dhcp-trouble-proc-21"></a><h5>How to Use <tt>snoop</tt> to Monitor DHCP Network Traffic</h5>
<a name="indexterm-1561"></a><ol>
<li><a name="dhcp-trouble-step-22"></a><b>Become superuser on the DHCP server system.</b></li>
<li><a name="dhcp-trouble-step-23"></a><b>Start <tt>snoop</tt> to begin tracing network traffic across the server's network interface.</b><pre># <tt><b>/usr/sbin/snoop -d </tt><i>interface</i><tt> -o </tt><i>snoop-output-filename</i><tt> udp port 67 or udp port 68</b></tt></pre><p>For example, you might type the following command:</p><pre>#  <tt><b>/usr/sbin/snoop -d hme0 -o /tmp/snoop.output udp port 67 or udp port 68</b></tt></pre><p><tt>snoop</tt> continues to monitor the interface until you stop <tt>snoop</tt> by pressing
Control-C after you have the information that you need.</p></li>
<li><a name="dhcp-trouble-step-24"></a><b>Boot the client system, or restart the <tt>dhcpagent</tt> on the client system.</b><p><a href="#dhcp-trouble-proc-14">How to Run the DHCP Client in Debugging Mode</a> describes how to restart <tt>dhcpagent</tt>.</p></li>
<li><a name="dhcp-trouble-step-26"></a><b>On the server system, use <tt>snoop</tt> to display the output file with the
contents of network packets:</b><pre># <tt><b>/usr/sbin/snoop -i </tt><i>snoop-output-filename</i><tt> -x0 -v</b></tt></pre><p>For example, you might type the following command:</p># <tt><b>/usr/sbin/snoop -i /tmp/snoop.output -x0 -v</b></tt></li></ol><h6>See Also</h6><p>See <a href="#dhcp-trouble-30">DHCP <tt>snoop</tt> Output</a> for information about interpreting the output.</p>

<a name="dhcp-trouble-13"></a><h5>Output from DHCP Client in Debugging Mode</h5>
<p><a name="indexterm-1562"></a>The following example shows normal output when a DHCP client in debugging mode
sends its DHCP request and receives its configuration information from a DHCP server.</p><a name="dhcp-trouble-ex-33"></a>Example&nbsp;17-1 Normal Output from the DHCP Client in Debugging Mode<pre>/sbin/dhcpagent: debug: set_packet_filter: set filter 0x27fc8 (DHCP filter) 
/sbin/dhcpagent: debug: init_ifs: initted interface hme0 
/sbin/dhcpagent: debug: insert_ifs: hme0: sdumax 1500, optmax 1260, hwtype 1, hwlen 6 
/sbin/dhcpagent: debug: insert_ifs: inserted interface hme0 
/sbin/dhcpagent: debug: register_acknak: registered acknak id 5 
/sbin/dhcpagent: debug: unregister_acknak: unregistered acknak id 5 
/sbin/dhcpagent: debug: set_packet_filter: set filter 0x26018 (ARP reply filter)
/sbin/dhcpagent: info: setting IP netmask on hme0 to 255.255.192.0 
/sbin/dhcpagent: info: setting IP address on hme0 to 10.23.3.233 
/sbin/dhcpagent: info: setting broadcast address on hme0 to 10.23.63.255 
/sbin/dhcpagent: info: added default router 10.23.0.1 on hme0 
/sbin/dhcpagent: debug: set_packet_filter: set filter 0x28054 (blackhole filter) 
/sbin/dhcpagent: debug: configure_if: bound ifsp->if_sock_ip_fd 
/sbin/dhcpagent: info: hme0 acquired lease, expires Tue Aug 10 16:18:33 2006 
/sbin/dhcpagent: info: hme0 begins renewal at Tue Aug 10 15:49:44 2006 
/sbin/dhcpagent: info: hme0 begins rebinding at Tue Aug 10 16:11:03 2006</pre><p>If the client cannot reach the DHCP server, you might see debugging
mode output that is similar to the output shown in the following example.</p><a name="dhcp-trouble-ex-34"></a>Example&nbsp;17-2 Output Indicating a Problem from the DHCP Client in Debugging Mode<pre>/sbin/dhcpagent: debug: set_packet_filter: set filter 0x27fc8 (DHCP filter)
/sbin/dhcpagent: debug: init_ifs: initted interface hme0 
/sbin/dhcpagent: debug: select_best: no valid OFFER/BOOTP reply
/sbin/dhcpagent: debug: select_best: no valid OFFER/BOOTP reply
/sbin/dhcpagent: debug: select_best: no valid OFFER/BOOTP reply
 </pre><p>If you see this message, the client request never reached the server,
or the server cannot send a response to the client. Run <tt>snoop</tt> on
the server as described in <a href="#dhcp-trouble-proc-21">How to Use <tt>snoop</tt> to Monitor DHCP Network Traffic</a> to determine if packets from the client
have reached the server.</p>

<a name="dhcp-trouble-20"></a><h5>Output from the DHCP Server in Debugging Mode</h5>
<a name="indexterm-1563"></a><p>Normal server debugging mode output shows server configuration information followed by information about
each network interface as the daemon starts. After daemon startup, the debugging mode
output shows information about requests the daemon processes. <a href="#dhcp-trouble-ex-29">Example&nbsp;17-3</a> shows debugging mode
output for a DHCP server that has just started. The server extends the
lease for a client that is using an address owned by another DHCP
server that is not responding.</p><a name="dhcp-trouble-ex-29"></a>Example&nbsp;17-3 Normal Output for DHCP Server in Debugging Mode<pre>Daemon Version: 3.1  
Maximum relay hops: 4  
Transaction logging to console enabled.  
Run mode is: DHCP Server Mode.  
Datastore: nisplus  
Path: org_dir.dhcp.test..:dhcp.test..:$ 
DHCP offer TTL: 10  
Ethers compatibility enabled.  
BOOTP compatibility enabled.  
ICMP validation timeout: 1000 milliseconds, Attempts: 2.  
Monitor (0005/hme0) started...  
Thread Id: 0005 - Monitoring Interface: hme0 *****  
MTU: 1500      Type: DLPI  
Broadcast: 10.21.255.255 
Netmask: 255.255.0.0  
Address: 10.21.0.2  
Monitor (0006/nf0) started...  
Thread Id: 0006 - Monitoring Interface: nf0 *****  
MTU: 4352      Type: DLPI  
Broadcast: 10.22.255.255  
Netmask: 255.255.0.0  
Address: 10.22.0.1  
Monitor (0007/qfe0) started...  
Thread Id: 0007 - Monitoring Interface: qfe0 *****  
MTU: 1500      Type: DLPI   
Broadcast: 10.23.63.255  
Netmask: 255.255.192.0  
Address: 10.23.0.1  
Read 33 entries from DHCP macro database on Tue Aug 10 15:10:27 2006 
Datagram received on network device: qfe0  
Client: 0800201DBA3A is requesting verification of address owned by 10.21.0.4 
Datagram received on network device: qfe0  
Client: 0800201DBA3A is requesting verification of address owned by 10.21.0.4  
Datagram received on network device: qfe0  
Client: 0800201DBA3A is requesting verification of address owned by 10.21.0.4  
Datagram received on network device: qfe0  
Client: 0800201DBA3A maps to IP: 10.23.3.233  
Unicasting datagram to 10.23.3.233 address.  
Adding ARP entry: 10.23.3.233 == 0800201DBA3A  
DHCP EXTEND 0934312543 0934316143 10.23.3.233 10.21.0.2 
          0800201DBA3A SUNW.Ultra-5_10 0800201DBA3A</pre><p><a href="#dhcp-trouble-ex-30">Example&nbsp;17-4</a> shows debugging mode output from a DHCP daemon that starts as a
BOOTP relay agent. The agent relays requests from a client to a DHCP
server, and relays the server's responses to the client.</p><a name="dhcp-trouble-ex-30"></a>Example&nbsp;17-4 Normal Output from BOOTP Relay in Debugging Mode<pre>Relay destination: 10.21.0.4 (blue-servr2)     network: 10.21.0.0  
Daemon Version: 3.1  
Maximum relay hops: 4  
Transaction logging to console enabled.  
Run mode is: Relay Agent Mode.  
Monitor (0005/hme0) started...  
Thread Id: 0005 - Monitoring Interface: hme0 *****  
MTU: 1500      Type: DLPI  
Broadcast: 10.21.255.255  
Netmask: 255.255.0.0  
Address: 10.21.0.2  
Monitor (0006/nf0) started...  
Thread Id: 0006 - Monitoring Interface: nf0 *****  
MTU: 4352      Type: DLPI  
Broadcast: 10.22.255.255  
Netmask: 255.255.0.0  
Address: 10.22.0.1  
Monitor (0007/qfe0) started...  
Thread Id: 0007 - Monitoring Interface: qfe0 *****  
MTU: 1500      Type: DLPI  
Broadcast: 10.23.63.255  
Netmask: 255.255.192.0  
Address: 10.23.0.1  
Relaying request 0800201DBA3A to 10.21.0.4, server port.  
BOOTP RELAY-SRVR 0934297685 0000000000 0.0.0.0 10.21.0.4 0800201DBA3A 
N/A 0800201DBA3A  
Packet received from relay agent: 10.23.0.1  
Relaying reply to client 0800201DBA3A  
Unicasting datagram to 10.23.3.233 address.  
Adding ARP entry: 10.23.3.233 == 0800201DBA3A  
BOOTP RELAY-CLNT 0934297688 0000000000 10.23.0.1 10.23.3.233 0800201DBA3A 
N/A 0800201DBA3A  
Relaying request 0800201DBA3A to 10.21.0.4, server port.  
BOOTP RELAY-SRVR 0934297689 0000000000 0.0.0.0 10.21.0.4 0800201DBA3A 
N/A 0800201DBA3A  
Packet received from relay agent: 10.23.0.1  
Relaying reply to client 0800201DBA3A  
Unicasting datagram to 10.23.3.233 address.  
Adding ARP entry: 10.23.3.233 == 0800201DBA3A 
 </pre><p><a name="indexterm-1564"></a>If there is a problem with DHCP, the debugging mode output might
display warnings or error messages. Use the following list of DHCP server error
messages to find solutions.</p><p>ICMP ECHO reply to OFFER candidate: <i>ip_address</i> disabling</p>Cause: <p>Before the DHCP server offers an IP address to a client, the server
pings the address to verify that the address is not in use.
If a client replies, the address is in use.</p>Solution: <p>Make sure the addresses that you configured are not already in use. You
can use the <tt>ping</tt> command. See the <a href="http://docs.sun.com/doc/819-2240/ping-1m?a=view"><tt>ping</tt>(1M)</a> man page for more
information.</p><p>No more IP addresses on <i>network-address</i> network.</p>Cause: <p>No IP addresses are available in the DHCP network table associated with the
client's network.</p>Solution: <p>Create more IP addresses with DHCP Manager or the <tt>pntadm</tt> command. If
the DHCP daemon is monitoring multiple subnets, be sure the additional addresses are
for the subnet where the client is located. See <a href="dhcp-admin-124.html#dhcp-admin-126">Adding IP Addresses to the DHCP Service</a> for more information.</p><p>No more IP addresses for <i>network-address</i> network when you are running the DHCP
daemon in BOOTP compatibility mode.</p>Cause: <p>BOOTP does not use a lease time, so the DHCP server looks for
free addresses with the BOOTP flag set to allocate to BOOTP clients.</p>Solution: <p>Use DHCP Manager to allocate BOOTP addresses. See <a href="dhcp-admin-94.html">Supporting BOOTP Clients With the DHCP Service (Task Map)</a>.</p><p>Request to access nonexistent per network database: <i>database-name</i> in datastore: <i>datastore.</i></p>Cause: <p>During configuration of the DHCP server, a DHCP network table for a subnet
was not created.</p>Solution: <p>Use DHCP Manager or the <tt>pntadm</tt> command to create the DHCP network table
and new IP addresses. See <a href="dhcp-admin-15.html#dhcp-admin-17">Adding DHCP Networks</a>.</p><p>There is no <i>table-name</i> dhcp-network table for DHCP client's network.</p>Cause: <p>During configuration of the DHCP server, a DHCP network table for a subnet
was not created.</p>Solution: <p>Use DHCP Manager or the <tt>pntadm</tt> command to create the DHCP network table
and new IP addresses. See <a href="dhcp-admin-15.html#dhcp-admin-17">Adding DHCP Networks</a>.</p><p>Client using non_RFC1048 BOOTP cookie.</p>Cause: <p>A device on the network is trying to access an unsupported implementation of
BOOTP.</p>Solution: <p>Ignore this message, unless you need to configure this device. If you want
to support the device, see <a href="dhcp-admin-94.html">Supporting BOOTP Clients With the DHCP Service (Task Map)</a> for more information.</p>

<a name="dhcp-trouble-30"></a><h5>DHCP <tt>snoop</tt> Output</h5>
<p>In the <tt>snoop</tt> output, you should see that packets are exchanged between the
DHCP client system and the DHCP server system. The IP address for
each system is indicated in each packet. IP addresses for any routers or
relay agents in the packet's path are also included. If the systems do
not exchange packets, the client system might not be able to contact the
server system at all. The problem is then at a lower level. </p><p><a name="indexterm-1565"></a>To evaluate <tt>snoop</tt> output, you must know what the expected behavior is. For
example, you must know if the request should be going through a
BOOTP relay agent. You must also know the MAC addresses and the IP
address of the systems involved so that you can determine if those values
are as expected. If there is more than one network interface, you must
know the addresses of the network interfaces as well.</p><p>The following example shows normal <tt>snoop</tt> output for a DHCP acknowledgement message sent
from the DHCP server on <tt>blue-servr2</tt> to a client whose MAC address is
<tt>8:0:20:8e:f3:7e</tt>. In the message, the server assigns the client the IP address <tt>192.168.252.6</tt>
and the host name <tt>white-6</tt>. The message also includes a number of standard network
options and several vendor-specific options for the client.</p><a name="dhcp-trouble-ex-31"></a>Example&nbsp;17-5 Sample <tt>snoop</tt> Output for One Packet<pre>ETHER:  ----- Ether Header ----- 
ETHER:   
ETHER:  Packet 26 arrived at 14:43:19.14 
ETHER:  Packet size = 540 bytes 
ETHER:  Destination = 8:0:20:8e:f3:7e, Sun 
ETHER:  Source      = 8:0:20:1e:31:c1, Sun 
ETHER:  Ethertype = 0800 (IP) 
ETHER:  
IP:   ----- IP Header ----- 
IP:    
IP:   Version = 4 
IP:   Header length = 20 bytes 
IP:   Type of service = 0x00 
IP:         xxx. .... = 0 (precedence) 
IP:         ...0 .... = normal delay 
IP:         .... 0... = normal throughput 
IP:         .... .0.. = normal reliability 
IP:   Total length = 526 bytes 
IP:   Identification = 64667 
IP:   Flags = 0x4 IP:         .1.. .... = do not fragment 
IP:         ..0. .... = last fragment 
IP:   Fragment offset = 0 bytes 
IP:   Time to live = 254 seconds/hops 
IP:   Protocol = 17 (UDP) 
IP:   Header checksum = 157a 
IP:   Source address = 10.21.0.4, blue-servr2 
IP:   Destination address = 192.168.252.6, white-6 
IP:   No options 
IP:   UDP:  ----- UDP Header ----- 
UDP:   
UDP:  Source port = 67 
UDP:  Destination port = 68 (BOOTPC) 
UDP:  Length = 506  
UDP:  Checksum = 5D4C  
UDP:  
DHCP: ----- Dynamic Host Configuration Protocol ----- 
DHCP:  
DHCP: Hardware address type (htype) =  1 (Ethernet (10Mb)) 
DHCP: Hardware address length (hlen) = 6 octets 
DHCP: Relay agent hops = 0 
DHCP: Transaction ID = 0x2e210f17 
DHCP: Time since boot = 0 seconds 
DHCP: Flags = 0x0000 
DHCP: Client address (ciaddr) = 0.0.0.0 
DHCP: Your client address (yiaddr) = 192.168.252.6 
DHCP: Next server address (siaddr) = 10.21.0.2 
DHCP: Relay agent address (giaddr) = 0.0.0.0 
DHCP: Client hardware address (chaddr) = 08:00:20:11:E0:1B 
DHCP:  
DHCP: ----- (Options) field options ----- 
DHCP:  
DHCP: Message type = DHCPACK 
DHCP: DHCP Server Identifier = 10.21.0.4 
DHCP: Subnet Mask = 255.255.255.0 
DHCP: Router at = 192.168.252.1 
DHCP: Broadcast Address = 192.168.252.255 
DHCP: NISPLUS Domainname = dhcp.test 
DHCP: IP Address Lease Time = 3600 seconds 
DHCP: UTC Time Offset = -14400 seconds 
DHCP: RFC868 Time Servers at = 10.21.0.4 
DHCP: DNS Domain Name = sem.example.com 
DHCP: DNS Servers at = 10.21.0.1 
DHCP: Client Hostname = white-6 
DHCP: Vendor-specific Options (166 total octets): 
DHCP:   (02) 04 octets  0x8194AE1B (unprintable) 
DHCP:   (03) 08 octets  "pacific" 
DHCP:   (10) 04 octets  0x8194AE1B (unprintable) 
DHCP:   (11) 08 octets  "pacific" 
DHCP:   (15) 05 octets  "xterm" 
DHCP:   (04) 53 octets  "/export/s2/base.s2s/latest/Solaris_8/Tools/Boot" 
DHCP:   (12) 32 octets  "/export/s2/base.s2s/latest" 
DHCP:   (07) 27 octets  "/platform/sun4u/kernel/unix" 
DHCP:   (08) 07 octets  "EST5EDT" 
  0: 0800 208e f37e 0800 201e 31c1 0800 4500    .. .&oacute;~.. .1...E.
 16: 020e fc9b 4000 fe11 157a ac15 0004 c0a8    ....@....z......           
 32: fc06 0043 0044 01fa 5d4c 0201 0600 2e21    ...C.D..]L.....!           
 48: 0f17 0000 0000 0000 0000 c0a8 fc06 ac15    ................           
 64: 0002 0000 0000 0800 2011 e01b 0000 0000    ........ .......           
 80: 0000 0000 0000 0000 0000 0000 0000 0000    ................           
 96: 0000 0000 0000 0000 0000 0000 0000 0000    ................          
112: 0000 0000 0000 0000 0000 0000 0000 0000    ................          
128: 0000 0000 0000 0000 0000 0000 0000 0000    ................          
144: 0000 0000 0000 0000 0000 0000 0000 0000    ................          
160: 0000 0000 0000 0000 0000 0000 0000 0000    ................          
176: 0000 0000 0000 0000 0000 0000 0000 0000    ................          
192: 0000 0000 0000 0000 0000 0000 0000 0000    ................          
208: 0000 0000 0000 0000 0000 0000 0000 0000    ................          
224: 0000 0000 0000 0000 0000 0000 0000 0000    ................          
240: 0000 0000 0000 0000 0000 0000 0000 0000    ................          
256: 0000 0000 0000 0000 0000 0000 0000 0000    ................          
272: 0000 0000 0000 6382 5363 3501 0536 04ac    ......c.Sc5..6..          
288: 1500 0401 04ff ffff 0003 04c0 a8fc 011c    ................          
304: 04c0 a8fc ff40 0964 6863 702e 7465 7374    .....@.dhcp.test          
320: 3304 0000 0e10 0204 ffff c7c0 0404 ac15    3...............          
336: 0004 0f10 736e 742e 6561 7374 2e73 756e    ....sem.example.          
352: 2e63 6f6d 0604 ac15 0001 0c07 7768 6974    com.........whit          
368: 652d 362b a602 0481 94ae 1b03 0861 746c    e-6+.........pac          
384: 616e 7469 630a 0481 94ae 1b0b 0861 746c    ific.........pac          
400: 616e 7469 630f 0578 7465 726d 0435 2f65    ific...xterm.5/e          
416: 7870 6f72 742f 7332 382f 6261 7365 2e73    xport/sx2/bcvf.s          
432: 3238 735f 776f 732f 6c61 7465 7374 2f53    2xs_btf/latest/S          
448: 6f6c 6172 6973 5f38 2f54 6f6f 6c73 2f42    olaris_x/Tools/B          
464: 6f6f 740c 202f 6578 706f 7274 2f73 3238    oot. /export/s2x          
480: 2f62 6173 652e 7332 3873 5f77 6f73 2f6c    /bcvf.s2xs_btf/l         
496: 6174 6573 7407 1b2f 706c 6174 666f 726d    atest../platform          
512: 2f73 756e 346d 2f6b 6572 6e65 6c2f 756e    /sun4u/kernel/un          
528: 6978 0807 4553 5435 4544 54ff              ix..EST5EDT.  </pre>

<a name="dhcp-trouble-38"></a><h4>Problems With Inaccurate DHCP Configuration Information</h4>
<a name="indexterm-1566"></a><p>If a DHCP client receives inaccurate information in its network configuration information, look
at the DHCP server data. You must examine the option values in
 the macros that the DHCP server processes for this client. Examples of
inaccurate information might be the wrong NIS domain name or router IP address.</p><p>Use the following general guidelines to help you determine the source of
the inaccurate information:</p>
<ul><li><p>Look at the macros defined on the server as described in <a href="dhcp-admin-125.html#dhcp-admin-13">How to View Macros Defined on a DHCP Server (DHCP Manager)</a>. Review the information in <a href="dhcp-overview-14a.html#dhcp-overview-10">Order of Macro Processing</a>, and determine which macros are processed automatically for this client.</p></li>
<li><p>Look at the network table to determine what macro (if any) is assigned to the client's IP address as the configuration macro. See <a href="dhcp-admin-124.html">Working With IP Addresses in the DHCP Service (Task Map)</a> for more information.</p></li>
<li><p>Take note of any options that occur in more than one macro. Make sure the value that you want for an option is set in the last processed macro.</p></li>
<li><p>Edit the appropriate macro or macros to assure that the correct value is passed to the client. See <a href="dhcp-admin-125.html#dhcp-admin-18">Modifying DHCP Macros</a>.</p></li></ul>


<a name="dhcp-trouble-2-1121"></a><h4>Problems With the DHCP Client-Supplied Host Name</h4>
<p>This section describes problems that you might experience with DHCP clients that supply
their own host names to be registered with DNS.</p>

<a name="dhcp-trouble-3-1121"></a><h5>DHCP Client Does Not Request a Host Name</h5>
<p>If your client is not a Solaris DHCP client, consult the client's
documentation to determine how to configure the client to request a host name.
For Solaris DHCP clients, see <a href="eyhuv.html#dhcp-admin-1058sm">How to Enable a Solaris Client to Request a Specific Host Name</a>.</p>

<a name="dhcp-trouble-4"></a><h5>DHCP Client Does Not Get Requested Host Name</h5>
<p>The following list includes describes possible problems a client might have in getting
its requested hostname, and suggested solutions.</p>
<p><b>Problem: </b>Client accepted an offer from a DHCP server that does not issue
DNS updates.</p>
<p><b>Solution: </b>If two DHCP servers are available to the client, the servers should both
be configured to provide DNS updates. See <a href="dhcp-admin-51.html#dhcp-admin-202">Enabling Dynamic DNS Updates by a DHCP Server</a> for information about configuring the
DHCP server and the DNS server.
<p>To determine whether the DHCP server is configured to provide DNS updates:</p>
<ol><li><p>Determine the IP address of the client's DHCP server. On the client system, use <tt>snoop</tt> or another application for capturing network packets. See <a href="#dhcp-trouble-proc-21">How to Use <tt>snoop</tt> to Monitor DHCP Network Traffic</a>, and perform the procedure on the client instead of the server. In the <tt>snoop</tt> output, look for the DHCP Server Identifier to get the IP address of the server.</p></li>
<li><p>Log in to the DHCP server system to verify that the system is configured to make DNS updates. Type the following command as superuser:</p><p><tt><b>dhcpconfig -P</b></tt></p><p>If <tt>UPDATE_TIMEOUT</tt> is listed as a server parameter, the DHCP server is configured to make DNS updates.</p></li>
<li><p>On the DNS server, look at the <tt>/etc/named.conf</tt> file. Find the <tt>allow-update</tt> keyword in the <tt>zone</tt> section of the appropriate domain. If the server allows DNS updates by the DHCP server, the DHCP server's IP address is listed in the <tt>allow-update</tt> keyword.</p></li></ol>
</p>
<p><b>Problem: </b>Client is using <tt>FQDN</tt> option to specify host name. Solaris DHCP does not
currently support the <tt>FQDN</tt> option because the option is not officially in the
DHCP protocol.</p>
<p><b>Solution: </b>On the server, use <tt>snoop</tt> or another application for capturing network packets. See
<a href="#dhcp-trouble-proc-21">How to Use <tt>snoop</tt> to Monitor DHCP Network Traffic</a>. In the <tt>snoop</tt> output, look for the <tt>FQDN</tt> option in a packet
from the client.
<p>Configure the client to specify host name using <tt>Hostname</tt> option. <tt>Hostname</tt> is
option code 12. Refer to client documentation for instructions.</p>
<p>For a Solaris client, see <a href="eyhuv.html#dhcp-admin-1058sm">How to Enable a Solaris Client to Request a Specific Host Name</a></p></p>
<p><b>Problem: </b>DHCP server that makes an address offer to the client  does
not know the client's DNS domain.</p>
<p><b>Solution: </b>On the DHCP server look for the <tt>DNSdmain</tt> option with a valid value.
Set the <tt>DNSdmain</tt> option to the correct DNS domain name in a macro
that is processed for this client. <tt>DNSdmain</tt> is usually contained in the network
macro. See <a href="dhcp-admin-125.html#dhcp-admin-18">Modifying DHCP Macros</a> for information about changing values of options in a
macro.</p>
<p><b>Problem: </b>The host name requested by client corresponds to an IP address that is
not managed by the DHCP server. The Solaris DHCP server does not
perform DNS updates for IP addresses that the server does not manage.</p>
<p><b>Solution: </b>Check <tt>syslog</tt> for one of the following messages from the DHCP server:
<ul><li><p><tt>There is no</tt> <i>n.n.n.n</i> <tt>dhcp-network table for DHCP client's network.</tt></p></li>
<li><p><tt>DHCP network record for</tt> <i>n.n.n.n</i> <tt>is unavailable, ignoring request.</tt></p></li></ul>

<p>Configure the client to request a different name. See <a href="eyhuv.html#dhcp-admin-1058sm">How to Enable a Solaris Client to Request a Specific Host Name</a>. Choose a
name that is mapped to an address managed by the DHCP server. You
can see address mappings in DHCP Manager's Addresses tab. Alternatively, choose an address
that is not mapped to any IP address.</p></p>
<p><b>Problem: </b>The host name requested by client corresponds to an IP address that is
currently not available for use. The address might be in use, leased
to another client, or under offer to another client.</p>
<p><b>Solution: </b>Check <tt>syslog</tt> for the following message from the DHCP server: <tt>ICMP ECHO reply to OFFER candidate:</tt> <i>n.n.n.n</i>.
<p>Configure the client to choose a name corresponding to a different IP address.
Alternatively, reclaim the address from the client that uses the address.</p></p>
<p><b>Problem: </b>DNS server is not configured to accept updates from the DHCP server.</p>
<p><b>Solution: </b>Examine the <tt>/etc/named.conf</tt> file on the DNS server. Look for the DHCP server's
IP address with the <tt>allow-update</tt> keyword in the appropriate <tt>zone</tt> section for the
DHCP server's domain. If the IP address is not present, the DNS server
is not configured to accept updates from the DHCP server.
<p>See <a href="dhcp-admin-51.html#dhcp-admin-303">How to Enable Dynamic DNS Updating for DHCP Clients</a> for information about configuring the DNS server.</p>
<p>If the DHCP server has multiple interfaces, you might need to configure the
DNS server to accept updates from all of the DHCP server's addresses. Enable
debugging on the DNS server to see whether the updates are reaching
the DNS server. If the DNS server received update requests, examine the debugging
mode output to determine why the updates did not occur. See the <tt>in.named</tt>.1M man
page for information about DNS debugging mode.</p></p>
<p><b>Problem: </b>DNS updates might not have completed in the allotted time. DHCP servers do
not return host names to clients if the DNS updates have not
completed by the configured time  limit. However, attempts to complete the DNS
updates continue.</p>
<p><b>Solution: </b>Use the <tt>nslookup</tt> command to determine whether the updates completed successfully. See the
<a href="http://docs.sun.com/doc/819-2240/nslookup-1m?a=view"><tt>nslookup</tt>(1M)</a> man page.
<p>For example, suppose the DNS domain is <tt>hills.example.org</tt>, and the DNS server's
IP address is <tt>10.76.178.11</tt>. The host name that the client wants to register
is <tt>cathedral</tt>. You could use the following command to determine if <tt>cathedral</tt> has
been registered with that DNS server:</p>
<p><tt>nslookup cathedral.hills.example.org 10.76.178.11</tt></p>
<p>If the updates completed successfully, but not in the allotted time, you need
to increase the time out value. See <a href="dhcp-admin-51.html#dhcp-admin-303">How to Enable Dynamic DNS Updating for DHCP Clients</a>. In this procedure, you should
increase the number of seconds to wait for a response from the
DNS server before timing out.</p></p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="dhcp-trouble-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="dhcp-ref-4.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

