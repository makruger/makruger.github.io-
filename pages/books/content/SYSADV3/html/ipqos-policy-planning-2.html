<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Creating IPQoS Configuration Files for Web Servers - System Administration Guide: IP Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: IP Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ipqos-policy-planning-9.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ipqos-policy-planning-5.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="iptm-1.html">Part&nbsp;I&nbsp;TCP/IP Administration</a></p>
<p class="toc level2"><a href="ipov-1.html">1.&nbsp;&nbsp;Solaris TCPIP Protocol Suite (Overview)</a></p>
<p class="toc level2"><a href="ipplan-1.html">2.&nbsp;&nbsp;Planning an IPv4 Addressing Scheme (Tasks</a></p>
<p class="toc level2"><a href="ipv6-overview-7.html">3.&nbsp;&nbsp;Planning an IPv6 Addressing Scheme (Overview)</a></p>
<p class="toc level2"><a href="ipv6-planning-1.html">4.&nbsp;&nbsp;Planning an IPv6 Network (Tasks)</a></p>
<p class="toc level2"><a href="ipconfig-1.html">5.&nbsp;&nbsp;Configuring TCP/IP Network Services and IPv4 Addressing (Tasks)</a></p>
<p class="toc level2"><a href="fwawf.html">6.&nbsp;&nbsp;Administering Network Interfaces (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-config-tasks-1.html">7.&nbsp;&nbsp;Enabling IPv6 on a Network (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-admintasks-1.html">8.&nbsp;&nbsp;Administering a TCP/IP Network (Tasks)</a></p>
<p class="toc level2"><a href="gegel.html">9.&nbsp;&nbsp;Troubleshooting Network Problems (Tasks)</a></p>
<p class="toc level2"><a href="ipref-8.html">10.&nbsp;&nbsp;TCP/IP and IPv4 in Depth (Reference)</a></p>
<p class="toc level2"><a href="ipv6-ref-76.html">11.&nbsp;&nbsp;IPv6 in Depth (Reference)</a></p>
<p class="toc level1 tocsp"><a href="dhcptm-1.html">Part&nbsp;II&nbsp;DHCP</a></p>
<p class="toc level2"><a href="dhcp-overview-1.html">12.&nbsp;&nbsp;About Solaris DHCP (Overview)</a></p>
<p class="toc level2"><a href="chap2-26.html">13.&nbsp;&nbsp;Planning for DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="chapter3-20.html">14.&nbsp;&nbsp;Configuring the DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="dhcp-admin-9.html">15.&nbsp;&nbsp;Administering DHCP (Tasks)</a></p>
<p class="toc level2"><a href="eyatl.html">16.&nbsp;&nbsp;Configuring and Administering  DHCP Clients</a></p>
<p class="toc level2"><a href="dhcp-trouble-1.html">17.&nbsp;&nbsp;Troubleshooting DHCP (Reference)</a></p>
<p class="toc level2"><a href="dhcp-ref-4.html">18.&nbsp;&nbsp;DHCP Commands and Files (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipsectm-1.html">Part&nbsp;III&nbsp;IP Security</a></p>
<p class="toc level2"><a href="ipsec-ov-1.html">19.&nbsp;&nbsp;IP Security Architecture (Overview)</a></p>
<p class="toc level2"><a href="ipsec-mgtasks-1.html">20.&nbsp;&nbsp;Configuring IPsec (Tasks)</a></p>
<p class="toc level2"><a href="ipsecref-1.html">21.&nbsp;&nbsp;IP Security Architecture (Reference)</a></p>
<p class="toc level2"><a href="ike-1.html">22.&nbsp;&nbsp;Internet Key Exchange (Overview)</a></p>
<p class="toc level2"><a href="ike-task-1.html">23.&nbsp;&nbsp;Configuring IKE (Tasks)</a></p>
<p class="toc level2"><a href="ikeref-1.html">24.&nbsp;&nbsp;Internet Key Exchange (Reference)</a></p>
<p class="toc level2"><a href="eupsq.html">25.&nbsp;&nbsp;Solaris IP Filter (Overview)</a></p>
<p class="toc level2"><a href="ipfilter-admin-1.html">26.&nbsp;&nbsp;Solaris IP Filter (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="miptm-1.html">Part&nbsp;IV&nbsp;Mobile IP</a></p>
<p class="toc level2"><a href="mipoverview-1.html">27.&nbsp;&nbsp;Mobile IP (Overview)</a></p>
<p class="toc level2"><a href="mipimplementing-1.html">28.&nbsp;&nbsp;Administering Mobile IP (Tasks)</a></p>
<p class="toc level2"><a href="mipmanaging-22.html">29.&nbsp;&nbsp;Mobile IP Files and Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipmptm-1.html">Part&nbsp;V&nbsp;IPMP</a></p>
<p class="toc level2"><a href="mpoverview.html">30.&nbsp;&nbsp;Introducing IPMP (Overview)</a></p>
<p class="toc level2"><a href="deploynetmult-56.html">31.&nbsp;&nbsp;Administering IPMP (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ipqostm-1.html">Part&nbsp;VI&nbsp;IP Quality of Service (IPQoS)</a></p>
<p class="toc level2"><a href="ipqos-intro-1.html">32.&nbsp;&nbsp;Introducing IPQoS (Overview)</a></p>
<p class="toc level2"><a href="ipqos-config-planning-1.html">33.&nbsp;&nbsp;Planning for an IPQoS-Enabled Network (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-policy-planning-1.html">34.&nbsp;&nbsp;Creating the IPQoS Configuration File (Tasks)</a></p>
<p class="toc level3"><a href="ipqos-policy-planning-10.html">Defining a QoS Policy in the IPQoS Configuration File (Task Map)</a></p>
<p class="toc level3"><a href="ipqos-policy-planning-9.html">Tools for Creating a QoS Policy</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Creating IPQoS Configuration Files for Web Servers</a></p>
<p class="toc level4"><a href="#ipqos-policy-planning-32">How to Create the IPQoS Configuration File and Define Traffic Classes</a></p>
<p class="toc level4"><a href="#ipqos-policy-planning-33">How to Define Filters in the IPQoS Configuration File</a></p>
<p class="toc level4"><a href="#ipqos-policy-planning-102">How to Define Traffic Forwarding in the IPQoS Configuration File</a></p>
<p class="toc level4"><a href="#ipqos-policy-planning-110">How to Enable Accounting for a Class in the IPQoS Configuration File</a></p>
<p class="toc level4"><a href="#ipqos-policy-planning-114">How to Create an IPQoS Configuration File for a Best-Effort Web Server</a></p>
</div>
<p class="toc level3 tocsp"><a href="ipqos-policy-planning-5.html">Creating an IPQoS Configuration File for an Application Server</a></p>
<p class="toc level4"><a href="ipqos-policy-planning-5.html#ipqos-policy-planning-67">How to Configure the IPQoS Configuration File for an Application Server</a></p>
<p class="toc level4"><a href="ipqos-policy-planning-5.html#ipqos-policy-planning-140">How to Configure Forwarding for Application Traffic in the IPQoS Configuration File</a></p>
<p class="toc level4"><a href="ipqos-policy-planning-5.html#ipqos-policy-planning-144">How to Configure Flow Control in the IPQoS Configuration File</a></p>
<p class="toc level3 tocsp"><a href="ipqos-policy-planning-137.html">Providing Differentiated Services on a Router</a></p>
<p class="toc level4"><a href="ipqos-policy-planning-137.html#ipqos-policy-planning-136">How to Configure a Router on an IPQoS-Enabled Network</a></p>
<p class="toc level2 tocsp"><a href="ipqos-isp-setup-1.html">35.&nbsp;&nbsp;Starting and Maintaining IPQoS (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-accounting-1.html">36.&nbsp;&nbsp;Using Flow Accounting and Statistics Gathering (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-reference-1.html">37.&nbsp;&nbsp;IPQoS in Detail (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="ipqos-policy-planning-2"></a><h3>Creating IPQoS Configuration Files for Web Servers</h3>
<p><a name="indexterm-3091"></a>This section introduces the IPQoS configuration file  by showing how to create
a configuration for a premium web server. The section then shows how
to configure a completely different level of service in another configuration file for
a server that hosts personal web sites. Both servers are part of the
network example that is shown in <a href="ipqos-config-planning-13.html#ipqos-config-planning-fig-44">Figure&nbsp;33-4</a>.</p><p><a name="indexterm-3092"></a>The following configuration file defines IPQoS activities for the <tt>Goldweb</tt> server. This
server hosts the web site for Goldco, the company that has purchased a
premium SLA.</p><a name="ipqos-policy-planning-ex-93"></a>Example&nbsp;34-1 Sample IPQoS Configuration File for a Premium Web Server<pre>fmt_version 1.0

action {
    module ipgpc
    name ipgpc.classify
    params {
        global_stats TRUE
    }
    class {
        name goldweb
        next_action markAF11
        enable_stats FALSE
    }
    class {
        name video
        next_action markEF
        enable_stats FALSE
    }
    filter {
        name webout
        sport 80
        direction LOCAL_OUT
        class goldweb
    }
    filter {
        name videoout
        sport videosrv
        direction LOCAL_OUT
        class video
    }
}
action {
    module dscpmk
    name markAF11
    params {
        global_stats FALSE
        dscp_map{0-63:10}
        next_action continue
    }
}
action {
    module dscpmk
    name markEF
    params {
        global_stats TRUE
        dscp_map{0-63:46}
        next_action acct
    }
}
action {
    module flowacct
    name acct
    params {
        enable_stats TRUE
        timer 10000
        timeout 10000
        max_limit 2048
    }
}</pre><p><a name="indexterm-3093"></a><a name="indexterm-3094"></a>The following configuration file defines IPQoS activities on <tt>Userweb</tt>. This server hosts
web sites for individuals with low-priced, or <b>best-effort</b>, SLAs. This level of
service guarantees the best service that can be delivered to best-effort customers after
the IPQoS system handles traffic from customers with more expensive SLAs.</p><a name="ipqos-policy-planning-ex-95"></a>Example&nbsp;34-2 Sample Configuration for a Best-Effort Web Server<pre>fmt_version 1.0

action {
    module ipgpc
    name ipgpc.classify
    params {
        global_stats TRUE
    }
    class {
        name Userweb
        next_action markAF12
        enable_stats FALSE
    }
    filter {
        name webout
        sport 80
        direction LOCAL_OUT
        class Userweb
   }
}
action {
    module dscpmk
    name markAF12
    params {
        global_stats FALSE
        dscp_map{0-63:12}
        next_action continue
    }
}</pre>

<a name="ipqos-policy-planning-32"></a><h4>How to Create the IPQoS Configuration File and Define Traffic Classes</h4><p>You can create your first IPQoS configuration file in whatever directory is easiest
for you to maintain. The tasks in this chapter use the directory
<tt>/var/ipqos</tt> as the location for IPQoS configuration files. The next procedure builds the
initial segment of the IPQoS configuration file that is introduced in <a href="#ipqos-policy-planning-ex-93">Example&nbsp;34-1</a>.
</p>
<hr><p><b>Note - </b>As you create the IPQoS configuration file, be very careful to start
and end each <tt>action</tt> statement and clause with curly braces ({ }). For an
example of the use of braces, see <a href="#ipqos-policy-planning-ex-93">Example&nbsp;34-1</a>.</p>
<hr>
<ol>
<li><a name="ipqos-policy-planning-step-24"></a><b>Log in to the premium web server, and create a new IPQoS configuration
file with a <tt>.qos</tt> extension.</b><p>Every IPQoS configuration file must start with the version number <tt>fmt_version 1.0</tt> as
its first uncommented line. </p></li>
<li><a name="ipqos-policy-planning-step-154"></a><b><a name="indexterm-3095"></a><a name="indexterm-3096"></a>Follow the opening parameter with  the initial <tt>action</tt> statement, which configures the
generic IP classifier <tt>ipgpc</tt>. </b><p>This initial action begins the tree of <tt>action</tt> statements that compose the IPQoS
configuration file. For example, the <tt>/var/ipqos/Goldweb.qos</tt> file begins with the initial <tt>action</tt> statement
to call the <tt>ipgpc</tt> classifier. </p><pre><tt><b>fmt_version 1.0 action { module ipgpc name ipgpc.classify</b></tt></pre><dl><dt><tt>fmt_version 1.0</tt></dt>
<dd><p>Begins the IPQoS configuration file.</p></dd>
<dt><tt>action {</tt></dt>
<dd><p>Begins the action statement.</p></dd>
<dt><tt>module ipgpc</tt></dt>
<dd><p>Configures the <tt>ipgpc</tt> classifier as the first action in the configuration file.</p></dd>
<dt><tt>name ipgpc.classify</tt></dt>
<dd><p>Defines the name of the classifier <tt>action</tt> statement, which must always be <tt>ipgpc.classify</tt>.</p></dd>
</dl>
<p>For detailed syntactical information about <tt>action</tt> statements, refer to <a href="ipqos-reference-22.html#ipqos-reference-240"><tt>action</tt> Statement</a> and the <tt>ipqosconf</tt>(1M)
man page.</p></li>
<li><a name="ipqos-policy-setup-step-94"></a><b><a name="indexterm-3097"></a>Add a <tt>params</tt> clause with the statistics parameter <tt>global_stats</tt>. </b><pre><tt><b>params { global_stats TRUE }</b></tt></pre><p><a name="indexterm-3098"></a>The parameter <tt>global_stats TRUE</tt> in the<tt>ipgpc.classify</tt> statement enables statistics gathering for that action.
<tt>global_stats TRUE</tt> also enables per-class statistics gathering wherever a class clause definition specifies <tt>enable_stats TRUE</tt>.</p><p>Turning on statistics impacts performance. You might want to gather statistics on a
new IPQoS configuration file to verify that IPQoS works properly. Later, you can
turn off statistics collection by changing the argument to <tt>global_stats</tt> to <tt>FALSE</tt>.</p><p>Global statistics are but one type of parameter you can define in a
<tt>params</tt> clause. For syntactical and other details about <tt>params</tt> clauses, refer to
<a href="ipqos-reference-22.html#ipqos-reference-29"><tt>params</tt> Clause</a> and the <a href="http://docs.sun.com/doc/819-2240/ipqosconf-1m?a=view"><tt>ipqosconf</tt>(1M)</a> man page.</p></li>
<li><a name="ipqos-policy-planning-step-18"></a><b>Define a class that identifies traffic that is bound for the premium server.</b><pre><tt><b>class { name goldweb next_action markAF11 enable_stats FALSE }</b></tt></pre><p><a name="indexterm-3099"></a><a name="indexterm-3100"></a>This statement is called a <b>class clause</b>. A <tt>class</tt> clause has the following
contents.</p><dl><dt>name goldweb</dt>
<dd><p>Creates the class <tt>goldweb</tt> to identify traffic that is bound for the <tt>Goldweb</tt> server.</p></dd>
<dt>next_action markAF11</dt>
<dd><p>Instructs the <tt>ipgpc</tt> module to pass packets of the <tt>goldweb</tt> class to the <tt>markAF11</tt> action statement. The <tt>markAF11</tt> action statement calls the <tt>dscpmk</tt> marker.</p></dd>
<dt>enable_stats FALSE</dt>
<dd><p>Enables statistics taking for the <tt>goldweb</tt> class. However, because the value of <tt>enable_stats</tt> is <tt>FALSE</tt>, statistics for this class are not turned on.</p></dd>
</dl>
<p>For detailed information about the syntax of the <tt>class</tt> clause, see <a href="ipqos-reference-22.html#ipqos-reference-270"><tt>class</tt> Clause</a> and
the <tt>ipqosconf</tt>(1M) man page.</p></li>
<li><a name="ipqos-policy-planning-step-98"></a><b>Define a class that identifies an application that must have highest-priority forwarding.</b><pre><tt><b>class { name video next_action markEF enable_stats FALSE }</b></tt></pre><dl><dt><tt>name video</tt></dt>
<dd><p>Creates the class <tt>video</tt> to identify streaming video traffic that is outgoing from the <tt>Goldweb</tt> server.</p></dd>
<dt><tt>next_action markEF</tt></dt>
<dd><p>Instructs the <tt>ipgpc</tt> module to pass packets of the <tt>video</tt> class to the <tt>markEF</tt> statement after <tt>ipgpc</tt> completes processing. The <tt>markEF</tt> statement calls the <tt>dscpmk</tt> marker.</p></dd>
<dt><tt>enable_stats FALSE</tt></dt>
<dd><p>Enables statistics collection for the <tt>video</tt> class. However, because the value of <tt>enable_stats</tt> is <tt>FALSE</tt>, statistics collection for this class is not turned on.</p></dd>
</dl>
</li></ol><h6>See Also</h6>
<ul><li><p>To define filters for the class you just created, refer to <a href="#ipqos-policy-planning-33">How to Define Filters in the IPQoS Configuration File</a>.</p></li>
<li><p>To create another class clause for the configuration file, refer to <a href="#ipqos-policy-planning-32">How to Create the IPQoS Configuration File and Define Traffic Classes</a>.</p></li></ul>


<a name="ipqos-policy-planning-33"></a><h4>How to Define Filters in the IPQoS Configuration File</h4><p>The next procedure shows how to define filters for a class in
the IPQoS configuration file. </p><h6>Before You Begin</h6><p>The procedure assumes that you have already started file creation and have
defined classes. The steps continue building the <tt>/var/ipqos/Goldweb.qos</tt> file that is created in <a href="#ipqos-policy-planning-32">How to Create the IPQoS Configuration File and Define Traffic Classes</a>.</p>
<hr><p><b>Note - </b>As you create the IPQoS configuration file, be very careful to start
and end each <tt>class</tt> clause and each <tt>filter</tt> clause with curly braces ({ }).
For an example of the use of braces, use <a href="#ipqos-policy-planning-ex-93">Example&nbsp;34-1</a>.</p>
<hr>
<ol>
<li><a name="ipqos-policy-planning-step-25"></a><b>Open the IPQoS configuration file, and locate the end of the last class
that you defined.</b><p>For example, on the IPQoS-enabled server <tt>Goldweb</tt>, you would start after the following
<tt>class</tt> clause in <tt>/var/ipqos/Goldweb.qos</tt>:</p><pre>class {
        name video
        next_action markEF
        enable_stats FALSE
    }</pre></li>
<li><a name="ipqos-policy-planning-step-99"></a><b><a name="indexterm-3101"></a><a name="indexterm-3102"></a>Define a <tt>filter</tt> clause to select outgoing traffic from the IPQoS system.</b><pre><tt><b> filter { name webout sport 80 direction LOCAL_OUT class goldweb }</b></tt></pre><dl><dt><tt>name webout</tt></dt>
<dd><p>Gives the name <tt>webout</tt> to the filter.</p></dd>
<dt><tt>sport 80</tt></dt>
<dd><p>Selects traffic with a source port of 80, the well-known port for HTTP (web) traffic.</p></dd>
<dt><tt>direction LOCAL_OUT</tt></dt>
<dd><p>Further selects traffic that is outgoing from the local system.</p></dd>
<dt><tt>class goldweb</tt></dt>
<dd><p>Identifies the class to which the filter belongs, in this instance, class <tt>goldweb</tt>.</p></dd>
</dl>
<p>For syntactical and detailed information about the <tt>filter</tt> clause in the IPQoS configuration
file, refer to <a href="ipqos-reference-22.html#ipqos-reference-28"><tt>filter</tt> Clause</a>.</p></li>
<li><a name="ipqos-policy-planning-step-100"></a><b>Define a <tt>filter</tt> clause to select streaming video traffic on the IPQoS system.</b><pre><tt><b> filter { name videoout sport videosrv direction LOCAL_OUT class video }</b></tt></pre><dl><dt>name videoout</dt>
<dd><p>Gives the name <tt>videoout</tt> to the filter.</p></dd>
<dt><tt>sport videosrv</tt></dt>
<dd><p>Selects traffic with a source port of <tt>videosrv</tt>, a previously defined port for the streaming video application on this system.</p></dd>
<dt><tt>direction LOCAL_OUT</tt></dt>
<dd><p>Further selects traffic that is outgoing from the local system.</p></dd>
<dt><tt>class video</tt></dt>
<dd><p>Identifies the class to which the filter belongs, in this instance, class <tt>video</tt>.</p></dd>
</dl>
</li></ol><h6>See Also</h6>
<ul><li><p>To define forwarding behaviors for the marker modules, refer to <a href="#ipqos-policy-planning-102">How to Define Traffic Forwarding in the IPQoS Configuration File</a>.</p></li>
<li><p>To define flow-control parameters for the metering modules, refer to <a href="ipqos-policy-planning-5.html#ipqos-policy-planning-144">How to Configure Flow Control in the IPQoS Configuration File</a>.</p></li>
<li><p>To activate the IPQoS configuration file, refer to <a href="ipqos-maint-4.html#ipqos-maint-5">How to Apply a New Configuration to the IPQoS Kernel Modules</a>.</p></li>
<li><p>To define additional filters, refer to <a href="#ipqos-policy-planning-33">How to Define Filters in the IPQoS Configuration File</a>.</p></li>
<li><p>To create classes for traffic flows from applications, refer to <a href="ipqos-policy-planning-5.html#ipqos-policy-planning-67">How to Configure the IPQoS Configuration File for an Application Server</a>.</p></li></ul>


<a name="ipqos-policy-planning-102"></a><h4>How to Define Traffic Forwarding in the IPQoS Configuration File</h4><p>The next procedure shows how to define traffic forwarding by adding per-hop behaviors
for a class into the IPQoS configuration file. </p><h6>Before You Begin</h6><p>The procedure assumes that you have an existing IPQoS configuration file with already
defined classes and already defined filters. The steps continue building the <tt>/var/ipqos/Goldweb.qos</tt>
file from <a href="#ipqos-policy-planning-ex-93">Example&nbsp;34-1</a>.</p>
<hr><p><b>Note - </b>The procedure shows how to configure traffic forwarding by using the <tt>dscpmk</tt>
marker module. For information about traffic forwarding on VLAN systems by using the
<tt>dlclosmk</tt> marker, refer to <a href="ipqos-reference-2.html#ipqos-reference-110">Using the <tt>dlcosmk</tt> Marker With VLAN Devices</a>.</p>
<hr>
<ol>
<li><a name="ipqos-policy-planning-step-107"></a><b>Open the IPQoS configuration file, and locate the end of the last filter
you defined.</b><p>For example, on the IPQoS-enabled server <tt>Goldweb,</tt> you would start after the following
<tt>filter</tt> clause in <tt>/var/ipqos/Goldweb.qos</tt>:</p><pre>filter {
        name videoout
        sport videosrv
        direction LOCAL_OUT
        class video
    }
}</pre><p>Note that this <tt>filter</tt> clause is at the end of the <tt>ipgpc</tt>
classifier <tt>action</tt> statement. Therefore, you need a closing brace to terminate the filter
and a second closing brace to terminate the <tt>action</tt> statement.</p></li>
<li><a name="ipqos-policy-planning-step-104"></a><b><a name="indexterm-3103"></a><a name="indexterm-3104"></a>Invoke the marker with the following <tt>action</tt> statement.</b><pre><tt><b>action { module dscpmk name markAF11</b></tt></pre><dl><dt>module dscpmk</dt>
<dd><p>Calls the marker module <tt>dscpmk</tt>.</p></dd>
<dt>name markAF11</dt>
<dd><p>Gives the name <tt>markAF11</tt> to the <tt>action</tt> statement.</p></dd>
</dl>
<p>The previously defined class <tt>goldweb</tt> includes a <tt>next_action markAF11</tt> statement. This statement sends
traffic flows to the <tt>markAF11</tt> action statement after the classifier concludes processing.</p></li>
<li><a name="ipqos-policy-planning-step-105"></a><b><a name="indexterm-3105"></a><a name="indexterm-3106"></a>Define actions for the marker to take on the traffic flow.</b><pre><tt><b> params { global_stats FALSE dscp_map{0-63:10} next_action continue } }</b></tt></pre><dl><dt>global_stats FALSE</dt>
<dd><p>Enables statistics collection for the <tt>markAF11</tt> marker <tt>action</tt> statement. However, because the value of <tt>enable_stats</tt> is <tt>FALSE</tt>, statistics are not collected.</p></dd>
<dt>dscp_map{0&ndash;63:10}</dt>
<dd><p>Assigns a DSCP of <tt>10</tt> to the packet headers of the traffic class <tt>goldweb</tt>, which is currently being processed by the marker.</p></dd>
<dt>next_action continue</dt>
<dd><p>Indicates that no further processing is required on packets of the traffic class <tt>goldweb</tt>, and that these packets can return to the network stream.</p></dd>
</dl>
<p><a name="indexterm-3107"></a>The DSCP of <tt>10</tt> instructs the marker to set all entries in the
<tt>dscp</tt> map to the decimal value 10 (binary 001010). This codepoint indicates that
packets of the <tt>goldweb</tt> traffic class are subject to the AF11 per-hop behavior.
AF11 guarantees that all packets with the DSCP of <tt>10</tt> receive a
low-drop, high-priority service. Thus, outgoing traffic for premium customers on <tt>Goldweb</tt> is given
the highest priority that is available for the Assured Forwarding (AF) PHB. For
a table of possible DSCPs for AF, refer to <a href="ipqos-reference-2.html#ipqos-reference-tbl-16">Table&nbsp;37-2</a>.</p></li>
<li><a name="ipqos-policy-planning-step-108"></a><b>Start another marker <tt>action</tt> statement.</b><pre><tt><b>action { module dscpmk name markEF</b></tt>    </pre><dl><dt>module dscpmk</dt>
<dd><p>Calls the marker module <tt>dscpmk</tt>.</p></dd>
<dt><tt>name markEF</tt></dt>
<dd><p>Gives the name <tt>markEF</tt> to the <tt>action</tt> statement.</p></dd>
</dl>
</li>
<li><a name="ipqos-policy-planning-step-109"></a><b>Define actions for the marker to take on the traffic flow.</b><pre><tt><b> params { global_stats TRUE dscp_map{0-63:46} next_action acct } }</b></tt></pre><dl><dt><tt>global_stats TRUE</tt></dt>
<dd><p>Enables statistics collection on class <tt>video</tt>, which selects streaming video packets.</p></dd>
<dt><tt>dscp_map{0&ndash;63:46}</tt></dt>
<dd><p>Assigns a DSCP of <tt>46</tt> to the packet headers of the traffic class <tt>video</tt>, which is currently being processed by the marker. </p></dd>
<dt><tt>next_action acct</tt></dt>
<dd><p>Instructs the <tt>dscpmk</tt> module to pass packets of the class <tt>video</tt> to the <tt>acct</tt> <tt>action</tt> statement after <tt>dscpmk</tt> completes processing. The <tt>acct</tt> <tt>action</tt> statement invokes the <tt>flowacct</tt> module.</p></dd>
</dl>
<p><a name="indexterm-3108"></a>The DSCP of <tt>46</tt> instructs the <tt>dscpmk</tt> module to set all entries in
the <tt>dscp</tt> map to the decimal value 46 (binary 101110) in the DS
field. This codepoint indicates that packets of the <tt>video</tt> traffic class are
subject to the Expedited Forwarding (EF) per-hop behavior. </p>
<hr><p><b>Note - </b>The recommended codepoint for EF is 46 (binary 101110). Other DSCPs assign AF
PHBs to a packet.</p>
<hr>
<p>The EF PHB guarantees that packets with the DSCP of <tt>46</tt> are given
the highest precedence by IPQoS and Diffserv-aware systems. Streaming applications require highest-priority service,
which is the rationale behind assigning to streaming applications the EF PHBs in
the QoS policy. For more details about the expedited forwarding PHB, refer to
<a href="ipqos-reference-2.html#ipqos-reference-140">Expedited Forwarding (EF) PHB</a>.</p></li>
<li><a name="ipqos-policy-planning-step-113"></a><b>Add the DSCPs that you have just created to the appropriate files on
the Diffserv router. </b><p>For more information, refer to <a href="ipqos-policy-planning-137.html#ipqos-policy-planning-136">How to Configure a Router on an IPQoS-Enabled Network</a>.</p></li></ol><h6>See Also</h6>
<ul><li><p>To start gathering flow-accounting statistics on traffic flows, refer to <a href="#ipqos-policy-planning-110">How to Enable Accounting for a Class in the IPQoS Configuration File</a>.</p></li>
<li><p>To define forwarding behaviors for the marker modules, refer to <a href="#ipqos-policy-planning-102">How to Define Traffic Forwarding in the IPQoS Configuration File</a>.</p></li>
<li><p>To define flow-control parameters for the metering modules, refer to <a href="ipqos-policy-planning-5.html#ipqos-policy-planning-144">How to Configure Flow Control in the IPQoS Configuration File</a>.</p></li>
<li><p>To activate the IPQoS configuration file, refer to <a href="ipqos-maint-4.html#ipqos-maint-5">How to Apply a New Configuration to the IPQoS Kernel Modules</a>.</p></li>
<li><p>To define additional filters, refer to <a href="#ipqos-policy-planning-33">How to Define Filters in the IPQoS Configuration File</a>.</p></li>
<li><p>To create classes for traffic flows from applications, refer to <a href="ipqos-policy-planning-5.html#ipqos-policy-planning-67">How to Configure the IPQoS Configuration File for an Application Server</a>.</p></li></ul>


<a name="ipqos-policy-planning-110"></a><h4>How to Enable Accounting for a Class in the IPQoS Configuration File</h4><p>The next procedure shows how to enable accounting on a traffic class
in the IPQoS configuration file. The procedure shows how to define flow accounting
for the <tt>video</tt> class, which is introduced in <a href="#ipqos-policy-planning-32">How to Create the IPQoS Configuration File and Define Traffic Classes</a>. This class selects streaming
video traffic, which must be billed as part of a premium customer's SLA.
</p><h6>Before You Begin</h6><p>The procedure assumes that you have an existing IPQoS configuration file with already
defined classes, filters, metering actions, if appropriate, and marking actions, if appropriate. The
steps continue building the <tt>/var/ipqos/Goldweb.qos</tt> file from <a href="#ipqos-policy-planning-ex-93">Example&nbsp;34-1</a>.</p><ol>
<li><a name="ipqos-policy-planning-step-115"></a><b>Open the IPQoS configuration file, and locate the end of the last <tt>action</tt>
statement you defined.</b><p>For example, on the IPQoS-enabled server <tt>Goldweb,</tt> you would start after the following
<tt>markEF</tt> <tt>action</tt> statement in <tt>/var/ipqos/Goldweb.qos</tt>.</p><pre>action {
    module dscpmk
    name markEF
    params {
        global_stats TRUE
        dscp_map{0-63:46}
        next_action acct
    }
}</pre></li>
<li><a name="ipqos-policy-planning-step-116"></a><b><a name="indexterm-3109"></a>Begin an <tt>action</tt> statement that calls flow accounting.</b><pre><tt><b>action { module flowacct name acct</b></tt></pre><dl><dt><tt>module flowacct</tt></dt>
<dd><p>Invokes the flow-accounting module <tt>flowacct</tt>.</p></dd>
<dt><tt>name acct</tt></dt>
<dd><p>Gives the name <tt>acct</tt> to the <tt>action</tt> statement</p></dd>
</dl>
</li>
<li><a name="ipqos-policy-planning-step-112"></a><b><a name="indexterm-3110"></a>Define a <tt>params</tt> clause to control accounting on the traffic class.</b><pre><tt><b>params { global_stats TRUE timer 10000 timeout 10000 max_limit 2048 next_action continue </b></tt>  }
}</pre><dl><dt><tt>global_stats TRUE</tt></dt>
<dd><p>Enables statistics collection on the class <tt>video</tt>, which selects streaming video packets.</p></dd>
<dt><tt>timer 10000</tt></dt>
<dd><p>Specifies the duration of the interval, in milliseconds, when the flow table is scanned for timed-out flows. In this parameter, that interval is 10000 milliseconds. </p></dd>
<dt><tt>timeout 10000</tt></dt>
<dd><p>Specifies the minimum interval time out value. A flow &ldquo;times out&rdquo; when packets for the flow are not seen during a time out interval. In this parameter, packets time out after 10000 milliseconds.</p></dd>
<dt><tt>max_limit 2048</tt></dt>
<dd><p>Sets the maximum number of active flow records in the flow table for this action instance.</p></dd>
<dt><tt>next_action continue</tt></dt>
<dd><p>Indicates that no further processing is required on packets of the traffic class <tt>video</tt>, and that these packets can return to the network stream.</p></dd>
</dl>
<p><a name="indexterm-3111"></a>The <tt>flowacct</tt> module gathers statistical information on packet flows of a particular class
until a specified <tt>timeout</tt> value is reached.</p></li></ol><h6>See Also</h6>
<ul><li><p>To configure per-hop behaviors on a router, refer to <a href="ipqos-policy-planning-137.html#ipqos-policy-planning-136">How to Configure a Router on an IPQoS-Enabled Network</a>.</p></li>
<li><p>To activate the IPQoS configuration file, refer to <a href="ipqos-maint-4.html#ipqos-maint-5">How to Apply a New Configuration to the IPQoS Kernel Modules</a>.</p></li>
<li><p>To create classes for traffic flows from applications, refer to <a href="ipqos-policy-planning-5.html#ipqos-policy-planning-67">How to Configure the IPQoS Configuration File for an Application Server</a>.</p></li></ul>


<a name="ipqos-policy-planning-114"></a><h4>How to Create an IPQoS Configuration File for a Best-Effort Web Server</h4><p>The IPQoS configuration file for a best-effort web server differs slightly from an
IPQoS configuration file for a premium web server. As an example, the
procedure uses the configuration file from <a href="#ipqos-policy-planning-ex-95">Example&nbsp;34-2</a>.</p><ol>
<li><a name="ipqos-policy-planning-step-131"></a><b>Log in to the best-effort web server.</b></li>
<li><a name="ipqos-policy-planning-step-126"></a><b>Create a new IPQoS configuration file with a <tt>.qos</tt> extension.</b><pre><tt><b>fmt_vesion 1.0 action { module ipgpc name ipgpc.classify params { global_stats TRUE }</b></tt></pre><p>The <tt>/var/ipqos/userweb.qos</tt> file must begin with the partial <tt>action</tt> statement to invoke
the <tt>ipgpc</tt> classifier. In addition, the <tt>action</tt> statement also has a params clause
to turn on statistics collection. For an explanation of this <tt>action</tt> statement, see
<a href="#ipqos-policy-planning-32">How to Create the IPQoS Configuration File and Define Traffic Classes</a>.</p></li>
<li><a name="ipqos-policy-planning-step-127"></a><b><a name="indexterm-3112"></a>Define a class that identifies traffic that is bound for the best-effort web
server.</b><pre><tt><b>class { name userweb next_action markAF12 enable_stats FALSE }</b></tt></pre><dl><dt><tt>name userweb</tt></dt>
<dd><p>Creates a class that is called <tt>userweb</tt> for forwarding web traffic from users.</p></dd>
<dt><tt>next_action markAF1</tt></dt>
<dd><p>Instructs the <tt>ipgpc</tt> module to pass packets of the <tt>userweb</tt> class to the <tt>markAF12</tt> <tt>action</tt> statement after <tt>ipgpc</tt> completes processing. The <tt>markAF12</tt> <tt>action</tt> statement invokes the <tt>dscpmk</tt> marker.</p></dd>
<dt><tt>enable_stats FALSE</tt></dt>
<dd><p>Enables statistics collection for the <tt>userweb</tt> class. However, because the value of <tt>enable_stats</tt> is <tt>FALSE</tt>, statistics collection for this class does not occur.</p></dd>
</dl>
<p>For an explanation of the <tt>class</tt> clause task, see <a href="#ipqos-policy-planning-32">How to Create the IPQoS Configuration File and Define Traffic Classes</a>.</p></li>
<li><a name="ipqos-policy-planning-step-128"></a><b><a name="indexterm-3113"></a>Define a <tt>filter</tt> clause to select traffic flows for the <tt>userweb</tt> class.</b><pre><tt><b> filter { name webout sport 80 direction LOCAL_OUT class userweb } }</b></tt></pre><dl><dt><tt>name webout</tt></dt>
<dd><p>Gives the name <tt>webout</tt> to the filter.</p></dd>
<dt><tt>sport 80</tt></dt>
<dd><p>Selects traffic with a source port of 80, the well-known port for HTTP (web) traffic.</p></dd>
<dt><tt>direction LOCAL_OUT</tt></dt>
<dd><p>Further selects traffic that is outgoing from the local system.</p></dd>
<dt>class userweb</dt>
<dd><p>Identifies the class to which the filter belongs, in this instance, class <tt>userweb</tt>.</p></dd>
</dl>
<p><a name="indexterm-3114"></a>For an explanation of the <tt>filter</tt> clause task, see <a href="#ipqos-policy-planning-33">How to Define Filters in the IPQoS Configuration File</a>.</p></li>
<li><a name="ipqos-policy-planning-step-132"></a><b>Begin the <tt>action</tt> statement to invoke the <tt>dscpmk</tt> marker.</b><pre><tt><b>action { module dscpmk name markAF12</b></tt></pre><dl><dt><tt>module dscpmk</tt></dt>
<dd><p>Invokes the marker module <tt>dscpmk</tt>.</p></dd>
<dt><tt>name markAF12</tt></dt>
<dd><p>Gives the name <tt>markAF12</tt> to the <tt>action</tt> statement.</p></dd>
</dl>
<p>The previously defined class <tt>userweb</tt> includes a <tt>next_action markAF12</tt> statement. This statement sends
traffic flows to the <tt>markAF12</tt> <tt>action</tt> statement after the classifier concludes processing.</p></li>
<li><a name="ipqos-policy-planning-step-129"></a><b><a name="indexterm-3115"></a>Define parameters for the marker to use for processing the traffic flow.</b><pre><tt><b> params { global_stats FALSE dscp_map{0-63:12} next_action continue } }</b></tt></pre><dl><dt><tt>global_stats FALSE</tt></dt>
<dd><p>Enables statistics collection for the <tt>markAF12</tt> marker <tt>action</tt> statement. However, because the value of <tt>enable_stats</tt> is <tt>FALSE</tt>, statistics collection does not occur.</p></dd>
<dt><tt>dscp_map{0&ndash;63:12}</tt></dt>
<dd><p>Assigns a DSCP of <tt>12</tt> to the packet headers of the traffic class <tt>userweb</tt>, which is currently being processed by the marker. </p></dd>
<dt><tt></tt>next_action continue</dt>
<dd><p>Indicates that no further processing is required on packets of the traffic class <tt>userweb</tt>, and that these packets can return to the network stream.</p></dd>
</dl>
<p>The DSCP of <tt>12</tt> instructs the marker to set all entries in the
<tt>dscp</tt> map to the decimal value 12 (binary 001100). This codepoint indicates that
packets of the <tt>userweb</tt> traffic class are subject to the AF12 per-hop behavior.
AF12 guarantees that all packets with the DSCP of <tt>12</tt> in the
DS field receive a medium-drop, high-priority service.</p></li>
<li><a name="ipqos-policy-planning-step-791"></a><b>When you complete the IPQoS configuration file, apply the configuration.</b></li></ol><h6>See Also</h6>
<ul><li><p>To add classes and other configuration for traffic flows from applications, refer to <a href="ipqos-policy-planning-5.html#ipqos-policy-planning-67">How to Configure the IPQoS Configuration File for an Application Server</a>.</p></li>
<li><p>To configure per-hop behaviors on a router, refer to <a href="ipqos-policy-planning-137.html#ipqos-policy-planning-136">How to Configure a Router on an IPQoS-Enabled Network</a>.</p></li>
<li><p>To activate your IPQoS configuration file, refer to <a href="ipqos-maint-4.html#ipqos-maint-5">How to Apply a New Configuration to the IPQoS Kernel Modules</a>.</p></li></ul>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ipqos-policy-planning-9.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ipqos-policy-planning-5.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

