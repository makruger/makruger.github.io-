<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Creating an IPQoS Configuration File for an Application Server - System Administration Guide: IP Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: IP Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ipqos-policy-planning-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ipqos-policy-planning-137.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="iptm-1.html">Part&nbsp;I&nbsp;TCP/IP Administration</a></p>
<p class="toc level2"><a href="ipov-1.html">1.&nbsp;&nbsp;Solaris TCPIP Protocol Suite (Overview)</a></p>
<p class="toc level2"><a href="ipplan-1.html">2.&nbsp;&nbsp;Planning an IPv4 Addressing Scheme (Tasks</a></p>
<p class="toc level2"><a href="ipv6-overview-7.html">3.&nbsp;&nbsp;Planning an IPv6 Addressing Scheme (Overview)</a></p>
<p class="toc level2"><a href="ipv6-planning-1.html">4.&nbsp;&nbsp;Planning an IPv6 Network (Tasks)</a></p>
<p class="toc level2"><a href="ipconfig-1.html">5.&nbsp;&nbsp;Configuring TCP/IP Network Services and IPv4 Addressing (Tasks)</a></p>
<p class="toc level2"><a href="fwawf.html">6.&nbsp;&nbsp;Administering Network Interfaces (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-config-tasks-1.html">7.&nbsp;&nbsp;Enabling IPv6 on a Network (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-admintasks-1.html">8.&nbsp;&nbsp;Administering a TCP/IP Network (Tasks)</a></p>
<p class="toc level2"><a href="gegel.html">9.&nbsp;&nbsp;Troubleshooting Network Problems (Tasks)</a></p>
<p class="toc level2"><a href="ipref-8.html">10.&nbsp;&nbsp;TCP/IP and IPv4 in Depth (Reference)</a></p>
<p class="toc level2"><a href="ipv6-ref-76.html">11.&nbsp;&nbsp;IPv6 in Depth (Reference)</a></p>
<p class="toc level1 tocsp"><a href="dhcptm-1.html">Part&nbsp;II&nbsp;DHCP</a></p>
<p class="toc level2"><a href="dhcp-overview-1.html">12.&nbsp;&nbsp;About Solaris DHCP (Overview)</a></p>
<p class="toc level2"><a href="chap2-26.html">13.&nbsp;&nbsp;Planning for DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="chapter3-20.html">14.&nbsp;&nbsp;Configuring the DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="dhcp-admin-9.html">15.&nbsp;&nbsp;Administering DHCP (Tasks)</a></p>
<p class="toc level2"><a href="eyatl.html">16.&nbsp;&nbsp;Configuring and Administering  DHCP Clients</a></p>
<p class="toc level2"><a href="dhcp-trouble-1.html">17.&nbsp;&nbsp;Troubleshooting DHCP (Reference)</a></p>
<p class="toc level2"><a href="dhcp-ref-4.html">18.&nbsp;&nbsp;DHCP Commands and Files (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipsectm-1.html">Part&nbsp;III&nbsp;IP Security</a></p>
<p class="toc level2"><a href="ipsec-ov-1.html">19.&nbsp;&nbsp;IP Security Architecture (Overview)</a></p>
<p class="toc level2"><a href="ipsec-mgtasks-1.html">20.&nbsp;&nbsp;Configuring IPsec (Tasks)</a></p>
<p class="toc level2"><a href="ipsecref-1.html">21.&nbsp;&nbsp;IP Security Architecture (Reference)</a></p>
<p class="toc level2"><a href="ike-1.html">22.&nbsp;&nbsp;Internet Key Exchange (Overview)</a></p>
<p class="toc level2"><a href="ike-task-1.html">23.&nbsp;&nbsp;Configuring IKE (Tasks)</a></p>
<p class="toc level2"><a href="ikeref-1.html">24.&nbsp;&nbsp;Internet Key Exchange (Reference)</a></p>
<p class="toc level2"><a href="eupsq.html">25.&nbsp;&nbsp;Solaris IP Filter (Overview)</a></p>
<p class="toc level2"><a href="ipfilter-admin-1.html">26.&nbsp;&nbsp;Solaris IP Filter (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="miptm-1.html">Part&nbsp;IV&nbsp;Mobile IP</a></p>
<p class="toc level2"><a href="mipoverview-1.html">27.&nbsp;&nbsp;Mobile IP (Overview)</a></p>
<p class="toc level2"><a href="mipimplementing-1.html">28.&nbsp;&nbsp;Administering Mobile IP (Tasks)</a></p>
<p class="toc level2"><a href="mipmanaging-22.html">29.&nbsp;&nbsp;Mobile IP Files and Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipmptm-1.html">Part&nbsp;V&nbsp;IPMP</a></p>
<p class="toc level2"><a href="mpoverview.html">30.&nbsp;&nbsp;Introducing IPMP (Overview)</a></p>
<p class="toc level2"><a href="deploynetmult-56.html">31.&nbsp;&nbsp;Administering IPMP (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ipqostm-1.html">Part&nbsp;VI&nbsp;IP Quality of Service (IPQoS)</a></p>
<p class="toc level2"><a href="ipqos-intro-1.html">32.&nbsp;&nbsp;Introducing IPQoS (Overview)</a></p>
<p class="toc level2"><a href="ipqos-config-planning-1.html">33.&nbsp;&nbsp;Planning for an IPQoS-Enabled Network (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-policy-planning-1.html">34.&nbsp;&nbsp;Creating the IPQoS Configuration File (Tasks)</a></p>
<p class="toc level3"><a href="ipqos-policy-planning-10.html">Defining a QoS Policy in the IPQoS Configuration File (Task Map)</a></p>
<p class="toc level3"><a href="ipqos-policy-planning-9.html">Tools for Creating a QoS Policy</a></p>
<p class="toc level3"><a href="ipqos-policy-planning-2.html">Creating IPQoS Configuration Files for Web Servers</a></p>
<p class="toc level4"><a href="ipqos-policy-planning-2.html#ipqos-policy-planning-32">How to Create the IPQoS Configuration File and Define Traffic Classes</a></p>
<p class="toc level4"><a href="ipqos-policy-planning-2.html#ipqos-policy-planning-33">How to Define Filters in the IPQoS Configuration File</a></p>
<p class="toc level4"><a href="ipqos-policy-planning-2.html#ipqos-policy-planning-102">How to Define Traffic Forwarding in the IPQoS Configuration File</a></p>
<p class="toc level4"><a href="ipqos-policy-planning-2.html#ipqos-policy-planning-110">How to Enable Accounting for a Class in the IPQoS Configuration File</a></p>
<p class="toc level4"><a href="ipqos-policy-planning-2.html#ipqos-policy-planning-114">How to Create an IPQoS Configuration File for a Best-Effort Web Server</a></p>
<div class="onpage">
<p class="toc level3 tocsp"><a href="">Creating an IPQoS Configuration File for an Application Server</a></p>
<p class="toc level4"><a href="#ipqos-policy-planning-67">How to Configure the IPQoS Configuration File for an Application Server</a></p>
<p class="toc level4"><a href="#ipqos-policy-planning-140">How to Configure Forwarding for Application Traffic in the IPQoS Configuration File</a></p>
<p class="toc level4"><a href="#ipqos-policy-planning-144">How to Configure Flow Control in the IPQoS Configuration File</a></p>
</div>
<p class="toc level3 tocsp"><a href="ipqos-policy-planning-137.html">Providing Differentiated Services on a Router</a></p>
<p class="toc level4"><a href="ipqos-policy-planning-137.html#ipqos-policy-planning-136">How to Configure a Router on an IPQoS-Enabled Network</a></p>
<p class="toc level2 tocsp"><a href="ipqos-isp-setup-1.html">35.&nbsp;&nbsp;Starting and Maintaining IPQoS (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-accounting-1.html">36.&nbsp;&nbsp;Using Flow Accounting and Statistics Gathering (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-reference-1.html">37.&nbsp;&nbsp;IPQoS in Detail (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="ipqos-policy-planning-5"></a><h3>Creating an IPQoS Configuration File for an Application Server</h3>
<p><a name="indexterm-3116"></a>This section explains how to create a configuration file for an application server
that provides major applications to customers. The procedure uses as its example the
<tt>BigAPPS</tt> server from <a href="ipqos-config-planning-13.html#ipqos-config-planning-fig-44">Figure&nbsp;33-4</a>.</p><p><a name="indexterm-3117"></a>The following configuration file defines IPQoS activities for the <tt>BigAPPS</tt> server. This
server hosts FTP, electronic mail (SMTP), and network news (NNTP) for customers.</p><a name="ipqos-policy-planning-ex-96"></a>Example&nbsp;34-3 Sample IPQoS Configuration File for an Application Server<pre>fmt_version 1.0

action {
    module ipgpc
    name ipgpc.classify
    params {
        global_stats TRUE
    }
    class {
        name smtp
        enable_stats FALSE
        next_action markAF13
    }
    class {
        name news
        next_action markAF21
    }
    class {
        name ftp
        next_action meterftp
    }
    filter {
        name smtpout
        sport smtp
        class smtp
    }
    filter {
        name newsout
        sport nntp
        class news
    }
    filter {
        name ftpout
        sport ftp
        class ftp
    }
   filter {
        name ftpdata
        sport ftp-data
        class ftp
    }
}
action {
    module dscpmk
    name markAF13
    params {
        global_stats FALSE
        dscp_map{0-63:14}
        next_action continue
    }
}
action {
    module dscpmk
    name markAF21
    params {
        global_stats FALSE
        dscp_map{0-63:18}
        next_action continue
    }
}
action {
    module tokenmt
    name meterftp
    params {
        committed_rate 50000000
        committed_burst 50000000
        red_action_name AF31
        green_action_name markAF22
        global_stats TRUE
    }
}
action {
    module dscpmk
    name markAF31
    params {
        global_stats TRUE
        dscp_map{0-63:26}
        next_action continue
    }
}
action {
    module dscpmk
    name markAF22
    params {
        global_stats TRUE
        dscp_map{0-63:20}
        next_action continue
    }
}</pre>

<a name="ipqos-policy-planning-67"></a><h4>How to Configure the IPQoS Configuration File for an Application Server</h4><ol>
<li><a name="ipqos-policy-planning-step-133"></a><b>Log in to the IPQoS-enabled application server, and create a new IPQoS configuration
file with a <tt>.qos</tt> extension.</b><p>For example, you would create the <tt>/var/ipqos/BigAPPS.qos</tt> file for the application server. Begin
with the following required phrases to start the <tt>action</tt> statement that invokes
the <tt>ipgpc</tt> classifier:</p><pre><tt><b>fmt_version 1.0 action { module ipgpc name ipgpc.classify params { global_stats TRUE } </b></tt></pre><p>For an explanation of the opening <tt>action</tt> statement, refer to <a href="ipqos-policy-planning-2.html#ipqos-policy-planning-32">How to Create the IPQoS Configuration File and Define Traffic Classes</a>.</p></li>
<li><a name="ipqos-policy-planning-step-134"></a><b><a name="indexterm-3118"></a>Create classes to select traffic from three applications on the BigAPPS server.</b><p>Add the class definitions after the opening <tt>action</tt> statement.</p><pre><tt><b> class { name smtp enable_stats FALSE next_action markAF13 } class { name news next_action markAF21 } class { name ftp enable_stats TRUE next_action meterftp }</b></tt>       </pre><dl><dt><tt>name smtp</tt></dt>
<dd><p>Creates a class that is called <tt>smtp</tt>, which includes email traffic flows to be handled by the SMTP application</p></dd>
<dt><tt>enable_stats FALSE</tt></dt>
<dd><p>Enables statistics collection for the <tt>smtp</tt> class. However, because the value of <tt>enable_stats</tt> is <tt>FALSE</tt>, statistics for this class are not taken.</p></dd>
<dt><tt>next_action markAF13</tt></dt>
<dd><p>Instructs the <tt>ipgpc</tt> module to pass packets of the <tt>smtp</tt> class to the <tt>markAF13</tt> <tt>action</tt> statement after <tt>ipgpc</tt> completes processing. </p></dd>
<dt><tt>name news</tt></dt>
<dd><p>Creates a class that is called <tt>news</tt>, which includes network news traffic flows to be handled by the NNTP application.</p></dd>
<dt><tt>next_action markAF21</tt></dt>
<dd><p>Instructs the <tt>ipgpc</tt> module to pass packets of the <tt>news</tt> class to the <tt>markAF21</tt> action statement after <tt>ipgpc</tt> completes processing. </p></dd>
<dt><tt>name ftp</tt></dt>
<dd><p>Creates a class that is called <tt>ftp</tt>, which handles outgoing traffic that is handled by the FTP application.</p></dd>
<dt><tt>enable_stats TRUE</tt></dt>
<dd><p>Enables statistics collection for the <tt>ftp</tt> class.</p></dd>
<dt><tt>next_action meterftp</tt></dt>
<dd><p>Instructs the <tt>ipgpc</tt> module to pass packets of the <tt>ftp</tt> class to the <tt>meterftp</tt> <tt>action</tt> statement after <tt>ipgpc</tt> completes processing. </p></dd>
</dl>
<p>For more information about defining classes, refer to <a href="ipqos-policy-planning-2.html#ipqos-policy-planning-32">How to Create the IPQoS Configuration File and Define Traffic Classes</a>.</p></li>
<li><a name="ipqos-policy-planning-step-135"></a><b><a name="indexterm-3119"></a>Define <tt>filter</tt> clauses to select traffic of the classes defined in Step 2.</b><pre><tt><b> filter { name smtpout sport smtp class smtp } filter { name newsout sport nntp class news } filter { name ftpout sport ftp class ftp } filter { name ftpdata sport ftp-data class ftp } }</b></tt></pre><dl><dt><tt>name smtpout</tt></dt>
<dd><p>Gives the name <tt>smtpout</tt> to the filter.</p></dd>
<dt><tt>sport smtp</tt></dt>
<dd><p>Selects traffic with a source port of 25, the well-known port for the <tt>sendmail</tt> (SMTP) application.</p></dd>
<dt><tt>class smtp</tt></dt>
<dd><p>Identifies the class to which the filter belongs, in this instance, class <tt>smtp</tt>.</p></dd>
<dt><tt>name newsout</tt></dt>
<dd><p>Gives the name <tt>newsout</tt> to the filter.</p></dd>
<dt><tt>sport nntp</tt></dt>
<dd><p>Selects traffic with a source port name of <tt>nntp</tt>, the well-known port name for the network news (NNTP) application.</p></dd>
<dt><tt>class news</tt></dt>
<dd><p>Identifies the class to which the filter belongs, in this instance, class <tt>news</tt>.</p></dd>
<dt><tt>name ftpout</tt></dt>
<dd><p>Gives the name <tt>ftpout</tt> to the filter.</p></dd>
<dt><tt>sport ftp</tt></dt>
<dd><p>Selects control data with a source port of 21, the well-known port number for FTP traffic.</p></dd>
<dt><tt>name ftpdata</tt></dt>
<dd><p>Gives the name <tt>ftpdata</tt> to the filter.</p></dd>
<dt><tt>sport ftp-data</tt></dt>
<dd><p>Selects traffic with a source port of 20, the well-known port number for FTP data traffic.</p></dd>
<dt><tt>class ftp</tt></dt>
<dd><p>Identifies the class to which the <tt>ftpout</tt> and <tt>ftpdata</tt> filters belong, in this instance <tt>ftp</tt>.</p></dd>
</dl>
</li></ol><h6>See Also</h6>
<ul><li><p>To define filters, refer to <a href="ipqos-policy-planning-2.html#ipqos-policy-planning-33">How to Define Filters in the IPQoS Configuration File</a>.</p></li>
<li><p>To define forwarding behaviors for application traffic, refer to <a href="#ipqos-policy-planning-140">How to Configure Forwarding for Application Traffic in the IPQoS Configuration File</a>.</p></li>
<li><p>To configure flow control by using the metering modules, refer to <a href="#ipqos-policy-planning-144">How to Configure Flow Control in the IPQoS Configuration File</a>.</p></li>
<li><p>To configure flow accounting, refer to <a href="ipqos-policy-planning-2.html#ipqos-policy-planning-110">How to Enable Accounting for a Class in the IPQoS Configuration File</a>.</p></li></ul>


<a name="ipqos-policy-planning-140"></a><h4>How to Configure Forwarding for Application Traffic in the IPQoS Configuration File</h4><p>The next procedure shows how to configure forwarding for application traffic. In the
procedure, you define per-hop behaviors for application traffic classes that might have lower
precedence than other traffic on a network. The steps continue building the <tt>/var/ipqos/BigAPPS.qos</tt>
file in <a href="#ipqos-policy-planning-ex-96">Example&nbsp;34-3</a>.</p><h6>Before You Begin</h6><p>The procedure assumes that you have an existing IPQoS configuration file with already-defined
classes and already-defined filters for the applications to be marked. </p><ol>
<li><a name="ipqos-policy-planning-step-150"></a><b>Open the IPQoS configuration file that you have created for the application server,
and locate the end of the last <tt>filter</tt> clause. </b><p>In the <tt>/var/ipqos/BigAPPS.qos</tt> file, the last filter is the following:</p><pre> filter {
        name ftpdata
        sport ftp-data
        class ftp
    }
}</pre></li>
<li><a name="ipqos-policy-planning-step-142"></a><b><a name="indexterm-3120"></a>Invoke the marker as follows:</b><pre><tt><b>action { module dscpmk name markAF13 </b></tt></pre><dl><dt><tt>module dscpmk</tt></dt>
<dd><p>Invokes the marker module <tt>dscpmk</tt>.</p></dd>
<dt><tt>name markAF13</tt></dt>
<dd><p>Gives the name <tt>markAF13</tt> to the <tt>action</tt> statement.</p></dd>
</dl>
</li>
<li><a name="ipqos-policy-planning-step-151"></a><b>Define the per-hop behavior to be marked on electronic mail traffic flows.</b><pre><tt><b> params { global_stats FALSE dscp_map{0-63:14} next_action continue } }</b></tt></pre><dl><dt><tt>global_stats FALSE</tt></dt>
<dd><p>Enables statistics collection for the <tt>markAF13</tt> marker <tt>action</tt> statement. However, because the value of <tt>enable_stats</tt> is <tt>FALSE</tt>, statistics are not collected.</p></dd>
<dt><tt>dscp_map{0&ndash;63:14}</tt></dt>
<dd><p>Assigns a DSCP of <tt>14</tt> to the packet headers of the traffic class <tt>smtp</tt>, which is currently being processed by the marker.</p></dd>
<dt></dt>
<dt><tt>next_action continue</tt></dt>
<dd><p>Indicates that no further processing is required on packets of the traffic class <tt>smtp</tt>. These packets can then return to the network stream.</p></dd>
</dl>
<p>The DSCP of <tt>14</tt> tells the marker to set all entries in
the <tt>dscp</tt> map to the decimal value 14 (binary 001110). The DSCP
of <tt>14</tt> sets the AF13 per-hop behavior. The marker marks packets of
the <tt>smtp</tt> traffic class with the DSCP of <tt>14</tt> in the DS
field. </p><p>AF13 assigns all packets with a DSCP of <tt>14</tt> to a high-drop precedence.
However, because AF13 also assures a Class 1 priority, the router still guarantees
outgoing email traffic a high priority in its queue. For a table
of possible AF codepoints, refer to <a href="ipqos-reference-2.html#ipqos-reference-tbl-16">Table&nbsp;37-2</a>.</p></li>
<li><a name="ipqos-policy-planning-step-143"></a><b>Add a marker <tt>action</tt> statement to define a per-hop behavior for network news
traffic:</b><pre><tt><b>action { module dscpmk name markAF21 params { global_stats FALSE dscp_map{0-63:18} next_action continue } }</b></tt></pre><dl><dt><tt>name markAF21</tt></dt>
<dd><p>Gives the name <tt>markAF21</tt> to the <tt>action</tt> statement.</p></dd>
<dt><tt>dscp_map{0&ndash;63:18}</tt></dt>
<dd><p>Assigns a DSCP of <tt>18</tt> to the packet headers of the traffic class <tt>nntp</tt>, which is currently being processed by the marker.</p></dd>
</dl>
<p>The DSCP of <tt>18</tt> tells the marker to set all entries in
the <tt>dscp</tt> map to the decimal value 18 (binary 010010). The DSCP
of <tt>18</tt> sets the AF21 per-hop behavior. The marker marks packets of
the <tt>news</tt> traffic class with the DSCP of <tt>18</tt> in the DS
field. </p><p>AF21 assures that all packets with a DSCP of <tt>18</tt> receive a low-drop
precedence, but with only Class 2 priority. Thus, the possibility of network news
traffic being dropped is low. </p></li></ol><h6>See Also</h6>
<ul><li><p>To add configuration information for web servers, refer to <a href="ipqos-policy-planning-2.html#ipqos-policy-planning-32">How to Create the IPQoS Configuration File and Define Traffic Classes</a>.</p></li>
<li><p>To configure flow control by using the metering modules, refer to <a href="#ipqos-policy-planning-144">How to Configure Flow Control in the IPQoS Configuration File</a>.</p></li>
<li><p>To configure flow accounting, refer to <a href="ipqos-policy-planning-2.html#ipqos-policy-planning-110">How to Enable Accounting for a Class in the IPQoS Configuration File</a>.</p></li>
<li><p>To configure forwarding behaviors on a router, refer to <a href="ipqos-policy-planning-137.html#ipqos-policy-planning-136">How to Configure a Router on an IPQoS-Enabled Network</a>.</p></li>
<li><p>To activate the IPQoS configuration file, refer to <a href="ipqos-maint-4.html#ipqos-maint-5">How to Apply a New Configuration to the IPQoS Kernel Modules</a>.</p></li></ul>


<a name="ipqos-policy-planning-144"></a><h4>How to Configure Flow Control in the IPQoS Configuration File</h4><p>To control the rate at which a particular traffic flow is released
onto the network, you must define parameters for the meter. You can use
either of the two meter modules, <tt>tokenmt</tt> or <tt>tswtclmt</tt>, in the IPQoS configuration file.
</p><p>The next procedure continues to build the IPQoS configuration file for the
application server in <a href="#ipqos-policy-planning-ex-96">Example&nbsp;34-3</a>. In the procedure, you configure not only the meter but
also two marker actions that are called within the meter <tt>action</tt> statement.</p><h6>Before You Begin</h6><p>The steps assume that you have already defined a class and a
filter for the application to be flow-controlled. </p><ol>
<li><a name="ipqos-policy-planning-step-152"></a><b>Open the IPQoS configuration file that you have created for the applications server.</b><p>In the <tt>/var/ipqos/BigAPPS.qos</tt> file, you begin after the following marker action:</p><pre>action {
    module dscpmk
    name markAF21
    params {
        global_stats FALSE
        dscp_map{0-63:18}
        next_action continue
    }
}</pre></li>
<li><a name="ipqos-policy-planning-step-76"></a><b><a name="indexterm-3121"></a><a name="indexterm-3122"></a>Create a meter <tt>action</tt> statement to flow-control traffic of the <tt>ftp</tt> class.</b><pre><tt><b>action { module tokenmt name meterftp </b></tt>        </pre><dl><dt><tt>module tokenmt</tt></dt>
<dd><p>Invokes the<tt>tokenmt</tt> meter.</p></dd>
<dt><tt>name meterftp</tt></dt>
<dd><p>Gives the name <tt>meterftp</tt> to the <tt>action</tt> statement.</p></dd>
</dl>
</li>
<li><a name="ipqos-policy-planning-step-77"></a><b><a name="indexterm-3123"></a>Add parameters to configure the meter's rate.</b><pre><tt><b>params { committed_rate 50000000 committed_burst 50000000 </b></tt></pre><dl><dt><tt>committed_rate 50000000</tt></dt>
<dd><p>Assigns a transmission rate of 50,000,000 bps to traffic of the <tt>ftp</tt> class.</p></dd>
<dt><tt>committed_burst 50000000</tt></dt>
<dd><p>Commits a burst size of 50,000,000 bits to traffic of the <tt>ftp</tt> class.</p></dd>
</dl>
<p>For an explanation of <tt>tokenmt</tt> parameters, refer to <a href="ipqos-reference-2.html#ipqos-reference-13">Configuring <tt>tokenmt</tt> as a Two-Rate Meter</a>.</p></li>
<li><a name="ipqos-policy-planning-step-78"></a><b>Add parameters to configure traffic conformance precedences:</b><pre><tt><b> red_action markAF31 green_action_name markAF22 global_stats TRUE } }</b></tt></pre><dl><dt><tt>red_action_name markAF31</tt></dt>
<dd><p>Indicates that when the traffic flow of the <tt>ftp</tt> class exceeds the committed rate, packets are sent to the <tt>markAF31</tt> marker <tt>action</tt> statement.</p></dd>
<dt><tt>green_action_name markAF22</tt></dt>
<dd><p>Indicates that when traffic flows of class <tt>ftp</tt> conform to the committed rate, packets are sent to the <tt>markAF22</tt> action statement.</p></dd>
<dt><tt>global_stats TRUE</tt></dt>
<dd><p>Enables metering statistics for the <tt>ftp</tt> class.</p></dd>
</dl>
<p>For more information about traffic conformance, see <a href="ipqos-reference-2.html#ipqos-reference-8">Meter Module</a>.</p></li>
<li><a name="ipqos-policy-planning-step-790"></a><b><a name="indexterm-3124"></a>Add a marker <tt>action</tt> statement to assign a per-hop behavior to nonconformant traffic
flows of class <tt>ftp</tt>.</b><pre><tt><b>action { module dscpmk name markAF31 params { global_stats TRUE dscp_map{0-63:26} next_action continue } }</b></tt></pre><dl><dt><tt>module dscpmk</tt></dt>
<dd><p>Invokes the marker module <tt>dscpmk</tt>.</p></dd>
<dt><tt>name markAF31</tt></dt>
<dd><p>Gives the name <tt>markAF31</tt> to the <tt>action</tt> statement. </p></dd>
<dt><tt>global_stats TRUE</tt></dt>
<dd><p>Enables statistics for the <tt>ftp</tt> class. </p></dd>
<dt><tt>dscp_map{0&ndash;63:26}</tt></dt>
<dd><p>Assigns a DSCP of <tt>26</tt> to the packet headers of the traffic class <tt>ftp</tt> whenever this traffic exceeds the committed rate.</p></dd>
<dt><tt>next_action continue</tt></dt>
<dd><p>Indicates that no further processing is required on packets of the traffic class <tt>ftp</tt>. Then these packets can return to the network stream.</p></dd>
</dl>
<p>The DSCP of <tt>26</tt> instructs the marker to set all entries in the
<tt>dscp</tt> map to the decimal value 26 (binary 011010). The DSCP of <tt>26</tt>
sets the AF31 per-hop behavior. The marker marks packets of the <tt>ftp</tt> traffic
class with the DSCP of <tt>26</tt> in the DS field. </p><p>AF31 assures that all packets with a DSCP of <tt>26</tt> receive a
low-drop precedence, but with only Class 3 priority. Therefore, the possibility of nonconformant
FTP traffic being dropped is low. For a table of possible AF codepoints,
refer to <a href="ipqos-reference-2.html#ipqos-reference-tbl-16">Table&nbsp;37-2</a>.</p></li>
<li><a name="ipqos-policy-planning-step-145"></a><b><a name="indexterm-3125"></a>Add a marker <tt>action</tt> statement to assign a per-hop behavior to <tt>ftp</tt> traffic
flows  <tt></tt> that conform to the committed rate.</b><pre><tt><b>action { module dscpmk name markAF22 params { global_stats TRUE dscp_map{0-63:20} next_action continue } }</b></tt></pre><dl><dt><tt>name markAF22</tt></dt>
<dd><p>Gives the name <tt>markAF22</tt> to the <tt>marker</tt> action.</p></dd>
<dt><tt>dscp_map{0&ndash;63:20}</tt></dt>
<dd><p>Assigns a DSCP of <tt>20</tt> to the packet headers of the traffic class <tt>ftp</tt> whenever <tt>ftp</tt> traffic conforms to its configured rate.</p></dd>
</dl>
<p>The DSCP of 20 tells the marker to set all entries in
the <tt>dscp</tt> map to the decimal value 20 (binary 010100). The DSCP of
<tt>20</tt> sets the AF22 per-hop behavior. The marker marks packets of the <tt>ftp</tt>
traffic class with the DSCP of <tt>20</tt> in the DS field. </p><p>AF22 assures that all packets with a DSCP of <tt>20</tt> receive a medium-drop
precedence with Class 2 priority. Therefore, conformant FTP traffic is assured a medium-drop precedence
among flows that are simultaneously released by the IPQoS system. However, the router
gives a higher forwarding priority to traffic classes with a Class 1
medium-drop precedence mark or higher. For a table of possible AF codepoints, refer
to <a href="ipqos-reference-2.html#ipqos-reference-tbl-16">Table&nbsp;37-2</a>.</p></li>
<li><a name="ipqos-policy-planning-step-313"></a><b>Add the DSCPs that you have created for the application server to the
appropriate files on the Diffserv router.</b></li></ol><h6>See Also</h6>
<ul><li><p>To activate the IPQoS configuration file, refer to <a href="ipqos-maint-4.html#ipqos-maint-5">How to Apply a New Configuration to the IPQoS Kernel Modules</a>.</p></li>
<li><p>To add configuration information for web servers, refer to <a href="ipqos-policy-planning-2.html#ipqos-policy-planning-32">How to Create the IPQoS Configuration File and Define Traffic Classes</a>.</p></li>
<li><p>To configure flow accounting, refer to <a href="ipqos-policy-planning-2.html#ipqos-policy-planning-110">How to Enable Accounting for a Class in the IPQoS Configuration File</a>.</p></li>
<li><p>To configure forwarding behaviors on a router, refer to <a href="ipqos-policy-planning-137.html#ipqos-policy-planning-136">How to Configure a Router on an IPQoS-Enabled Network</a>.</p></li></ul>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ipqos-policy-planning-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ipqos-policy-planning-137.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

