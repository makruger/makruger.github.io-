<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Planning the Quality-of-Service Policy - System Administration Guide: IP Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: IP Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ipqos-config-planning-5.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ipqos-config-planning-13.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="iptm-1.html">Part&nbsp;I&nbsp;TCP/IP Administration</a></p>
<p class="toc level2"><a href="ipov-1.html">1.&nbsp;&nbsp;Solaris TCPIP Protocol Suite (Overview)</a></p>
<p class="toc level2"><a href="ipplan-1.html">2.&nbsp;&nbsp;Planning an IPv4 Addressing Scheme (Tasks</a></p>
<p class="toc level2"><a href="ipv6-overview-7.html">3.&nbsp;&nbsp;Planning an IPv6 Addressing Scheme (Overview)</a></p>
<p class="toc level2"><a href="ipv6-planning-1.html">4.&nbsp;&nbsp;Planning an IPv6 Network (Tasks)</a></p>
<p class="toc level2"><a href="ipconfig-1.html">5.&nbsp;&nbsp;Configuring TCP/IP Network Services and IPv4 Addressing (Tasks)</a></p>
<p class="toc level2"><a href="fwawf.html">6.&nbsp;&nbsp;Administering Network Interfaces (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-config-tasks-1.html">7.&nbsp;&nbsp;Enabling IPv6 on a Network (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-admintasks-1.html">8.&nbsp;&nbsp;Administering a TCP/IP Network (Tasks)</a></p>
<p class="toc level2"><a href="gegel.html">9.&nbsp;&nbsp;Troubleshooting Network Problems (Tasks)</a></p>
<p class="toc level2"><a href="ipref-8.html">10.&nbsp;&nbsp;TCP/IP and IPv4 in Depth (Reference)</a></p>
<p class="toc level2"><a href="ipv6-ref-76.html">11.&nbsp;&nbsp;IPv6 in Depth (Reference)</a></p>
<p class="toc level1 tocsp"><a href="dhcptm-1.html">Part&nbsp;II&nbsp;DHCP</a></p>
<p class="toc level2"><a href="dhcp-overview-1.html">12.&nbsp;&nbsp;About Solaris DHCP (Overview)</a></p>
<p class="toc level2"><a href="chap2-26.html">13.&nbsp;&nbsp;Planning for DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="chapter3-20.html">14.&nbsp;&nbsp;Configuring the DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="dhcp-admin-9.html">15.&nbsp;&nbsp;Administering DHCP (Tasks)</a></p>
<p class="toc level2"><a href="eyatl.html">16.&nbsp;&nbsp;Configuring and Administering  DHCP Clients</a></p>
<p class="toc level2"><a href="dhcp-trouble-1.html">17.&nbsp;&nbsp;Troubleshooting DHCP (Reference)</a></p>
<p class="toc level2"><a href="dhcp-ref-4.html">18.&nbsp;&nbsp;DHCP Commands and Files (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipsectm-1.html">Part&nbsp;III&nbsp;IP Security</a></p>
<p class="toc level2"><a href="ipsec-ov-1.html">19.&nbsp;&nbsp;IP Security Architecture (Overview)</a></p>
<p class="toc level2"><a href="ipsec-mgtasks-1.html">20.&nbsp;&nbsp;Configuring IPsec (Tasks)</a></p>
<p class="toc level2"><a href="ipsecref-1.html">21.&nbsp;&nbsp;IP Security Architecture (Reference)</a></p>
<p class="toc level2"><a href="ike-1.html">22.&nbsp;&nbsp;Internet Key Exchange (Overview)</a></p>
<p class="toc level2"><a href="ike-task-1.html">23.&nbsp;&nbsp;Configuring IKE (Tasks)</a></p>
<p class="toc level2"><a href="ikeref-1.html">24.&nbsp;&nbsp;Internet Key Exchange (Reference)</a></p>
<p class="toc level2"><a href="eupsq.html">25.&nbsp;&nbsp;Solaris IP Filter (Overview)</a></p>
<p class="toc level2"><a href="ipfilter-admin-1.html">26.&nbsp;&nbsp;Solaris IP Filter (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="miptm-1.html">Part&nbsp;IV&nbsp;Mobile IP</a></p>
<p class="toc level2"><a href="mipoverview-1.html">27.&nbsp;&nbsp;Mobile IP (Overview)</a></p>
<p class="toc level2"><a href="mipimplementing-1.html">28.&nbsp;&nbsp;Administering Mobile IP (Tasks)</a></p>
<p class="toc level2"><a href="mipmanaging-22.html">29.&nbsp;&nbsp;Mobile IP Files and Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipmptm-1.html">Part&nbsp;V&nbsp;IPMP</a></p>
<p class="toc level2"><a href="mpoverview.html">30.&nbsp;&nbsp;Introducing IPMP (Overview)</a></p>
<p class="toc level2"><a href="deploynetmult-56.html">31.&nbsp;&nbsp;Administering IPMP (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ipqostm-1.html">Part&nbsp;VI&nbsp;IP Quality of Service (IPQoS)</a></p>
<p class="toc level2"><a href="ipqos-intro-1.html">32.&nbsp;&nbsp;Introducing IPQoS (Overview)</a></p>
<p class="toc level2"><a href="ipqos-config-planning-1.html">33.&nbsp;&nbsp;Planning for an IPQoS-Enabled Network (Tasks)</a></p>
<p class="toc level3"><a href="ipqos-config-planning-2.html">General IPQoS Configuration Planning (Task Map)</a></p>
<p class="toc level3"><a href="ipqos-config-planning-5.html">Planning the Diffserv Network Topology</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Planning the Quality-of-Service Policy</a></p>
<p class="toc level4"><a href="#ipqos-config-planning-32">How to Prepare a Network for IPQoS</a></p>
<p class="toc level4"><a href="#ipqos-config-planning-14">How to Define the Classes for Your QoS Policy</a></p>
<p class="toc level4"><a href="#ipqos-config-planning-42">How to Define Filters in the QoS Policy</a></p>
<p class="toc level4"><a href="#ipqos-config-planning-16">How to Plan Flow Control</a></p>
<p class="toc level4"><a href="#ipqos-config-planning-45">How to Plan Forwarding Behavior</a></p>
<p class="toc level4"><a href="#ipqos-config-planning-18">How to Plan for Flow Accounting</a></p>
</div>
<p class="toc level3 tocsp"><a href="ipqos-config-planning-13.html">Introducing the IPQoS Configuration Example</a></p>
<p class="toc level2 tocsp"><a href="ipqos-policy-planning-1.html">34.&nbsp;&nbsp;Creating the IPQoS Configuration File (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-isp-setup-1.html">35.&nbsp;&nbsp;Starting and Maintaining IPQoS (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-accounting-1.html">36.&nbsp;&nbsp;Using Flow Accounting and Statistics Gathering (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-reference-1.html">37.&nbsp;&nbsp;IPQoS in Detail (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="ipqos-config-planning-7"></a><h3>Planning the Quality-of-Service Policy</h3>
<p><a name="indexterm-3067"></a>When you plan the quality-of-service (QoS) policy, you must review, classify, and then
prioritize the services that your network provides. You must also assess the amount
of available bandwidth to determine the rate at which each traffic class is
released onto the network. </p>

<a name="ipqos-config-planning-19"></a><h4>QoS Policy Planning Aids</h4>
<p><a name="indexterm-3068"></a>Gather information for planning the QoS policy in a format that includes the
information needed for the IPQoS configuration file. For example, you can use the
following template to list the major categories of information to be used in
the IPQoS configuration file.</p><a name="ipqos-config-planning-tbl-28"></a><h6>Table&nbsp;33-1 QoS Planning Template</h6><table><col width="14.71*"><col width="14.71*"><col width="22.01*"><col width="14.47*"><col width="20.55*"><col width="26.00*"><col width="16.77*"><tr><th align="left" valign="top" scope="column"><p>Class</p></th>
<th align="left" valign="top" scope="column"><p>Priority</p></th>
<th align="left" valign="top" scope="column"><p>Filter</p></th>
<th align="left" valign="top" scope="column"><p>Selector</p></th>
<th align="left" valign="top" scope="column"><p>Rate</p></th>
<th align="left" valign="top" scope="column"><p>Forwarding?</p></th>
<th align="left" valign="top" scope="column"><p>Accounting?</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Class 1</p></td>
<td align="left" valign="top" scope="row"><p>1</p></td>
<td align="left" valign="top" scope="row"><p>Filter 1</p><p>Filter 3</p></td>
<td align="left" valign="top" scope="row"><p>Selector 1</p><p>Selector 2</p></td>
<td align="left" valign="top" scope="row"><p>Meter rates, depending on
meter type</p></td>
<td align="left" valign="top" scope="row"><p>Marker drop precedence</p></td>
<td align="left" valign="top" scope="row"><p>Requires flow-accounting statistics</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Class 1</p></td>
<td align="left" valign="top" scope="row"><p>1</p></td>
<td align="left" valign="top" scope="row"><p>Filter 2</p></td>
<td align="left" valign="top" scope="row"><p>Selector 1</p><p>Selector 2</p><p></p></td>
<td align="left" valign="top" scope="row"><p>N/A</p></td>
<td align="left" valign="top" scope="row"><p>N/A</p></td>
<td align="left" valign="top" scope="row"><p>N/A</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Class 2</p></td>
<td align="left" valign="top" scope="row"><p>2</p></td>
<td align="left" valign="top" scope="row"><p>Filter 1</p></td>
<td align="left" valign="top" scope="row"><p>Selector
1</p><p>Selector 2</p></td>
<td align="left" valign="top" scope="row"><p>Meter rates, depending on meter type</p></td>
<td align="left" valign="top" scope="row"><p>Marker drop precedence</p></td>
<td align="left" valign="top" scope="row"><p>Requires flow-accounting statistics</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Class 2</p></td>
<td align="left" valign="top" scope="row"><p>2</p></td>
<td align="left" valign="top" scope="row"><p>Filter
2</p></td>
<td align="left" valign="top" scope="row"><p>Selector 1</p><p>Selector 2</p></td>
<td align="left" valign="top" scope="row"><p>N/A</p></td>
<td align="left" valign="top" scope="row"><p>N/A</p></td>
<td align="left" valign="top" scope="row"><p>N/A</p></td>
</tr>
</table><p>You can divide each major category to further define the QoS policy. Subsequent
sections explain how to obtain information for the categories that are shown in
the template.</p>

<a name="euiht"></a><h4>QoS Policy Planning (Task Map)</h4>
<p><a name="indexterm-3069"></a><a name="indexterm-3070"></a>This task map lists the major tasks for planning a QoS policy.</p><table><col width="33*"><col width="33*"><col width="33*"><tr><th align="left" valign="top" scope="column"><p>Task</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
<th align="left" valign="top" scope="column"><p>For
Instructions</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>1. Design your network topology to support IPQoS.</p></td>
<td align="left" valign="top" scope="row"><p>Identify the hosts and routers
on your network to provide differentiated services.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#ipqos-config-planning-32">How to Prepare a Network for IPQoS</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>2. Define the classes into which services
on your network must be divided.</p></td>
<td align="left" valign="top" scope="row"><p>Examine the types of services and SLAs
that are offered by your site, and determine the discrete traffic classes into
which these services fall.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#ipqos-config-planning-14">How to Define the Classes for Your QoS Policy</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>3. Define filters for the classes.</p></td>
<td align="left" valign="top" scope="row"><p>Determine the best ways
of separating traffic of a particular class from the network traffic flow.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#ipqos-config-planning-42">How to Define Filters in the QoS Policy</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>4. Define
flow-control rates for measuring traffic as packets leave the IPQoS system.</p></td>
<td align="left" valign="top" scope="row"><p>Determine acceptable flow
rates for each class of traffic.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#ipqos-config-planning-16">How to Plan Flow Control</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>5. Define DSCPs or user-priority values to
be used in the QoS policy.</p></td>
<td align="left" valign="top" scope="row"><p>Plan a scheme to determine the forwarding
behavior that is assigned to a traffic flow when the flow is handled
by the router or switch.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#ipqos-config-planning-45">How to Plan Forwarding Behavior</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>6. If applicable, set up a statistics-monitoring plan
for traffic flows on the network.</p></td>
<td align="left" valign="top" scope="row"><p>Evaluate the traffic classes to determine which traffic
flows must be monitored for accounting or statistical purposes.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#ipqos-config-planning-18">How to Plan for Flow Accounting</a></p></td>
</tr>
</table>
<hr><p><b>Note - </b><a name="indexterm-3071"></a>The rest of this section explains how to plan the QoS policy
of an IPQoS-enabled system. To plan the QoS policy for the Diffserv router,
refer to the router documentation and the router manufacturer's web site. </p>
<hr>


<a name="ipqos-config-planning-32"></a><h4>How to Prepare a Network for IPQoS</h4><p>The following procedure lists general planning tasks to do before you create the
QoS policy.</p><ol>
<li><a name="ipqos-config-planning-step-37"></a><b>Review your network topology. Then, plan a strategy that uses IPQoS systems and
Diffserv routers.</b><p>For topology examples, see <a href="ipqos-config-planning-5.html">Planning the Diffserv Network Topology</a>.</p></li>
<li><a name="ipqos-config-planning-step-350"></a><b>Identify the hosts in the topology that require IPQoS or that might become
good candidates for IPQoS service.</b></li>
<li><a name="ipqos-config-planning-step-360"></a><b>Determine which IPQoS-enabled systems could use the same QoS policy.</b><p>For example, if you plan to enable IPQoS on all hosts on the
network, identify any hosts that could use the same QoS policy. Each IPQoS-enabled
system must have a local QoS policy, which is implemented in its IPQoS
configuration file. However, you can create one IPQoS configuration file to be used
by a range of systems. You can then copy the configuration file to
every system with the same QoS policy requirements.</p></li>
<li><a name="ipqos-config-planning-step-340"></a><b>Review and perform any planning tasks that are required by the Diffserv router
on your network.</b><p>Refer to the router documentation and the router manufacturer's web site for details.</p></li></ol>

<a name="ipqos-config-planning-14"></a><h4>How to Define the Classes for Your QoS Policy</h4><p>The first step in defining the QoS policy is organizing traffic flows into
classes. You do not need to create classes for every type of
traffic on a Diffserv network. Moreover, depending on your network topology, you might have
to create a different QoS policy for each IPQoS-enabled system.</p>
<hr><p><b>Note - </b>For an overview of classes, see <a href="ipqos-intro-11.html#ipqos-intro-26">IPQoS Classes</a>.</p>
<hr>
<p>The next procedure assumes that you have determined which systems on your network
are to be IPQoS-enabled, as identified in <a href="#ipqos-config-planning-32">How to Prepare a Network for IPQoS</a>.</p><ol>
<li><a name="ipqos-config-planning-step-39"></a><b>Create a QoS planning table for organizing the QoS policy information.</b><p>For suggestions, refer to <a href="#ipqos-config-planning-tbl-28">Table&nbsp;33-1</a>. </p></li>
<li><a name="ipqos-config-planning-step-40"></a><b>Perform the remaining steps for every QoS policy that is on your network.</b></li>
<li><a name="ipqos-config-planning-step-38"></a><b>Define the classes to be used in the QoS policy.</b><p>The following questions are a guideline for analyzing network traffic for possible class
definitions.</p>
<ul><li><p><b>Does your company offer service-level agreements to customers?</b></p><p>If yes, then evaluate the relative priority levels of the SLAs that your company offers to customers. The same applications might be offered to customers who are guaranteed different priority levels.</p><p>For example, your company might offer web site hosting to each customer, which indicates that you need to define a class for each customer web site. One SLA might provide a premium web site as one service level. Another SLA might offer a &ldquo;best-effort&rdquo; personal web site to discount customers. This factor indicates not only different web site classes but also potentially different per-hop behaviors that are assigned to the web site classes.</p></li>
<li><p><b>Does the IPQoS system offer popular applications that might need flow control?</b></p><p>You can improve network performance by enabling IPQoS on servers offering popular applications that generate excessive traffic. Common examples are electronic mail, network news, and FTP. Consider creating separate classes for incoming and outgoing traffic for each service type, where applicable. For example, you might create a <tt>mail-in</tt> class and a <tt>mail-out</tt> class for the QoS policy for a mail server.</p></li>
<li><p><b>Does your network run certain applications that require highest-priority forwarding behaviors?</b></p><p><a name="indexterm-3072"></a>Any critical applications that require highest-priority forwarding behaviors must receive highest priority in the router's queue. Typical examples are streaming video and streaming audio. </p><p>Define incoming classes and outgoing classes for these high-priority applications. Then, add the classes to the QoS policies of both the IPQoS-enabled system that serves the applications and the Diffserv router. </p></li>
<li><p><b>Does your network experience traffic flows that must be controlled because the flows consume large amounts of bandwidth?</b></p><p><a name="indexterm-3073"></a>Use <tt>netstat</tt>, <tt>snoop</tt>, and other network monitoring utilities to discover the types of traffic that are causing problems on the network. Review the classes that you have created thus far, and then create new classes for any undefined problem traffic category. If you have already defined classes for a category of problem traffic, then define rates for the meter to control the problem traffic.</p><p>Create classes for the problem traffic on every IPQoS-enabled system on the network. Each IPQoS system can then handle any problem traffic by limiting the rate at which the traffic flow is released onto the network. Be sure also to define these problem classes in the QoS policy on the Diffserv router. The router can then queue and schedule the problem flows as configured in its QoS policy.</p></li>
<li><p><b>Do you need to obtain statistics on certain types of traffic?</b></p><p>A quick review of an SLA can indicate which types of customer traffic require accounting. If your site does offer SLAs, you probably have already created classes for traffic that requires accounting. You might also define classes to enable statistics gathering on traffic flows that you are monitoring. You could also create classes for traffic to which you restrict access for security reasons.</p></li></ul>
</li>
<li><a name="ipqos-config-planning-step-41"></a><b>List the classes that you have defined in the QoS planning table you
created in Step 1.</b></li>
<li><a name="ipqos-config-planning-step-33"></a><b>Assign a priority level to each class.</b><p>For example, have priority level 1 represent the  highest-priority class, and assign
descending-level priorities to the remaining classes. The priority level that you assign is
for organizational purposes only. Priority levels that you set in the QoS policy
template are not actually used by IPQoS. Moreover, you can assign the same
priority to more than one class, if appropriate for your QoS policy. </p></li>
<li><a name="ipqos-config-planning-step-52"></a><b>When you finish defining classes, you next define filters for each class, as
explained in <a href="#ipqos-config-planning-42">How to Define Filters in the QoS Policy</a>.</b></li></ol><h6><h6>More Information</h6>Prioritizing the Classes<p>As you create classes, you quickly realize which classes have highest priority, medium
priority, and best-effort priority. A good scheme for prioritizing classes becomes particularly important
when you assign per-hop behaviors to outgoing traffic, as explained in <a href="#ipqos-config-planning-45">How to Plan Forwarding Behavior</a>. </p><p>In addition to assigning a PHB to a class, you can also
define a priority selector in a filter for the class. The priority selector
is active on the IPQoS-enabled host only. Suppose several classes with equal rates
and identical DSCPs sometimes compete for bandwidth as they leave the IPQoS system.
The priority selector in each class can further order the level of service
that is given to the otherwise identically valued classes.</p></h6>

<a name="ipqos-config-planning-483"></a><h4>Defining Filters</h4>
<p><a name="indexterm-3074"></a><a name="indexterm-3075"></a>You create filters to identify packet flows as members of a particular class.
Each filter contains selectors, which define the criteria for evaluating a packet flow.
The IPQoS-enabled system then uses the criteria in the selectors to extract packets
from a traffic flow. The IPQoS system then associates the packets with a
class.  For an introduction to filters, see <a href="ipqos-intro-11.html#ipqos-intro-27">IPQoS Filters</a>.</p><p><a name="indexterm-3076"></a>The following table lists the most commonly used selectors. The first five selectors
represent the IPQoS 5-tuple, which the IPQoS system uses to identify packets as
members of a flow. For a complete list of selectors, see <a href="ipqos-reference-2.html#ipqos-reference-tbl-32">Table&nbsp;37-1</a>.</p><a name="ipqos-config-planning-tbl-47"></a><h6>Table&nbsp;33-2 Common IPQoS Selectors</h6><table><col width="29.30*"><col width="47.90*"><tr><th align="left" valign="top" scope="column"><p>Name</p></th>
<th align="left" valign="top" scope="column"><p>Definition</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>saddr</tt></p></td>
<td align="left" valign="top" scope="row"><p>Source address.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>daddr</tt></p></td>
<td align="left" valign="top" scope="row"><p>Destination
address.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>sport</tt></p></td>
<td align="left" valign="top" scope="row"><p>Source port number. You can use a well-known port number, as defined in
<tt>/etc/services</tt>, or a user-defined port number.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>dport</tt></p></td>
<td align="left" valign="top" scope="row"><p>Destination port number.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>protocol</tt></p></td>
<td align="left" valign="top" scope="row"><p>IP protocol number or protocol
name that is assigned to the traffic flow type in <tt>/etc/protocols</tt>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>ip_version</tt></p></td>
<td align="left" valign="top" scope="row"><p>Addressing style to
use. Use either IPv4 or IPv6. IPv4 is the default.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>dsfield</tt></p></td>
<td align="left" valign="top" scope="row"><p>Contents of the
DS field, that is, the DSCP. Use this selector for extracting incoming packets
that are already marked with a particular DSCP.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>priority</tt></p></td>
<td align="left" valign="top" scope="row"><p>Priority level that is assigned
to the class. For more information, see <a href="#ipqos-config-planning-14">How to Define the Classes for Your QoS Policy</a>.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>user</tt></p></td>
<td align="left" valign="top" scope="row"><p>Either the UNIX user ID or
user name that is used when the upper-level application is executed.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>projid</tt></p></td>
<td align="left" valign="top" scope="row"><p>Project ID that
is used when the upper-level application is executed.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>direction</tt></p></td>
<td align="left" valign="top" scope="row"><p>Direction of traffic flow. Value
is either <tt>LOCAL_IN</tt>, <tt>LOCAL_OUT</tt>, <tt>FWD_IN</tt>, or <tt>FWD_OUT</tt>.</p></td>
</tr>
</table>
<hr><p><b>Note - </b>Be judicious in your choice of selectors. Use only as many selectors as
you need to extract packets for a class. The more selectors that
you define, the greater the impact on IPQoS performance.</p>
<hr>


<a name="ipqos-config-planning-42"></a><h4>How to Define Filters in the QoS Policy</h4><h6>Before You Begin</h6><p>Before you can perform the next steps, you should have completed the procedure
<a href="#ipqos-config-planning-14">How to Define the Classes for Your QoS Policy</a>.</p><ol>
<li><a name="ipqos-config-planning-step-48"></a><b>Create at least one filter for each class in the QoS planning table
that you created in <a href="#ipqos-config-planning-14">How to Define the Classes for Your QoS Policy</a>.</b><p>Consider creating separate filters for incoming and outgoing traffic for each class, where
applicable. For example, add an <tt>ftp-in</tt> filter and an <tt>ftp-out</tt> filter to
the QoS policy of an IPQoS-enabled FTP server.  You then can define
an appropriate <tt>direction</tt> selector in addition to the basic selectors. </p></li>
<li><a name="ipqos-config-planning-step-44"></a><b>Define at least one selector for each filter in a class.</b><p>Use the QoS planning table that was introduced in <a href="#ipqos-config-planning-tbl-28">Table&nbsp;33-1</a> to fill in filters
for the classes you defined.</p></li></ol><a name="eojbp"></a>Example&nbsp;33-1 Defining Filters for FTP Traffic<p>The next table shows how you would define a filter for outgoing
FTP traffic.</p><table><col width="39.38*"><col width="33.33*"><col width="26.26*"><col width="101.03*"><tr><th align="left" valign="top" scope="column"><p>Class</p></th>
<th align="left" valign="top" scope="column"><p>Priority</p></th>
<th align="left" valign="top" scope="column"><p>Filters</p></th>
<th align="left" valign="top" scope="column"><p>Selectors</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>ftp-traffic</tt></p></td>
<td align="left" valign="top" scope="row"><p>4</p></td>
<td align="left" valign="top" scope="row"><p><tt>ftp-out</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>saddr 10.190.17.44</tt></p><p><tt>daddr 10.100.10.53</tt></p><p><tt>sport 21</tt></p><p><tt>direction LOCAL_OUT</tt></p></td>
</tr>
</table><h6>See Also</h6>
<ul><li><p>To define a flow-control scheme, refer to <a href="#ipqos-config-planning-16">How to Plan Flow Control</a>.</p></li>
<li><p>To define forwarding behaviors for flows as the flows return to the network stream, refer to <a href="#ipqos-config-planning-45">How to Plan Forwarding Behavior</a>.</p></li>
<li><p>To plan for flow accounting of certain types of traffic, refer to <a href="#ipqos-config-planning-18">How to Plan for Flow Accounting</a>.</p></li>
<li><p>To add more classes to the QoS policy, refer to <a href="#ipqos-config-planning-14">How to Define the Classes for Your QoS Policy</a>.</p></li>
<li><p>To add more filters to the QoS policy, refer to <a href="#ipqos-config-planning-42">How to Define Filters in the QoS Policy</a>.</p></li></ul>


<a name="ipqos-config-planning-16"></a><h4>How to Plan Flow Control</h4><p>Flow control involves measuring traffic flow for a class and then releasing packets
onto the network at a defined rate. When you plan flow control,
you define parameters to be used by the IPQoS metering modules. The meters
determine the rate at which traffic is released onto the network. For an
introduction to the metering modules, see <a href="ipqos-intro-11.html#ipqos-intro-19">Meter <tt>(tokenmt</tt> and <tt>tswtclmt)</tt> Overview</a>. </p><p>The next procedure assumes that you have defined filters and selectors, as described
in <a href="#ipqos-config-planning-42">How to Define Filters in the QoS Policy</a>.</p><ol>
<li><a name="ipqos-config-planning-step-36"></a><b>Determine the maximum bandwidth for your network.</b></li>
<li><a name="ipqos-config-planning-step-32"></a><b>Review any SLAs that are supported on your network. Identify customers and the
type of service that is guaranteed to each customer.</b><p>To guarantee a certain level of service, you might need to meter certain
traffic classes that are generated by the customer. </p></li>
<li><a name="ipqos-config-planning-step-34"></a><b>Review the list of classes that you created in <a href="#ipqos-config-planning-14">How to Define the Classes for Your QoS Policy</a>.</b><p>Determine if any classes other than those classes that are associated with SLAs
need to be metered.</p><p>Suppose the IPQoS system runs an application that generates a high level of
traffic. After you classify the application's traffic, meter the flows to control the
rate at which the packets of the flow return to the network.</p>
<hr><p><b>Note - </b>Not all classes need to be metered. Remember this guideline as you review
your list of classes.</p>
<hr>
</li>
<li><a name="ipqos-config-planning-step-380"></a><b>Determine which filters in each class select traffic that needs flow control. Then,
refine your list of classes that require metering.</b><p>Classes that have more than one filter might require metering for only one
filter. Suppose that you define filters for incoming and outgoing traffic of a
certain class. You might conclude that only traffic in one direction requires flow
control.</p></li>
<li><a name="ipqos-config-planning-step-35"></a><b>Choose a meter module for each class to be flow controlled.</b><p>Add the module name to the meter column in your QoS planning table.
</p></li>
<li><a name="ipqos-config-planning-step-390"></a><b>Add the rates for each class to be metered to the organizational table.</b><p><a name="indexterm-3077"></a>If you use the <tt>tokenmt</tt> module, you need to define the following rates
in bits per second:</p>
<ul><li><p>Committed rate</p></li>
<li><p>Peak rate</p></li></ul>
<p>If these rates are sufficient to meter a particular class, you can
define only the committed rate and the committed burst for <tt>tokenmt</tt>. </p><p>If needed, you can also define the following rates:</p>
<ul><li><p>Committed burst</p></li>
<li><p>Peak burst</p></li></ul>
<p>For a complete definition of <tt>tokenmt</tt> rates, refer to <a href="ipqos-reference-2.html#ipqos-reference-13">Configuring <tt>tokenmt</tt> as a Two-Rate Meter</a>. You can also
find more detailed information in the <tt>tokenmt</tt>(7ipp) man page.</p><p>If you use the <tt>tswtclmt</tt> module, you need to define the following rates
in bits per second.</p>
<ul><li><p>Committed rate</p></li>
<li><p>Peak rate</p></li></ul>
<p>You can also define the window size in milliseconds. These rates are defined
in <a href="ipqos-reference-2.html#ipqos-reference-20"><tt>tswtclmt</tt> Metering Module</a> and in the <tt>twstclmt</tt>(7ipp) man page.</p></li>
<li><a name="ipqos-config-planning-step-370"></a><b>Add traffic conformance outcomes for the metered traffic.</b><p><a name="indexterm-3078"></a>The outcomes for both metering modules are green, red, and yellow. Add to
your QoS organizational table the traffic conformance outcomes that apply to the rates
you define. Outcomes for the meters are fully explained in <a href="ipqos-reference-2.html#ipqos-reference-8">Meter Module</a>.</p><p>You need to determine what action should be taken on traffic that conforms,
or does not conform, to the committed rate. Often,  but not always,
this action is to mark the packet header with a per-hop behavior. One
acceptable action for green-level traffic could be to continue processing while traffic flows do
not exceed the committed rate. Another action could be to drop packets of
the class if flows exceed peak rate.</p></li></ol><a name="eojbq"></a>Example&nbsp;33-2 Defining Meters<p>The next table shows meter entries for a class of email traffic.
The network on which the IPQoS system is located has a total bandwidth
of 100 Mbits/sec, or 10000000 bits per second. The QoS policy assigns a
low priority to the email class. This class also receives best-effort forwarding behavior.</p><table><col width="15.84*"><col width="15.84*"><col width="15.84*"><col width="20.41*"><col width="32.07*"><tr><th align="left" valign="top" scope="column"><p>Class</p></th>
<th align="left" valign="top" scope="column"><p>Priority</p></th>
<th align="left" valign="top" scope="column"><p>Filter</p></th>
<th align="left" valign="top" scope="column"><p>Selector</p></th>
<th align="left" valign="top" scope="column"><p>Rate</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>email</tt></p></td>
<td align="left" valign="top" scope="row"><p>8</p></td>
<td align="left" valign="top" scope="row"><p><tt>mail_in</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>daddr</tt><tt>10.50.50.5</tt></p><p><tt>dport imap</tt></p><p><tt>direction LOCAL_IN</tt></p></td>
<td align="left" valign="top" scope="row"><p></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>email</tt>
</p></td>
<td align="left" valign="top" scope="row"><p>8</p></td>
<td align="left" valign="top" scope="row"><p><tt>mail_out</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>saddr</tt><tt>10.50.50.5</tt></p><p><tt>sport imap</tt></p><p><tt>direction LOCAL_OUT</tt></p></td>
<td align="left" valign="top" scope="row"><p>meter=<tt>tokenmt</tt></p><p>committed rate=5000000</p><p>committed burst =5000000</p><p>peak rate =10000000</p><p>peak burst=1000000</p><p>green precedence=continue processing</p><p>yellow precedence=mark yellow PHB</p><p>red
precedence=drop</p></td>
</tr>
</table><h6>See Also</h6>
<ul><li><p>To define forwarding behaviors for flows as the packets return to the network stream, refer to <a href="#ipqos-config-planning-45">How to Plan Forwarding Behavior</a>.</p></li>
<li><p>To plan for flow accounting of certain types of traffic, refer to <a href="#ipqos-config-planning-18">How to Plan for Flow Accounting</a>.</p></li>
<li><p>To add more classes to the QoS policy, refer to <a href="#ipqos-config-planning-14">How to Define the Classes for Your QoS Policy</a>.</p></li>
<li><p>To add more filters to the QoS policy, refer to <a href="#ipqos-config-planning-42">How to Define Filters in the QoS Policy</a>.</p></li>
<li><p>To define another flow-control scheme, refer to <a href="#ipqos-config-planning-16">How to Plan Flow Control</a>.</p></li>
<li><p>To create an IPQoS configuration file, refer to <a href="ipqos-policy-planning-2.html#ipqos-policy-planning-32">How to Create the IPQoS Configuration File and Define Traffic Classes</a>.</p></li></ul>


<a name="ipqos-config-planning-45"></a><h4>How to Plan Forwarding Behavior</h4><p>Forwarding behavior determines the priority and drop precedence of traffic flows that are
about to be forwarded to the network. You can choose two major forwarding
behaviors: prioritize the flows of a class in relationship to other traffic classes
or drop the flows entirely. </p><p>The Diffserv model uses the marker to assign the chosen forwarding behavior to
traffic flows. IPQoS offers the following marker modules.</p>
<ul><li><p><a name="indexterm-3079"></a><tt>dscpmk</tt> &ndash; Used to mark the DS field of an IP packet with a DSCP</p></li>
<li><p><tt>dlcosmk</tt> &ndash; Used to mark the VLAN tag of a datagram with a class-of-service (CoS) value</p></li></ul>

<hr><p><b>Note - </b><a name="indexterm-3080"></a>The suggestions in this section refer specifically to IP packets. If your IPQoS
system includes a VLAN device, you can use the <tt>dlcosmk</tt> marker to mark
forwarding behaviors for datagrams. For more information, refer to <a href="ipqos-reference-2.html#ipqos-reference-110">Using the <tt>dlcosmk</tt> Marker With VLAN Devices</a>.</p>
<hr>
<p>To prioritize IP traffic, you need to assign a DSCP to each
packet. The <tt>dscpmk</tt> marker marks the DS field of the packet with the DSCP.
You choose the DSCP for a class from a group of well-known
codepoints that are associated with the forwarding behavior type. These well-known codepoints are 46
(101110) for the EF PHB and a range of codepoints for the
AF PHB. For overview information on DSCP and forwarding, refer to <a href="ipqos-intro-54.html">Traffic Forwarding on an IPQoS-Enabled Network</a>.</p><h6>Before You Begin</h6><p>The next steps assume that you have defined classes and filters for the
QoS policy. Though you often use the meter with the marker to
control traffic, you can use the marker alone to define a forwarding behavior.</p><ol>
<li><a name="ipqos-config-planning-step-50"></a><b>Review the classes that you have created thus far and the priorities that
you have assigned to each class.</b><p>Not all traffic classes need to be marked. </p></li>
<li><a name="ipqos-config-planning-step-49"></a><b><a name="indexterm-3081"></a>Assign the EF per-hop behavior to the class with the highest priority.</b><p>The EF PHB guarantees that packets with the EF DSCP 46 
(101110) are released onto the network before packets with any AF PHBs. Use
the EF PHB for your highest-priority traffic. For more information about EF, refer to
<a href="ipqos-reference-2.html#ipqos-reference-140">Expedited Forwarding (EF) PHB</a>.</p></li>
<li><a name="ipqos-config-planning-step-47"></a><b>Assign forwarding behaviors to classes that have traffic to be metered.</b></li>
<li><a name="ipqos-config-planning-step-480"></a><b>Assign DS codepoints to the remaining classes in agreement with the priorities that
you have assigned to the classes.</b></li></ol><a name="eupqz"></a>Example&nbsp;33-3 QoS Policy for a Games Application<p>Traffic is generally metered for the following reasons:</p>
<ul><li><p>An SLA guarantees packets of this class greater service or lesser service when the network is heavily used.</p></li>
<li><p>A class with a lower priority might have a tendency to flood the network.</p></li></ul>
<p>You use the marker with the meter to provide differentiated services and bandwidth
management to these classes. For example, the following table shows a portion of
a QoS policy. This policy defines a class for a popular games application
that generates a high level of traffic.</p><table><col width="13.37*"><col width="10.04*"><col width="12.89*"><col width="12.39*"><col width="15.61*"><col width="15.94*"><tr><th align="left" valign="top" scope="column"><p>Class</p></th>
<th align="left" valign="top" scope="column"><p>Priority</p></th>
<th align="left" valign="top" scope="column"><p>Filter</p></th>
<th align="left" valign="top" scope="column"><p>Selector</p></th>
<th align="left" valign="top" scope="column"><p>Rate</p></th>
<th align="left" valign="top" scope="column"><p>Forwarding?</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>games_app</tt></p></td>
<td align="left" valign="top" scope="row"><p>9</p></td>
<td align="left" valign="top" scope="row"><p><tt>games_in</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>sport 6080</tt></p></td>
<td align="left" valign="top" scope="row"><p>N/A</p></td>
<td align="left" valign="top" scope="row"><p>N/A</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>games_app</tt></p></td>
<td align="left" valign="top" scope="row"><p>9</p></td>
<td align="left" valign="top" scope="row"><p><tt>games_out</tt></p></td>
<td align="left" valign="top" scope="row"><p><tt>dport 6081</tt></p></td>
<td align="left" valign="top" scope="row"><p>meter=<tt>tokenmt</tt></p><p>committed rate=5000000</p><p>committed burst =5000000</p><p>peak rate =10000000</p><p>peak
burst=15000000</p><p>green precedence=continue processing</p><p>yellow precedence=mark yellow PHB</p><p>red precedence=drop</p></td>
<td align="left" valign="top" scope="row"><p>green =AF31</p><p>yellow=AF42</p><p>red=drop</p></td>
</tr>
</table><p>The forwarding behaviors assign low-priority DSCPs to <tt>games_app</tt> traffic that conforms to its
committed rate or is under the peak rate. When <tt>games_app</tt> traffic exceeds
peak rate, the QoS policy indicates that packets from <tt>games_app</tt> are to be
dropped. All AF codepoints are listed in <a href="ipqos-reference-2.html#ipqos-reference-tbl-16">Table&nbsp;37-2</a>.</p><h6>See Also</h6>
<ul><li><p>To plan for flow accounting of certain types of traffic, refer to <a href="#ipqos-config-planning-18">How to Plan for Flow Accounting</a>.</p></li>
<li><p>To add more classes to the QoS policy, refer to <a href="#ipqos-config-planning-14">How to Define the Classes for Your QoS Policy</a>.</p></li>
<li><p>To add more filters to the QoS policy, refer to <a href="#ipqos-config-planning-42">How to Define Filters in the QoS Policy</a>.</p></li>
<li><p>To define a flow-control scheme, refer to <a href="#ipqos-config-planning-16">How to Plan Flow Control</a>.</p></li>
<li><p>To define additional forwarding behaviors for flows as the packets return to the network stream, refer to <a href="#ipqos-config-planning-45">How to Plan Forwarding Behavior</a>.</p></li>
<li><p>To create an IPQoS configuration file, refer to <a href="ipqos-policy-planning-2.html#ipqos-policy-planning-32">How to Create the IPQoS Configuration File and Define Traffic Classes</a>.</p></li></ul>


<a name="ipqos-config-planning-18"></a><h4>How to Plan for Flow Accounting</h4><p>You use the IPQoS <tt>flowacct</tt> module to track traffic flows for billing or
network management purposes. Use the following procedure to determine if your QoS policy
should include flow accounting.</p><ol>
<li><a name="ipqos-config-planning-step-60"></a><b>Does your company offer SLAs to customers?</b><p>If the answer is yes, then you should use flow accounting. Review the
SLAs to determine what types of network traffic your company wants to bill
customers for. Then, review your QoS policy to determine which classes select traffic
to be billed.</p></li>
<li><a name="ipqos-config-planning-step-57"></a><b>Are there applications that might need monitoring or testing to avoid network problems?</b><p>If the answer is yes, consider using flow accounting to observe the behavior of
these applications. Review your QoS policy to determine the classes that you have
assigned to traffic that requires monitoring.</p></li>
<li><a name="ipqos-config-planning-step-58"></a><b>Mark Y in the flow-accounting column for each class that requires flow accounting
in your QoS planning table.</b></li></ol><h6>See Also</h6>
<ul><li><p>To add more classes to the QoS policy, refer to <a href="#ipqos-config-planning-14">How to Define the Classes for Your QoS Policy</a>.</p></li>
<li><p>To add more filters to the QoS policy, refer to <a href="#ipqos-config-planning-42">How to Define Filters in the QoS Policy</a>.</p></li>
<li><p>To define a flow-control scheme, refer to <a href="#ipqos-config-planning-16">How to Plan Flow Control</a>.</p></li>
<li><p>To define forwarding behaviors for flows as the packets return to the network stream, refer to <a href="#ipqos-config-planning-45">How to Plan Forwarding Behavior</a>.</p></li>
<li><p>To plan for additional flow accounting of certain types of traffic, refer to <a href="#ipqos-config-planning-18">How to Plan for Flow Accounting</a>.</p></li>
<li><p>To create the IPQoS configuration file, refer to <a href="ipqos-policy-planning-2.html#ipqos-policy-planning-32">How to Create the IPQoS Configuration File and Define Traffic Classes</a>.</p></li></ul>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ipqos-config-planning-5.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ipqos-config-planning-13.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

