<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Configuring IKE With Preshared Keys - System Administration Guide: IP Services</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2007-02-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: IP Services</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ike-task-13.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ike-task-12.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="iptm-1.html">Part&nbsp;I&nbsp;TCP/IP Administration</a></p>
<p class="toc level2"><a href="ipov-1.html">1.&nbsp;&nbsp;Solaris TCPIP Protocol Suite (Overview)</a></p>
<p class="toc level2"><a href="ipplan-1.html">2.&nbsp;&nbsp;Planning an IPv4 Addressing Scheme (Tasks</a></p>
<p class="toc level2"><a href="ipv6-overview-7.html">3.&nbsp;&nbsp;Planning an IPv6 Addressing Scheme (Overview)</a></p>
<p class="toc level2"><a href="ipv6-planning-1.html">4.&nbsp;&nbsp;Planning an IPv6 Network (Tasks)</a></p>
<p class="toc level2"><a href="ipconfig-1.html">5.&nbsp;&nbsp;Configuring TCP/IP Network Services and IPv4 Addressing (Tasks)</a></p>
<p class="toc level2"><a href="fwawf.html">6.&nbsp;&nbsp;Administering Network Interfaces (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-config-tasks-1.html">7.&nbsp;&nbsp;Enabling IPv6 on a Network (Tasks)</a></p>
<p class="toc level2"><a href="ipv6-admintasks-1.html">8.&nbsp;&nbsp;Administering a TCP/IP Network (Tasks)</a></p>
<p class="toc level2"><a href="gegel.html">9.&nbsp;&nbsp;Troubleshooting Network Problems (Tasks)</a></p>
<p class="toc level2"><a href="ipref-8.html">10.&nbsp;&nbsp;TCP/IP and IPv4 in Depth (Reference)</a></p>
<p class="toc level2"><a href="ipv6-ref-76.html">11.&nbsp;&nbsp;IPv6 in Depth (Reference)</a></p>
<p class="toc level1 tocsp"><a href="dhcptm-1.html">Part&nbsp;II&nbsp;DHCP</a></p>
<p class="toc level2"><a href="dhcp-overview-1.html">12.&nbsp;&nbsp;About Solaris DHCP (Overview)</a></p>
<p class="toc level2"><a href="chap2-26.html">13.&nbsp;&nbsp;Planning for DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="chapter3-20.html">14.&nbsp;&nbsp;Configuring the DHCP Service (Tasks)</a></p>
<p class="toc level2"><a href="dhcp-admin-9.html">15.&nbsp;&nbsp;Administering DHCP (Tasks)</a></p>
<p class="toc level2"><a href="eyatl.html">16.&nbsp;&nbsp;Configuring and Administering  DHCP Clients</a></p>
<p class="toc level2"><a href="dhcp-trouble-1.html">17.&nbsp;&nbsp;Troubleshooting DHCP (Reference)</a></p>
<p class="toc level2"><a href="dhcp-ref-4.html">18.&nbsp;&nbsp;DHCP Commands and Files (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipsectm-1.html">Part&nbsp;III&nbsp;IP Security</a></p>
<p class="toc level2"><a href="ipsec-ov-1.html">19.&nbsp;&nbsp;IP Security Architecture (Overview)</a></p>
<p class="toc level2"><a href="ipsec-mgtasks-1.html">20.&nbsp;&nbsp;Configuring IPsec (Tasks)</a></p>
<p class="toc level2"><a href="ipsecref-1.html">21.&nbsp;&nbsp;IP Security Architecture (Reference)</a></p>
<p class="toc level2"><a href="ike-1.html">22.&nbsp;&nbsp;Internet Key Exchange (Overview)</a></p>
<p class="toc level2"><a href="ike-task-1.html">23.&nbsp;&nbsp;Configuring IKE (Tasks)</a></p>
<p class="toc level3"><a href="ike-task-7.html">Configuring IKE (Task Map)</a></p>
<p class="toc level3"><a href="ike-task-13.html">Configuring IKE With Preshared Keys (Task Map)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Configuring IKE With Preshared Keys</a></p>
<p class="toc level4"><a href="#ike-task-24">How to Configure IKE With Preshared Keys</a></p>
<p class="toc level4"><a href="#ike-task-10">How to Refresh IKE Preshared Keys</a></p>
<p class="toc level4"><a href="#ike-task-18">How to Add an IKE Preshared Key for a New Policy Entry in <tt>ipsecinit.conf</tt></a></p>
<p class="toc level4"><a href="#ike-task-44">How to Verify That IKE Preshared Keys Are Identical</a></p>
</div>
<p class="toc level3 tocsp"><a href="ike-task-12.html">Configuring IKE With Public Key Certificates (Task Map)</a></p>
<p class="toc level3"><a href="ike-task-25.html">Configuring IKE With Public Key Certificates</a></p>
<p class="toc level4"><a href="ike-task-25.html#ike-task-42">How to Configure IKE With Self-Signed Public Key Certificates</a></p>
<p class="toc level4"><a href="ike-task-25.html#ike-task-41">How to Configure IKE With Certificates Signed by a CA</a></p>
<p class="toc level4"><a href="ike-task-25.html#ike-task-14">How to Generate and Store Public Key Certificates on Hardware</a></p>
<p class="toc level4"><a href="ike-task-25.html#ike-task-22">How to Handle a Certificate Revocation List</a></p>
<p class="toc level3 tocsp"><a href="ike-task-38.html">Configuring IKE for Mobile Systems (Task Map)</a></p>
<p class="toc level3"><a href="ike-task-48.html">Configuring IKE for Mobile Systems</a></p>
<p class="toc level4"><a href="ike-task-48.html#ike-task-40">How to Configure IKE for Off-Site Systems</a></p>
<p class="toc level3 tocsp"><a href="ike-task-17.html">Configuring IKE to Find Attached Hardware (Task Map)</a></p>
<p class="toc level3"><a href="ike-task-35.html">Configuring IKE to Find Attached Hardware</a></p>
<p class="toc level4"><a href="ike-task-35.html#ike-task-32">How to Configure IKE to Find the Sun Crypto Accelerator 1000 Board</a></p>
<p class="toc level4"><a href="ike-task-35.html#ike-task-11">How to Configure IKE to Find the Sun Crypto Accelerator 4000 Board</a></p>
<p class="toc level3 tocsp"><a href="ike-task-19.html">Changing IKE Transmission Parameters (Task Map)</a></p>
<p class="toc level3"><a href="ike-task-20.html">Changing IKE Transmission Parameters</a></p>
<p class="toc level4"><a href="ike-task-20.html#ike-task-34">How to Change the Duration of Phase 1 IKE Key Negotiation</a></p>
<p class="toc level2 tocsp"><a href="ikeref-1.html">24.&nbsp;&nbsp;Internet Key Exchange (Reference)</a></p>
<p class="toc level2"><a href="eupsq.html">25.&nbsp;&nbsp;Solaris IP Filter (Overview)</a></p>
<p class="toc level2"><a href="ipfilter-admin-1.html">26.&nbsp;&nbsp;Solaris IP Filter (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="miptm-1.html">Part&nbsp;IV&nbsp;Mobile IP</a></p>
<p class="toc level2"><a href="mipoverview-1.html">27.&nbsp;&nbsp;Mobile IP (Overview)</a></p>
<p class="toc level2"><a href="mipimplementing-1.html">28.&nbsp;&nbsp;Administering Mobile IP (Tasks)</a></p>
<p class="toc level2"><a href="mipmanaging-22.html">29.&nbsp;&nbsp;Mobile IP Files and Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="ipmptm-1.html">Part&nbsp;V&nbsp;IPMP</a></p>
<p class="toc level2"><a href="mpoverview.html">30.&nbsp;&nbsp;Introducing IPMP (Overview)</a></p>
<p class="toc level2"><a href="deploynetmult-56.html">31.&nbsp;&nbsp;Administering IPMP (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="ipqostm-1.html">Part&nbsp;VI&nbsp;IP Quality of Service (IPQoS)</a></p>
<p class="toc level2"><a href="ipqos-intro-1.html">32.&nbsp;&nbsp;Introducing IPQoS (Overview)</a></p>
<p class="toc level2"><a href="ipqos-config-planning-1.html">33.&nbsp;&nbsp;Planning for an IPQoS-Enabled Network (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-policy-planning-1.html">34.&nbsp;&nbsp;Creating the IPQoS Configuration File (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-isp-setup-1.html">35.&nbsp;&nbsp;Starting and Maintaining IPQoS (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-accounting-1.html">36.&nbsp;&nbsp;Using Flow Accounting and Statistics Gathering (Tasks)</a></p>
<p class="toc level2"><a href="ipqos-reference-1.html">37.&nbsp;&nbsp;IPQoS in Detail (Reference)</a></p>
<p class="toc level1 tocsp"><a href="glossary-1.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="ike-task-15"></a><h3>Configuring IKE With Preshared Keys</h3>
<p>Preshared keys is the simplest authentication method for IKE. If you are configuring
two systems to use IKE, and you are the administrator for both of
the systems, using preshared keys is a good choice. However, unlike public key
certificates, preshared keys are tied to particular IP addresses. Preshared keys cannot be
used with mobile systems or systems that might be renumbered. Also, when you
use preshared keys, you cannot offload IKE computations to attached hardware.</p>

<a name="ike-task-24"></a><h4>How to Configure IKE With Preshared Keys</h4><p>The IKE implementation offers algorithms whose keys vary in length. The key length
that you choose is determined by site security. In general, longer keys provide
more security than shorter keys.</p><p>These procedures use the system names <tt>enigma</tt> and <tt>partym</tt>. Substitute the names of
your systems for the names <tt>enigma</tt> and <tt>partym</tt>.</p><ol>
<li><b>On the system console, assume the Primary Administrator role or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role
and assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p>
<hr><p><b>Note - </b><a name="indexterm-2019"></a>Logging in remotely exposes security-critical traffic to eavesdropping. Even if you somehow protect
the remote login, the security of the system is reduced to the security
of the remote login session.</p>
<hr>
</li>
<li><b><a name="indexterm-2020"></a>On each system, copy the file <tt>/etc/inet/ike/config.sample</tt> to the file <tt>/etc/inet/ike/config</tt>. </b></li>
<li><a name="ike-task-config-1"></a><b><a name="indexterm-2021"></a>Enter rules and global parameters in the <tt>ike/config</tt> file on each system.</b><p>The rules and global parameters in this file should permit the IPsec policy
in the system's <tt>ipsecinit.conf</tt> file to succeed. The following <tt>ike/config</tt> examples work with the
<tt>ipsecinit.conf</tt> examples in <a href="ipsec-mgtasks-4.html#ipsec-mgtasks-3">How to Secure Traffic Between Two Systems With IPsec</a>.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>For example, modify the <tt>/etc/inet/ike/config</tt> file on the <tt>enigma</tt> system:</b><pre>### ike/config file on enigma, 192.168.116.16

## Global parameters
#
## Phase 1 transform defaults
p1_lifetime_secs 14400
p1_nonce_len 40
#
## Defaults that individual rules can override.
p1_xform
  { auth_method preshared oakley_group 5 auth_alg sha encr_alg des }
p2_pfs 2
#
<tt><b>## The rule to communicate with partym # Label must be unique { label "enigma-partym" local_addr 192.168.116.16 remote_addr 192.168.13.213 p1_xform { auth_method preshared oakley_group 5 auth_alg md5 encr_alg 3des } p2_pfs 5 }</b></tt></pre>
<hr><p><b>Note - </b>All arguments to the <tt>auth_method</tt> parameter must be on the same line. </p>
<hr>
</li>
<li><b>Modify the <tt>/etc/inet/ike/config</tt> file on the <tt>partym</tt> system:</b><pre>### ike/config file on partym, 192.168.13.213
## Global Parameters
#
p1_lifetime_secs 14400
p1_nonce_len 40
#
p1_xform
  { auth_method preshared oakley_group 5 auth_alg sha encr_alg des }
p2_pfs 2

<tt><b>## The rule to communicate with enigma # Label must be unique { label "partym-enigma" local_addr 192.168.13.213 remote_addr 192.168.116.16 p1_xform { auth_method preshared oakley_group 5 auth_alg md5 encr_alg 3des } p2_pfs 5 }</b></tt></pre></li></ol></li>
<li><b><a name="indexterm-2022"></a><a name="indexterm-2023"></a><a name="indexterm-2024"></a><a name="indexterm-2025"></a><a name="indexterm-2026"></a>On each system, check the validity of the file.</b><pre># <tt><b>/usr/lib/inet/in.iked -c -f /etc/inet/ike/config</b></tt></pre></li>
<li><a name="ike-task-gennumber-1"></a><b><a name="indexterm-2027"></a><a name="indexterm-2028"></a>Generate random numbers for use as keying material. </b><p>If your site has a random number generator, use that generator. On a
Solaris system, you can use the <tt>od</tt> command. For example, the following command prints
two lines of hexadecimal numbers:</p><pre>% <tt><b>od -X -A n /dev/random | head -2</b></tt>
         f47cb0f4 32e14480 951095f8 2b735ba8
         0a9467d0 8f92c880 68b6a40e 0efe067d</pre><p>For an explanation of the <tt>od</tt> command, see <a href="ipsec-mgtasks-4.html#ipsec-mgtasks-12">How to Generate Random Numbers on a Solaris System</a> and the <a href="http://docs.sun.com/doc/819-2239/od-1?a=view"><tt>od</tt>(1)</a> man
page.</p>
<hr><p><b>Note - </b>Other operating systems can require ASCII keying material. To generate the identical key
in hexadecimal and ASCII formats, see <a href="#iketask-key-ex-1">Example&nbsp;23-1</a>.</p>
<hr>
</li>
<li><b>From the output of <a href="#ike-task-gennumber-1">Step&nbsp;5</a>, construct one key.</b><pre>f47cb0f432e14480951095f82b735ba80a9467d08f92c88068b6a40e</pre><p>The authentication algorithm in this procedure is MD5, as shown in <a href="#ike-task-config-1">Step&nbsp;3</a>.
The size of the hash, that is, the size of the authentication algorithm's
output, determines the minimum recommended size of a preshared key. The output of
the MD5 algorithm is 128 bits, or 32 characters. The example key is
56 characters long, which provides additional keying material for IKE to use.</p></li>
<li><b><a name="indexterm-2029"></a>Create the file <tt>/etc/inet/secret/ike.preshared</tt> on each system.</b><p>Put the preshared key in each file.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>For example, on the <tt>enigma</tt> system, the <tt>ike.preshared</tt> file would appear similar
to the following:</b><pre># ike.preshared on enigma, 192.168.116.16
#&hellip;
{ localidtype IP
    localid 192.168.116.16
    remoteidtype IP
    remoteid 192.168.13.213
    # enigma and partym's shared key in hex (192 bits)
    key f47cb0f432e14480951095f82b735ba80a9467d08f92c88068b6a40e
    }</pre></li>
<li><b>On the <tt>partym</tt> system, the <tt>ike.preshared</tt> file would appear similar to the
following:</b><pre># ike.preshared on partym, 192.168.13.213
#&hellip;
{ localidtype IP
    localid 192.168.13.213
    remoteidtype IP
    remoteid 192.168.116.16
    # partym and enigma's shared key in hex (192 bits)
    key f47cb0f432e14480951095f82b735ba80a9467d08f92c88068b6a40e
    }</pre></li></ol>
<hr><p><b>Note - </b>The preshared keys on each system must be identical.</p>
<hr>
</li></ol><a name="iketask-key-ex-1"></a>Example&nbsp;23-1 Generating Identical Key Material for Two Systems With Different Operating Systems<p><a name="indexterm-2030"></a><a name="indexterm-2031"></a><a name="indexterm-2032"></a>Solaris IPsec interoperates with other operating systems. If your system is communicating with
a system that requires ASCII preshared keys, you need to generate one key
in two formats, ASCII and hexadecimal.</p><p>In this example, the Solaris system administrator wants 56 characters of keying material.
The administrator uses the following command to generate a hexadecimal key from an
ASCII passphrase. The option <tt>-tx1</tt> prints the bytes one at a time on
all Solaris systems.</p><pre># <tt><b>/bin/echo "papiermache with cashews and\c" | od -tx1 | cut -c 8-55 | \</b></tt>
<tt><b>tr -d '\n' | tr -d ' ' | awk '{print}'</b></tt>
7061706965726d616368652077697468206361736865777320616e64</pre><p>By removing the offsets and concatenating the hexadecimal output, the hexadecimal key for
the Solaris system is <tt>7061706965726d616368652077697468206361736865777320616e64</tt>. The administrator places this value in the
<tt>ike.preshared</tt> file on the Solaris system.</p><pre># Shared key in hex (192 bits)
key 7061706965726d616368652077697468206361736865777320616e64</pre><p>On the system that requires ASCII preshared keys, the passphrase is the preshared
key. The Solaris system administrator telephones the other administrator with the passphrase, <tt>papiermache with cashews and</tt>.</p>

<a name="ike-task-10"></a><h4>How to Refresh IKE Preshared Keys</h4><a name="indexterm-2033"></a><a name="indexterm-2034"></a><a name="indexterm-2035"></a><p>This procedure assumes that you want to replace an existing preshared key at
regular intervals without rebooting. If you use a strong encryption algorithm, such 3DES
or Blowfish, you might want to refresh keys just before you reboot both
systems.</p><ol>
<li><b>On the system console, assume the Primary Administrator role or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role
and assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p>
<hr><p><b>Note - </b>Logging in remotely exposes security-critical traffic to eavesdropping. Even if you somehow protect
the remote login, the security of the system is reduced to the security
of the remote login session.</p>
<hr>
</li>
<li><b>Generate random numbers and construct a key of the appropriate length.</b><p>For details, see <a href="ipsec-mgtasks-4.html#ipsec-mgtasks-12">How to Generate Random Numbers on a Solaris System</a>.  If you are generating a preshared key
for a Solaris system that is communicating with an operating system that requires ASCII,
see <a href="#iketask-key-ex-1">Example&nbsp;23-1</a>.</p></li>
<li><b>Replace the current key with a new key.</b><p>For example, on the hosts <tt>enigma</tt> and <tt>partym</tt>, you would replace the value of
<tt>key</tt> in the <tt>/etc/inet/secret/ike.preshared</tt> file with a new number of the same
length.</p></li>
<li><b><a name="indexterm-2036"></a><a name="indexterm-2037"></a><a name="indexterm-2038"></a><a name="indexterm-2039"></a>Check the privilege level of the <tt>in.iked</tt> daemon.</b><pre># <tt><b>/usr/sbin/ikeadm get priv</b></tt>
Current privilege level is 0x0, base privileges enabled</pre><p>You can change the keying material if the command returns a privilege level
of <tt>0x1</tt> or <tt>0x2</tt>. Level <tt>0x0</tt> does not permit operations to modify or
view keying material. By default, the <tt>in.iked</tt> daemon runs at the <tt>0x0</tt>
level of privilege.</p><ul>
<li><b><a name="indexterm-2040"></a>If the privilege level is <tt>0x0</tt>, kill and restart the daemon.</b><p>When the daemon restarts, it reads the new version of the <tt>ike.preshared</tt> file.</p><pre># <tt><b>pkill in.iked</b></tt>
# <tt><b>/usr/lib/inet/in.iked</b></tt></pre></li>
<li><b>If the privilege level is <tt>0x1</tt> or <tt>0x2</tt>, read in the new version
of the <tt>ike.preshared</tt> file.</b><pre># <tt><b>ikeadm read preshared</b></tt></pre></li></ul></li></ol>

<a name="ike-task-18"></a><h4>How to Add an IKE Preshared Key for a New Policy Entry in <tt>ipsecinit.conf</tt></h4><a name="indexterm-2041"></a><p>You must have one preshared key for every policy entry in the
<tt>ipsecinit.conf</tt> file. If you add a new policy entry while IPsec and
IKE are running, the <tt>in.iked</tt> daemon can read in new keys.</p><h6>Before You Begin</h6><p>This procedure assumes the following:</p>
<ul><li><p>The <tt>enigma</tt> system is set up as described in <a href="#ike-task-24">How to Configure IKE With Preshared Keys</a>.</p></li>
<li><p>The <tt>enigma</tt> system is going to protect its traffic with a new system, <tt>ada</tt>.</p></li>
<li><p>The <tt>in.iked</tt> daemon is running on both systems.</p></li>
<li><p>The systems' interfaces are included as entries in the <tt>/etc/hosts</tt> file on both systems. The following entry is an example.</p><pre>192.168.15.7 ada
192.168.116.16 enigma</pre><p>This procedure also works with an IPv6 address. In Solaris Express, Developer Edition 2/07, IPv6 addresses are placed in the <tt>/etc/hosts</tt> file.</p></li>
<li><p>You have added a new policy entry to the <tt>/etc/inet/ipsecinit.conf</tt> file on both systems. The entries appear similar to the following:</p><pre># ipsecinit.conf file for enigma
{laddr enigma raddr ada} ipsec {auth_algs any encr_algs any sa shared}</pre><pre># ipsecinit.conf file for ada
{laddr ada raddr enigma} ipsec {auth_algs any encr_algs any sa shared}</pre></li></ul>
<ol>
<li><b>On the system console, assume the Primary Administrator role or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role
and assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p>
<hr><p><b>Note - </b>Logging in remotely exposes security-critical traffic to eavesdropping. Even if you somehow protect
the remote login, the security of the system is reduced to the security
of the remote login session.</p>
<hr>
</li>
<li><a name="ike-task-rule-1"></a><b>Create a rule for IKE to manage the keys for <tt>enigma</tt> and <tt>ada</tt>.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>For example, the rule in the <tt>/etc/inet/ike/config</tt> file on the <tt>enigma</tt> system appears
similar to the following:</b><pre>### ike/config file on enigma, 192.168.116.16
&hellip;
## The rule to communicate with ada

{label "enigma-to-ada"
 local_addr 192.168.116.16
 remote_addr 192.168.15.7
 p1_xform
 {auth_method preshared oakley_group 5 auth_alg md5 encr_alg blowfish}
 p2_pfs 5
    }</pre></li>
<li><b>The rule in the <tt>/etc/inet/ike/config</tt> file on the <tt>ada</tt> system appears similar to
the following:</b><pre>### ike/config file on ada, 192.168.15.7
&hellip;
## The rule to communicate with enigma

{label "ada-to-enigma"
 local_addr 192.168.15.7
 remote_addr 192.168.116.16
 p1_xform
 {auth_method preshared oakley_group 5 auth_alg md5 encr_alg blowfish}
 p2_pfs 5
}</pre></li></ol></li>
<li><b>Check the privilege level of the <tt>in.iked</tt> daemon.</b><pre># <tt><b>/usr/sbin/ikeadm get priv</b></tt>
Current privilege level is 0x0, base privileges enabled</pre><ul>
<li><b>If the privilege level is <tt>0x1</tt> or <tt>0x2</tt>, continue with the next step.</b></li>
<li><b><a name="indexterm-2042"></a><a name="indexterm-2043"></a>If the privilege level is <tt>0x0</tt>, stop the daemon. Then, restart the daemon
with the appropriate privilege level.</b><pre># <tt><b>pkill in.iked</b></tt>
# <tt><b>/usr/lib/inet/in.iked -p 2</b></tt>
Setting privilege level to 2!</pre></li></ul></li>
<li><b>Generate random numbers and construct a key of 64 to 448 bits.</b><p>For details, see <a href="ipsec-mgtasks-4.html#ipsec-mgtasks-12">How to Generate Random Numbers on a Solaris System</a>.  If you are generating a preshared key
for a Solaris system that is communicating with an operating system that requires
ASCII, see <a href="#iketask-key-ex-1">Example&nbsp;23-1</a>.</p></li>
<li><b>By some means, send the key to the administrator of the remote system.</b><p>You both need to add the same preshared key at the same time.
Your key is only as safe as the safety of your transmission
mechanism. An out-of-band mechanism, such as registered mail or a protected fax machine, is
best.</p></li>
<li><b><a name="indexterm-2044"></a><a name="indexterm-2045"></a><a name="indexterm-2046"></a><a name="indexterm-2047"></a>Add the new keying material with the <tt>add preshared</tt> subcommand in <tt>ikeadm</tt> command mode.</b><pre>ikeadm> add preshared { localidtype <i>id-type</i> localid <i>id</i>
remoteidtype <i>id-type</i> remoteid <i>id</i> ike_mode <i>mode</i> key <i>key</i> }</pre><dl><dt><i>id-type</i></dt>
<dd><p>Specifies the type of the <i>id</i>.</p></dd>
<dt><i>id</i></dt>
<dd><p>Specifies the IP address when <i>id-type</i> is IP.</p></dd>
<dt><i>mode</i></dt>
<dd><p><a name="indexterm-2048"></a>Specifies the IKE mode. The only accepted value is <tt>main</tt>.</p></dd>
<dt><i>key</i></dt>
<dd><p>Specifies the preshared key in hexadecimal format.</p></dd>
</dl>
<ol style="list-style-type: lower-alpha">
				 
<li><b>For example, on host <tt>enigma</tt>, you would add the key for the remote
system, <tt>ada</tt>, and exit the <tt>ikeadm</tt> interactive mode.</b><pre># <tt><b>ikeadm</b></tt>
ikeadm> <tt><b>add preshared { localidtype ip localid 192.168.116.16</b></tt>
<tt><b>remoteidtype ip remoteid 192.168.15.7</b></tt>
<tt><b>key 8d1fb4ee500e2bea071deb2e781cb48374411af5a9671714672bb1749ad9364d }</b></tt>
ikeadm: Successfully created new preshared key.
ikeadm> <tt><b>exit</b></tt>
#</pre></li>
<li><b>On host <tt>ada</tt>, you would add the identical key for the remote system,
<tt>enigma</tt>, and exit the interactive mode.</b><pre># <tt><b>ikeadm</b></tt>
ikeadm> <tt><b>add preshared { localidtype ip localid 192.168.15.7</b></tt>
<tt><b>remoteidtype ip remoteid 192.168.116.16</b></tt>
<tt><b>key 8d1fb4ee500e2bea071deb2e781cb48374411af5a9671714672bb1749ad9364d }</b></tt>
ikeadm: Successfully created new preshared key.
ikeadm> <tt><b>exit</b></tt>
#</pre></li></ol></li>
<li><b><a name="indexterm-2049"></a><a name="indexterm-2050"></a><a name="indexterm-2051"></a><a name="indexterm-2052"></a><a name="indexterm-2053"></a>On each system, lower the privilege level of the <tt>in.iked</tt> daemon.</b><pre># <tt><b>ikeadm set priv base</b></tt></pre></li>
<li><b><a name="indexterm-2054"></a><a name="indexterm-2055"></a>On each system, activate the <tt>ipsecinit.conf</tt> file to secure the added interface.</b><pre># <tt><b>ipsecconf -a /etc/inet/ipsecinit.conf</b></tt></pre>
<hr><p><b>Caution - </b>Read the warning when you execute the <tt>ipsecconf</tt> command. The same warning applies
to restarting the <tt>in.iked</tt> daemon. A socket that is already latched, that is,
the socket is in use, provides an unsecured back door into the system.
For more extensive discussion, see <a href="ipsecref-23.html#ipsecref-42">Security Considerations for <tt>ipsecinit.conf</tt> and <tt>ipsecconf</tt></a>.</p>
<hr>
</li>
<li><b>On each system, read in the new rules by using the <tt>ikeadm</tt>
command.</b><pre># <tt><b>ikeadm read rules</b></tt></pre><p>You created the rules in <a href="#ike-task-rule-1">Step&nbsp;2</a>. Because the rules are in the <tt>/etc/inet/ike/config</tt>
file, the name of the file does not have to be specified to
the <tt>ikeadm</tt> command.</p></li>
<li><b>Ensure that IKE preshared keys are available at reboot.</b><p>Add the keys to the <tt>/etc/inet/secret/ike.preshared</tt> file.</p><ol style="list-style-type: lower-alpha">
				 
<li><b><a name="indexterm-2056"></a>For example, on the <tt>enigma</tt> system, you would add the following keying information
to the <tt>ike.preshared</tt> file:</b><pre># ike.preshared on enigma for the ada interface
#&hellip;
{ localidtype IP
  localid 192.168.116.16
  remoteidtype IP
  remoteid 192.168.15.7
  # enigma and ada's shared key in hex (32 - 448 bits required)
  key 8d1fb4ee500e2bea071deb2e781cb48374411af5a9671714672bb1749ad9364d
}</pre></li>
<li><b>On the <tt>ada</tt> system, you would add the following keying information to the
<tt>ike.preshared</tt> file:</b><pre># ike.preshared on ada for the enigma interface
#&hellip;
{ localidtype IP
  localid 192.168.15.7
  remoteidtype IP
  remoteid 192.168.116.16
  # ada and enigma's shared key in hex (32 - 448 bits required)
  key 8d1fb4ee500e2bea071deb2e781cb48374411af5a9671714672bb1749ad9364d
}</pre></li></ol></li>
<li><b>Verify that the systems can communicate.</b><p>See <a href="#ike-task-44">How to Verify That IKE Preshared Keys Are Identical</a>.</p></li></ol>

<a name="ike-task-44"></a><h4>How to Verify That IKE Preshared Keys Are Identical</h4><p>If the preshared keys on the communicating systems are not identical, the systems
cannot authenticate.</p><h6>Before You Begin</h6><p>IPsec has been configured and is enabled between the two systems that you
are testing.</p><ol>
<li><b>On the system console, assume the Primary Administrator role or become superuser.</b><p>The Primary Administrator role includes the Primary Administrator profile. To create the role
and assign the role to a user, see <a href="http://docs.sun.com/doc/819-2379/smcover-1?a=view">Chapter 2, Working With the Solaris Management Console (Tasks), in <i>System Administration Guide: Basic Administration</i></a>.</p>
<hr><p><b>Note - </b>Logging in remotely exposes security-critical traffic to eavesdropping. Even if you somehow protect
the remote login, the security of the system is reduced to the security
of the remote login session.</p>
<hr>
</li>
<li><b><a name="indexterm-2057"></a><a name="indexterm-2058"></a><a name="indexterm-2059"></a><a name="indexterm-2060"></a>Check the privilege level of the <tt>in.iked</tt> daemon.</b><pre># <tt><b>/usr/sbin/ikeadm get priv</b></tt>
Current privilege level is 0x0, base privileges enabled</pre><ul>
<li><b>If the privilege level is <tt>0x1</tt> or <tt>0x2</tt>, continue with the next step.</b></li>
<li><b><a name="indexterm-2061"></a><a name="indexterm-2062"></a>If the privilege level is <tt>0x0</tt>, stop the daemon. Then, restart the daemon
with the appropriate privilege level.</b><pre># <tt><b>pkill in.iked</b></tt>
# <tt><b>/usr/lib/inet/in.iked -p 2</b></tt>
Setting privilege level to 2!</pre></li></ul></li>
<li><b>On each system, view the preshared key information.</b><pre># <tt><b>ikeadm dump preshared</b></tt>
PSKEY: Preshared key (24 bytes): f47cb&hellip;/192
LOCIP: AF_INET: port 0, 192.168.116.16 (enigma).
REMIP: AF_INET: port 0, 192.168.13.213 (partym).</pre></li>
<li><b>Compare the two dumps.</b><p>If the preshared keys are not identical, replace one key with the other
key in the <tt>/etc/inet/secret/ike.preshared</tt> file.</p></li>
<li><b>When the verification is complete, lower the privilege level of the <tt>in.iked</tt> daemon
on each system.</b><pre># <tt><b>ikeadm set priv base</b></tt></pre></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ike-task-13.html">Previous</a>
             </td>
             <td align="right">
                 <a href="ike-task-12.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

