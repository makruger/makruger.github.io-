<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Managing CIFS Mounts in Your Local Environment (Task Map) - Solaris CIFS Administration Guide</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-05-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">Solaris CIFS Administration Guide</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="smbclienttasks.html">Previous</a>
             </td>
             <td align="right">
                 <a href="smbclientadmintaskstm.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="smboverview.html">1.&nbsp;&nbsp;Windows Interoperability (Overview)</a></p>
<p class="toc level1 tocsp"><a href="idmappingtasks.html">2.&nbsp;&nbsp;Identity Mapping Administration (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="smbservertasks.html">3.&nbsp;&nbsp;Solaris CIFS Service Administration (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="smbclienttasks.html">4.&nbsp;&nbsp;Solaris CIFS Client Administration (Tasks)</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Managing CIFS Mounts in Your Local Environment (Task Map)</a></p>
</div>
<p class="toc level2"><a href="smbclientadmintaskstm.html">Managing CIFS Mounts in the Global Environment (Task Map)</a></p>
<p class="toc level1 tocsp"><a href="troubleshooting.html">5.&nbsp;&nbsp;Solaris CIFS Troubleshooting</a></p>
<p class="toc level1 tocsp"><a href="glossary.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="smbclientusertaskstm"></a><h3>Managing CIFS Mounts in Your Local Environment (Task Map)</h3>
<a name="indexterm-145"></a><p>The following table points to the tasks that a regular user can
perform to manage CIFS mounts.</p><table><col width="33%"><col width="33%"><col width="33%"><tr><th align="left" valign="top" scope="column"><p>Task</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
<th align="left" valign="top" scope="column"><p>For Instructions</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Find the shares that are available on
a CIFS server in your domain.</p></td>
<td align="left" valign="top" scope="row"><p>From a particular CIFS server, view the
shares that you can mount on a directory that you own.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#findsharestask">How to Find Available Shares on a Known File Server</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Mount a
CIFS share on a directory that you own.</p></td>
<td align="left" valign="top" scope="row"><p>Use the <tt>mount</tt> command to
mount the share on a mount point that you own.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#mountsharetask">How to Mount a Share on a Directory You Own</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>View the list
of CIFS shares that are mounted on the system.</p></td>
<td align="left" valign="top" scope="row"><p>View the list of
mounted CIFS shares.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#viewmountedsharestask">How to View the List of Mounted CIFS Shares</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Unmount a CIFS share from a directory that you own.</p></td>
<td align="left" valign="top" scope="row"><p>When
you no longer need access to a CIFS share, you can unmount
it.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#unmountsharetask">How to Unmount a Share From a Directory You Own</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Store a persistent password to be used for authentication.</p></td>
<td align="left" valign="top" scope="row"><p>When you store a
persistent password, you can bypass the manual authentication required each time that
you want to mount a share from the specified server.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#storepasswordtask">How to Store a Persistent Password</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Use a PAM
module to store a persistent password to be used for authentication.</p></td>
<td align="left" valign="top" scope="row"><p>Use this
optional functionality only in environments that do not run Active Directory or
Kerberos, but which synchronize passwords between Solaris clients and their CIFS/SMB servers.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#pammoduletask">How to Configure the PAM Module to Store a Persistent Password</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Delete
a persistent password.</p></td>
<td align="left" valign="top" scope="row"><p>If you no longer want to store a persistent password,
delete it.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#deletepasswordtask">How to Delete a Persistent Password</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Customize your environment by using a <tt>$HOME/.nsmbrc</tt> file.</p></td>
<td align="left" valign="top" scope="row"><p>You can customize your
Solaris CIFS environment by specifying values for Solaris CIFS client properties.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#customizeenvtask">How to Customize Your Solaris CIFS Environment</a></p></td>
</tr>
</table>

<a name="findsharestask"></a><h4>How to Find Available Shares on a Known File Server</h4><a name="indexterm-146"></a><a name="indexterm-147"></a><ol>
<li><b>Determine the server that you want to query about available shares.</b><p>If you are not familiar with the CIFS file servers available in
your domain, contact your system administrator. You might be able to use
Network Neighborhood on Windows systems or the Sun Java<sup>TM</sup> Desktop System file
browser to browse for available CIFS shares.</p></li>
<li><b>List the available CIFS shares on a server.</b><pre>$ <tt><b>smbutil view [-A | -U </tt><i>user</i><tt>] //[</tt><i>domain</i><tt>;][</tt><i>user</i><tt>[:</tt><i>password</i><tt>]@]</tt><i>server</i><tt></b></tt></pre><p><tt>//</tt>[<i>domain</i><tt>;</tt>][<i>user</i>[<tt>:</tt><i>password</i>]<tt>@</tt>]<i>server</i> is a resource name. <i>user</i> is the user name with which
you connect to the CIFS server, <i>server</i>. You can optionally specify the
domain name and the password of the user that you specified on
the command line.</p><p>The <tt>-A</tt> option enables you to view shares anonymously, and you are
not prompted for a password. The <tt>-U</tt> <i>user</i> option indicates the user
with which to authenticate on the specified server.</p></li>
<li><b>When prompted, enter the password for the user that you specified on
the CIFS server.</b><p>If you specified the <tt>-A</tt> option to view shares anonymously, you are
not prompted for a password.</p><p>If you did not specify a user, enter the password associated with
your user name.</p></li>
<li><b>View the list of available CIFS shares.</b><p>The <tt>smbutil view</tt> output shows the name of the share, its type, and
an optional text description of the share.</p><p>Most shares have a type of <tt>disk</tt> because the shares are files
and directories. The other share types are as follows:</p>
<ul><li><p><tt>IPC</tt> <b>&ndash;</b> Represents an interprocess communication (IPC) device, such as a pipe or a mailslot</p></li>
<li><p><tt>printer</tt> <b>&ndash;</b> Represents a printer queue</p></li>
<li><p><tt>device</tt> <b>&ndash;</b> Represents a communications device</p></li></ul>
<p>For example, the following command shows how to view the shares on
the <tt>solarsystem</tt> server:</p><pre>$ <tt><b>smbutil view //cal@solarsystem</b></tt>
Password:
Share        Type       Comment
-------------------------------
netlogon     disk       Network Logon Service
ipc$         IPC        IPC Service (Samba Server)
tmp          disk       Temporary file space
public       disk       Public Stuff
ethereal     disk
root         disk       Home Directories

6 shares listed from 6 available</pre>
<hr><p><b>Note - </b>The Solaris CIFS client does not support <tt>device</tt> shares.</p>
<hr>
<p>The following command enables you to anonymously view the shares on the
<tt>solarsystem</tt> server:</p><pre>$ <tt><b>smbutil view -A //solarsystem</b></tt></pre></li></ol>

<a name="mountsharetask"></a><h4>How to Mount a Share on a Directory You Own</h4><a name="indexterm-148"></a><a name="indexterm-149"></a>
<hr><p><b>Note - </b>If you own the directory on which you want to mount a
share, you can perform the mount operation yourself. If you do not
own the directory, you must perform the mount operation as the owner
of the directory or as superuser.</p>
<hr>
<ol>
<li><b>Find the share that you want to mount from a server.</b><pre>$ <tt><b>smbutil view //</tt><i>server</i><tt></b></tt></pre></li>
<li><b>Enter your password at the prompt.</b></li>
<li><b>Perform the mount on your directory.</b><pre>$ <tt><b>mount -F smbfs //[</tt><i>workgroup</i><tt>;][</tt><i>user</i><tt>[:</tt><i>password</i><tt>]@]</tt><i>server</i><tt>/</tt><i>share</i><tt> </tt><i>mount-point</i><tt></b></tt></pre><p>For example, to mount the <tt>/tmp</tt> share from the <tt>solarsystem</tt> server on
the <tt>/mnt</tt> mount point, type:</p><pre>$ <tt><b>mount -F smbfs //solarsystem/tmp /mnt</b></tt></pre></li></ol>

<a name="viewmountedsharestask"></a><h4>How to View the List of Mounted CIFS Shares</h4><a name="indexterm-150"></a><a name="indexterm-151"></a><p>This procedure shows how to list all of the CIFS shares that
are mounted on your system. The resulting list includes your mounts, other
users' mounts, and multiuser mounts created by the system administrator.</p><ul>
<li><b>List all CIFS mounts.</b><p>Use one of the following commands to list the mounted CIFS shares:</p><ul>
<li><b>Use the <tt>mount</tt> command.</b><pre>$ <tt><b>mount -v | grep 'type smbfs'</b></tt>
//root@solarsystem/tmp on /mnt type smbfs read/write/setuid/devices/dev=5080000
  on Tue Feb 12 11:40:18 2008
//root@solarsystem/files on /files type smbfs read/write/setuid/devices/dev=4800000
  on Mon Feb 11 22:17:56 2008</pre></li>
<li><b>Use the <tt>df -k -F smbfs</tt> command.</b><pre>$ <tt><b>df -k -F smbfs</b></tt>
//root@solarsystem/tmp      1871312   70864 1800448     4%    /mnt
//root@solarsystem/files    8067749    8017 7979055     1%    /files</pre></li></ul></li></ul>

<a name="unmountsharetask"></a><h4>How to Unmount a Share From a Directory You Own</h4><a name="indexterm-152"></a><a name="indexterm-153"></a><p>To successfully unmount a share, you must own the mount point on
which the share is mounted.</p><ol>
<li><b>Determine the mount point of the share that you want to unmount.</b><p>Use one of the following commands to find shares that are mounted
from a CIFS server:</p><ul>
<li><b>Use the <tt>mount</tt> command.</b><pre>$ <tt><b>mount -v | grep 'type smbfs'</b></tt>
//root@solarsystem/tmp on /mnt type smbfs read/write/setuid/devices/dev=5080000
  on Tue Feb 12 11:40:18 2008
//root@solarsystem/files on /files type smbfs read/write/setuid/devices/dev=4800000
  on Mon Feb 11 22:17:56 2008</pre></li>
<li><b>Use the <tt>df -k -F smbfs</tt> command.</b><pre>$ <tt><b>df -k -F smbfs</b></tt>
//root@solarsystem/tmp      1871312   70864 1800448     4%    /mnt
//root@solarsystem/files    8067749    8017 7979055     1%    /files</pre></li></ul></li>
<li><b>Unmount the share by specifying the name of the mount point, <tt>/mnt</tt>
or <tt>/files</tt> in the previous step.</b><p>For example:</p><pre>$ <tt><b>umount /mnt</b></tt></pre></li></ol>

<a name="storepasswordtask"></a><h4>How to Store a Persistent Password</h4><a name="indexterm-154"></a><a name="indexterm-155"></a><p>Interactions with a CIFS file server require authentication. For instance, when you
view the shares available on a server or you try to mount
a share on your system, the transaction is authenticated.</p>
<hr><p><b>Note - </b>A persistent password is not needed when Kerberos is configured on the
client and server and you have a Kerberos ticket-granting ticket (TGT). In
such configurations, you can view and mount shares without specifying a password.</p>
<hr>
<p>You can supply the password each time that you make a connection
to the server, or you can store a <a href="glossary.html#glossarypersistentpassword"><b>persistent password</b></a> to be automatically
used for these transactions.</p>
<hr><p><b>Note - </b>You can store a persistent password for each user on the CIFS
server that you use to access shares.</p>
<hr>
<p>The password you store persists until any of the following occur:</p>
<ul><li><p>The CIFS client is rebooted.</p></li>
<li><p>The <tt>smbutil logout</tt> command is run for the user.</p></li>
<li><p>The <tt>smbutil logoutall</tt> command is run by superuser.</p></li></ul>
<ul>
<li><b>Store the persistent password for the CIFS server.</b><pre>$ <tt><b>smbutil login </tt><i>user</i><tt></b></tt>
Password:</pre><p>The following command stores the persistent password for <tt>terry@solarsystem</tt>. Each time Terry
performs a transaction with <tt>solarsystem</tt>, the persistent password is used to perform
the authentication.</p><pre>$ <tt><b>smbutil login terry@solarsystem</b></tt>
Password:</pre></li></ul>

<a name="pammoduletask"></a><h4>How to Configure the PAM Module to Store a Persistent Password</h4><a name="indexterm-156"></a><a name="indexterm-157"></a><p>When installed, the <tt>pam_smbfs_login.so.1</tt> module enables you to store a persistent password
the same as if you had run the <tt>smbutil login</tt> command for <tt>PAM_USER</tt>
in the user's or system's default domain.</p><p>This optional functionality is meant to be used only in environments that
do not run Active Directory or Kerberos, but which synchronize passwords between
Solaris clients and their CIFS/SMB servers.</p><p>For more information, see the <a href="http://docs.sun.com/doc/819-2252/pam-smbfs-login-5?a=view"><tt>pam_smbfs_login</tt>(5)</a> man page.</p><ol>
<li><b>Use your login name and password to store a persistent password.</b><p>Add the following line to the <tt>/etc/pam.conf</tt> file after the other <tt>login</tt>
entries:</p><pre>login   auth optional           pam_smbfs_login.so.1</pre><p>This action adds a persistent password entry as if you had run
the <tt>smbutil login</tt> command.</p>
<hr><p><b>Note - </b>The PAM module implements a privilege to permit it to run as
superuser to store your password.</p>
<hr>
</li>
<li><b>Verify that your persistent password is stored.</b><pre>$ <tt><b>smbutil login -c </tt><i>user</i><tt></b></tt></pre></li></ol><a name="configuringpammodule"></a>Example&nbsp;4-1 Configuring the PAM Module to Store a Persistent Password<p>The following example shows how the domain is chosen. The system default
is <tt>WORKGROUP</tt>. The <tt>WORKGROUP</tt> domain is overridden by any default from SMF,
and finally by any default from the user's <tt>.nsmbrc</tt> file.</p><p>This example shows a default domain in SMF and for user <tt>terry</tt>:</p><pre># <tt><b>sharectl set -p section=default -p domain=AAA smbfs</b></tt>
# <tt><b>sharectl get smbfs</b></tt>
[default]
domain=AAA</pre><p>A <tt>root</tt> login uses the domain from SMF:</p><pre># <tt><b>smbutil login -c terry</b></tt>
Keychain entry exists for AAA/terry.</pre><p>A login as <tt>terry</tt> uses the domain from the <tt>~terry/.nsmbrc</tt> file:</p><pre>$ <tt><b>ls /.nsmbrc</b></tt>
/.nsmbrc: No such file or directory

$ <tt><b>cat ~/.nsmbrc</b></tt>
[default]
domain=MYDOMAIN
$ <tt><b>ls -l ~/.nsmbrc</b></tt>
-rw-r--r--   1 terry  staff         26 Feb 13 10:15 /home/terry/.nsmbrc
$ <tt><b>smbutil login terry</b></tt>
Keychain entry exists for MYDOMAIN/terry.</pre><p>If Terry puts a password in <tt>~terry/.nsmbrc</tt>, he must remove read permission.
Also, because Terry's home directory is on an NFS server, the PAM
module running as <tt>root</tt> cannot access Terry's file, so Terry would see
the following and use the SMF domain instead:</p><pre>$ <tt><b>chmod 400 .nsmbrc</b></tt>
$ <tt><b>logout</b></tt>

solarsystem console login: <tt><b>terry</b></tt>
Password:
Can't open /home/terry/.nsmbrc: Permission denied
$ <tt><b>su</b></tt>
Password:
# <tt><b>smbutil login -c terry</b></tt>
Keychain entry exists for AAA/terry.</pre>

<a name="deletepasswordtask"></a><h4>How to Delete a Persistent Password</h4><a name="indexterm-158"></a><a name="indexterm-159"></a><p>Use this procedure to delete persistent passwords that are stored by the
<tt>smbutil login</tt> command.</p><p>If you want to delete <b>all</b> persistent passwords, see <a href="smbclientadmintaskstm.html#deleteallpasswordstask">How to Delete All Persistent Passwords</a>.</p><ul>
<li><b>Delete a persistent password for the specified server by doing one of
the following:</b><ul>
<li><b>To delete the persistent password for a specified user, type:</b><pre>$ <tt><b>smbutil logout </tt><i>user</i><tt>@</tt><i>server</i><tt></b></tt></pre><p>For example, the following command removes the persistent password for <tt>terry@solarsystem</tt>:</p><pre>$ <tt><b>smbutil logout terry@solarsystem</b></tt></pre><p>After the password is deleted, Terry is prompted for his password each
time that he performs a transaction with <tt>solarsystem</tt>.</p></li>
<li><b>To delete the password for the user running the <tt>smbutil logout</tt> command, type:</b><pre>$ <tt><b>smbutil logout </tt><i>server</i><tt></b></tt></pre><p>For example, when user <tt>dana</tt> runs the following command, he removes his
persistent password for <tt>solarsystem</tt>:</p><pre>$ <tt><b>smbutil logout solarsystem</b></tt></pre><p>After the password is deleted, Dana is prompted for his password each
time that he performs a transaction with <tt>solarsystem</tt>.</p></li></ul></li></ul>

<a name="customizeenvtask"></a><h4>How to Customize Your Solaris CIFS Environment</h4><a name="indexterm-160"></a><a name="indexterm-161"></a><p>You can customize your Solaris CIFS environment by creating a <tt>.nsmbrc</tt> configuration
file in your home directory. For more information about the <tt>.nsmbrc</tt> file
format, see the <a href="http://docs.sun.com/doc/819-2251/nsmbrc-4?a=view"><tt>nsmbrc</tt>(4)</a> man page.</p><ol>
<li><b>Create a file called <tt>.nsmbrc</tt> file in your home directory.</b></li>
<li><b>Edit the <tt>.nsmbrc</tt> file to specify values for Solaris CIFS client properties.</b><p>This example shows how user <tt>terry</tt> can configure the <tt>example.com</tt> environment by
placing this <tt>.nsmbrc</tt> configuration file in his home directory.</p><p>The default section describes the default domain, which is called <tt>SALES</tt>, and
sets a default user of <tt>MYUSER</tt>. These default settings are inherited by
other sections unless property values are overridden.</p><p><tt>FSERVER</tt> is a server section that defines a server called <tt>fserv.example.com</tt>. It
is part of the <tt>SALES</tt> domain.</p><p><tt>RSERVER</tt> is a server section that defines a server called <tt>rserv.example.com</tt> that
belongs to a new domain called <tt>REMGROUP</tt>.</p><pre># Configuration file for example.com
# Specify the Windows account name to use everywhere.
[default]
domain=SALES
user=MYUSER

# The 'FSERVER' is server in our domain.
[FSERVER]
addr=fserv.example.com

# The 'RSERVER' is a server in another domain.
[RSERVER]
domain=REMGROUP
addr=rserv.example.com</pre></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="smbclienttasks.html">Previous</a>
             </td>
             <td align="right">
                 <a href="smbclientadmintaskstm.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

