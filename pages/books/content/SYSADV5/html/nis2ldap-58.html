<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>NIS-to-LDAP Troubleshooting - System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2009-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="nis2ldap-24.html">Previous</a>
             </td>
             <td align="right">
                 <a href="nis2ldap-42.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="intro-1.html">Part&nbsp;I&nbsp;About Naming and Directory Services</a></p>
<p class="toc level2"><a href="intro2ns-2.html">1.&nbsp;&nbsp;Naming and Directory Services (Overview)</a></p>
<p class="toc level2"><a href="a12swit-86415.html">2.&nbsp;&nbsp;The Name Service Switch (Overview)</a></p>
<p class="toc level1 tocsp"><a href="dnsadmin-1.html">Part&nbsp;II&nbsp;DNS Setup and Administration</a></p>
<p class="toc level2"><a href="dnsref-1.html">3.&nbsp;&nbsp;DNS Setup and Administration (Reference)</a></p>
<p class="toc level1 tocsp"><a href="nissetup-1.html">Part&nbsp;III&nbsp;NIS Setup and Administration</a></p>
<p class="toc level2"><a href="anis1-25461.html">4.&nbsp;&nbsp;Network Information Service (NIS) (Overview)</a></p>
<p class="toc level2"><a href="cnis1-25208.html">5.&nbsp;&nbsp;Setting Up and Configuring NIS Service</a></p>
<p class="toc level2"><a href="anis2-22217.html">6.&nbsp;&nbsp;Administering NIS (Tasks)</a></p>
<p class="toc level2"><a href="abtrbl-18694.html">7.&nbsp;&nbsp;NIS Troubleshooting</a></p>
<p class="toc level1 tocsp"><a href="ldapsetup-1.html">Part&nbsp;IV&nbsp;LDAP Naming Services Setup and Administration</a></p>
<p class="toc level2"><a href="overview-1.html">8.&nbsp;&nbsp;Introduction to LDAP Naming Services (Overview/Reference)</a></p>
<p class="toc level2"><a href="ldapsecure-1.html">9.&nbsp;&nbsp;LDAP Basic Components and Concepts (Overview)</a></p>
<p class="toc level2"><a href="planldap-1.html">10.&nbsp;&nbsp;Planning Requirements for LDAP Naming Services (Tasks)</a></p>
<p class="toc level2"><a href="sundssetup-13.html">11.&nbsp;&nbsp;Setting Up Sun Java System Directory Server With LDAP Clients (Tasks)</a></p>
<p class="toc level2"><a href="clientsetup-1.html">12.&nbsp;&nbsp;Setting Up LDAP Clients (Tasks)</a></p>
<p class="toc level2"><a href="setupproblems-1.html">13.&nbsp;&nbsp;LDAP Troubleshooting (Reference)</a></p>
<p class="toc level2"><a href="schemas-1.html">14.&nbsp;&nbsp;LDAP General Reference (Reference)</a></p>
<p class="toc level2"><a href="nis2ldap-34.html">15.&nbsp;&nbsp;Transitioning From NIS to LDAP (Overview/Tasks)</a></p>
<p class="toc level3"><a href="nis2ldap-35.html">NIS-to-LDAP Service Overview</a></p>
<p class="toc level3"><a href="nis2ldap-6.html">Transitioning From NIS to LDAP (Task Map)</a></p>
<p class="toc level3"><a href="nis2ldap-15.html">Prerequisites for the NIS-to-LDAP Transition</a></p>
<p class="toc level3"><a href="nis2ldap-2.html">Setting Up the NIS-to-LDAP Service</a></p>
<p class="toc level3"><a href="nis2ldap-16.html">NIS-to-LDAP Best Practices With Sun Java System Directory Server</a></p>
<p class="toc level3"><a href="nis2ldap-24.html">NIS-to-LDAP Restrictions</a></p>
<div class="onpage">
<p class="toc level3"><a href="">NIS-to-LDAP Troubleshooting</a></p>
</div>
<p class="toc level3"><a href="nis2ldap-42.html">Reverting to NIS</a></p>
<p class="toc level2 tocsp"><a href="nisplus2ldap-1.html">16.&nbsp;&nbsp;Transitioning From NIS+ to LDAP</a></p>
<p class="toc level1 tocsp"><a href="ghnmu.html">Part&nbsp;V&nbsp;Active Directory Naming Service</a></p>
<p class="toc level2"><a href="ghnov.html">17.&nbsp;&nbsp;Setting Up Solaris Active Directory Clients</a></p>
<p class="toc level1 tocsp"><a href="whatsnew-1.html">A.&nbsp;&nbsp;Solaris 10 Software Updates to DNS, NIS, and LDAP</a></p>
<p class="toc level2"><a href="whatsnew-5.html">Service Management Facility Changes</a></p>
<p class="toc level2"><a href="whatsnew-2.html">DNS BIND</a></p>
<p class="toc level2"><a href="schemas-290.html"><tt>pam_ldap</tt> Changes</a></p>
<p class="toc level2"><a href="whatsnew-3.html">Documentation Errors</a></p>
<p class="toc level1 tocsp"><a href="aagloss-87604.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="nis2ldap-58"></a><h3>NIS-to-LDAP Troubleshooting</h3>
<a name="indexterm-575"></a><p>This section covers two areas of troubleshooting:</p>
<ul><li><p><a href="#nis2ldap-10">Common LDAP Error Messages</a></p></li>
<li><p><a href="#nis2ldap-59">NIS-to-LDAP Issues</a></p></li></ul>


<a name="nis2ldap-10"></a><h4>Common LDAP Error Messages</h4>
<a name="indexterm-576"></a><p>Sometimes the N2L server logs errors that relate to internal LDAP problems, resulting
in LDAP-related error messages. Although the errors are nonfatal, they indicate problems to
investigate. For example, the N2L server might continue to operate, but provide out-of-date
or incomplete results.</p><p>The following list includes some of the common LDAP error messages that you
might encounter when implementing the N2L service. Error descriptions, and possible causes and
solutions for the errors, are included.</p><p><tt>Administrative limit exceeded</tt></p>
<ul><li><p><b>Error Number</b>: 11</p></li>
<li><p><b>Cause</b>: An LDAP search was made that was larger than allowed by the directory server's <tt>nsslapd-sizelimit</tt> attribute. Only partial information will be returned.</p></li>
<li><p><b>Solution</b>: Increase the value of the <tt>nsslapd-sizelimit</tt> attribute, or implement a VLV index for the failing search.</p></li></ul>
<p><tt>Invalid DN Syntax</tt></p>
<ul><li><p><b>Error Number</b>: 34</p></li>
<li><p><b>Cause</b>: An attempt has been made to write an LDAP entry with a DN that contains illegal characters. The N2L server attempts to escape illegal characters, such as the + symbol, that are generated in DNs.</p></li>
<li><p><b>Solution</b>: Check the LDAP server error log to find out which illegal DNs were written, then modify the <tt>NISLDAPmapping</tt> file that generated the illegal DNs.</p></li></ul>
<p><tt>Object class violation</tt></p>
<ul><li><p><b>Error Number</b>: 65</p></li>
<li><p><b>Cause</b>: An attempt has been made to write an LDAP entry that is invalid. Generally, this error is due to missing <tt>MUST</tt> attributes that can be caused by either of the following circumstances.</p>
<ul><li><p>Bugs in the <tt>NISLDAPmapping</tt> file that create entries with missing attributes</p></li>
<li><p>Attempts to add an <tt>AUXILIARY</tt> attribute to an object that does not exist</p><p>For example, if a user name has not yet been created from the <tt>passwd.byxxx</tt> map, an attempt to add auxiliary information to that user will fail.</p></li></ul>
</li>
<li><p><b>Solution</b>: For bugs in the <tt>NISLDAPmapping</tt> file, check what was written in the server error log to determine the nature of the problem.</p></li></ul>
<p><tt>Can't contact LDAP server</tt></p>
<ul><li><p><b>Error Number</b>: 81</p></li>
<li><p><b>Cause</b>: The <tt>ypserv</tt> file might be incorrectly configured to point to the wrong LDAP directory server. Alternatively, the directory server might not be running.</p></li>
<li><p><b>Solution</b>:</p>
<ul><li><p>Reconfigure the <tt>ypserv</tt> file to point to the correct LDAP directory server.</p></li>
<li><p>To confirm that the LDAP server is running, become superuser, or assume an equivalent role, on the directory server and type:</p><pre># <tt><b>pgrep</b></tt> <tt>-l</tt> <tt><b>slapd</b></tt></pre></li></ul>
</li></ul>
<p><tt>Timeout</tt></p>
<ul><li><p><b>Error Number</b>: 85</p></li>
<li><p><b>Cause</b>: An LDAP operation timed out, typically while updating a map from the DIT. The map might now contain out-of-date information.</p></li>
<li><p><b>Solution</b>: Increase the <tt>nisLDAPxxxTimeout</tt> attributes in the <tt>ypserv</tt> configuration file.</p></li></ul>


<a name="nis2ldap-59"></a><h4>NIS-to-LDAP Issues</h4>
<a name="indexterm-577"></a><p>The following problems could occur while running the N2L server. Possible causes and
solutions are provided.</p>

<a name="nis2ldap-9"></a><h5>Debugging the <tt>NISLDAPmapping</tt> File</h5>
<a name="indexterm-578"></a><p>The mapping file, <tt>NISLDAPmapping</tt>, is complex. Many  potential errors might cause the
mapping to behave in unexpected ways. Use the following techniques to resolve such
problems.</p><p><b>Console Message Displays When</b> <tt>ypserv</tt> <tt>-ir</tt> <b>(or</b> <tt>-Ir</tt><b>) Runs</b></p>
<ul><li><p><b>Problem</b>: A simple message is displayed on the console and the server exits (a detailed description is written to <tt>syslog</tt>).</p></li>
<li><p><b>Cause</b>: The syntax of the mapping file might be incorrect.</p></li>
<li><p><b>Solution</b>: Check and correct the syntax in the <tt>NISLDAPmapping</tt> file.</p></li></ul>
<p><b>NIS Daemon Exits at Startup</b></p>
<ul><li><p><b>Problem</b>: When <tt>ypserv</tt> or other NIS daemons run, an LDAP-related error message is logged and the daemon exits.</p></li>
<li><p><b>Cause</b>: The cause might be one of the following:</p>
<ul><li><p>The LDAP server cannot be contacted.</p></li>
<li><p>An entry found in an NIS map or in the DIT is incompatible with the mapping specified.</p></li>
<li><p>An attempt to read or write to the LDAP server returns an error.</p></li></ul>
</li>
<li><p><b>Solution</b>: Examine the error log on the LDAP server. See the LDAP errors that are listed in <a href="#nis2ldap-10">Common LDAP Error Messages</a>.</p></li></ul>
<p><b>Unexpected Results From NIS Operations</b></p>
<ul><li><p><b>Problem</b>: NIS operations do not return the expected results, but no errors are logged.</p></li>
<li><p><b>Cause</b>: Incorrect entries might exist in the LDAP or NIS maps, which results in mappings not completing as intended.</p></li>
<li><p><b>Solution</b>: Check and correct entries in the LDAP DIT and in the N2L versions of the NIS maps.</p>
<ol><li><p>Check that the correct entries exist in the LDAP DIT, and correct the entries as needed.</p><p>If you are using the Sun Java System Directory Server, start the management console by running <tt>directoryserver startconsole</tt>.</p></li>
<li><p>Check that the N2L versions of the NIS maps in the <tt>/var/yp</tt> directory contain the expected entries by comparing the newly generated map to the original map. Correct entries as needed.</p><pre># <tt><b>cd /var/yp/</tt><i>domainname</i><tt></b></tt>
# <tt><b>makedbm</b></tt> <tt>-u</tt> <tt><b></tt><i>test.byname</i><tt></b></tt>
# <tt><b>makedbm</b></tt> <tt>-u</tt> <tt><b>LDAP_</tt><i>test.byname</i><tt></b></tt></pre><p>Be aware of the following when checking the output for the maps:</p>
<ul><li><p>The order of entries might not be the same in both files.</p><p>Use the <tt>sort</tt> command before comparing output.</p></li>
<li><p>The use of white space might not be the same in both files.</p><p>Use the <tt>diff</tt> <tt>-b</tt> command when comparing output.</p></li></ul>
</li></ol>
</li></ul>
<p><b>Processing Order of NIS Maps</b></p>
<ul><li><p><b>Problem</b>: Object class violations occur.</p></li>
<li><p><b>Cause</b>: When the <tt>ypserv</tt> <tt>-i</tt> command is run, each NIS map is read and its contents are written into the DIT. Several maps might contribute attributes to the same DIT object. Generally, one map creates most of the object, including all the object's <tt>MUST</tt> attributes. Other maps contribute additional <tt>MAY</tt> attributes.</p><p>Maps are processed in the same order that <tt>nisLDAPobjectDN</tt> attributes appear in the <tt>NISLDAPmapping</tt> file. If maps containing <tt>MAY</tt> attributes get processed before maps containing <tt>MUST</tt> attributes, then object class violations occur. See Error 65 in <a href="#nis2ldap-10">Common LDAP Error Messages</a> for more information about this error.</p></li>
<li><p><b>Solution</b>: Reorder the <tt>nisLDAPobjectDN</tt> attributes so that maps are processed in the correct order.</p><p>As a temporary fix, rerun the <tt>ypserv</tt> <tt>-i</tt> command several times. Each time the command is executed, more of the LDAP entry is built up.</p></li></ul>

<hr><p><b>Note - </b>Mapping in such a way that all of an object's <tt>MUST</tt> attributes cannot
be created from at least one map is <b>not</b> supported.</p>
<hr>


<a name="nis2ldap-22"></a><h5>N2L Server Timeout Issue</h5>

<ul><li><p><b>Problem</b>: The server times out.</p></li>
<li><p><b>Cause</b>: When the N2L server refreshes a map, the result might be a large LDAP directory access. If the Sun Java System Directory Server is not correctly configured, this operation might time out before completion.</p></li>
<li><p><a name="indexterm-579"></a><b>Solution</b>: To avoid directory server timeouts, modify the Sun Java System Directory Server attributes manually or by running the <tt>idsconfig</tt> command. See <a href="#nis2ldap-10">Common LDAP Error Messages</a> and <a href="nis2ldap-16.html">NIS-to-LDAP Best Practices With Sun Java System Directory Server</a> for details.</p></li></ul>


<a name="nis2ldap-11"></a><h5>N2L Lock File Issue</h5>

<ul><li><p><b>Problem</b>: The <tt>ypserv</tt> command starts but does not respond to NIS requests.</p></li>
<li><p><b>Cause</b>: The N2L server lock files are not correctly synchronizing access to the NIS maps. This should never happen.</p></li>
<li><p><a name="indexterm-580"></a><b>Solution</b>: Type the following commands on the N2L server.</p><pre># <tt><b>svcadm disable network/nis/server:default</b></tt>
# <tt><b>rm /var/run/yp_maplock /var/run/yp_mapupdate</b></tt>
# <tt><b>svcadm enable network/nis/server:default</b></tt></pre></li></ul>


<a name="nis2ldap-13"></a><h5>N2L Deadlock Issue</h5>

<ul><li><p><b>Problem</b>: The N2L server deadlocks.</p></li>
<li><p><b>Cause</b>: If the addresses of the N2L master server and the LDAP server are not listed properly in the <tt>hosts</tt>, <tt>ipnodes</tt>, or <tt>ypserv</tt> files, a deadlock might result. See <a href="nis2ldap-15.html">Prerequisites for the NIS-to-LDAP Transition</a> for details about proper address configuration for N2L.</p><p>For an example of a deadlock scenario, consider the following sequence of events:</p>
<ol><li><p>An NIS client tries to look up an IP address.</p></li>
<li><p>The N2L server finds that the <tt>hosts</tt> entry is out-of-date.</p></li>
<li><p>The N2L server tries to update the <tt>hosts</tt> entry from LDAP.</p></li>
<li><p>The N2L server gets the name of its LDAP server from <tt>ypserv</tt>, then does a search by using <tt>libldap</tt>.</p></li>
<li><p><tt>libldap</tt> tries to convert the LDAP server's name to an IP address by making a call to the name service switch.</p></li>
<li><p>The name service switch might make an NIS call to the N2L server, which deadlocks.</p></li></ol>
</li>
<li><p><b>Solution</b>: List the addresses of the N2L master server and the LDAP server in the <tt>hosts</tt> or <tt>ipnodes</tt> files on the N2L master server. Whether the server addresses must be listed in <tt>hosts</tt>, <tt>ipnodes</tt>, or both files depends on how these files are configured to resolve local host names. Also, check that the <tt>hosts</tt> and <tt>ipnodes</tt> entries in the <tt>nsswitch.conf</tt> file list <tt>files</tt> before <tt>nis</tt> in the lookup order.</p><p><a name="indexterm-581"></a>An alternative solution to this deadlock problem is to list the LDAP server address, not its host name, in the <tt>ypserv</tt> file. This means that the LDAP server address would be listed in another place. Therefore, changing the address of either the LDAP server or the N2L server would require slightly more effort.</p></li></ul>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="nis2ldap-24.html">Previous</a>
             </td>
             <td align="right">
                 <a href="nis2ldap-42.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

