<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Updating and Modifying Existing Maps - System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2009-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="anis2-11278.html">Previous</a>
             </td>
             <td align="right">
                 <a href="anis2-34392.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="intro-1.html">Part&nbsp;I&nbsp;About Naming and Directory Services</a></p>
<p class="toc level2"><a href="intro2ns-2.html">1.&nbsp;&nbsp;Naming and Directory Services (Overview)</a></p>
<p class="toc level2"><a href="a12swit-86415.html">2.&nbsp;&nbsp;The Name Service Switch (Overview)</a></p>
<p class="toc level1 tocsp"><a href="dnsadmin-1.html">Part&nbsp;II&nbsp;DNS Setup and Administration</a></p>
<p class="toc level2"><a href="dnsref-1.html">3.&nbsp;&nbsp;DNS Setup and Administration (Reference)</a></p>
<p class="toc level1 tocsp"><a href="nissetup-1.html">Part&nbsp;III&nbsp;NIS Setup and Administration</a></p>
<p class="toc level2"><a href="anis1-25461.html">4.&nbsp;&nbsp;Network Information Service (NIS) (Overview)</a></p>
<p class="toc level2"><a href="cnis1-25208.html">5.&nbsp;&nbsp;Setting Up and Configuring NIS Service</a></p>
<p class="toc level2"><a href="anis2-22217.html">6.&nbsp;&nbsp;Administering NIS (Tasks)</a></p>
<p class="toc level3"><a href="anis2-32914.html">Password Files and Namespace Security</a></p>
<p class="toc level3"><a href="anis2-38485.html">Administering NIS Users</a></p>
<p class="toc level3"><a href="anis2-11278.html">Working With NIS Maps</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Updating and Modifying Existing Maps</a></p>
</div>
<p class="toc level3"><a href="anis2-34392.html">Adding a Slave Server</a></p>
<p class="toc level3"><a href="anis2-25789.html">Using NIS With C2 Security</a></p>
<p class="toc level3"><a href="anis2-manualbind-1.html">Binding to a Specific NIS Server</a></p>
<p class="toc level3"><a href="anis2-16615.html">Changing a Machine's NIS Domain</a></p>
<p class="toc level3"><a href="anis2-21536.html">Using NIS in Conjunction With DNS</a></p>
<p class="toc level3"><a href="anis2-22142.html">Turning Off NIS Services</a></p>
<p class="toc level2 tocsp"><a href="abtrbl-18694.html">7.&nbsp;&nbsp;NIS Troubleshooting</a></p>
<p class="toc level1 tocsp"><a href="ldapsetup-1.html">Part&nbsp;IV&nbsp;LDAP Naming Services Setup and Administration</a></p>
<p class="toc level2"><a href="overview-1.html">8.&nbsp;&nbsp;Introduction to LDAP Naming Services (Overview/Reference)</a></p>
<p class="toc level2"><a href="ldapsecure-1.html">9.&nbsp;&nbsp;LDAP Basic Components and Concepts (Overview)</a></p>
<p class="toc level2"><a href="planldap-1.html">10.&nbsp;&nbsp;Planning Requirements for LDAP Naming Services (Tasks)</a></p>
<p class="toc level2"><a href="sundssetup-13.html">11.&nbsp;&nbsp;Setting Up Sun Java System Directory Server With LDAP Clients (Tasks)</a></p>
<p class="toc level2"><a href="clientsetup-1.html">12.&nbsp;&nbsp;Setting Up LDAP Clients (Tasks)</a></p>
<p class="toc level2"><a href="setupproblems-1.html">13.&nbsp;&nbsp;LDAP Troubleshooting (Reference)</a></p>
<p class="toc level2"><a href="schemas-1.html">14.&nbsp;&nbsp;LDAP General Reference (Reference)</a></p>
<p class="toc level2"><a href="nis2ldap-34.html">15.&nbsp;&nbsp;Transitioning From NIS to LDAP (Overview/Tasks)</a></p>
<p class="toc level2"><a href="nisplus2ldap-1.html">16.&nbsp;&nbsp;Transitioning From NIS+ to LDAP</a></p>
<p class="toc level1 tocsp"><a href="ghnmu.html">Part&nbsp;V&nbsp;Active Directory Naming Service</a></p>
<p class="toc level2"><a href="ghnov.html">17.&nbsp;&nbsp;Setting Up Solaris Active Directory Clients</a></p>
<p class="toc level1 tocsp"><a href="whatsnew-1.html">A.&nbsp;&nbsp;Solaris 10 Software Updates to DNS, NIS, and LDAP</a></p>
<p class="toc level2"><a href="whatsnew-5.html">Service Management Facility Changes</a></p>
<p class="toc level2"><a href="whatsnew-2.html">DNS BIND</a></p>
<p class="toc level2"><a href="schemas-290.html"><tt>pam_ldap</tt> Changes</a></p>
<p class="toc level2"><a href="whatsnew-3.html">Documentation Errors</a></p>
<p class="toc level1 tocsp"><a href="aagloss-87604.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="anis2-1010"></a><h3>Updating and Modifying Existing Maps</h3>
<p>After you have installed NIS, you might discover that some maps require frequent
updating while others never need to change. For example, the <tt>passwd.byname</tt> map
can change frequently on a large company's network, while the <tt>auto_master</tt> map changes
little, if at all.</p><p>As mentioned in <a href="anis1-34824.html#anis1-6">Default NIS Maps</a>, the default location of the default NIS maps is
on the master server in <tt>/var/yp/</tt><i>domainname</i>, where <i>domainname</i> is the name of
the NIS domain. When you need to update a map, you can use
one of two updating procedures, depending on whether or not it is a
default map.</p>
<ul><li><p><a name="indexterm-385"></a>A default map is a map in the default set created by <tt>ypinit</tt> from the network databases.</p></li>
<li><p><a name="indexterm-386"></a>Nondefault maps can be any of the following.</p>
<ul><li><p>Maps included with an application purchased from a vendor</p></li>
<li><p>Maps created specifically for your site</p></li>
<li><p>Maps created from a nontext file</p></li></ul>
</li></ul>
<p>The following sections explain how to use various updating tools. In practice, you
might decide to only use them if you add nondefault maps or change
the set of NIS servers after the system is already up and
running.</p>

<a name="anis2-20918"></a><h4>How to Update Maps Supplied With the Default Set</h4><p>Use the following procedure for updating maps supplied with the default set.</p><ol>
<li><a name="anis2-step-36"></a><b>Become a superuser on the master server.</b><p>Always modify NIS maps only on the master server.</p></li>
<li><a name="anis2-step-37"></a><b>Edit the source file for the map you want to change, whether that
file resides in <tt>/etc</tt> or in some other directory of your choice.</b></li>
<li><a name="anis2-step-38"></a><b>Type the following.</b><pre># <tt><b>cd /var/yp</b></tt>
# <tt><b>make </tt><i>mapname</i><tt></b></tt></pre><p><a name="indexterm-387"></a>The <tt>make</tt> command then updates your map according to the changes you made
in its corresponding file. It also propagates the changes among the other servers.</p></li></ol>

<a name="gentextid-5002"></a><h4>Maintaining Updated Maps</h4>
<p>The following sections describe additional procedures after you have completed updating maps that
are supplied with the default set.</p>

<a name="gentextid-5005"></a><h5>Propagating an NIS Map</h5>
<p>After a map is changed, the <tt>Makefile</tt> uses <tt>yppush</tt> to propagate a
new map to the slave servers (unless <tt>NOPUSH</tt> is set in the
<tt>Makefile</tt>). It does this by informing the <tt>ypserv</tt> daemon and sending a map transfer
request. The <tt>ypserv</tt> daemon on the slave then starts a <tt>ypxfr</tt> process, which
in turn contacts the <tt>ypxfrd</tt> daemon on the master server. Some basic
checks are made (for example did the map really change?) and then the
map is transferred. <tt>ypxfr</tt> on the slave then sends a response to
the <tt>yppush</tt> process indicating whether the transfer succeeded.</p>
<hr><p><b>Note - </b><a name="indexterm-388"></a>The above procedure will <b>not</b> work for newly created maps that do not
yet exist on the slave servers. New maps must be sent to the
slave servers by running <tt>ypxfr</tt> on the slaves.</p>
<hr>
<p>Occasionally, maps fail to propagate and you must to use <tt>ypxfr</tt> manually to
send new map information. You can choose to use <tt>ypxfr</tt> in two different
ways: periodically through the root <tt>crontab</tt> file, or interactively on the command line.
These approaches are discussed in the following sections. </p>

<a name="gentextid-5028"></a><h5>Using <tt>cron</tt> for Map Transfers</h5>
<p>Maps have different rates of change. For instance, some might not change for
months at a time, such as <tt>protocols.byname</tt> among the default maps and <tt>auto_master</tt>
among the nondefault maps; but <tt>passwd.byname</tt> can change several times a day. Scheduling map
transfer using the <tt>crontab</tt> command allows you to set specific propagation times for
individual maps.</p><p>To periodically run <tt>ypxfr</tt> at a rate appropriate for the map, the root
<tt>crontab</tt> file on each slave server should contain the appropriate <tt>ypxfr</tt> entries. <tt>ypxfr</tt>
contacts the master server and transfers the map only if the copy on
the master server is more recent than the local copy.</p>
<hr><p><b>Note - </b><a name="indexterm-389"></a><a name="indexterm-390"></a><a name="indexterm-391"></a>If your master server runs <tt>rpc.yppasswdd</tt> with the default <tt>-m</tt> option, then each
time someone changes their <tt>yp</tt> password, the <tt>passwd</tt> daemon runs <tt>make</tt>, which rebuilds
the <tt>passwd</tt> maps.</p>
<hr>


<a name="gentextid-5056"></a><h5>Using Shell Scripts With <tt>cron</tt> and <tt>ypxfr</tt></h5>
<p>As an alternative to creating separate <tt>crontab</tt> entries for each map, you might
prefer to have the root <tt>crontab</tt> command run a shell script that periodically
updates all maps. Sample map-updating shell scripts are n the <tt>/usr/lib/netsvc/yp</tt> directory. The script
names are <tt>ypxfr_1perday</tt>, <tt>ypxfr_1perhour</tt>, and <tt>ypxfr_2perday</tt>. You can modify or replace these shell scripts
to fit your site requirements. <a href="#anis2-28903">Example&nbsp;6-1</a> shows the default <tt>ypxfr_1perday</tt> shell script.</p><a name="anis2-28903"></a><h6>Example&nbsp;6-1 <tt>ypxfr_1perday</tt> Shell Script</h6><pre>#! /bin/sh
#
# ypxfr_1perday.sh - Do daily yp map check/updates
PATH=/bin:/usr/bin:/usr/lib/netsvc/yp:$PATH
export PATH
# set -xv
ypxfr group.byname
ypxfr group.bygid
ypxfr protocols.byname
ypxfr protocols.bynumber
ypxfr networks.byname
ypxfr networks.byaddr
ypxfr services.byname
ypxfr ypservers</pre><p>This shell script updates the maps once per day, if the root
<tt>crontab</tt> is executed daily. You can also have scripts that update maps
once a week, once a month, once every hour, and so forth, but
be aware of the performance degradation implied in frequently propagating the maps.</p><p>Run the same shell scripts as root on each slave server configured
for the NIS domain. Alter the exact time of execution from one server
to another to avoid bogging down the master.</p><p>If you want to transfer the map from a particular slave server,
use the <tt>-h</tt> <i>machine</i> option of <tt>ypxfr</tt> within the shell script. Here is
the syntax of the commands you put in the script.</p><pre># <tt><b>/usr/lib/netsvc/yp/ypxfr</b></tt> <tt>-h</tt> <tt><b></tt><i>machine</i><tt> [</b></tt> <tt>-c</tt> <tt><b>] </tt><i>mapname</i><tt></b></tt></pre><p>Where <i>machine</i> is the name of the server with the maps you want
to transfer, and <i>mapname</i> is the name of the requested map. If you
use the <tt>-h</tt> option without specifying a machine, <tt>ypxfr</tt> tries to get the
map from the master server. If <tt>ypserv</tt> is not running locally at the time
<tt>ypxfr</tt> is executed, you must use the <tt>-c</tt> flag so that <tt>ypxfr</tt> does
not send a clear current map request to the local <tt>ypserver</tt>.</p><p>You can use the <tt>-s</tt> <i>domain</i> option to transfer maps from another domain
to your local domain. These maps should be the same across domains. For
example, two domains might share the same <tt>services.byname</tt> and <tt>services.byaddr</tt> maps. Alternatively, you
can use <tt>rcp</tt>, or <tt>rdist</tt> for more control, to transfer files across domains.</p>

<a name="gentextid-5104"></a><h5>Directly Invoking <tt>ypxfr</tt></h5>
<p>The second method of invoking <tt>ypxfr</tt> is to run it as a command.
Typically, you do this only in exceptional situations &ndash; for example, when setting
up a temporary NIS server to create a test environment or when trying
to quickly get an NIS server that has been out of service
consistent with the other servers.</p>

<a name="gentextid-5109"></a><h5>Logging <tt>ypxfr</tt> Activity</h5>
<p>The transfer attempts and results of <tt>ypxfr</tt> can be captured in a log
file. If a file called <tt>/var/yp/ypxfr.log</tt> exists, results are appended to it. No
attempt to limit the size of the log file is made. To prevent
it from growing indefinitely, empty it from time to time by typing the
following.</p><pre># <tt><b>cd /var/yp</b></tt>
# <tt><b>cp ypxfr.log ypxfr.log.old</b></tt>
# <tt><b>cat /dev/null &gt; /var/yp/ypxfr.log</b></tt></pre><p>You can have <tt>crontab</tt> execute these commands once a week. To turn off
logging, remove the log file.</p>

<a name="anis2-1003"></a><h4>Modifying Default Maps</h4>
<p>To update a nondefault map, you must do the following.</p>
<ol><li><p>Create or edit its corresponding text file.</p></li>
<li><p>Build (or rebuild) the new or updated map. There are two ways to build a map.</p>
<ul><li><p><a name="indexterm-392"></a>Use the Makefile. Using the Makefile is the preferred method of building a non-default map. If the map has an entry in the <tt>Makefile</tt>, run <tt>make</tt> <i>name</i> where <i>name</i> is the name of map you want to build. If the map does not have a <tt>Makefile</tt> entry, try to create one following the instructions in <a href="anis2-11278.html#anis2-20638">Modifying and Using the <tt>Makefile</tt></a>.</p></li>
<li><p>Use the <tt>/usr/sbin/makedbm</tt> program. <a href="http://docs.sun.com/doc/819-2240/makedbm-1m?a=view"><tt>makedbm</tt>(1M)</a> fully describes this command.</p></li></ul>
</li></ol>


<a name="anis2-1004"></a><h4>Using <tt>makedbm</tt> to Modify a Non-Default Map</h4>
<a name="indexterm-393"></a><p><a name="indexterm-394"></a>There are two different methods for using <tt>makedbm</tt> to modify maps if you do
not have an input file:</p>
<ul><li><p>Redirect the <tt>makedbm</tt> <tt>-u</tt> output to a temporary file, modify the file, then use the modified file as input to <tt>makedbm</tt>.</p></li>
<li><p><a name="indexterm-395"></a><a name="indexterm-396"></a>Have the output of <tt>makedbm</tt> <tt>-u</tt> operated on within a pipeline that feeds into <tt>makedbm</tt>. This is appropriate if you can update the disassembled map with either <tt>awk</tt>, <tt>sed</tt>, or a <tt>cat</tt> append.</p></li></ul>


<a name="anis2-1005"></a><h4>Creating New Maps from Text Files</h4>
<a name="indexterm-397"></a><p>Assume that a text file <tt>/var/yp/mymap.asc</tt> was created with an editor or a
shell script on the master. You want to create an NIS map from
this file and locate it in the <i>homedomain</i> subdirectory. To do this, type
the following on the master server.</p><pre># <tt><b>cd /var/yp</b></tt>
# <tt><b>makedbm </tt><i>mymap</i><tt>.asc </tt><i>homedomain</i><tt>/</tt><i>mymap</i><tt></b></tt></pre><p><a name="indexterm-398"></a>The <i>mymap</i> map now exists on the master server in the directory <i>homedomain</i>. To
distribute the new map to slave servers run <tt>ypxfr</tt>.</p>

<a name="anis2-1006"></a><h4>Adding Entries to a File-Based Map</h4>
<p><a name="indexterm-399"></a><a name="indexterm-400"></a><a name="indexterm-401"></a>Adding entries to <tt>mymap</tt> is simple. First, you must modify the text file
<tt>/var/yp/</tt><i>mymap</i>.<tt>asc</tt>. If you modify the actual <tt>dbm</tt> files without modifying the corresponding
text file, the modifications are lost. Then run <tt>makedbm</tt> as shown above. </p>

<a name="anis2-1007"></a><h4>Creating Maps From Standard Input</h4>
<a name="indexterm-402"></a><p><a name="indexterm-403"></a>When no original text file exists, create the NIS map from the keyboard
by typing input to <tt>makedbm</tt>, as shown below (end with Control-D).</p><pre>ypmaster# <tt><b>cd /var/yp</b></tt>
ypmaster# <tt><b>makedbm</b></tt> <tt>-</tt><i>homedomain</i><tt>-</tt><tt><b>/mymap</tt><i>key1 value1</i><tt> </tt><i>key2 value2</i><tt> </tt><i>key3 value3</i><tt></b></tt></pre>

<a name="anis2-1008"></a><h4>Modifying Maps Made From Standard Input</h4>
<p><a name="indexterm-404"></a>If you later need to modify the map, you can use <tt>makedbm</tt> to disassemble
the map and create a temporary text intermediate file. To disassemble the map
and create a temporary file, type the following.</p><pre>% <tt><b>cd /var/yp</b></tt>
% <tt><b>makedbm</b></tt> <tt>-u</tt> <tt><b></tt><i>homedomain</i><tt>/</tt><i>mymap</i><tt> &gt; </tt><i>mymap</i><tt>.temp</b></tt></pre><p>The resulting temporary file <i>mymap</i><tt>.temp</tt> has one entry per line. You can
edit this file as needed, using any text editor.</p><p>To update the map, give the name of the modified temporary file
to <tt>makedbm</tt> by typing the following.</p><pre>% <tt><b>makedbm </tt><i>mymap</i><tt>.temp </tt><i>homedomain</i><tt>/</tt><i>mymap</i><tt></b></tt>
% <tt><b>rm </tt><i>mymap</i><tt>.temp</b></tt></pre><p>Then propagate the map to the slave servers, by becoming root and
typing the following.</p><pre># <tt><b>yppush </tt><i>mymap</i><tt></b></tt></pre><p>The preceding paragraphs explained how to use <tt>makedbm</tt> to create maps; however, almost
everything you actually have to do can be done by <tt>ypinit</tt> and <tt>Makefile</tt>
unless you add nondefault maps to the database or change the set of
NIS servers after the system is already up and running.</p><p><a name="indexterm-405"></a>Whether you use the <tt>Makefile</tt> in <tt>/var/yp</tt> or some other procedure the goal is
the same. Anew pair of well-formed <tt>dbm</tt> files must end up in the
maps directory on the master server.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="anis2-11278.html">Previous</a>
             </td>
             <td align="right">
                 <a href="anis2-34392.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

