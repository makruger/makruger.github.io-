<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Preparing the Master Server - System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2009-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="cnis1-32365.html">Previous</a>
             </td>
             <td align="right">
                 <a href="cnis1-37475.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="intro-1.html">Part&nbsp;I&nbsp;About Naming and Directory Services</a></p>
<p class="toc level2"><a href="intro2ns-2.html">1.&nbsp;&nbsp;Naming and Directory Services (Overview)</a></p>
<p class="toc level2"><a href="a12swit-86415.html">2.&nbsp;&nbsp;The Name Service Switch (Overview)</a></p>
<p class="toc level1 tocsp"><a href="dnsadmin-1.html">Part&nbsp;II&nbsp;DNS Setup and Administration</a></p>
<p class="toc level2"><a href="dnsref-1.html">3.&nbsp;&nbsp;DNS Setup and Administration (Reference)</a></p>
<p class="toc level1 tocsp"><a href="nissetup-1.html">Part&nbsp;III&nbsp;NIS Setup and Administration</a></p>
<p class="toc level2"><a href="anis1-25461.html">4.&nbsp;&nbsp;Network Information Service (NIS) (Overview)</a></p>
<p class="toc level2"><a href="cnis1-25208.html">5.&nbsp;&nbsp;Setting Up and Configuring NIS Service</a></p>
<p class="toc level3"><a href="cnis1-49.html">Configuring NIS Task Map</a></p>
<p class="toc level3"><a href="cnis1-35918.html">Before You Begin Configuring NIS</a></p>
<p class="toc level3"><a href="cnis1-55.html">NIS and the Service Management Facility</a></p>
<p class="toc level3"><a href="cnis1-32365.html">Planning Your NIS Domain</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Preparing the Master Server</a></p>
</div>
<p class="toc level3"><a href="cnis1-37475.html">Starting and Stopping NIS Service on the Master Server</a></p>
<p class="toc level3"><a href="cnis1-16428.html">Setting Up NIS Slave Servers</a></p>
<p class="toc level3"><a href="cnis1-19866.html">Setting Up NIS Clients</a></p>
<p class="toc level2 tocsp"><a href="anis2-22217.html">6.&nbsp;&nbsp;Administering NIS (Tasks)</a></p>
<p class="toc level2"><a href="abtrbl-18694.html">7.&nbsp;&nbsp;NIS Troubleshooting</a></p>
<p class="toc level1 tocsp"><a href="ldapsetup-1.html">Part&nbsp;IV&nbsp;LDAP Naming Services Setup and Administration</a></p>
<p class="toc level2"><a href="overview-1.html">8.&nbsp;&nbsp;Introduction to LDAP Naming Services (Overview/Reference)</a></p>
<p class="toc level2"><a href="ldapsecure-1.html">9.&nbsp;&nbsp;LDAP Basic Components and Concepts (Overview)</a></p>
<p class="toc level2"><a href="planldap-1.html">10.&nbsp;&nbsp;Planning Requirements for LDAP Naming Services (Tasks)</a></p>
<p class="toc level2"><a href="sundssetup-13.html">11.&nbsp;&nbsp;Setting Up Sun Java System Directory Server With LDAP Clients (Tasks)</a></p>
<p class="toc level2"><a href="clientsetup-1.html">12.&nbsp;&nbsp;Setting Up LDAP Clients (Tasks)</a></p>
<p class="toc level2"><a href="setupproblems-1.html">13.&nbsp;&nbsp;LDAP Troubleshooting (Reference)</a></p>
<p class="toc level2"><a href="schemas-1.html">14.&nbsp;&nbsp;LDAP General Reference (Reference)</a></p>
<p class="toc level2"><a href="nis2ldap-34.html">15.&nbsp;&nbsp;Transitioning From NIS to LDAP (Overview/Tasks)</a></p>
<p class="toc level2"><a href="nisplus2ldap-1.html">16.&nbsp;&nbsp;Transitioning From NIS+ to LDAP</a></p>
<p class="toc level1 tocsp"><a href="ghnmu.html">Part&nbsp;V&nbsp;Active Directory Naming Service</a></p>
<p class="toc level2"><a href="ghnov.html">17.&nbsp;&nbsp;Setting Up Solaris Active Directory Clients</a></p>
<p class="toc level1 tocsp"><a href="whatsnew-1.html">A.&nbsp;&nbsp;Solaris 10 Software Updates to DNS, NIS, and LDAP</a></p>
<p class="toc level2"><a href="whatsnew-5.html">Service Management Facility Changes</a></p>
<p class="toc level2"><a href="whatsnew-2.html">DNS BIND</a></p>
<p class="toc level2"><a href="schemas-290.html"><tt>pam_ldap</tt> Changes</a></p>
<p class="toc level2"><a href="whatsnew-3.html">Documentation Errors</a></p>
<p class="toc level1 tocsp"><a href="aagloss-87604.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="cnis1-21774"></a><h3>Preparing the Master Server</h3>
<p>The following sections describe how to prepare the source files and the <tt>passwd</tt>
files for the master server.</p>

<a name="cnis1-39121"></a><h4>Source Files Directory</h4>
<a name="indexterm-219"></a><a name="indexterm-220"></a><a name="indexterm-221"></a><a name="indexterm-222"></a><a name="indexterm-223"></a><a name="indexterm-224"></a><a name="indexterm-225"></a><a name="indexterm-226"></a><a name="indexterm-227"></a><p>The source files should be located in the <tt>/etc</tt> directory, on the master
server or in some other directory. Having them in <tt>/etc</tt> is undesirable because
the contents of the maps are then the same as the contents of
the local files on the master server. This is a special problem
for <tt>passwd</tt> and <tt>shadow</tt> files because all users have access to the master
server maps and the root password would be passed to all NIS clients
through the <tt>passwd</tt> map. See <a href="#cnis1-17550"><tt>Passwd</tt> Files and Namespace Security</a> for additional information.</p><p>However, if you put the source files in some other directory, you
must modify the <tt>Makefile</tt> in <tt>/var/yp</tt> by changing the <tt>DIR=/etc</tt> line to <tt>DIR=/</tt><i>your-choice</i>, where
<i>your-choice</i> is the name of the directory you will be using to store
the source files. This allows you to treat the local files on the
server as if they were those of a client. (It is good practice
to first save a copy of the original <tt>Makefile</tt>.)</p><p>In addition, if <tt>audit_user</tt>, <tt>auth_attr</tt>, <tt>exec_attr</tt> and <tt>prof_attr</tt> are to be taken
from a directory other than the default, you must amend the <tt>RBACDIR</tt> <i>=/etc/security</i>
to <i>RBACDIR=/your-choice</i>.</p>

<a name="cnis1-17550"></a><h4><tt>Passwd</tt> Files and Namespace Security</h4>
<a name="indexterm-228"></a><a name="indexterm-229"></a><a name="indexterm-230"></a><p><a name="indexterm-231"></a>The <tt>passwd</tt> map is a special case. In addition to the old
Solaris 1 <tt>passwd</tt> file format, this implementation of NIS accepts the <tt>/etc/passwd</tt>
 and <tt>/etc/shadow</tt> file formats as input for building the NIS password maps.</p><p>For security reasons, the files used to build the NIS password maps should
not contain an entry for <tt>root</tt>, to prevent unauthorized root access. Therefore, the
password maps should not be built from the files located in the master
server's <tt>/etc</tt> directory. The password files used to build the password maps should
have the <tt>root</tt> entry removed from them and be located in a directory
that can be protected from unauthorized access.</p><p>For example, the master server password input files should be stored in a
directory such as <tt>/var/yp</tt>, or any directory of your choice, as long as
the file itself is not a link to another file and its
location is specified in the <tt>Makefile</tt>. The correct directory option is set automatically according
to the configuration specified in your <tt>Makefile</tt>.</p>
<hr><p><b>Caution - </b>Be sure that the <tt>passwd</tt> file in the directory specified by <tt>PWDDIR</tt> does
not contain an entry for root.</p>
<hr>
<p><a name="indexterm-232"></a>If your source files are in a directory other than <tt>/etc</tt>, you must
alter the <tt>PWDIR</tt> password macro in the <tt>Makefile</tt> to refer to the directory
where the <tt>passwd</tt> and <tt>shadow</tt> files reside, changing the line <tt>PWDIR=/etc</tt> to <tt>PWDIR/</tt><i>your-choice</i>,
where <i>your-choice</i> is the name of the directory you will be using to
store the <tt>passwd</tt> map source files.</p>

<a name="cnis1-6"></a><h4>Preparing Source Files for Conversion to NIS Maps</h4>
<a name="indexterm-233"></a><p>Prepare the source files for conversion to NIS maps.</p>

<a name="cnis1-proc-7"></a><h5>How to Prepare Source Files for Conversion</h5>
<ol>
<li><a name="cnis1-step-50"></a><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-1?a=view">Chapter 9, Using Role-Based Access Control (Tasks), in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><a name="cnis1-step-8"></a><b>Check the source files on the master server to make sure they reflect
an up-to-date picture of your system.</b><p>Check the following files:</p>
<ul><li><p><tt>auto.home</tt> or <tt>auto_home</tt></p></li>
<li><p><tt>auto.master</tt> or <tt>auto_master</tt></p></li>
<li><p><tt>audit_user</tt></p></li>
<li><p><tt>auth_attr</tt></p></li>
<li><p><tt>bootparams</tt></p></li>
<li><p><tt>ethers</tt></p></li>
<li><p><tt>exec_attr</tt></p></li>
<li><p><tt>group</tt></p></li>
<li><p><tt>hosts</tt></p></li>
<li><p><tt>ipnodes</tt></p></li>
<li><p><tt>netgroup</tt></p></li>
<li><p><tt>netmasks</tt></p></li>
<li><p><tt>networks</tt></p></li>
<li><p><tt>passwd</tt></p></li>
<li><p><tt>protocols</tt></p></li>
<li><p><tt>rpc</tt></p></li>
<li><p><tt>service</tt></p></li>
<li><p><tt>shadow</tt></p></li>
<li><p><tt>user_attr</tt></p></li></ul>
</li>
<li><a name="cnis1-step-9"></a><b><a name="indexterm-234"></a>Copy all of these source files, except <tt>passwd</tt>, to the <tt>DIR</tt> directory that
you have selected.</b></li>
<li><a name="cnis1-step-9a"></a><b>Copy the <tt>passwd</tt> file to the <tt>PWDIR</tt> directory that you have selected.</b></li>
<li><a name="cnis1-step-1"></a><b>Copy <tt>audit_user</tt>, <tt>auth_attr</tt>, <tt>exec_attr</tt>, and <tt>prof_attr</tt> to the selected <tt>RBACDIR</tt> directory.</b></li>
<li><a name="cnis1-step-10"></a><b><a name="indexterm-235"></a><a name="indexterm-236"></a>Check the <tt>/etc/mail/aliases</tt> file.</b><p><a name="indexterm-237"></a>Unlike other source files, the <tt>/etc/mail/aliases</tt> file cannot be moved to another directory. This
file must reside in the <tt>/etc/mail</tt> directory. Refer to <a href="http://docs.sun.com/doc/819-2251/aliases-4?a=view"><tt>aliases</tt>(4)</a> for more information. </p>
<hr><p><b>Note - </b>You can add a nis-specific mail aliases file by pointing the <tt>ALIASES = /etc/mail/aliases</tt>
entry in <tt>/var/yp/Makefile</tt> to another location. When you then run a <tt>make</tt>, the
<tt>ALIASES</tt> entry creates a <tt>mail.aliases</tt> map. The <tt>sendmail</tt> service uses this map
in addition to the <tt>/etc/mail/aliases</tt> file when the <tt>/etc/nsswitch.conf</tt> file properly targets <tt>nis</tt>
in addition to <tt>files</tt>. Refer to <a href="anis2-11278.html#anis2-20638">Modifying and Using the <tt>Makefile</tt></a>.</p>
<hr>
</li>
<li><a name="cnis1-step-11"></a><b>Clean all comments and other extraneous lines and information from the source files.</b><p><a name="indexterm-238"></a>These operations can be done through a <tt>sed</tt> or <tt>awk</tt> script or
with a text editor. The <tt>Makefile</tt> performs some file cleaning automatically for you,
but it is good practice to examine and clean these files by hand
before running. </p></li>
<li><a name="cnis1-step-12"></a><b>Make sure that the data in all the source files is correctly formatted.</b><p>Source file data needs to be in the correct format for that particular
file. Check the man pages for the different files to make sure that
each file is in the correct format.</p></li></ol>

<a name="cnis1-29190"></a><h4>Preparing the <tt>Makefile</tt></h4>
<a name="indexterm-239"></a><a name="indexterm-240"></a><p><a name="indexterm-241"></a><a name="indexterm-242"></a>After checking the source files and copying them into the source file directory,
you now need to convert those source files into the <tt>ndbm</tt> format maps
that the NIS service uses. This is done automatically for you by <tt>ypinit</tt>
when called on the master server, as explained in <a href="#cnis1-28187">Setting Up the Master Server With <tt>ypinit</tt></a>.</p><p><a name="indexterm-243"></a><a name="indexterm-244"></a>The <tt>ypinit</tt> script calls the program <tt>make</tt>, which uses the <tt>Makefile</tt> located in the
<tt>/var/yp</tt> directory. A default <tt>Makefile</tt> is provided for you in the <tt>/var/yp</tt> directory
and contains the commands needed to transform the source files into the desired
<tt>ndbm</tt> format maps.</p><p>You can use the default <tt>Makefile</tt> as it is, or modify it if
you want. (If you do modify the default <tt>Makefile</tt>, be sure to first
copy and store the original default <tt>Makefile</tt> in case you need it for
future use.) You might need to make one or more of the following
modifications to the <tt>Makefile</tt>:</p>
<ul><li><p><b>Nondefault maps</b></p><p>If you have created your own non-default source files and want to convert them to NIS maps, you must add those source files to the <tt>Makefile</tt>.</p></li>
<li><p><tt>DIR</tt> <b>value</b></p><p>If you want the <tt>Makefile</tt> to use source files stored in some directory other than <tt>/etc</tt>, as explained in <a href="#cnis1-39121">Source Files Directory</a>, you must change the value of <tt>DIR</tt> in the <tt>Makefile</tt> to the directory that you want to use. When changing this value in the <tt>Makefile</tt>, do not indent the line.</p></li>
<li><p><tt>PWDIR</tt> <b>value</b></p><p><a name="indexterm-245"></a><a name="indexterm-246"></a>If you want the <tt>Makefile</tt> to use <tt>passwd</tt>, <tt>shadow</tt>, and/or <tt>adjunct</tt> source files stored in some directory other than <tt>/etc</tt>, you must change the value of <tt>PWDIR</tt> in the <tt>Makefile</tt> to the directory that you want to use. When changing this value in the <tt>Makefile</tt>, do not indent the line.</p></li>
<li><p><b>Domain name resolver</b></p><p>If you want the NIS server to use the domain name resolver for machines not in the current domain, comment out the <tt>Makefile</tt> line <tt>B=</tt>, and uncomment (activate) the line <tt>B=</tt><tt>-b</tt><tt></tt>.</p></li></ul>
<p><a name="indexterm-247"></a><a name="indexterm-248"></a><a name="indexterm-249"></a>The function of the <tt>Makefile</tt> is to create the appropriate NIS maps for each
of the databases listed under <tt>all</tt>. After passing through <tt>makedbm</tt> the data is
collected in two files, <tt>mapname.dir</tt> and <tt>mapname.pag</tt>. Both files are in the <tt>/var/yp/</tt><i>domainname</i>
directory on the master server.</p><p><a name="indexterm-250"></a><a name="indexterm-251"></a><a name="indexterm-252"></a><a name="indexterm-253"></a><a name="indexterm-254"></a><a name="indexterm-255"></a>The <tt>Makefile</tt> builds <tt>passwd</tt> maps from the <tt>/PWDIR/passwd</tt>, <tt>/PWDIR/shadow</tt>, and <tt>/PWDIR/security/passwd.adjunct</tt> files, as appropriate.</p>

<a name="cnis1-28187"></a><h4>Setting Up the Master Server With <tt>ypinit</tt></h4>
<p><a name="indexterm-256"></a>The <tt>ypinit</tt> script sets up master and slave servers and clients to use
NIS. It also initially runs <tt>make</tt> to create the maps on the
master server.</p><p>To use <tt>ypinit</tt> to build a fresh set of NIS maps on the
master server, do the following.</p>

<a name="cnis1-proc-13"></a><h5>How to set up the master server using <tt>ypinit</tt></h5>
<ol>
<li><a name="cnis1-step-3"></a><b>On the master server, become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-1?a=view">Chapter 9, Using Role-Based Access Control (Tasks), in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><a name="cnis1-step-14"></a><b>Copy the contents of the <tt>nsswitch.files</tt> file to the <tt>nsswitch.conf</tt> file.</b><pre># <tt><b>cp /etc/nsswitch.files /etc/nsswitch.conf</b></tt></pre></li>
<li><a name="cnis1-step-15"></a><b>Edit the <tt>/etc/hosts</tt> or <tt>/etc/inet/ipnodes</tt> file to add the name and IP
address of each of the NIS servers.</b></li>
<li><a name="cnis1-step-16"></a><b>Build new maps on the master server.</b><pre># <tt><b>/usr/sbin/ypinit</b></tt> <tt>-m</tt><tt><b></b></tt></pre></li>
<li><a name="cnis1-step-17"></a><b><a name="indexterm-257"></a>When <tt>ypinit</tt> prompts for a list of other machines to become NIS slave
servers, type the name of the server you are working on, along with
the names of your NIS slave servers.</b></li>
<li><a name="cnis1-step-18"></a><b>When <tt>ypinit</tt> asks whether you want the procedure to terminate at the first
nonfatal error or continue despite nonfatal errors, type <tt><b>y</b></tt>.</b><p>When you choose <tt>y</tt>, <tt>ypinit</tt> exits upon encountering the first problem; you can then
fix it and restart <tt>ypinit</tt>. This is recommended if you are running <tt>ypinit</tt>
for the first time. If you prefer to continue, you can try to
manually fix all problems that occur, and then restart <tt>ypinit</tt>.</p>
<hr><p><b>Note - </b>A nonfatal error can appear when some of the map files are
not present. This is not an error that affects the functionality of NIS.
You might need to add maps manually if they were not created automatically.
Refer to <a href="anis1-34824.html#anis1-6">Default NIS Maps</a> for a description of all default NIS maps.</p>
<hr>
</li>
<li><a name="cnis1-step-19"></a><b><tt>ypinit</tt> asks whether the existing files in the <tt>/var/yp/</tt><i>domainname</i> directory can be destroyed.</b><p>This message is displayed only if NIS has been previously installed.</p></li>
<li><a name="cnis1-step-20"></a><b>After <tt>ypinit</tt> has constructed the list of servers, it invokes <tt>make</tt>.</b><p><a name="indexterm-258"></a><a name="indexterm-259"></a><a name="indexterm-260"></a>This program uses the instructions contained in the <tt>Makefile</tt> (either the default one or
the one you modified) located in <tt>/var/yp</tt>. The <tt>make</tt> command cleans any remaining
comment lines from the files you designated. It also runs <tt>makedbm</tt> on the
files, creating the appropriate maps and establishing the name of the master server for
each map.</p><p><a name="indexterm-261"></a><a name="indexterm-262"></a><a name="indexterm-263"></a><a name="indexterm-264"></a>If the map or maps being pushed by the <tt>Makefile</tt> correspond to a domain
other than the one returned by the command <tt>domainname</tt> on the master, you
can make sure that they are pushed to the correct domain by starting
<tt>make</tt> in the <tt>ypinit</tt> shell script with a proper identification of the variable
<tt>DOM</tt>, as follows:</p><pre># <tt><b>make DOM=</tt><i>domainname</i><tt> </tt><i>password</i><tt></b></tt></pre><p>This pushes the <tt>password</tt> map to the intended domain, instead of the domain
to which the master belongs.</p></li>
<li><a name="cnis1-step-21"></a><b>To enable NIS as the naming service, type the following.</b><pre># <tt><b>cp /etc/nsswitch.nis /etc/nsswitch.conf</b></tt></pre><p>This replaces the current switch file with the default NIS-oriented switch file. You
can edit this file as necessary.</p></li></ol>

<a name="cnis1-22"></a><h4>Master Supporting Multiple NIS Domains</h4>
<a name="indexterm-265"></a><a name="indexterm-266"></a><a name="indexterm-267"></a><p>Normally, an NIS master server supports only one NIS domain. However, if you
are using a master server to support multiple domains, you must slightly modify
the steps, as described in <a href="#cnis1-28187">Setting Up the Master Server With <tt>ypinit</tt></a>, when setting up the server to
serve the additional domains.</p><p><a name="indexterm-268"></a>Run the <tt>domainname</tt> command on the server. The domain name returned by the
command is the server's default domain. The steps described in <a href="#cnis1-28187">Setting Up the Master Server With <tt>ypinit</tt></a> will work
properly for setting up service for that domain. To configure service for any
<b>other</b> domain, you must modify the <tt>ypinit</tt> shell script as follows.</p><pre># <tt><b>make DOM=</tt><i>correct-domain</i><tt> passwd</b></tt></pre><p><i>correct-domain</i> is the name of the other domain that you are setting up
service for, and <tt>passwd</tt> is the <tt>make</tt> target. This command pushes the
<tt>passwd</tt> map to the intended domain, instead of the domain to which the
master belongs.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="cnis1-32365.html">Previous</a>
             </td>
             <td align="right">
                 <a href="cnis1-37475.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

