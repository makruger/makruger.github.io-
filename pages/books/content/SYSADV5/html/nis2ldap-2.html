<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Setting Up the NIS-to-LDAP Service - System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2009-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="nis2ldap-15.html">Previous</a>
             </td>
             <td align="right">
                 <a href="nis2ldap-16.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="intro-1.html">Part&nbsp;I&nbsp;About Naming and Directory Services</a></p>
<p class="toc level2"><a href="intro2ns-2.html">1.&nbsp;&nbsp;Naming and Directory Services (Overview)</a></p>
<p class="toc level2"><a href="a12swit-86415.html">2.&nbsp;&nbsp;The Name Service Switch (Overview)</a></p>
<p class="toc level1 tocsp"><a href="dnsadmin-1.html">Part&nbsp;II&nbsp;DNS Setup and Administration</a></p>
<p class="toc level2"><a href="dnsref-1.html">3.&nbsp;&nbsp;DNS Setup and Administration (Reference)</a></p>
<p class="toc level1 tocsp"><a href="nissetup-1.html">Part&nbsp;III&nbsp;NIS Setup and Administration</a></p>
<p class="toc level2"><a href="anis1-25461.html">4.&nbsp;&nbsp;Network Information Service (NIS) (Overview)</a></p>
<p class="toc level2"><a href="cnis1-25208.html">5.&nbsp;&nbsp;Setting Up and Configuring NIS Service</a></p>
<p class="toc level2"><a href="anis2-22217.html">6.&nbsp;&nbsp;Administering NIS (Tasks)</a></p>
<p class="toc level2"><a href="abtrbl-18694.html">7.&nbsp;&nbsp;NIS Troubleshooting</a></p>
<p class="toc level1 tocsp"><a href="ldapsetup-1.html">Part&nbsp;IV&nbsp;LDAP Naming Services Setup and Administration</a></p>
<p class="toc level2"><a href="overview-1.html">8.&nbsp;&nbsp;Introduction to LDAP Naming Services (Overview/Reference)</a></p>
<p class="toc level2"><a href="ldapsecure-1.html">9.&nbsp;&nbsp;LDAP Basic Components and Concepts (Overview)</a></p>
<p class="toc level2"><a href="planldap-1.html">10.&nbsp;&nbsp;Planning Requirements for LDAP Naming Services (Tasks)</a></p>
<p class="toc level2"><a href="sundssetup-13.html">11.&nbsp;&nbsp;Setting Up Sun Java System Directory Server With LDAP Clients (Tasks)</a></p>
<p class="toc level2"><a href="clientsetup-1.html">12.&nbsp;&nbsp;Setting Up LDAP Clients (Tasks)</a></p>
<p class="toc level2"><a href="setupproblems-1.html">13.&nbsp;&nbsp;LDAP Troubleshooting (Reference)</a></p>
<p class="toc level2"><a href="schemas-1.html">14.&nbsp;&nbsp;LDAP General Reference (Reference)</a></p>
<p class="toc level2"><a href="nis2ldap-34.html">15.&nbsp;&nbsp;Transitioning From NIS to LDAP (Overview/Tasks)</a></p>
<p class="toc level3"><a href="nis2ldap-35.html">NIS-to-LDAP Service Overview</a></p>
<p class="toc level3"><a href="nis2ldap-6.html">Transitioning From NIS to LDAP (Task Map)</a></p>
<p class="toc level3"><a href="nis2ldap-15.html">Prerequisites for the NIS-to-LDAP Transition</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Setting Up the NIS-to-LDAP Service</a></p>
</div>
<p class="toc level3"><a href="nis2ldap-16.html">NIS-to-LDAP Best Practices With Sun Java System Directory Server</a></p>
<p class="toc level3"><a href="nis2ldap-24.html">NIS-to-LDAP Restrictions</a></p>
<p class="toc level3"><a href="nis2ldap-58.html">NIS-to-LDAP Troubleshooting</a></p>
<p class="toc level3"><a href="nis2ldap-42.html">Reverting to NIS</a></p>
<p class="toc level2 tocsp"><a href="nisplus2ldap-1.html">16.&nbsp;&nbsp;Transitioning From NIS+ to LDAP</a></p>
<p class="toc level1 tocsp"><a href="ghnmu.html">Part&nbsp;V&nbsp;Active Directory Naming Service</a></p>
<p class="toc level2"><a href="ghnov.html">17.&nbsp;&nbsp;Setting Up Solaris Active Directory Clients</a></p>
<p class="toc level1 tocsp"><a href="whatsnew-1.html">A.&nbsp;&nbsp;Solaris 10 Software Updates to DNS, NIS, and LDAP</a></p>
<p class="toc level2"><a href="whatsnew-5.html">Service Management Facility Changes</a></p>
<p class="toc level2"><a href="whatsnew-2.html">DNS BIND</a></p>
<p class="toc level2"><a href="schemas-290.html"><tt>pam_ldap</tt> Changes</a></p>
<p class="toc level2"><a href="whatsnew-3.html">Documentation Errors</a></p>
<p class="toc level1 tocsp"><a href="aagloss-87604.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="nis2ldap-2"></a><h3>Setting Up the NIS-to-LDAP Service</h3>
<a name="indexterm-568"></a><p>You can set up the N2L service either by using standard mappings
or by using custom mappings, as described in the next two procedures.</p><p>As part of the NIS-to -LDAP conversion, you need to run the
<tt>inityp2l</tt> command. This command runs an interactive script for which you must provide
configuration information. The following list shows the type of information you need to
provide. See the <a href="http://docs.sun.com/doc/819-2240/ypserv-1m?a=view"><tt>ypserv</tt>(1M)</a> man page for explanations of these attributes.</p>
<ul><li><p>The name of the configuration file being created (default = <tt>/etc/default/ypserv</tt>)</p></li>
<li><p>The DN that stores configuration information in LDAP (default = <tt>ypserv</tt>)</p></li>
<li><p>Preferred server list for mapping data to/from LDAP</p></li>
<li><p>Authentication method for mapping data to/from LDAP</p></li>
<li><p>Transport Layer Security (TLS) method for mapping data to/from LDAP</p></li>
<li><p>Proxy user bind DN to read/write data from/to LDAP</p></li>
<li><p>Proxy user password to read/write data from/to LDAP</p></li>
<li><p>Timeout value (in seconds) for LDAP bind operation</p></li>
<li><p>Timeout value (in seconds) for LDAP search operation</p></li>
<li><p>Timeout value (in seconds) for LDAP modify operation</p></li>
<li><p>Timeout value (in seconds) for LDAP add operation</p></li>
<li><p>Timeout value (in seconds) for LDAP delete operation</p></li>
<li><p>Time limit (in seconds) for search operation on LDAP server</p></li>
<li><p>Size limit (in bytes) for search operation on LDAP server</p></li>
<li><p>Whether N2L should follow LDAP referrals</p></li>
<li><p>LDAP retrieval error action, number of retrieval attempts, and timeout (in seconds) between each attempt</p></li>
<li><p>Store error action, number of attempts, and timeout (in seconds) between each attempt</p></li>
<li><p>Mapping file name</p></li>
<li><p>Whether to generate mapping information for <tt>auto_direct</tt> map</p><p>The script places relevant information regarding custom maps at appropriate places in the mapping file.</p></li>
<li><p>The naming context</p></li>
<li><p>Whether to enable password changes</p></li>
<li><p>Whether to change the default TTL values for any map</p></li></ul>

<hr><p><b>Note - </b><tt>sasl/cram-md5</tt> authentication is <b>not</b> supported by most LDAP servers, including Sun Java System
Directory Server.</p>
<hr>


<a name="nis2ldap-proc-3"></a><h4>How to Set Up the N2L Service With Standard Mappings</h4><p>Use this procedure if you are transitioning the maps listed in <a href="nis2ldap-35.html#nis2ldap-5">Supported Standard Mappings</a>.
If you are using custom or nonstandard maps, see <a href="#nis2ldap-proc-18">How to Set Up the N2L Service With Custom or Nonstandard Mappings</a>.</p><p>When the LDAP server has been set up, run the <tt>inityp2l</tt> script and
supply configuration information when prompted. <tt>inityp2l</tt> sets up the configuration and mapping files
for standard and <tt>auto.*</tt> maps.</p><ol>
<li><a name="nis2ldap-step-34"></a><b>Complete the prerequisite steps that are listed in <a href="nis2ldap-15.html">Prerequisites for the NIS-to-LDAP Transition</a>.</b></li>
<li><a name="nis2ldap-step-4"></a><b>On the NIS master server, become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-1?a=view">Chapter 9, Using Role-Based Access Control (Tasks), in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><a name="nis2ldap-step-5"></a><b>Convert the NIS master server into an N2L server.</b><pre># <tt><b>inityp2l</b></tt></pre><p>Run the <tt>inityp2l</tt> script on the NIS master server and follow the prompts.
See <a href="">Setting Up the NIS-to-LDAP Service</a> for a list of the information you need to provide.</p><p>See the <a href="http://docs.sun.com/doc/819-2240/inityp2l-1m?a=view"><tt>inityp2l</tt>(1M)</a> man page for more details.</p></li>
<li><a name="nis2ldap-step-19"></a><b>Determine if the LDAP Directory Information Tree (DIT) is fully initialized.</b><p>The DIT is fully initialized if it already contains the information necessary to
populate all the maps that are listed in the <tt>NISLDAPmapping</tt> file.</p>
<ul><li><p>If no, continue with <a href="#nis2ldap-step-11">Step&nbsp;5</a> and skip Step 6.</p></li>
<li><p>If yes, skip Step 5 and go to <a href="#nis2ldap-step-6">Step&nbsp;6</a>.</p></li></ul>
</li>
<li><a name="nis2ldap-step-11"></a><b>Initialize the DIT for the transition from the NIS source files.</b><p>Perform these steps only if the DIT has <b>not</b> been fully initialized.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>Make sure that the old NIS maps are up-to-date.</b><pre># <tt><b>cd /var/yp</b></tt>
# <tt><b>make</b></tt></pre><p>For more information, see the <a href="http://docs.sun.com/doc/819-2240/ypmake-1m?a=view"><tt>ypmake</tt>(1M)</a> man page.</p></li>
<li><a name="nis2ldap-step-13"></a><b>Stop the NIS daemons.</b><pre># <tt><b>svcadm disable network/nis/server:default</b></tt></pre></li>
<li><a name="nis2ldap-step-14"></a><b>Copy the old maps to the DIT, then initialize N2L support for the
maps.</b><pre># <tt><b>ypserv</b></tt> <tt>-Ir</tt><tt><b></b></tt></pre><p>Wait for <tt>ypserv</tt> to exit.</p>
<hr><p><b>Tip - </b>The original NIS <tt>dbm</tt> files are not overwritten. You can recover these files,
if needed.</p>
<hr>
</li>
<li><a name="nis2ldap-step-16"></a><b>Start the NIS daemons to ensure that they use the new maps.</b><pre># <tt><b>svcadm enable network/nis/server:default</b></tt></pre><p>This completes the set up of the N2L service with standard maps.
You do not need to complete Step 6.</p></li></ol></li>
<li><a name="nis2ldap-step-6"></a><b>Initialize the NIS maps.</b><p>Perform these steps only if the DIT is fully initialized and you skipped
Step 5.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>Stop the NIS daemons.</b><pre># <tt><b>svcadm disable network/nis/server:default</b></tt></pre></li>
<li><a name="nis2ldap-step-8"></a><b>Initialize the NIS maps from information in the DIT.</b><pre># <tt><b>ypserv</b></tt> <tt>-r</tt><tt><b></b></tt></pre><p>Wait for <tt>ypserv</tt> to exit.</p>
<hr><p><b>Tip - </b>The original NIS <tt>dbm</tt> files are not overwritten. You can recover these files,
if needed.</p>
<hr>
</li>
<li><a name="nis2ldap-step-10"></a><b>Start the NIS daemons to ensure that they use the new maps.</b><pre># <tt><b>svcadm enable network/nis/server:default</b></tt></pre></li></ol></li></ol>

<a name="nis2ldap-proc-18"></a><h4>How to Set Up the N2L Service With Custom or Nonstandard Mappings</h4><p>Use this procedure if the following circumstances apply:</p>
<ul><li><p>You have maps that are not listed in <a href="nis2ldap-35.html#nis2ldap-5">Supported Standard Mappings</a>.</p></li>
<li><p>You have standard NIS maps that you want to map to non-RFC 2307 LDAP mappings.</p></li></ul>
<ol>
<li><a name="nis2ldap-step-35"></a><b>Complete the prerequisite steps that are listed in <a href="nis2ldap-15.html">Prerequisites for the NIS-to-LDAP Transition</a>.</b></li>
<li><b>On the NIS master server, become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-1?a=view">Chapter 9, Using Role-Based Access Control (Tasks), in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><b>Configure the NIS master server into the N2L server.</b><pre># <tt><b>inityp2l</b></tt></pre><p>Run the <tt>inityp2l</tt> script on the NIS master server and follow the prompts.
See <a href="">Setting Up the NIS-to-LDAP Service</a> for a list of the information you need to provide.</p><p>See the <a href="http://docs.sun.com/doc/819-2240/inityp2l-1m?a=view"><tt>inityp2l</tt>(1M)</a> man page for more details.</p></li>
<li><a name="nis2ldap-step-21"></a><b>Modify the <tt>/var/yp/NISLDAPmapping</tt> file.</b><p>See <a href="#nis2ldap-63">Examples of Custom Maps</a> for examples of how to modify the mapping file.</p></li>
<li><a name="nis2ldap-step-20"></a><b>Determine if the LDAP Directory Information Tree (DIT) is fully initialized.</b><p>The DIT is fully initialized if it already contains the information necessary to
populate all the maps that are listed in the <tt>NISLDAPmapping</tt> file.</p>
<ul><li><p>If no, complete Step 6, Step 8, and Step 9.</p></li>
<li><p>If yes, skip Step 6 and complete <a href="#nis2ldap-step-38">Step&nbsp;7</a>, Step 8, and Step 9.</p></li></ul>
</li>
<li><b>Initialize the DIT for the transition from the NIS source files.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Make sure that the old NIS maps are up-to-date.</b><pre># <tt><b>cd /var/yp</b></tt>
# <tt><b>make</b></tt></pre><p>For more information, see the <a href="http://docs.sun.com/doc/819-2240/ypmake-1m?a=view"><tt>ypmake</tt>(1M)</a> man page.</p></li>
<li><b>Stop the NIS daemons.</b><pre># <tt><b>svcadm disable network/nis/server:default</b></tt></pre></li>
<li><b>Copy the old maps to the DIT, then initialize N2L support for the
maps.</b><pre># <tt><b>ypserv</b></tt> <tt>-Ir</tt><tt><b></b></tt></pre><p>Wait for <tt>ypserv</tt> to exit.</p>
<hr><p><b>Tip - </b>The original NIS <tt>dbm</tt> files are not overwritten. You can recover these files,
if needed.</p>
<hr>
</li>
<li><b>Start the NIS daemons to ensure that they use the new maps.</b><pre># <tt><b>svcadm enable network/nis/server:default</b></tt></pre></li>
<li><a name="nis2ldap-step-36"></a><b>Skip Step 7 and continue with <a href="#nis2ldap-step-37">Step&nbsp;8</a>.</b></li></ol></li>
<li><a name="nis2ldap-step-38"></a><b>Initialize the NIS maps.</b><p>Perform this step only if the DIT is fully initialized.</p><ol style="list-style-type: lower-alpha">
				 
<li><b>Stop the NIS daemons.</b><pre># <tt><b>svcadm disable network/nis/server:default</b></tt></pre></li>
<li><b>Initialize the NIS maps from information in the DIT.</b><pre># <tt><b>ypserv</b></tt> <tt>-r</tt><tt><b></b></tt></pre><p>Wait for <tt>ypserv</tt> to exit.</p>
<hr><p><b>Tip - </b>The original NIS <tt>dbm</tt> files are not overwritten. You can recover these files,
if needed.</p>
<hr>
</li>
<li><b>Start the NIS daemons to ensure that they use the new maps.</b><pre># <tt><b>svcadm enable network/nis/server:default</b></tt></pre></li></ol></li>
<li><a name="nis2ldap-step-37"></a><b>Verify that the LDAP entries are correct.</b><p>If the entries are not correct, then the entries can not be
found by LDAP naming services clients.</p><pre># <tt><b>ldapsearch</b></tt> <tt>-h</tt> <tt><b>server</b></tt> <tt>-s</tt> <tt><b>sub</b></tt> <tt>-b</tt> <tt><b>"ou=servdates, dc=..." \</b></tt>
<tt><b>"objectclass=servDates"</b></tt></pre></li>
<li><a name="nis2ldap-step-23"></a><b>Verify the contents of the <tt>LDAP_</tt> maps.</b><p>The following sample output shows how to use <tt>makedm</tt> to verify the contents
of the <tt>hosts.byaddr</tt> map.</p><pre># <tt><b>makedbm</b></tt> <tt>-u</tt> <tt><b>LDAP_servdate.bynumber</b></tt>
plato: 1/3/2001
johnson: 2/4/2003,1/3/2001
yeats: 4/4/2002
poe: 3/3/2002,3/4/2000</pre><p>If the contents are as expected, the transition from NIS to LDAP
was successful.</p><p>Note that the original NIS <tt>dbm</tt> files are not overwritten, so you can
always recover those files. See <a href="nis2ldap-42.html">Reverting to NIS</a> for more information.</p></li></ol>

<a name="nis2ldap-63"></a><h4>Examples of Custom Maps</h4>
<a name="indexterm-569"></a><p>The following two examples show how you might customize maps. Use your preferred
text editor to modify the <tt>/var/yp/NISLDAPmapping</tt> file as needed. For more information about
file attributes and syntax, see the <a href="http://docs.sun.com/doc/819-2251/nisldapmapping-4?a=view"><tt>NISLDAPmapping</tt>(4)</a> man page and the LDAP
naming services information in <a href="ldapsecure-1.html">Chapter&nbsp;9, LDAP Basic Components and Concepts (Overview)</a>.</p>

<a name="nis2ldap-44"></a><h5>Example 1&ndash;Moving Host Entries</h5>
<p>This example shows how to move host entries from the default location to
another (nonstandard) location in the DIT.</p><p>Change the <tt>nisLDAPobjectDN</tt> attribute in the <tt>NISLDAPmapping</tt> file to the new base
LDAP distinguished name (DN). For this example, the internal structure of the LDAP
objects is unchanged, so <tt>objectClass</tt> entries are unchanged.</p><p>Change:</p><pre>nisLDAPobjectDN hosts: \
                        ou=hosts,?one?, \
                        objectClass=device, \
                        objectClass=ipHost</pre><p>To:</p><pre>nisLDAPobjectDN hosts: \
                        <b>ou=newHosts</b>,?one?, \
                        objectClass=device, \
                        objectClass=ipHost</pre><p>This change causes entries to be mapped under</p><p>&nbsp;&nbsp;&nbsp;<tt>dn: ou=newHosts, dom=domain1, dc=sun, dc=com</tt></p><p>instead of under</p><p>&nbsp;&nbsp;&nbsp;<tt>dn: ou=hosts, dom=domain1, dc=sun, dc=com</tt>. </p>

<a name="nis2ldap-45"></a><h5>Example 2&ndash;Implementing a Custom Map</h5>
<p>This example shows how to implement a custom map.</p><p>A hypothetical map, <b>servdate.bynumber</b>, contains information about the servicing dates for systems. This
map is indexed by the machine's serial number which, in this example, is
123. Each entry consists of the machine owner's name, a colon, and a
comma-separated list of service dates, such as John Smith:1/3/2001,4/5/2003.</p><p>The old map structure is to be mapped onto LDAP entries of
the following form:</p><pre>dn: number=123,ou=servdates,dc=... \
                 number: 123 \
                 userName: John Smith \
                 date: 1/3/2001 \
                 date: 4/5/2003 \
                  .
                  .
                  .
                 objectClass: servDates</pre><p>By examining the <tt>NISLDAPmapping</tt> file, you can see that the mapping closest to
the required pattern is <tt>group</tt>. The custom mappings can be modeled on the
<tt>group</tt> mapping. Since there is only one map, no <tt>nisLDAPdatabaseIdMapping</tt> attribute is required. The
attributes to be added to <tt>NISLDAPmapping</tt> are the following:</p><pre>nisLDAPentryTtl servdate.bynumber:1800:5400:3600

nisLDAPnameFields servdate.bynumber: \
                        ("%s:%s", uname, dates)

nisLDAPobjectDN servdate.bynumber: \
                        ou=servdates, ?one? \
                        objectClass=servDates:

nisLDAPattributeFromField servdate.bynumber: \
                        dn=("number=%s,", rf_key), \
                        number=rf_key, \
                        userName=uname, \
                        (date)=(dates, ",")

nisLDAPfieldFromAttribute servdate.bynumber: \
                        rf_key=number, \
                        uname=userName, \
                        dates=("%s,", (date), ",")  </pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="nis2ldap-15.html">Previous</a>
             </td>
             <td align="right">
                 <a href="nis2ldap-16.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

