<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Getting Started With the NIS+ to LDAP Transition - System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2009-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="nisplus2ldap-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="nisplus2ldap-41.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="intro-1.html">Part&nbsp;I&nbsp;About Naming and Directory Services</a></p>
<p class="toc level2"><a href="intro2ns-2.html">1.&nbsp;&nbsp;Naming and Directory Services (Overview)</a></p>
<p class="toc level2"><a href="a12swit-86415.html">2.&nbsp;&nbsp;The Name Service Switch (Overview)</a></p>
<p class="toc level1 tocsp"><a href="dnsadmin-1.html">Part&nbsp;II&nbsp;DNS Setup and Administration</a></p>
<p class="toc level2"><a href="dnsref-1.html">3.&nbsp;&nbsp;DNS Setup and Administration (Reference)</a></p>
<p class="toc level1 tocsp"><a href="nissetup-1.html">Part&nbsp;III&nbsp;NIS Setup and Administration</a></p>
<p class="toc level2"><a href="anis1-25461.html">4.&nbsp;&nbsp;Network Information Service (NIS) (Overview)</a></p>
<p class="toc level2"><a href="cnis1-25208.html">5.&nbsp;&nbsp;Setting Up and Configuring NIS Service</a></p>
<p class="toc level2"><a href="anis2-22217.html">6.&nbsp;&nbsp;Administering NIS (Tasks)</a></p>
<p class="toc level2"><a href="abtrbl-18694.html">7.&nbsp;&nbsp;NIS Troubleshooting</a></p>
<p class="toc level1 tocsp"><a href="ldapsetup-1.html">Part&nbsp;IV&nbsp;LDAP Naming Services Setup and Administration</a></p>
<p class="toc level2"><a href="overview-1.html">8.&nbsp;&nbsp;Introduction to LDAP Naming Services (Overview/Reference)</a></p>
<p class="toc level2"><a href="ldapsecure-1.html">9.&nbsp;&nbsp;LDAP Basic Components and Concepts (Overview)</a></p>
<p class="toc level2"><a href="planldap-1.html">10.&nbsp;&nbsp;Planning Requirements for LDAP Naming Services (Tasks)</a></p>
<p class="toc level2"><a href="sundssetup-13.html">11.&nbsp;&nbsp;Setting Up Sun Java System Directory Server With LDAP Clients (Tasks)</a></p>
<p class="toc level2"><a href="clientsetup-1.html">12.&nbsp;&nbsp;Setting Up LDAP Clients (Tasks)</a></p>
<p class="toc level2"><a href="setupproblems-1.html">13.&nbsp;&nbsp;LDAP Troubleshooting (Reference)</a></p>
<p class="toc level2"><a href="schemas-1.html">14.&nbsp;&nbsp;LDAP General Reference (Reference)</a></p>
<p class="toc level2"><a href="nis2ldap-34.html">15.&nbsp;&nbsp;Transitioning From NIS to LDAP (Overview/Tasks)</a></p>
<p class="toc level2"><a href="nisplus2ldap-1.html">16.&nbsp;&nbsp;Transitioning From NIS+ to LDAP</a></p>
<p class="toc level3"><a href="nisplus2ldap-2.html">NIS+ to LDAP Overview</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Getting Started With the NIS+ to LDAP Transition</a></p>
</div>
<p class="toc level3"><a href="nisplus2ldap-41.html">Masters and Replicas (NIS+ to LDAP)</a></p>
<p class="toc level3"><a href="nisplus2ldap-43.html">The Directory Server (NIS+ to LDAP)</a></p>
<p class="toc level3"><a href="nisplus2ldap-49.html">Mapping NIS+ Objects Other Than Table Entries</a></p>
<p class="toc level3"><a href="nisplus2ldap-50.html">NIS+ Entry Owner, Group, Access, and TTL</a></p>
<p class="toc level3"><a href="nisplus2ldap-56.html">Principal Names and Netnames (NIS+ to LDAP)</a></p>
<p class="toc level3"><a href="nisplus2ldap-57.html"><tt>client_info</tt> and <tt>timezone</tt> Tables (NIS+ to LDAP)</a></p>
<p class="toc level3"><a href="nisplus2ldap-60.html">Adding New Object Mappings (NIS+ to LDAP)</a></p>
<p class="toc level3"><a href="nisplus2ldap-70.html">Storing Configuration Information in LDAP</a></p>
<p class="toc level1 tocsp"><a href="ghnmu.html">Part&nbsp;V&nbsp;Active Directory Naming Service</a></p>
<p class="toc level2"><a href="ghnov.html">17.&nbsp;&nbsp;Setting Up Solaris Active Directory Clients</a></p>
<p class="toc level1 tocsp"><a href="whatsnew-1.html">A.&nbsp;&nbsp;Solaris 10 Software Updates to DNS, NIS, and LDAP</a></p>
<p class="toc level2"><a href="whatsnew-5.html">Service Management Facility Changes</a></p>
<p class="toc level2"><a href="whatsnew-2.html">DNS BIND</a></p>
<p class="toc level2"><a href="schemas-290.html"><tt>pam_ldap</tt> Changes</a></p>
<p class="toc level2"><a href="whatsnew-3.html">Documentation Errors</a></p>
<p class="toc level1 tocsp"><a href="aagloss-87604.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="nisplus2ldap-5"></a><h3>Getting Started With the NIS+ to LDAP Transition</h3>
<p>For an introduction to the configuration needed to start using an LDAP repository
for NIS+ data, see <a href="http://docs.sun.com/doc/819-2251/nis-plus-ldapmapping-4?a=view"><tt>NIS+LDAPmapping</tt>(4)</a>. The remainder of this section goes into
more detail about the organization of the configuration files.</p>

<a name="nisplus2ldap-6"></a><h4><tt>/etc/default/rpc.nisd</tt> File</h4>
<p>All assignments in the <tt>/etc/default/rpc.nisd</tt> file are of the <tt>attributeName=value</tt> type.</p>

<a name="nisplus2ldap-7"></a><h5>General Configuration</h5>
<a name="indexterm-593"></a><p>The following attributes control general configuration of the <tt>rpc.nisd</tt>, and are active
whether or not LDAP mapping is in effect. They should generally be left
at their default values. See <a href="http://docs.sun.com/doc/819-2251/rpc.nisd-4?a=view"><tt>rpc.nisd</tt>(4)</a> for more information.</p>
<ul><li><p><tt>nisplusNumberOfServiceThreads</tt></p></li>
<li><p><tt>nisplusThreadCreationErrorAction</tt></p></li>
<li><p><tt>nisplusThreadCreationErrorAttempts</tt></p></li>
<li><p><tt>nisplusThreadCreationErrorTimeout</tt></p></li>
<li><p><tt>nisplusDumpErrorAction</tt></p></li>
<li><p><tt>nisplusDumpErrorAttempts</tt></p></li>
<li><p><tt>nisplusDumpErrorTimeout</tt></p></li>
<li><p><tt>nisplusResyncService</tt></p></li>
<li><p><tt>nisplusUpdateBatching</tt></p></li>
<li><p><tt>nisplusUpdateBatchingTimeout</tt></p></li></ul>


<a name="nisplus2ldap-8"></a><h5>Configuration Data From LDAP</h5>
<p>The following attributes control the reading of other configuration attributes from LDAP. These
attributes cannot themselves reside in LDAP. They are read only from the command
line or the configuration file. See <a href="http://docs.sun.com/doc/819-2251/rpc.nisd-4?a=view"><tt>rpc.nisd</tt>(4)</a> for more information.</p>
<ul><li><p><tt>nisplusLDAPconfigDN</tt></p></li>
<li><p><tt>nisplusLDAPconfigPreferredServerList</tt></p></li>
<li><p><tt>nisplusLDAPconfigAuthenticationMethod</tt></p></li>
<li><p><tt>nisplusLDAPconfigTLS</tt></p></li>
<li><p><tt>nisplusLDAPconfigTLSCertificateDBPath</tt></p></li>
<li><p><tt>nisplusLDAPconfigProxyUser</tt></p></li>
<li><p><tt>nisplusLDAPconfigProxyPassword</tt></p></li></ul>


<a name="nisplus2ldap-9"></a><h5>Server Selection</h5>

<ul><li><p><tt>preferredServerList</tt></p><p>Specify the LDAP server and port number.</p><pre># LDAP server can be found at port 389
# LDAP server can be found at port 389
on the local machine
# preferredServerList=127.0.0.1
# Could also be written
# preferredServerList=127.0.0.0.1:389
LDAP server on the machine at IP
# address "1.2.3.4", at port 65042
# preferredServerList=1.2.3.4:65042</pre></li></ul>


<a name="nisplus2ldap-10"></a><h5>Authentication and Security</h5>

<ul><li><p><tt>authenticationMethod</tt></p></li>
<li><p><tt>nisplusLDAPproxyUser</tt></p></li>
<li><p><tt>nisplusLDAPproxyPassword</tt></p></li></ul>
<p>The authentication method and, if appropriate for the method selected, the proxy user
(bind distinguished name [DN]) and password (key or other shared secret) to be
used between the <tt>rpc.nisd</tt> daemon and the LDAP server. See <a href="nisplus2ldap-43.html#nisplus2ldap-46">Security and Authentication</a> for more information.</p>
<ul><li><p><tt>nisplusLDAPTLS</tt></p></li>
<li><p><tt>nisplusLDAPTLSCertificateDBPath</tt></p></li></ul>
<p>Optionally use SSL, and specify the location of the certificate file. See <a href="nisplus2ldap-43.html#nisplus2ldap-47">Using SSL</a>
for more information.</p>

<a name="nisplus2ldap-11"></a><h5>Default Location in LDAP and NIS+</h5>

<ul><li><p><tt>defaultSearchBase</tt></p><p>The point in the LDAP DIT where the containers for RFC 2307- style naming services data live. This is the default used when individual container DNs do not specify a full search base. See <a href="#nisplus2ldap-18"><tt>nisplusLDAPobjectDN</tt> Attribute</a> for more information.</p></li>
<li><p><tt>nisplusLDAPbaseDomain</tt></p><p>The default NIS+ domain name to use when NIS+ object specifications (see <a href="#nisplus2ldap-16"><tt>nisplusLDAPdatabaseIdMapping</tt> Attribute</a>) are not fully qualified.</p></li></ul>


<a name="nisplus2ldap-12"></a><h5>Timeout/Size Limits and Referral Action for LDAP Communication</h5>

<ul><li><p><tt>nisplusLDAPbindTimeout</tt></p></li>
<li><p><tt>nisplusLDAPmodifyTimeout</tt></p></li>
<li><p><tt>nisplusLDAPaddTimeout</tt></p></li>
<li><p><tt>nisplusLDAPdeleteTimeout</tt></p></li></ul>
<p>The above parameters are timeouts for the <tt>ldap</tt> <tt>bind</tt>, <tt>modify</tt>, <tt>add</tt>, and
<tt>delete</tt> operations, respectively. They should generally be left at their default values.</p>
<ul><li><p><tt>nisplusLDAPsearchTimeout</tt></p></li>
<li><p><tt>nisplusLDAPsearchTimeLimit</tt></p></li></ul>
<p>The above parameters set the timeout for the LDAP search operation, and request
a server-side search time limit, respectively. Since the <tt>nisplusLDAPsearchTimeLimit</tt> will control how
much time the LDAP server spends on the search request, make sure that
<tt>nisplusLDAPsearchTimeLimit</tt> is not smaller than <tt>nisplusLDAPsearchTimeout</tt>.  Depending on the performance of the NIS+
server, the LDAP server, and the connection between them, you might have to
increase the search limits from the default values. Watch for timeout syslog messages
from <tt>rpc.nisd</tt> as a clue to making these values larger.</p>
<ul><li><p><tt>nisplusLDAPsearchSizeLimit</tt></p><p>The above parameter requests a limit on the amount of LDAP data returned for an LDAP search request. The default is to ask for no limitation. This is a server side limit. The LDAP server might impose restrictions on the maximum, and these restrictions might be tied to the proxy user (bind DN) used. Make sure that the LDAP server allows the <tt>rpc.nisd</tt> to transfer enough data to account for the largest container (depending on the site, often the container used for <tt>passwd.org_dir</tt>, <tt>mail_aliases.org_dir</tt>, or <tt>netgroup.org_dir</tt>). Consult your LDAP server documentation for more information.</p></li>
<li><p><tt>nisplusLDAPfollowReferral</tt></p><p>The above parameter defines the action to be taken when an LDAP operation results in a referral to another LDAP server. The default is to <b>not</b> follow referrals. Enable follow referrals if you want or need referrals to be honored. Keep in mind that while referrals are convenient, they can also slow down operations by making the <tt>rpc.nisd</tt> talk to multiple LDAP servers for each request. The <tt>rpc.nisd</tt> should generally be pointed directly to an LDAP server that can handle all LDAP requests that the <tt>rpc.nisd</tt> might make.</p></li></ul>


<a name="nisplus2ldap-13"></a><h5>Error Actions</h5>
<p>The following parameters define the actions to take when an error occurs during
an LDAP operation. You should generally leave these at their defaults. See <a href="http://docs.sun.com/doc/819-2251/rpc.nisd-4?a=view"><tt>rpc.nisd</tt>(4)</a>
for more information.</p>
<ul><li><p><tt>nisplusLDAPinitialUpdateAction</tt></p></li>
<li><p><tt>nisplusLDAPinitialUpdateOnly</tt></p></li>
<li><p><tt>nisplusLDAPretrieveErrorAction</tt></p></li>
<li><p><tt>nisplusLDAPretrieveErrorAttempts</tt></p></li>
<li><p><tt>nisplusLDAPretrieveErrorTimeout</tt></p></li>
<li><p><tt>nisplusLDAPstoreErrorAction</tt></p></li>
<li><p><tt>nisplusLDAPstoreErrorAttempts</tt></p></li>
<li><p><tt>nisplusLDAPstoreErrorTimeout</tt></p></li>
<li><p><tt>nisplusLDAPrefreshErrorAction</tt></p></li>
<li><p><tt>nisplusLDAPrefreshErrorAttempts</tt></p></li>
<li><p><tt>nisplusLDAPrefreshErrorTimeout</tt></p></li></ul>


<a name="nisplus2ldap-14"></a><h5>General LDAP Operation Control</h5>

<ul><li><p><tt>nisplusLDAPmatchFetchAction</tt></p><p>The above parameter determines whether or not LDAP data should be pre-fetched for NIS+ match operations. In most cases, leave this value at the default. See <a href="http://docs.sun.com/doc/819-2251/rpc.nisd-4?a=view"><tt>rpc.nisd</tt>(4)</a> for more information.</p></li></ul>


<a name="nisplus2ldap-15"></a><h4><tt>/var/nis/NIS+LDAPmapping</tt> File</h4>
<p>The presence of the default <tt>NIS+LDAPmapping</tt> file serves as a master switch for
NIS+/LDAP mapping.</p><p>If you use a non-default mapping file, you will have to edit
the <tt>/lib/svc/method/nisplus</tt> script to specify the mapping file name on the <tt>rpc.nisd</tt> line
by using the <tt>-m</tt> <i>mappingfile</i> option. See <a href="nisplus2ldap-2.html#nisplus2ldap-66">NIS+ to LDAP Tools and the Service Management Facility</a> for more information.</p><p>For each NIS+ object that should be mapped to or from LDAP,
the <tt>NIS+LDAPmapping</tt> file specifies two to five attributes, depending on the object and
whether or not the default values are sufficient.</p>

<a name="nisplus2ldap-16"></a><h5><tt>nisplusLDAPdatabaseIdMapping</tt> Attribute</h5>
<p>You must establish an alias to be used in the other mapping
attributes. If the NIS+ object name is not fully qualified (does not end
in a dot), the value of the <tt>nisplusLDAPbaseDomain</tt> is appended.</p><p>For example,</p><pre>nisplusLDAPdatabaseIdMapping    rpc:rpc.org_dir</pre><p>defines the database id <tt>rpc</tt> as an alias for the NIS+ <tt>rpc.org_dir</tt>
table.</p><p>Note that NIS+ table objects might appear twice with two different database ids,
once for the table object itself (if the object should be mapped
to LDAP), and once for the table entries. For example,</p><pre>nisplusLDAPdatabaseIdMapping    rpc_table:rpc.org_dir
nisplusLDAPdatabaseIdMapping    rpc:rpc.org_dir</pre><p>defines the database ids <tt>rpc_table</tt> and <tt>rpc</tt> as aliases for the <tt>rpc.org_dir</tt> table.
Later definitions will make it clear that <tt>rpc_table</tt> is used for the <tt>rpc.org_dir</tt>
table object, and <tt>rpc</tt> for the entries in that table.</p>

<a name="nisplus2ldap-17"></a><h5><tt>nisplusLDAPentryTtl</tt> Attribute</h5>
<p>Since the <tt>rpc.nisd</tt> daemon's local database (in memory and on disk) functions as
a cache for LDAP data, the <tt>nisplusLDAPentryTtl</tt> attribute allows you to set
the time-to-live (TTL) values of entries in that cache. There are three TTLs
for each database ID. The first two control the initial TTL when the
<tt>rpc.nisd</tt> first loads the corresponding NIS+ object data from disk, and the third
TTL is assigned to an object when it is read or refreshed from
LDAP.</p><p>For example the following results in the <tt>rpc.org_dir</tt> table object getting an initial
TTL randomly selected in the range 21600 to 43200 seconds.</p><pre>nisplusLDAPentryTtl    rpc_table:21600:43200:43200</pre><p>When that initial TTL expires and the table object is refreshed from LDAP,
the TTL will be set to 43200 seconds.</p><p>Similarly the following will assign an initial TTL between 1800 and 3600 seconds
to the entries in the <tt>rpc.org_dir</tt> table when it is first loaded.</p><pre>nisplusLDAPentryTtl    rpc:1800:3600:3600</pre><p>Each entry gets its own randomly selected TTL in the range specified. When
a table entry expires and is refreshed, the TTL is set to
3600 seconds.</p><p>When selecting TTL values, consider the trade-off between performance and consistency. If the
TTLs used for LDAP data cached by the <tt>rpc.nisd</tt> are very long, performance
is the same as if <tt>rpc.nisd</tt> was not mapping data from LDAP at
all. However, if the LDAP data is changed (by some entity other than
<tt>rpc.nisd</tt>), it can also take a very long time before that change is
visible in NIS+.</p><p>Conversely, selecting a very short (or even zero) TTL means that changes to
LDAP data are quickly visible in NIS+, but can also impose a
significant performance penalty. Typically, an NIS+ operation that also reads data from or writes
data to LDAP will take at least two to three times longer
(plus the LDAP lookup overhead) than the same operation without LDAP communication. Although performance
can vary greatly depending on the hardware resources, scanning a large (tens of
thousands or hundreds of thousands of entries) LDAP container to identify NIS+ entries
that should be refreshed can take a long time. The <tt>rpc.nisd</tt>daemon performs this
scan in the background, continuing to serve possibly stale data while it is
running, but the background scan still consumes CPU and memory on the NIS+
server.</p><p>Carefully consider how critical it is to have NIS+ data in close
synchronization with LDAP, and select the longest TTL that is acceptable for each
NIS+ object. The default (when no <tt>nisplusLDAPentryTtl</tt> is specified) is 1 hour. The template
mapping file <tt>/var/nis/NIS+LDAPmapping.template</tt> changes this to 12 hours for objects other than table
entries. However, there is no auto-recognition of non-entry objects, so if you add
mapping for a non-entry object, the TTL will default to 1 hour.</p>
<hr><p><b>Note - </b>There are no TTLs for nonexistent objects. Hence, no matter which TTLs are
in effect for LDAP-mapped entries in an NIS+ table, a request for an
entry that does not exist in NIS+ will query LDAP for that
entry.</p>
<hr>


<a name="nisplus2ldap-18"></a><h5><tt>nisplusLDAPobjectDN</tt> Attribute</h5>
<p>For each mapped NIS+ object, <tt>nisplusLDAPobjectDN</tt> establishes the location in the LDAP DIT
where the object data resides. It also allows specification of the action to
take when an LDAP entry is deleted. Each <tt>nisplusLDAPobjectDN</tt> value has three
parts. The first specifies where LDAP data is read from, the second to
where it is written, and the third what should happen when LDAP data
is deleted. Refer to the following example.</p><pre>nisplusLDAPobjectDN    rpc_table:\
           cn=rpc,ou=nisPlus,?base?\
              objectClass=nisplusObjectContainer:\
           cn=rpc,ou=nisPlus,?base?\
              objectClass=nisplusObjectContainer,\
              objectClass=top</pre><p>The above example shows that the <tt>rpc.org_dir</tt> table object should be read from
the DN <tt>cn=rpc,ou=nisPlus</tt>, (since the value ends in a comma, the value of
the <tt>defaultSearchBase</tt> attribute is appended), with scope <tt>base</tt>, and that entries with a value
of <tt>nisplusObjectContainer</tt> for the <tt>ObjectClass</tt> attribute are selected.</p><p>The table object is written to the same place. The delete specification is
missing, which implies the default action, which is as follows. If the NIS+
table object is deleted, the entire LDAP entry should also be deleted.</p><p>If data should be read from, but not written to LDAP, omit
the write portion (and the colon separating it from the read part).</p><pre>nisplusLDAPobjectDN    rpc_table:\
              cn=rpc,ou=nisPlus,?base?\
              objectClass=nisplusObjectContainer</pre><p>Note that the <tt>nisplusObjectContainer</tt> object class is not part of RFC 2307. In
order to use it, you must configure your LDAP server as detailed in
<a href="nisplus2ldap-49.html">Mapping NIS+ Objects Other Than Table Entries</a>.</p><p>For the <tt>rpc.org_dir</tt> table entries, you could use the following example.</p><pre>nisplusLDAPobjectDN rpc:ou=Rpc,?one?objectClass=oncRpc:\
              ou=Rpc,?one?objectClass=onRpc,objectClass=top</pre><p>The above shows that the table entries are read from and written
to the base <tt>ou=Rpc</tt>. Again, the trailing comma appends the <tt>defaultSearchBase</tt> value. Select
entries that have an <tt>objectClass</tt> attribute value of <tt>oncRpc</tt>. When creating an entry
in the <tt>ou=Rpc</tt> container in LDAP, you also must specify <tt>top</tt> as
an <tt>objectClass</tt> value.</p><p>As an example showing a non-default delete specification, consider the following.</p><pre>nisplusLDAPobjectDN    user_attr:\
              ou=People,?one?objectClass=SolarisUserAttr,\
                 solarisAttrKeyValue=*:\
              ou=People,?one?objectClass=SolarisUserAttr:\
                 dbid=user_attr_del</pre><p>The <tt>user_attr.org_dir</tt> data resides in the <tt>ou=People</tt> LDAP container, which it shares
with account information from other sources, such as the <tt>passwd.org_dir</tt> NIS+ table.</p><p>Select entries in that container that have the <tt>solarisAttrKeyValue</tt> attribute, since only
those contain <tt>user_attr.org_dir</tt> data. The <tt>dbid=user_attr_del</tt> portion of the <tt>nisplusLDAPobjectDN</tt> shows that when
an entry in the <tt>user_attr.org_dir</tt> NIS+ table entry is deleted, deletion of the
corresponding LDAP entry (if any) should follow the rules in the rule set
identified by the <tt>user_attr_del</tt> database ID. See <a href="#nisplus2ldap-20"><tt>nisplusLDAPcolumnFromAttribute</tt> Attribute</a> for more information.</p>

<a name="nisplus2ldap-19"></a><h5><tt>nisplusLDAPattributeFromColumn</tt> Attribute</h5>
<p><tt>nisplusLDAPattributeFromColumn</tt> specifies the rules used to map NIS+ data to LDAP. Mapping rules
for the other direction is controlled by <tt>nisplusLDAPcolumnFromAttribute</tt>.</p>

<a name="nisplus2ldap-20"></a><h5><tt>nisplusLDAPcolumnFromAttribute</tt> Attribute</h5>
<p><tt>nisplusLDAPcolumnFromAttribute</tt> specifies the rules used to map LDAP data to NIS+.</p><p>The full entry mapping syntax can be found on <a href="http://docs.sun.com/doc/819-2251/nis-plus-ldapmapping-4?a=view"><tt>NIS+LDAPmapping</tt>(4)</a>. However, a
few examples should make things clearer.</p><p>The NIS+ <tt>rpc.org_dir</tt> table contains four columns called <tt>cname</tt>, <tt>name</tt>, <tt>numbe</tt>, and <tt>comment</tt>. Therefore,
the entries for the NIS+ RPC program number (100300) with the canonical name
<tt>nisd</tt> and the aliases <tt>rpc.nisd</tt> and <tt>nisplusd</tt> could be represented by the following
NIS+ entries in <tt>rpc.org_dir</tt>.</p><pre>nisd nisd 100300    NIS+ server
nisd rpc.nisd 100300    NIS+ server
nisd nisplusd 100300    NIS+ server</pre><p>Assuming the <tt>defaultSearchBase</tt> value is <tt>dc=some,dc=domain</tt>, the corresponding LDAP entry, as listed
by <a href="http://docs.sun.com/doc/819-2239/ldapsearch-1?a=view"><tt>ldapsearch</tt>(1)</a>, would be the following.</p><pre>dn: cn=nisd,ou=Ppc,dc=some,dc=domain
cn: nisd
cn: rpc.nsid
cn: nisplusd
oncRpcNumber: 100300
description: NIS+ server
objectClass: oncRpc</pre><p>This makes for a simple one-to-one mapping between NIS+ and LDAP data, and
the corresponding mapping attribute value going from NIS+ to LDAP is the following.</p><pre>nisplusLDAPattributeFromColumn \
rpc:        dn=("cn=%s,", name), \
                cn=cname, \
                cn=name, \
                oncRpcNumber=number, \
                description=comment</pre><p>This constructs the DN for the entry to be <tt>cn=%s</tt>, with the value
of the <tt>cname</tt> column substituted for <tt>%s</tt>.</p><pre>cn=nisd,</pre><p>Since the value ends in a comma, the read base value from
the <tt>nisplusObjectDN</tt> is appended, and you have the following.</p><pre>cn=nisd,ou=Rpc,dc=some,dc=domain</pre><p>The <tt>oncRpcNumber</tt> and <tt>description</tt> attribute values are just simple assignments of the corresponding
NIS+ column values. The <tt>rpc.nisd</tt> will collect the multiple NIS+ entries into one LDAP
entry, with multiple <tt>cn</tt> values to represent the different <tt>name</tt> column values.</p><p>Similarly, the mapping from LDAP to NIS+ would be as follows.</p><pre>nisplusLDAPcolumnFromAttribute \
       rpc:      cname=cn, \
                 (name)=(cn), \
                 number=oncRpcNumber, \
                 comment=description</pre><p>The above assigns the <tt>oncRpcNumber</tt> and <tt>description</tt> values to the corresponding NIS+
columns. The multi-valued <tt>cn</tt> (denoted by <tt>(cn)</tt> is mapped to multiple <tt>name</tt>
column values (denoted by <tt>(name)</tt>). Since the <tt>name</tt> column cannot be multi-valued,
the <tt>rpc.nisd</tt> creates one NIS+ entry for each <tt>cn</tt> value.</p><p>Finally, the <tt>nisplusLDAPattributeFromColumn</tt> value is an example of rule sets used for deletion.</p><pre>nisplusLDAPattributeFromColumn \
user_attr_del:    dn=("uid=%s,", name), \
           SolarisUserQualifier=, \
           SolarisAttrReserved1=, \
           SolarisAttrReserved2=, \
           SolarisAttrKeyValue=</pre><p>Again, the <tt>user_attr.org_dir</tt> data shares the <tt>ou=People</tt> container with other account information
(from the <tt>passwd.org_dir</tt> and other tables). If an entry in the <tt>user_attr.org_dir</tt>
table is deleted, you probably do not want to delete the entire <tt>ou=People</tt>
entry. Instead, the delete entry above says that when a <tt>user_attr.org_dir</tt> entry is deleted,
the <tt>SolarisUserQualifier</tt>,  <tt>SolarisAttrReserved1</tt>, <tt>SolarisAttrReserved2</tt>, and <tt>SolarisAttrKeyValue</tt> attributes (if any) are deleted
from the <tt>ou=People</tt> entry specified by the following rule.</p><pre>dn=("uid=%s,", name)</pre><p>The rest of the LDAP entry is left unchanged.</p>

<a name="nisplus2ldap-21"></a><h4>NIS+ to LDAP Migration Scenarios</h4>
<p>Likely scenarios for a migration from NIS+ to LDAP include the following.</p>
<ul><li><p><b>Convert all NIS+ clients to LDAP in one operation.</b> You can use the <tt>rpc.nisd</tt> daemon to upload any NIS+ data that  does not yet exist in LDAP. See <a href="#nisplus2ldap-proc-22">How to Convert All NIS+ Data to LDAP in One Operation</a>.</p></li>
<li><p><b>Do a gradual migration from NIS+ to LDAP.</b> Start by converting NIS+ data to LDAP (see <a href="#nisplus2ldap-proc-22">How to Convert All NIS+ Data to LDAP in One Operation</a>). You could have both NIS+ and LDAP clients sharing the same naming service data, and let the <tt>rpc.nisd</tt> automatically keep NIS+ and LDAP data synchronized. Initially, perhaps, NIS+ would be authoritative, and the LDAP server(s) would maintain a duplicate of the NIS+ data for the benefit of LDAP clients. At a convenient time, LDAP can become the authoritative naming service, and NIS+ service gradually phased out, until there are no more NIS+ clients.</p></li>
<li><p>LDAP is already used as a naming service, so you need to merge the NIS+ and LDAP data. There are three possible ways to perform this merge.</p>
<ul><li><p><b>Add the NIS+ data to LDAP.</b> Entries that exist in NIS+, but not in LDAP, are added to LDAP. Entries that appear both in NIS+ and LDAP, but with different data, end up with the NIS+ data. See <a href="#nisplus2ldap-proc-22">How to Convert All NIS+ Data to LDAP in One Operation</a>.</p></li>
<li><p><b>Overwrite the NIS+ data with the LDAP data.</b> If there are entries that exist in NIS+ but not in LDAP, they will disappear from NIS+. Entries that exist both in NIS+ and LDAP end up with the LDAP data. See <a href="#nisplus2ldap-proc-25">How to Convert All LDAP Data to NIS+ in One Operation</a>.</p></li>
<li><p><b>Merge NIS+ and LDAP data, resolving conflicts on an individual basis.</b> See <a href="#nisplus2ldap-28">Merging NIS+ and LDAP Data</a>.</p></li></ul>
</li></ul>


<a name="nisplus2ldap-proc-22"></a><h5>How to Convert All NIS+ Data to LDAP in One Operation</h5>
<ul>
<li><a name="nisplus2ldap-step-23"></a><b>Use the <tt>rpc.nisd</tt> to upload any NIS+ data that does not yet exist
in LDAP.</b><p>Assuming all NIS+/LDAP data mappings have been established in the default location (<tt>/var/nis/NIS+LDAPmapping</tt>), use
the following command.</p><pre># <tt><b>/usr/sbin/rpc.nisd -D \</b></tt> 
 <tt><b>-x nisplusLDAPinitialUpdateAction=to_ldap \</b></tt>
 <tt><b>-x nisplusLDAPinitialUpdateOnly=yes</b></tt></pre><p>The above would make the <tt>rpc.nisd</tt> upload data to LDAP, and then exit.
The NIS+ data would be unaffected by this operation.</p><p>See the <tt>nisplusLDAPinitialUpdateAction</tt> attribute on <a href="http://docs.sun.com/doc/819-2251/rpc.nisd-4?a=view"><tt>rpc.nisd</tt>(4)</a>.</p></li></ul>

<a name="nisplus2ldap-proc-25"></a><h5>How to Convert All LDAP Data to NIS+ in One Operation</h5>
<ul>
<li><a name="nisplus2ldap-step-26"></a><b>Use the <tt>rpc.nisd</tt> to download all LDAP data to NIS+, overwriting existing NIS+
data.</b><p>Assuming all NIS+/LDAP data mappings have been established in the default location (<tt>/var/nis/NIS+LDAPmapping</tt>), use
the following command.</p><pre># <tt><b>/usr/sbin/rpc.nisd -D \</b></tt>
<tt><b>-x nisplusLDAPinitialUpdateAction=from_ldap \</b></tt>
<tt><b>-x nisplusLDAPinitialUpdateOnly=yes</b></tt></pre><p>The above would make the <tt>rpc.nisd</tt> daemon download data from LDAP, and then
exit. The LDAP data would be unaffected by this operation.</p><p>See the <tt>nisplusLDAPinitialUpdateAction</tt> attribute on <a href="http://docs.sun.com/doc/819-2251/rpc.nisd-4?a=view"><tt>rpc.nisd</tt>(4)</a>.</p></li></ul>

<a name="nisplus2ldap-28"></a><h4>Merging NIS+ and LDAP Data</h4>
<p><a href="#nisplus2ldap-21">NIS+ to LDAP Migration Scenarios</a> showed how to synchronize NIS+ and LDAP data when data conflicts between
the two should be resolved by letting either the NIS+ or the LDAP
data be authoritative. Merging data requires a more complicated procedure.</p><p>The example procedure in this section assumes the following.</p>
<ul><li><p>You are putting a backup of the NIS+ data in the <tt>/nisbackup</tt> directory.</p></li>
<li><p>Valid mapping configuration already exists in <tt>/etc/default/rpc.nisd</tt> and <tt>/var/nis/tmpmap</tt> (for tables that should be merged).</p></li>
<li><p>Flat file representations of the NIS+ data before the merge are stored in <tt>/before</tt>, and after-merge representations in <tt>/after</tt>.</p></li>
<li><p><tt>niscat</tt> is used to dump flat file representations of custom NIS+ tables not supported by <a href="http://docs.sun.com/doc/819-2240/nisaddent-1m?a=view"><tt>nisaddent</tt>(1M)</a>. You might have your own commands or scripts for dumping and loading such custom tables from and to NIS+. If so, those commands/scripts should be used in preference to <tt>niscat</tt> since the latter has no convenient counterpart to load data back into NIS+.</p><p>If you are forced to dump data using <a href="http://docs.sun.com/doc/819-2239/niscat-1?a=view"><tt>niscat</tt>(1)</a>, you can use <a href="http://docs.sun.com/doc/819-2239/nistbladm-1?a=view"><tt>nistbladm</tt>(1)</a> to load entries back into NIS+ one by one.</p></li>
<li><p>Your command path includes <tt>/usr/lib/nis</tt> (which is where <a href="http://docs.sun.com/doc/819-2240/nisaddent-1m?a=view"><tt>nisaddent</tt>(1M)</a> resides).</p></li></ul>


<a name="nisplus2ldap-proc-29"></a><h5>How to Merge NIS+ and LDAP Data</h5>

<hr><p><b>Caution - </b>If the LDAP data should change between the download in Step 4 and
the upload in Step 10, the upload might overwrite those changes. For this
reason, you should try to prevent modifications to the LDAP data during this
procedure. Consult your LDAP server documentation for more information.</p>
<hr>
<ol>
<li><a name="nisplus2ldap-step-30"></a><b>Back up all NIS+ data using the <tt>nisbackup</tt> command.</b><pre># <tt><b>nisbackup -a /nisbackup</b></tt></pre></li>
<li><a name="nisplus2ldap-step-31"></a><b>Identify the NIS+ tables that have data which must be merged with LDAP.
Dump the contents of these tables to flat files. For example, dump the
contents of <tt>group.org_dir</tt> by using <tt>nisaddent</tt> as follows.</b><pre># <tt><b>nisaddent -d group | sort &gt; /before/group</b></tt></pre><p>Piping the <tt>nisaddent</tt> output to <tt>sort</tt> will make for convenient comparison later on.</p></li>
<li><a name="nisplus2ldap-step-32"></a><b>Stop the NIS+ service.</b><pre># <tt><b>svcadm disable network/rpc/nisplus:default</b></tt></pre></li>
<li><a name="nisplus2ldap-step-33"></a><b>Download LDAP data to NIS+.</b><pre># <tt><b>/usr/sbin/rpc.nisd -D -m tmpmap \</b></tt>
<tt><b>-x nisplusLDAPinitialUpdateAction=from_ldap \</b></tt>
<tt><b>-x nisplusLDAPinitialUpdateOnly=yes</b></tt></pre></li>
<li><a name="nisplus2ldap-step-34"></a><b>Start the NIS+ service.</b><pre># <tt><b>svcadm enable network/rpc/nisplus:default</b></tt></pre><p>The <tt>rpc.nisd</tt> daemon will now be serving the data downloaded from LDAP. If
the conflicts to be resolved are such that NIS+ clients should not be
exposed to them, make sure to perform this and the following steps when
there are few (preferably no) active NIS+ clients.</p></li>
<li><a name="nisplus2ldap-step-35"></a><b>Dump the NIS+ data for the affected tables.</b><p>The following example uses the <tt>group.org_dir</tt> table.</p><pre># <tt><b>nisaddent -d group | sort &gt; /after/group</b></tt></pre></li>
<li><a name="nisplus2ldap-step-36"></a><b>Create merged versions of the tables.</b><p>Use the file merge procedure of your choice to produce the merged
tables. If no other tools are available, you can use <a href="http://docs.sun.com/doc/819-2239/diff-1?a=view"><tt>diff</tt>(1)</a> to collect
differences between the <tt>/before</tt> and <tt>/after</tt> files, and merge manually with a
text editor.</p><p>The following example assumes that the merged results are available in <tt>/after</tt>.</p></li>
<li><a name="nisplus2ldap-step-37"></a><b>Load the merged data into NIS+. The following example uses the <tt>group</tt> table.</b><pre># <tt><b>nisaddent -m -f /after/group group</b></tt></pre></li>
<li><a name="nisplus2ldap-step-38"></a><b>Remove LDAP entries that should not exist after the merge.</b><p>A. If there are LDAP entries that do not exist in the (now
merged) NIS+ data, and that should not exist in LDAP after the upload,
you must remove those LDAP entries.</p><p>Your LDAP server might provide a convenient method for removing multiple entries, such
as a way to delete all entries in a container. If this
is not the case, you can use <a href="http://docs.sun.com/doc/819-2239/ldapsearch-1?a=view"><tt>ldapsearch</tt>(1)</a> to generate a list of entries
for each container. For example, to generate a list of all entries in
the <tt>ou=Rpc</tt> container, use <a href="http://docs.sun.com/doc/819-2239/ldapsearch-1?a=view"><tt>ldapsearch</tt>(1)</a> as follows.</p><pre># <tt><b>ldapsearch -h </tt><i>server-address</i><tt> -D </tt><i>bind-DN</i><tt> -w </tt><i>password</i><tt> \</b></tt>
 <tt><b>-b ou=Rpc,</tt><i>search-base</i><tt> 'objectClass=*' dn | \</b></tt>
<tt><b>grep -i ou=Rpc | grep -v -i \^ou=Rpc &gt; /tmp/delete-dn</b></tt></pre><p>See <a href="nisplus2ldap-43.html#nisplus2ldap-48">Performance and Indexing</a> for an explanation of the meta-arguments (<i>server-address</i>, <i>bind-DN</i>, for example).</p><p>B. You can now edit the result file (<tt>/tmp/delete-dn</tt>) to specify only those
entries that should be removed. Alternatively, in order to remove all entries in
the container, use the file as is, and rely on the NIS+ upload
to restore the LDAP data. Either way, you should backup the LDAP data
before performing the <tt>ldapdelete</tt> operation below.</p><p>C. Use <tt>ldapdelete</tt> to remove LDAP entries, redirecting <tt>stdout</tt> (which usually is
one blank line for each entry removed) to <tt>/dev/null</tt>.</p><pre># <tt><b>ldapdelete</b></tt> <tt>-h</tt> <tt><b></tt><i>server-address</i><tt></b></tt> <tt>-D</tt> <tt><b></tt><i>bind-DN</i><tt></b></tt> <tt>-w</tt> <tt><b></tt><i>password</i><tt> \</b></tt>
<tt><b></b></tt><tt>/tmp/delete-dn</tt> <tt><b>/dev/null</b></tt></pre><p>D. Repeat the above procedure for each container that has at least
one entry which must be removed.</p></li>
<li><a name="nisplus2ldap-step-39"></a><b>Upload the merged NIS+ data to LDAP.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Stop the NIS+ service.</b><pre># <tt><b>svcadm disable network/rpc/nisplus:default</b></tt></pre></li>
<li><a name="nisplus2ldap-step-3"></a><b>Perform the upload.</b><pre># <tt><b>/usr/sbin/rpc.nisd -D -m tmpmap \</b></tt> 
<tt><b>-x nisplusLDAPinitialUpdateAction=to_ldap \</b></tt>
<tt><b>-x nisplusLDAPinitialUpdateOnly=yes</b></tt></pre></li></ol></li>
<li><a name="nisplus2ldap-step-4"></a><b>(Optional) Modify the <tt>/lib/svc/method/nisplus</tt> file as needed.</b>
<ul><li><p>If the <tt>rpc.nisd</tt> daemon uses the LDAP repository, specify an appropriate mapping file with the <tt>-m</tt> <i>mappingfile</i> option, if the default <tt>/var/yp/NIS+LDAPmapping</tt> file is not used.</p></li>
<li><p>If the <tt>rpc.nisd</tt> daemon provides NIS (YP) emulation, specify the <tt>-Y</tt> option by using <tt>svcprop</tt> or by modifying the <tt>/lib/svc/method/nisplus</tt> file.</p></li></ul>
<p>See <a href="nisplus2ldap-2.html#nisplus2ldap-66">NIS+ to LDAP Tools and the Service Management Facility</a> for more information.</p></li>
<li><a name="nisplus2ldap-step-40"></a><b>Start the NIS+ service.</b><pre># <tt><b>svcadm enable network/rpc/nisplus:default</b></tt></pre></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="nisplus2ldap-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="nisplus2ldap-41.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

