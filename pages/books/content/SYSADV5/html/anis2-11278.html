<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Working With NIS Maps - System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2009-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="anis2-38485.html">Previous</a>
             </td>
             <td align="right">
                 <a href="anis2-1010.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="intro-1.html">Part&nbsp;I&nbsp;About Naming and Directory Services</a></p>
<p class="toc level2"><a href="intro2ns-2.html">1.&nbsp;&nbsp;Naming and Directory Services (Overview)</a></p>
<p class="toc level2"><a href="a12swit-86415.html">2.&nbsp;&nbsp;The Name Service Switch (Overview)</a></p>
<p class="toc level1 tocsp"><a href="dnsadmin-1.html">Part&nbsp;II&nbsp;DNS Setup and Administration</a></p>
<p class="toc level2"><a href="dnsref-1.html">3.&nbsp;&nbsp;DNS Setup and Administration (Reference)</a></p>
<p class="toc level1 tocsp"><a href="nissetup-1.html">Part&nbsp;III&nbsp;NIS Setup and Administration</a></p>
<p class="toc level2"><a href="anis1-25461.html">4.&nbsp;&nbsp;Network Information Service (NIS) (Overview)</a></p>
<p class="toc level2"><a href="cnis1-25208.html">5.&nbsp;&nbsp;Setting Up and Configuring NIS Service</a></p>
<p class="toc level2"><a href="anis2-22217.html">6.&nbsp;&nbsp;Administering NIS (Tasks)</a></p>
<p class="toc level3"><a href="anis2-32914.html">Password Files and Namespace Security</a></p>
<p class="toc level3"><a href="anis2-38485.html">Administering NIS Users</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Working With NIS Maps</a></p>
</div>
<p class="toc level3"><a href="anis2-1010.html">Updating and Modifying Existing Maps</a></p>
<p class="toc level3"><a href="anis2-34392.html">Adding a Slave Server</a></p>
<p class="toc level3"><a href="anis2-25789.html">Using NIS With C2 Security</a></p>
<p class="toc level3"><a href="anis2-manualbind-1.html">Binding to a Specific NIS Server</a></p>
<p class="toc level3"><a href="anis2-16615.html">Changing a Machine's NIS Domain</a></p>
<p class="toc level3"><a href="anis2-21536.html">Using NIS in Conjunction With DNS</a></p>
<p class="toc level3"><a href="anis2-22142.html">Turning Off NIS Services</a></p>
<p class="toc level2 tocsp"><a href="abtrbl-18694.html">7.&nbsp;&nbsp;NIS Troubleshooting</a></p>
<p class="toc level1 tocsp"><a href="ldapsetup-1.html">Part&nbsp;IV&nbsp;LDAP Naming Services Setup and Administration</a></p>
<p class="toc level2"><a href="overview-1.html">8.&nbsp;&nbsp;Introduction to LDAP Naming Services (Overview/Reference)</a></p>
<p class="toc level2"><a href="ldapsecure-1.html">9.&nbsp;&nbsp;LDAP Basic Components and Concepts (Overview)</a></p>
<p class="toc level2"><a href="planldap-1.html">10.&nbsp;&nbsp;Planning Requirements for LDAP Naming Services (Tasks)</a></p>
<p class="toc level2"><a href="sundssetup-13.html">11.&nbsp;&nbsp;Setting Up Sun Java System Directory Server With LDAP Clients (Tasks)</a></p>
<p class="toc level2"><a href="clientsetup-1.html">12.&nbsp;&nbsp;Setting Up LDAP Clients (Tasks)</a></p>
<p class="toc level2"><a href="setupproblems-1.html">13.&nbsp;&nbsp;LDAP Troubleshooting (Reference)</a></p>
<p class="toc level2"><a href="schemas-1.html">14.&nbsp;&nbsp;LDAP General Reference (Reference)</a></p>
<p class="toc level2"><a href="nis2ldap-34.html">15.&nbsp;&nbsp;Transitioning From NIS to LDAP (Overview/Tasks)</a></p>
<p class="toc level2"><a href="nisplus2ldap-1.html">16.&nbsp;&nbsp;Transitioning From NIS+ to LDAP</a></p>
<p class="toc level1 tocsp"><a href="ghnmu.html">Part&nbsp;V&nbsp;Active Directory Naming Service</a></p>
<p class="toc level2"><a href="ghnov.html">17.&nbsp;&nbsp;Setting Up Solaris Active Directory Clients</a></p>
<p class="toc level1 tocsp"><a href="whatsnew-1.html">A.&nbsp;&nbsp;Solaris 10 Software Updates to DNS, NIS, and LDAP</a></p>
<p class="toc level2"><a href="whatsnew-5.html">Service Management Facility Changes</a></p>
<p class="toc level2"><a href="whatsnew-2.html">DNS BIND</a></p>
<p class="toc level2"><a href="schemas-290.html"><tt>pam_ldap</tt> Changes</a></p>
<p class="toc level2"><a href="whatsnew-3.html">Documentation Errors</a></p>
<p class="toc level1 tocsp"><a href="aagloss-87604.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="anis2-11278"></a><h3>Working With NIS Maps</h3>
<a name="indexterm-348"></a><p>This section contains the following information:</p>
<ul><li><p><a href="#anis2-41232">Obtaining Map Information</a></p></li>
<li><p><a href="#anis2-42736">Changing a Map's Master Server</a></p></li>
<li><p><a href="#anis2-40083">Modifying Configuration Files</a></p></li>
<li><p><a href="#anis2-20638">Modifying and Using the <tt>Makefile</tt></a></p></li></ul>


<a name="anis2-41232"></a><h4>Obtaining Map Information</h4>
<a name="indexterm-349"></a><p>Users can obtain information from and about the maps at any time
by using the <tt>ypcat</tt>, <tt>ypwhich</tt>, and <tt>ypmatch</tt> commands. In the examples that follow,
<i>mapname</i> refers both to the official name of a map and to its
nickname, if any.</p><p>To list all the values in a map, type the following.</p><pre>% <tt><b>ypcat </tt><i>mapname</i><tt></b></tt></pre><p>To list both the keys and the values (if any) in a
map, type the following.</p><pre>% <tt><b>ypcat</b></tt> <tt>-k</tt> <tt><b></tt><i>mapname</i><tt></b></tt></pre><p>To list all the map nicknames, type any of the following commands.</p><pre>% <tt><b>ypcat</b></tt> <tt>-x</tt><tt><b></b></tt>
% <tt><b>ypmatch</b></tt> <tt>-x</tt><tt><b></b></tt>
% <tt><b>ypwhich</b></tt> <tt>-x</tt><tt><b></b></tt></pre><p>To list all the available maps and their master(s), type the following.</p><pre>% <tt><b>ypwhich</b></tt> <tt>-m</tt><tt><b></b></tt></pre><p>To list the master server for a particular map, type the following.</p><pre>% <tt><b>ypwhich</b></tt> <tt>-m</tt> <tt><b></tt><i>mapname</i><tt></b></tt></pre><p>To match a key with an entry in a map, type the
following.</p><pre>% <tt><b>ypmatch </tt><i>key</i><tt> </tt><i>mapname</i><tt></b></tt></pre><p>If the item you are looking for is not a key in
a map, type the following.</p><pre>% <tt><b>ypcat </tt><i>mapname</i><tt> | grep </tt><i>item</i><tt></b></tt></pre><p>where <i>item</i> is the information for which you are searching. To obtain information
about other domains, use the <tt>-d domainname</tt> options of these commands.</p><p>If the machine requesting information for a domain other than its default does
not have a binding for the requested domain, <tt>ypbind</tt>consults the <tt>/var/yp/binding/</tt><i>domainname</i><tt>/ypservers</tt> file for
a list of servers for that domain. If this file does not exist
it issues an RPC broadcast for a server. In this case, there must
be a server for the requested domain on the same subnet as
the requesting machine. </p>

<a name="anis2-42736"></a><h4>Changing a Map's Master Server</h4>
<a name="indexterm-350"></a><p><a name="indexterm-351"></a><a name="indexterm-352"></a>To change the master server for a selected map, you first have to
build the map on the new NIS master. Since the old master server
name occurs as a key-value pair in the existing map (this pair is
inserted automatically by <tt>makedbm</tt>), copying the map to the new master or transferring
a copy to the new master with <tt>ypxfr</tt> is insufficient. You have to
reassociate the key with the new master server name. If the map has
an ASCII source file, you should copy this file to the new master.</p>

<a name="anis2-proc-12"></a><h5>How to Change a Map's Master Server</h5>
<ol>
<li><a name="anis2-step-1011"></a><b>On the new master, become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-1?a=view">Chapter 9, Using Role-Based Access Control (Tasks), in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><a name="anis2-step-13"></a><b>Change directories.</b><pre>newmaster# <tt><b>cd /var/yp</b></tt></pre></li>
<li><a name="anis2-step-14"></a><b><a name="indexterm-353"></a>The <tt>Makefile</tt> must have an entry for the new map before you
specify the map to make. If this is not the case, edit the
<tt>Makefile</tt> now, using a map called <tt>sites.byname</tt>.</b></li>
<li><a name="anis2-step-15"></a><b>To update or remake the map, type the following.</b><pre>newmaster# <tt><b>make sites.byname</b></tt></pre></li>
<li><a name="anis2-step-16"></a><b>If the old master remains an NIS server, remote log in (<tt>rlogin</tt>) to
the old master and edit <tt>Makefile</tt>. Make sure you comment out the section
of the <tt>Makefile</tt> that made <tt>sites.byname</tt> so that it is no longer made
there.</b></li>
<li><a name="anis2-step-17"></a><b><a name="indexterm-354"></a><a name="indexterm-355"></a><a name="indexterm-356"></a>If <tt>sites.byname</tt> only exists as an <tt>ndbm</tt> file, remake it on the new
master by disassembling a copy from any NIS server, then running the disassembled
version through <tt>makedbm</tt>.</b><pre>newmaster# <tt><b>cd /var/yp</b></tt>
newmaster# <tt><b>ypcat sites.byname | makedbm</b></tt> <tt>-</tt><i>domain</i><tt>-</tt><tt><b>/sites.byname</b></tt></pre><p><a name="indexterm-357"></a>After making the map on the new master, you must send a copy
of the new map to the other slave servers. Do not use
<tt>yppush</tt>, because the other slaves will try to get new copies from the
old master, rather than the new one. A typical method for circumventing this
is to transfer a copy of the map from the new master
back to the old master. To do this, become superuser, or assume an
equivalent role, on the old master server and type the following.</p><pre>oldmaster# <tt><b>/usr/lib/netsvc/yp/ypxfr</b></tt> <tt>-h</tt> <tt><b>newmaster sites.byname</b></tt></pre><p>Now it is safe to run <tt>yppush</tt>. Any remaining slave servers still believe
that the old master is the current master and will attempt to get
the current version of the map from the old master. When clients
do so, they will get the new map, which names the new master
as the current master.</p><p><a name="indexterm-358"></a>If this method fails, you can log in as root on each NIS
server and execute the <tt>ypxfr</tt> command shown above.</p></li></ol>

<a name="anis2-40083"></a><h4>Modifying Configuration Files</h4>
<a name="indexterm-359"></a><a name="indexterm-360"></a><p>NIS intelligently parses the setup files. Although this makes NIS administration easier, it
does make the behavior of NIS more sensitive to changes in the setup
and configuration files.</p><p>Use the procedures in this section when modifying any of the following.</p>
<ul><li><p><a name="indexterm-361"></a><a name="indexterm-362"></a><tt>/var/yp/Makefile</tt> to add or delete supported maps</p></li>
<li><p>Adding or deleting <tt>/etc/resolv.conf</tt> to allow or deny DNS forwarding</p></li>
<li><p><a name="indexterm-363"></a><a name="indexterm-364"></a>Adding or deleting <tt>$PWDIR/security/passwd.adjunct</tt> to allow or deny C2 security (<tt>$PWDIR</tt> is defined in <tt>/var/yp/Makefile</tt>)</p></li></ul>


<a name="anis2-proc-18"></a><h5>How to Modify Configuration Files</h5>
<p>You do not have to stop and start NIS when changing NIS
maps or the map source files.</p><p>Keep the following in mind.</p>
<ul><li><p>Deleting a map or source file from an NIS master server does not automatically result in corresponding deletions from slave servers. You must delete maps and source files from slave servers by hand.</p></li>
<li><p>New maps do not automatically get pushed to existing slave servers. You must run <tt>ypxfr</tt> from the slaves.</p></li></ul>
<ol>
<li><a name="anis2-step-1002"></a><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-1?a=view">Chapter 9, Using Role-Based Access Control (Tasks), in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><a name="anis2-step-19"></a><b>Stop the NIS server.</b><pre># <tt><b>svcadm disable network/nis/server</b></tt></pre></li>
<li><a name="anis2-step-20"></a><b>Make the necessary changes to your files.</b></li>
<li><a name="anis2-step-21"></a><b>Start the NIS server.</b><pre># <tt><b>svcadm enable network/nis/server</b></tt></pre></li></ol>

<a name="anis2-20638"></a><h4>Modifying and Using the <tt>Makefile</tt></h4>
<a name="indexterm-365"></a><p>You can modify the <tt>Makefile</tt> provided by default in <tt>/var/yp</tt> to suit your
needs. You can add or delete maps, and you can change the names
of some of the directories.</p>
<hr><p><b>Tip - </b>Keep an unmodified copy of the original <tt>Makefile</tt> for future reference.</p>
<hr>


<a name="anis2-1013"></a><h5>Working With the <tt>Makefile</tt></h5>
<p>To add a new NIS map, you must get copies of the
<tt>ndbm</tt> files for the map into the <tt>/var/yp/</tt><i>domainname</i> directory on each of the NIS
servers in the domain. This is normally done for you by the <tt>Makefile</tt>.
After deciding which NIS server is the master of the map, modify the
<tt>Makefile</tt> on the master server so that you can conveniently rebuild the map.
Different servers can be masters of different maps, but in most cases this
leads to administrative confusion. Try to set only one server as the master
of all maps.</p><p><a name="indexterm-366"></a><a name="indexterm-367"></a>Typically a human-readable text file is filtered through <tt>awk</tt>, <tt>sed</tt>, or <tt>grep</tt> to make
it suitable for input to <tt>makedbm</tt>. Refer to the default <tt>Makefile</tt> for examples.
See the <a href="http://docs.sun.com/doc/819-2239/make-1s?a=view"><tt>make</tt>(1S)</a> for general information about the <tt>make</tt> command.</p><p><a name="indexterm-368"></a>Use the mechanisms already in place in the <tt>Makefile</tt> when deciding how to
create dependencies that <tt>make</tt> will recognize. Be aware that <tt>make</tt> is very sensitive to
the presence or absence of tabs at the beginning of lines within the
dependency rules. A missing tab can invalidate an entry that is otherwise well
formed.</p><p>Adding an entry to the <tt>Makefile</tt> involves the following.</p>
<ul><li><p>Adding the name of the database to the <tt>all</tt> rule</p></li>
<li><p>Writing the <tt>time</tt> rule</p></li>
<li><p>Adding the rule for the database</p></li></ul>
<p><a name="indexterm-369"></a><a name="indexterm-370"></a><a name="indexterm-371"></a>For example, in order for the <tt>Makefile</tt> to work on automounter input files, you
would have to add the <tt>auto_direct.time</tt> and <tt>auto_home.time</tt> maps to the NIS
database.</p><p>To add these maps to the NIS database you need to modify
the <tt>Makefile</tt>.</p>

<a name="anis2-33"></a><h5>Changing <tt>Makefile</tt> Macros/Variables</h5>
<a name="indexterm-372"></a><a name="indexterm-373"></a><p>You can change the settings of the variables defined at the top
of the <tt>Makefile</tt> by changing the value to the right of the
equal sign (=). For instance, if you do not want to use the
files located in <tt>/etc</tt> as input for the maps, but you would rather
use files located in another directory, such as <tt>/var/etc/domainname</tt>, you should change <tt>DIR</tt>
from <tt>DIR=/etc</tt> to <tt>DIR=/var/etc/</tt><i>domainname</i>. You should also change <tt>PWDIR</tt> from <tt>PWDIR=/etc</tt> to <tt>PWDIR=/var/etc/</tt><i>domainname</i>.</p><p>The variables are the following.</p>
<ul><li><p><a name="indexterm-374"></a><i>DIR</i>= The directory containing all of the NIS input files except <tt>passwd</tt> and <tt>shadow</tt>. The default value is <tt>/etc</tt>. Since it is not good practice to use the files in the master server's <tt>/etc</tt> directory as NIS input files, you should change this value.</p></li>
<li><p><a name="indexterm-375"></a><i>PWDIR</i>= The directory containing the <tt>passwd</tt> and <tt>shadow</tt> NIS input files. Since it is not good practice to use the files in the master server's <tt>/etc</tt> directory as NIS input files, you should change this value.</p></li>
<li><p><a name="indexterm-376"></a><i>DOM</i>= The NIS domain name. The default value of <tt>DOM</tt> is set using the <tt>domainname</tt> command. However, most NIS commands use the current machine's domain which is set in the machine's <tt>/etc/defaultdomain</tt> file.</p></li></ul>


<a name="anis2-1014"></a><h4>Modifying <tt>Makefile</tt> Entries</h4>
<p>The following procedure describes how to add and delete databases from the <tt>Makefile</tt>.</p>

<a name="anis2-proc-22"></a><h5>How to Modify the <tt>Makefile</tt> to Use Specific Databases</h5>
<ol>
<li><a name="anis2-step-9"></a><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-1?a=view">Chapter 9, Using Role-Based Access Control (Tasks), in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><a name="anis2-step-23"></a><b>Modify the line that starts with the word <tt>all</tt> by adding the
name(s) of the database you want to add:</b><pre>all: passwd group hosts ethers networks rpc services protocols \
    netgroup bootparams aliases netid netmasks \
    audit_user auth_attr exec_attr prof_attr \
  auto_direct auto_home auto_direct.time auto_home.time</pre><p>The order of the entries is not relevant, but the blank space
at the beginning of the continuation lines must be a Tab, not spaces.</p></li>
<li><a name="anis2-step-24"></a><b>Add the following lines at the end of the <tt>Makefile</tt>:</b><pre>auto_direct: auto_direct.time
auto_home: auto_home.time</pre></li>
<li><a name="anis2-step-25"></a><b>Add an entry for <tt>auto_direct.time</tt> in the middle of the file.</b><pre>auto_direct.time: $(DIR)/auto_direct
 @(while read L; do echo $$L; done &lt; $(DIR)/auto_direct
 $(CHKPIPE)) | \ (sed -e "/^#/d" -e "s/#.*$$//" -e "/^ *$$/d"
 $(CHKPIPE)) | \ $(MAKEDBM) - $(YPDBDIR)/$(DOM)/auto_direct;
 @touch auto_direct.time;
 @echo "updated auto_direct";
 @if [ ! $(NOPUSH) ]; then $(YPPUSH) auto_direct; fi
 @if [ ! $(NOPUSH) ]; then echo "pushed auto_direct"; fi</pre><p>where</p>
<ul><li><p><a name="indexterm-377"></a><a name="indexterm-378"></a><tt>CHKPIPE</tt> makes certain that the operations to the left of the pipe (<tt>|</tt>) are successfully completed before piping the results to next commands. If the operations to the left of the pipe do not successfully complete, the process is terminated with a <tt>NIS make terminated</tt> message.</p></li>
<li><p><a name="indexterm-379"></a><a name="indexterm-380"></a><a name="indexterm-381"></a><a name="indexterm-382"></a><tt>NOPUSH</tt> prevents the <tt>makefile</tt> from calling <tt>yppush</tt> to transfer the new map to the slave servers. If <tt>NOPUSH</tt> is not set, the push is done automatically.</p></li></ul>
<p><a name="indexterm-383"></a>The <tt>while</tt> loop at the beginning is designed to eliminate any backslash-extended lines
in the input file. The <tt>sed</tt> script eliminates comment and empty lines.</p><p>The same procedure should be followed for all other automounter maps, such as
<tt>auto_home</tt>, or any other nondefault maps.</p></li>
<li><a name="anis2-step-26"></a><b>Run <tt>make</tt>.</b><pre># <tt><b>make </tt><i>mapname</i><tt></b></tt></pre><p>Where <b>mapname</b> is the name of the map you want to make.</p></li></ol>

<a name="anis2-proc-28"></a><h5>How to Modify the <tt>Makefile</tt> to Delete Databases</h5>
<p>If you do not want the <tt>Makefile</tt> to produce maps for a specific
database, edit the <tt>Makefile</tt> as follows.</p><ol>
<li><a name="anis2-step-29"></a><b>Delete the name of the database from the <tt>all</tt> rule.</b></li>
<li><a name="anis2-step-30"></a><b>Delete or comment out the database rule for the database you want to
delete.</b><p><a name="indexterm-384"></a>For example, to delete the <tt>hosts</tt> database, the <tt>hosts.time</tt> entry should be removed.</p></li>
<li><a name="anis2-step-31"></a><b>Remove the time rule.</b><p>For example, to delete the <tt>hosts</tt> database, the <tt>hosts: hosts.time</tt> entry should be removed.</p></li>
<li><a name="anis2-step-32"></a><b>Remove the map from the master and slave servers.</b></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="anis2-38485.html">Previous</a>
             </td>
             <td align="right">
                 <a href="anis2-1010.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

