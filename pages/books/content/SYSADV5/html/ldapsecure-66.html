<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>LDAP Naming Services Security Model - System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2009-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ldapsecure-99.html">Previous</a>
             </td>
             <td align="right">
                 <a href="planldap-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="intro-1.html">Part&nbsp;I&nbsp;About Naming and Directory Services</a></p>
<p class="toc level2"><a href="intro2ns-2.html">1.&nbsp;&nbsp;Naming and Directory Services (Overview)</a></p>
<p class="toc level2"><a href="a12swit-86415.html">2.&nbsp;&nbsp;The Name Service Switch (Overview)</a></p>
<p class="toc level1 tocsp"><a href="dnsadmin-1.html">Part&nbsp;II&nbsp;DNS Setup and Administration</a></p>
<p class="toc level2"><a href="dnsref-1.html">3.&nbsp;&nbsp;DNS Setup and Administration (Reference)</a></p>
<p class="toc level1 tocsp"><a href="nissetup-1.html">Part&nbsp;III&nbsp;NIS Setup and Administration</a></p>
<p class="toc level2"><a href="anis1-25461.html">4.&nbsp;&nbsp;Network Information Service (NIS) (Overview)</a></p>
<p class="toc level2"><a href="cnis1-25208.html">5.&nbsp;&nbsp;Setting Up and Configuring NIS Service</a></p>
<p class="toc level2"><a href="anis2-22217.html">6.&nbsp;&nbsp;Administering NIS (Tasks)</a></p>
<p class="toc level2"><a href="abtrbl-18694.html">7.&nbsp;&nbsp;NIS Troubleshooting</a></p>
<p class="toc level1 tocsp"><a href="ldapsetup-1.html">Part&nbsp;IV&nbsp;LDAP Naming Services Setup and Administration</a></p>
<p class="toc level2"><a href="overview-1.html">8.&nbsp;&nbsp;Introduction to LDAP Naming Services (Overview/Reference)</a></p>
<p class="toc level2"><a href="ldapsecure-1.html">9.&nbsp;&nbsp;LDAP Basic Components and Concepts (Overview)</a></p>
<p class="toc level3"><a href="ldapsecure-104.html">LDAP Data Interchange Format (LDIF)</a></p>
<p class="toc level3"><a href="ldapsecure-2.html">Using Fully Qualified Domain Names With LDAP</a></p>
<p class="toc level3"><a href="ldapsecure-89.html">Default Directory Information Tree (DIT)</a></p>
<p class="toc level3"><a href="ldapsecure-88.html">Default LDAP Schema</a></p>
<p class="toc level3"><a href="ldapsecure-65.html">Service Search Descriptors (SSDs) and Schema Mapping</a></p>
<p class="toc level3"><a href="ldapsecure-103.html">LDAP Client Profiles</a></p>
<p class="toc level3"><a href="ldapsecure-99.html"><tt>ldap_cachemgr</tt> Daemon</a></p>
<div class="onpage">
<p class="toc level3"><a href="">LDAP Naming Services Security Model</a></p>
</div>
<p class="toc level2 tocsp"><a href="planldap-1.html">10.&nbsp;&nbsp;Planning Requirements for LDAP Naming Services (Tasks)</a></p>
<p class="toc level2"><a href="sundssetup-13.html">11.&nbsp;&nbsp;Setting Up Sun Java System Directory Server With LDAP Clients (Tasks)</a></p>
<p class="toc level2"><a href="clientsetup-1.html">12.&nbsp;&nbsp;Setting Up LDAP Clients (Tasks)</a></p>
<p class="toc level2"><a href="setupproblems-1.html">13.&nbsp;&nbsp;LDAP Troubleshooting (Reference)</a></p>
<p class="toc level2"><a href="schemas-1.html">14.&nbsp;&nbsp;LDAP General Reference (Reference)</a></p>
<p class="toc level2"><a href="nis2ldap-34.html">15.&nbsp;&nbsp;Transitioning From NIS to LDAP (Overview/Tasks)</a></p>
<p class="toc level2"><a href="nisplus2ldap-1.html">16.&nbsp;&nbsp;Transitioning From NIS+ to LDAP</a></p>
<p class="toc level1 tocsp"><a href="ghnmu.html">Part&nbsp;V&nbsp;Active Directory Naming Service</a></p>
<p class="toc level2"><a href="ghnov.html">17.&nbsp;&nbsp;Setting Up Solaris Active Directory Clients</a></p>
<p class="toc level1 tocsp"><a href="whatsnew-1.html">A.&nbsp;&nbsp;Solaris 10 Software Updates to DNS, NIS, and LDAP</a></p>
<p class="toc level2"><a href="whatsnew-5.html">Service Management Facility Changes</a></p>
<p class="toc level2"><a href="whatsnew-2.html">DNS BIND</a></p>
<p class="toc level2"><a href="schemas-290.html"><tt>pam_ldap</tt> Changes</a></p>
<p class="toc level2"><a href="whatsnew-3.html">Documentation Errors</a></p>
<p class="toc level1 tocsp"><a href="aagloss-87604.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="ldapsecure-66"></a><h3>LDAP Naming Services Security Model</h3>


<a name="ldapsecure-72"></a><h4>Introduction</h4>
<p>Solaris LDAP naming services can use the LDAP repository in two different ways.
One is as a source of both a naming service and an
authentication service. The other is strictly as the source of naming data, using
Kerberos as the enterprise-wide authentication system. This section discusses the concepts of client identity,
authentication methods, <a href="http://docs.sun.com/doc/819-2252/pam-ldap-5?a=view"><tt>pam_ldap</tt>(5)</a> and <tt>pam_unix</tt> modules, and account management when the LDAP repository
is used as both a naming service and authentication service.  This section
also discusses the use of LDAP naming services in conjunction with the Kerberos
environment (<a href="http://docs.sun.com/doc/819-3321/seamtm-1?a=view">Part&nbsp;VI, Kerberos Service, in <i>System Administration Guide: Security Services</i></a>) and <a href="http://docs.sun.com/doc/819-2252/pam-krb5-5?a=view"><tt>pam_krb5</tt>(5)</a> modules.</p>
<hr><p><b>Note - </b>Previously, if you enabled <tt>pam_ldap</tt> account management, all users needed to provide a
login password for authentication any time they logged in to the system. Therefore,
nonpassword-based logins using tools such as <tt>rsh</tt>, <tt>rlogin</tt>, or <tt>ssh</tt> would fail.</p><p>Now, however, <a href="http://docs.sun.com/doc/819-2252/pam-ldap-5?a=view"><tt>pam_ldap</tt>(5)</a>, when used with Sun Java System Directory Servers DS5.2p4 and
newer releases, enables users to log in with <tt>rsh</tt>, <tt>rlogin</tt>, <tt>rcp</tt> and
<tt>ssh</tt> without giving a password.</p><p><a href="http://docs.sun.com/doc/819-2252/pam-ldap-5?a=view"><tt>pam_ldap</tt>(5)</a> is now modified to do account management and retrieve the account status
of users without authenticating to Directory Server as the user logging in. The
new control to this on Directory Server is 1.3.6.1.4.1.42.2.27.9.5.8, which is enabled by
default.</p><p>To modify this control for other than default, add Access Control Instructions (ACI) on
Directory Server:</p><pre>dn: oid=1.3.6.1.4.1.42.2.27.9.5.8,cn=features,cn=config
objectClass: top
objectClass: directoryServerFeature
oid:1.3.6.1.4.1.42.2.27.9.5.8
cn:Password Policy Account Usable Request Control
aci: (targetattr != "aci")(version 3.0; acl "Account Usable"; 
     allow (read, search, compare, proxy)
     (groupdn = "ldap:///cn=Administrators,cn=config");)
creatorsName: cn=server,cn=plugins,cn=config
modifiersName: cn=server,cn=plugins,cn=config</pre>
<hr>

<hr><p><b>Note - </b>If you use Kerberos as your authentication system and integrate it with the
LDAP naming system, you will be able to support a single sign on
(SSO) environment in your enterprise through Kerberos. You will also be able to
use that same identity system when querying LDAP naming data on a per-user
or per-host basis.</p>
<hr>
<p><a name="indexterm-481"></a>To access the information in the LDAP repository, clients can first establish identity with
the directory server. This identity can be either anonymous or as an object
recognized by the LDAP server. Based on the client's identity and the server's
access control information (ACI), the LDAP server will allow the client to read
or write directory information. For more information on ACIs, consult the <i>Administration Guide</i> for
the version of Sun Java System Directory Server that you are using.</p><p>If the client is connecting as anything other than anonymous for any given
request, the client must prove its identity to the server using an
authentication method supported by both the client and the server. Once the client
has established its identity, it can then make the various LDAP requests.</p><p>When you use <tt>pam_ldap</tt> there is a distinction between how the naming service
and the authentication service (<tt>pam_ldap</tt>) access the directory. The naming service reads various
entries and their attributes from the directory based on predefined identity. The authentication
service establishes whether the user has entered the correct password by using that user's
name and password to authenticate to the LDAP server.  See the
<a href="http://docs.sun.com/doc/819-2252/pam-ldap-5?a=view"><tt>pam_ldap</tt>(5)</a> man page for more information about the authentication service.</p><p>When Kerberos is used to perform authentication, and when authentication in LDAP naming
services is also enabled (as is required for per-user mode), Kerberos can provide
dual functions. Kerberos authenticates to the server and the Kerberos identity for the
principal (user or host) is used to authenticate to the directory.  In
this way, the same user identity used to authenticate to the system is
also used to authenticate to the directory for lookups. Administrators can use access
control information (ACI) in the directory to limit the results out of the
naming service if desired.</p>

<a name="ldapsecure-73"></a><h4>Transport Layer Security (TLS)</h4>

<hr><p><b>Note - </b>In order to use TLS for Solaris LDAP naming services, the directory server
must use the default ports, 389 and 636, for LDAP and SSL,
respectively. If your directory server does not use these ports, you cannot use
TLS at this time.</p>
<hr>
<p><a name="indexterm-482"></a><a name="indexterm-483"></a>TLS can be used to secure communication between an LDAP client and the
directory server, providing both privacy and data integrity. The TLS protocol is a
superset of the Secure Sockets Layer (SSL) protocol. Solaris LDAP naming services support
TLS connections. Be aware that using SSL adds load to the directory server
and the client.</p><p>You will need to set up your directory server for SSL. For
more information about setting up Sun Java System Directory Server for SSL, see
the Administration Guide for the version of Sun Java System Directory Server that
you are using. You will also need to set up your LDAP client
for SSL.</p><p>If using TLS, the necessary security databases must be installed. In particular, the
certificate and key database files are needed. For example, if you adopt an
older database format from Netscape Communicator, two files, <tt>cert7.db</tt> and <tt>key3.db</tt>, are
required. Or if you use a new database format from Mozilla, three files,
<tt>cert8.db</tt>, <tt>key3.db</tt>, and <tt>secmod.db</tt> are needed. The <tt>cert7.db</tt> or <tt>cert8.db</tt>file contains trusted certificates.
The <tt>key3.db</tt>file contains the client's keys. Even if the LDAP naming service client
does not use client keys, this file must be present. The <tt>secmod.db</tt> file
contains the security modules such as the <tt>PKCS#11</tt> module. This file is not
required if the older format is used.</p><p>See <a href="clientsetup-49.html#clientsetup-57">Setting Up TLS Security</a> for more information.</p>

<a name="ldapsecure-74"></a><h4>Assigning Client Credential Levels</h4>
<p><a name="indexterm-484"></a>LDAP naming services  clients authenticate to the LDAP server according to a
client's credential level. LDAP clients can be assigned four possible credential levels with
which to authenticate to a directory server.</p>
<ul><li><p><tt>anonymous</tt></p></li>
<li><p><a name="indexterm-485"></a><tt>proxy</tt></p></li>
<li><p><a name="indexterm-486"></a><tt>proxy anonymous</tt></p></li>
<li><p><a name="indexterm-487"></a><a name="indexterm-488"></a><tt>self</tt> (called per user in this document)</p></li></ul>
<p><b>Anonymous</b></p><p>If you use <tt>anonymous</tt> access, you can access only the data that is
available to everyone. In anonymous mode, an LDAP BIND operation does not take
place. Also, you should consider the security implications. Allowing <tt>anonymous</tt> access for certain
parts of the directory implies that anyone with access to the directory has
read access. If you use an <tt>anonymous</tt> credential level, you need to allow
read access to all the LDAP naming entries and attributes.</p>
<hr><p><b>Caution - </b>Allowing <tt>anonymous</tt> write to a directory should never be done, as anyone could
change information in the DIT to which they have write access, including another
user's password, or their own identity. </p>
<hr>

<hr><p><b>Note - </b>Sun Java System Directory Server allows you to restrict access based on
IP addresses, DNS name, authentication method, and time-of-day. You might want to limit access
with further restrictions. For more information, see &ldquo;Managing Access Control&rdquo; in the <i>Administration Guide</i>
for the version of Sun Java System Directory Server that you are using.</p>
<hr>
<p><b>Proxy</b></p><p><a name="indexterm-489"></a>The client authenticates or binds to the directory using a single proxy account.
This proxy account can be any entry that is allowed to bind to
the directory. This proxy account needs sufficient access to perform the naming service
functions on the LDAP server.  The proxy account is a shared-per-machine resource.
 That is, each user logged into a machine using proxy access, including
the root user, sees the same results as all other users on that
machine. You need to configure the <tt>proxyDN</tt> and <tt>proxyPassword</tt> on every client using the
<tt>proxy</tt> credential level. The encrypted  <tt>proxyPassword</tt> is stored locally on the client.
You can set up different proxies for different groups of clients. For example,
you can configure a proxy for all the sales clients  to access
both the company-wide-accessible and sales directories, while preventing sales clients from accessing human resource
directories with payroll information. Or, in the most extreme cases, you can either
assign different proxies to each client or assign just one proxy to all
clients. A typical LDAP deployment would probably lie between the two extremes. Consider
the choices carefully. Too few proxy agents might limit your ability to control
user access to resources. However, having too many proxies complicates the setup and
maintenance of the system.  You need to grant the appropriate rights to
the proxy user, depending on your environment.  See <a href="#ldapsecure-93">Credential Storage</a> for information on how
to determine which authentication method makes the most sense for your configuration.</p><p>If the password changes for a proxy user, you need to update
it on every client that uses that proxy user. If you use password
aging on LDAP accounts, be sure to turn it off for proxy users.</p>
<hr><p><b>Note - </b>Be aware that the proxy credential level applies to all users and processes
on any given machine. If two users need to use different naming policies,
they must use different machines, or they must use the per-user authentication model.</p>
<hr>
<p>In addition, if clients are using a <tt>proxy</tt> credential to authenticate, the <tt>proxyDN</tt>
must have the same <tt>proxyPassword</tt> on all of the servers.</p><p><a name="indexterm-490"></a><b>Proxy anonymous</b></p><p><tt>Proxy anonymous</tt> is a multi-valued entry, in that more than one credential level is
defined. A client assigned the <tt>proxy anonymous</tt> level will first attempt to authenticate
with its proxy identity. If the client is unable to authenticate as the
proxy user for whatever reason (user lockout, password expired, for example), then the
client will use anonymous access. This might lead to a different level of
service, depending on how the directory is configured.</p><p><a name="indexterm-491"></a><b>Per User</b></p><p>Per-user (self) authentication uses the Kerberos identity (principal) to perform a lookup for
each user or each system when authenticating to the directory server. With per-user
authentication, the system administrator can use access control instructions (ACI's), access control lists
(ACL's), roles, groups or other directory access control mechanisms to grant or deny
access to specific naming service data for specific users or systems.  </p>
<hr><p><b>Note - </b>When configuring per-user mode, the configuration value to enable this mode is &ldquo;self,&rdquo;
which denotes per-user mode.</p>
<hr>
<p>To use the per-user authentication model, the Kerberos single sign-on service must be
deployed. In addition, the one or more directory servers used in the deployment
must support SASL and the SASL/GSSAPI authentication mechanism.  Because Kerberos expects to
use files and DNS for host name lookups, instead of LDAP, DNS should
be deployed in this environment.  Also, to use per-user authentication, nscd must
be enabled. Nscd is not an optional component in this configuration.</p>

<a name="ldapsecure-93"></a><h5>Credential Storage</h5>
<p><a name="indexterm-492"></a>If you configure a client to use a proxy identity, the client saves
its <tt>proxyDN</tt> and <tt>proxyPassword</tt> in <tt>/var/ldap/ldap_client_cred</tt>. For the sake of increased security, this
file is restricted to root access only, and the value of <tt>proxyPassword</tt>
is encrypted. While past LDAP implementations have stored proxy credentials in a client's
profile, Solaris 9 LDAP naming services do not. Any proxy credentials set using
<tt>ldapclient</tt> during initialization are stored locally. This results in improved security surrounding a
proxy's DN and password information. See <a href="clientsetup-1.html">Chapter&nbsp;12, Setting Up LDAP Clients (Tasks)</a> for more information on setting up client
profiles.</p><p>If you configure a client to use per-user authentication, the Kerberos identity and
Kerberos ticket information for each principal (each user or host) are used during
authentication.  In this environment the directory server maps the Kerberos principal to
a DN and the Kerberos credentials are used to authenticate to that DN.
The directory server can then use its access control instruction (ACI) mechanisms to
allow or deny access to naming service data as necessary. In this situation,
Kerberos ticket information is used to authenticate to the directory server and the
system does not store authentication DNs or passwords on the system.</p>

<a name="ldapsecure-75"></a><h4>Choosing Authentication Methods</h4>
<p>When you assign the <tt>proxy</tt> or <tt>proxy-anonymous</tt> credential level to a client, you
also need to select a method by which the proxy authenticates to the
directory server. By default, the authentication method is <tt>none</tt>, which implies anonymous access.
The authentication method may also have a transport security option associated with it.</p><p><a name="indexterm-493"></a>The authentication method, like the credential level, may be multivalued. For example, in
the client profile you could specify that the client first tries to bind
using the <tt>simple</tt> method secured by TLS. If unsuccessful, the client would try
to bind with the <tt>sasl/digest-MD5</tt> method. The <tt>authenticationMethod</tt> would then be <tt>tls:simple;sasl/digest-MD5</tt>.</p><p>LDAP naming services support some Simple Authentication and Security Layer (SASL) mechanisms. These
mechanisms allow for a secure password exchange without requiring TLS. However, these mechanisms
do not provide data integrity or privacy. See RFC 2222 for information on
SASL.</p><p>The following authentication mechanisms are supported.</p>
<ul><li><p><tt>none</tt></p><p>The client does not authenticate to the directory. This is equivalent to the <tt>anonymous</tt> credential level.</p></li>
<li><p><a name="indexterm-494"></a><tt>simple</tt></p><p><a name="indexterm-495"></a>If the client machine uses the <tt>simple</tt> authentication method, it binds to the server by sending the user's password in the clear. The password is thus subject to snooping unless the session is protected by <tt>ipsec</tt>(7). The primary advantages of using the <tt>simple</tt> authentication method are that all directory servers support it and that it is easy to set up.</p></li>
<li><p><a name="indexterm-496"></a><tt>sasl/digest-MD5</tt></p><p>The client's password is protected during authentication, but the session is not encrypted. Some directory servers, including Sun Java System Directory Server, also support the <tt>sasl/digest-MD5</tt> authentication method. The primary advantage of <tt>digest-MD5</tt> is that the password does not go over the wire in the clear during authentication and therefore is more secure than the <tt>simple</tt> authentication method. See RFC 2831 for information on <tt>digest-MD5</tt>. <tt>digest-MD5</tt> is considered an improvement over <tt>cram-MD5</tt> for its improved security.</p><p>When using <tt>sasl/digest-MD5</tt>, the authentication is secure, but the session is not protected.</p>
<hr><p><b>Note - </b>If you are using Sun Java System Directory Server, the password <b>must be stored in the clear</b> in the directory.</p>
<hr>
</li>
<li><p><tt>sasl/cram-MD5</tt></p><p>In this case, the LDAP session is not encrypted, but the client's password is protected during authentication, as authentication is performed by using <tt>sasl/cram-MD5</tt>.</p><p>See RFC 2195 for information on the <tt>cram-MD5</tt> authentication method. <tt>cram-MD5</tt> is only supported by some directory servers. For instance, Sun Java System Directory Server does not support <tt>cram-MD5</tt>.</p></li>
<li><p><tt>sasl/GSSAPI</tt></p><p>This authentication method is used in conjunction with the self credential mode to enable per-user lookups. A per-user nscd assigned to use the client's credentials binds to the directory server using the sasl/GSSAPI method and the client's Kerberos credentials. Access can be controlled in the directory server on a per-user basis.</p></li>
<li><p><tt>tls:simple</tt></p><p>The client binds using the <tt>simple</tt> method and the session is encrypted. The password is protected.</p></li>
<li><p><tt>tls:sasl/cram-MD5</tt></p><p>The LDAP session is encrypted and the client authenticates to the directory server using <tt>sasl/cram-MD5</tt>.</p></li>
<li><p><tt>tls:sasl/digest-MD5</tt></p><p>The LDAP session is encrypted and the client authenticates to the directory server using <tt>sasl/digest-MD5</tt>.</p></li></ul>

<hr><p><b>Caution - </b>Sun Java System Directory Server requires passwords to be stored in the
clear in order to use <tt>digest-MD5</tt>. If the authentication method is set to <tt>sasl/digest-MD5</tt>
or <tt>tls:sasl/digest-MD5</tt>, then the passwords for the proxy user will need to be
stored in the clear. Be especially careful that the <tt>userPassword</tt> attribute has the proper
ACIs if it is stored in the clear, so that it is
not readable.</p>
<hr>
<p>The following table summarizes the various authentication methods and their respective characteristics.</p><a name="ldapsecure-tbl-5"></a><h6>Table&nbsp;9-4 Authentication Methods</h6><table><col width="29%"><col width="12%"><col width="16%"><col width="15%"><col width="24%"><tr><th align="left" valign="top" scope="column"><p></p></th>
<th align="left" valign="top" scope="column"><p>Bind</p></th>
<th align="left" valign="top" scope="column"><p>Password on
wire</p></th>
<th align="left" valign="top" scope="column"><p>Password on Sun Java System Directory Server</p></th>
<th align="left" valign="top" scope="column"><p>Session</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>none</tt></p></td>
<td align="left" valign="top" scope="row"><p>No</p></td>
<td align="left" valign="top" scope="row"><p>N/A</p></td>
<td align="left" valign="top" scope="row"><p>N/A</p></td>
<td align="left" valign="top" scope="row"><p>No encryption</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>simple</tt></p></td>
<td align="left" valign="top" scope="row"><p>Yes</p></td>
<td align="left" valign="top" scope="row"><p>Clear</p></td>
<td align="left" valign="top" scope="row"><p>Any</p></td>
<td align="left" valign="top" scope="row"><p>No encryption</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>sasl/digest-MD5</tt></p></td>
<td align="left" valign="top" scope="row"><p>Yes</p></td>
<td align="left" valign="top" scope="row"><p>Encryption</p></td>
<td align="left" valign="top" scope="row"><p>Clear</p></td>
<td align="left" valign="top" scope="row"><p>No encryption</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>sasl/cram-MD5</tt></p></td>
<td align="left" valign="top" scope="row"><p>Yes</p></td>
<td align="left" valign="top" scope="row"><p>Encryption</p></td>
<td align="left" valign="top" scope="row"><p>N/A</p></td>
<td align="left" valign="top" scope="row"><p>No encryption</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>sasl/GSSAPI</tt></p></td>
<td align="left" valign="top" scope="row"><p>Yes</p></td>
<td align="left" valign="top" scope="row"><p>Kerberos</p></td>
<td align="left" valign="top" scope="row"><p>Kerberos</p></td>
<td align="left" valign="top" scope="row"><p>Encryption</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>tls:simple</tt></p></td>
<td align="left" valign="top" scope="row"><p>Yes</p></td>
<td align="left" valign="top" scope="row"><p>Encryption</p></td>
<td align="left" valign="top" scope="row"><p>Any</p></td>
<td align="left" valign="top" scope="row"><p>Encryption</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>tls:sasl/cram-MD5</tt></p></td>
<td align="left" valign="top" scope="row"><p>Yes</p></td>
<td align="left" valign="top" scope="row"><p>Encryption</p></td>
<td align="left" valign="top" scope="row"><p>N/A</p></td>
<td align="left" valign="top" scope="row"><p>Encryption</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>tls:sasl/digest-MD5</tt></p></td>
<td align="left" valign="top" scope="row"><p>Yes</p></td>
<td align="left" valign="top" scope="row"><p>Encryption</p></td>
<td align="left" valign="top" scope="row"><p>Clear</p></td>
<td align="left" valign="top" scope="row"><p>Encryption</p></td>
</tr>
</table>

<a name="ldapsecure-95"></a><h5>Authentication and Services</h5>
<p>The authentication method can be specified for a given service in the
<tt>serviceAuthenticationMethod</tt> attribute. The following services currently support this.</p>
<ul><li><p><tt>passwd-cmd</tt></p><p>This service is used by <a href="http://docs.sun.com/doc/819-2239/passwd-1?a=view"><tt>passwd</tt>(1)</a> to change the login password and password attributes.</p></li>
<li><p><tt>keyserv</tt></p><p>This service is used by the <a href="http://docs.sun.com/doc/819-2239/chkey-1?a=view"><tt>chkey</tt>(1)</a> and <a href="http://docs.sun.com/doc/819-2240/newkey-1m?a=view"><tt>newkey</tt>(1M)</a> utilities to create and change a user's Diffie-Hellman key pair.</p></li>
<li><p><tt>pam_ldap</tt></p><p>This service is used for authenticating users with <a href="http://docs.sun.com/doc/819-2252/pam-ldap-5?a=view"><tt>pam_ldap</tt>(5)</a>.</p><p><tt>pam_ldap</tt> supports account management.</p></li></ul>

<hr><p><b>Note - </b>If the service does not have a <tt>serviceAuthenticationMethod</tt> set, it will default to
the value of the <tt>authenticationMethod</tt> attribute. </p>
<hr>

<hr><p><b>Note - </b>In per-user mode, <a href="#geeix"><tt>pam_krb5</tt></a> (pam Kerberos) is used as the authentication service. <tt>ServiceAuthenticationMethod</tt>
is not needed in this mode of operation.</p>
<hr>
<p>The following example shows a section of a client profile in which
the users will use <tt>sasl/digest-MD5</tt> to authenticate to the directory server, but will use
an SSL session to change their password.</p><pre>serviceAuthenticationMethod=pam_ldap:sasl/digest-MD5
serviceAuthenticationMethod=passwd-cmd:tls:simple</pre>

<a name="ldapsecure-83"></a><h4>Pluggable Authentication Methods</h4>
<a name="indexterm-497"></a><a name="indexterm-498"></a><p>By using the PAM framework, you can choose among several authentication services, including
<tt>pam_unix</tt>, <tt>pam_krb5</tt>, and <tt>pam_ldap</tt>.</p><p>If the per-user authentication method is used, <tt>pam_krb5</tt>, the strongest authentication service of
the three methods listed above, must be enabled.  See <a href="http://docs.sun.com/doc/819-2252/pam-krb5-5?a=view"><tt>pam_krb5</tt>(5)</a> and the <a href="http://docs.sun.com/doc/819-3321"><i>System Administration Guide: Security Services</i></a>.</p><p>The pam_krb5 authentication system may be used even if per-user authentication is not
enabled.  If proxy or anonymous credential levels are used to access directory
server data then restricting access to directory data on a per-user basis is
not possible.</p><p>Because of its increased flexibility, support of stronger authentication methods, and ability to
use account management, the use of <tt>pam_ldap</tt> is recommended over the use of
<tt>pam_unix</tt> when anonymous or proxy authentication methods are used.</p>

<a name="ldapsecure-108"></a><h5><tt>pam_unix</tt></h5>
<p>If you have not changed the <a href="http://docs.sun.com/doc/819-2251/pam.conf-4?a=view"><tt>pam.conf</tt>(4)</a> file, <tt>pam_unix</tt> functionality is enabled by
default.</p>
<hr><p><b>Note - </b>The <tt>pam_unix</tt> module has been removed and is no longer supported with Solaris.
A set of other service modules provides equivalent or greater functionality. Therefore, in
this guide, <tt>pam_unix</tt> refers to the equivalent functionality, not to the <tt>pam_unix</tt> module itself.</p>
<hr>
<p>Following is a list of the modules that provide the equivalent <tt>pam_unix</tt>
functionality.</p><table><tr><td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2252/pam-authtok-check-5?a=view"><tt>pam_authtok_check</tt>(5)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2252/pam-authtok-get-5?a=view"><tt>pam_authtok_get</tt>(5)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2252/pam-authtok-store-5?a=view"><tt>pam_authtok_store</tt>(5)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2252/pam-dhkeys-5?a=view"><tt>pam_dhkeys</tt>(5)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2252/pam-passwd-auth-5?a=view"><tt>pam_passwd_auth</tt>(5)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2252/pam-unix-account-5?a=view"><tt>pam_unix_account</tt>(5)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2252/pam-unix-auth-5?a=view"><tt>pam_unix_auth</tt>(5)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2252/pam-unix-cred-5?a=view"><tt>pam_unix_cred</tt>(5)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2252/pam-unix-session-5?a=view"><tt>pam_unix_session</tt>(5)</a></p></td>
</tr>
</table><p><tt>pam_unix</tt> follows the traditional model of UNIX authentication, as described in the following
list.</p>
<ol><li><p>The client retrieves the user's encrypted password from the name service.</p></li>
<li><p>The user is prompted for his password.</p></li>
<li><p>The user's password is encrypted.</p></li>
<li><p>The client compares the two encrypted passwords to determine whether the user should be authenticated.</p></li></ol>
<p>Additionally, there are two restrictions when using <tt>pam_unix</tt>.</p>
<ul><li><p>The password must be stored in UNIX <tt>crypt</tt> format and not in any other encryption methods, including clear.</p></li>
<li><p>The <tt>userPassword</tt> attribute must be readable by the name service.</p><p>For example, if you set the credential level to <tt>anonymous</tt>, then anyone must be able to read the <tt>userPassword</tt> attribute. Similarly, If you set the credential level to <tt>proxy</tt>, then the proxy user must be able to read the <tt>userPassword</tt> attribute.</p></li></ul>

<hr><p><b>Note - </b><tt>pam_unix</tt> is not compatible with the <tt>sasl</tt> authentication method <tt>digest-MD5</tt>, since Sun Java
System Directory Server requires passwords to be stored in the clear in order
to use <tt>digest-MD5. pam_unix</tt> requires the password be stored in <tt>crypt</tt> format.</p>
<hr>


<a name="geeix"></a><h5><tt>pam_krb5</tt></h5>
<p>Refer to <a href="http://docs.sun.com/doc/819-2252/pam-krb5-5?a=view"><tt>pam_krb5</tt>(5)</a> and the <a href="http://docs.sun.com/doc/819-3321"><i>System Administration Guide: Security Services</i></a>.</p>

<a name="ldapsecure-107"></a><h5><tt>pam_ldap</tt></h5>
<p>When implementing <tt>pam_ldap</tt>, the user binds to the LDAP server by using the
authentication method defined in <tt>pam_ldap</tt>'s <tt>serviceAuthenticationMethod</tt> parameter, if one exists. Otherwise, <tt>authenticationMethod</tt>
is used.</p><p>If <tt>pam_ldap</tt> is able to bind to the server with the user's identity
and supplied password, it authenticates the user.</p>
<hr><p><b>Note - </b>Previously, if you enabled <tt>pam_ldap</tt> account management, all users needed to provide a
login password for authentication any time they logged in to the system. Therefore,
nonpassword-based logins using tools such as <tt>rsh</tt>, <tt>rlogin</tt>, or <tt>ssh</tt> would fail.</p><p>Now, however, <a href="http://docs.sun.com/doc/819-2252/pam-ldap-5?a=view"><tt>pam_ldap</tt>(5)</a>, when used with Sun Java System Directory Servers DS5.2p4 and
newer releases, enables users to log in with <tt>rsh</tt>, <tt>rlogin</tt>, <tt>rcp</tt> and
<tt>ssh</tt> without giving a password.</p><p><a href="http://docs.sun.com/doc/819-2252/pam-ldap-5?a=view"><tt>pam_ldap</tt>(5)</a> is now modified to do account management and retrieve the account status
of users without authenticating to Directory Server as the user logging in. The
new control to this on Directory Server is 1.3.6.1.4.1.42.2.27.9.5.8, which is enabled by
default.</p><p>To modify this control for other than default, add Access Control Instructions (ACI) on
Directory Server:</p><pre>dn: oid=1.3.6.1.4.1.42.2.27.9.5.8,cn=features,cn=config
objectClass: top
objectClass: directoryServerFeature
oid:1.3.6.1.4.1.42.2.27.9.5.8
cn:Password Policy Account Usable Request Control
aci: (targetattr != "aci")(version 3.0; acl "Account Usable"; 
     allow (read, search, compare, proxy)
     (groupdn = "ldap:///cn=Administrators,cn=config");)
creatorsName: cn=server,cn=plugins,cn=config
modifiersName: cn=server,cn=plugins,cn=config</pre>
<hr>
<p><tt>pam_ldap</tt> does not read the <tt>userPassword</tt> attribute. Therefore, there is no need to
grant access to read the <tt>userPassword</tt> attribute unless there are other clients using
<tt>pam_unix</tt>. Also, <tt>pam_ldap</tt> does not support the <tt>none</tt> authentication method. Thus, you must
define the <tt>serviceAuthenticationMethod</tt> or the <tt>authenticationMethod</tt> attributes so clients can use <tt>pam_ldap</tt>. See
the <a href="http://docs.sun.com/doc/819-2252/pam-ldap-5?a=view"><tt>pam_ldap</tt>(5)</a> man page for more information.</p>
<hr><p><b>Caution - </b>If the <tt>simple</tt> authentication method is used, the <tt>userPassword</tt> attribute can be read
on the wire by third parties.</p>
<hr>
<p>See <a href="schemas-111.html">Example <tt>pam.conf</tt> File for <tt>pam_ldap</tt></a>.</p><p>The following table summarizes the main differences between <tt>pam_unix</tt>, <tt>pam_ldap</tt>, and <tt>pam_krb5</tt>.</p><a name="ldapsecure-tbl-4"></a><h6>Table&nbsp;9-5 <tt>pam_unix</tt> versus <tt>pam_ldap</tt> versus <tt>pam_krb5</tt></h6><table><col width="25%"><col width="25%"><col width="25%"><col width="25%"><tr><th align="left" valign="top" scope="column"><p></p></th>
<th align="left" valign="top" scope="column"><p><tt>pam_unix</tt></p></th>
<th align="left" valign="top" scope="column"><p><tt>pam_ldap</tt></p></th>
<th align="left" valign="top" scope="column"><p><tt>pam_krb5</tt></p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Password
Sent </p></td>
<td align="left" valign="top" scope="row"><p>Uses <tt>passwd</tt> service authentication method </p></td>
<td align="left" valign="top" scope="row"><p>Uses <tt>passwd</tt> service authentication method</p></td>
<td align="left" valign="top" scope="row"><p>Uses Kerberos
single sign on technology, not passwords</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>New Password Sent</p></td>
<td align="left" valign="top" scope="row"><p>Encrypted</p></td>
<td align="left" valign="top" scope="row"><p>No encryption (unless TLS is
used)</p></td>
<td align="left" valign="top" scope="row"><p>Uses Kerberos, no passwords are sent over the wire</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>New Password Stored</p></td>
<td align="left" valign="top" scope="row"><p><tt>crypt</tt> format</p></td>
<td align="left" valign="top" scope="row"><p>Password
storage scheme defined on Sun Java System Directory Server</p></td>
<td align="left" valign="top" scope="row"><p>Passwords are managed via
Kerberos</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Requires password read?</p></td>
<td align="left" valign="top" scope="row"><p>Yes</p></td>
<td align="left" valign="top" scope="row"><p>No</p></td>
<td align="left" valign="top" scope="row"><p>No</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>sasl/digest-MD5</tt> compatibility after changing password</p></td>
<td align="left" valign="top" scope="row"><p>No. Password is not stored in
<tt>clear</tt>. User cannot authenticate. </p></td>
<td align="left" valign="top" scope="row"><p>Yes. As long as default storage scheme is set
to <tt>clear</tt>, user can authenticate. </p></td>
<td align="left" valign="top" scope="row"><p>No. sasl/GSSAPI is used. There are no passwords
over the wire and there are no passwords to be stored in the
directory server, except when using a Kerberos kdc that manages its password database
in the LDAP directory server.</p></td>
</tr>
</table>

<a name="ldapsecure-96"></a><h5>PAM and Changing Passwords</h5>
<p>Use <a href="http://docs.sun.com/doc/819-2239/passwd-1?a=view"><tt>passwd</tt>(1)</a> to change a password. In order to change the password, the
<tt>userPassword</tt> attribute must be writable by the user. Remember that the <tt>serviceAuthenticationMethod</tt> for
<tt>passwd-cmd</tt> overrides the <tt>authenticationMethod</tt> for this operation. Depending on the authentication used,
the current password might be unencrypted on the wire.</p><p>In the case of <tt>pam_unix</tt>, the new <tt>userPassword</tt> attribute is encrypted using UNIX
<tt>crypt</tt> format and tagged before being written to LDAP. Therefore, the new password
is encrypted on the wire, regardless of the authentication method used to bind
to the server. See the <a href="http://docs.sun.com/doc/819-2252/pam-authtok-store-5?a=view"><tt>pam_authtok_store</tt>(5)</a> man page for more information.</p><p>As of the Solaris 10 software release, <tt>pam_ldap</tt> no longer supports password update.
The previously recommended use of <tt>pam_authtok_store</tt> with the <tt>server_policy</tt> option now replaces
the <tt>pam_ldap</tt> password update capability. When you use <tt>pam_authtok_store</tt>, the new password
is sent to the LDAP server in the clear. Therefore, to ensure privacy,
use TLS. If TLS is not used, the new <tt>userPassword</tt> is subject to
snooping.  If you set an untagged password with Sun Java System
Directory Server, the software encrypts the password by using the <tt>passwordStorageScheme</tt> attribute. For more
information about the <tt>passwordStorageScheme</tt>, see the section on user account management in the
<i>Administration Guide</i> for the version of Sun Java System Directory Server that you are
using.</p>
<hr><p><b>Note - </b>You need to consider the following configuration issues when setting the <tt>passwordStorageScheme</tt> attribute.
If a NIS, NIS+, or another client using <tt>pam_unix</tt> is using LDAP as
a repository, then <tt>passwordStorageScheme</tt> needs to be <tt>crypt</tt>. Also, if using <tt>pam_ldap</tt> with <tt>sasl/digest-MD5</tt>
with Sun Java System Directory Server, <tt>passwordStorageScheme</tt> must be set to clear.</p>
<hr>


<a name="ldapsecure-76"></a><h4>Account Management</h4>
<p>If you select <tt>pam_krb5</tt> as your account and password management system, the Kerberos
environment will manage all your account, password, account lockout, and other account management
details. Refer to <a href="http://docs.sun.com/doc/819-2252/pam-krb5-5?a=view"><tt>pam_krb5</tt>(5)</a> and the <a href="http://docs.sun.com/doc/819-3321"><i>System Administration Guide: Security Services</i></a>.</p><p>If you do not use <tt>pam_krb5</tt>, then LDAP naming services can be configured
to take advantage of the password and account lockout policy support in Sun
Java System Directory Server. You can configure <a href="http://docs.sun.com/doc/819-2252/pam-ldap-5?a=view"><tt>pam_ldap</tt>(5)</a> to support user account
management. <a href="http://docs.sun.com/doc/819-2239/passwd-1?a=view"><tt>passwd</tt>(1)</a> enforces password syntax rules set by the Sun Java System Directory
Server password policy, when used with the proper PAM configuration.</p><p><a name="indexterm-499"></a><a name="indexterm-500"></a><a name="indexterm-501"></a>The following account management features are supported through <a href="http://docs.sun.com/doc/819-2252/pam-ldap-5?a=view"><tt>pam_ldap</tt>(5)</a>. These features depend on Sun
Java System Directory Server's password and account lockout policy configuration. You can enable
as many or as few of the features as you want.</p>
<ul><li><p>Password aging and expiration notification</p><p>Users must change their passwords according to a schedule. A password expires if it is not changed within the time configured. An expired password causes user authentication to fail.</p><p>Users see a warning message whenever they log in within the expiration warning period. The message specifies the number of hours or days until the password expires.</p></li>
<li><p>Password syntax checking</p><p>New passwords must meet the minimum password length requirements. In addition, a password cannot match the value of the <tt>uid</tt>, <tt>cn</tt>, <tt>sn</tt>, or <tt>mail</tt> attributes in the user's directory entry.</p></li>
<li><p>Password in history checking</p><p>Users cannot reuse passwords. If a user attempts to change the password to one that was previously used, <a href="http://docs.sun.com/doc/819-2239/passwd-1?a=view"><tt>passwd</tt>(1)</a> fails. LDAP administrators can configure the number of passwords kept in the server's history list.</p></li>
<li><p>User account lockout</p><p>A user account can be locked out after a given number of repeated authentication failures. A user can also be locked out if his account is inactivated by an administrator. Authentication will continue to fail until the account lockout time is passed or the administrator reactivates the account.</p></li></ul>

<hr><p><b>Note - </b>The preceding account management features only work with the Sun Java System
Directory Server.   For information about configuring the password and account lockout
policy on the server, see the &ldquo;User Account Management&rdquo; chapter in the Administration Guide
for the version of Sun Java System Directory Server that you are
using.   Also see <a href="schemas-250.html">Example <tt>pam_conf</tt> file for <tt>pam_ldap</tt> Configured for Account Management</a>. Do not enable account management for <tt>proxy</tt> accounts.</p>
<hr>
<p>Before configuring the password and account lockout policy on Sun Java System
Directory Server, make sure all hosts use the &ldquo;newest&rdquo; LDAP client with <tt>pam_ldap</tt>
account management.</p><p>In addition, make sure the clients have a properly configured <a href="http://docs.sun.com/doc/819-2251/pam.conf-4?a=view"><tt>pam.conf</tt>(4)</a> file.
Otherwise, LDAP naming services will not work when <tt>proxy</tt> or user passwords expire.</p>
<hr><p><b>Note - </b>Previously, if you enabled <tt>pam_ldap</tt> account management, all users needed to provide a
login password for authentication any time they logged in to the system. Therefore,
nonpassword-based logins using tools such as <tt>rsh</tt>, <tt>rlogin</tt>, or <tt>ssh</tt> would fail.</p><p>Now, however, <a href="http://docs.sun.com/doc/819-2252/pam-ldap-5?a=view"><tt>pam_ldap</tt>(5)</a>, when used with Sun Java System Directory Servers DS5.2p4 and
newer releases, enables users to log in with <tt>rsh</tt>, <tt>rlogin</tt>, <tt>rcp</tt> and
<tt>ssh</tt> without giving a password.</p><p><a href="http://docs.sun.com/doc/819-2252/pam-ldap-5?a=view"><tt>pam_ldap</tt>(5)</a> is now modified to do account management and retrieve the account status
of users without authenticating to Directory Server as the user logging in. The
new control to this on Directory Server is 1.3.6.1.4.1.42.2.27.9.5.8, which is enabled by
default.</p><p>To modify this control for other than default, add Access Control Instructions (ACI) on
Directory Server:</p><pre>dn: oid=1.3.6.1.4.1.42.2.27.9.5.8,cn=features,cn=config
objectClass: top
objectClass: directoryServerFeature
oid:1.3.6.1.4.1.42.2.27.9.5.8
cn:Password Policy Account Usable Request Control
aci: (targetattr != "aci")(version 3.0; acl "Account Usable"; 
     allow (read, search, compare, proxy)
     (groupdn = "ldap:///cn=Administrators,cn=config");)
creatorsName: cn=server,cn=plugins,cn=config
modifiersName: cn=server,cn=plugins,cn=config</pre>
<hr>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="ldapsecure-99.html">Previous</a>
             </td>
             <td align="right">
                 <a href="planldap-1.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

