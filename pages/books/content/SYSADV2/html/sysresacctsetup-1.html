<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Setting Up System Accounting - System Administration Guide: Advanced Administration</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-05-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Advanced Administration</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="enmzl.html">Previous</a>
             </td>
             <td align="right">
                 <a href="sysresacctsetup-30.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol2preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="modconcepts-20809.html">1.&nbsp;&nbsp;Managing Terminals and Modems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="modsetup-43877.html">2.&nbsp;&nbsp;Setting Up Terminals and Modems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="modsafapp-84569.html">3.&nbsp;&nbsp;Managing Serial Ports With the Service Access Facility (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="sysresconcepts-23051.html">4.&nbsp;&nbsp;Managing System Resources (Overview)</a></p>
<p class="toc level1 tocsp"><a href="sysressysinfo-75169.html">5.&nbsp;&nbsp;Displaying and Changing System Information (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="sysresdiskuse-61891.html">6.&nbsp;&nbsp;Managing Disk Use (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="sysresquotas-97946.html">7.&nbsp;&nbsp;Managing Quotas (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="sysrescron-18108.html">8.&nbsp;&nbsp;Scheduling System Tasks (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="sysresacctsetup-78801.html">9.&nbsp;&nbsp;Managing System Accounting (Tasks)</a></p>
<p class="toc level2"><a href="esxhm.html">What's New in System Accounting</a></p>
<p class="toc level2"><a href="sysresacctsetup-35.html">What is System Accounting?</a></p>
<p class="toc level2"><a href="enmzl.html">System Accounting (Task Map)</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Setting Up System Accounting</a></p>
<p class="toc level3"><a href="#sysresacctsetup-41702">How to Set Up System Accounting</a></p>
</div>
<p class="toc level2 tocsp"><a href="sysresacctsetup-30.html">Billing Users</a></p>
<p class="toc level3"><a href="sysresacctsetup-30.html#sysresacctsetup-12261">How to Bill Users</a></p>
<p class="toc level2 tocsp"><a href="sysresacctsetup-16.html">Maintaining Accounting Information</a></p>
<p class="toc level3"><a href="sysresacctsetup-16.html#sysresacctsetup-90762">How to Fix a Corrupted <tt>wtmpx</tt> File</a></p>
<p class="toc level3"><a href="sysresacctsetup-16.html#sysresacctsetup-22">How to Fix <tt>tacct</tt> Errors</a></p>
<p class="toc level3"><a href="sysresacctsetup-16.html#sysresacctsetup-92960">How to Restart the <tt>runacct</tt> Script</a></p>
<p class="toc level2 tocsp"><a href="sysresacctsetup-41704.html">Stopping and Disabling System Accounting</a></p>
<p class="toc level3"><a href="sysresacctsetup-41704.html#sysresacctsetup-41705">How to Temporarily Stop System Accounting</a></p>
<p class="toc level3"><a href="sysresacctsetup-41704.html#sysresacctsetup-41703">How to Permanently Disable System Accounting</a></p>
<p class="toc level1 tocsp"><a href="sysresacctref-14910.html">10.&nbsp;&nbsp;System Accounting (Reference)</a></p>
<p class="toc level1 tocsp"><a href="spconcepts-21354.html">11.&nbsp;&nbsp;Managing System Performance (Overview)</a></p>
<p class="toc level1 tocsp"><a href="spprocess-59633.html">12.&nbsp;&nbsp;Managing System Processes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="spmonitor-24844.html">13.&nbsp;&nbsp;Monitoring System Performance (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tsoverview-10750.html">14.&nbsp;&nbsp;Troubleshooting Software Problems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="eekee.html">15.&nbsp;&nbsp;Managing System Messages</a></p>
<p class="toc level1 tocsp"><a href="tscore-7.html">16.&nbsp;&nbsp;Managing Core Files (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tscrashdumps-40145.html">17.&nbsp;&nbsp;Managing System Crash Information (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tsgeneral-32935.html">18.&nbsp;&nbsp;Troubleshooting Miscellaneous Software Problems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tsfileaccess-28392.html">19.&nbsp;&nbsp;Troubleshooting File Access Problems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tsfsck-26279.html">20.&nbsp;&nbsp;Resolving UFS File System Inconsistencies (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tsswmgr-40462.html">21.&nbsp;&nbsp;Troubleshooting Software Package Problems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="sysresacctsetup-1"></a><h3>Setting Up System Accounting</h3>
<p>You can set up system accounting to run while the system is
in multiuser mode (Run Level 2). Generally, this task involves these steps:</p>
<ol><li><p>Creating the <tt>/etc/rc0.d/K22acct</tt> and <tt>/etc/rc2.d/S22acct</tt> startup scripts</p></li>
<li><p>Modifying the <tt>/var/spool/cron/crontabs/adm</tt> and <tt>/var/spool/cron/crontabs/root</tt> <tt>crontab</tt> files</p></li></ol>
<p><a name="sysresacctsetup-ix2676"></a><a name="sysresacctsetup-ix2677"></a><a name="sysresacctsetup-ix2678"></a><a name="sysresacctsetup-ix2679"></a>The following table describes the default accounting scripts.    </p><a name="sysresacctsetup-tbl-2"></a><h6>Table&nbsp;9-1 Default Accounting Scripts</h6><table><col width="109.00*"><col width="109*"><col width="109.00*"><col width="90*"><tr><th align="left" valign="top" scope="column"><p>Purpose</p></th>
<th align="left" valign="top" scope="column"><p>Accounting Script</p></th>
<th align="left" valign="top" scope="column"><p>Man
Page</p></th>
<th align="left" valign="top" scope="column"><p>Run Frequency</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Checks the size of the <tt>/usr/adm/pacct</tt> log file and makes sure that
it does not get too large.</p></td>
<td align="left" valign="top" scope="row"><p><tt>ckpacct</tt></p></td>
<td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2240/acctsh-1m?a=view"><tt>acctsh</tt>(1M)</a></p></td>
<td align="left" valign="top" scope="row"><p>Periodically</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Processes connect, disk, and fee accounting information.
You can remove from this script the commands for the accounting features you
do not want processed.</p></td>
<td align="left" valign="top" scope="row"><p><tt>runacct</tt></p></td>
<td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2240/runacct-1m?a=view"><tt>runacct</tt>(1M)</a></p></td>
<td align="left" valign="top" scope="row"><p>Daily</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Generates fiscal accounting summary reports on a monthly basis. You can
determine how often this script is run. You can remove from this
script the commands for the accounting features you do not want to use.</p></td>
<td align="left" valign="top" scope="row"><p><tt>monacct</tt></p></td>
<td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2240/acctsh-1m?a=view"><tt>acctsh</tt>(1M)</a></p></td>
<td align="left" valign="top" scope="row"><p>On
a fiscal basis</p></td>
</tr>
</table><p>You can choose which accounting scripts run by default. After these entries have
been added to the <tt>crontab</tt> files, system accounting should run automatically. </p>

<a name="sysresacctsetup-41702"></a><h4>How to Set Up System Accounting</h4><ol>
<li><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><a name="sysresacctsetup-step-5"></a><b><a name="sysresacctsetup-ix2681"></a>If necessary, install the <tt>SUNWaccr</tt> and <tt>SUNWaccu</tt> packages on your system by
using the <tt>pkgadd</tt> command.</b></li>
<li><a name="sysresacctsetup-step-6"></a><b><a name="sysresacctsetup-ix2682"></a>Install <tt>/etc/init.d/acct</tt> as the startup script for Run Level 2.  </b><pre># <tt><b>ln /etc/init.d/acct /etc/rc2.d/S22acct</b></tt></pre></li>
<li><a name="sysresacctsetup-step-7"></a><b>Install <tt>/etc/init.d/acct</tt> as the stop script for Run Level 0.</b><pre># <tt><b>ln /etc/init.d/acct /etc/rc0.d/K22acct</b></tt></pre></li>
<li><a name="sysresacctsetup-step-8"></a><b>Add the following lines to the <tt>adm</tt> <tt>crontab</tt> file to start the
<tt>ckpacct</tt>, <tt>runacct</tt>, and <tt>monacct</tt> scripts automatically.</b><pre># <tt><b>EDITOR=vi; export EDITOR</b></tt>
# <tt><b>crontab -e adm</b></tt>
0 * * * * /usr/lib/acct/ckpacct
30 2 * * * /usr/lib/acct/runacct 2> /var/adm/acct/nite/fd2log
30 7 1 * * /usr/lib/acct/monacct</pre></li>
<li><a name="sysresacctsetup-step-9"></a><b>Add the following line to the <tt>root</tt> <tt>crontab</tt> file to start the
<tt>dodisk</tt> script automatically.</b><pre># <tt><b>crontab -e</b></tt>
30 22 * * 4 /usr/lib/acct/dodisk</pre></li>
<li><a name="sysresacctsetup-step-10"></a><b><a name="sysresacctsetup-ix2688"></a>Edit <tt>/etc/acct/holidays</tt> to include national holidays and local holidays.</b><p>For more information, see the <a href="http://docs.sun.com/doc/819-2251/holidays-4?a=view"><tt>holidays</tt>(4)</a> man page and the example that follows.</p></li>
<li><a name="sysresacctsetup-step-29"></a><b><a name="indexterm-80"></a>Reboot the system, or start system accounting manually by typing:</b><pre># <tt><b>/etc/init.d/acct start</b></tt></pre></li></ol><a name="emjgh"></a>Example&nbsp;9-1 Setting Up Accounting (<tt>adm crontab</tt>)<p><a name="sysresacctsetup-ix2689"></a><a name="sysresacctsetup-ix2690"></a>This modified <tt>adm crontab</tt> contains entries for the <tt>ckpacct</tt>, <tt>runacct</tt>, and <tt>monacct</tt> scripts. </p><pre>#ident  "@(#)adm        1.5     92/07/14 SMI"    /* SVr4.0 1.2   */
#
# The adm crontab file should contain startup of performance 
# collection if the profiling and performance feature has been 
# installed.
0 * * * * /usr/lib/acct/ckpacct
30 2 * * * /usr/lib/acct/runacct 2> /var/adm/acct/nite/fd2log
30 7 1 * * /usr/lib/acct/monacct</pre><a name="enmzp"></a>Example&nbsp;9-2 Setting Up Accounting (<tt>root crontab</tt>)<p><a name="sysresacctsetup-ix2693"></a><a name="sysresacctsetup-ix2694"></a>This modified <tt>root crontab</tt> contains entries for the <tt>dodisk</tt> program.</p><pre>#ident  "@(#)root       1.19    98/07/06 SMI"   /* SVr4.0 1.1.3.1       */
#
# The root crontab should be used to perform accounting data collection.
#
#
10 3 * * * /usr/sbin/logadm
15 3 * * 0 /usr/lib/fs/nfs/nfsfind
30 3 * * * [ -x /usr/lib/gss/gsscred_clean ] &amp;&amp; /usr/lib/gss/gsscred_clean
30 22 * * 4 /usr/lib/acct/dodisk</pre><a name="enmzr"></a>Example&nbsp;9-3 Setting Up Accounting (<tt>/etc/acct/holidays</tt>)<p><a name="sysresacctsetup-ix2695"></a><a name="sysresacctsetup-ix2696"></a>The following example shows a sample <tt>/etc/acct/holidays</tt> file.  </p><pre>* @(#)holidays    January 1, 2004
*
* Prime/Nonprime Table for UNIX Accounting System
*
* Curr    Prime    Non-Prime
* Year    Start    Start
*
  2004    0800    1800
*
* only the first column (month/day) is significant.
*
* month/day    Company
*         Holiday
*
1/1        New Years Day
7/4        Indep. Day
12/25        Christmas</pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="enmzl.html">Previous</a>
             </td>
             <td align="right">
                 <a href="sysresacctsetup-30.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

