<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title><tt>runacct</tt> Script - System Administration Guide: Advanced Administration</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-05-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Advanced Administration</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="sysresacctref-14910.html">Previous</a>
             </td>
             <td align="right">
                 <a href="sysresacctref-15489.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol2preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="modconcepts-20809.html">1.&nbsp;&nbsp;Managing Terminals and Modems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="modsetup-43877.html">2.&nbsp;&nbsp;Setting Up Terminals and Modems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="modsafapp-84569.html">3.&nbsp;&nbsp;Managing Serial Ports With the Service Access Facility (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="sysresconcepts-23051.html">4.&nbsp;&nbsp;Managing System Resources (Overview)</a></p>
<p class="toc level1 tocsp"><a href="sysressysinfo-75169.html">5.&nbsp;&nbsp;Displaying and Changing System Information (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="sysresdiskuse-61891.html">6.&nbsp;&nbsp;Managing Disk Use (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="sysresquotas-97946.html">7.&nbsp;&nbsp;Managing Quotas (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="sysrescron-18108.html">8.&nbsp;&nbsp;Scheduling System Tasks (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="sysresacctsetup-78801.html">9.&nbsp;&nbsp;Managing System Accounting (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="sysresacctref-14910.html">10.&nbsp;&nbsp;System Accounting (Reference)</a></p>
<div class="onpage">
<p class="toc level2"><a href=""><tt>runacct</tt> Script</a></p>
</div>
<p class="toc level2"><a href="sysresacctref-15489.html">Daily Accounting Reports</a></p>
<p class="toc level2"><a href="sysresacctref-24103.html">System Accounting Files</a></p>
<p class="toc level1 tocsp"><a href="spconcepts-21354.html">11.&nbsp;&nbsp;Managing System Performance (Overview)</a></p>
<p class="toc level1 tocsp"><a href="spprocess-59633.html">12.&nbsp;&nbsp;Managing System Processes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="spmonitor-24844.html">13.&nbsp;&nbsp;Monitoring System Performance (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tsoverview-10750.html">14.&nbsp;&nbsp;Troubleshooting Software Problems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="eekee.html">15.&nbsp;&nbsp;Managing System Messages</a></p>
<p class="toc level1 tocsp"><a href="tscore-7.html">16.&nbsp;&nbsp;Managing Core Files (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tscrashdumps-40145.html">17.&nbsp;&nbsp;Managing System Crash Information (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tsgeneral-32935.html">18.&nbsp;&nbsp;Troubleshooting Miscellaneous Software Problems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tsfileaccess-28392.html">19.&nbsp;&nbsp;Troubleshooting File Access Problems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tsfsck-26279.html">20.&nbsp;&nbsp;Resolving UFS File System Inconsistencies (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tsswmgr-40462.html">21.&nbsp;&nbsp;Troubleshooting Software Package Problems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="sysresacctref-41757"></a><h3><tt>runacct</tt> Script</h3>
<p><a name="sysresacctref-ix3052"></a><a name="sysresacctref-ix3053"></a><a name="sysresacctref-ix3054"></a><a name="sysresacctref-ix3055"></a><a name="sysresacctref-ix3056"></a><a name="sysresacctref-ix3057"></a><a name="sysresacctref-ix3058"></a><a name="sysresacctref-ix3059"></a>The main daily accounting script, <tt>runacct</tt>, is normally invoked by the <tt>cron</tt> command outside
of normal business hours. The <tt>runacct</tt> script processes connect, fee, disk, and
process accounting files. This script also prepares daily and cumulative summary files for
use by the <tt>prdaily</tt> and <tt>monacct</tt> scripts for billing purposes.    
  </p><p><a name="sysresacctref-ix3060"></a><a name="sysresacctref-ix3062"></a><a name="sysresacctref-ix3063"></a><a name="sysresacctref-ix3064"></a><a name="sysresacctref-ix3065"></a><a name="sysresacctref-ix3066"></a><a name="sysresacctref-ix3067"></a><a name="sysresacctref-ix3068"></a>The <tt>runacct</tt> script takes care not to damage files if errors occur. </p><p>A series of protection mechanisms that are used to perform the following tasks:</p>
<ul><li><p>Recognize an error</p></li>
<li><p>Provide intelligent diagnostics</p></li>
<li><p>Complete processing in such a way that the <tt>runacct</tt> script can be restarted with minimal intervention</p></li></ul>
<p>This script records its progress by writing descriptive messages to the <tt>active</tt> file.
Files used by the <tt>runacct</tt> script are assumed to be in the <tt>/var/adm/acct/nite</tt>
directory, unless otherwise noted. All diagnostic output during the execution of the <tt>runacct</tt>
script is written to the <tt>fd2log</tt> file. </p><p><a name="sysresacctref-ix3069"></a><a name="sysresacctref-ix3070"></a><a name="sysresacctref-ix3071"></a><a name="sysresacctref-ix3072"></a><a name="sysresacctref-ix3073"></a><a name="sysresacctref-ix3074"></a><a name="sysresacctref-ix3075"></a><a name="sysresacctref-ix3076"></a><a name="sysresacctref-ix3078"></a>When the <tt>runacct</tt> script is invoked, it creates the <tt>lock</tt> and <tt>lock1</tt> files.
These files are used to prevent simultaneous execution of the <tt>runacct</tt> script. The <tt>runacct</tt>
program prints an error message if these files exist when it is invoked.
The <tt>lastdate</tt> file contains the month and day the <tt>runacct</tt> script was last
invoked, and is used to prevent more than one execution per day. </p><p>If the <tt>runacct</tt> script detects an error, the following occurs: </p>
<ul><li><p>A message is written to the console</p></li>
<li><p>Email is sent to <tt>root</tt> and <tt>adm</tt></p></li>
<li><p>Locks might be removed</p></li>
<li><p>Diagnostics are saved</p></li>
<li><p>Execution is ended</p></li></ul>
<p>For instructions on how to restart the <tt>runacct</tt> script, see <a href="sysresacctsetup-16.html#sysresacctsetup-92960">How to Restart the <tt>runacct</tt> Script</a>.</p><p><a name="sysresacctref-ix3079"></a><a name="sysresacctref-ix3080"></a><a name="sysresacctref-ix3081"></a><a name="sysresacctref-ix3082"></a><a name="sysresacctref-ix3167"></a><a name="sysresacctref-ix3168"></a><a name="sysresacctref-ix3085"></a><a name="sysresacctref-ix3088"></a><a name="sysresacctref-ix3089"></a><a name="sysresacctref-ix3090"></a><a name="sysresacctref-ix3091"></a><a name="sysresacctref-ix3092"></a><a name="sysresacctref-ix3093"></a><a name="sysresacctref-ix3094"></a><a name="sysresacctref-ix3095"></a><a name="sysresacctref-ix3096"></a><a name="sysresacctref-ix3097"></a><a name="sysresacctref-ix3098"></a><a name="sysresacctref-ix3103"></a><a name="sysresacctref-ix3109"></a><a name="sysresacctref-ix3110"></a><a name="sysresacctref-ix3111"></a><a name="sysresacctref-ix3112"></a><a name="sysresacctref-ix3113"></a><a name="sysresacctref-ix3114"></a><a name="sysresacctref-ix3116"></a><a name="sysresacctref-ix3117"></a><a name="sysresacctref-ix3119"></a><a name="sysresacctref-ix3124"></a><a name="sysresacctref-ix3125"></a><a name="sysresacctref-ix3100"></a><a name="sysresacctref-ix3101"></a><a name="sysresacctref-ix3120"></a><a name="sysresacctref-ix3121"></a><a name="sysresacctref-ix3132"></a><a name="sysresacctref-ix3133"></a><a name="sysresacctref-ix3134"></a><a name="sysresacctref-ix3136"></a><a name="sysresacctref-ix3137"></a><a name="sysresacctref-ix3138"></a><a name="sysresacctref-ix3142"></a><a name="sysresacctref-ix3145"></a><a name="sysresacctref-ix3146"></a><a name="sysresacctref-ix3147"></a><a name="sysresacctref-ix3129"></a><a name="sysresacctref-ix3130"></a><a name="sysresacctref-ix3149"></a><a name="sysresacctref-ix3152"></a><a name="sysresacctref-ix3153"></a><a name="sysresacctref-ix3154"></a><a name="sysresacctref-ix3155"></a><a name="sysresacctref-ix3156"></a><a name="sysresacctref-ix3157"></a><a name="sysresacctref-ix3158"></a><a name="sysresacctref-ix3159"></a><a name="sysresacctref-ix3160"></a>To allow the <tt>runacct</tt> script to be restarted, processing is broken down
into separate re-entrant states. The <tt>statefile</tt> file is used to track the last state
completed. When each state is completed, the <tt>statefile</tt> file is updated to reflect
the next state. After processing for the state is complete, the <tt>statefile</tt> file
is read and the next state is processed. When the <tt>runacct</tt> script reaches
the <tt>CLEANUP</tt> state, it removes the locks and ends. States are executed as
shown in the following table.        
           
           
           
       </p><a name="sysresacctref-24627"></a><h6>Table&nbsp;10-1 States of the <tt>runacct</tt> Script</h6><table><col width="87*"><col width="264*"><tr><th align="left" valign="top" scope="column"><p>State</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>SETUP</tt></p></td>
<td align="left" valign="top" scope="row"><p>The <tt>turnacct</tt> <tt>switch</tt> command is executed
to create a new <tt>pacct</tt> file. The <tt>/var/adm/pacct</tt><i>n</i> process accounting files (except
for the <tt>pacct</tt> file) are moved to the <tt>/var/adm/Spacct</tt><i>n.MMDD</i> files. The <tt>/var/adm/wtmpx</tt> file
is moved to the <tt>/var/adm/acct/nite/wtmp.</tt><i>MMDD</i> file (with the current time record added on the
end) and a new <tt>/var/adm/wtmp</tt> file is created. The <tt>closewtmp</tt> and <tt>utmp2wtmp</tt>
programs add records to the <tt>wtmp</tt>.<i>MMDD</i> file and the new <tt>wtmpx</tt> file
to account for users who are currently logged in. </p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>WTMPFIX</tt> </p></td>
<td align="left" valign="top" scope="row"><p>The <tt>wtmpfix</tt> program
checks the <tt>wtmp.</tt><i>MMDD</i> file in the <tt>nite</tt> directory for accuracy. Because some date
changes cause the <tt>acctcon</tt> program to fail, the <tt>wtmpfix</tt> program attempts to adjust
the time stamps in the <tt>wtmpx</tt> file if a record of a date
change appears. This program also deletes any corrupted entries from the <tt>wtmpx</tt> file. The
fixed version of the <tt>wtmp.</tt><i>MMDD</i> file is written to the <tt>tmpwtmp</tt> file. </p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>CONNECT</tt></p></td>
<td align="left" valign="top" scope="row"><p>The
<tt>acctcon</tt> program is used to record connect accounting records in the file <tt>ctacct.</tt><i>MMDD</i>. These
records are in <tt>tacct.h</tt> format. In addition, the <tt>acctcon</tt> program creates the
<tt>lineuse</tt> and <tt>reboots</tt> files. The <tt>reboots</tt> file records all the boot records found
in the <tt>wtmpx</tt> file. </p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>PROCESS</tt> </p></td>
<td align="left" valign="top" scope="row"><p>The <tt>acctprc</tt> program is used to convert
the <tt>/var/adm/Spacct</tt><i>n.MMDD</i> process accounting files into complete accounting records in the <tt>ptacct</tt><i>n.MMDD</i> files.
The <tt>Spacct</tt> and <tt>ptacct</tt> files are correlated by number so that if the
<tt>runacct</tt> script fails, the <tt>Spacct</tt> files are not processed. </p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>MERGE</tt></p></td>
<td align="left" valign="top" scope="row"><p>The <tt>acctmerg</tt> program merges
the process accounting records with the connect accounting records to form the <tt>daytacct</tt>
file.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>FEES</tt></p></td>
<td align="left" valign="top" scope="row"><p>The <tt>acctmerg</tt> program merges ASCII <tt>tacct</tt> records from the <tt>fee</tt> file into the
<tt>daytacct</tt> file. </p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>DISK</tt> </p></td>
<td align="left" valign="top" scope="row"><p>The <tt>dodisk</tt> script produces the <tt>disktacct</tt> file. If the <tt>dodisk</tt>
script has been run, which produces the <tt>disktacct</tt> file, the <tt>DISK</tt> program
merges the file into the <tt>daytacct</tt> file and moves the <tt>disktacct</tt> file to
the <tt>/tmp/disktacct.</tt><i>MMDD</i> file. </p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>MERGETACCT</tt></p></td>
<td align="left" valign="top" scope="row"><p>The <tt>acctmerg</tt> program merges the <tt>daytacct</tt> file with the <tt>sum/tacct</tt>
file, the cumulative total accounting file. Each day, the <tt>daytacct</tt> file is saved
in the <tt>sum/tacct.</tt><i>MMDD</i> file so that the <tt>sum/tacct</tt> file can be re-created
if it is corrupted or lost. </p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>CMS</tt></p></td>
<td align="left" valign="top" scope="row"><p>The <tt>acctcms</tt> program is run several
times. This program is first run to generate the command summary by using
the <tt>Spacct</tt><i>n</i> files and write the data to the <tt>sum/daycms</tt> file. The <tt>acctcms</tt>
program is then run to merge the <tt>sum/daycms</tt> file with the <tt>sum/cms</tt>
cumulative command summary file. Finally, the <tt>acctcms</tt> program is run to produce <tt>nite/daycms</tt>
and <tt>nite/cms</tt>, the ASCII command summary files from the <tt>sum/daycms</tt> and <tt>sum/cms</tt> files, respectively.
The <tt>lastlogin</tt> program is used to create the <tt>/var/adm/acct/sum/loginlog</tt> log file. This
file reports when each user last logged in. If the <tt>runacct</tt> script is
run after midnight, the dates showing the time last logged in by some
users will be incorrect by one day. </p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>USEREXIT</tt></p></td>
<td align="left" valign="top" scope="row"><p>Any installation-dependent (local) accounting program can
be run at this point. The <tt>runacct</tt> script expects this program to be called
the <tt>/usr/lib/acct/runacct.local</tt> program. </p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>CLEANUP</tt></p></td>
<td align="left" valign="top" scope="row"><p>This state cleans up temporary files, runs the <tt>prdaily</tt>
script and saves its output in the <tt>sum/rpt.</tt><i>MMDD</i> file, removes the locks, and then
exits. </p></td>
</tr>
</table>
<hr><p><b>Caution - </b><a name="sysresacctref-ix3172"></a><a name="sysresacctref-ix3174"></a><a name="sysresacctref-ix3175"></a>When restarting the <tt>runacct</tt> script in the <tt>CLEANUP</tt> state, remove the last <tt>ptacct</tt>
file because this file will not be complete. </p>
<hr>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="sysresacctref-14910.html">Previous</a>
             </td>
             <td align="right">
                 <a href="sysresacctref-15489.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

