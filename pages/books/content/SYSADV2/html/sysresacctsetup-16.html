<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Maintaining Accounting Information - System Administration Guide: Advanced Administration</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-05-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Advanced Administration</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="sysresacctsetup-30.html">Previous</a>
             </td>
             <td align="right">
                 <a href="sysresacctsetup-41704.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol2preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="modconcepts-20809.html">1.&nbsp;&nbsp;Managing Terminals and Modems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="modsetup-43877.html">2.&nbsp;&nbsp;Setting Up Terminals and Modems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="modsafapp-84569.html">3.&nbsp;&nbsp;Managing Serial Ports With the Service Access Facility (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="sysresconcepts-23051.html">4.&nbsp;&nbsp;Managing System Resources (Overview)</a></p>
<p class="toc level1 tocsp"><a href="sysressysinfo-75169.html">5.&nbsp;&nbsp;Displaying and Changing System Information (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="sysresdiskuse-61891.html">6.&nbsp;&nbsp;Managing Disk Use (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="sysresquotas-97946.html">7.&nbsp;&nbsp;Managing Quotas (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="sysrescron-18108.html">8.&nbsp;&nbsp;Scheduling System Tasks (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="sysresacctsetup-78801.html">9.&nbsp;&nbsp;Managing System Accounting (Tasks)</a></p>
<p class="toc level2"><a href="esxhm.html">What's New in System Accounting</a></p>
<p class="toc level2"><a href="sysresacctsetup-35.html">What is System Accounting?</a></p>
<p class="toc level2"><a href="enmzl.html">System Accounting (Task Map)</a></p>
<p class="toc level2"><a href="sysresacctsetup-1.html">Setting Up System Accounting</a></p>
<p class="toc level3"><a href="sysresacctsetup-1.html#sysresacctsetup-41702">How to Set Up System Accounting</a></p>
<p class="toc level2 tocsp"><a href="sysresacctsetup-30.html">Billing Users</a></p>
<p class="toc level3"><a href="sysresacctsetup-30.html#sysresacctsetup-12261">How to Bill Users</a></p>
<div class="onpage">
<p class="toc level2 tocsp"><a href="">Maintaining Accounting Information</a></p>
<p class="toc level3"><a href="#sysresacctsetup-90762">How to Fix a Corrupted <tt>wtmpx</tt> File</a></p>
<p class="toc level3"><a href="#sysresacctsetup-22">How to Fix <tt>tacct</tt> Errors</a></p>
<p class="toc level3"><a href="#sysresacctsetup-92960">How to Restart the <tt>runacct</tt> Script</a></p>
</div>
<p class="toc level2 tocsp"><a href="sysresacctsetup-41704.html">Stopping and Disabling System Accounting</a></p>
<p class="toc level3"><a href="sysresacctsetup-41704.html#sysresacctsetup-41705">How to Temporarily Stop System Accounting</a></p>
<p class="toc level3"><a href="sysresacctsetup-41704.html#sysresacctsetup-41703">How to Permanently Disable System Accounting</a></p>
<p class="toc level1 tocsp"><a href="sysresacctref-14910.html">10.&nbsp;&nbsp;System Accounting (Reference)</a></p>
<p class="toc level1 tocsp"><a href="spconcepts-21354.html">11.&nbsp;&nbsp;Managing System Performance (Overview)</a></p>
<p class="toc level1 tocsp"><a href="spprocess-59633.html">12.&nbsp;&nbsp;Managing System Processes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="spmonitor-24844.html">13.&nbsp;&nbsp;Monitoring System Performance (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tsoverview-10750.html">14.&nbsp;&nbsp;Troubleshooting Software Problems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="eekee.html">15.&nbsp;&nbsp;Managing System Messages</a></p>
<p class="toc level1 tocsp"><a href="tscore-7.html">16.&nbsp;&nbsp;Managing Core Files (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tscrashdumps-40145.html">17.&nbsp;&nbsp;Managing System Crash Information (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tsgeneral-32935.html">18.&nbsp;&nbsp;Troubleshooting Miscellaneous Software Problems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tsfileaccess-28392.html">19.&nbsp;&nbsp;Troubleshooting File Access Problems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tsfsck-26279.html">20.&nbsp;&nbsp;Resolving UFS File System Inconsistencies (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tsswmgr-40462.html">21.&nbsp;&nbsp;Troubleshooting Software Package Problems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="sysresacctsetup-16"></a><h3>Maintaining Accounting Information</h3>
<p>This section describes how to fix corrupted system accounting files and how to
restart the <tt>runacct</tt> script.</p>

<a name="sysresacctsetup-17"></a><h4>Fixing Corrupted Files and <tt>wtmpx</tt> Errors</h4>
<p><a name="sysresacctsetup-ix2715"></a><a name="sysresacctsetup-ix2716"></a><a name="sysresacctsetup-ix2717"></a><a name="sysresacctsetup-ix2718"></a>Unfortunately, system accounting is not foolproof. Occasionally, a file becomes corrupted or lost.
Some files can simply be ignored or restored from backup. However, certain files
must be fixed to maintain the integrity of system accounting. </p><p><a name="sysresacctsetup-ix2719"></a><a name="sysresacctsetup-ix2720"></a><a name="sysresacctsetup-ix2721"></a>The <tt>wtmpx</tt> files seem to cause the most problems in the daily operation
of system accounting. When the date is changed manually and the system is
in multiuser mode, a set of date change records is written to the
<tt>/var/adm/wtmpx</tt> file. The <tt>wtmpfix</tt> utility is designed to adjust the time stamps
in the <tt>wtmp</tt> records when a date change is encountered. However, some
combinations of date changes and reboots slip through the <tt>wtmpfix</tt> utility and cause the
<tt>acctcon</tt> program to fail.</p>

<a name="sysresacctsetup-90762"></a><h4>How to Fix a Corrupted <tt>wtmpx</tt> File</h4><a name="indexterm-82"></a><a name="indexterm-83"></a><a name="indexterm-84"></a><a name="indexterm-85"></a><a name="indexterm-86"></a><ol>
<li><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><a name="sysresacctsetup-step-18"></a><b>Change to the <tt>/var/adm</tt> directory.</b></li>
<li><a name="sysresacctsetup-step-19"></a><b>Convert the <tt>wtmpx</tt> file from binary format to ASCII format.</b><pre># <tt><b>/usr/lib/acct/fwtmp &lt; wtmpx > wtmpx.ascii</b></tt> </pre></li>
<li><a name="sysresacctsetup-step-20"></a><b>Edit the <tt>wtmpx.ascii</tt> file to delete the corrupted records.</b></li>
<li><a name="sysresacctsetup-step-21"></a><b><a name="sysresacctsetup-ix2731"></a><a name="sysresacctsetup-ix2732"></a><a name="sysresacctsetup-ix2733"></a><a name="sysresacctsetup-ix2736"></a>Convert the <tt>wtmpx.ascii</tt> file back to a binary file.   
</b><pre># <tt><b>/usr/lib/acct/fwtmp -ic &lt; wtmpx.ascii > wtmpx</b></tt></pre><p>See the <a href="http://docs.sun.com/doc/819-2240/fwtmp-1m?a=view"><tt>fwtmp</tt>(1M)</a> man page for more information.</p></li></ol>

<a name="sysresacctsetup-31"></a><h4>Fixing <tt>tacct</tt> Errors</h4>
<p>The integrity of the <tt>/var/adm/acct/sum/tacct</tt> file is important if you are charging users
for system resources. Occasionally, unusual <tt>tacct</tt> records appear with negative numbers, duplicate user IDs,
or a user ID of 65535. First, check the <tt>/var/adm/acct/sum/tacctprev</tt> file by
using the <tt>prtacct</tt> script to print the file. If the contents look all
right, patch the latest <tt>/var/adm/acct/sum/tacct</tt><i>MMDD</i> file. Then, re-create the <tt>/var/adm/acct/sum/tacct</tt> file. The
following steps outline a simple patch procedure.</p>

<a name="sysresacctsetup-22"></a><h4>How to Fix <tt>tacct</tt> Errors</h4><a name="sysresacctsetup-ix2737"></a><a name="sysresacctsetup-ix2738"></a><a name="sysresacctsetup-ix2739"></a><a name="sysresacctsetup-ix2740"></a><a name="sysresacctsetup-ix2741"></a><a name="sysresacctsetup-ix2742"></a><ol>
<li><b>Become superuser or assume an equivalent role.</b><p>Roles contain authorizations and privileged commands. For more information about roles, see <a href="http://docs.sun.com/doc/819-3321/rbactask-15?a=view">Configuring RBAC (Task Map) in <i>System Administration Guide: Security Services</i></a>.</p></li>
<li><a name="sysresacctsetup-step-23"></a><b>Change to the <tt>/var/adm/acct/sum</tt> directory.</b></li>
<li><a name="sysresacctsetup-step-24"></a><b>Convert the <tt>tacct</tt><i>MMDD</i> file from binary format to ASCII format.</b><pre># <tt><b>/usr/lib/acct/acctmerg -v &lt; tacct</b></tt><i>MMDD</i> <tt><b>> xtacct</b></tt></pre><p><i>MMDD</i> is pair of two-digit numbers that represent the month and day.</p></li>
<li><a name="sysresacctsetup-step-25"></a><b>Edit the <tt>xtacct</tt> file, removing corrupted records and writing duplicate records to another
file. </b></li>
<li><a name="sysresacctsetup-step-26"></a><b>Convert the <tt>xtacct</tt> file from ASCII format to binary format. </b><pre># <tt><b>/usr/lib/acct/acctmerg -i &lt; xtacct > tacct</b></tt><i>MMDD</i></pre></li>
<li><a name="sysresacctsetup-step-27"></a><b><a name="sysresacctsetup-ix2745"></a>Merge the files <tt>tacctprev</tt> and <tt>tacct.</tt><i>MMDD</i> into the <tt>tacct</tt> file. </b><pre># <tt><b>/usr/lib/acct/acctmerg &lt; tacctprev tacct</b></tt><i>MMDD</i> <tt><b>> tacct</b></tt></pre></li></ol>

<a name="sysresacctsetup-28"></a><h4>Restarting the <tt>runacct</tt> Script</h4>
<p><a name="sysresacctsetup-ix2753"></a><a name="sysresacctsetup-ix2754"></a><a name="sysresacctsetup-ix2755"></a><a name="sysresacctsetup-ix2756"></a><a name="sysresacctsetup-ix2757"></a><a name="sysresacctsetup-ix2758"></a><a name="sysresacctsetup-ix2759"></a><a name="sysresacctsetup-ix2760"></a><a name="sysresacctsetup-ix2761"></a><a name="sysresacctsetup-ix2762"></a>The <tt>runacct</tt> script can fail for several reasons. </p><p>The following are the most common reasons: </p>
<ul><li><p>A system crash</p></li>
<li><p>The <tt>/var</tt> directory is running out of space</p></li>
<li><p>A corrupted <tt>wtmpx</tt> file</p></li></ul>
<p>If the <tt>active</tt>.<i>MMDD</i> file exists, check it first for error messages. If the
<tt>active</tt> and <tt>lock</tt> files exist, check the <tt>fd2log</tt> file for any relevant messages.</p><p><a name="sysresacctsetup-ix2763"></a><a name="sysresacctsetup-ix2764"></a><a name="sysresacctsetup-ix2765"></a><a name="sysresacctsetup-ix2766"></a>Run without arguments, the <tt>runacct</tt> script assumes that this invocation is the first invocation
of the day. The argument <i>MMDD</i> is necessary if the <tt>runacct</tt> script is
being restarted and specifies the month and day for which the <tt>runacct</tt> script reruns
the accounting. The entry point for processing is based on the contents of
the <tt>statefile</tt> file. To override the <tt>statefile</tt> file, include the desired state on
the command line. For a description of the available states, see the <a href="http://docs.sun.com/doc/819-2240/runacct-1m?a=view"><tt>runacct</tt>(1M)</a>
man page.   </p>
<hr><p><b>Caution - </b>When you run the <tt>runacct</tt> program manually, be sure to run it as
user <tt>adm</tt>.</p>
<hr>


<a name="sysresacctsetup-92960"></a><h4>How to Restart the <tt>runacct</tt> Script</h4><a name="indexterm-87"></a><a name="indexterm-88"></a><ol>
<li><b>Change directories to the <tt>/var/adm/acct/nite</tt> directory.</b><pre>$ <tt><b>cd /var/adm/acct/nite</b></tt></pre></li>
<li><a name="sysresacctsetup-step-33"></a><b>Remove the <tt>lastdate</tt> file and any <tt>lock</tt>* files, if any.</b><pre>$ <tt><b>rm lastdate lock*</b></tt></pre><p>The <tt>lastdate</tt> file contains the date that the <tt>runacct</tt> program was last
run. Restarting the <tt>runacct</tt> script in the next step re-creates this file.</p></li>
<li><a name="sysresacctsetup-step-34"></a><b>Restart the <tt>runacct</tt> script.</b><pre>$ <tt><b>/usr/lib/acct/runacct</b></tt> <i>MMDD</i> [<i>state</i>] <tt><b>2> /var/adm/acct/nite/fd2log &amp;</b></tt></pre><dl><dt><i>MMDD</i></dt>
<dd><p>Is the month and day specified by two-digit numbers.</p></dd>
<dt><i>state</i></dt>
<dd><p><a name="sysresacctsetup-ix2767"></a><a name="sysresacctsetup-ix2768"></a><a name="sysresacctsetup-ix2769"></a>Specifies a state, or starting point, where the <tt>runacct</tt> script processing should begin. </p></dd>
</dl>
</li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="sysresacctsetup-30.html">Previous</a>
             </td>
             <td align="right">
                 <a href="sysresacctsetup-41704.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

