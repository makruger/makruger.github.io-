<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>What is System Accounting? - System Administration Guide: Advanced Administration</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-05-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Advanced Administration</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="esxhm.html">Previous</a>
             </td>
             <td align="right">
                 <a href="enmzl.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol2preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="modconcepts-20809.html">1.&nbsp;&nbsp;Managing Terminals and Modems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="modsetup-43877.html">2.&nbsp;&nbsp;Setting Up Terminals and Modems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="modsafapp-84569.html">3.&nbsp;&nbsp;Managing Serial Ports With the Service Access Facility (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="sysresconcepts-23051.html">4.&nbsp;&nbsp;Managing System Resources (Overview)</a></p>
<p class="toc level1 tocsp"><a href="sysressysinfo-75169.html">5.&nbsp;&nbsp;Displaying and Changing System Information (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="sysresdiskuse-61891.html">6.&nbsp;&nbsp;Managing Disk Use (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="sysresquotas-97946.html">7.&nbsp;&nbsp;Managing Quotas (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="sysrescron-18108.html">8.&nbsp;&nbsp;Scheduling System Tasks (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="sysresacctsetup-78801.html">9.&nbsp;&nbsp;Managing System Accounting (Tasks)</a></p>
<p class="toc level2"><a href="esxhm.html">What's New in System Accounting</a></p>
<div class="onpage">
<p class="toc level2"><a href="">What is System Accounting?</a></p>
</div>
<p class="toc level2"><a href="enmzl.html">System Accounting (Task Map)</a></p>
<p class="toc level2"><a href="sysresacctsetup-1.html">Setting Up System Accounting</a></p>
<p class="toc level3"><a href="sysresacctsetup-1.html#sysresacctsetup-41702">How to Set Up System Accounting</a></p>
<p class="toc level2 tocsp"><a href="sysresacctsetup-30.html">Billing Users</a></p>
<p class="toc level3"><a href="sysresacctsetup-30.html#sysresacctsetup-12261">How to Bill Users</a></p>
<p class="toc level2 tocsp"><a href="sysresacctsetup-16.html">Maintaining Accounting Information</a></p>
<p class="toc level3"><a href="sysresacctsetup-16.html#sysresacctsetup-90762">How to Fix a Corrupted <tt>wtmpx</tt> File</a></p>
<p class="toc level3"><a href="sysresacctsetup-16.html#sysresacctsetup-22">How to Fix <tt>tacct</tt> Errors</a></p>
<p class="toc level3"><a href="sysresacctsetup-16.html#sysresacctsetup-92960">How to Restart the <tt>runacct</tt> Script</a></p>
<p class="toc level2 tocsp"><a href="sysresacctsetup-41704.html">Stopping and Disabling System Accounting</a></p>
<p class="toc level3"><a href="sysresacctsetup-41704.html#sysresacctsetup-41705">How to Temporarily Stop System Accounting</a></p>
<p class="toc level3"><a href="sysresacctsetup-41704.html#sysresacctsetup-41703">How to Permanently Disable System Accounting</a></p>
<p class="toc level1 tocsp"><a href="sysresacctref-14910.html">10.&nbsp;&nbsp;System Accounting (Reference)</a></p>
<p class="toc level1 tocsp"><a href="spconcepts-21354.html">11.&nbsp;&nbsp;Managing System Performance (Overview)</a></p>
<p class="toc level1 tocsp"><a href="spprocess-59633.html">12.&nbsp;&nbsp;Managing System Processes (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="spmonitor-24844.html">13.&nbsp;&nbsp;Monitoring System Performance (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tsoverview-10750.html">14.&nbsp;&nbsp;Troubleshooting Software Problems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="eekee.html">15.&nbsp;&nbsp;Managing System Messages</a></p>
<p class="toc level1 tocsp"><a href="tscore-7.html">16.&nbsp;&nbsp;Managing Core Files (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tscrashdumps-40145.html">17.&nbsp;&nbsp;Managing System Crash Information (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tsgeneral-32935.html">18.&nbsp;&nbsp;Troubleshooting Miscellaneous Software Problems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tsfileaccess-28392.html">19.&nbsp;&nbsp;Troubleshooting File Access Problems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tsfsck-26279.html">20.&nbsp;&nbsp;Resolving UFS File System Inconsistencies (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="tsswmgr-40462.html">21.&nbsp;&nbsp;Troubleshooting Software Package Problems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="sysresacctsetup-35"></a><h3>What is System Accounting?</h3>
<p>System accounting software in the Solaris OS is a set of programs
that enables you to collect and record data about user connect time, CPU
time charged to processes, and disk usage. Once you collect this data, you
can generate reports and charge fees for system usage.</p><p>You can use system accounting on a daily or monthly basis. Or,
you can tack disk usage per user.</p><p><a name="sysresacctsetup-ix2674"></a><a name="sysresacctsetup-ix2675"></a>You can use the accounting programs to perform these tasks:</p>
<ul><li><p>Monitor system usage</p></li>
<li><p>Locate and correct performance problems</p></li>
<li><p>Maintain system security</p></li></ul>
<p>After you set up the system accounting programs, they run mostly on their
own.</p>

<a name="sysresacctsetup-24"></a><h4>How System Accounting Works</h4>
<p>Automatic accounting is set up by first putting the accounting startup script into
root's <tt>crontab</tt> file. The accounting startup script can then be started automatically by
the <tt>cron</tt> command.</p><p>The following overview describes the system accounting process.</p>
<ol><li><p>Between system startup and shutdown, raw data about system use (such as user logins, running processes, and data storage) are collected in accounting files.</p></li>
<li><p>Periodically (usually once a day), the <tt>/usr/lib/acct/runacct</tt> script processes the various accounting files and produces both cumulative summary files and daily accounting reports. Then, the <tt>/usr/lib/acct/prdaily</tt> script prints the daily reports.</p><p>For more information about the <tt>runacct</tt> script, see <a href="sysresacctref-41757.html"><tt>runacct</tt> Script</a>.</p></li>
<li><p>Monthly, you can process and print the cumulative <tt>runacct</tt> summary files by executing the <tt>monacct</tt> script. The summary reports produced by the <tt>monacct</tt> script provide an efficient means for billing users on a monthly or other fiscal basis.</p></li></ol>


<a name="sysresacctsetup-2"></a><h4>System Accounting Components</h4>
<p>The system accounting software provides C language programs and shell scripts that organize
data into summary files and reports. These programs reside in the <tt>/usr/lib/acct</tt> directory.
The accounting reports reside in the <tt>/var/adm/acct</tt> directory.</p><p>Daily accounting can help you perform four types of auditing:</p>
<ul><li><p>Connect accounting</p></li>
<li><p>Process accounting</p></li>
<li><p>Disk accounting</p></li>
<li><p>Fee calculations</p></li></ul>


<a name="sysresacctsetup-42"></a><h5>Connect Accounting</h5>
<p><a name="sysresacctref-ix2773"></a><a name="sysresacctref-ix2774"></a><a name="sysresacctref-ix2775"></a><a name="sysresacctref-ix2776"></a><a name="sysresacctref-ix2777"></a><a name="sysresacctref-ix2778"></a><a name="sysresacctref-ix2779"></a><a name="sysresacctref-ix2780"></a>Connect accounting enables you to determine the following information:</p>
<ul><li><p>The length of time a user was logged in</p></li>
<li><p>How the <tt>tty</tt> lines are being used</p></li>
<li><p>The number of reboots on your system</p></li>
<li><p>How many times the accounting software was turned off and on</p></li></ul>
<p>To provide this information on connect sessions, the system stores the following data</p>
<ul><li><p>Record of time adjustments</p></li>
<li><p>Boot times</p></li>
<li><p>Number of times the accounting software was turned off and on</p></li>
<li><p>Changes in run levels</p></li>
<li><p>The creation of user processes (<tt>login</tt> processes and <tt>init</tt> processes)</p></li>
<li><p>The terminations of processes</p></li></ul>
<p><a name="sysresacctref-ix2784"></a><a name="sysresacctref-ix2785"></a><a name="sysresacctref-ix2788"></a><a name="sysresacctref-ix2789"></a><a name="sysresacctref-ix2790"></a><a name="sysresacctref-ix2793"></a><a name="sysresacctref-ix2794"></a>These records are produced from the output of system programs such as <tt>date</tt>,
<tt>init</tt>, <tt>login</tt>, <tt>ttymon</tt>, and <tt>acctwtmp</tt>. They are stored in the <tt>/var/adm/wtmpx</tt> file. </p><p>Entries in the <tt>wtmpx</tt> file can contain the following information: </p>
<ul><li><p>Login name</p></li>
<li><p>Device name</p></li>
<li><p>Process ID</p></li>
<li><p>Entry type</p></li>
<li><p>Time stamp that denotes when the entry was made</p></li></ul>


<a name="sysresacctsetup-18"></a><h5>Process Accounting</h5>
<p><a name="sysresacctref-ix2796"></a><a name="sysresacctref-ix2797"></a><a name="sysresacctref-ix2798"></a>Process accounting enables you to keep track of the following data about each
process that runs on your system:</p>
<ul><li><p>User IDs and group IDs of users using the process</p></li>
<li><p>Beginning times and elapsed times of the process</p></li>
<li><p>CPU time for the process (user time and system time)</p></li>
<li><p>Amount of memory used by the process</p></li>
<li><p>Commands run by the process</p></li>
<li><p>The <tt>tty</tt> that controls the process </p></li></ul>
<p>Every time a process terminates, the <tt>exit</tt> program collects this information and writes
it to the <tt>/var/adm/pacct</tt> file. </p>

<a name="sysresacctsetup-15"></a><h5>Disk Accounting</h5>
<p><a name="sysresacctref-ix2800"></a><a name="sysresacctref-ix2801"></a><a name="sysresacctref-ix2802"></a><a name="sysresacctref-ix2803"></a><a name="sysresacctref-ix2804"></a>Disk accounting enables you to gather and format the following data about the
files each user has on disks:</p>
<ul><li><p>User name and user ID of the user</p></li>
<li><p>Number of blocks that are used by the user's files</p></li></ul>
<p><a name="sysresacctref-ix2805"></a><a name="sysresacctref-ix2806"></a><a name="sysresacctref-ix2811"></a><a name="sysresacctref-ix2814"></a>This data is collected by the <tt>/usr/lib/acct/dodisk</tt> shell script at intervals that are determined
by the entry you add to the <tt>/var/spool/cron/crontabs/root</tt> file. In turn, the
<tt>dodisk</tt> script invokes the <tt>acctdisk</tt> and <tt>acctdusg</tt> commands. These commands gather disk usage
by login name.</p>
<hr><p><b>Caution - </b><a name="sysresacctref-ix2816"></a><a name="sysresacctref-ix2817"></a><a name="sysresacctref-ix2818"></a><a name="sysresacctref-ix2819"></a>Information gathered by running the <tt>dodisk</tt> script is stored in the <tt>/var/adm/acct/nite/disktacct</tt> file.
This information is overwritten the next time the <tt>dodisk</tt> script is run. Therefore,
avoid running the <tt>dodisk</tt> script twice in the same day.</p>
<hr>
<p><a name="enmzm"></a><a name="enmzn"></a><a name="enmzq"></a>The <tt>acctdusg</tt> command might overcharge for files that are written randomly, which can
create holes in the files. This problem occurs because the <tt>acctdusg</tt> command does not
read the indirect blocks of a file when determining the file size. Rather,
the <tt>acctdusg</tt> command determines the file size by checking the current file size
value in the file's inode.</p>

<a name="sysresacctsetup-10"></a><h5>Fee Calculations</h5>
<p><a name="indexterm-72"></a><a name="indexterm-73"></a><a name="indexterm-74"></a><a name="indexterm-75"></a><a name="indexterm-76"></a>The <tt>chargefee</tt> utility stores charges for special services that are provided to a
user in the <tt>/var/adm/fee</tt> file. A special service, for example, is file
restoration. Each entry in the file consists of a user login name, user
ID, and the fee. This file is checked by the <tt>runacct</tt> script every
day, and new entries are merged into the accounting records. For instructions on
running the <tt>chargefee</tt> script to bill users, see <a href="sysresacctsetup-30.html#sysresacctsetup-12261">How to Bill Users</a>.</p>

<a name="sysresacctsetup-58"></a><h5>How Daily Accounting Works</h5>
<p><a name="sysresacctref-ix2838"></a><a name="sysresacctref-ix2839"></a><a name="sysresacctref-ix2841"></a>Here is a step-by-step summary of how daily accounting works: </p>
<ol><li><p><a name="sysresacctref-ix2843"></a>When the system is switched into multiuser mode, the <tt>/usr/lib/acct/startup</tt> program is executed. The <tt>startup</tt> program executes several other programs that invoke daily accounting. </p></li>
<li><p><a name="sysresacctref-ix2844"></a><a name="sysresacctref-ix2845"></a>The <tt>acctwtmp</tt> program adds a &ldquo;boot&rdquo; record to the <tt>/var/adm/wtmpx</tt> file. In this record, the system name is shown as the user name in the <tt>wtmpx</tt> record. The following table summarizes how the raw accounting data is gathered and where it is stored. </p><table><col width="108*"><col width="90*"><col width="87*"><col width="72*"><tr><th align="left" valign="top" scope="column"><p>File in <tt>/var/adm</tt></p></th>
<th align="left" valign="top" scope="column"><p>Information Stored</p></th>
<th align="left" valign="top" scope="column"><p>Written By</p></th>
<th align="left" valign="top" scope="column"><p>Format</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="sysresacctref-ix2846"></a><tt>wtmpx</tt> </p></td>
<td align="left" valign="top" scope="row"><p>Connect sessions </p></td>
<td align="left" valign="top" scope="row"><p><tt>login</tt>, <tt>init</tt></p></td>
<td align="left" valign="top" scope="row"><p>Binary</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p></p></td>
<td align="left" valign="top" scope="row"><p><a name="sysresacctref-ix2851"></a>Changes </p></td>
<td align="left" valign="top" scope="row"><p><tt>date</tt></p></td>
<td align="left" valign="top" scope="row"><p>Binary</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p></p></td>
<td align="left" valign="top" scope="row"><p><a name="sysresacctref-ix2852"></a><a name="sysresacctref-ix2853"></a>Reboots </p></td>
<td align="left" valign="top" scope="row"><p><tt>acctwtmp</tt></p></td>
<td align="left" valign="top" scope="row"><p>Binary</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p></p></td>
<td align="left" valign="top" scope="row"><p><a name="sysresacctref-ix2854"></a><a name="sysresacctref-ix2855"></a>Shutdowns  </p></td>
<td align="left" valign="top" scope="row"><p><tt>shutacct</tt></p></td>
<td align="left" valign="top" scope="row"><p>Binary</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="sysresacctref-ix2856"></a><a name="sysresacctref-ix2857"></a><a name="sysresacctref-ix2858"></a><a name="sysresacctref-ix2859"></a><tt>pacctn</tt> </p></td>
<td align="left" valign="top" scope="row"><p>Processes</p></td>
<td align="left" valign="top" scope="row"><p>Kernel (when the process ends) </p></td>
<td align="left" valign="top" scope="row"><p>Binary</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p></p></td>
<td align="left" valign="top" scope="row"><p></p></td>
<td align="left" valign="top" scope="row"><p><a name="sysresacctref-ix2860"></a><tt>turnacct switch</tt> (which creates a new file when the old file reaches 500 blocks) </p></td>
<td align="left" valign="top" scope="row"><p>Binary</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="sysresacctref-ix2861"></a><a name="sysresacctref-ix2862"></a><a name="sysresacctref-ix2863"></a><a name="sysresacctref-ix2864"></a><a name="sysresacctref-ix2865"></a><tt>fee</tt> </p></td>
<td align="left" valign="top" scope="row"><p>Special charges</p></td>
<td align="left" valign="top" scope="row"><p><tt>chargefee</tt></p></td>
<td align="left" valign="top" scope="row"><p>ASCII</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><a name="sysresacctref-ix2869"></a><a name="sysresacctref-ix2871"></a><a name="sysresacctref-ix2872"></a><a name="sysresacctref-ix2873"></a><a name="sysresacctref-ix2874"></a><tt>acct/nite/disktacct</tt></p></td>
<td align="left" valign="top" scope="row"><p>Disk space used</p></td>
<td align="left" valign="top" scope="row"><p><tt>dodisk</tt></p></td>
<td align="left" valign="top" scope="row"><p>Binary</p></td>
</tr>
</table></li>
<li><p>The <tt>turnacct</tt> script, invoked with the <tt>-on</tt> option, begins process accounting. Specifically, the <tt>turnacct</tt> script executes the <tt>accton</tt> program with the <tt>/var/adm/pacct</tt> argument.</p></li>
<li><p>The remove shell script &ldquo;cleans up&rdquo; the saved <tt>pacct</tt> and <tt>wtmpx</tt> files that are left in the <tt>sum</tt> directory by the <tt>runacct</tt> script.</p></li>
<li><p><a name="sysresacctref-ix2875"></a>The <tt>login</tt> and <tt>init</tt> programs record connect sessions by writing records into the <tt>/var/adm/wtmpx</tt> file. Date changes (using date with an argument) are also written to the <tt>/var/adm/wtmpx</tt> file. Reboots and shutdowns using the <tt>acctwtmp</tt> command are also recorded in the <tt>/var/adm/wtmpx</tt> file.</p></li>
<li><p>When a process ends, the kernel writes one record per process, using the <tt>acct.h</tt> format, in the <tt>/var/adm/pacct</tt> file.</p><p><a name="sysresacctref-ix2876"></a><a name="sysresacctref-ix2877"></a><a name="sysresacctref-ix2878"></a>Every hour, the <tt>cron</tt> command executes the <tt>ckpacct</tt> script to check the size of the <tt>/var/adm/pacct</tt> file. If the file grows beyond 500 blocks (default), the <tt>turnacct switch</tt> command is executed. (The program moves the <tt>pacct</tt> file to the <tt>pacct</tt><i>n</i> file and creates a new file.) The advantage of having several smaller <tt>pacct</tt> files becomes apparent when you try to restart the <tt>runacct</tt> script if a failure occurs when processing these records.</p></li>
<li><p><a name="sysresacctref-ix2879"></a><a name="sysresacctref-ix2880"></a>The <tt>runacct</tt> script is executed by the <tt>cron</tt> command each night. The <tt>runacct</tt> script processes the accounting files to produce command summaries and usage summaries by user name. These accounting files are processed: <tt>/var/adm/pacct</tt><i>n</i>, <tt>/var/adm/wtmpx</tt>, <tt>/var/adm/fee</tt>, and <tt>/var/adm/acct/nite/disktacct</tt>.</p></li>
<li><p><a name="sysresacctref-ix2881"></a><a name="sysresacctref-ix2882"></a><a name="sysresacctref-ix2883"></a>The <tt>/usr/lib/acct/prdaily</tt> script is executed on a daily basis by the <tt>runacct</tt> script to write the daily accounting information in the <tt>/var/adm/acct/sum/rprt</tt><i>MMDD</i> files. </p></li>
<li><p><a name="sysresacctref-ix2884"></a>The <tt>monacct</tt> script should be executed on a monthly basis (or at intervals you determine, such as at the end of every fiscal period). The <tt>monacct</tt> script creates a report that is based on data stored in the <tt>sum</tt> directory that has been updated daily by the <tt>runacct</tt> script. After creating the report, the <tt>monacct</tt> script &ldquo;cleans up&rdquo; the <tt>sum</tt> directory to prepare the directory's files for the new <tt>runacct</tt> data. </p></li></ol>


<a name="sysresacctref-1"></a><h5>What Happens if the System Shuts Down</h5>
<p><a name="indexterm-77"></a><a name="indexterm-78"></a><a name="sysresacctref-ix2885"></a><a name="sysresacctref-ix2886"></a><a name="sysresacctref-ix2887"></a><a name="sysresacctref-ix2888"></a><a name="sysresacctref-ix2889"></a>If the system is shut down by using the <tt>shutdown</tt> command, the
<tt>shutacct</tt> script is executed automatically. The <tt>shutacct</tt> script writes a <b>reason record</b> into the
<tt>/var/adm/wtmpx</tt> file and turns off process accounting.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="esxhm.html">Previous</a>
             </td>
             <td align="right">
                 <a href="enmzl.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

