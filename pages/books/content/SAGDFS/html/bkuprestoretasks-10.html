<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Restoring Files and File Systems - System Administration Guide: Devices and File Systems</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Devices and File Systems</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="bkuprestoretasks-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="bkupref-12756.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol1preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="medintro-55492.html">1.&nbsp;&nbsp;Managing Removable Media (Overview)</a></p>
<p class="toc level1 tocsp"><a href="medformat-83002.html">2.&nbsp;&nbsp;Managing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medaccess-29267.html">3.&nbsp;&nbsp;Accessing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medcdrw-1.html">4.&nbsp;&nbsp;Writing CDs and DVDs (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig-27900.html">5.&nbsp;&nbsp;Managing Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig2-1.html">6.&nbsp;&nbsp;Dynamically Configuring Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devusbover-24.html">7.&nbsp;&nbsp;Using USB Devices (Overview)</a></p>
<p class="toc level1 tocsp"><a href="devusbtasks-1.html">8.&nbsp;&nbsp;Using USB Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fncpk.html">9.&nbsp;&nbsp;Using InfiniBand Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksconcepts-29477.html">10.&nbsp;&nbsp;Managing Disks (Overview)</a></p>
<p class="toc level1 tocsp"><a href="disksprep-31030.html">11.&nbsp;&nbsp;Administering Disks (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="diskssadd-16103.html">12.&nbsp;&nbsp;SPARC: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksxadd-38159.html">13.&nbsp;&nbsp;x86: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fmvcd.html">14.&nbsp;&nbsp;Configuring Solaris iSCSI Targets and Initiators (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="gfydr.html">15.&nbsp;&nbsp;Configuring and Managing the Solaris Internet Storage Name Service (iSNS)</a></p>
<p class="toc level1 tocsp"><a href="disksformat-15833.html">16.&nbsp;&nbsp;The <tt>format</tt> Utility (Reference)</a></p>
<p class="toc level1 tocsp"><a href="fsoverview-38559.html">17.&nbsp;&nbsp;Managing File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="fscreate-96442.html">18.&nbsp;&nbsp;Creating UFS, TMPFS, and LOFS File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsmount-42780.html">19.&nbsp;&nbsp;Mounting and Unmounting File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fscachefs-70682.html">20.&nbsp;&nbsp;Using The CacheFS File System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsswap-14677.html">21.&nbsp;&nbsp;Configuring Additional Swap Space (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fstroublefsck-61446.html">22.&nbsp;&nbsp;Checking UFS File System Consistency (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsfilesysappx-94408.html">23.&nbsp;&nbsp;UFS File System (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupconcepts-57422.html">24.&nbsp;&nbsp;Backing Up and Restoring File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="bkuptasks2-64128.html">25.&nbsp;&nbsp;Backing Up Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupsnapshot-2.html">26.&nbsp;&nbsp;Using UFS Snapshots (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuprestoretasks-38055.html">27.&nbsp;&nbsp;Restoring Files and File Systems (Tasks)</a></p>
<p class="toc level2"><a href="bkuprestoretasks-3.html">Restoring Files and File System Backups (Task Map)</a></p>
<p class="toc level2"><a href="bkuprestoretasks-1.html">Preparing to Restore Files and File Systems</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Restoring Files and File Systems</a></p>
<p class="toc level3"><a href="#bkuprestoretasks-40591">How to Determine Which Tapes to Use</a></p>
<p class="toc level3"><a href="#bkuprestoretasks-63510">How to Restore Files Interactively</a></p>
<p class="toc level3"><a href="#bkuprestoretasks-72504">How to Restore Specific Files Noninteractively</a></p>
<p class="toc level3"><a href="#bkuprestoretasks-65439">How to Restore a Complete File System</a></p>
<p class="toc level3"><a href="#bkuprestoretasks-87945">How to Restore the root (<tt>/</tt>) and <tt>/usr</tt> File Systems</a></p>
</div>
<p class="toc level1 tocsp"><a href="bkupref-12756.html">28.&nbsp;&nbsp;UFS Backup and Restore Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupsavefiles-17924.html">29.&nbsp;&nbsp;Copying UFS Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuptapedevice-42512.html">30.&nbsp;&nbsp;Managing Tape Drives (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="bkuprestoretasks-10"></a><h3>Restoring Files and File Systems</h3>
<p>When you back up files and directories, you save them relative to
the file system in which they belong. When you restore files and directories, the
<tt>ufsrestore</tt> command re-creates the file hierarchy in the current working directory.</p><p>For example, files backed up from the <tt>/export/doc/books</tt> directory (where <tt>/export</tt> is the
file system) are saved relative to <tt>/export</tt>. In other words, the <tt>book1</tt> file in
the <tt>books</tt> directory is saved as <tt>./doc/books/book1</tt> on the tape. Later on,
if you restored the <tt>./doc/books/book1</tt> file to the <tt>/var/tmp</tt> directory, the file would
be restored to <tt>/var/tmp/doc/books/book1</tt>.</p><p>When you restore individual files and directories, you should restore them to a
temporary location, such as the <tt>/var/tmp</tt> directory. After you verify the files, you
can move them to their proper locations. However, you can restore individual files
and directories to their original locations. If you do so, be sure you
are not overwriting newer files with older versions from the backup tape.</p><p>To avoid conflicts with other users, you might want to create and
change to a subdirectory, such as the<tt>/var/tmp/restore</tt> file, in which to restore the files.</p><p>If you are restoring a hierarchy, you should restore the files to
a temporary directory on the same file system where the files will reside.
Then, you can use the <tt>mv</tt> command to move the entire hierarchy where it
belongs after it is restored.</p>
<hr><p><b>Note - </b>Do not restore files in the <tt>/tmp</tt> directory even temporarily. The <tt>/tmp</tt> directory
is usually mounted as a TMPFS file system. TMPFS does not support UFS
file system attributes such as ACLs.</p>
<hr>


<a name="bkuprestoretasks-40591"></a><h4>How to Determine Which Tapes to Use</h4><ol>
<li><a name="bkuprestoretasks-step-12"></a><b>Ask the user for the approximate date the files to be restored were
last modified.<a name="indexterm-460"></a><a name="indexterm-461"></a></b></li>
<li><a name="bkuprestoretasks-step-13"></a><b>Refer to your backup plan to find the date of the last backup
that contains the file or file system.</b><p>To retrieve the most recent version of a file, work backward through the
incremental backups from highest to lowest dump level and from most recent to
least recent date, unless the user requests otherwise.</p></li>
<li><a name="bkuprestoretasks-step-14"></a><b>If you have online archive files, identify the correct media.</b><pre># <tt><b>ufsrestore ta</b></tt> <i>archive-name</i> <i>./path/filename ./path/filename</i></pre><dl><dt><tt>t</tt></dt>
<dd><p>Lists each file on the tape.</p></dd>
<dt><tt>a</tt></dt>
<dd><p>Reads the table of contents from the online archive file instead of from the tape.</p></dd>
<dt><i>archive-name</i></dt>
<dd><p>Identifies the online archive file name.</p></dd>
<dt><i>./path/</i><b>filename</b></dt>
<dd><p>Identifies the file name or file names you are looking for on the online archive. If successful, the <tt>ufsrestore</tt> command prints out the inode number and file name. If unsuccessful, <tt>ufsrestore</tt> prints an error message.</p></dd>
</dl>
<p>For more information, see the <a href="http://docs.sun.com/doc/819-2240/ufsrestore-1m?a=view"><tt>ufsrestore</tt>(1M)</a> man page.</p></li>
<li><a name="bkuprestoretasks-step-15"></a><b>Insert the media that contains the files to be restored in the drive
and verify the correct media.</b><pre># <tt><b>ufsrestore tf /dev/rmt/</b></tt><i>n ./path/filename ./path/filename</i></pre><p>Be sure to use the complete path for each <i>filename</i>. If a file
is in the backup, its name and inode number are listed. Otherwise, a
message states that the file is not on the volume.</p></li>
<li><a name="bkuprestoretasks-step-16"></a><b>If you have multiple backup files on the same tape, position the tape
at the backup file you want to use.</b><pre># <tt><b>ufsrestore xfs /dev/rmt/</b></tt><i>n</i> <i>tape-number</i></pre></li></ol><a name="fncrp"></a>Example&nbsp;27-1 Determining Which Tapes to Use<p>The following example shows how to check if the <tt>/etc/passwd</tt> file is in
the online archive.</p><pre># <tt><b>ufsrestore ta /var/tmp/root.archive ./etc/passwd</b></tt></pre><p>The following example shows how to verify that the <tt>/etc/passwd</tt> file is on
the backup tape.</p><pre># <tt><b>ufsrestore tf /dev/rmt/0 ./etc/passwd</b></tt></pre>

<a name="bkuprestoretasks-63510"></a><h4>How to Restore Files Interactively</h4><ol>
<li><a name="bkuprestoretasks-step-19"></a><b>Become superuser or assume an equivalent role.</b></li>
<li><a name="bkuprestoretasks-step-20"></a><b>(Optional) Write-protect the tapes for safety.</b></li>
<li><a name="bkuprestoretasks-step-21"></a><b>Insert the volume 1 tape into the tape drive.</b></li>
<li><a name="bkuprestoretasks-step-22"></a><b>Change to a directory that will be used to restore the files to
temporarily.</b><pre># <tt><b>cd /var/tmp</b></tt></pre></li>
<li><a name="bkuprestoretasks-step-23"></a><b>Start the interactive restoration.</b><pre># <tt><b>ufsrestore if /dev/rmt/</b></tt><i>n</i></pre><p>Some informational messages and the <tt>ufsrestore></tt> prompt are displayed.</p></li>
<li><a name="bkuprestoretasks-step-24"></a><b>Create a list of files to be restored.</b><ol style="list-style-type: lower-alpha">
				 
<li><a name="bkuprestoretasks-step-25"></a><b>List the contents of a directory.</b><pre>ufsrestore> <tt><b>ls</b></tt> [<i>directory-name</i>]</pre></li>
<li><a name="bkuprestoretasks-step-26"></a><b>Change to a directory.</b><pre>ufsrestore> <tt><b>cd</b></tt> <i>directory-name</i></pre></li>
<li><a name="bkuprestoretasks-step-27"></a><b>Create a list of files and directories that you want to restore.</b><pre>ufsrestore> <tt><b>add</b></tt> <i>filenames</i></pre></li>
<li><a name="bkuprestoretasks-step-28"></a>(Optional) <b>Remove any directory or file from the list of files to be restored,
if necessary.</b><pre>ufsrestore> <tt><b>delete</b></tt> <i>filename</i></pre></li></ol></li>
<li><a name="bkuprestoretasks-step-29"></a>(Optional) <b>Display the file names as they are being restored.</b><pre>ufsrestore> <tt><b>verbose</b></tt></pre></li>
<li><a name="bkuprestoretasks-step-30"></a><b>Restore the files.</b><pre>ufsrestore> <tt><b>extract</b></tt></pre><p>The <tt>ufsrestore</tt> command asks you which volume number to use.</p></li>
<li><a name="bkuprestoretasks-step-31"></a><b>Type the volume number and press Return. If you have only one volume,
type <tt>1</tt> and press Return.</b><pre>Specify next volume #: <tt><b>1</b></tt></pre><p>The files and directories in the list are extracted and restored to the
current working directory.</p></li>
<li><a name="bkuprestoretasks-step-32"></a><b>To maintain the mode of the current directory, enter <tt>n</tt> at the 
<tt>set owner/mode</tt> prompt.</b><pre>set owner/mode for `.'? [yn] <tt><b>n</b></tt></pre><p>You must wait while the <tt>ufsrestore</tt> command performs its final cleanup.</p></li>
<li><a name="bkuprestoretasks-step-33"></a><b>Quit the <tt>ufsrestore</tt> program.</b><pre>ufsrestore> <tt><b>quit</b></tt></pre><p>You then see the shell prompt.</p></li>
<li><a name="bkuprestoretasks-step-92"></a><b>Verify the restored files.</b><ol style="list-style-type: lower-alpha">
				 
<li><a name="bkuprestoretasks-step-97"></a><b>List the restored files and directories.</b><pre># <tt><b>ls -l</b></tt></pre><p>A list of files and directories is displayed.</p></li>
<li><a name="bkuprestoretasks-step-98"></a><b>Check the list to be sure that all the files and directories you
specified in the list have been restored.</b></li></ol></li>
<li><a name="bkuprestoretasks-step-99"></a><b>Move the files to the proper directories.</b></li></ol><a name="fncrq"></a>Example&nbsp;27-2 Restoring Files Interactively<p><a name="indexterm-462"></a>The following example shows how to extract the <tt>/etc/passwd</tt> and <tt>/etc/shadow</tt> files
from the backup tape.</p><pre># <tt><b>cd /var/tmp</b></tt>
# <tt><b>ufsrestore if /dev/rmt/0</b></tt>
ufsrestore> <tt><b>ls</b></tt>
.:
 .:
 .sunw/        export/       net/          sbin/         usr/
 Sources/      etools/       opt/          scde/         var/
 b/            home/         ptools/       set/          vol/
 bin           kernel/       pkg/          share/        
 dev/          lib/          platform/     shared/
 devices/      lost+found/   proc/         src/
 etc/          mnt/          rtools/       tmp/
ufsrestore> <tt><b>cd etc</b></tt>
ufsrestore> <tt><b>add passwd shadow</b></tt>
ufsrestore> <tt><b>verbose</b></tt>
verbose mode on
ufsrestore> <tt><b>extract</b></tt>
Extract requested files
You have not read any volumes yet.
Unless you know which volume your file(s) are on you should start 
with the last volume and work towards the first.
Specify next volume #: <tt><b>1</b></tt>
extract file ./etc/shadow
extract file ./etc/passwd
Add links
Set directory mode, owner, and times.
set owner/mode for `.'? [yn] <tt><b>n</b></tt>
ufsrestore> <tt><b>quit</b></tt>
# <tt><b>cd etc</b></tt>
# <tt><b>mv passwd /etc</b></tt>
# <tt><b>mv shadow /etc</b></tt>
# <tt><b>ls -l /etc</b></tt></pre>

<a name="bkuprestoretasks-72504"></a><h4>How to Restore Specific Files Noninteractively</h4><ol>
<li><a name="bkuprestoretasks-step-41"></a><b>Become superuser or assume an equivalent role.</b></li>
<li><a name="bkuprestoretasks-step-42"></a><b>(Optional) Write-protect the tape for safety.</b></li>
<li><a name="bkuprestoretasks-step-43"></a><b>Insert the volume 1 tape into the tape drive.</b></li>
<li><a name="bkuprestoretasks-step-44"></a><b>Change to a directory that will be used to restore files to temporarily.</b><pre># <tt><b>cd /var/tmp</b></tt></pre></li>
<li><a name="bkuprestoretasks-step-45"></a><b>Restore the file or files.</b><pre># <tt><b>ufsrestore xvf /dev/rmt/</b></tt><i>n</i> <i>filename</i></pre><dl><dt><tt>x</tt></dt>
<dd><p>Tells <tt>ufsrestore</tt> to copy specific files or directories in the <i>filename</i> argument.</p></dd>
<dt><tt>v</tt></dt>
<dd><p>Displays the file names as they are restored.</p></dd>
<dt><tt>f /dev/rmt/</tt><i>n</i></dt>
<dd><p>Identifies the tape device name.</p></dd>
<dt><b>filename</b></dt>
<dd><p>Specifies one or more file names or directory names, separated by spaces. For example: <tt>./export/home/user1/mail</tt> <tt>./export/home/user2/mail</tt>.</p></dd>
</dl>
</li>
<li><a name="bkuprestoretasks-step-46"></a><b>Type the volume number where files are located. Press Return.</b><pre>Specify next volume #: <tt><b>1</b></tt></pre><p>The file or files are restored to the current working directory.</p></li>
<li><a name="bkuprestoretasks-step-47"></a><b>To maintain the mode of the current directory, type <tt>n</tt> and press Return
at the <tt>set owner/mode</tt> prompt.</b><pre>set owner/mode for '.'? [yn] <tt><b>n</b></tt></pre></li>
<li><a name="bkuprestoretasks-step-93"></a><b>Verify the restored files.</b><ol style="list-style-type: lower-alpha">
				 
<li><a name="bkuprestoretasks-step-3"></a><b>List the restored files and directories.</b><pre># <tt><b>ls -l</b></tt></pre><p>A list of files and directories is displayed.</p></li>
<li><a name="bkuprestoretasks-step-4"></a><b>Check the list to be sure that all the files and directories you
specified in the list have been restored.</b></li></ol></li>
<li><a name="bkuprestoretasks-step-5"></a><b>Move the files to the proper directories.</b></li></ol><a name="fncro"></a>Example&nbsp;27-3 Restoring Specific Files Noninteractively<p><a name="bkuprestoretasks-ix3078"></a><a name="indexterm-463"></a>The following example shows how to noninteractively restore the <tt>passwd</tt> and <tt>shadow</tt>
files to the <tt>/var/tmp</tt> directory. </p><pre># <tt><b>cd /var/tmp</b></tt>
# <tt><b>ufsrestore xvf /dev/rmt/0 ./etc/passwd ./etc/shadow</b></tt>
Verify volume and initialize maps
Media block size is 126
Dump   date: Wed Jul 28 16:13:52 2004
Dumped from: the epoch
Level 0 dump of / on starbug:/dev/dsk/c0t0d0s0
Label: none
Extract directories from tape
Initialize symbol table.
Extract requested files
You have not read any volumes yet.
Unless you know which volume your file(s) are on you should start
with the last volume and work towards the first.
Specify next volume #: 1
extract file ./etc/passwd
extract file ./etc/shadow
Add links
Set directory mode, owner, and times.
Specify next volume #:<tt><b>1</b></tt>
extract file ./etc/passwd
extract file ./etc/shadow
Add links
Set directory mode, owner, and times.
set owner/mode for `.'? [yn] <tt><b>n</b></tt>
# <tt><b>cd etc</b></tt>
# <tt><b>mv passwd /etc</b></tt>
# <tt><b>mv shadow /etc</b></tt>
# <tt><b>ls -l /etc</b></tt></pre><a name="fncrs"></a>Example&nbsp;27-4 Restoring Files From a Remote Tape Device<p>You can restore files from a remote tape drive by adding <i>remote-host</i><tt>:</tt>
to the front of the tape device name, when using the <tt>ufsrestore</tt> command.</p><p>The following example shows how to restore files by using a remote
tape drive <tt>/dev/rmt/0</tt> on the system <tt>venus</tt>.</p><pre># <tt><b>ufsrestore xf venus:/dev/rmt/0 ./etc/hosts</b></tt></pre>

<a name="bkuprestoretasks-65439"></a><h4>How to Restore a Complete File System</h4><p>Occasionally, a file system becomes so damaged that you must completely restore it.
Typically, you need to restore a complete file system after a disk failure.
You might need to replace the hardware before you can restore the software.
For information on how to replace a disk, see <a href="diskssadd-53.html">SPARC: Adding a System Disk or a Secondary Disk (Task Map)</a> or <a href="disksxadd-73.html">x86: Adding a System Disk or a Secondary Disk (Task Map)</a>.</p><p>Full restoration of a file system such as <tt>/export/home</tt> can take a lot
of time. If you have consistently backed up file systems, you can restore
them to their state from the time of the last incremental backup.</p>
<hr><p><b>Note - </b>You cannot use this procedure to restore the root (<tt>/</tt>) or <tt>/usr</tt> file
systems. For instructions on restoring these file systems, see <a href="#bkuprestoretasks-87945">How to Restore the root (<tt>/</tt>) and <tt>/usr</tt> File Systems</a>.</p>
<hr>
<ol>
<li><a name="bkuprestoretasks-step-54"></a><b><a name="bkuprestoretasks-ix3084"></a>Become superuser or assume an equivalent role. </b></li>
<li><a name="bkuprestoretasks-step-55"></a><b>If necessary, unmount the file system. </b><pre># <tt><b>umount /dev/rdsk/</b></tt><i>device-name</i></pre><p>Or:</p><pre># <tt><b>umount</b></tt> <i>/file-system</i></pre></li>
<li><a name="bkuprestoretasks-step-56"></a><b>Create the new file system.</b><pre># <tt><b>newfs /dev/rdsk/</b></tt><i>device-name</i></pre><p>You are asked if you want to construct a new file system
on the raw device. Verify that the <i>device-name</i> is correct so that you don't
destroy the wrong file system.</p><p>For more information, see the <a href="http://docs.sun.com/doc/819-2240/newfs-1m?a=view"><tt>newfs</tt>(1M)</a> man page.</p></li>
<li><a name="bkuprestoretasks-step-57"></a><b>Confirm that the new file system should be created.</b><pre>newfs: construct a new file system /dev/rdsk/c<i>w</i>t<i>x</i>d<i>y</i>s<i>z</i>:(y/n)? <tt><b>y</b></tt></pre><p>The new file system is created.</p></li>
<li><a name="bkuprestoretasks-step-58"></a><b>Mount the new file system on a temporary mount point.</b><pre># <tt><b>mount /dev/dsk/</b></tt><i>device-name</i> <tt><b>/mnt</b></tt></pre></li>
<li><a name="bkuprestoretasks-step-59"></a><b>Change to the mount point directory.</b><pre># <tt><b>cd /mnt</b></tt></pre></li>
<li><a name="bkuprestoretasks-step-60"></a><b>(Optional) Write-protect the tapes for safety.</b></li>
<li><a name="bkuprestoretasks-step-61"></a><b>Insert the first volume of the level 0 tape into the tape drive.</b></li>
<li><a name="bkuprestoretasks-step-62"></a><b>Restore the files.</b><pre># <tt><b>ufsrestore rvf /dev/rmt/</b></tt><i>n</i></pre><p>The dump level 0 backup is restored. If the backup required multiple tapes,
you are prompted to load each tape in numeric order.</p></li>
<li><a name="bkuprestoretasks-step-63"></a><b>Remove the tape and load the next level tape in the drive.</b><p>Always restore tapes starting with dump level 0 and continuing until you reach
the highest dump level. </p></li>
<li><a name="bkuprestoretasks-step-64"></a><b>Repeat <a href="#bkuprestoretasks-step-61">Step&nbsp;8</a> through <a href="#bkuprestoretasks-step-63">Step&nbsp;10</a> for each dump level, from the lowest to the
highest level.</b></li>
<li><a name="bkuprestoretasks-step-94"></a><b>Verify that the file system has been restored.</b><pre># <tt><b>ls</b></tt></pre></li>
<li><a name="bkuprestoretasks-step-65"></a><b>Remove the <tt>restoresymtable</tt> file.</b><pre># <tt><b>rm restoresymtable</b></tt></pre><p>The <tt>restoresymtable</tt> file that is created and used by the <tt>ufsrestore</tt> command to
check-point the restore is removed.</p></li>
<li><a name="bkuprestoretasks-step-66"></a><b>Change to another directory.</b><pre># <tt><b>cd /</b></tt></pre></li>
<li><a name="bkuprestoretasks-step-67"></a><b>Unmount the newly restored file system.</b><pre># <tt><b>umount /mnt</b></tt></pre></li>
<li><a name="bkuprestoretasks-step-68"></a><b>Remove the last tape and insert a new tape that is not write-protected
in the tape drive.</b></li>
<li><a name="bkuprestoretasks-step-69"></a><b>Make a level 0 backup of the newly restored file system.</b><pre># <tt><b>ufsdump 0ucf /dev/rmt/</b></tt><i>n</i> <tt><b>/dev/rdsk/</b></tt><i>device-name</i></pre><p>A level 0 backup is performed. Always immediately do a full backup
of a newly created file system because the <tt>ufsrestore</tt> command repositions the files and
changes the inode allocation.</p></li>
<li><a name="bkuprestoretasks-step-70"></a><b>Mount the restored file system.</b><pre># <tt><b>mount /dev/dsk/</b></tt><i>device-name mount-point</i></pre><p>The restored file system is mounted and available for use.</p></li>
<li><a name="bkuprestoretasks-step-1"></a><b>Verify that the restored and mounted file system is available.</b><pre># <tt><b>ls</b></tt> <i>mount-point</i></pre></li></ol><a name="fncrr"></a>Example&nbsp;27-5 Restoring a Complete File System<p>The following example shows how to restore the <tt>/export/home</tt> file system.<a name="extkk"></a></p><pre># <tt><b>newfs /dev/rdsk/c0t0d0s7</b></tt>
newfs: /dev/rdsk/c0t0d0s7 last mounted as /export/home
newfs: construct a new file system /dev/rdsk/c0t0d0s7: (y/n)? <tt><b>y</b></tt>
819314 sectors in 867 cylinders of 15 tracks, 63 sectors
        400.1MB in 55 cyl groups (16 c/g, 7.38MB/g, 3584 i/g)
super-block backups (for fsck -F ufs -o b=#) at:
 32, 15216, 30400, 45584, 60768, 75952, 91136, 106320, 121504, 136688,
 681264, 696448, 711632, 725792, 740976, 756160, 771344, 786528, 801712,
 816896,
# <tt><b>mount /dev/dsk/c0t0d0s7 /mnt</b></tt>
# <tt><b>cd /mnt</b></tt>
# <tt><b>ufsrestore rvf /dev/rmt/0</b></tt>
Verify volume and initialize maps
Media block size is 126
Dump   date: Thu Jul 29 10:14:00 2004
Dumped from: the epoch
Level 0 dump of /export/home on starbug:/dev/dsk/c0t0d0s7
Label: none
Begin level 0 restore
Initialize symbol table.
Extract directories from tape
Calculate extraction list.
Warning: ./lost+found: File exists
Make node ./rimmer
Make node ./rimmer/wdir
Make node ./lister
Make node ./pmorph
Make node ./inquisitor
Make node ./kryten
Make node ./kryten/letters
Make node ./kryten/reports
Extract new leaves.
Check pointing the restore
extract file ./rimmer/words
extract file ./rimmer/words1
extract file ./rimmer/words2
extract file ./rimmer/words3
extract file ./rimmer/wdir/words
extract file ./rimmer/wdir/words1
extract file ./rimmer/wdir/words2
extract file ./rimmer/wdir/words3
.
.
.
Add links
Set directory mode, owner, and times.
Check the symbol table.
Check pointing the restore
# <tt><b>rm restoresymtable</b></tt>
# <tt><b>cd /</b></tt>
# <tt><b>umount /mnt</b></tt>
# <tt><b>ufsdump 0ucf /dev/rmt/0 /export/home</b></tt>
                    .
                    .
                    .
# <tt><b>mount /dev/dsk/c0t0d0s7 /export/home</b></tt>
# <tt><b>ls /export/home</b></tt></pre>

<a name="bkuprestoretasks-87945"></a><h4>How to Restore the root (<tt>/</tt>) and <tt>/usr</tt> File Systems</h4><ol>
<li><a name="bkuprestoretasks-step-9"></a><b>Become superuser or assume an equivalent role.</b></li>
<li><a name="bkuprestoretasks-step-73"></a><b>Add a new system disk to the system where the root (<tt>/</tt>) and
<tt>/usr</tt> file systems will be restored.</b><p>For a detailed description about adding a system disk, refer to <a href="diskssadd-53.html#diskssadd-55658">SPARC: How to Connect a System Disk and Boot</a> or
<a href="disksxadd-1.html#disksxadd-12484">x86: How to Connect a System Disk</a>.</p></li>
<li><a name="bkuprestoretasks-step-74"></a><b>Mount the new file system on a temporary mount point.</b><pre># <tt><b>mount /dev/dsk/</b></tt><i>device-name</i> <tt><b>/mnt</b></tt></pre></li>
<li><a name="bkuprestoretasks-step-75"></a><b>Change to the <tt>/mnt</tt> directory.</b><pre># <tt><b>cd /mnt</b></tt></pre></li>
<li><a name="bkuprestoretasks-step-77"></a><b>(Optional) Write-protect the tapes for safety.</b></li>
<li><b>Create the links for the tape device.</b><pre># <tt><b>tapes</b></tt></pre></li>
<li><a name="bkuprestoretasks-step-78"></a><b>Restore the root (<tt>/</tt>) file system.</b><pre># <tt><b>ufsrestore rvf /dev/rmt/</b></tt><i>n</i></pre><p>The dump level 0 tape is restored.</p></li>
<li><a name="bkuprestoretasks-step-79"></a><b>Remove the tape and load the next level tape in the drive.</b><p>Always restore tapes starting with dump level 0 and continuing from the lowest
to highest dump level.</p></li>
<li><a name="bkuprestoretasks-step-80"></a><b>Continue restoring as needed.</b><pre># <tt><b>ufsrestore rvf /dev/rmt/</b></tt><i>n</i></pre><p>The next level tape is restored.</p></li>
<li><a name="bkuprestoretasks-step-81"></a><b>Repeat <a href="#bkuprestoretasks-step-79">Step&nbsp;8</a> and <a href="#bkuprestoretasks-step-80">Step&nbsp;9</a> for each additional tape.</b></li>
<li><a name="bkuprestoretasks-step-95"></a><b>Verify that the file system has been restored.</b><pre># <tt><b>ls</b></tt></pre></li>
<li><a name="bkuprestoretasks-step-82"></a><b>Remove the <tt>restoresymtable</tt> file.</b><pre># <tt><b>rm restoresymtable</b></tt></pre><p>The <tt>restoresymtable</tt> file that is created and used by the <tt>ufsrestore</tt> command to
check-point the restore is removed.</p></li>
<li><a name="bkuprestoretasks-step-83"></a><b>Change to the root (<tt>/</tt>) directory.</b><pre># <tt><b>cd /</b></tt></pre></li>
<li><a name="bkuprestoretasks-step-84"></a><b>Unmount the newly created file system.</b><pre># <tt><b>umount /mnt</b></tt></pre></li>
<li><a name="bkuprestoretasks-step-85"></a><b>Check the new file system.</b><pre># <tt><b>fsck /dev/rdsk/</b></tt><i>device-name</i></pre><p>The restored file system is checked for consistency.</p></li>
<li><a name="bkuprestoretasks-step-96"></a><b>Create the boot blocks on the root partition.</b><p>On a SPARC system:</p><pre># <tt><b>installboot /usr/platform/`uname-i`/lib/fs/ufs/bootblk</b></tt> 
<tt><b>/dev/rdsk/</b></tt><i>device-name</i></pre><p>For more information, see the <a href="http://docs.sun.com/doc/819-2240/installboot-1m?a=view"><tt>installboot</tt>(1M)</a> man page.</p><p>For an example of using the <tt>installboot</tt> command on a SPARC based system, see
<a href="#bkuprestoretasks-102">Example&nbsp;27-6</a>. </p><p>On an x86 system:</p><pre># <tt><b>/sbin/installgrub /boot/grub/stage1 /boot/grub/stage2</b></tt> <i>/dev/rdsk/cwtxdysz</i></pre><p>For more information, see <a href="http://docs.sun.com/doc/819-2240/installgrub-1m?a=view"><tt>installgrub</tt>(1M)</a>.</p><p>For an example of using the <tt>installgrub</tt> command on an x86 based system, see
<a href="#bkuprestoretasks-90">Example&nbsp;27-7</a>.</p></li>
<li><a name="bkuprestoretasks-step-86"></a><b>Insert a new tape in the tape drive.</b></li>
<li><a name="bkuprestoretasks-step-87"></a><b>Back up the new file system.</b><pre># <tt><b>ufsdump 0uf /dev/rmt/</b></tt><i>n</i> <tt><b>/dev/rdsk/</b></tt><i>device-name</i></pre><p>A dump level 0 backup is performed. Always immediately do a full
backup of a newly created file system because the <tt>ufsrestore</tt> command repositions the files
and changes the inode allocation.</p></li>
<li><a name="bkuprestoretasks-step-88"></a><b>Repeat steps 5 through 16 for the <tt>/usr</tt> file system, if necessary.</b></li>
<li><a name="bkuprestoretasks-step-89"></a><b>Reboot the system.</b><pre># <tt><b>init 6</b></tt></pre><p>The system is rebooted.</p></li></ol><a name="bkuprestoretasks-102"></a>Example&nbsp;27-6 SPARC: Restoring the root (<tt>/</tt>) File System<p><a name="bkuprestoretasks-ix3088"></a>This example shows how to restore the root (<tt>/</tt>) file system on a
SPARC system. This example assumes that the system is booted from a local
CD or from the network.</p><pre># <tt><b>mount /dev/dsk/c0t3d0s0 /mnt</b></tt>
# <tt><b>cd /mnt</b></tt>
# <tt><b>tapes</b></tt>
# <tt><b>ufsrestore rvf /dev/rmt/0</b></tt>
# <tt><b>ls</b></tt>
# <tt><b>rm restoresymtable</b></tt>
# <tt><b>cd /</b></tt>
# <tt><b>umount /mnt</b></tt>
# <tt><b>fsck /dev/rdsk/c0t3d0s0</b></tt>
# <tt><b>installboot /usr/platform/sun4u/lib/fs/ufs/bootblk</b></tt>
<tt><b>/dev/rdsk/c0t3d0s0</b></tt>
# <tt><b>ufsdump 0uf /dev/rmt/0 /dev/rdsk/c0t3d0s0</b></tt>
# <tt><b>init 6</b></tt></pre><a name="bkuprestoretasks-90"></a>Example&nbsp;27-7 x86: Restoring the root (<tt>/</tt>) File System<p><a name="indexterm-464"></a>This example shows how to restore the root (<tt>/</tt>) file system on an
x86 system. This example assumes that the system is booted from a GRUB
failsafe boot session, local CD, or from the network.</p><pre># <tt><b>mount /dev/dsk/c0t3d0s0 /mnt</b></tt>
# <tt><b>cd /mnt</b></tt>
# <tt><b>tapes</b></tt>
# <tt><b>ufsrestore rvf /dev/rmt/0</b></tt>
# <tt><b>ls</b></tt>
# <tt><b>rm restoresymtable</b></tt>
# <tt><b>cd /</b></tt>
# <tt><b>umount /mnt</b></tt>
# <tt><b>fsck /dev/rdsk/c0t3d0s0</b></tt>
# <tt><b>/sbin/installgrub /boot/grub/stage1 /boot/grub/stage2 /dev/rdsk/c0t3d0s0</b></tt>
stage1 written to partition 0 sector 0 (abs 2016)
stage2 written to to partition 0, 227 sectors starting 50 (abs 2066)
# <tt><b>ufsdump 0uf /dev/rmt/0 /dev/rdsk/c0t3d0s0</b></tt>
# <tt><b>init 6</b></tt></pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="bkuprestoretasks-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="bkupref-12756.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

