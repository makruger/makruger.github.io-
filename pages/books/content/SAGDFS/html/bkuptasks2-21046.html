<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Backing Up a File System - System Administration Guide: Devices and File Systems</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Devices and File Systems</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="bkuptasks2-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="bkupsnapshot-2.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol1preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="medintro-55492.html">1.&nbsp;&nbsp;Managing Removable Media (Overview)</a></p>
<p class="toc level1 tocsp"><a href="medformat-83002.html">2.&nbsp;&nbsp;Managing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medaccess-29267.html">3.&nbsp;&nbsp;Accessing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medcdrw-1.html">4.&nbsp;&nbsp;Writing CDs and DVDs (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig-27900.html">5.&nbsp;&nbsp;Managing Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig2-1.html">6.&nbsp;&nbsp;Dynamically Configuring Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devusbover-24.html">7.&nbsp;&nbsp;Using USB Devices (Overview)</a></p>
<p class="toc level1 tocsp"><a href="devusbtasks-1.html">8.&nbsp;&nbsp;Using USB Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fncpk.html">9.&nbsp;&nbsp;Using InfiniBand Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksconcepts-29477.html">10.&nbsp;&nbsp;Managing Disks (Overview)</a></p>
<p class="toc level1 tocsp"><a href="disksprep-31030.html">11.&nbsp;&nbsp;Administering Disks (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="diskssadd-16103.html">12.&nbsp;&nbsp;SPARC: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksxadd-38159.html">13.&nbsp;&nbsp;x86: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fmvcd.html">14.&nbsp;&nbsp;Configuring Solaris iSCSI Targets and Initiators (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="gfydr.html">15.&nbsp;&nbsp;Configuring and Managing the Solaris Internet Storage Name Service (iSNS)</a></p>
<p class="toc level1 tocsp"><a href="disksformat-15833.html">16.&nbsp;&nbsp;The <tt>format</tt> Utility (Reference)</a></p>
<p class="toc level1 tocsp"><a href="fsoverview-38559.html">17.&nbsp;&nbsp;Managing File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="fscreate-96442.html">18.&nbsp;&nbsp;Creating UFS, TMPFS, and LOFS File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsmount-42780.html">19.&nbsp;&nbsp;Mounting and Unmounting File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fscachefs-70682.html">20.&nbsp;&nbsp;Using The CacheFS File System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsswap-14677.html">21.&nbsp;&nbsp;Configuring Additional Swap Space (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fstroublefsck-61446.html">22.&nbsp;&nbsp;Checking UFS File System Consistency (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsfilesysappx-94408.html">23.&nbsp;&nbsp;UFS File System (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupconcepts-57422.html">24.&nbsp;&nbsp;Backing Up and Restoring File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="bkuptasks2-64128.html">25.&nbsp;&nbsp;Backing Up Files and File Systems (Tasks)</a></p>
<p class="toc level2"><a href="bkuptasks2-3.html">Backing Up Files and File System (Task Map)</a></p>
<p class="toc level2"><a href="bkuptasks2-1.html">Preparing for File System Backups</a></p>
<p class="toc level3"><a href="bkuptasks2-1.html#bkuptasks2-78540">How to Find File System Names</a></p>
<p class="toc level3"><a href="bkuptasks2-1.html#bkuptasks2-80196">How to Determine the Number of Tapes Needed for a Full Backup</a></p>
<div class="onpage">
<p class="toc level2 tocsp"><a href="">Backing Up a File System</a></p>
<p class="toc level3"><a href="#bkuptasks2-34493">How to Back Up a File System to Tape</a></p>
</div>
<p class="toc level1 tocsp"><a href="bkupsnapshot-2.html">26.&nbsp;&nbsp;Using UFS Snapshots (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuprestoretasks-38055.html">27.&nbsp;&nbsp;Restoring Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupref-12756.html">28.&nbsp;&nbsp;UFS Backup and Restore Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupsavefiles-17924.html">29.&nbsp;&nbsp;Copying UFS Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuptapedevice-42512.html">30.&nbsp;&nbsp;Managing Tape Drives (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="bkuptasks2-21046"></a><h3>Backing Up a File System</h3>
<p>The following are general guidelines for performing backups:</p>
<ul><li><p>Use single-user mode or unmount the file system, unless you are creating a snapshot of a file system. For information about UFS snapshots, see <a href="bkupsnapshot-2.html">Chapter&nbsp;26, Using UFS Snapshots (Tasks)</a>.</p></li>
<li><p>Be aware that backing up file systems when directory-level operations (such as creating, removing, and renaming files) and file-level activity are occurring simultaneously means that some data will not be included in the backup.</p></li>
<li><p><a name="bkuptasks2-ix3046"></a>You can run the <tt>ufsdump</tt> command from a single system and remotely back up groups of systems across the network through remote shell or remote login. In addition, you can direct the output to the system on which the tape device is located. Typically, the tape device is located on the system from which you run the <tt>ufsdump</tt> command, but it does not have to be.</p><p>Another way to back up files to a remote device is to pipe the output from the <tt>ufsdump</tt> command to the <tt>dd</tt> command. For information about using the <tt>dd</tt> command, see <a href="bkupsavefiles-17924.html">Chapter&nbsp;29, Copying UFS Files and File Systems (Tasks)</a>.</p></li>
<li><p>If you are doing remote backups across the network, the system with the tape device must have entries in its <tt>/.rhosts</tt> file for each client that will be using the device. Also, the system that initiates the backup must be included in the <tt>/.rhosts</tt> file on each system that it will back up.</p></li></ul>


<a name="bkuptasks2-34493"></a><h4>How to Back Up a File System to Tape</h4><p>The following are general steps for backing up file systems by using the
<tt>ufsdump</tt> command. The examples show specific uses of options and arguments.</p><ol>
<li><a name="bkuptasks2-step-11"></a><b>Become superuser or assume an equivalent role.</b></li>
<li><a name="bkuptasks2-step-15"></a><b>Bring the system to run level S (single-user mode).</b><p>For example:</p><pre># <tt><b>shutdown -g30 -y</b></tt></pre></li>
<li><a name="bkuptasks2-step-16"></a><b>(Optional) Check the file system for consistency.</b><p>For example:</p><pre># <tt><b>fsck -m /dev/rdsk/c0t0d0s7</b></tt></pre><p>The <tt>fsck -m</tt> command checks for the consistency of file systems. For example, power
failures can leave files in an inconsistent state. For more information on the
<tt>fsck</tt> command, see <a href="fstroublefsck-61446.html">Chapter&nbsp;22, Checking UFS File System Consistency (Tasks)</a>.</p></li>
<li><a name="bkuptasks2-step-17"></a><b>If you need to back up file systems to a remote tape drive,
follow these steps:</b><ol style="list-style-type: lower-alpha">
				 
<li><a name="bkuptasks2-step-25"></a><b>On the system to which the tape drive is attached (the tape server),
add the following entry to its <tt>/.rhosts</tt> file:</b><pre><i>host</i> root</pre><p>The <i>host</i> entry specifies the name of the system on which you will
run the <tt>ufsdump</tt> command to perform the backup.</p></li>
<li><a name="bkuptasks2-step-2"></a><b>On the tape server, verify that the host added to the <tt>/.rhosts</tt> file
is accessible through the name service.</b></li></ol></li>
<li><a name="bkuptasks2-step-18"></a><b>Identify the device name of the tape drive.</b><p>The default tape drive is the <tt>/dev/rmt/0</tt> device.</p></li>
<li><a name="bkuptasks2-step-19"></a><b>Insert a tape that is write-enabled into the tape drive.</b></li>
<li><a name="bkuptasks2-step-20"></a><b>Back up file systems.</b><pre># <tt><b>ufsdump</b></tt> <i>options arguments filenames</i></pre><p>You can back up file systems or directories, or files within file
systems. For information on backing up individual files, see <a href="http://docs.sun.com/doc/819-2239/tar-1?a=view"><tt>tar</tt>(1)</a> or <a href="http://docs.sun.com/doc/819-2239/cpio-1?a=view"><tt>cpio</tt>(1)</a>.</p><p>The following examples show how to use the most common <tt>ufsdump</tt> options
and arguments:</p>
<ul><li><p><a href="#bkuptasks2-26447">Example&nbsp;25-3</a></p></li>
<li><p><a href="#bkuptasks2-42264">Example&nbsp;25-4</a></p></li>
<li><p><a href="#bkuptasks2-19106">Example&nbsp;25-5</a></p></li>
<li><p><a href="#bkuptasks2-13035">Example&nbsp;25-6</a></p></li></ul>
<p>For other <tt>ufsdump</tt> options and arguments, see <a href="bkupref-12756.html">Chapter&nbsp;28, UFS Backup and Restore Commands (Reference)</a>.</p></li>
<li><a name="bkuptasks2-step-21"></a><b>If prompted, remove the tape and insert the next tape volume.</b></li>
<li><a name="bkuptasks2-step-22"></a><b>Label each tape with the volume number, dump level, date, system name, disk
slice, and file system. </b></li>
<li><a name="bkuptasks2-step-23"></a><b>Bring the system back to run level 3 by pressing Control-D.</b></li>
<li><a name="bkuptasks2-step-24"></a><b>Verify that the backup was successful.</b><pre># <tt><b>ufsrestore tf</b></tt> <i>device-name</i></pre></li></ol><a name="bkuptasks2-26447"></a>Example&nbsp;25-3 Performing a Full Backup of root (<tt>/</tt>)<p><a name="indexterm-446"></a><a name="indexterm-447"></a>The following example shows how to do a full backup of the
root (<tt>/</tt>) file system. The system in this example is brought to single-user mode
before the backup. The following <tt>ufsdump</tt> options are included:</p>
<ul><li><p><tt>0</tt> specifies a <tt>0</tt> level dump (or a full backup).</p></li>
<li><p><tt>u</tt> specifies that the <tt>/etc/dumpdates</tt> file is updated with the date of this backup.</p></li>
<li><p><tt>c</tt> identifies a cartridge tape device.</p></li>
<li><p><tt>f /dev/rmt/0</tt> identifies the tape device.</p></li>
<li><p><tt>/</tt> is the file system being backed up.</p></li></ul>
<p>For example:</p><pre># <tt><b>init 0</b></tt>
ok <tt><b>boot -s</b></tt>
# <tt><b>ufsdump 0ucf /dev/rmt/0 /</b></tt>
  DUMP: Date of this level 0 dump: Wed Jul 28 16:13:52 2004
  DUMP: Date of last level 0 dump: the epoch
  DUMP: Dumping /dev/rdsk/c0t0d0s0 (starbug:/) to /dev/rmt/0.
  DUMP: Mapping (Pass I) [regular files]
  DUMP: Mapping (Pass II) [directories]
  DUMP: Writing 63 Kilobyte records
  DUMP: Estimated 363468 blocks (177.47MB).
  DUMP: Dumping (Pass III) [directories]
  DUMP: Dumping (Pass IV) [regular files]
  DUMP: Tape rewinding
  DUMP: 369934 blocks (180.63MB) on 1 volume at 432 KB/sec
  DUMP: DUMP IS DONE
  DUMP: Level 0 dump on Wed Jul 28 16:13:52 2004
  # <tt><b>ufsrestore tf /dev/rmt/0</b></tt>
         2      .
         3      ./lost+found
         4      ./usr
         5      ./export
         6      ./export/home
         7      ./var
         8      ./var/sadm
         9      ./var/sadm/install
        10      ./var/sadm/install/admin
       823      ./var/sadm/install/admin/default
        11      ./var/sadm/install/logs
       697      ./var/sadm/install/logs/SUNWmpatchmgr
       905      ./var/sadm/install/logs/Additional_Software_install...
       906      ./var/sadm/install/logs/Additional_Software_install...
        13      ./var/sadm/install/.lockfile
        14      ./var/sadm/install/install.db
       824      ./var/sadm/install/special_contents
       838      ./var/sadm/install/contents
                .
                .
                .
  # (<b>Press Control-D to bring system to run level 3</b>)</pre><a name="bkuptasks2-42264"></a>Example&nbsp;25-4 Performing an Incremental Backup of root (<tt>/</tt>)<p><a name="indexterm-448"></a><a name="indexterm-449"></a>The following example shows how to do an incremental backup of the root
(<tt>/</tt>) file system in single-user mode. The following <tt>ufsdump</tt> options are included:</p>
<ul><li><p><tt>9</tt> specifies a <tt>9</tt> level dump (or an incremental backup).</p></li>
<li><p><tt>u</tt> specifies that the <tt>/etc/dumpdates</tt> file is updated with the date of this backup.</p></li>
<li><p><tt>c</tt> identifies a cartridge tape device.</p></li>
<li><p><tt>f /dev/rmt/0</tt> identifies the tape device.</p></li>
<li><p><tt>/</tt> is the file system being backed up.</p></li></ul>
<pre># <tt><b>init 0</b></tt>
ok <tt><b>boot -s</b></tt>
# <tt><b>ufsdump 9ucf /dev/rmt/0 /</b></tt>
 DUMP: Date of this level 9 dump: Wed Jul 28 14:26:50 2004
 DUMP: Date of last level 0 dump: Wed Jul 28 11:15:41 2004
 DUMP: Dumping /dev/rdsk/c0t0d0s0 (starbug:/) to /dev/rmt/0.
 DUMP: Mapping (Pass I) [regular files]
 DUMP: Mapping (Pass II) [directories]
 DUMP: Writing 63 Kilobyte records
 DUMP: Estimated 335844 blocks (163.99MB).
 DUMP: Dumping (Pass III) [directories]
 DUMP: Dumping (Pass IV) [regular files]
 DUMP: 335410 blocks (163.77MB) on 1 volume at 893 KB/sec
 DUMP: DUMP IS DONE
 DUMP: Level 9 dump on Wed Jul 28 14:30:50 2004
 # <tt><b>ufsrestore tf /dev/rmt/0</b></tt>
         2      .
         3      ./lost+found
      5696      ./usr
     11392      ./var
     17088      ./export
     22784      ./export/home
     28480      ./opt
      5697      ./etc
     11393      ./etc/default
     11394      ./etc/default/sys-suspend
     11429      ./etc/default/cron
     11430      ./etc/default/devfsadm
     11431      ./etc/default/dhcpagent
     11432      ./etc/default/fs
     11433      ./etc/default/inetinit
     11434      ./etc/default/kbd
     11435      ./etc/default/nfslogd
     11436      ./etc/default/passwd
     11437      ./etc/default/tar
                .
                .
                .</pre><a name="bkuptasks2-19106"></a>Example&nbsp;25-5 Performing a Full Backup of a Home Directory<p><a name="indexterm-450"></a><a name="indexterm-451"></a>The following example shows how to do a full backup of the
<tt>/export/home/kryten</tt> home directory. The following <tt>ufsdump</tt> options are included:</p>
<ul><li><p><tt>0</tt> specifies that this is a <tt>0</tt> level dump (or a full backup).</p></li>
<li><p><tt>u</tt> specifies that the <tt>/etc/dumpdates</tt> file is updated with the date of this backup.</p></li>
<li><p><tt>c</tt> identifies a cartridge tape device.</p></li>
<li><p><tt>f /dev/rmt/0</tt> identifies the tape device.</p></li>
<li><p><tt>/export/home/kryten</tt> is the directory being backed up.</p></li></ul>
<pre># <tt><b>ufsdump 0ucf /dev/rmt/0 /export/home/kryten</b></tt>
  DUMP: Date of this level 0 dump: Wed Jul 28 15:02:48 2004
  DUMP: Date of last level 0 dump: the epoch
  DUMP: Dumping /dev/rdsk/c0t0d0s7 (starbug:/export/home) to /dev/rmt/0.
  DUMP: Mapping (Pass I) [regular files]
  DUMP: Mapping (Pass II) [directories]
  DUMP: Writing 63 Kilobyte records
  DUMP: Estimated 2412 blocks (1.18MB).
  DUMP: Dumping (Pass III) [directories]
  DUMP: Dumping (Pass IV) [regular files]
  DUMP: 2392 blocks (1.17MB) on 1 volume at 4241 KB/sec
  DUMP: DUMP IS DONE
# <tt><b>ufsrestore tf /dev/rmt/0</b></tt>
       232      ./kryten
       233      ./kryten/filea
       234      ./kryten/fileb
       235      ./kryten/filec
       236      ./kryten/letters
       237      ./kryten/letters/letter1
       238      ./kryten/letters/letter2
       239      ./kryten/letters/letter3
       240      ./kryten/reports
       241      ./kryten/reports/reportA
       242      ./kryten/reports/reportB
       243      ./kryten/reports/reportC
#</pre><a name="bkuptasks2-13035"></a>Example&nbsp;25-6 Performing a Full Backup to a Remote System ( Data to System)<p>The following example shows how to do a full backup of a
local <tt>/export/home</tt> file system on a  system (<tt>mars</tt>) to a tape
device on a remote  system (<tt>earth</tt>) in single-user mode. The following
<tt>ufsdump</tt> options are included:</p>
<ul><li><p><tt>0</tt> specifies a <tt>0</tt> level dump (or a full backup).</p></li>
<li><p><tt>u</tt> specifies that the <tt>/etc/dumpdates</tt> file is updated with the date of this backup.</p></li>
<li><p><tt>c</tt> identifies a cartridge tape device.</p></li>
<li><p><tt>f earth:/dev/rmt/0</tt> identifies the remote system name and tape device.</p></li>
<li><p><tt>/export/home</tt> is the file system being backed up.</p></li></ul>
<pre># <tt><b>ufsdump 0ucf earth:/dev/rmt/0 /export/home</b></tt>
  DUMP: Date of this level 0 dump: Wed Jul 28 15:52:59 2004
  DUMP: Date of last level 0 dump: the epoch
  DUMP: Dumping /dev/rdsk/c0t0d0s7 (mars:/export/home) to earth:/dev/rmt/0.
  DUMP: Mapping (Pass I) [regular files]
  DUMP: Mapping (Pass II) [directories]
  DUMP: Writing 63 Kilobyte records
  DUMP: Estimated 8282 blocks (4.04MB).
  DUMP: Dumping (Pass III) [directories]
  DUMP: Dumping (Pass IV) [regular files]
  DUMP: Tape rewinding
  DUMP: 8188 blocks (4.00MB) on 1 volume at 67 KB/sec
  DUMP: DUMP IS DONE
  DUMP: Level 0 dump on Wed Jul 28 15:52:59 2004
# <tt><b>ufsrestore tf earth:/dev/rmt/0</b></tt>
         2      .
         3      ./lost+found
         4      ./kryten
         5      ./kryten/filea
         6      ./kryten/fileb
         7      ./kryten/filec
         8      ./kryten/letters
         9      ./kryten/letters/letter1
        10      ./kryten/letters/letter2
        11      ./kryten/letters/letter3
        12      ./kryten/reports
.
.
.
 #</pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="bkuptasks2-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="bkupsnapshot-2.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

