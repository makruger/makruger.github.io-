<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>RCM Script Tasks - System Administration Guide: Devices and File Systems</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Devices and File Systems</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="devconfig2-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="devusbover-24.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol1preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="medintro-55492.html">1.&nbsp;&nbsp;Managing Removable Media (Overview)</a></p>
<p class="toc level1 tocsp"><a href="medformat-83002.html">2.&nbsp;&nbsp;Managing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medaccess-29267.html">3.&nbsp;&nbsp;Accessing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medcdrw-1.html">4.&nbsp;&nbsp;Writing CDs and DVDs (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig-27900.html">5.&nbsp;&nbsp;Managing Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig2-1.html">6.&nbsp;&nbsp;Dynamically Configuring Devices (Tasks)</a></p>
<p class="toc level2"><a href="devconfig2-6.html">Dynamic Reconfiguration and Hot-Plugging</a></p>
<p class="toc level2"><a href="devconfig2-120.html">SCSI Hot-Plugging With the <tt>cfgadm</tt> Command (Task Map)</a></p>
<p class="toc level2"><a href="devconfig2-8.html">SCSI Hot-Plugging With the <tt>cfgadm</tt> Command</a></p>
<p class="toc level3"><a href="devconfig2-8.html#devconfig2-9">How to Display Information About SCSI Devices</a></p>
<p class="toc level3"><a href="devconfig2-8.html#devconfig2-10">How to Unconfigure a SCSI Controller</a></p>
<p class="toc level3"><a href="devconfig2-8.html#devconfig2-11">How to Configure a SCSI Controller</a></p>
<p class="toc level3"><a href="devconfig2-8.html#devconfig2-12">How to Configure a SCSI Device</a></p>
<p class="toc level3"><a href="devconfig2-8.html#devconfig2-13">How to Disconnect a SCSI Controller</a></p>
<p class="toc level3"><a href="devconfig2-8.html#devconfig2-14">SPARC: How to Connect a SCSI Controller</a></p>
<p class="toc level3"><a href="devconfig2-8.html#devconfig2-15">SPARC: How to Add a SCSI Device to a SCSI Bus</a></p>
<p class="toc level3"><a href="devconfig2-8.html#devconfig2-57">SPARC: How to Replace an Identical Device on a SCSI Controller</a></p>
<p class="toc level3"><a href="devconfig2-8.html#devconfig2-58">SPARC: How to Remove a SCSI Device</a></p>
<p class="toc level3"><a href="devconfig2-8.html#devconfig2-90">How to Resolve a Failed SCSI Unconfigure Operation</a></p>
<p class="toc level2 tocsp"><a href="devconfig2-121.html">PCI or PCIe Hot-Plugging With the <tt>cfgadm</tt> Command (Task Map)</a></p>
<p class="toc level2"><a href="devconfig2-49.html">PCI or PCIe Hot-Plugging With the <tt>cfgadm</tt> Command</a></p>
<p class="toc level3"><a href="devconfig2-49.html#devconfig2-51">How to Display PCI Slot Configuration Information</a></p>
<p class="toc level3"><a href="devconfig2-49.html#devconfig2-54">How to Remove a PCI Adapter Card</a></p>
<p class="toc level3"><a href="devconfig2-49.html#devconfig2-55">How to Add a PCI Adapter Card</a></p>
<p class="toc level2 tocsp"><a href="devconfig2-2.html">Reconfiguration Coordination Manager (RCM) Script Overview</a></p>
<div class="onpage">
<p class="toc level2"><a href="">RCM Script Tasks</a></p>
<p class="toc level3"><a href="#devconfig2-37">How to Install an RCM Script</a></p>
<p class="toc level3"><a href="#devconfig2-42">How to Remove an RCM Script</a></p>
<p class="toc level3"><a href="#devconfig2-43">How to Test an RCM Script</a></p>
</div>
<p class="toc level1 tocsp"><a href="devusbover-24.html">7.&nbsp;&nbsp;Using USB Devices (Overview)</a></p>
<p class="toc level1 tocsp"><a href="devusbtasks-1.html">8.&nbsp;&nbsp;Using USB Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fncpk.html">9.&nbsp;&nbsp;Using InfiniBand Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksconcepts-29477.html">10.&nbsp;&nbsp;Managing Disks (Overview)</a></p>
<p class="toc level1 tocsp"><a href="disksprep-31030.html">11.&nbsp;&nbsp;Administering Disks (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="diskssadd-16103.html">12.&nbsp;&nbsp;SPARC: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksxadd-38159.html">13.&nbsp;&nbsp;x86: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fmvcd.html">14.&nbsp;&nbsp;Configuring Solaris iSCSI Targets and Initiators (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="gfydr.html">15.&nbsp;&nbsp;Configuring and Managing the Solaris Internet Storage Name Service (iSNS)</a></p>
<p class="toc level1 tocsp"><a href="disksformat-15833.html">16.&nbsp;&nbsp;The <tt>format</tt> Utility (Reference)</a></p>
<p class="toc level1 tocsp"><a href="fsoverview-38559.html">17.&nbsp;&nbsp;Managing File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="fscreate-96442.html">18.&nbsp;&nbsp;Creating UFS, TMPFS, and LOFS File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsmount-42780.html">19.&nbsp;&nbsp;Mounting and Unmounting File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fscachefs-70682.html">20.&nbsp;&nbsp;Using The CacheFS File System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsswap-14677.html">21.&nbsp;&nbsp;Configuring Additional Swap Space (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fstroublefsck-61446.html">22.&nbsp;&nbsp;Checking UFS File System Consistency (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsfilesysappx-94408.html">23.&nbsp;&nbsp;UFS File System (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupconcepts-57422.html">24.&nbsp;&nbsp;Backing Up and Restoring File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="bkuptasks2-64128.html">25.&nbsp;&nbsp;Backing Up Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupsnapshot-2.html">26.&nbsp;&nbsp;Using UFS Snapshots (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuprestoretasks-38055.html">27.&nbsp;&nbsp;Restoring Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupref-12756.html">28.&nbsp;&nbsp;UFS Backup and Restore Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupsavefiles-17924.html">29.&nbsp;&nbsp;Copying UFS Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuptapedevice-42512.html">30.&nbsp;&nbsp;Managing Tape Drives (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="devconfig2-19"></a><h3>RCM Script Tasks</h3>
<p>The following sections describe the RCM script tasks for application developers and system
administrators.</p>

<a name="devconfig2-34"></a><h4>Application Developer RCM Script (Task Map)</h4>
<p>The following task map describes the tasks for an application developer who is
creating an RCM script.</p><table><col width="33*"><col width="33*"><col width="33*"><tr><th align="left" valign="top" scope="column"><p>Task</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
<th align="left" valign="top" scope="column"><p>For Instructions</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>1. Identify the resources your application uses.</p></td>
<td align="left" valign="top" scope="row"><p>Identify the
resources (device names) your application uses that you could potentially dynamically remove.</p></td>
<td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2240/cfgadm-1m?a=view"><tt>cfgadm</tt>(1M)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>2. Identify
the commands to release the resource.</p></td>
<td align="left" valign="top" scope="row"><p>Identify the commands for notifying the application
to cleanly release the resource from the application.</p></td>
<td align="left" valign="top" scope="row"><p>Application documentation</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>3. Identify the commands for
post-removal of the resource.</p></td>
<td align="left" valign="top" scope="row"><p>Include the commands for notifying the application of the
resource removal.</p></td>
<td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2251/rcmscript-4?a=view"><tt>rcmscript</tt>(4)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>4. Identify the commands if the resource removal fails.</p></td>
<td align="left" valign="top" scope="row"><p>Include the commands
for notifying the application of the available resource. </p></td>
<td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2251/rcmscript-4?a=view"><tt>rcmscript</tt>(4)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>5. Write the RCM script.</p></td>
<td align="left" valign="top" scope="row"><p>Write
the RCM script based on the information identified in tasks 1-4.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#devconfig2-22">Tape Backup RCM Script Example</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>6. Install
the RCM script.</p></td>
<td align="left" valign="top" scope="row"><p>Add the script to the appropriate script directory.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#devconfig2-37">How to Install an RCM Script</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>7. Test the
RCM script</p></td>
<td align="left" valign="top" scope="row"><p>Test the script by running the script commands manually and by
initiating a dynamic reconfiguration operation.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#devconfig2-43">How to Test an RCM Script</a></p></td>
</tr>
</table>

<a name="devconfig2-35"></a><h4>System Administrator RCM Script (Task Map)</h4>
<p>The following task map describes the tasks for a system administrator who is
creating an RCM script to do site customization.</p><table><col width="33*"><col width="33*"><col width="33*"><tr><th align="left" valign="top" scope="column"><p>Task</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
<th align="left" valign="top" scope="column"><p>For Instructions</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>1. Identify the resources
to be dynamically removed.</p></td>
<td align="left" valign="top" scope="row"><p>Identify the resources (device names) to be potentially removed
by using the <tt>cfgadm</tt> <tt>-l</tt> command.</p></td>
<td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2240/cfgadm-1m?a=view"><tt>cfgadm</tt>(1M)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>2. Identify the applications to be stopped.</p></td>
<td align="left" valign="top" scope="row"><p>Identify the
commands for stopping the applications cleanly.</p></td>
<td align="left" valign="top" scope="row"><p>Application documentation</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>3. Identify the commands for pre-removal
and post-removal of the resource.</p></td>
<td align="left" valign="top" scope="row"><p>Identify the actions to be taken before and
after the resource is removed.</p></td>
<td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2251/rcmscript-4?a=view"><tt>rcmscript</tt>(4)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>4. Write the RCM script.</p></td>
<td align="left" valign="top" scope="row"><p>Write the RCM script
based on the information identified in tasks 1-3.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#devconfig2-22">Tape Backup RCM Script Example</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>5. Install the RCM script.</p></td>
<td align="left" valign="top" scope="row"><p>Add
the script to the appropriate script directory.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#devconfig2-37">How to Install an RCM Script</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>6. Test the RCM script.</p></td>
<td align="left" valign="top" scope="row"><p>Test the
script by running the script commands manually and by initiating a dynamic reconfiguration
operation.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#devconfig2-43">How to Test an RCM Script</a></p></td>
</tr>
</table>

<a name="devconfig2-36"></a><h4>Naming an RCM Script</h4>
<p>A script must be named as <i>vendor</i>,<i>service</i> where the following applies:</p><dl><dt><i>vendor</i></dt>
<dd><p>Is the stock symbol of the vendor that provides the script, or any distinct name that identifies the vendor.</p></dd>
<dt><i>service</i></dt>
<dd><p>Is the name of the service that the script represents.</p></dd>
</dl>


<a name="devconfig2-30"></a><h4>Installing or Removing an RCM Script</h4>
<p>You must be superuser (root) to install or remove an RCM script.
Use this table to determine where you should install your RCM script.</p><a name="devconfig2-tbl-29"></a><h6>Table&nbsp;6-1 RCM Script Directories</h6><table><col width="198*"><col width="198*"><tr><th align="left" valign="top" scope="column"><p>Directory Location</p></th>
<th align="left" valign="top" scope="column"><p>Script
Type</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>/etc/rcm/scripts</tt></p></td>
<td align="left" valign="top" scope="row"><p>Scripts for specific systems</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>/usr/platform/`uname -i`/lib/rcm/scripts</tt></p></td>
<td align="left" valign="top" scope="row"><p>Scripts for a specific hardware implementation</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>/usr/platform/`uname -m`/lib/rcm/scripts</tt></p></td>
<td align="left" valign="top" scope="row"><p>Scripts for a specific
hardware class</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p><tt>/usr/lib/rcm/scripts</tt></p></td>
<td align="left" valign="top" scope="row"><p>Scripts for any hardware</p></td>
</tr>
</table>

<a name="devconfig2-37"></a><h4>How to Install an RCM Script</h4><ol>
<li><a name="devconfig2-step-17"></a><b>Become superuser.</b></li>
<li><a name="devconfig2-step-58"></a><b>Copy the script to the appropriate directory. </b><p>See <a href="#devconfig2-tbl-29">Table&nbsp;6-1</a>.</p><p>For example:</p><pre># <tt><b>cp SUNW,sample.pl /usr/lib/rcm/scripts</b></tt></pre></li>
<li><a name="devconfig2-step-16"></a><b>Change the user ID and the group ID of the script to the
desired values.</b><pre># <tt><b>chown</b></tt> <i>user:group</i> <tt><b>/usr/lib/rcm/scripts/SUNW,sample.pl</b></tt></pre></li>
<li><a name="devconfig2-step-44"></a><b>Send <tt>SIGHUP</tt> to the RCM daemon.</b><pre># <tt><b>pkill -HUP -x -u root rcm_daemon</b></tt></pre></li></ol>

<a name="devconfig2-42"></a><h4>How to Remove an RCM Script</h4><ol>
<li><a name="devconfig2-step-15"></a><b>Become superuser.</b></li>
<li><a name="devconfig2-step-6"></a><b>Remove the script from the RCM script directory.</b><p>For example:</p><pre># <tt><b>rm /usr/lib/rcm/scripts/SUNW,sample.pl</b></tt></pre></li>
<li><a name="devconfig2-step-18"></a><b>Send <tt>SIGHUP</tt> to the RCM daemon.</b><pre># <tt><b>pkill -HUP -x -u root rcm_daemon</b></tt></pre></li></ol>

<a name="devconfig2-43"></a><h4>How to Test an RCM Script</h4><ol>
<li><a name="devconfig2-step-47"></a><b>Set environment variables, such as <tt>RCM_ENV_FORCE</tt>, in the command-line shell before running
your script.</b><p>For example, in the Korn shell, use the following:</p><pre>$ <tt><b>export RCM_ENV_FORCE=TRUE</b></tt></pre></li>
<li><a name="devconfig2-step-59"></a><b>Test the script by running the script commands manually from the command line.</b><p>For example:</p><pre>$ <i>script-name</i> <tt>scriptinfo</tt>
$ <i>script-name</i> <tt>register</tt>
$ <i>script-name</i> <tt>preremove</tt> <i>resource-name</i>
$ <i>script-name</i> <tt>postremove</tt> <i>resource-name</i></pre></li>
<li><a name="devconfig2-step-19"></a><b>Make sure that each RCM script command in your script prints appropriate output
to <tt>stdout</tt>.</b></li>
<li><a name="devconfig2-step-48"></a><b>Install the script in the appropriate script directory.</b><p>For more information, see <a href="#devconfig2-37">How to Install an RCM Script</a>.</p></li>
<li><a name="devconfig2-step-49"></a><b>Test the script by initiating a dynamic remove operation.</b><p>For example, assume your script registers the device, <tt>/dev/dsk/c1t0d0s0</tt>. Try these commands.</p><pre>$ <tt><b>cfgadm -c unconfigure c1::dsk/c1t0d0</b></tt>
$ <tt><b>cfgadm -f -c unconfigure c1::dsk/c1t0d0</b></tt>
$ <tt><b>cfgadm -c configure c1::dsk/c1t0d0</b></tt></pre>
<hr><p><b>Caution - </b>Make sure that you are familiar with these commands because they can alter
the state of the system and cause system failures.</p>
<hr>
</li></ol>

<a name="devconfig2-22"></a><h4>Tape Backup RCM Script Example</h4>
<p>This example illustrates how to use an RCM script for tape backups.</p>

<a name="devconfig2-23"></a><h5>What the Tape Backup RCM Script Does</h5>
<p>The tape backup RCM script performs the following steps:</p>
<ol><li><p>Sets up a dispatch table of RCM commands.</p></li>
<li><p>Calls the dispatch routine that corresponds to the specified RCM command and exits with status 2 for unimplemented RCM commands.</p></li>
<li><p>Sets up the <tt>scriptinfo</tt> section.</p><pre>rcm_script_func_info=Tape backup appl script for DR</pre></li>
<li><p>Registers all tape drives in the system by printing all tape drive device names to <tt>stdout</tt>.</p><pre>rcm_resource_name=/dev/rmt/$f</pre><p>If an error occurs, the script prints the error information to <tt>stdout</tt>.</p><pre>rcm_failure_reason=$errmsg</pre></li>
<li><p>Sets up the resource information for the tape device. </p><pre>rcm_resource_usage_info=Backup Tape Unit Number $unit</pre></li>
<li><p>Sets up the <tt>preremove</tt> information by checking if the backup application is using the device. If the backup application is not using the device, the dynamic reconfiguration operation continues. If the backup application is using the device, the script checks <tt>RCM_ENV_FORCE</tt>. If <tt>RCM_ENV_FORCE</tt> is set to <tt>FALSE</tt>, the script denies the dynamic reconfiguration operation and prints the following message:</p><pre>rcm_failure_reason=tape backup in progress pid=...</pre><p>If <tt>RCM_ENV_FORCE</tt> is set to <tt>TRUE</tt>, the backup application is stopped, and the reconfiguration operation proceeds.</p></li></ol>


<a name="devconfig2-24"></a><h5>Outcomes of the Tape Backup Reconfiguration Scenarios</h5>
<p>Here are the various outcomes if you use the <tt>cfgadm</tt> command to remove
a tape device without the RCM script.</p>
<ul><li><p>If you use the <tt>cfgadm</tt> command and the backup application is not using the tape device, the operation succeeds.</p></li>
<li><p>If you use the <tt>cfgadm</tt> command and the backup application is using the tape device, the operation fails.</p></li></ul>
<p>Here are the various outcomes if you use the <tt>cfgadm</tt> command to remove
a tape device with the RCM script.</p>
<ul><li><p>If you use the <tt>cfgadm</tt> command and the backup application is not using the tape device, the operation succeeds.</p></li>
<li><p>If you use the <tt>cfgadm</tt> command without the <tt>-f</tt> option and the backup application is using the tape device, the operation fails with an error message similar to the following:</p><pre>tape backup in progress pid=...</pre></li>
<li><p>If you use the <tt>cfgadm</tt> <tt>-f</tt> command and the backup application is using the tape device, the script stops the backup application and the <tt>cfgadm</tt> operation succeeds.</p></li></ul>


<a name="devconfig2-28"></a><h5>Example&mdash;Tape Backup RCM Script</h5>
<pre>#! /usr/bin/perl -w
   #
   # A sample site customization RCM script.
   #
   # When RCM_ENV_FORCE is FALSE this script indicates to RCM that it cannot
   # release the tape drive when the tape drive is being used for backup.
   #
   # When RCM_ENV_FORCE is TRUE this script allows DR removing a tape drive
   # when the tape drive is being used for backup by killing the tape
   # backup application.
   #
    
    use strict;
    
    my ($cmd, %dispatch);
    $cmd = shift(@ARGV);
# dispatch table for RCM commands
    %dispatch = (
            "scriptinfo"    =>      \&amp;do_scriptinfo,
            "register"      =>      \&amp;do_register,
            "resourceinfo"  =>      \&amp;do_resourceinfo,
            "queryremove"   =>      \&amp;do_preremove,
            "preremove"     =>      \&amp;do_preremove
    );
    
    
    if (defined($dispatch{$cmd})) {
            &amp;{$dispatch{$cmd}};
    } else {
            exit (2);
    }
    
    sub do_scriptinfo
    {
            print "rcm_script_version=1\n";
            print "rcm_script_func_info=Tape backup appl script for DR\n";
            exit (0);
    }
    
    sub do_register
{
            my ($dir, $f, $errmsg);
    
            $dir = opendir(RMT, "/dev/rmt");
            if (!$dir) {
                 $errmsg = "Unable to open /dev/rmt directory: $!";
                 print "rcm_failure_reason=$errmsg\n";
                 exit (1);
            }
    
            while ($f = readdir(RMT)) {
                # ignore hidden files and multiple names for the same device
                if (($f !~ /^\./) &amp;&amp; ($f =~ /^[0-9]+$/)) {
                        print "rcm_resource_name=/dev/rmt/$f\n";
                    }
                    
            }
    
            closedir(RMT);
            exit (0);
    }
sub do_resourceinfo
    {
      my ($rsrc, $unit);
    
      $rsrc = shift(@ARGV);
      if ($rsrc =~ /^\/dev\/rmt\/([0-9]+)$/) {
           $unit = $1;
           print "rcm_resource_usage_info=Backup Tape Unit Number $unit\n";
           exit (0);
       } else {
           print "rcm_failure_reason=Unknown tape device!\n";
            exit (1);
        }
    }
    
    sub do_preremove
    {
            my ($rsrc);
    
            $rsrc = shift(@ARGV);
    
            # check if backup application is using this resource
            #if (the backup application is not running on $rsrc) {
                    # allow the DR to continue
            #        exit (0);
            #}
            #
            # If RCM_ENV_FORCE is FALSE deny the operation.
            # If RCM_ENV_FORCE is TRUE kill the backup application in order
            # to allow the DR operation to proceed
            #
            if ($ENV{RCM_ENV_FORCE} eq 'TRUE') {
                 if ($cmd eq 'preremove') {
                         # kill the tape backup application
                 }
                 exit (0);
            } else {
               #
               # indicate that the tape drive can not be released
               # since the device is being used for backup by the
               # tape backup application
               #
               print "rcm_failure_reason=tape backup in progress pid=...\n"
;
               exit (3);
            }
    }</pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="devconfig2-2.html">Previous</a>
             </td>
             <td align="right">
                 <a href="devusbover-24.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

