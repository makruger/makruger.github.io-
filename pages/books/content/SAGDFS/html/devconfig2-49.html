<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>PCI or PCIe Hot-Plugging With the <tt>cfgadm</tt> Command - System Administration Guide: Devices and File Systems</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Devices and File Systems</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="devconfig2-121.html">Previous</a>
             </td>
             <td align="right">
                 <a href="devconfig2-2.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol1preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="medintro-55492.html">1.&nbsp;&nbsp;Managing Removable Media (Overview)</a></p>
<p class="toc level1 tocsp"><a href="medformat-83002.html">2.&nbsp;&nbsp;Managing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medaccess-29267.html">3.&nbsp;&nbsp;Accessing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medcdrw-1.html">4.&nbsp;&nbsp;Writing CDs and DVDs (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig-27900.html">5.&nbsp;&nbsp;Managing Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig2-1.html">6.&nbsp;&nbsp;Dynamically Configuring Devices (Tasks)</a></p>
<p class="toc level2"><a href="devconfig2-6.html">Dynamic Reconfiguration and Hot-Plugging</a></p>
<p class="toc level2"><a href="devconfig2-120.html">SCSI Hot-Plugging With the <tt>cfgadm</tt> Command (Task Map)</a></p>
<p class="toc level2"><a href="devconfig2-8.html">SCSI Hot-Plugging With the <tt>cfgadm</tt> Command</a></p>
<p class="toc level3"><a href="devconfig2-8.html#devconfig2-9">How to Display Information About SCSI Devices</a></p>
<p class="toc level3"><a href="devconfig2-8.html#devconfig2-10">How to Unconfigure a SCSI Controller</a></p>
<p class="toc level3"><a href="devconfig2-8.html#devconfig2-11">How to Configure a SCSI Controller</a></p>
<p class="toc level3"><a href="devconfig2-8.html#devconfig2-12">How to Configure a SCSI Device</a></p>
<p class="toc level3"><a href="devconfig2-8.html#devconfig2-13">How to Disconnect a SCSI Controller</a></p>
<p class="toc level3"><a href="devconfig2-8.html#devconfig2-14">SPARC: How to Connect a SCSI Controller</a></p>
<p class="toc level3"><a href="devconfig2-8.html#devconfig2-15">SPARC: How to Add a SCSI Device to a SCSI Bus</a></p>
<p class="toc level3"><a href="devconfig2-8.html#devconfig2-57">SPARC: How to Replace an Identical Device on a SCSI Controller</a></p>
<p class="toc level3"><a href="devconfig2-8.html#devconfig2-58">SPARC: How to Remove a SCSI Device</a></p>
<p class="toc level3"><a href="devconfig2-8.html#devconfig2-90">How to Resolve a Failed SCSI Unconfigure Operation</a></p>
<p class="toc level2 tocsp"><a href="devconfig2-121.html">PCI or PCIe Hot-Plugging With the <tt>cfgadm</tt> Command (Task Map)</a></p>
<div class="onpage">
<p class="toc level2"><a href="">PCI or PCIe Hot-Plugging With the <tt>cfgadm</tt> Command</a></p>
<p class="toc level3"><a href="#devconfig2-51">How to Display PCI Slot Configuration Information</a></p>
<p class="toc level3"><a href="#devconfig2-54">How to Remove a PCI Adapter Card</a></p>
<p class="toc level3"><a href="#devconfig2-55">How to Add a PCI Adapter Card</a></p>
</div>
<p class="toc level2 tocsp"><a href="devconfig2-2.html">Reconfiguration Coordination Manager (RCM) Script Overview</a></p>
<p class="toc level2"><a href="devconfig2-19.html">RCM Script Tasks</a></p>
<p class="toc level3"><a href="devconfig2-19.html#devconfig2-37">How to Install an RCM Script</a></p>
<p class="toc level3"><a href="devconfig2-19.html#devconfig2-42">How to Remove an RCM Script</a></p>
<p class="toc level3"><a href="devconfig2-19.html#devconfig2-43">How to Test an RCM Script</a></p>
<p class="toc level1 tocsp"><a href="devusbover-24.html">7.&nbsp;&nbsp;Using USB Devices (Overview)</a></p>
<p class="toc level1 tocsp"><a href="devusbtasks-1.html">8.&nbsp;&nbsp;Using USB Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fncpk.html">9.&nbsp;&nbsp;Using InfiniBand Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksconcepts-29477.html">10.&nbsp;&nbsp;Managing Disks (Overview)</a></p>
<p class="toc level1 tocsp"><a href="disksprep-31030.html">11.&nbsp;&nbsp;Administering Disks (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="diskssadd-16103.html">12.&nbsp;&nbsp;SPARC: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksxadd-38159.html">13.&nbsp;&nbsp;x86: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fmvcd.html">14.&nbsp;&nbsp;Configuring Solaris iSCSI Targets and Initiators (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="gfydr.html">15.&nbsp;&nbsp;Configuring and Managing the Solaris Internet Storage Name Service (iSNS)</a></p>
<p class="toc level1 tocsp"><a href="disksformat-15833.html">16.&nbsp;&nbsp;The <tt>format</tt> Utility (Reference)</a></p>
<p class="toc level1 tocsp"><a href="fsoverview-38559.html">17.&nbsp;&nbsp;Managing File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="fscreate-96442.html">18.&nbsp;&nbsp;Creating UFS, TMPFS, and LOFS File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsmount-42780.html">19.&nbsp;&nbsp;Mounting and Unmounting File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fscachefs-70682.html">20.&nbsp;&nbsp;Using The CacheFS File System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsswap-14677.html">21.&nbsp;&nbsp;Configuring Additional Swap Space (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fstroublefsck-61446.html">22.&nbsp;&nbsp;Checking UFS File System Consistency (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsfilesysappx-94408.html">23.&nbsp;&nbsp;UFS File System (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupconcepts-57422.html">24.&nbsp;&nbsp;Backing Up and Restoring File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="bkuptasks2-64128.html">25.&nbsp;&nbsp;Backing Up Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupsnapshot-2.html">26.&nbsp;&nbsp;Using UFS Snapshots (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuprestoretasks-38055.html">27.&nbsp;&nbsp;Restoring Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupref-12756.html">28.&nbsp;&nbsp;UFS Backup and Restore Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupsavefiles-17924.html">29.&nbsp;&nbsp;Copying UFS Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuptapedevice-42512.html">30.&nbsp;&nbsp;Managing Tape Drives (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="devconfig2-49"></a><h3>PCI or PCIe Hot-Plugging With the <tt>cfgadm</tt> Command</h3>
<p>This section provides step-by-step instructions for hot-plugging PCI or PCIe adapter cards on
SPARC and x86 systems.</p><p>In addition to the <tt>cfgadm</tt> command, the <tt>prtconf</tt> command is helpful during hot-plug
operations. The <tt>prtconf</tt> command displays additional configuration information that pertains to the hardware.
</p><p>After adding hardware, you can use the <tt>prtconf</tt> command to verify that the
hardware is configured correctly. For example, after a configure operation, use the <tt>prtconf</tt>
<tt>-D</tt> command  to verify that the driver is attached to the newly
installed hardware device. If the device driver has not been added to the
system prior to hardware configuration, it may be manually added by using the
<tt>add_drv</tt> command.</p><p>For more information, see <a href="http://docs.sun.com/doc/819-2240/prtconf-1m?a=view"><tt>prtconf</tt>(1M)</a> and <a href="http://docs.sun.com/doc/819-2240/add-drv-1m?a=view"><tt>add_drv</tt>(1M)</a>.</p><p><a name="indexterm-92"></a>In the examples, only PCI attachment points are listed, for brevity. The attachment
points that are displayed on your system depend on your system configuration.</p>

<a name="gbsdb"></a><h4>PCIe Led Indicator Behavior</h4>
<p>You might observe the LED indicators on the system to get a
visual indication about the status of the slot's hot-plug operation. The LED behavior,
in case of PCI Express, matches that defined in the PCI Express specification
or the behavior might otherwise be platform dependent.</p><p>Please refer to your platform guide for specific details. In case of PCI
Express, when the Attention Button is pressed, the power indicator blinks, which indicates
the beginning of a state transition. The blinking ends when the state transition
has ended.</p>

<a name="devconfig2-51"></a><h4>How to Display PCI Slot Configuration Information</h4><p>This procedure has been updated to include PCIe configuration information.</p><p>The <tt>cfgadm</tt> command displays the status of PCI hot-pluggable devices and slots on
a system. For more information, see <a href="http://docs.sun.com/doc/819-2240/cfgadm-1m?a=view"><tt>cfgadm</tt>(1M)</a>.</p><ol>
<li><a name="devconfig2-step-69"></a><b>Become superuser.</b></li>
<li><a name="devconfig2-step-56"></a><b>Display PCI configuration information.<a name="indexterm-93"></a><a name="indexterm-94"></a></b>
<ul><li><p>Display PCI slot configuration information.</p><p>For example:</p><pre># <tt><b>cfgadm</b></tt>
Ap_Id                Type         Receptacle   Occupant     Condition
pci1:hpc0_slot0      unknown      empty        unconfigured unknown
pci1:hpc0_slot1      unknown      empty        unconfigured unknown
pci1:hpc0_slot2      unknown      empty        unconfigured unknown
pci1:hpc0_slot3      ethernet/hp  connected    configured   ok
pci1:hpc0_slot4      unknown      empty        unconfigured unknown</pre></li>
<li><p>Display specific PCI device information.</p><p>For example:</p><pre># <tt><b>cfgadm -s "cols=ap_id:type:info" pci</b></tt>
Ap_Id                Type         Information
pci1:hpc0_slot0      unknown      Slot 7
pci1:hpc0_slot1      unknown      Slot 8
pci1:hpc0_slot2      unknown      Slot 9
pci1:hpc0_slot3      ethernet/hp  Slot 10
pci1:hpc0_slot4      unknown      Slot 11</pre><p>The logical <tt>Ap_Id</tt>, <tt>pci1:hpc0_slot0</tt>, is the logical <tt>Ap_Id</tt> for hot-pluggable slot, <tt>Slot 7</tt>. The component <tt>hpc0</tt> indicates the hot-pluggable adapter card for this slot, and <tt>pci1</tt> indicates the PCI bus instance. The <tt>Type</tt> field indicates the type of PCI adapter card that is present in the slot.</p></li>
<li><p>Display PCIe slot configuration information.</p><p>For example:</p><pre># <tt><b>cfgadm pci</b></tt>
Ap_Id                          Type         Receptacle   Occupant     Condition
pcie1                          unknown      empty        unconfigured unknown
pcie2                          unknown      empty        unconfigured unknown
pcie3                          unknown      empty        unconfigured unknown
pcie4                          etherne/hp   connected    configured   ok
pcie5                          pci-pci/hp   connected    configured   ok
pcie6                          unknown      disconnected unconfigured unknown</pre></li>
<li><p>Display specific PCIe device information.</p><p>For example:</p><pre># <tt><b>cfgadm -s "cols=ap_id:busy:o_state" pci</b></tt>
Ap_Id                          Busy     Occupant
pcie1                          n        unconfigured
pcie2                          n        unconfigured
pcie3                          n        unconfigured
pcie4                          n        configured
pcie5                          n        configured
pcie6                          n        configured</pre>
<hr><p><b>Note - </b>The logical <tt>Ap_Id</tt> in most cases should match the slot label that is silk-screened on the system chassis. Refer to your platform guide for the <tt>cfgadm</tt> output of the hot-pluggable slots. The <tt>Busy</tt> field can be displayed to ensure that the <tt>Ap_Id</tt> is not transitioning to another state before a hot-plug operation is attempted.</p>
<hr>
</li></ul>
</li></ol>

<a name="devconfig2-54"></a><h4>How to Remove a PCI Adapter Card</h4><p>The following procedure has been updated for removing a PCIe adapter card. However,
the procedure to remove an adapter card is the same whether you are
using PCI or PCIe.</p><ol>
<li><a name="devconfig2-step-71"></a><b>Become superuser.</b></li>
<li><a name="devconfig2-step-72"></a><b>Determine which slot the PCI adapter card is in.</b><p>For example:</p><pre># <tt><b>cfgadm pci</b></tt>
Ap_Id                          Type         Receptacle   Occupant     Condition
pcie1                          unknown      empty        unconfigured unknown
pcie2                          unknown      empty        unconfigured unknown
pcie3                          unknown      empty        unconfigured unknown
pcie4                          etherne/hp   connected    configured   ok
pcie5                          pci-pci/hp   connected    configured   ok
pcie6                          unknown      disconnected unconfigured unknown</pre></li>
<li><a name="devconfig2-step-73"></a><b>Stop the application that has the device open. </b><p><a name="indexterm-95"></a><a name="indexterm-96"></a><a name="indexterm-97"></a>For example, if the device is an Ethernet card, use the <tt>ifconfig</tt>
command to bring down the interface and unplumb the interface. </p></li>
<li><a name="devconfig2-step-74"></a><b>Unconfigure the device manually by using the cfgadm(1M) command as shown below. Or,
if you have a PCIe adapter card, use the auto-configuration method, such as
pressing the slot's   Attention Button as defined by your platform guide.</b><pre># <tt><b>cfgadm -c unconfigure pcie4</b></tt></pre></li>
<li><a name="devconfig2-step-75"></a><b>Confirm that the device has been unconfigured.</b><p>For example:</p><pre># cfgadm pci
Ap_Id                          Type         Receptacle   Occupant     Condition
pcie1                          unknown      empty        unconfigured unknown
pcie2                          unknown      empty        unconfigured unknown
pcie3                          unknown      empty        unconfigured unknown
pcie4                          unknown      connected    unconfigured unknown
pcie5                          pci-pci/hp   connected    configured   ok
pcie6                          unknown      disconnected unconfigured unknown</pre>
<hr><p><b>Note - </b>The <tt>Type</tt> and <tt>Condition</tt> also become unknown when the device is unconfigured.</p>
<hr>
</li>
<li><a name="devconfig2-step-76"></a><b>Disconnect the power to the slot manually. If the auto-configuration method is used,
this step is not necessary. Refer to your platform guide for more information.</b><pre># <tt><b>cfgadm -c disconnect pcie4</b></tt></pre></li>
<li><a name="devconfig2-step-77"></a><b>Confirm that the device has been disconnected.</b><p>For example:</p><pre># <tt><b>cfgadm pci</b></tt>
Ap_Id                          Type         Receptacle   Occupant     Condition
pcie1                          unknown      empty        unconfigured unknown
pcie2                          unknown      empty        unconfigured unknown
pcie3                          unknown      empty        unconfigured unknown
pcie4                          unknown      disconnected unconfigured unknown
pcie5                          pci-pci/hp   connected    configured   ok
pcie6                          unknown      disconnected unconfigured unknown </pre></li>
<li><a name="devconfig2-step-78"></a><b>Follow appropriate instructions in your platform guide to remove the PCI adapter card.
After the card is removed, the Receptacle state is empty.</b><p>For example:</p><pre># <tt><b>cfgadm pci</b></tt>
Ap_Id                          Type         Receptacle   Occupant     Condition
pcie1                          unknown      empty        unconfigured unknown
pcie2                          unknown      empty        unconfigured unknown
pcie3                          unknown      empty        unconfigured unknown
pcie4                          unknown      empty        unconfigured unknown
pcie5                          pci-pci/hp   connected    configured   ok
pcie6                          unknown      disconnected unconfigured unknown</pre>
<hr><p><b>Note - </b>The auto-configuration method can be enabled or disabled at boot, depending on the
platform implementation. Set the auto-configuration method as appropriate for your environment.</p>
<hr>
</li></ol>

<a name="devconfig2-55"></a><h4>How to Add a PCI Adapter Card</h4><p>The following procedure has been updated for adding a PCIe adapter card. However,
the procedure to add an adapter card is the same whether you
are using PCI or PCIe.</p><ol>
<li><a name="devconfig2-step-80"></a><b>Become superuser.</b></li>
<li><a name="devconfig2-step-81"></a><b><a name="indexterm-98"></a><a name="indexterm-99"></a><a name="indexterm-100"></a>Identify the hot-pluggable slot and open latches.</b><p>For example, pcie3.</p><pre># <tt><b>cfgadm pci</b></tt>
Ap_Id                          Type         Receptacle   Occupant     Condition
pcie1                          unknown      empty        unconfigured unknown
pcie2                          unknown      empty        unconfigured unknown
pcie3                          unknown      empty        unconfigured unknown
pcie4                          unknown      empty        unconfigured unknown
pcie5                          pci-pci/hp   connected    configured   ok
pcie6                          unknown      disconnected unconfigured unknown </pre></li>
<li><a name="devconfig2-step-82"></a><b>Follow the appropriate instructions in your platform guide to insert a PCI adapter
card into the slot.</b></li>
<li><a name="devconfig2-step-83"></a><b>Determine which slot the PCI adapter card is in after it is inserted.</b><p>For example:</p><pre># <tt><b>cfgadm pci</b></tt>
Ap_Id                          Type         Receptacle   Occupant     Condition
pcie1                          unknown      empty        unconfigured unknown
pcie2                          unknown      empty        unconfigured unknown
pcie3                          unknown      disconnected unconfigured unknown
pcie4                          unknown      empty        unconfigured unknown
pcie5                          pci-pci/hp   connected    configured   ok
pcie6                          unknown      disconnected unconfigured unknown </pre></li>
<li><a name="devconfig2-step-84"></a><b>Connect the power to the slot manually using the <tt>cfgadm</tt> command. Or, if
you have a PCIe adapter card, use the auto-configuration method, such as pressing
the slot's Attention Button as defined by your platform guide.</b><p>For example:</p><pre># <tt><b>cfgadm -c connect pcie3</b></tt></pre></li>
<li><a name="devconfig2-step-85"></a><b>Confirm that the attachment point is connected.</b><p>For example:</p><pre># <tt><b>cfgadm pci</b></tt>
Ap_Id                          Type         Receptacle   Occupant     Condition
pcie1                          unknown      empty        unconfigured unknown
pcie2                          unknown      empty        unconfigured unknown
pcie3                          unknown      connected    unconfigured unknown
pcie4                          unknown      empty        unconfigured unknown
pcie5                          pci-pci/hp   connected    configured   ok
pcie6                          unknown      disconnected unconfigured unknown</pre></li>
<li><a name="devconfig2-step-86"></a><b>Configure the PCI adapter card manually by using the <tt>cfgadm</tt> command as shown
below. If using the auto-configuration method, this step should not be necessary. Refer
to your platform guide for more information.</b><p>For example:</p><pre># <tt><b>cfgadm -c configure pcie3</b></tt></pre></li>
<li><a name="devconfig2-step-87"></a><b>Verify the configuration of the PCI adapter card in the slot.</b><p>For example:</p><pre># <tt><b>cfgadm pci</b></tt>
Ap_Id                          Type         Receptacle   Occupant     Condition
pcie1                          unknown      empty        unconfigured unknown
pcie2                          unknown      empty        unconfigured unknown
pcie3                          etherne/hp   connected    configured unknown
pcie5                          pci-pci/hp   connected    configured   ok
pcie6                          unknown      disconnected unconfigured unknown</pre></li>
<li><a name="devconfig2-step-88"></a><b>Configure any supporting software if this device is a new device.</b><p>For example, if this device is an Ethernet card, use the <tt>ifconfig</tt> command
to set up the interface.</p>
<hr><p><b>Note - </b>The auto-configuration method can be enabled or disabled at boot, depending on the
platform implementation. Set the auto-configuration method as appropriate for your environment.</p>
<hr>
</li></ol>

<a name="devconfig2-56"></a><h4>Troubleshooting PCI Configuration Problems</h4>
<dl><dt>Error Message</dt>
<dd><pre>cfgadm: Configuration operation invalid: invalid transition</pre></dd>
<dt>Cause</dt>
<dd><p>An invalid transition was attempted.</p></dd>
<dt>Solution</dt>
<dd><p>Check whether the <tt>cfgadm -c</tt> command was issued appropriately. Use the <tt>cfgadm</tt> command to check the current receptacle and occupant state and to make sure that the <tt>Ap_Id</tt> is correct.</p></dd>
</dl>
<dl><dt>Error Message</dt>
<dd><pre>cfgadm: Attachment point not found</pre></dd>
<dt>Cause</dt>
<dd><p>The specified attachment point was not found.</p></dd>
<dt>Solution</dt>
<dd><p>Check whether the attachment point is correct. Use the <tt>cfgadm</tt> command to display a list of available attachment points. Also check the physical path to see if the attachment point is still there.<a name="indexterm-101"></a><a name="indexterm-102"></a></p></dd>
</dl>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="devconfig2-121.html">Previous</a>
             </td>
             <td align="right">
                 <a href="devconfig2-2.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

