<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Creating a UFS File System - System Administration Guide: Devices and File Systems</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Devices and File Systems</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="fscreate-96442.html">Previous</a>
             </td>
             <td align="right">
                 <a href="fscreate-99040.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol1preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="medintro-55492.html">1.&nbsp;&nbsp;Managing Removable Media (Overview)</a></p>
<p class="toc level1 tocsp"><a href="medformat-83002.html">2.&nbsp;&nbsp;Managing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medaccess-29267.html">3.&nbsp;&nbsp;Accessing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medcdrw-1.html">4.&nbsp;&nbsp;Writing CDs and DVDs (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig-27900.html">5.&nbsp;&nbsp;Managing Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig2-1.html">6.&nbsp;&nbsp;Dynamically Configuring Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devusbover-24.html">7.&nbsp;&nbsp;Using USB Devices (Overview)</a></p>
<p class="toc level1 tocsp"><a href="devusbtasks-1.html">8.&nbsp;&nbsp;Using USB Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fncpk.html">9.&nbsp;&nbsp;Using InfiniBand Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksconcepts-29477.html">10.&nbsp;&nbsp;Managing Disks (Overview)</a></p>
<p class="toc level1 tocsp"><a href="disksprep-31030.html">11.&nbsp;&nbsp;Administering Disks (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="diskssadd-16103.html">12.&nbsp;&nbsp;SPARC: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksxadd-38159.html">13.&nbsp;&nbsp;x86: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fmvcd.html">14.&nbsp;&nbsp;Configuring Solaris iSCSI Targets and Initiators (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="gfydr.html">15.&nbsp;&nbsp;Configuring and Managing the Solaris Internet Storage Name Service (iSNS)</a></p>
<p class="toc level1 tocsp"><a href="disksformat-15833.html">16.&nbsp;&nbsp;The <tt>format</tt> Utility (Reference)</a></p>
<p class="toc level1 tocsp"><a href="fsoverview-38559.html">17.&nbsp;&nbsp;Managing File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="fscreate-96442.html">18.&nbsp;&nbsp;Creating UFS, TMPFS, and LOFS File Systems (Tasks)</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Creating a UFS File System</a></p>
<p class="toc level3"><a href="#fscreate-22821">How to Create a UFS File System</a></p>
<p class="toc level3"><a href="#fsoverview-14">How to Create a Multiterabyte UFS File System</a></p>
<p class="toc level3"><a href="#fsoverview-17">How to Expand a Multiterabyte UFS File System</a></p>
<p class="toc level3"><a href="#fsoverview-13">How to Expand a UFS File System to a Multiterabyte UFS File System</a></p>
</div>
<p class="toc level2 tocsp"><a href="fscreate-99040.html">Creating a Temporary File System (TMPFS)</a></p>
<p class="toc level3"><a href="fscreate-99040.html#fscreate-34114">How to Create and Mount a TMPFS File System</a></p>
<p class="toc level2 tocsp"><a href="fscreate-86793.html">Creating and Mounting a Loopback File System (LOFS)</a></p>
<p class="toc level3"><a href="fscreate-86793.html#fscreate-25028">How to Create and Mount an LOFS File System</a></p>
<p class="toc level1 tocsp"><a href="fsmount-42780.html">19.&nbsp;&nbsp;Mounting and Unmounting File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fscachefs-70682.html">20.&nbsp;&nbsp;Using The CacheFS File System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsswap-14677.html">21.&nbsp;&nbsp;Configuring Additional Swap Space (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fstroublefsck-61446.html">22.&nbsp;&nbsp;Checking UFS File System Consistency (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsfilesysappx-94408.html">23.&nbsp;&nbsp;UFS File System (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupconcepts-57422.html">24.&nbsp;&nbsp;Backing Up and Restoring File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="bkuptasks2-64128.html">25.&nbsp;&nbsp;Backing Up Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupsnapshot-2.html">26.&nbsp;&nbsp;Using UFS Snapshots (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuprestoretasks-38055.html">27.&nbsp;&nbsp;Restoring Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupref-12756.html">28.&nbsp;&nbsp;UFS Backup and Restore Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupsavefiles-17924.html">29.&nbsp;&nbsp;Copying UFS Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuptapedevice-42512.html">30.&nbsp;&nbsp;Managing Tape Drives (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="fscreate-1"></a><h3>Creating a UFS File System</h3>
<p>Before you can create a UFS file system on a disk, the
disk must be formatted and divided into slices. A <b>disk slice</b> is a physical subset
of a disk that is composed of a single range of contiguous blocks.
A slice can be used either as a raw device that provides,
for example, swap space, or to hold a disk-based file system. See <a href="disksconcepts-29477.html">Chapter&nbsp;10, Managing Disks (Overview)</a>
for complete information on formatting disks and dividing disks into slices.</p><p>Disk and storage management products, such as Solaris<sup>TM</sup> Volume Manager, create more sophisticated
<b>volumes</b>. Volumes expand beyond single-slice or single-disk boundaries. For more information about using volumes,
see <a href="http://docs.sun.com/doc/819-2789"><i>Solaris Volume Manager Administration Guide</i></a>.</p>
<hr><p><b>Note - </b>Solaris device names use the term slice (and the letter <tt>s</tt> in the
device name) to refer to the slice number. Slices are also called
<b>partitions</b>.</p>
<hr>
<p>You need to create UFS file systems only occasionally, because the Solaris
OS automatically creates them as part of the installation process. You need to
create (or re-create) a UFS file system when you want to do the
following: </p>
<ul><li><p>Add or replace disks</p></li>
<li><p>Change the existing partitioning structure of a disk</p></li>
<li><p>Fully restore of a file system</p></li></ul>
<p><a name="fscreate-ix2771"></a><a name="fscreate-ix2772"></a><a name="fscreate-ix2773"></a>The <tt>newfs</tt> command is the standard way to create UFS file systems. The
<tt>newfs</tt> command is a convenient front end to the <tt>mkfs</tt> command, which actually
creates the new file system. The <tt>newfs</tt> command reads parameter defaults, such as tracks
per cylinder and sectors per track, from the label for the disk that
will contain the new file system. The options you choose are passed to
the <tt>mkfs</tt> command to build the file system.</p><p>For information about the default parameters that are used by the <tt>newfs</tt>
command, see <a href="http://docs.sun.com/doc/819-2240/newfs-1m?a=view"><tt>newfs</tt>(1M)</a>.</p>

<a name="fscreate-22821"></a><h4>How to Create a UFS File System</h4><h6>Before You Begin</h6><p>Ensure that you have met the following prerequisites:</p>
<ul><li><p>The disk must be formatted and divided into slices.</p></li>
<li><p>If you are re-creating an existing UFS file system, unmount it.</p></li>
<li><p>You need to know the device name of the slice that will contain the file system.</p></li></ul>
<p>For information on finding disks and disk slice numbers, see <a href="disksprep-31030.html">Chapter&nbsp;11, Administering Disks (Tasks)</a>.</p><p>For information on formatting disks and dividing disks into slices, see <a href="disksconcepts-29477.html">Chapter&nbsp;10, Managing Disks (Overview)</a>.</p><ol>
<li><a name="fscreate-step-4"></a><b>You must be superuser or assume an equivalent role.</b></li>
<li><a name="fscreate-step-5"></a><b>Create the UFS file system.</b><pre># <tt><b>newfs</b></tt> [<tt><b>-N</b></tt>] [<tt><b>-b</b></tt> <i>size</i>] [<tt><b>-i</b></tt> <i>bytes</i>] <tt><b>/dev/rdsk/</b></tt><i>device-name</i></pre><dl><dt><tt>-N</tt></dt>
<dd><p>Displays what parameters the <tt>newfs</tt> command would pass to the <tt>mkfs</tt> command without actually creating the file system. This option is a good way to test the <tt>newfs</tt> command.</p></dd>
<dt><tt>-b</tt> <i>size</i></dt>
<dd><p>Specifies the block size for the file system, either 4096 or 8192 bytes per block. The default is 8192.</p></dd>
<dt><tt>-i</tt> <i>bytes</i></dt>
<dd><p>Specifies the number of bytes per inode. The default varies depending on the disk size. For more information, see <a href="http://docs.sun.com/doc/819-2240/newfs-1m?a=view"><tt>newfs</tt>(1M)</a>.</p></dd>
<dt><i>device-name</i></dt>
<dd><p>Specifies the disk device name on which to create the new file system.</p></dd>
</dl>
<p>The system asks for confirmation.</p>
<hr><p><b>Caution - </b>Be sure you have specified the correct device name for the slice before
performing this step. If you specify the wrong slice, you will erase its
contents when the new file system is created. This error might cause the
system to panic.</p>
<hr>
</li>
<li><a name="fscreate-step-20"></a><b>To verify the creation of the UFS file system, check the new file
system. </b><pre># <tt><b>fsck /dev/rdsk/</b></tt><i>device-name</i></pre><p>where <i>device-name</i> argument specifies the name of the disk device that contains the
new file system.</p><p>The <tt>fsck</tt> command checks the consistency of the new file system, reports any
problems, and prompts you before it repairs the problems. For more information on
the <tt>fsck</tt> command, see <a href="fstroublefsck-61446.html">Chapter&nbsp;22, Checking UFS File System Consistency (Tasks)</a> or <a href="http://docs.sun.com/doc/819-2240/fsck-1m?a=view"><tt>fsck</tt>(1M)</a>.</p></li></ol><a name="fncqs"></a>Example&nbsp;18-1 Creating a UFS File System<p>The following example shows how to create a UFS file system on
<tt>/dev/rdsk/c0t1d0s7</tt>.</p><pre># <tt><b>newfs /dev/rdsk/c0t1d0s7</b></tt>
/dev/rdsk/c0t1d0s7:  725760 sectors in 720 cylinders of 14 tracks, 72 sectors
        354.4MB in 45 cyl groups (16 c/g, 7.88MB/g, 3776 i/g)
super-block backups (for fsck -F ufs -o b=#) at:
 32, 16240, 32448, 48656, 64864, 81072, 97280, 113488, 129696, 145904, 162112,
 178320, 194528, 210736, 226944, 243152, 258080, 274288, 290496, 306704,
 322912, 339120, 355328, 371536, 387744, 403952, 420160, 436368, 452576,
 468784, 484992, 501200, 516128, 532336, 548544, 564752, 580960, 597168,
 613376, 629584, 645792, 662000, 678208, 694416, 710624,
 <tt><b>fsck /dev/rdsk/c0t1d0s7</b></tt>
#</pre><h6><h6>More Information</h6>After You Create a UFS File System ...<p>To mount the UFS file system and make it available, go to
<a href="fsmount-42780.html">Chapter&nbsp;19, Mounting and Unmounting File Systems (Tasks)</a>.</p></h6>

<a name="fsoverview-14"></a><h4>How to Create a Multiterabyte UFS File System</h4><p>Support for a multiterabyte UFS file system assumes the availability of multiterabyte LUNs,
provided as Solaris Volume Manager or VxVM volumes, or as physical disks greater
than 1 terabyte.</p><p>Before you can create a multiterabyte UFS file system, verify that you have
done either of the following:</p>
<ul><li><p>Created a multiterabyte disk partition by using the <tt>format</tt> utility or the Solaris installation utilities</p></li>
<li><p>Set up a multiterabyte volume with Solaris Volume Manager</p></li></ul>
<p>For more information about multiterabyte UFS file systems, see <a href="fsoverview-12343.html#fsoverview-18">64-bit: Support of Multiterabyte UFS File Systems</a>.</p><ol>
<li><b>Become superuser.</b></li>
<li><a name="fsoverview-step-19"></a><b>Create a multiterabyte UFS file system on a logical volume.</b><p>For example, this command creates a UFS file system for a 1.8 terabyte
volume:</p><pre># <tt><b>newfs /dev/md/rdsk/d99</b></tt>
newfs: construct a new file system /dev/md/rdsk/d99: (y/n)? <tt><b>y</b></tt>
/dev/md/rdsk/d99:    3859402752 sectors in 628158 cylinders of 48 tracks, 
128 sectors
        1884474.0MB in 4393 cyl groups (143 c/g, 429.00MB/g, 448 i/g)
super-block backups (for fsck -F ufs -o b=#) at:
32, 878752, 1757472, 2636192, 3514912, 4393632, 5272352, 6151072, 702...
Initializing cylinder groups:
........................................................................
super-block backups for last 10 cylinder groups at:
 3850872736, 3851751456, 3852630176, 3853508896, 3854387616, 3855266336,
 3856145056, 3857023776, 3857902496, 3858781216,
# </pre></li>
<li><a name="fsoverview-step-17"></a><b>Verify the integrity of the newly created file system.</b><p>For example:</p><pre># <tt><b>fsck /dev/md/rdsk/d99</b></tt>
** /dev/md/rdsk/d99
** Last Mounted on 
** Phase 1 - Check Blocks and Sizes
** Phase 2 - Check Pathnames
** Phase 3 - Check Connectivity
** Phase 4 - Check Reference Counts
** Phase 5 - Check Cyl groups
2 files, 2 used, 241173122 free (0 frags, 241173122 blocks, 0.0% 
fragmentation)
# </pre></li>
<li><a name="fsoverview-step-18"></a><b>Mount and verify the newly created file system.</b><p>For example:</p><pre># <tt><b>mount /dev/md/dsk/d99 /bigdir</b></tt>
# <tt><b>df -h /bigdir</b></tt>
Filesystem             size   used  avail capacity  Mounted on
/dev/md/dsk/d99        1.8T    64M   1.8T     1%    /bigdir</pre></li></ol>

<a name="fsoverview-17"></a><h4>How to Expand a Multiterabyte UFS File System</h4><p>After a multiterabyte UFS file system is created, you can use the
<tt>growfs</tt> command to expand the file system. For example, using the file system
that was created for the volume in the preceding procedure, you can add
another disk to this volume. Then, expand the file system.</p><ol>
<li><a name="fsoverview-step-64"></a><b>Become superuser.</b></li>
<li><b>Add another disk to the volume.</b><p>For example:</p><pre># <tt><b>metattach d99 c4t5d0s4</b></tt>
d99: component is attached
# <tt><b>metastat</b></tt>
d99: Concat/Stripe
    Size: 5145882624 blocks (2.4 TB)
    Stripe 0:
        Device     Start Block  Dbase   Reloc
        c0t1d0s4      36864     Yes     Yes
    Stripe 1:
        Device     Start Block  Dbase   Reloc
        c3t7d0s4          0     No      Yes
    Stripe 2:
        Device     Start Block  Dbase   Reloc
        c1t1d0s4          0     No      Yes
    Stripe 3:
        Device     Start Block  Dbase   Reloc
        c4t5d0s4          0     No      Yes</pre></li>
<li><a name="fsoverview-step-21"></a><b>Expand the file system.</b><p>For example:</p><pre># <tt><b>growfs -v /dev/md/rdsk/d99</b></tt>
/usr/lib/fs/ufs/mkfs -G /dev/md/rdsk/d99 5145882624
/dev/md/rdsk/d99:    5145882624 sectors in 837546 cylinders of 48 tracks, 
128 sectors
        2512638.0MB in 5857 cyl groups (143 c/g, 429.00MB/g, 448 i/g)
super-block backups (for fsck -F ufs -o b=#) at:
 32, 878752, 1757472, 2636192, 3514912, 4393632, 5272352, 6151072, 702...
Initializing cylinder groups:
.........................................................................
super-block backups for last 10 cylinder groups at:
 5137130400, 5138009120, 5138887840, 5139766560, 5140645280, 5141524000,
 5142402720, 5143281440, 5144160160, 5145038880,
# </pre></li>
<li><a name="fsoverview-step-24"></a><b>Mount and verify the expanded file system.</b><p>For example:</p><pre># <tt><b>mount /dev/md/dsk/d99 /bigdir</b></tt>
# <tt><b>df -h /bigdir</b></tt> 
Filesystem             size   used  avail capacity  Mounted on 
/dev/md/dsk/d99        2.4T    64M   2.4T     1%    /bigdir</pre></li></ol>

<a name="fsoverview-13"></a><h4>How to Expand a UFS File System to a Multiterabyte UFS File System</h4><p>Use the following procedure to expand a UFS file system to greater
than 1 terabyte in size. This procedure assumes that the <tt>newfs</tt> <tt>-T</tt> option
was used initially to create the UFS file system.</p><ol>
<li><b>Become superuser.</b></li>
<li><a name="fsoverview-step-25"></a><b>Identify the size of the current disk or volume.</b><p>For example, the following volume is 800 gigabytes:</p><pre># <tt><b>metastat d98</b></tt>
d98: Concat/Stripe
    Size: 1677754368 blocks (800 GB)
    Stripe 0:
        Device     Start Block  Dbase   Reloc
        c0t1d0s4          0     No      Yes
    Stripe 1:
        Device     Start Block  Dbase   Reloc
        c3t7d0s4          0     No      Yes</pre></li>
<li><a name="fsoverview-step-26"></a><b>Increase the volume to greater than 1 terabyte.</b><p>For example:</p><pre># <tt><b>metattach d98 c1t1d0s4</b></tt>
d98: component is attached
# <tt><b>metastat d98</b></tt>
d98: Concat/Stripe
    Size: 2516631552 blocks (1.2 TB)
    Stripe 0:
        Device     Start Block  Dbase   Reloc
        c0t1d0s4          0     No      Yes
    Stripe 1:
        Device     Start Block  Dbase   Reloc
        c3t7d0s4          0     No      Yes
    Stripe 2:
        Device     Start Block  Dbase   Reloc
        c1t1d0s4          0     No      Yes</pre></li>
<li><a name="fsoverview-step-23"></a><b>Expand the UFS file system for the disk or volume to greater than
1 terabyte.</b><p>For example:</p><pre><tt><b>growfs -v /dev/md/rdsk/d98</b></tt>
/usr/lib/fs/ufs/mkfs -G /dev/md/rdsk/d98 2516631552
/dev/md/rdsk/d98:    2516631552 sectors in 68268 cylinders of 144 tracks, 
256 sectors
        1228824.0MB in 2731 cyl groups (25 c/g, 450.00MB/g, 448 i/g)
super-block backups (for fsck -F ufs -o b=#) at:
 32, 921888, 1843744, 2765600, 3687456, 4609312, 5531168, 6453024, 737...
 8296736,
Initializing cylinder groups:
......................................................
super-block backups for last 10 cylinder groups at:
 2507714848, 2508636704, 2509558560, 2510480416, 2511402272, 2512324128,
 2513245984, 2514167840, 2515089696, 2516011552,</pre></li>
<li><b>Mount and verify the expanded file system.</b><p>For example:</p><pre># <tt><b>mount /dev/md/dsk/d98 /datadir</b></tt>
# <tt><b>df -h /datadir</b></tt> 
Filesystem             size   used  avail capacity  Mounted on 
/dev/md/dsk/d98        1.2T    64M   1.2T     1%    /datadir</pre></li></ol>

<a name="fsoverview-15"></a><h4>Troubleshooting Multiterabyte UFS File System Problems</h4>
<p>Use the following error messages and solutions to troubleshoot problems with multiterabyte UFS
file systems.</p><dl><dt>Error Message (similar to the following):</dt>
<dd><pre>mount: /dev/rdsk/c0t0d0s0 is not this fstype.</pre></dd>
<dt>Cause</dt>
<dd><p>You attempted to mount a UFS file system that is greater than 1 terabyte on a system running a Solaris release prior to the release.</p></dd>
<dt>Solution</dt>
<dd><p>Mount a UFS file system that is greater than 1 terabyte on a system running the or later release.</p></dd>
<dt>Error Message</dt>
<dd><pre>"File system was not set up with the multi-terabyte format."  "Its size 
cannot be increased to a terabyte or more."</pre></dd>
<dt>Cause</dt>
<dd><p>You attempted to expand a file system that was not created by using the <tt>newfs</tt> <tt>-T</tt> command.</p></dd>
<dt>Solution</dt>
<dd>
<ol><li><p>Back up the data for the file system that you want to expand to greater than 1 terabyte.</p></li>
<li><p>Re-create the file system by using the <tt>newfs</tt> command to create a multiterabyte file system.</p></li>
<li><p>Restore the backup data into the newly created file system.</p></li></ol>
</dd>
</dl>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="fscreate-96442.html">Previous</a>
             </td>
             <td align="right">
                 <a href="fscreate-99040.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

