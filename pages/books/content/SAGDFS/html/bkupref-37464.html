<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>How the <tt>ufsdump</tt> Command Works - System Administration Guide: Devices and File Systems</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Devices and File Systems</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="bkupref-12756.html">Previous</a>
             </td>
             <td align="right">
                 <a href="bkupref-27877.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol1preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="medintro-55492.html">1.&nbsp;&nbsp;Managing Removable Media (Overview)</a></p>
<p class="toc level1 tocsp"><a href="medformat-83002.html">2.&nbsp;&nbsp;Managing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medaccess-29267.html">3.&nbsp;&nbsp;Accessing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medcdrw-1.html">4.&nbsp;&nbsp;Writing CDs and DVDs (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig-27900.html">5.&nbsp;&nbsp;Managing Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig2-1.html">6.&nbsp;&nbsp;Dynamically Configuring Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devusbover-24.html">7.&nbsp;&nbsp;Using USB Devices (Overview)</a></p>
<p class="toc level1 tocsp"><a href="devusbtasks-1.html">8.&nbsp;&nbsp;Using USB Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fncpk.html">9.&nbsp;&nbsp;Using InfiniBand Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksconcepts-29477.html">10.&nbsp;&nbsp;Managing Disks (Overview)</a></p>
<p class="toc level1 tocsp"><a href="disksprep-31030.html">11.&nbsp;&nbsp;Administering Disks (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="diskssadd-16103.html">12.&nbsp;&nbsp;SPARC: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksxadd-38159.html">13.&nbsp;&nbsp;x86: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fmvcd.html">14.&nbsp;&nbsp;Configuring Solaris iSCSI Targets and Initiators (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="gfydr.html">15.&nbsp;&nbsp;Configuring and Managing the Solaris Internet Storage Name Service (iSNS)</a></p>
<p class="toc level1 tocsp"><a href="disksformat-15833.html">16.&nbsp;&nbsp;The <tt>format</tt> Utility (Reference)</a></p>
<p class="toc level1 tocsp"><a href="fsoverview-38559.html">17.&nbsp;&nbsp;Managing File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="fscreate-96442.html">18.&nbsp;&nbsp;Creating UFS, TMPFS, and LOFS File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsmount-42780.html">19.&nbsp;&nbsp;Mounting and Unmounting File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fscachefs-70682.html">20.&nbsp;&nbsp;Using The CacheFS File System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsswap-14677.html">21.&nbsp;&nbsp;Configuring Additional Swap Space (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fstroublefsck-61446.html">22.&nbsp;&nbsp;Checking UFS File System Consistency (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsfilesysappx-94408.html">23.&nbsp;&nbsp;UFS File System (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupconcepts-57422.html">24.&nbsp;&nbsp;Backing Up and Restoring File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="bkuptasks2-64128.html">25.&nbsp;&nbsp;Backing Up Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupsnapshot-2.html">26.&nbsp;&nbsp;Using UFS Snapshots (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuprestoretasks-38055.html">27.&nbsp;&nbsp;Restoring Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupref-12756.html">28.&nbsp;&nbsp;UFS Backup and Restore Commands (Reference)</a></p>
<div class="onpage">
<p class="toc level2"><a href="">How the <tt>ufsdump</tt> Command Works</a></p>
</div>
<p class="toc level2"><a href="bkupref-27877.html">Specifying <tt>ufsdump</tt> Command Options and Arguments</a></p>
<p class="toc level2"><a href="bkupref-38756.html">The <tt>ufsdump</tt> Command and Security Issues</a></p>
<p class="toc level2"><a href="bkupref-37873.html">Specifying <tt>ufsrestore</tt> Options and Arguments</a></p>
<p class="toc level1 tocsp"><a href="bkupsavefiles-17924.html">29.&nbsp;&nbsp;Copying UFS Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuptapedevice-42512.html">30.&nbsp;&nbsp;Managing Tape Drives (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="bkupref-37464"></a><h3>How the <tt>ufsdump</tt> Command Works</h3>
<a name="bkupref-ix3091"></a><p>The <tt>ufsdump</tt> command makes two passes when it backs up a file system.
On the first pass, this command scans the raw device file for
the file system and builds a table of directories and files in memory.
Then, this command writes the table to the backup media. In the second
pass, the <tt>ufsdump</tt> command goes through the inodes in numerical order, reading the
file contents and writing the data to the backup media.</p>

<a name="bkupref-1"></a><h4>Determining Device Characteristics</h4>
<p>The <tt>ufsdump</tt> command needs to know only an appropriate tape block size and
how to detect the end of media.</p>

<a name="bkupref-2"></a><h4>Detecting the End of Media</h4>
<a name="bkupref-ix3092"></a><a name="bkupref-ix3093"></a><a name="bkupref-ix3094"></a><p>The <tt>ufsdump</tt> command writes a sequence of fixed-size records. When the <tt>ufsdump</tt> command
receives notification that a record was only partially written, it assumes that it
has reached the physical end of the media. This method works for most
devices. If a device is not able to notify the <tt>ufsdump</tt> command
that only a partial record has been written, a media error occurs as
the <tt>ufsdump</tt> command tries to write another record. </p>
<hr><p><b>Note - </b><a name="bkupref-ix3103"></a><a name="bkupref-ix3104"></a>DAT devices and 8-mm tape devices detect end-of-media. Cartridge tape devices and 1/2-inch
tape devices do not detect end-of-media.</p>
<hr>
<p>The <tt>ufsdump</tt> command automatically detects the end-of-media for most devices. Therefore, you do
not usually need to use the <tt>-c</tt>, <tt>-d</tt>, <tt>-s</tt>, and <tt>-t</tt> options
to perform multivolume backups.</p><p>You need to use the end-of-media options when the <tt>ufsdump</tt> command does not
understand the way the device detects the end-of-media.</p><p>To ensure compatibility with the <tt>restore</tt> command, the size option can still force
the <tt>ufsdump</tt> command to go to the next tape or diskette before reaching
the end of the current tape or diskette.</p>

<a name="bkupref-3"></a><h4>Copying Data With the <tt>ufsdump</tt> Command</h4>
<a name="bkupref-ix3096"></a><p>The <tt>ufsdump</tt> command copies data only from the raw disk slice. If the
file system is still active, any data in memory buffers is probably
not copied. The backup done by the <tt>ufsdump</tt> command does not copy free
blocks, nor does it make an image of the disk slice. If symbolic
links point to files on other slices, the link itself is copied.</p>

<a name="bkupref-4"></a><h4>Purpose of the <tt>/etc/dumpdates</tt> File</h4>
<a name="bkupref-ix3097"></a><a name="bkupref-ix3098"></a><a name="bkupref-ix3099"></a><p>The <tt>ufsdump</tt> command, when used with the <tt>-u</tt> option, maintains and updates the
<tt>/etc/dumpdates</tt> file. Each line in the <tt>/etc/dumpdates</tt> file shows the following information:</p>
<ul><li><p>The file system backed up</p></li>
<li><p>The dump level of the last backup</p></li>
<li><p>The day, date, and time of the backup</p></li></ul>
<p>For example:</p><pre># cat /etc/dumpdates
/dev/rdsk/c0t0d0s0               0 Wed Jul 28 16:13:52 2004
/dev/rdsk/c0t0d0s7               0 Thu Jul 29 10:36:13 2004
/dev/rdsk/c0t0d0s7               9 Thu Jul 29 10:37:12 2004</pre><p><a name="bkupref-ix3100"></a><a name="bkupref-ix3101"></a><a name="bkupref-ix3102"></a>When you do an incremental backup, the <tt>ufsdump</tt> command checks the <tt>/etc/dumpdates</tt> file
to find the date of the most recent backup of the next
lower dump level. Then, this command copies to the media all files that
were modified since the date of that lower-level backup. After the backup is
complete, a new information line, which describes the backup you just completed, replaces
the information line for the previous backup at that level.   </p><p>Use the <tt>/etc/dumpdates</tt> file to verify that backups are being done. This verification
is particularly important if you are having equipment problems. If a backup cannot
be completed because of equipment failure, the backup is not recorded in the
<tt>/etc/dumpdates</tt> file.</p><p>If you need to restore an entire disk, check the <tt>/etc/dumpdates</tt> file for
a list of the most recent dates and levels of backups so
that you can determine which tapes you need to restore the entire file
system.</p>
<hr><p><b>Note - </b>The <tt>/etc/dumpdates</tt> file is a text file that can be edited. However, edit
it only at your own risk. If you make changes to the
file that do not match your archive tapes, you might be unable to
find the tapes (or files) you need. </p>
<hr>


<a name="bkupref-5"></a><h4>Backup Device (<i>dump-file</i>) Argument</h4>
<p>The <i>dump-file</i> argument (to the <tt>-f</tt> option) specifies the destination of the backup.
The destination can be one of the following:</p>
<ul><li><p>Local tape drive</p></li>
<li><p>Local diskette drive</p></li>
<li><p>Remote tape drive</p></li>
<li><p>Remote diskette drive</p></li>
<li><p>Standard output</p></li></ul>
<p>Use this argument when the destination is not the default local tape
drive <tt>/dev/rmt/0</tt>. If you use the <tt>-f</tt> option, then you must specify a
value for the <i>dump-file</i> argument.</p>
<hr><p><b>Note - </b>The <i>dump-file</i> argument can also point to a file on a local disk
or on a remote disk. If done by mistake, this usage can
fill up a file system.</p>
<hr>


<a name="bkupref-6"></a><h5>Local Tape or Diskette Drive</h5>
<p>Typically, the <i>dump-file</i> argument specifies a raw device file for a tape device
or diskette. When the <tt>ufsdump</tt> command writes to an output device, it creates
a single backup file that might span multiple tapes or diskettes.</p><p>You specify a tape device or a diskette on your system by
using a device abbreviation. The first device is always 0. For example, if
you have a SCSI tape controller and one QIC-24 tape drive that uses
medium-density formatting, use this device name: </p><p><tt>/dev/rmt/0m</tt></p><p>When you specify a tape device name, you can also type the
letter &ldquo;n&rdquo; at the end of the name to indicate that the tape
drive should not rewind after the backup is completed. For example: </p><p><tt>/dev/rmt/0mn</tt></p><p>Use the &ldquo;no-rewind&rdquo; option if you want to put more than one
file onto the tape. If you run out of space during a backup,
the tape does not rewind before the <tt>ufsdump</tt> command asks for a new
tape. For a complete description of device-naming conventions, see <a href="bkuptapedevice-27909.html">Backup Device Names</a>.</p>

<a name="bkupref-7"></a><h5>Remote Tape or Diskette Drive</h5>
<p>You specify a remote tape device or a remote diskette by using
the syntax <i>host</i><b>:</b><i>device</i>. The <tt>ufsdump</tt> command writes to the remote device when
superuser on the local system has access to the remote system. If you
usually run the <tt>ufsdump</tt> command as superuser, the name of the local system
must be included in the <tt>/.rhosts</tt> file on the remote system. If
you specify the device as <i>user</i>@<i>host</i>:<i>device</i>, the <tt>ufsdump</tt> command tries to access the
device on the remote system as the specified user. In this case, the
specified user must be included in the <tt>/.rhosts</tt> file on the remote
system.</p><p>Use the naming convention for the device that matches the operating system
for the system on which the device resides, not the system from which
you run the <tt>ufsdump</tt> command. If the drive is on a system
that is running a previous SunOS release (for example, 4.1.1), use the SunOS
4.1 device name (for example, <tt>/dev/rst0</tt>). If the system is running Solaris
software, use the SunOS 5.9 convention (for example, <tt>/dev/rmt/0</tt>).</p>

<a name="bkupref-8"></a><h5>Using Standard Output With the <tt>ufsdump</tt> Command</h5>
<p>When you specify a dash (<tt>-</tt>) as the <i>dump-file</i> argument, the <tt>ufsdump</tt>
command writes to standard output.</p>
<hr><p><b>Note - </b>The <tt>-v</tt> option (verify) does not work when the <i>dump-file</i> argument is
standard output.</p>
<hr>
<p>You can use the <tt>ufsdump</tt> and <tt>ufsrestore</tt> commands in a pipeline to copy
a file system by writing to standard output with the <tt>ufsdump</tt> command
and reading from standard input with the <tt>ufsrestore</tt> command. For example:</p><pre># <tt><b>ufsdump 0f - /dev/rdsk/c0t0d0s7 | (cd /home; ufsrestore xf -)</b></tt></pre>

<a name="bkupref-9"></a><h4>Specifying Files to Back Up</h4>
<p>You must always include <i>filenames</i> as the last argument on the command line.
This argument specifies the source or contents of the backup.</p><p>For a file system, specify the raw device file as follows:</p><p><tt>/dev/rdsk</tt><i>/c0t0d0s7</i><tt></tt></p><p>You can specify the file system by its mount point directory (for
example, <tt>/export/home</tt>), as long as an entry for it exists in the
<tt>/etc/vfstab</tt> file. </p><p>For a complete description of device-naming conventions, see <a href="bkuptapedevice-27909.html">Backup Device Names</a>.</p><p>For individual files or directories, type one or more names separated by
spaces.</p>
<hr><p><b>Note - </b>When you use the <tt>ufsdump</tt> command to back up one or more directories
or files (rather than a complete file system), a level 0 backup
is done. Incremental backups do not apply.</p>
<hr>


<a name="bkupref-10"></a><h4>Specifying Tape Characteristics</h4>
<a name="bkupref-ix3105"></a><a name="bkupref-ix3106"></a><p>If you do not specify any tape characteristics, the <tt>ufsdump</tt> command uses a
set of defaults. You can specify the tape cartridge (<tt>c</tt>), density (<tt>d</tt>), size
(<tt>s</tt>), and number of tracks (<tt>t</tt>). Note that you can specify the options
in any order, as long as the arguments that follow match the order
of the options.</p>

<a name="bkupref-11"></a><h4>Limitations of the <tt>ufsdump</tt> Command</h4>
<p><a name="bkupref-ix3109"></a>The <tt>ufsdump</tt> command cannot do the following:</p>
<ul><li><p>Automatically calculate the number of tapes or diskettes that are needed for backing up file systems. You can use the dry run mode (<tt>S</tt> option) to determine how much space is needed before actually backing up file systems.</p></li>
<li><p>Provide built-in error checking to minimize problems when it backs up an active file system.</p></li>
<li><p>Back up files that are remotely mounted from a server. Files on the server must be backed up on the server itself. Users are denied permission to run the <tt>ufsdump</tt> command on files they own that are located on a server.</p></li></ul>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="bkupref-12756.html">Previous</a>
             </td>
             <td align="right">
                 <a href="bkupref-27877.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

