<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Using USB Mass Storage Devices - System Administration Guide: Devices and File Systems</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Devices and File Systems</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="devusbtasks-34.html">Previous</a>
             </td>
             <td align="right">
                 <a href="devusbtasks-36.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol1preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="medintro-55492.html">1.&nbsp;&nbsp;Managing Removable Media (Overview)</a></p>
<p class="toc level1 tocsp"><a href="medformat-83002.html">2.&nbsp;&nbsp;Managing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medaccess-29267.html">3.&nbsp;&nbsp;Accessing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medcdrw-1.html">4.&nbsp;&nbsp;Writing CDs and DVDs (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig-27900.html">5.&nbsp;&nbsp;Managing Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig2-1.html">6.&nbsp;&nbsp;Dynamically Configuring Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devusbover-24.html">7.&nbsp;&nbsp;Using USB Devices (Overview)</a></p>
<p class="toc level1 tocsp"><a href="devusbtasks-1.html">8.&nbsp;&nbsp;Using USB Devices (Tasks)</a></p>
<p class="toc level2"><a href="devusbtasks-73.html">Managing USB Devices in the Solaris OS (Roadmap)</a></p>
<p class="toc level2"><a href="devusbtasks-34.html">Using USB Mass Storage Devices (Task Map)</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Using USB Mass Storage Devices</a></p>
<p class="toc level3"><a href="#eyhux">How to Display USB Device Information</a></p>
<p class="toc level3"><a href="#devusbtasks-50">How to Create a File System on a USB Mass Storage Device </a></p>
<p class="toc level3"><a href="#gafmj">How to Modify Partitions and Create a PCFS File System on a USB Mass Storage Device</a></p>
<p class="toc level3"><a href="#gafnz">How to Create a Solaris Partition and Modify the Slices on a USB Mass Storage Device</a></p>
<p class="toc level3"><a href="#devusbtasks-22">How to Mount or Unmount a USB Mass Storage Device</a></p>
<p class="toc level3"><a href="#devusbtasks-56">How to Disable Specific USB Drivers</a></p>
<p class="toc level3"><a href="#devusbtasks-33">How to Remove Unused USB Device Links</a></p>
</div>
<p class="toc level2 tocsp"><a href="devusbtasks-36.html">Using USB Audio Devices (Task Map)</a></p>
<p class="toc level2"><a href="eyhva.html">Using USB Audio Devices</a></p>
<p class="toc level3"><a href="eyhva.html#devusbtasks-26">How to Add USB Audio Devices</a></p>
<p class="toc level3"><a href="eyhva.html#devusbtasks-31">How to Identify Your System's Primary Audio Device</a></p>
<p class="toc level3"><a href="eyhva.html#eyhvg">How to Change the Primary USB Audio Device</a></p>
<p class="toc level2 tocsp"><a href="devusbtasks-37.html">Hot-Plugging USB Devices With the <tt>cfgadm</tt> Command (Task Map)</a></p>
<p class="toc level3"><a href="devusbtasks-37.html#eyhvx">How to Display USB Bus Information (<tt>cfgadm</tt>)</a></p>
<p class="toc level3"><a href="devusbtasks-37.html#devusbtasks-96">How to Unconfigure a USB Device</a></p>
<p class="toc level3"><a href="devusbtasks-37.html#devusbtasks-100">How to Configure a USB Device</a></p>
<p class="toc level3"><a href="devusbtasks-37.html#devusbtasks-104">How to Logically Disconnect a USB Device</a></p>
<p class="toc level3"><a href="devusbtasks-37.html#devusbtasks-108">How to Logically Connect a USB Device</a></p>
<p class="toc level3"><a href="devusbtasks-37.html#devusbtasks-112">How to Logically Disconnect a USB Device Subtree</a></p>
<p class="toc level3"><a href="devusbtasks-37.html#devusbtasks-115">How to Reset a USB Device</a></p>
<p class="toc level3"><a href="devusbtasks-37.html#devusbtasks-51">How to Change the Default Configuration of a Multi-Configuration USB Device</a></p>
<p class="toc level1 tocsp"><a href="fncpk.html">9.&nbsp;&nbsp;Using InfiniBand Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksconcepts-29477.html">10.&nbsp;&nbsp;Managing Disks (Overview)</a></p>
<p class="toc level1 tocsp"><a href="disksprep-31030.html">11.&nbsp;&nbsp;Administering Disks (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="diskssadd-16103.html">12.&nbsp;&nbsp;SPARC: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksxadd-38159.html">13.&nbsp;&nbsp;x86: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fmvcd.html">14.&nbsp;&nbsp;Configuring Solaris iSCSI Targets and Initiators (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="gfydr.html">15.&nbsp;&nbsp;Configuring and Managing the Solaris Internet Storage Name Service (iSNS)</a></p>
<p class="toc level1 tocsp"><a href="disksformat-15833.html">16.&nbsp;&nbsp;The <tt>format</tt> Utility (Reference)</a></p>
<p class="toc level1 tocsp"><a href="fsoverview-38559.html">17.&nbsp;&nbsp;Managing File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="fscreate-96442.html">18.&nbsp;&nbsp;Creating UFS, TMPFS, and LOFS File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsmount-42780.html">19.&nbsp;&nbsp;Mounting and Unmounting File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fscachefs-70682.html">20.&nbsp;&nbsp;Using The CacheFS File System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsswap-14677.html">21.&nbsp;&nbsp;Configuring Additional Swap Space (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fstroublefsck-61446.html">22.&nbsp;&nbsp;Checking UFS File System Consistency (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsfilesysappx-94408.html">23.&nbsp;&nbsp;UFS File System (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupconcepts-57422.html">24.&nbsp;&nbsp;Backing Up and Restoring File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="bkuptasks2-64128.html">25.&nbsp;&nbsp;Backing Up Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupsnapshot-2.html">26.&nbsp;&nbsp;Using UFS Snapshots (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuprestoretasks-38055.html">27.&nbsp;&nbsp;Restoring Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupref-12756.html">28.&nbsp;&nbsp;UFS Backup and Restore Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupsavefiles-17924.html">29.&nbsp;&nbsp;Copying UFS Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuptapedevice-42512.html">30.&nbsp;&nbsp;Managing Tape Drives (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="devusbtasks-12"></a><h3>Using USB Mass Storage Devices</h3>
<p>Starting in the Solaris 9 release, the following USB removable mass storage devices
are supported:<a name="indexterm-132"></a></p>
<ul><li><p>CD-RWs</p></li>
<li><p>Hard disks</p></li>
<li><p>DVDs</p></li>
<li><p>Digital cameras</p></li>
<li><p>Diskette devices</p></li>
<li><p>SmartMedia and CompactFlash devices</p></li></ul>
<p>For information about using USB mass storage devices with the Solaris ZFS file
system, see <a href="gafhv.html">What's New in USB Devices?</a></p><p>For a complete list of USB devices that are supported in the
Solaris OS, see:</p><p><a href="http://www.sun.com/io_technologies/USB.html">http://www.sun.com/io_technologies/USB.html</a></p><p>In previous Solaris releases, all USB storage devices were identified as removable media
devices, which provides many of the following advantages, including automatic mounting. In the
Solaris Express release, USB mass storage devices are identified as hotpluggable devices but
also enjoy the advantages of USB removable devices that are listed below. For
more information about the hotpluggable behavior, see <a href="gdryj.html#gcajp">USB and 1394 (FireWire) Support Enhancements</a>.</p>
<ul><li><p>Starting in the Solaris Express 6/05 release, a hot-pluggable device is automatically mounted. For more information, see <a href="gafhv.html#gafiu"><tt>vold</tt> Provides Awareness of Hot-Plugged USB Devices</a>.</p></li>
<li><p>USB storage devices with standard MS-DOS or Windows (FAT) file systems are supported.</p></li>
<li><p>You can use the user-friendly <tt>rmformat</tt> command to create slices. You can also use the <tt>fdisk</tt> command to partition a USB device, but never use the <tt>format</tt> utility or the <tt>rmformat</tt> <tt>-F</tt> command to physically format a USB drive.</p></li>
<li><p>Use the <tt>rmformat</tt> command to display all USB devices with media inserted. For example, see <a href="#eyhux">How to Display USB Device Information</a>.</p></li>
<li><p>Non-root users can now access USB storage devices, since the <tt>mount</tt> command is no longer needed. The device is automatically mounted and is available under the <tt>/media</tt> directory. If a new device is connected while the system is down, do a reconfiguration boot with the <tt>boot -r</tt> command so that the device is recognized.</p></li>
<li><p>These devices can be managed with or without removable media services.</p></li>
<li><p>Disks with FAT file systems can be mounted and accessed. For example:</p><pre>mount -F pcfs /dev/dsk/c2t0d0s0:c /mnt</pre></li>
<li><p>All USB storage devices are now power managed, except for those that support <tt>LOG SENSE</tt> pages. Devices with <tt>LOG SENSE</tt> pages are usually SCSI drives connected through a USB-to-SCSI bridge device. </p></li>
<li><p>Applications might work differently with USB mass storage devices. Keep the following issues in mind when using applications with USB storage devices:</p>
<ul><li><p>Applications might make incorrect assumptions about the size of the media since only smaller devices like diskettes were removable previously.</p></li>
<li><p>Requests by applications to eject media on devices where this would be inapplicable, such as a hard drive, will succeed and do nothing.</p></li>
<li><p>If you prefer the behavior in previous Solaris releases where all USB mass storage were treated as removable media devices, then you can force the old behavior by updating the <tt>/kernel/drv/scsa2usb.conf</tt> file.</p></li></ul>
</li></ul>
<p>For more information on using USB mass storage devices, see <a href="http://docs.sun.com/doc/819-2254/scsa2usb-7d?a=view"><tt>scsa2usb</tt>(7D)</a>.</p>

<a name="devusbtasks-46"></a><h4>Using USB Diskette Devices</h4>
<p>USB diskette devices appear as removable media devices. USB diskette devices are not
managed by the <tt>fd</tt> (floppy) driver. Applications that issue <tt>ioctl(2)</tt> calls intended for
the <tt>fd</tt> (native floppy) driver will fail. Applications that issue only <tt>read(2)</tt> and
<tt>write(2)</tt> calls will succeed. Other applications, such as SunPCI and <tt>rmformat</tt>, also succeed.<a name="indexterm-133"></a></p><p>The USB diskette device is identified as a SCSI removable media device. The
device is available for access under the  <tt>/media</tt> directory.</p><p>For more information on how to use USB diskette devices, see <a href="medintro-55492.html">Chapter&nbsp;1, Managing Removable Media (Overview)</a>.</p>

<a name="devusbtasks-13"></a><h4>Using Non-Compliant USB Mass Storage Devices</h4>
<p>Some devices might be supported by the USB mass storage driver even though
they do not identify themselves as compliant with the USB mass storage class
or identify themselves incorrectly. The <tt>scsa2usb.conf</tt> file contains an attribute-override list that lists
the vendor ID, product ID, and revision for matching mass storage devices, as
well as fields for overriding the default device attributes. The entries in this
list are commented out by default. These entries can be copied and uncommented
to enable support of particular devices.<a name="indexterm-134"></a></p><p>If you connect a USB mass storage device to a system running
this Solaris release and the system is unable to use it, you can
check the <tt>/kernel/drv/scsa2usb.conf</tt> file to see if there is a matching, commented
entry for this device. Follow the information given in the <tt>scsa2usb.conf</tt> file to see
if a particular device can be supported by using the override information.</p><p>For a listing of recommended USB mass storage devices, go to:</p><p><a href="http://www.sun.com/io_technologies/USB.html">http://www.sun.com/io_technologies/USB.html</a></p><p>For more information, see <a href="http://docs.sun.com/doc/819-2254/scsa2usb-7d?a=view"><tt>scsa2usb</tt>(7D)</a>.</p>

<a name="gafha"></a><h5>How to Use a Non-Complaint USB Mass Storage Device</h5>
<ol>
<li><b>Become superuser.</b></li>
<li><b>Add an entry to the <tt>/kernel/drv/scsa2usb.conf</tt> file.</b><p>The following entry is appropriate for a USB memory stick.</p><pre>attribute-override-list = "vid=* reduced-cmd-support=true";</pre></li>
<li><b>Either reboot the system or do the following:</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Remove the device.</b></li>
<li><b>Manually update the driver.</b><pre># <tt><b>update_drv -f scsa2usb</b></tt></pre></li>
<li><b>Add the device.</b></li></ol></li></ol>

<a name="eyhuz"></a><h4>Hot-Plugging USB Mass Storage Devices</h4>
<p>Hot-plugging a device means the device is added or removed without shutting down
the operating system or powering off the system. All USB devices are hot-pluggable.</p><p>The removable media manager is now aware of hot-plugged devices. You can just
plug in the device, which is mounted in a few seconds. If
nothing happens, check to see if it is mounted.</p><p>Make sure that removable media services are running.</p><pre># <tt><b>svcs hal dbus rmvolmgr</b></tt>
STATE          STIME    FMRI
online         May_03   svc:/system/dbus:default
online         May_03   svc:/system/hal:default
online         May_03   svc:/system/filesystem/rmvolmgr:default</pre><p>The file system can be mounted from the device if it is
valid and it is recognized.</p><p>If the file system on the device is not automatically mounted, try
a manual mount.</p><p>Before hot-removing the device, find the name of the device in the
<tt>eject</tt> <tt>-l</tt> command's alias name. Then eject the device's media. If you don't
do this, the device is released and the port is usable again, but
the file system on the device might have been damaged.</p><p>When you hot-plug a USB device, the device is immediately seen in
the system's device hierarchy, as displayed in the <tt>prtconf</tt> command output. When you remove
a USB device, the device is removed from the system's device hierarchy, unless
you are using the device.</p><p>If you are using a device when it is unplugged, the device
node  remains, but the driver controlling this device stops all activity on
the device. Any new I/O activity issued to this device returns an error.</p><p><a name="indexterm-135"></a>In this situation, the system prompts you to plug in the original device.
If the device is no longer available, stop the applications. After a few
seconds, the port becomes available again.</p>
<hr><p><b>Note - </b>Data integrity might be impaired if you remove an active or open device.
Always close the device before removing, except the attached keyboard and mouse, which
can be moved while active.</p>
<hr>


<a name="fapbw"></a><h5>How to Add a USB Mass Storage Device</h5>
<ol>
<li><b>Become superuser or a console user.<a name="indexterm-136"></a><a name="indexterm-137"></a></b></li>
<li><a name="fapgq"></a><b>Connect the USB mass storage device.</b></li>
<li><a name="fapbv"></a><b>Verify that the USB device has been added.</b><p>For example:</p><pre>$ rmformat
 Looking for devices...
       1. Logical Node: /dev/rdsk/c3t0d0p0
          Physical Node: /pci@0,0/pci108e,534a@2,1/storage@3/disk@0,0
          Connected Device: SanDisk  Cruzer Micro     0.3
          Device Type: Removable
          Bus: USB
          Size: 245.0 MB
          Label: &lt;None>
          Access permissions: Medium is not write protected.</pre></li>
<li><b>Verify that the device is automatically mounted under the <tt>/media</tt> directory.</b><p>For example:</p><pre>$ ls /media/NONAME
aa  bb</pre><p>You can also use the <tt>rmmount</tt> <tt>-l</tt> command to list the paths and
nicknames of  mountable devices. If the device has been mounted under the
<tt>/media</tt> directory, you will see output similar to the following:</p><pre>$ rmmount -l
/dev/dsk/c3t0d0p0:1  rmdisk0,NONAME,/media/NONAME</pre></li></ol>

<a name="faphl"></a><h5>How to Add a USB Camera</h5>
<p>If the camera's media uses a PCFS file system, it will be
automatically mounted.  If the device does not bind to the <tt>scsa2usb</tt> driver, use
<tt>libusb</tt> applications for transferring the pictures. For more information, refer to <tt>/usr/sfw/share/doc/libusb/libusb.txt</tt>.</p><ol>
<li><a name="faphm"></a><b>Become superuser.</b></li>
<li><b>Plug in and turn on the USB camera.<a name="indexterm-138"></a><a name="indexterm-139"></a></b><p>The system creates a logical device for the camera. After the camera is
plugged in, output is written to the <tt>/var/adm/messages</tt> file to acknowledge the
device's connection. The system treats the camera as a storage device.</p></li>
<li><a name="fapdt"></a><b>Examine the output that is written to the <tt>/var/adm/messages</tt> file.</b><pre># <tt><b>more /var/adm/messages</b></tt></pre><p>Examining this output enables you to determine which logical device was created so
that you can then use that device to access your images. The output
looks similar to the following:</p><pre>Jul 15 09:53:35 buffy usba: [ID 349649 kern.info]    OLYMPUS, C-3040ZOOM,
 000153719068
Jul 15 09:53:35 buffy genunix: [ID 936769 kern.info] scsa2usb1 is 
/pci@0,0/pci925,1234@7,2/storage@2
Jul 15 09:53:36 buffy scsi: [ID 193665 kern.info] sd3 at scsa2usb1: 
target 0 lun 0</pre><p>Match the device with a mountable <tt>/dev/dsk</tt> link entry, by doing the following:</p><pre># <tt><b>ls -l /dev/dsk/c*0 | grep /pci@0,0/pci925,1234@7,2/storage@2</b></tt>
 lrwxrwxrwx   1 root     root          58 Jun 30  2004 c3t0d0p0 ->
 ../../devices/pci@0,0/pci925,1234@7,2/storage@2/disk@0,0:a</pre></li>
<li><a name="fapeu"></a><b>Mount the USB camera file system.</b><p>The camera's file system is most likely a PCFS file system. If file
system is PCFS, then it should be automatically mounted.</p><p>To manually mount the file system on an x86 system, you would use
syntax similar to the following:</p><pre># <tt><b>mount -F pcfs /dev/dsk/c3t0d0p0:c /mnt</b></tt></pre><p>To manually mount the file system on a SPARC system, you would
use syntax similar to the following:</p><pre># <tt><b>mount -F pcfs /dev/dsk/c3t0d0s0:c /mnt</b></tt></pre><p>For information on mounting file systems, see <a href="fsmount-42780.html">Chapter&nbsp;19, Mounting and Unmounting File Systems (Tasks)</a>.</p><p>For information on mounting different PCFS file systems, see <a href="http://docs.sun.com/doc/819-2240/mount-pcfs-1m?a=view"><tt>mount_pcfs</tt>(1M)</a>.</p></li>
<li><a name="fapgo"></a><b>Verify that the image files are available.</b><p>For example:</p><pre># <tt><b>ls /mnt/DCIM/100OLYMP/</b></tt>
P7220001.JPG*  P7220003.JPG*  P7220005.JPG*
P7220002.JPG*  P7220004.JPG*  P7220006.JPG*</pre></li>
<li><a name="fapim"></a><b>View and manipulate the image files created by the USB camera.</b><p>For example:</p><pre># <tt><b>/usr/dt/bin/sdtimage P7220001.JPG &amp;</b></tt></pre></li>
<li><a name="fapin"></a><b>Unmount the file system before disconnecting the camera.</b><p>For example:</p><pre># <tt><b>umount /mnt</b></tt></pre></li>
<li><a name="fapcy"></a>(Optional) <b>Turn off and disconnect the camera.</b></li></ol>

<a name="fapic"></a><h5>How to Remove a USB Mass Storage Device</h5>
<ol>
<li><a name="fapds"></a><b>Become superuser or a console user.<a name="indexterm-140"></a><a name="indexterm-141"></a></b></li>
<li><a name="fapfg"></a><b>Stop any active applications that are using the device.</b></li>
<li><a name="fapgj"></a><b>Unmount the device.</b><pre>$ rmumount NONAME</pre><p>Or, use the <tt>umount</tt> command as superuser. For example:</p><pre># umount /media/NONAME</pre><p>For more information about unmounting a USB device, see <a href="#devusbtasks-22">How to Mount or Unmount a USB Mass Storage Device</a>.</p></li>
<li><b>Remove the device.</b></li></ol>

<a name="devusbtasks-3"></a><h4>Preparing to Use a USB Mass Storage Device</h4>
<p>You can access information on removable media with or without using removable media
services. For information on accessing information on removable media with GNOME's File Manager,
see the GNOME desktop documentation.</p><p>After the USB device is formatted, it is usually mounted under the
 <tt>/media/</tt><i>label</i> directory.</p><p>The device nodes are created under the <tt>/dev/rdsk</tt> directory for character devices and under
the <tt>/dev/dsk</tt> directory for block devices. Device links are created when the devices
are hot-plugged. For more information, see <a href="http://docs.sun.com/doc/819-2254/scsa2usb-7d?a=view"><tt>scsa2usb</tt>(7D)</a>.</p><p>If the device cannot be identified by removable media services, then try to
manually mount the device. First, use the <tt>rmformat</tt> command to identify the device
path and then use the <tt>mount</tt> command to manually mount the device as
superuser.</p><p>If a device is mounted by removable media services then you can unmount
it by using the <tt>rmumount</tt> command. If the device is manually mounted, then
you would unmount it using the <tt>umount</tt> command as superuser.</p><p>For more information about mounting and unmounting USB devices, see <a href="#devusbtasks-22">How to Mount or Unmount a USB Mass Storage Device</a>.</p>

<a name="eyhux"></a><h4>How to Display USB Device Information</h4><ul>
<li><b>Display information about USB devices.<a name="indexterm-142"></a><a name="indexterm-143"></a></b><p>For example, use the <tt>prtconf</tt> command to display USB device information. The <tt>prtconf</tt> output
in this example has been truncated to only display USB device information.</p><pre>$ <tt><b>prtconf</b></tt>
        usb, instance #0
                 hub, instance #2
                     device, instance #8
                         interface (driver not attached)
                     printer (driver not attached)
                     mouse, instance #14
                     device, instance #9
                         keyboard, instance #15
                         mouse, instance #16
                     storage, instance #7
                         disk (driver not attached)
                     communications, instance #10
                         modem (driver not attached)
                         data (driver not attached)
                 storage, instance #0
                     disk (driver not attached)
                 storage, instance #1
                     disk (driver not attached)</pre><p>For example, use the <tt>rmformat</tt> command to display USB device information.</p><pre>$ rmformat
 Looking for devices...
       1. Logical Node: /dev/rdsk/c3t0d0p0
          Physical Node: /pci@0,0/pci108e,534a@2,1/storage@3/disk@0,0
          Connected Device: SanDisk  Cruzer Micro     0.3
          Device Type: Removable
          Bus: USB
          Size: 245.0 MB
          Label: &lt;None>
          Access permissions: Medium is not write protected.</pre></li></ul>

<a name="devusbtasks-50"></a><h4>How to Create a File System on a USB Mass Storage Device </h4><p>A USB diskette must be formatted before you can add a file
system to it. All other USB mass storage devices just need a PCFS
or UFS file system before they can be used. Keep the following key
points in mind when formatting a USB device:</p>
<ul><li><p>Do not use the <tt>rmformat</tt> <tt>-F</tt> except on a USB diskette.</p></li>
<li><p>If the default slices are not acceptable, use the <tt>rmformat</tt> <tt>-s</tt> command to create slices. Use the <tt>fdisk</tt> utility to partition a USB device, if needed. For step-by-step instructions, see:</p>
<ul><li><p><a href="#gafmj">How to Modify Partitions and Create a PCFS File System on a USB Mass Storage Device</a></p></li>
<li><p><a href="#gafnz">How to Create a Solaris Partition and Modify the Slices on a USB Mass Storage Device</a></p></li>
<li><p>If the USB device is automatically mounted, you will have to unmount it before you can create a file system on the USB device. Use the <tt>rmmount</tt> <tt>-l</tt> command to identify the device nickname and then the <tt>rmumount</tt> command to unmount the USB device.</p></li></ul>
</li></ul>

<hr><p><b>Note - </b>Perform steps 4-5 only if you need to format a USB diskette.</p>
<hr>
<ol>
<li><b>Become superuser.</b></li>
<li><a name="devusbtasks-step-76"></a><b>Add the USB device to your system.<a name="indexterm-144"></a><a name="indexterm-145"></a> For information on hot-plugging USB
devices, see:</b>
<ul><li><p><a href="#eyhuz">Hot-Plugging USB Mass Storage Devices</a></p></li>
<li><p><a href="devusbtasks-37.html">Hot-Plugging USB Devices With the <tt>cfgadm</tt> Command (Task Map)</a></p></li></ul>
</li>
<li><a name="devusbtasks-step-75"></a><b>(Optional) Identify the USB device.</b><p>For example:</p><pre># rmformat
Looking for devices...
     1. Logical Node: /dev/rdsk/c2t0d0p0
        Physical Node: /pci@0,0/pci108e,534a@2,1/hub@7/floppy@1/disk@0,0
        Connected Device: MITSUMI  USB FDD          1039
        Device Type: Floppy drive
        Bus: USB
        Size: 1.4 MB
        Label: &lt;None>
        Access permissions: Medium is not write protected.</pre><p>In this example, the diskette device is <tt>c2t0d0p0</tt>.</p></li>
<li><a name="devusbtasks-step-77"></a><b>Insert a diskette into the diskette drive, if necessary.</b></li>
<li><b>Format the diskette, if necessary.</b><pre>% <tt><b>rmformat -F long</b></tt> <i>raw-device</i></pre><p>For example, on a SPARC system:</p><pre>% <tt><b>rmformat -F long /dev/rdsk/c2t0d0s2</b></tt></pre><p>For example, on an x86 system:</p><pre>% <tt><b>rmformat -F long /dev/rdsk/c3t0d0p0</b></tt></pre></li>
<li><a name="devusbtasks-step-33"></a><b>Determine the file system type and make sure the device is unmounted. Then,
select one of the following:</b><p>For more information about unmounting a USB device, see <a href="#devusbtasks-22">How to Mount or Unmount a USB Mass Storage Device</a>.</p>
<ul><li><p>Create a PCFS file system.</p><pre># <tt><b>mkfs -F pcfs -o nofdisk,size=</b></tt><i>size</i> <i>raw-device</i></pre><p>Specify the <tt>-size</tt> option in 512-byte blocks.</p><p>The following example shows how to create a PCFS file system on a 1.4-Mbyte diskette on a SPARC system:</p><pre># <tt><b>mkfs -F pcfs /dev/rdsk/c2t0d0p0</b></tt>
Construct a new FAT file system on /dev/rdsk/c2t0d0p0: (y/n)? <tt><b>y</b></tt></pre><p>The following example shows how to create a PCFS file system on a 1.4-Mbyte diskette on an x86 system:</p><pre># <tt><b>mkfs -F pcfs /dev/rdsk/c2t0d0s2</b></tt>
Construct a new FAT file system on /dev/rdsk/c2t0d0s2: (y/n)? <tt><b>y</b></tt></pre><p>The following example shows how to create a PCFS file system on a 100-Mbyte USB memory stick on a SPARC system:</p><pre># <tt><b>mkfs -F pcfs /dev/rdsk/c5t0d0s2:c</b></tt></pre><p>The following example shows how to create a PCFS file system on a 100-Mbyte USB memory stick on an x86 system:</p><pre># <tt><b>mkfs -F pcfs /dev/rdsk/c5t0d0p0:c</b></tt></pre><p>This command can take several minutes to complete.</p></li>
<li><p>Create a UFS file system.</p><pre># <tt><b>newfs</b></tt> <i>raw-device</i></pre><p>For example:</p><pre># <tt><b>newfs /dev/rdsk/c4t0d0s7</b></tt></pre><p>Consider using the <tt>newfs -f 4096</tt> option or <tt>newfs -T</tt> option for large USB hard disks.</p>
<hr><p><b>Note - </b>UFS file system overhead consumes a significant portion of space on a diskette, due to a diskette's limited storage capacity.</p>
<hr>
</li></ul>
<p>See the next two procedures for a detailed example of creating a
PCFS file system and modifying slices on a USB mass storage device.</p></li></ol>

<a name="gafmj"></a><h4>How to Modify Partitions and Create a PCFS File System on a USB Mass Storage Device</h4><p>The following steps describe how to delete an existing partition, create a new
partition, and then create a PCFS file system on the USB device.
Make sure you backup any data before you perform this task.<a name="indexterm-146"></a><a name="indexterm-147"></a></p><ol>
<li><b>Become superuser.</b></li>
<li><b>Start the <tt>fdisk</tt> utility.</b><p>For example:</p><pre># <tt><b>fdisk /dev/rdsk/c3t0d0p0</b></tt></pre></li>
<li><b>Delete the partition by selecting option 3.</b><p>For example:</p><pre>      Total disk size is 29 cylinders
             Cylinder size is 2048 (512 byte) blocks

                                               Cylinders
      Partition   Status    Type          Start   End   Length    %
      =========   ======    ============  =====   ===   ======   ===
          1       Active    Solaris2          1    28      28     97

SELECT ONE OF THE FOLLOWING:
   1. Create a partition
   2. Specify the active partition
   3. Delete a partition
   4. Change between Solaris and Solaris2 Partition IDs
   5. Exit (update disk configuration and exit)
   6. Cancel (exit without updating disk configuration)
Enter Selection: <tt><b>3</b></tt></pre></li>
<li><b>Choose the partition number to delete.</b><p>For example:</p><pre>      Total disk size is 29 cylinders
             Cylinder size is 2048 (512 byte) blocks

                                               Cylinders
      Partition   Status    Type          Start   End   Length    %
      =========   ======    ============  =====   ===   ======   ===
          1       Active    Solaris2          1    28      28     97

SELECT ONE OF THE FOLLOWING:
   1. Create a partition
   2. Specify the active partition
   3. Delete a partition
   4. Change between Solaris and Solaris2 Partition IDs
   5. Exit (update disk configuration and exit)
   6. Cancel (exit without updating disk configuration)
Specify the partition number to delete (or enter 0 to exit): <tt><b>1</b></tt>

Partition deleted.</pre></li>
<li><b>Create a partition.</b><p>For example:</p><pre>      Total disk size is 29 cylinders
             Cylinder size is 2048 (512 byte) blocks

                                               Cylinders
      Partition   Status    Type          Start   End   Length    %
      =========   ======    ============  =====   ===   ======   ===

WARNING: no partitions are defined!

SELECT ONE OF THE FOLLOWING:
   1. Create a partition
   2. Specify the active partition
   3. Delete a partition
   4. Change between Solaris and Solaris2 Partition IDs
   5. Exit (update disk configuration and exit)
   6. Cancel (exit without updating disk configuration)
Enter Selection: <tt><b>1</b></tt></pre></li>
<li><b>Select the FAT32 partition type.</b><pre>      Total disk size is 29 cylinders
             Cylinder size is 2048 (512 byte) blocks

                                               Cylinders
      Partition   Status    Type          Start   End   Length    %
      =========   ======    ============  =====   ===   ======   ===

WARNING: no partitions are defined!

SELECT ONE OF THE FOLLOWING:
   1. Create a partition
   2. Specify the active partition
   3. Delete a partition
   4. Change between Solaris and Solaris2 Partition IDs
   5. Exit (update disk configuration and exit)
   6. Cancel (exit without updating disk configuration)
Select the partition type to create:
   1=SOLARIS2  2=UNIX        3=PCIXOS     4=Other    
   5=DOS12     6=DOS16       7=DOSEXT     8=DOSBIG
   9=DOS16LBA  A=x86 Boot    B=Diagnostic C=FAT32
   D=FAT32LBA  E=DOSEXTLBA   F=EFI        0=Exit? <tt><b>c</b></tt></pre></li>
<li><b>Specify the percentage of disk to use for this partition.</b><pre>       Total disk size is 29 cylinders
              Cylinder size is 2048 (512 byte) blocks

                                               Cylinders
      Partition   Status    Type          Start   End   Length    %
      =========   ======    ============  =====   ===   ======   ===

WARNING: no partitions are defined!

SELECT ONE OF THE FOLLOWING:
   1. Create a partition
   2. Specify the active partition
   3. Delete a partition
   4. Change between Solaris and Solaris2 Partition IDs
   5. Exit (update disk configuration and exit)
   6. Cancel (exit without updating disk configuration)
Select the partition type to create:
Specify the percentage of disk to use for this partition (or type "c" to 
specify the size in cylinders). <tt><b>100</b></tt></pre></li>
<li><b>Select whether the new partition should be the active partition or an inactive
partition.</b><pre>              Total disk size is 29 cylinders
              Cylinder size is 2048 (512 byte) blocks

                                               Cylinders
      Partition   Status    Type          Start   End   Length    %
      =========   ======    ============  =====   ===   ======   ===

WARNING: no partitions are defined!

SELECT ONE OF THE FOLLOWING:
   1. Create a partition
   2. Specify the active partition
   3. Delete a partition
   4. Change between Solaris and Solaris2 Partition IDs
   5. Exit (update disk configuration and exit)
   6. Cancel (exit without updating disk configuration)
Select the partition type to create:
Should this become the active partition? If yes, it  will be activated 
each time the computer is reset or turned on.
Please type "y" or "n". <tt><b>n</b></tt></pre></li>
<li><b>Update the disk configuration and exit.</b><pre>      Total disk size is 29 cylinders
             Cylinder size is 2048 (512 byte) blocks

                                               Cylinders
      Partition   Status    Type          Start   End   Length    %
      =========   ======    ============  =====   ===   ======   ===
          1                 Win95 FAT32       1    28      28     97

SELECT ONE OF THE FOLLOWING:
   1. Create a partition
   2. Specify the active partition
   3. Delete a partition
   4. Change between Solaris and Solaris2 Partition IDs
   5. Exit (update disk configuration and exit)
   6. Cancel (exit without updating disk configuration)
Enter Selection: <tt><b>5</b></tt></pre></li>
<li><b>Create the PCFS file system on this partition.</b><p>Make sure the device is unmounted before creating the new file system. For
more information about unmounting a USB device, see <a href="#devusbtasks-22">How to Mount or Unmount a USB Mass Storage Device</a>.</p><p>For example:</p><pre># <tt><b>mkfs -F pcfs -o fat=32 /dev/rdsk/c3t0d0p0:c</b></tt>
Construct a new FAT file system on /dev/rdsk/c3t0d0p0:c: (y/n)? <tt><b>y</b></tt></pre></li></ol>

<a name="gafnz"></a><h4>How to Create a Solaris Partition and Modify the Slices on a USB Mass Storage Device</h4><p>The following steps illustrate how to create a Solaris partition and modify the
slices.</p><p>Make sure you back up any data before you perform this task.<a name="indexterm-148"></a><a name="indexterm-149"></a></p><ol>
<li><b>Become superuser.</b></li>
<li><b>Start the <tt>fdisk</tt> utility.</b><p>For example:</p><pre># <tt><b>fdisk /dev/rdsk/c5t0d0s2</b></tt>
No fdisk table exists. The default partition for the disk is:

  a 100% "SOLARIS System" partition

Type "y" to accept the default partition,  otherwise type "n" to edit the
 partition table.
<tt><b>y</b></tt></pre></li>
<li><b>Display the current slices.</b><p>For example:</p><pre># <tt><b>prtvtoc /dev/rdsk/c5t0d0s2</b></tt>
* /dev/rdsk/c5t0d0s2 partition map
*
* Dimensions:
*     512 bytes/sector
*      63 sectors/track
*     255 tracks/cylinder
*   16065 sectors/cylinder
*    5836 cylinders
*    5836 accessible cylinders
*
* Flags:
*   1: unmountable
*  10: read-only
*
*                          First     Sector    Last
* Partition  Tag  Flags    Sector     Count    Sector  Mount Directory
       0      0    00          0  93755340  93755339
       2      0    00          0  93755340  93755339</pre></li>
<li><b>Create a text file with the slice information.</b><p>For example:</p><pre>slices: 0 = 0, 5GB, "wm", "home" :
        1 = 8225280000, 6GB :
        2 = 0, 44GB, "wm", "backup" :
        6 = 16450560000, 15GB</pre><p>Make sure each slice starts on a cylinder boundary. For example, slice 1
starts at 822280000 bytes, which is the cylinder size in bytes multiplied by
1000.</p><p>For more information, see the <tt>-s</tt> option description in <a href="http://docs.sun.com/doc/819-2239/rmformat-1?a=view"><tt>rmformat</tt>(1)</a>.</p></li>
<li><b>Create the slices by including the slice file created above.</b><p>For example:</p><pre># <tt><b>rmformat -s slice_file /dev/rdsk/c5t0d0s2</b></tt></pre></li>
<li><b>View the new slice information.</b><p>For example:</p><pre># <tt><b>prtvtoc /dev/rdsk/c5t0d0s2</b></tt>
* /dev/rdsk/c5t0d0s2 partition map
*
* Dimensions:
*     512 bytes/sector
*      63 sectors/track
*     255 tracks/cylinder
*   16065 sectors/cylinder
*    5836 cylinders
*    5836 accessible cylinders
*
* Flags:
*   1: unmountable
*  10: read-only
*
* Unallocated space:
*       First     Sector    Last
*       Sector     Count    Sector
*    10485760   5579240  16064999
*    28647912   3482088  32129999
*    63587280  30168060  93755339
*
*                          First     Sector    Last
* Partition  Tag  Flags    Sector     Count    Sector  Mount Directory
       0      8    00          0  10485760  10485759
       1      3    01   16065000  12582912  28647911
       2      5    00          0  92274688  92274687
       6      4    00   32130000  31457280  63587279</pre></li></ol>

<a name="devusbtasks-22"></a><h4>How to Mount or Unmount a USB Mass Storage Device</h4><p>The following steps illustrate how to mount and unmount a USB mass
storage device.</p><ol>
<li><a name="devusbtasks-step-30"></a><b>Become superuser or console user.<a name="indexterm-150"></a><a name="indexterm-151"></a><a name="indexterm-152"></a></b></li>
<li><a name="devusbtasks-step-78"></a><b>(Optional) Identify the device.</b><p>For example:</p><pre>$ rmformat
 Looking for devices...
       1. Logical Node: /dev/rdsk/c3t0d0p0
          Physical Node: /pci@0,0/pci108e,534a@2,1/storage@3/disk@0,0
          Connected Device: SanDisk  Cruzer Micro     0.3
          Device Type: Removable
          Bus: USB
          Size: 245.0 MB
          Label: &lt;None>
          Access permissions: Medium is not write protected.</pre><p>In this example, the physical diskette device is <tt>c2t0d0p0</tt>.</p><p>Or, identify the nickname for the device. For example:</p><pre>$ <tt><b>rmmount -l</b></tt>
/dev/dsk/c2t0d0p0       floppy,floppy0,fd,fd0,diskette,diskette0,rdiskette,rdiskette0</pre></li>
<li><a name="devusbtasks-step-31"></a><b>Select one of the following to mount or unmount a USB mass storage
device:<a name="indexterm-153"></a><a name="indexterm-154"></a><a name="indexterm-155"></a><a name="indexterm-156"></a></b>
<ul><li><p>Mount a USB mass storage device as a console user. </p><p>You can use the <tt>rmmount</tt> command with device nicknames, mount points, or device paths, similar to the following:</p><pre>$ rmmount rmdisk0
$ rmmount NONAME
$ rmmount /dev/dsk/c3t0d0p0:1</pre><p>For example:</p><pre>$ <tt><b>rmmount NONAME</b></tt>
NONAME /dev/dsk/c2t0d0p0 mounted
$ <tt><b>ls /media/NONAME</b></tt>
AA.TXT</pre></li>
<li><p>Unmount a USB mass storage device as a console user.</p><p>For example:</p><pre>$ <tt><b>rmumount NONAME</b></tt>  
NONAME /dev/dsk/c2t0d0p0 unmounted</pre></li>
<li><p>Mount a USB mass storage device as superuser.</p><p>This example shows how to mount a device with a UFS file system:</p><pre># <tt><b>mount /dev/dsk/c1t0d0s2 /mnt</b></tt></pre><p>This example shows how to mount a device with a PCFS file system on a SPARC system:</p><pre># <tt><b>mount -F pcfs /dev/dsk/c3t0d0s2:c /mnt</b></tt></pre><p>This example shows how to mount a device with a PCFS file system on an x86 system:</p><pre># <tt><b>mount -F pcfs /dev/dsk/c3t0d0p0:c /mnt</b></tt></pre><p>This example shows how to mount a CD with a read-only HSFS file system:</p><pre># <tt><b>mount -F hsfs -o ro /dev/dsk/c1t0d0s2 /mnt</b></tt></pre></li>
<li><p>Unmount a USB mass storage device as superuser.</p><p>First, be sure no one is using the file system on the device.</p><p>For example:</p><pre># <tt><b>fuser -c -u /mnt</b></tt>
# <tt><b>umount /mnt</b></tt></pre></li></ul>
</li>
<li><b>Eject the device, which is optional for DVD, CD, or diskette devices.</b><p>For example:</p><pre># <tt><b>eject /dev/rdsk/c1t0d0s2</b></tt></pre></li></ol>

<a name="devusbover-45"></a><h4>Troubleshooting Tips for USB Mass Storage Devices</h4>
<p>Keep the following tips in mind if you have problems adding or
removing a USB mass storage device.<a name="indexterm-157"></a><a name="indexterm-158"></a></p><p>Check the <tt>/var/adm/messages</tt> file for failures to enumerate the device. For enumeration failures,
possibly, insert the USB hub or remove a hub and connect it directly
to a root USB hub.</p>
<ul><li><p>If USB devices are added or removed when the system is down, you must perform a reconfiguration boot.</p><pre>ok <tt><b>boot -r</b></tt></pre><p>If you have problems accessing a device that was connected while the system is running, try the following command:</p><pre># <tt><b>devfsadm</b></tt></pre></li>
<li><p>Do not move devices around if the system has been powered down by a suspend operation. For more information, see <a href="devusbover-9.html#devusbover-23">SPARC: USB Power Management</a>.</p></li>
<li><p>If a device has been hot removed while in use by applications and is no longer available, then stop the applications. Use the <tt>prtconf</tt> command to see whether the device node has been removed.</p></li></ul>


<a name="devusbtasks-59"></a><h4>Disabling Specific USB Drivers</h4>
<p>You can disable specific types of USB devices by disabling their client driver.
For example, USB printers can be disabled by disabling the <tt>usbprn</tt> driver
that directs them. Disabling <tt>usbprn</tt> does not affect other kinds of devices, such
as USB storage devices.</p><p>The following table identifies some USB device types and their corresponding drivers.</p><table><col width="21.72*"><col width="28.28*"><tr><th align="left" valign="top" scope="column"><p>Device Type</p></th>
<th align="left" valign="top" scope="column"><p>Driver
to Disable</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Audio</p></td>
<td align="left" valign="top" scope="row"><p><tt>usb_ac</tt> and <tt>usb_as</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>HID (usually keyboard and mouse)</p></td>
<td align="left" valign="top" scope="row"><p><tt>hid</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Storage</p></td>
<td align="left" valign="top" scope="row"><p><tt>scsa2usb</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Printer</p></td>
<td align="left" valign="top" scope="row"><p><tt>usbprn</tt></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Serial</p></td>
<td align="left" valign="top" scope="row"><p><tt>usbser_edge</tt></p></td>
</tr>
</table><p>If you disable a driver for a USB device that is still
connected to the system, you see a console message similar to the following:</p><pre>usba10: WARNING: usba:    no driver found for device <i>name</i></pre>

<a name="devusbtasks-56"></a><h4>How to Disable Specific USB Drivers</h4><ol>
<li><b>Become superuser.</b></li>
<li><a name="devusbtasks-step-61"></a><b>Exclude the driver alias entry from the <tt>/etc/system</tt> file.</b><p>For example, include the following exclude statement to exclude the <tt>usbprn</tt> driver.</p><pre>exclude: usbprn</pre></li>
<li><a name="devusbtasks-step-62"></a><b>Reboot the system.</b><pre># <tt><b>init 6</b></tt></pre></li></ol>

<a name="devusbtasks-33"></a><h4>How to Remove Unused USB Device Links</h4><p>Use this procedure if a USB device is removed while the system
is powered off. Removing the USB device while the system is powered off
can leave device links for devices that do not exist.</p><ol>
<li><a name="devusbtasks-step-50"></a><b>Become superuser.</b></li>
<li><a name="devusbtasks-step-40"></a><b>Close all applications that might be accessing the device.</b></li>
<li><a name="devusbtasks-step-46"></a><b>Remove the unused links for a specific USB class.</b><p>For example:</p><pre># <tt><b>devfsadm -C -c audio</b></tt></pre><p>Or, just remove the dangling links:</p><pre># <tt><b>devfsadm -C</b></tt></pre></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="devusbtasks-34.html">Previous</a>
             </td>
             <td align="right">
                 <a href="devusbtasks-36.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

