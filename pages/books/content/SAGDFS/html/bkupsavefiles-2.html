<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Copying File Systems Between Disks - System Administration Guide: Devices and File Systems</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Devices and File Systems</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="bkupsavefiles-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="bkupsavefiles-21.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol1preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="medintro-55492.html">1.&nbsp;&nbsp;Managing Removable Media (Overview)</a></p>
<p class="toc level1 tocsp"><a href="medformat-83002.html">2.&nbsp;&nbsp;Managing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medaccess-29267.html">3.&nbsp;&nbsp;Accessing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medcdrw-1.html">4.&nbsp;&nbsp;Writing CDs and DVDs (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig-27900.html">5.&nbsp;&nbsp;Managing Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig2-1.html">6.&nbsp;&nbsp;Dynamically Configuring Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devusbover-24.html">7.&nbsp;&nbsp;Using USB Devices (Overview)</a></p>
<p class="toc level1 tocsp"><a href="devusbtasks-1.html">8.&nbsp;&nbsp;Using USB Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fncpk.html">9.&nbsp;&nbsp;Using InfiniBand Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksconcepts-29477.html">10.&nbsp;&nbsp;Managing Disks (Overview)</a></p>
<p class="toc level1 tocsp"><a href="disksprep-31030.html">11.&nbsp;&nbsp;Administering Disks (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="diskssadd-16103.html">12.&nbsp;&nbsp;SPARC: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksxadd-38159.html">13.&nbsp;&nbsp;x86: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fmvcd.html">14.&nbsp;&nbsp;Configuring Solaris iSCSI Targets and Initiators (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="gfydr.html">15.&nbsp;&nbsp;Configuring and Managing the Solaris Internet Storage Name Service (iSNS)</a></p>
<p class="toc level1 tocsp"><a href="disksformat-15833.html">16.&nbsp;&nbsp;The <tt>format</tt> Utility (Reference)</a></p>
<p class="toc level1 tocsp"><a href="fsoverview-38559.html">17.&nbsp;&nbsp;Managing File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="fscreate-96442.html">18.&nbsp;&nbsp;Creating UFS, TMPFS, and LOFS File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsmount-42780.html">19.&nbsp;&nbsp;Mounting and Unmounting File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fscachefs-70682.html">20.&nbsp;&nbsp;Using The CacheFS File System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsswap-14677.html">21.&nbsp;&nbsp;Configuring Additional Swap Space (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fstroublefsck-61446.html">22.&nbsp;&nbsp;Checking UFS File System Consistency (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsfilesysappx-94408.html">23.&nbsp;&nbsp;UFS File System (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupconcepts-57422.html">24.&nbsp;&nbsp;Backing Up and Restoring File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="bkuptasks2-64128.html">25.&nbsp;&nbsp;Backing Up Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupsnapshot-2.html">26.&nbsp;&nbsp;Using UFS Snapshots (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuprestoretasks-38055.html">27.&nbsp;&nbsp;Restoring Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupref-12756.html">28.&nbsp;&nbsp;UFS Backup and Restore Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupsavefiles-17924.html">29.&nbsp;&nbsp;Copying UFS Files and File Systems (Tasks)</a></p>
<p class="toc level2"><a href="bkupsavefiles-1.html">Commands for Copying File Systems</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Copying File Systems Between Disks</a></p>
<p class="toc level3"><a href="#bkupsavefiles-60904">How to Copy a Disk (<tt>dd</tt>)</a></p>
</div>
<p class="toc level2 tocsp"><a href="bkupsavefiles-21.html">Copying Directories Between File Systems (<tt>cpio</tt> Command)</a></p>
<p class="toc level3"><a href="bkupsavefiles-21.html#bkupsavefiles-14144">How to Copy Directories Between File Systems (<tt>cpio</tt>)</a></p>
<p class="toc level2 tocsp"><a href="bkupsavefiles-38276.html">Copying Files and File Systems to Tape</a></p>
<p class="toc level2"><a href="bkupsavefiles-30.html">Copying Files to Tape (<tt>tar</tt> Command)</a></p>
<p class="toc level3"><a href="bkupsavefiles-30.html#bkupsavefiles-22962">How to Copy Files to a Tape (<tt>tar</tt>)</a></p>
<p class="toc level3"><a href="bkupsavefiles-30.html#bkupsavefiles-18134">How to List the Files on a Tape (<tt>tar</tt>)</a></p>
<p class="toc level3"><a href="bkupsavefiles-30.html#bkupsavefiles-30917">How to Retrieve Files From a Tape (<tt>tar</tt>)</a></p>
<p class="toc level2 tocsp"><a href="bkupsavefiles-47.html">Copying Files to a Tape With the <tt>pax</tt> Command</a></p>
<p class="toc level3"><a href="bkupsavefiles-47.html#bkupsavefiles-48">How to Copy Files to a Tape (<tt>pax</tt>)</a></p>
<p class="toc level2 tocsp"><a href="bkupsavefiles-129.html">Copying Files to Tape With the <tt>cpio</tt> Command</a></p>
<p class="toc level3"><a href="bkupsavefiles-129.html#bkupsavefiles-85934">How to Copy All Files in a Directory to a Tape (<tt>cpio</tt>)</a></p>
<p class="toc level3"><a href="bkupsavefiles-129.html#bkupsavefiles-30690">How to List the Files on a Tape (<tt>cpio</tt>)</a></p>
<p class="toc level3"><a href="bkupsavefiles-129.html#bkupsavefiles-66148">How to Retrieve All Files From a Tape (<tt>cpio</tt>)</a></p>
<p class="toc level3"><a href="bkupsavefiles-129.html#bkupsavefiles-86108">How to Retrieve Specific Files From a Tape (<tt>cpio</tt>)</a></p>
<p class="toc level2 tocsp"><a href="bkupsavefiles-130.html">Copying Files to a Remote Tape Device</a></p>
<p class="toc level3"><a href="bkupsavefiles-130.html#bkupsavefiles-17981">How to Copy Files to a Remote Tape Device (<tt>tar</tt> and <tt>dd</tt>)</a></p>
<p class="toc level3"><a href="bkupsavefiles-130.html#bkupsavefiles-74428">How to Extract Files From a Remote Tape Device</a></p>
<p class="toc level2 tocsp"><a href="bkupsavefiles-60201.html">Copying Files and File Systems to Diskette</a></p>
<p class="toc level3"><a href="bkupsavefiles-60201.html#bkupsavefiles-84545">How to Copy Files to a Single Formatted Diskette (<tt>tar</tt>)</a></p>
<p class="toc level3"><a href="bkupsavefiles-60201.html#bkupsavefiles-78890">How to List the Files on a Diskette (<tt>tar</tt>)</a></p>
<p class="toc level3"><a href="bkupsavefiles-60201.html#bkupsavefiles-53640">How to Retrieve Files From a Diskette (<tt>tar</tt>)</a></p>
<p class="toc level1 tocsp"><a href="bkuptapedevice-42512.html">30.&nbsp;&nbsp;Managing Tape Drives (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="bkupsavefiles-2"></a><h3>Copying File Systems Between Disks</h3>
<p>Two commands are used to copy file systems between disks:</p>
<ul><li><p><tt>volcopy</tt></p></li>
<li><p><tt>dd</tt></p></li></ul>
<p>For more information about <tt>volcopy</tt>, see <a href="http://docs.sun.com/doc/819-2240/volcopy-1m?a=view"><tt>volcopy</tt>(1M)</a>.</p><p>The next section describes how to use the <tt>dd</tt> command to copy file
systems between disks.</p>

<a name="bkupsavefiles-3"></a><h4>Making a Literal File System Copy</h4>
<p><a name="bkupsavefiles-ix3118"></a><a name="bkupsavefiles-ix3119"></a><a name="bkupsavefiles-ix3120"></a>The <tt>dd</tt> command makes a literal (block-level) copy of a complete UFS file
system to another file system or to a tape. By default, the <tt>dd</tt>
command copies standard input to standard output.   </p>
<hr><p><b>Note - </b>Do not use the <tt>dd</tt> command with variable-length tape drives without first specifying
an appropriate block size.</p>
<hr>
<p>You can specify a device name in place of standard input or
standard output, or both. In this example, the contents of the diskette are
copied to a file in the <tt>/tmp</tt> directory:</p><pre>$ <tt><b>dd &lt; /floppy/floppy0 > /tmp/output.file</b></tt>
2400+0 records in
2400+0 records out</pre><p>The <tt>dd</tt> command reports on the number of blocks it reads and writes.
The number after the <tt>+</tt> is a count of the partial blocks that
were copied. The default block size is 512 bytes.</p><p>The <tt>dd</tt> command syntax is different from most other commands. Options are specified
as <i>keyword</i>=<i>value</i> pairs, where <i>keyword</i> is the option you want to set and
<i>value</i> is the argument for that option. For example, you can replace standard
input and standard output with this syntax: </p><pre>$ <tt><b>dd if=</b></tt><i>input-file</i> <tt><b>of=</b></tt><i>output-file</i></pre><p>To use the <i>keyword</i>=<i>value</i> pairs instead of the redirect symbols, you would type
the following:</p><pre>$ <tt><b>dd if=/floppy/floppy0 of=/tmp/output.file</b></tt></pre>

<a name="bkupsavefiles-60904"></a><h4>How to Copy a Disk (<tt>dd</tt>)</h4><p>Keep the following key points in mind when you consider copying a
disk:</p>
<ul><li><p>Do not use this procedure to copy a disk that is under the control of a volume manager.</p></li>
<li><p>The primary methods for copying UFS file system data from one disk or system to another disk or system is by using the <tt>ufsdump</tt> and <tt>ufsrestore</tt> commands. For more information on using these commands, see <a href="bkupconcepts-57422.html">Chapter&nbsp;24, Backing Up and Restoring File Systems (Overview)</a>.</p></li>
<li><p>You can clone systems by creating a flash archive and copying it to destination systems. For more information about creating a flash archive, see <a href="http://docs.sun.com/doc/819-2397"><i>Solaris Express Installation Guide: Solaris Flash Archives (Creation and Installation)</i></a>.</p></li>
<li><p>If you are copying a disk with an EFI disk label, see <a href="#fpyma">Example&nbsp;29-2</a>.</p></li></ul>
<p>If you are still considering copying a disk with the <tt>dd</tt> command keep
the following cautions in mind:</p>
<ul><li><p>Make sure that the source disk and destination disk have the same disk geometry.</p></li>
<li><p>Check the UFS file systems on the disk to be copied with the <tt>fsck</tt> utility.</p></li>
<li><p>Make sure the system is in single-user mode when copying a disk with the <tt>dd</tt> command.</p></li></ul>
<ol>
<li><a name="bkupsavefiles-step-6"></a><b>Become superuser or assume an equivalent role.</b></li>
<li><a name="bkupsavefiles-step-8"></a><b>Shut down the system.</b><pre># <tt><b>init 0</b></tt></pre></li>
<li><a name="bkupsavefiles-step-9"></a><b>Attach the destination disk to the system.</b></li>
<li><a name="bkupsavefiles-step-10"></a><b>Boot the system.</b><pre>ok <tt><b>boot -s</b></tt></pre></li>
<li><a name="bkupsavefiles-step-11"></a><b><a name="bkupsavefiles-ix3123"></a>Copy the source disk to the destination disk. </b><pre># <tt><b>dd if=/dev/rdsk/</b></tt><i>device-name</i> <tt><b>of=/dev/rdsk/</b></tt><i>device-name</i> <tt><b>bs=</b></tt><i>block-size</i></pre><dl><dt><tt>if=/dev/rdsk/</tt><i>device-name</i></dt>
<dd><p>Represents the overlap slice of the master disk device, usually slice 2.</p></dd>
<dt><tt>of=/dev/rdsk/</tt><i>device-name</i></dt>
<dd><p>Represents the overlap slice of the destination disk device, usually slice 2.</p></dd>
<dt><tt>bs=</tt><i>blocksize</i></dt>
<dd><p>Identifies the block size, such as 128 Kbytes or 256 Kbytes. A large block size decreases the time it takes to copy the disk.</p></dd>
</dl>
<p>For more information, see <a href="http://docs.sun.com/doc/819-2240/dd-1m?a=view"><tt>dd</tt>(1M)</a>.</p></li>
<li><a name="bkupsavefiles-step-114"></a><b>Check the new file system.</b><pre># <tt><b>fsck /dev/rdsk/</b></tt><i>device-name</i></pre></li>
<li><a name="bkupsavefiles-step-12"></a><b>Mount the destination disk's root (<tt>/</tt>) file system.</b><pre># <tt><b>mount /dev/dsk/</b></tt><i>device-name</i> <tt><b>/mnt</b></tt></pre></li>
<li><b>Change to the directory where the <tt>/etc/vfstab</tt> file is located.</b><pre># <tt><b>cd /mnt/etc</b></tt></pre></li>
<li><a name="bkupsavefiles-step-13"></a><b>Using a text editor, edit the destination disk's <tt>/etc/vfstab</tt> file to reference the
correct device names.</b><p>For example, change all instances of <tt>c0t3d0</tt> to <tt>c0t1d0</tt>.</p></li>
<li><b>Change to the destination disk's root (<tt>/</tt>) directory.</b><pre># <tt><b>cd /</b></tt></pre></li>
<li><a name="bkupsavefiles-step-14"></a><b>Unmount the destination disk's root (<tt>/</tt>) file system.</b><pre># <tt><b>umount /mnt</b></tt></pre></li>
<li><a name="bkupsavefiles-step-15"></a><b>Shut down the system.</b><pre># <tt><b>init 0</b></tt></pre></li>
<li><a name="bkupsavefiles-step-16"></a><b>Boot from the destination disk to single-user mode.</b><pre># <tt><b>boot disk</b></tt><i>n</i> <tt><b>-s</b></tt></pre>
<hr><p><b>Note - </b>The <tt>installboot</tt> command is not needed for the destination disk because the boot
blocks are copied as part of the overlap slice.</p>
<hr>
</li>
<li><a name="bkupsavefiles-step-17"></a><b>Unconfigure the destination disk.</b><pre># <tt><b>sys-unconfig</b></tt></pre><p>The system is shut down after it is unconfigured.</p></li>
<li><a name="bkupsavefiles-step-18"></a><b>Boot from the destination disk again and provide its system information, such as
host name, time zone, and so forth. </b><pre># <tt><b>boot disk</b></tt><i>n</i></pre></li>
<li><a name="bkupsavefiles-step-115"></a><b>After the system is booted, log in as superuser to verify the system
information.</b><pre><i>hostname</i> console login:</pre></li></ol><a name="fncrt"></a>Example&nbsp;29-1 Copying a Disk With a VTOC Label (<tt>dd</tt>)<p>This example shows how to copy the master disk (with a VTOC
label) <tt>/dev/rdsk/c0t0d0s2</tt> to the destination disk <tt>/dev/rdsk/c0t2d0s2</tt>.</p><pre># <tt><b>init 0</b></tt>
ok <tt><b>boot</b></tt>
# <tt><b>dd if=/dev/rdsk/c0t0d0s2 of=/dev/rdsk/c0t2d0s2</b></tt> <tt><b>bs=128k</b></tt>
# <tt><b>fsck /dev/rdsk/c0t2d0s2</b></tt>
# <tt><b>mount /dev/dsk/c0t2d0s2 /mnt</b></tt> 
# <tt><b>cd /mnt/etc</b></tt>
# <tt><b>vi vfstab</b></tt>
(<i>Modify entries for the new disk</i>)
# <tt><b>cd /</b></tt>
# <tt><b>umount /mnt</b></tt>
# <tt><b>init 0</b></tt>
# <tt><b>boot disk2 -s</b></tt>
# <tt><b>sys-unconfig</b></tt>
# <tt><b>boot disk2</b></tt></pre><a name="fpyma"></a>Example&nbsp;29-2 Copying a Disk with an EFI Label (<tt>dd</tt>)<p>In previous Solaris releases, slice 2 (<tt>s2</tt>) was used to represent the entire
disk. On a disk with an EFI label, you must use a slightly
different procedure to clone or copy disks larger than 1 terabyte so that
the UUID of cloned disks is unique. If you do not create
a new label for the cloned disk, other software products might corrupt data
on EFI-labeled disks if they encounter duplicate UUIDs.</p><p>For example:</p>
<ol><li><p>Clone the disk with an EFI label. For example:</p><pre># <tt><b>dd if=/dev/rdsk/c0t0d0 of=/dev/rdsk/c0t2d0 bs=128k</b></tt></pre></li>
<li><p>Pipe the <tt>prtvtoc</tt> output of the disk to be copied to the <tt>fmthard</tt> command to create a new label for the cloned disk. For example:</p><pre># <tt><b>prtvtoc /dev/rdsk/c0t0d0 | fmthard -s - /dev/rdsk/c0t2d0</b></tt></pre></li></ol>
<p>For more information about EFI disk labels, see <a href="disksconcepts-1.html#disksconcepts-14">EFI Disk Label</a>.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="bkupsavefiles-1.html">Previous</a>
             </td>
             <td align="right">
                 <a href="bkupsavefiles-21.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

