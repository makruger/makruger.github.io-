<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Recovering a Corrupted Disk Label - System Administration Guide: Devices and File Systems</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Devices and File Systems</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="disksprep-34.html">Previous</a>
             </td>
             <td align="right">
                 <a href="disksprep-67.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol1preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="medintro-55492.html">1.&nbsp;&nbsp;Managing Removable Media (Overview)</a></p>
<p class="toc level1 tocsp"><a href="medformat-83002.html">2.&nbsp;&nbsp;Managing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medaccess-29267.html">3.&nbsp;&nbsp;Accessing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medcdrw-1.html">4.&nbsp;&nbsp;Writing CDs and DVDs (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig-27900.html">5.&nbsp;&nbsp;Managing Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig2-1.html">6.&nbsp;&nbsp;Dynamically Configuring Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devusbover-24.html">7.&nbsp;&nbsp;Using USB Devices (Overview)</a></p>
<p class="toc level1 tocsp"><a href="devusbtasks-1.html">8.&nbsp;&nbsp;Using USB Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fncpk.html">9.&nbsp;&nbsp;Using InfiniBand Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksconcepts-29477.html">10.&nbsp;&nbsp;Managing Disks (Overview)</a></p>
<p class="toc level1 tocsp"><a href="disksprep-31030.html">11.&nbsp;&nbsp;Administering Disks (Tasks)</a></p>
<p class="toc level2"><a href="disksprep-1.html">Administering Disks (Task Map)</a></p>
<p class="toc level2"><a href="disksprep-3.html">Identifying Disks on a System</a></p>
<p class="toc level3"><a href="disksprep-3.html#disksprep-24293">How to Identify the Disks on a System</a></p>
<p class="toc level2 tocsp"><a href="disksprep-10.html">Formatting a Disk</a></p>
<p class="toc level3"><a href="disksprep-10.html#disksprep-37081">How to Determine if a Disk Is Formatted</a></p>
<p class="toc level3"><a href="disksprep-10.html#disksprep-24584">How to Format a Disk</a></p>
<p class="toc level2 tocsp"><a href="disksprep-24.html">Displaying Disk Slices</a></p>
<p class="toc level3"><a href="disksprep-24.html#disksprep-23207">How to Display Disk Slice Information</a></p>
<p class="toc level2 tocsp"><a href="disksprep-34.html">Creating and Examining a Disk Label</a></p>
<p class="toc level3"><a href="disksprep-34.html#disksprep-32432">How to Label a Disk</a></p>
<p class="toc level3"><a href="disksprep-34.html#disksprep-15875">How to Examine a Disk Label</a></p>
<div class="onpage">
<p class="toc level2 tocsp"><a href="">Recovering a Corrupted Disk Label</a></p>
<p class="toc level3"><a href="#disksprep-22071">How to Recover a Corrupted Disk Label</a></p>
</div>
<p class="toc level2 tocsp"><a href="disksprep-67.html">Adding a Third-Party Disk</a></p>
<p class="toc level3"><a href="disksprep-67.html#disksprep-17927">How to Create a <tt>format.dat</tt> Entry</a></p>
<p class="toc level2 tocsp"><a href="disksprep-72.html">Automatically Configuring SCSI Disk Drives</a></p>
<p class="toc level3"><a href="disksprep-72.html#disksprep-24067">How to Automatically Configure a SCSI Drive</a></p>
<p class="toc level2 tocsp"><a href="disksprep-87.html">Repairing a Defective Sector</a></p>
<p class="toc level3"><a href="disksprep-87.html#disksprep-27270">How to Identify a Defective Sector by Using Surface Analysis</a></p>
<p class="toc level3"><a href="disksprep-87.html#disksprep-31929">How to Repair a Defective Sector</a></p>
<p class="toc level2 tocsp"><a href="disksprep-101.html">Tips and Tricks for Managing Disks</a></p>
<p class="toc level1 tocsp"><a href="diskssadd-16103.html">12.&nbsp;&nbsp;SPARC: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksxadd-38159.html">13.&nbsp;&nbsp;x86: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fmvcd.html">14.&nbsp;&nbsp;Configuring Solaris iSCSI Targets and Initiators (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="gfydr.html">15.&nbsp;&nbsp;Configuring and Managing the Solaris Internet Storage Name Service (iSNS)</a></p>
<p class="toc level1 tocsp"><a href="disksformat-15833.html">16.&nbsp;&nbsp;The <tt>format</tt> Utility (Reference)</a></p>
<p class="toc level1 tocsp"><a href="fsoverview-38559.html">17.&nbsp;&nbsp;Managing File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="fscreate-96442.html">18.&nbsp;&nbsp;Creating UFS, TMPFS, and LOFS File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsmount-42780.html">19.&nbsp;&nbsp;Mounting and Unmounting File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fscachefs-70682.html">20.&nbsp;&nbsp;Using The CacheFS File System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsswap-14677.html">21.&nbsp;&nbsp;Configuring Additional Swap Space (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fstroublefsck-61446.html">22.&nbsp;&nbsp;Checking UFS File System Consistency (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsfilesysappx-94408.html">23.&nbsp;&nbsp;UFS File System (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupconcepts-57422.html">24.&nbsp;&nbsp;Backing Up and Restoring File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="bkuptasks2-64128.html">25.&nbsp;&nbsp;Backing Up Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupsnapshot-2.html">26.&nbsp;&nbsp;Using UFS Snapshots (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuprestoretasks-38055.html">27.&nbsp;&nbsp;Restoring Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupref-12756.html">28.&nbsp;&nbsp;UFS Backup and Restore Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupsavefiles-17924.html">29.&nbsp;&nbsp;Copying UFS Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuptapedevice-42512.html">30.&nbsp;&nbsp;Managing Tape Drives (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="disksprep-52"></a><h3>Recovering a Corrupted Disk Label</h3>
<p><a name="disksprep-ix2499"></a>Sometimes, a power or system failure causes a disk's label to become unrecognizable.
A corrupted disk label doesn't always mean that the slice information or the
disk's data must be re-created or restored. </p><p>The first step to recovering a corrupted disk label is to label
the disk with the correct geometry and disk type information. You can complete this
step through the normal disk labeling method, by using either automatic configuration or
manual disk type specification.</p><p>If the <tt>format</tt> utility recognizes the disk type, the next step is to
search for a backup label to label the disk. Labeling the disk with
the backup label labels the disk with the correct partitioning information, the disk
type, and disk geometry.</p>

<a name="disksprep-22071"></a><h4>How to Recover a Corrupted Disk Label</h4><ol>
<li><a name="disksprep-step-54"></a><b>Boot the system to single-user mode.</b><p>If necessary, boot the system from a local CD-ROM or the network
in single-user mode to access the disk. <a name="indexterm-253"></a></p><p>See <a href="http://docs.sun.com/doc/819-2379/hbsparcboot-79782?a=view">Chapter 10, Booting a System (Tasks), in <i>System Administration Guide: Basic Administration</i></a> or <a href="http://docs.sun.com/doc/819-2379/hbx86boot-68676?a=view">Chapter 12, Booting a Solaris System With GRUB (Tasks), in <i>System Administration Guide: Basic Administration</i></a> for information on booting the system.</p></li>
<li><a name="disksprep-step-55"></a><b><a name="disksprep-ix2500"></a>Relabel the disk. </b><pre># <tt><b>format</b></tt></pre><p>The <tt>format</tt> utility attempts to automatically configure any unlabeled SCSI disk. If the
<tt>format</tt> utility is able to configure the unlabeled and corrupted disk, it will
display this message:</p><pre>c<i>w</i>t<i>x</i>d<i>y</i>: configured with capacity of <i>abc</i>MB</pre><p>The <tt>format</tt> utility then displays a numbered list of disks on the system.</p></li>
<li><a name="disksprep-step-56"></a><b>Type the number of the disk that you need to recover.</b><pre>Specify disk (enter its number): <tt><b>1</b></tt></pre></li>
<li><a name="disksprep-step-57"></a><b>Select one of the following to determine how to label the disk.</b>
<ul><li><p>If the disk was configured successfully, follow Steps 5 and 6. Then go to step 12.</p></li>
<li><p>If the disk was not configured successfully, follow Steps 7&ndash;11. Then go to step 12.</p></li></ul>
</li>
<li><a name="disksprep-step-58"></a><b>Search for the backup label.</b><pre>format> <tt><b>verify</b></tt>
Warning: Could not read primary label.
Warning: Check the current partitioning and 'label' the disk or 
use the 'backup' command.
Backup label contents:
Volume name = &lt;        >
ascii name  = &lt;SUN1.05 cyl 2036 alt 2 hd 14 sec 72>
pcyl        = 2038
ncyl        = 2036
acyl        =    2
nhead       =   14
nsect       =   72
Part      Tag    Flag     Cylinders        Size            Blocks
  0       root    wm       0 -  300      148.15MB    (301/0/0)   303408
  1       swap    wu     301 -  524      110.25MB    (224/0/0)   225792
  2     backup    wm       0 - 2035     1002.09MB    (2036/0/0) 2052288
  3 unassigned    wm       0               0         (0/0/0)          0
  4 unassigned    wm       0               0         (0/0/0)          0
  5 unassigned    wm       0               0         (0/0/0)          0
  6        usr    wm     525 - 2035      743.70MB    (1511/0/0) 1523088
  7 unassigned    wm       0               0         (0/0/0)          0</pre></li>
<li><a name="disksprep-step-59"></a><b>If the <tt>format</tt> utility was able to find a backup label and the
backup label contents appear satisfactory, use the <tt>backup</tt> command to label the disk
with the backup label.</b><pre>format> <tt><b>backup</b></tt>
Disk has a primary label, still continue? <tt><b>y</b></tt>
 
Searching for backup labels...found.
Restoring primary label</pre><p>The disk label has been recovered. Go to Step 12.</p></li>
<li><a name="disksprep-step-60"></a><b>If the <tt>format</tt> utility was not able to automatically configure the disk, specify
the disk type by using the <tt>type</tt> command.</b><pre>format> <tt><b>type</b></tt></pre><p>The Available Drives Type menu is displayed.</p></li>
<li><a name="disksprep-step-61"></a><b>Select <tt>0</tt> to automatically configure the disk. Or, select a disk type from
the list of possible disk types.</b><pre>Specify disk type (enter its number)[12]: <tt><b>12</b></tt></pre></li>
<li><a name="disksprep-step-62"></a><b>If the disk was successfully configured, reply with <tt>no</tt> when the <tt>format</tt> utility asks
if you want to label the disk.</b><pre>Disk not labeled.  Label it now?  <tt><b>no</b></tt></pre></li>
<li><a name="disksprep-step-63"></a><b>Use the <tt>verify</tt> command to search for backup labels.</b><pre>format> <tt><b>verify</b></tt>
Warning: Could not read primary label.
Warning: Check the current partitioning and 'label' the disk
or use the 'backup' command.
.
.
.</pre></li>
<li><a name="disksprep-step-64"></a><b>If the <tt>format</tt> utility was able to find a backup label and the
backup label contents appear satisfactory, use the <tt>backup</tt> command to label the disk
with the backup label.</b><pre>format> <tt><b>backup</b></tt>
Disk has a primary label, still continue? <tt><b>y</b></tt>
Searching for backup labels...found.
Restoring primary label</pre><p>The disk label has been recovered.</p></li>
<li><a name="disksprep-step-65"></a><b>Exit the <tt>format</tt> utility.</b><pre>format> <tt><b>q</b></tt></pre></li>
<li><a name="disksprep-step-66"></a><b>Verify the file systems on the recovered disk by using the <tt>fsck</tt> command.</b><p>For information on using the <tt>fsck</tt> command, see <a href="fstroublefsck-61446.html">Chapter&nbsp;22, Checking UFS File System Consistency (Tasks)</a>.</p></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="disksprep-34.html">Previous</a>
             </td>
             <td align="right">
                 <a href="disksprep-67.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

