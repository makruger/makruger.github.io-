<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Maintaining a CacheFS File System - System Administration Guide: Devices and File Systems</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Devices and File Systems</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="fscachefs-23.html">Previous</a>
             </td>
             <td align="right">
                 <a href="fscachefs-15.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol1preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="medintro-55492.html">1.&nbsp;&nbsp;Managing Removable Media (Overview)</a></p>
<p class="toc level1 tocsp"><a href="medformat-83002.html">2.&nbsp;&nbsp;Managing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medaccess-29267.html">3.&nbsp;&nbsp;Accessing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medcdrw-1.html">4.&nbsp;&nbsp;Writing CDs and DVDs (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig-27900.html">5.&nbsp;&nbsp;Managing Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig2-1.html">6.&nbsp;&nbsp;Dynamically Configuring Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devusbover-24.html">7.&nbsp;&nbsp;Using USB Devices (Overview)</a></p>
<p class="toc level1 tocsp"><a href="devusbtasks-1.html">8.&nbsp;&nbsp;Using USB Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fncpk.html">9.&nbsp;&nbsp;Using InfiniBand Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksconcepts-29477.html">10.&nbsp;&nbsp;Managing Disks (Overview)</a></p>
<p class="toc level1 tocsp"><a href="disksprep-31030.html">11.&nbsp;&nbsp;Administering Disks (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="diskssadd-16103.html">12.&nbsp;&nbsp;SPARC: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksxadd-38159.html">13.&nbsp;&nbsp;x86: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fmvcd.html">14.&nbsp;&nbsp;Configuring Solaris iSCSI Targets and Initiators (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="gfydr.html">15.&nbsp;&nbsp;Configuring and Managing the Solaris Internet Storage Name Service (iSNS)</a></p>
<p class="toc level1 tocsp"><a href="disksformat-15833.html">16.&nbsp;&nbsp;The <tt>format</tt> Utility (Reference)</a></p>
<p class="toc level1 tocsp"><a href="fsoverview-38559.html">17.&nbsp;&nbsp;Managing File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="fscreate-96442.html">18.&nbsp;&nbsp;Creating UFS, TMPFS, and LOFS File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsmount-42780.html">19.&nbsp;&nbsp;Mounting and Unmounting File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fscachefs-70682.html">20.&nbsp;&nbsp;Using The CacheFS File System (Tasks)</a></p>
<p class="toc level2"><a href="fscachefs-16.html">High-Level View of Using the CacheFS File System (Task Map)</a></p>
<p class="toc level2"><a href="fscachefs-14.html">Overview of the CacheFS File System</a></p>
<p class="toc level2"><a href="fscachefs-80158.html">Creating and Mounting a CacheFS File System (Task Map)</a></p>
<p class="toc level3"><a href="fscachefs-80158.html#fscachefs-15053">How to Create the Cache</a></p>
<p class="toc level3"><a href="fscachefs-80158.html#fscachefs-77212">How to Mount a CacheFS File System (<tt>mount</tt>)</a></p>
<p class="toc level3"><a href="fscachefs-80158.html#fscachefs-23416">How to Mount a CacheFS File System (<tt>/etc/vfstab</tt>)</a></p>
<p class="toc level3"><a href="fscachefs-80158.html#fscachefs-54948">How to Mount a CacheFS File System (AutoFS)</a></p>
<p class="toc level2 tocsp"><a href="fscachefs-23.html">Maintaining a CacheFS File System (Task Map)</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Maintaining a CacheFS File System</a></p>
<p class="toc level3"><a href="#fscachefs-58683">How to Display Information About a CacheFS File System</a></p>
<p class="toc level3"><a href="#fscachefs-87412">How to Specify Cache Consistency Checking on Demand</a></p>
<p class="toc level3"><a href="#fscachefs-10353">How to Delete a CacheFS File System</a></p>
<p class="toc level3"><a href="#fscachefs-17439">How to Check the Integrity of a CacheFS File System</a></p>
</div>
<p class="toc level2 tocsp"><a href="fscachefs-15.html">Packing a Cached File System (Task Map)</a></p>
<p class="toc level2"><a href="fscachepack-80612.html">Packing a CacheFS File System</a></p>
<p class="toc level3"><a href="fscachepack-80612.html#fscachepack-80613">How to Pack Files in the Cache</a></p>
<p class="toc level3"><a href="fscachepack-80612.html#fscachepack-21">How to Display Packed Files Information</a></p>
<p class="toc level3"><a href="fscachepack-80612.html#fscachepack-17738">How to Create a Packing List</a></p>
<p class="toc level3"><a href="fscachepack-80612.html#fscachepack-5">How to Pack Files in the Cache With a Packing List</a></p>
<p class="toc level3"><a href="fscachepack-80612.html#fscachepack-18">How to Unpack Files or Packing Lists From the Cache</a></p>
<p class="toc level2 tocsp"><a href="fscachefsref-26610.html">Collecting CacheFS Statistics (Task Map)</a></p>
<p class="toc level2"><a href="fscachefsref-38278.html">Collecting CacheFS Statistics</a></p>
<p class="toc level3"><a href="fscachefsref-38278.html#fscachefs-5">How to Set Up CacheFS Logging</a></p>
<p class="toc level3"><a href="fscachefsref-38278.html#fscachefs-8">How to Locate the CacheFS Log File</a></p>
<p class="toc level3"><a href="fscachefsref-38278.html#fscachefsref-71516">How to View the Working Set (Cache) Size</a></p>
<p class="toc level3"><a href="fscachefsref-38278.html#fscachefsref-35885">How to View CacheFS Statistics</a></p>
<p class="toc level1 tocsp"><a href="fsswap-14677.html">21.&nbsp;&nbsp;Configuring Additional Swap Space (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fstroublefsck-61446.html">22.&nbsp;&nbsp;Checking UFS File System Consistency (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsfilesysappx-94408.html">23.&nbsp;&nbsp;UFS File System (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupconcepts-57422.html">24.&nbsp;&nbsp;Backing Up and Restoring File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="bkuptasks2-64128.html">25.&nbsp;&nbsp;Backing Up Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupsnapshot-2.html">26.&nbsp;&nbsp;Using UFS Snapshots (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuprestoretasks-38055.html">27.&nbsp;&nbsp;Restoring Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupref-12756.html">28.&nbsp;&nbsp;UFS Backup and Restore Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupsavefiles-17924.html">29.&nbsp;&nbsp;Copying UFS Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuptapedevice-42512.html">30.&nbsp;&nbsp;Managing Tape Drives (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="fscachefs-24"></a><h3>Maintaining a CacheFS File System</h3>
<p>This section describes how to maintain a CacheFS file system.</p><p>If you are using the <tt>/etc/vfstab</tt> file to mount file systems, you modify
the cache by editing the file system options in the <tt>/etc/vfstab</tt> file.
If you are using AutoFS, you modify the cache by editing the file
system options in the AutoFS maps.</p>

<a name="fscachefs-76686"></a><h4>Modifying a CacheFS File System</h4>
<p>When you modify a file system in the cache, you need to
delete the cache and then re-create it. You might also need to reboot
your machine in single-user mode, depending on how your file systems are shared
and accessed.</p><p>In the following example, the cache is deleted, re-created, and then mounted again
by using <tt>demandconst</tt> option specified for the <tt>/docs</tt> file system.</p><pre># <tt><b>shutdown -g30 -y</b></tt>
.
.
.
Root password for system maintenance (control-d to bypass):
single-user privilege assigned to /dev/console. 

.
.
.
<b>Here is where you might be prompted to run fsck on the</b>
<b>file system where the cache is located.</b>

# <tt><b>fsck /local</b></tt>
# <tt><b>mount /local</b></tt>
# <tt><b>cfsadmin -d all /local/mycache</b></tt>
# <tt><b>cfsadmin -c /local/mycache</b></tt>
# <tt><b>init 6</b></tt>
.
.
.
console login:
password:
# <tt><b>mount -F cachefs -o backfstype=nfs,cachedir=/local/cache1,demandconst</b></tt>
<tt><b>merlin:/docs /docs</b></tt>
#</pre>

<a name="fscachefs-58683"></a><h4>How to Display Information About a CacheFS File System</h4><ol>
<li><a name="fscachefs-step-28"></a><b>Become superuser on the client system.</b></li>
<li><a name="fscachefs-step-29"></a><b><a name="fscachefs-ix2842"></a>Display information about all file systems cached under a specified cache. </b><pre># <tt><b>cfsadmin -l</b></tt> <i>/cache-directory</i></pre><p>where <i>/cache-directory</i> is the name of the directory where the cache resides.</p></li></ol><a name="fncre"></a>Example&nbsp;20-5 Displaying Information About CacheFS File Systems<p>The following example shows information about the <tt>/local/mycache</tt> cache directory. In this example,
the <tt>/docs</tt> file system is cached in <tt>/local/mycache</tt>. The last line displays the name
of the CacheFS file system.</p><pre># <tt><b>cfsadmin -l /local/mycache</b></tt>
cfsadmin: list cache FS information
   maxblocks     90%
   minblocks      0%
   threshblocks  85%
   maxfiles      90%
   minfiles       0%
   threshfiles   85%
   maxfilesize    3MB
merlin:_docs:_docs
#</pre>

<a name="fscachefsref-65406"></a><h4>Consistency Checking of a CacheFS File System</h4>
<p>To ensure that the cached directories and files remain current, the CacheFS software
periodically checks the consistency of files stored in the cache. To check consistency,
the CacheFS software compares the current modification time to the previous modification time.
If the modification times are different, all data and attributes for the directory
or file are purged from the cache. Then, new data and attributes are
retrieved from the back file system.</p>

<a name="fscachefsref-41458"></a><h5>Consistency Checking on Demand</h5>
<p>Consistency checks can be performed only when you explicitly request checks for file
systems that are mounted by using the <tt>-o demandconst</tt> option. If you mount a
file system in a cache with this option, then use the <tt>cfsadmin</tt>
command with the <tt>-s</tt> option to request a consistency check. By default, consistency
checking is performed file by file as the files are accessed. If no
files are accessed, no checks are performed. Using the <tt>-o demandconst</tt> option avoids
the situation where the network is flooded with consistency checks. </p><p>For more information, see <a href="http://docs.sun.com/doc/819-2240/mount-cachefs-1m?a=view"><tt>mount_cachefs</tt>(1M)</a>.</p>

<a name="fscachefs-87412"></a><h4>How to Specify Cache Consistency Checking on Demand</h4><ol>
<li><a name="fscachefs-step-32"></a><b>Become superuser on the client system.</b></li>
<li><a name="fscachefs-step-33"></a><b>Mount the file system in the cache and specify cache consistency checking.</b><pre># <tt><b>mount -F cachefs -o backfstype=nfs,cachedir=</b></tt><i>/directory</i><tt><b>,demandconst</b></tt>
<i>server:/file-system</i> <i>/mount-point</i></pre></li>
<li><a name="fscachefs-step-34"></a><b>Initiate consistency checking on a specific CacheFS file system.</b><pre># <tt><b>cfsadmin -s</b></tt> <i>/mount-point</i></pre></li></ol>

<a name="fscachefs-10353"></a><h4>How to Delete a CacheFS File System</h4><ol>
<li><a name="fscachefs-step-37"></a><b>Become superuser on the client system.</b></li>
<li><a name="fscachefs-step-38"></a><b>Unmount the CacheFS file system.</b><pre># <tt><b>umount</b></tt> <i>/mount-point</i></pre><p>where <i>/mount-point</i> specifies the CacheFS file system that you want to delete.</p></li>
<li><a name="fscachefs-step-39"></a><b>Determine the name of the CacheFS file system (cache ID).</b><pre># <tt><b>cfsadmin -l</b></tt> <i>/cache-directory</i>
cfsadmin: list cache FS information
   maxblocks     90%
   minblocks      0%
   threshblocks  85%
   maxfiles      90%
   minfiles       0%
   threshfiles   85%
   maxfilesize    3MB
<i>cache-ID</i>
#</pre></li>
<li><a name="fscachefs-step-40"></a><b><a name="fscachefs-ix2843"></a><a name="fscachefs-ix2844"></a><a name="fscachefs-ix2845"></a>Delete the CacheFS file system from the specified cache.   </b><pre># <tt><b>cfsadmin -d</b></tt> <i>cache-ID</i> <i>/cache-directory</i></pre><dl><dt><i>cache-ID</i></dt>
<dd><p>Indicates the name of the CacheFS file system, which is the last line of the <tt>cfsadmin -l</tt> output. For more information, see <a href="#fscachefs-58683">How to Display Information About a CacheFS File System</a>. You can delete all the CacheFS file systems in a particular cache by specifying <tt>all</tt> for <i>cache-ID</i>.</p></dd>
<dt><i>/cache-directory</i></dt>
<dd><p>Specifies the directory where the cache resides.</p></dd>
</dl>
</li>
<li><a name="fscachefs-step-41"></a><b>Verify that the CacheFS file system has been deleted.</b><p>The cache ID of the file system you just deleted should be missing
from the <tt>cfsadmin</tt> <tt>-l</tt> output.</p><pre># <tt><b>cfsadmin -l</b></tt> <i>/cache-directory</i>
cfsadmin: list cache FS information
   maxblocks     90%
   minblocks      0%
   threshblocks  85%
   maxfiles      90%
   minfiles       0%
   threshfiles   85%
   maxfilesize    3MB
# </pre><p>For more information about the fields that are specified in the command output,
refer to <a href="http://docs.sun.com/doc/819-2240/cfsadmin-1m?a=view"><tt>cfsadmin</tt>(1M)</a>.</p></li>
<li><a name="fscachefs-step-17"></a><b>Update the resource counts for the cache.</b><pre># <tt><b>fsck -F cachefs</b></tt> <i>/cache-directory</i></pre><p>For more information, see <a href="#fscachefs-17439">How to Check the Integrity of a CacheFS File System</a>.</p></li></ol><a name="fncrc"></a>Example&nbsp;20-6 Deleting a CacheFS File System<p>The following example shows how to delete the file systems from the cache.</p><pre># <tt><b>umount /cfssrc</b></tt>
# <tt><b>cfsadmin -l /cfssrc</b></tt>
# <tt><b>cfsadmin -d _dev_dsk_c0t6d0s0:_cfssrc</b></tt>
# <tt><b>cfsadmin -l</b></tt>
# <tt><b>fsck -F cachefs</b></tt> <i>/cache-directory</i></pre>

<a name="fscachefs-17439"></a><h4>How to Check the Integrity of a CacheFS File System</h4><p>Use the <tt>fsck</tt> command to check the integrity of CacheFS file systems. The
CacheFS version of the <tt>fsck</tt> command automatically corrects problems without requiring user interaction.
You should not need to run the <tt>fsck</tt> command manually for CacheFS file
systems because the <tt>fsck</tt> command is run automatically at boot time or when the
file system is mounted. If you want to manually check the integrity, you
can use the following procedure. </p><p>For more information, see <a href="http://docs.sun.com/doc/819-2240/fsck-cachefs-1m?a=view"><tt>fsck_cachefs</tt>(1M)</a>.</p><ol>
<li><a name="fscachefs-step-44"></a><b>Become superuser on the client system.</b></li>
<li><a name="fscachefs-step-45"></a><b>Check the file systems in the specified cache.</b><pre># <tt><b>fsck -F cachefs</b></tt> [<tt><b>-m -o noclean</b></tt>] <i>/cache-directory</i></pre><dl><dt><tt>-m</tt></dt>
<dd><p>Causes the <tt>fsck</tt> command to check a CacheFS file system without making any repairs. </p></dd>
<dt><tt>-o noclean</tt></dt>
<dd><p>Forces a check on the CacheFS file systems only. Does not make any repairs.</p></dd>
<dt><i>/cache-directory</i></dt>
<dd><p>Indicates the name of the directory where the cache resides.</p></dd>
</dl>
</li></ol><a name="fncrh"></a>Example&nbsp;20-7 Checking the Integrity of CacheFS File Systems<p><a name="indexterm-421"></a><a name="indexterm-422"></a>The following example shows how to check the file systems cached in the
<tt>/local/mycache</tt> cache.</p><pre># <tt><b>fsck -F cachefs /local/mycache</b></tt>
#</pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="fscachefs-23.html">Previous</a>
             </td>
             <td align="right">
                 <a href="fscachefs-15.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

