<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Setting Up Solaris iSCSI Targets and Initiators (Task Map) - System Administration Guide: Devices and File Systems</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Devices and File Systems</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="fncoz.html">Previous</a>
             </td>
             <td align="right">
                 <a href="fpjwy.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol1preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="medintro-55492.html">1.&nbsp;&nbsp;Managing Removable Media (Overview)</a></p>
<p class="toc level1 tocsp"><a href="medformat-83002.html">2.&nbsp;&nbsp;Managing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medaccess-29267.html">3.&nbsp;&nbsp;Accessing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medcdrw-1.html">4.&nbsp;&nbsp;Writing CDs and DVDs (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig-27900.html">5.&nbsp;&nbsp;Managing Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig2-1.html">6.&nbsp;&nbsp;Dynamically Configuring Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devusbover-24.html">7.&nbsp;&nbsp;Using USB Devices (Overview)</a></p>
<p class="toc level1 tocsp"><a href="devusbtasks-1.html">8.&nbsp;&nbsp;Using USB Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fncpk.html">9.&nbsp;&nbsp;Using InfiniBand Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksconcepts-29477.html">10.&nbsp;&nbsp;Managing Disks (Overview)</a></p>
<p class="toc level1 tocsp"><a href="disksprep-31030.html">11.&nbsp;&nbsp;Administering Disks (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="diskssadd-16103.html">12.&nbsp;&nbsp;SPARC: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksxadd-38159.html">13.&nbsp;&nbsp;x86: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fmvcd.html">14.&nbsp;&nbsp;Configuring Solaris iSCSI Targets and Initiators (Tasks)</a></p>
<p class="toc level2"><a href="fncoz.html">The iSCSI Technology (Overview)</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Setting Up Solaris iSCSI Targets and Initiators (Task Map)</a></p>
<p class="toc level3"><a href="#fmvcc">How to Prepare for a Solaris iSCSI Configuration</a></p>
<p class="toc level3"><a href="#fqnlk">How to Configure iSCSI Target Discovery</a></p>
<p class="toc level3"><a href="#fqnls">How to Remove Discovered iSCSI Targets</a></p>
<p class="toc level3"><a href="#fmvey">Monitoring Your iSCSI Configuration</a></p>
<p class="toc level3"><a href="#gcawf">How to Enable Multiple iSCSI Sessions for a Target</a></p>
</div>
<p class="toc level2 tocsp"><a href="fpjwy.html">Troubleshooting iSCSI Configuration Problems</a></p>
<p class="toc level1 tocsp"><a href="gfydr.html">15.&nbsp;&nbsp;Configuring and Managing the Solaris Internet Storage Name Service (iSNS)</a></p>
<p class="toc level1 tocsp"><a href="disksformat-15833.html">16.&nbsp;&nbsp;The <tt>format</tt> Utility (Reference)</a></p>
<p class="toc level1 tocsp"><a href="fsoverview-38559.html">17.&nbsp;&nbsp;Managing File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="fscreate-96442.html">18.&nbsp;&nbsp;Creating UFS, TMPFS, and LOFS File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsmount-42780.html">19.&nbsp;&nbsp;Mounting and Unmounting File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fscachefs-70682.html">20.&nbsp;&nbsp;Using The CacheFS File System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsswap-14677.html">21.&nbsp;&nbsp;Configuring Additional Swap Space (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fstroublefsck-61446.html">22.&nbsp;&nbsp;Checking UFS File System Consistency (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsfilesysappx-94408.html">23.&nbsp;&nbsp;UFS File System (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupconcepts-57422.html">24.&nbsp;&nbsp;Backing Up and Restoring File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="bkuptasks2-64128.html">25.&nbsp;&nbsp;Backing Up Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupsnapshot-2.html">26.&nbsp;&nbsp;Using UFS Snapshots (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuprestoretasks-38055.html">27.&nbsp;&nbsp;Restoring Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupref-12756.html">28.&nbsp;&nbsp;UFS Backup and Restore Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupsavefiles-17924.html">29.&nbsp;&nbsp;Copying UFS Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuptapedevice-42512.html">30.&nbsp;&nbsp;Managing Tape Drives (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="fncpi"></a><h3>Setting Up Solaris iSCSI Targets and Initiators (Task Map)</h3>
<table><col width="33*"><col width="33*"><col width="33*"><tr><th align="left" valign="top" scope="column"><p>Task</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
<th align="left" valign="top" scope="column"><p>For Instructions</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>1. Identify the iSCSI software and hardware requirements.</p></td>
<td align="left" valign="top" scope="row"><p>Identify the software and
hardware requirements for setting up an iSCSI-based storage network.</p></td>
<td align="left" valign="top" scope="row"><p><a href="fncoz.html#fncpb">Solaris iSCSI Software and Hardware Requirements</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>2. Set up your iSCSI
target devices.</p></td>
<td align="left" valign="top" scope="row"><p>Connect and set up your Solaris iSCSI target devices.</p><p>In addition, you
can set up third-party target devices. See your vendor's documentation for setup instructions.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#gdall">Setting Up Your Solaris iSCSI Target Devices</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>Set
up iSNS discovery on your Solaris ISCSI target, if an iSNS server is
available.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#gfucm">How to Configure iSNS Discovery for the Solaris iSCSI Target</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>3. Prepare for your Solaris iSCSI configuration.</p></td>
<td align="left" valign="top" scope="row"><p>Make sure you have the correct
software versions and hardware installed.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#fmvcc">How to Prepare for a Solaris iSCSI Configuration</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>4. (Optional) Set up authentication in your Solaris
iSCSI configuration.</p></td>
<td align="left" valign="top" scope="row"><p>Decide whether you want to use authentication in your Solaris iSCSI configuration:</p></td>
<td align="left" valign="top" scope="row"><p></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p></p></td>
<td align="left" valign="top" scope="row"><p>Consider
using unidirectional CHAP or bidirectional CHAP</p></td>
<td align="left" valign="top" scope="row"><p><a href="#fmvea">How to Configure CHAP Authentication for Your iSCSI Initiator</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p><a href="#gdfuv">How to Configure CHAP Authentication for Your iSCSI Target</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"></td>
<td align="left" valign="top" scope="row"><p>Consider using a third-party RADIUS server to
simplify CHAP management.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#fsuma">How to Configure RADIUS for Your iSCSI Configuration</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>5. Configure the iSCSI target discovery method.</p></td>
<td align="left" valign="top" scope="row"><p>Select the iSCSI target
discovery method best suited for your environment.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#fqnlk">How to Configure iSCSI Target Discovery</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>6. (Optional) Remove discovered iSCSI targets.</p></td>
<td align="left" valign="top" scope="row"><p>You
might need to remove a discovered iSCSI target.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#fqnls">How to Remove Discovered iSCSI Targets</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>7. Monitor your iSCSI configuration.</p></td>
<td align="left" valign="top" scope="row"><p>Monitor
your iSCSI configuration with the <tt>iscsiadm</tt> command.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#fmvey">Monitoring Your iSCSI Configuration</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>8. (Optional) Modify your iSCSI configuration.</p></td>
<td align="left" valign="top" scope="row"><p>You
might want to change your iSCSI target settings such as the header and
data digest parameters.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#fmvem">How to Modify iSCSI Initiator and Target Parameters</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>9. (Optional) Set up Solaris iSCSI multipathed devices.</p></td>
<td align="left" valign="top" scope="row"><p>Determine whether you want to
set up Solaris iSCSI multipathed devices.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#fncpc">Setting Up Solaris iSCSI Multipathed Devices</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p></p></td>
<td align="left" valign="top" scope="row"><p>Use this procedure to create multiple iSCSI
sessions that connect to a single target.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#gcawf">How to Enable Multiple iSCSI Sessions for a Target</a></p></td>
</tr>
</table>

<a name="fncpm"></a><h4>Configuring Solaris iSCSI Targets and Initiators</h4>
<p>Basically, configuring your Solaris iSCSI targets and initiators involves the following steps:</p>
<ul><li><p>Identifying the hardware and software requirements</p></li>
<li><p>Configuring your IP network</p></li>
<li><p>Connecting and setting up your iSCSI target device</p></li>
<li><p>(Optional) Configure iSCSI authentication between the iSCSI initiator and the iSCSI target, if necessary</p></li>
<li><p>Configuring the iSCSI target discovery method</p></li>
<li><p>Creating file systems on your iSCSI disks</p></li>
<li><p>Monitoring your iSCSI configuration</p></li></ul>
<p>The iSCSI configuration information is stored in the <tt>/etc/iscsi</tt> directory. This information requires
no administration.</p>

<a name="fnkav"></a><h5>iSCSI Terminology</h5>
<p>Review the following terminology before configuring iSCSI targets and initiators.</p><table><col width="34.99*"><col width="65.01*"><tr><th align="left" valign="top" scope="column"><p>Term</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Initiator</p></td>
<td align="left" valign="top" scope="row"><p>The driver that initiates
SCSI requests to the iSCSI target.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Target device</p></td>
<td align="left" valign="top" scope="row"><p>Represents the iSCSI storage component.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Discovery</p></td>
<td align="left" valign="top" scope="row"><p>Discovery is
the process that presents the initiator with a list of available targets.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Discovery method
</p></td>
<td align="left" valign="top" scope="row"><p>Describes the way in which the iSCSI targets can be found. Three
methods are currently available:</p>
<ul><li><p>Internet Storage Name Service (iSNS) - Potential targets are discovered by interacting with one or more iSNS servers.</p></li>
<li><p>SendTargets &ndash; Potential targets are discovered by using a <i>discovery-address.</i></p></li>
<li><p>Static &ndash; Static target address is configured.</p></li></ul>
</td>
</tr>
</table>

<a name="fncrx"></a><h5>Configuring Dynamic or Static Target Discovery</h5>
<p>Determine whether you want to configure one of the dynamic features or use
static iSCSI initiator targets to perform device discovery.<a name="indexterm-260"></a></p>
<ul><li><p><b>Dynamic device discovery</b> &ndash; If an iSCSI node exposes a large number of targets, such as an iSCSI to Fibre-Channel bridge, you can supply the iSCSI node IP address/port combination and allow the iSCSI initiator to use the SendTargets features to perform the device discovery.</p><p>Two dynamic device discovery methods are available: SendTargets and iSNS.</p>
<ul><li><p>SendTargets - If an iSCSI node exposes a large number of targets, such as an iSCSI to Fibre-Channel bridge, you can supply the iSCSI node IP address/port combination and allow the iSCSI initiator to use the SendTargets features to perform the device discovery. </p></li>
<li><p>iSNS - iSNS (Internet Storage Name Service) allows the iSCSI initiator to discover the targets to which it has access using as little configuration as possible. It also provides state change notification functionality to notify the iSCSI initiator when changes in operational state of storage nodes occur. To use the iSNS discovery option, you can supply the iSNS server address/port combination and allow the iSCSI initiator to query the iSNS servers that you specified to perform the device discovery. The default port for iSNS server is 3205. For more information about iSNS, see RFC 4171:</p><p><a href="http://www.ietf.org/rfc/rfc4171.txt">http://www.ietf.org/rfc/rfc4171.txt</a></p><p>The iSNS discovery service provides an administrative model to discover all targets in a network.</p><p>For more information about setting up the Solaris iSNS support, see <a href="gfydr.html">Chapter&nbsp;15, Configuring and Managing the Solaris Internet Storage Name Service (iSNS)</a>.</p></li></ul>
</li>
<li><p><b>Static device discovery</b> &ndash; If an iSCSI node has a small number of targets or if you want to restrict the targets that the initiator attempts to access, you can statically configure the <i>target-name</i> by using the following static target address naming convention:</p><p><i>target</i>,<i>target-address</i>[:<i>port-number</i>]</p><p>You can determine the static target address from the array's management tool. </p></li></ul>

<hr><p><b>Note - </b>Do not configure an iSCSI target to be discovered by both static and
dynamic device discovery methods.  The consequence of using redundant discovery methods might
be slow performance when communicating with the iSCSI target device.</p>
<hr>


<a name="fmvcc"></a><h4>How to Prepare for a Solaris iSCSI Configuration</h4><ol>
<li><b>Become superuser.</b></li>
<li><b>Verify that the iSCSI software packages are installed.<a name="indexterm-261"></a><a name="indexterm-262"></a></b><pre># <tt><b>pkginfo SUNWiscsiu SUNWiscsir</b></tt>
system      SUNWiscsiu Sun iSCSI Device Driver (root)
system      SUNWiscsir Sun iSCSI Management Utilities (usr)</pre></li>
<li><b>Verify that you are running a  Solaris Express 8/06 or later release.</b></li>
<li><b>Confirm that your TCP/IP network is setup.</b></li>
<li><b>Connect your iSCSI target devices and confirm that they are configured.</b><p>For example, determine if the iSCSI target device is reachable by using the
<tt>telnet</tt> command to connect to the iSCSI target device using port 3260. If
the connection is refused, see <a href="fpjwy.html">Troubleshooting iSCSI Configuration Problems</a>.</p><p>For information about connecting your third-party iSCSI target devices, see your hardware documentation.</p></li></ol>

<a name="gdall"></a><h4>Setting Up Your Solaris iSCSI Target Devices</h4>
<p>You can use the <tt>iscsitadm</tt> command to set up and manage your Solaris
iSCSI target devices, which can be disk or tape devices. For the device
that you select as your iSCSI target, you'll need to provide an equivalently
sized ZFS or UFS file system as the backing store for the
iSCSI daemon.</p><p>For information about setting up a Solaris iSCSI target device with ZFS, see
<a href="http://docs.sun.com/doc/817-2271/gebwq?a=view">ZFS and Solaris iSCSI Improvements in <i>ZFS Administration Guide</i></a>.</p><p>After the target device is set up, use the <tt>iscsiadm</tt> command to identify
your iSCSI targets, which will discover and use the iSCSI target device.</p><p>For more information, see <a href="http://docs.sun.com/doc/819-2240/iscsitadm-1m?a=view"><tt>iscsitadm</tt>(1M)</a> and <a href="http://docs.sun.com/doc/819-2240/iscsiadm-1m?a=view"><tt>iscsiadm</tt>(1M)</a>.</p><p>The basic process is as follows:</p>
<ul><li><p>Identify the backing store directory &ndash; For each target and logical unit created, the iSCSI daemon needs to store some information. By default, the backing store for this device is also located within the base directory. So, if the host system has a large ZFS pool to use, it may be easiest and desirable to allow the daemon to store everything in that location. It the backing store needs to be spread out, it's possible during the creation of each logical unit to specify the backing store location.</p></li>
<li><p>Create the iSCSI target &ndash; By default, the CLI assumes the requested device type is an LBA of logical unit 0. If a pass through mode is desired for character devices, the <tt>-raw</tt> option must be used. After the creation of the first LUN, other LUNs might be created for the same iSCSI target by specifying <tt>-lun number</tt>.</p><p>The daemon starts a background task that initializes the LUN to zeros. If, during that initialization, the underlying file system becomes 100% full, the daemon removes the target. During this initialization, the LUN is marked as being offline and can't be used by an initiator. It is possible during this time, however, to have an initiator discover this LUN. The Solaris initiator waits until it receives an <tt>Inventory Change</tt> notification and then automatically brings the device online.</p></li></ul>


<a name="gdalt"></a><h5>How to Create an iSCSI Target</h5>
<ol>
<li><b>Become superuser.</b></li>
<li><b>Identify the backing store directory.</b><p>For example:</p><pre># <tt><b>iscsitadm modify admin -d /export/sandbox</b></tt></pre></li>
<li><b>Create an iSCSI target.</b><p>For example:</p><pre># <tt><b>iscsitadm create target --size 2g sandbox</b></tt></pre></li>
<li><b>Display information about the iSCSI target.</b><p>For example:</p><pre># <tt><b>iscsitadm list target -v sandbox</b></tt></pre></li>
<li><b>Set up your iSCSI initiator to discover and use this target.</b><p>For more information, see <a href="#fqnlk">How to Configure iSCSI Target Discovery</a>.</p></li></ol>

<a name="gfucm"></a><h5>How to Configure iSNS Discovery for the Solaris iSCSI Target</h5>
<p>If your network includes a third-party iSNS server or a Sun iSNS
server, you can set up iSNS target discovery on your Solaris iSCSI targets.</p><ol>
<li><b>Become superuser.</b></li>
<li><b>Add the iSNS server information.</b><p>For example:</p><pre># iscsitadm modify admin --isns-server <i>ip-address</i> or <i>hostname</i>[:<i>port</i>]</pre><p>Identify the <i>ip-address</i> of the iSNS server in your network.</p><p>This step adds the iSNS server information to all of the Solaris iSCSI
targets.</p></li>
<li><b>Enable iSNS server discovery.</b><p>For example:</p><pre># iscsitadm modify admin --isns-access enable</pre><p>This step enables iSNS discovery for all of the Solaris iSCSI targets.</p></li></ol>

<a name="fmvdu"></a><h4>Configuring Authentication in Your iSCSI-Based Storage Network</h4>
<p>Setting up authentication for your iSCSI devices is optional.</p><p>In a secure environment, authentication is not required because only trusted initiators can
access the targets.</p><p>In a less secure environment, the target cannot determine if a connection request
is truly from a given host. In that case, the target can
authenticate an initiator by using the Challenge-Handshake Authentication Protocol (CHAP).</p><p>CHAP authentication uses the notion of a challenge and response, which means that
the target challenges the initiator to prove its identity.  For the challenge/response
method to work, the target must know the initiator's secret key and the
initiator must be set up to respond to a challenge.  Refer to
the array vendor's documentation for instructions on setting up the secret key on
the array.</p><p>iSCSI supports unidirectional and bidirectional authentication:</p>
<ul><li><p><b>Unidirectional authentication</b> enables the target to authenticate the identity of the initiator.</p></li>
<li><p><b>Bidirectional authentication</b> adds a second level of security by providing a means for the initiator to authenticate the identity of the target.</p></li></ul>


<a name="fmvea"></a><h5>How to Configure CHAP Authentication for Your iSCSI Initiator</h5>
<p>This procedure assumes that you are logged in to the local system
where you want to securely access the configured iSCSI target device.</p><ol>
<li><b>Become superuser.</b></li>
<li><b>Determine whether you want to configure unidirectional or bidirectional CHAP.<a name="indexterm-263"></a><a name="indexterm-264"></a></b>
<ul><li><p>Unidirectional authentication enables the target to validate the initiator. This method is the default method. Complete steps 3&ndash;5 only.</p></li>
<li><p>Bidirectional authentication adds a second level of security by providing a means for the initiator to authenticate the target. Complete steps 3&ndash;9.</p></li></ul>
</li>
<li><b>Unidirectional CHAP &ndash; Set the secret key on the initiator.</b><p>For example, the following command initiates a dialogue to define the CHAP secret
key.</p><pre># <tt><b>iscsiadm modify initiator-node --CHAP-secret</b></tt></pre>
<hr><p><b>Note - </b>The CHAP secret length must be a minimum of 12 characters and a
maximum of 16 characters.</p>
<hr>
</li>
<li>(Optional) <b>Unidirectional CHAP &ndash; Set the CHAP name on the initiator.</b><p>By default, the initiator's CHAP name is set to the initiator node name.</p><p>You can use the following command to change the initiator's CHAP name.</p><pre># <tt><b>iscsiadm modify initiator-node --CHAP-name</b></tt> <i>new-CHAP-name</i></pre></li>
<li><b>Unidirectional CHAP &ndash; Enable CHAP authentication on the initiator after the secret has
been set.</b><pre># <tt><b>iscsiadm modify initiator-node --authentication CHAP</b></tt></pre><p>CHAP requires that the initiator node have both a username and password.
The username is typically used by the target to lookup the secret for
the given username. In the Solaris environment, the CHAP name is always set
to the initiator node name by default. The CHAP name can be set
to any length text that is less than 512 bytes. The 512-byte length
limit is a Solaris limitation. However, if you do not set the CHAP
name, it is set to the initiator node name upon initialization.</p></li>
<li><b>Bidirectional CHAP &ndash; Enable bidirectional authentication parameters on the target.<a name="indexterm-265"></a></b><p>For example:</p><pre># <tt><b>iscsiadm modify target-param -B enable eui.5000ABCD78945E2B</b></tt></pre><p>Disable bidirectional CHAP. For example:</p><pre># iscsiadm modify target-param -B disable eui.5000ABCD78945E2B</pre></li>
<li><b>Bidirectional CHAP &ndash; Set authentication method to CHAP on the target.</b><p>For example:</p><pre># <tt><b>iscsiadm modify target-param --authentication CHAP eui.5000ABCD78945E2B</b></tt></pre></li>
<li><b>Bidirectional CHAP &ndash; Set the target device secret key on the target.</b><p>For example, the following command initiates a dialogue to define the CHAP secret
key.</p><pre># <tt><b>iscsiadm modify target-param --CHAP-secret eui.5000ABCD78945E2B</b></tt></pre></li>
<li><b>Bidirectional CHAP - Set the CHAP name on the target.</b><p>By default, the target's CHAP name is set to the target name.</p><p>You can use the following command to change the target's CHAP name.</p><pre># <tt><b>iscsiadm modify target-param --CHAP-name target-CHAP-name</b></tt></pre></li></ol>

<a name="gdfuv"></a><h5>How to Configure CHAP Authentication for Your iSCSI Target</h5>
<ol>
<li><b>Become superuser.</b></li>
<li><b>Set up the CHAP secret name for the target.</b><p>A common convention is to use the host name for the secret name.
For example:</p><pre># <tt><b>iscsitadm modify admin -H</b></tt> <i>stormpike</i></pre></li>
<li><b>Enter the CHAP secret.</b><p>The CHAP secret must be between 12 and 16 characters. For example:</p><pre># <tt><b>iscsitadm modify admin -C</b></tt>
Enter secret: xxxxxx
Re-enter secret: xxxxxx</pre></li>
<li><b>Create an initiator object that will be associated with one or more targets.</b><p>This is done so that you can associate a friendly name (normally the
host name, in this case <tt>monster620</tt>)  with the IQN value instead of
typing it in every time. For example:</p><pre># <tt><b>iscsitadm create initiator -n iqn.1986-03.com.sun: 01:00e081553307.4399f40e monster620</b></tt></pre></li>
<li><b>Provide the same CHAP name that was used on the initiator.</b><p>This name can be different from the friendly name that was used
for the initiator object. For example:</p><pre># <tt><b>iscsitadm modify initiator -H monster620 monster620</b></tt></pre></li>
<li><b>Use the same CHAP secret that was used on the initiator.</b><p>For example:</p><pre># <tt><b>iscsitadm modify initiator -C monster620</b></tt>
Enter secret: xxxxxx
Re-enter secret: xxxxxx</pre></li>
<li><b>Associate the initiator object with one or more targets.</b><p>For example:</p><pre># <tt><b>iscsitadm modify target -l monster620 sandbox</b></tt></pre></li></ol>

<a name="fmveq"></a><h4>Using a Third-Party Radius Server to Simplify CHAP Management in Your iSCSI Configuration</h4>
<p>You can use a third-party RADIUS server to simplify CHAP secret management. A
RADIUS server is a centralized authentication service. While you must still specify the
initiator's CHAP secret, you are no longer required to specify each target's CHAP
secret on each initiator when using bidirectional authentication with a RADIUS server. </p><p>For more information, see:</p>
<ul><li><p>CHAP &ndash; <a href="http://www.ietf.org/rfc/rfc1994.txt">http://www.ietf.org/rfc/rfc1994.txt</a></p></li>
<li><p>RADIUS &ndash; <a href="http://www.ietf.org/rfc/rfc2865.txt">http://www.ietf.org/rfc/rfc2865.txt</a></p></li></ul>


<a name="fsuma"></a><h5>How to Configure RADIUS for Your iSCSI Configuration</h5>
<ol>
<li><b>Become superuser.</b></li>
<li><b>Configure the initiator node with the IP address and port (the default port
is 1812) of the RADIUS server.</b><p>For example:</p><pre># <tt><b>iscsiadm modify initiator-node --radius-server 10.0.0.72:1812</b></tt></pre></li>
<li><b>Configure the initiator node with the shared secret of the RADIUS server.</b><pre># <tt><b>iscsiadm modify initiator-node --radius-shared-secret</b></tt></pre>
<hr><p><b>Note - </b>The Solaris iSCSI implementation requires that the RADIUS server is configured with a
shared secret before the Solaris iSCSI software can interact with the RADIUS server.</p>
<hr>
</li>
<li><b>Enable the RADIUS server.</b><pre># <tt><b>iscsiadm modify initiator-node --radius-access enable</b></tt></pre></li></ol>

<a name="fsulz"></a><h5>Solaris iSCSI and RADIUS Server Error Messages</h5>
<p>This section describes the messages that are related to a Solaris iSCSI and
RADIUS server configuration with potential solutions for recovery.</p><p>empty RADIUS shared secret</p>Cause: <p>The RADIUS server is enabled on the initiator but the RADIUS shared secret
is not set.</p>Solution: <p>Configure the initiator with RADIUS shared secret. For more information, see <a href="#fsuma">How to Configure RADIUS for Your iSCSI Configuration</a>.</p><p>WARNING: RADIUS packet authentication failed</p>Cause: <p>The initiator failed to authenticate the RADIUS data packet. This error can occur
if the shared secret configured on the initiator-node is different from the shared
secret on the RADIUS server.</p>Solution: <p>Reconfigure the initiator with the correct RADIUS shared secret. For more information, see
<a href="#fsuma">How to Configure RADIUS for Your iSCSI Configuration</a>.</p>

<a name="fqnlk"></a><h4>How to Configure iSCSI Target Discovery</h4><p>This procedure assumes that you are logged in to the local system
where you want to configure access to an iSCSI target device.<a name="indexterm-266"></a><a name="indexterm-267"></a></p><ol>
<li><b>Become superuser.</b></li>
<li><b>Configure the target device to be discovered dynamically or statically:</b>
<ul><li><p>Configure the device dynamically discovered (SendTargets).</p><p>For example:</p><pre># <tt><b>iscsiadm add discovery-address 10.0.0.1:3260</b></tt></pre><p>The iSCSI connection is not initiated until the discovery method is enabled. See the next step.</p></li>
<li><p>Configure the device dynamically discovered (iSNS).</p><p>For example:</p><pre># <tt><b>iscsiadm add iSNS-server 10.0.0.1:3205</b></tt></pre><p>The iSCSI connection is not initiated until the discovery method is enabled. See the next step.</p></li>
<li><p>Configure the device statically discovered.<a name="indexterm-268"></a></p><p>For example:</p><pre># <tt><b>iscsiadm add static-config eui.5000ABCD78945E2B,10.0.0.1</b></tt></pre><p>The iSCSI connection is not initiated until the discovery method is enabled. See the next step.</p></li></ul>
</li>
<li><b>Enable the iSCSI target discovery method using one of the following:</b>
<ul><li><p>If you have configured a dynamically discovered (SendTargets) device, enable the SendTargets discovery method.</p><pre># <tt><b>iscsiadm modify discovery --sendtargets enable</b></tt></pre></li>
<li><p>If you have configured a dynamically discovered (iSNS) device, enable the iSNS discovery method.</p><pre># <tt><b>iscsiadm modify discovery --iSNS enable</b></tt></pre></li>
<li><p>If you have configured static targets, enable the static target discovery method.</p><pre># <tt><b>iscsiadm modify discovery --static enable</b></tt></pre></li></ul>
</li>
<li><b>Create the iSCSI device links for the local system.</b><pre># <tt><b>devfsadm -i iscsi</b></tt></pre></li></ol>

<a name="fqnls"></a><h4>How to Remove Discovered iSCSI Targets</h4><p>This optional procedure assumes that you are logged in to the local system
where access to an iSCSI target device has already been configured.</p><p>After removing a discovery address, iSNS server, static-config, or disabling a discovery method,
the associated targets are logged out.  If these associated targets are still
in use, for example, have mounted file systems, the logout of these devices
will fail and they will remain on the active target list. <a name="indexterm-269"></a><a name="indexterm-270"></a></p><ol>
<li><b>Become superuser.</b></li>
<li>(Optional) <b>Disable an iSCSI target discovery method using one of the following:</b>
<ul><li><p>If you need to disable the SendTargets method of discovery, use the following command:</p><pre># <tt><b>iscsiadm modify discovery --sendtargets disable</b></tt></pre></li>
<li><p>If you need to disable the iSNS method of discovery, use the following command:</p><pre># <tt><b>iscsiadm modify discovery --iSNS disable</b></tt></pre></li>
<li><p>If you need to disable the static targets, use the following command:<a name="indexterm-271"></a></p><pre># <tt><b>iscsiadm modify discovery --static disable</b></tt></pre></li></ul>
</li>
<li><b>Remove an iSCSI device discovery entry:</b>
<ul><li><p>Remove an iSCSI SendTargets discovery entry.</p><p>For example:</p><pre># <tt><b>iscsiadm remove discovery-address 10.0.0.1:3260</b></tt></pre></li>
<li><p>Remove an iSCSI iSNS discovery entry.</p><p>For example:</p><pre># <tt><b>iscsiadm remove isns-server 10.0.0.1:3205</b></tt></pre></li>
<li><p>Remove a static iSCSI initiator entry.<a name="indexterm-272"></a></p><p>For example:</p><pre># <tt><b>iscsiadm remove static-config eui.5000ABCD78945E2B,10.0.0.1</b></tt></pre></li></ul>

<hr><p><b>Note - </b>If you attempt to disable or remove discovery information that has an associated
logical unit in use, the disable or remove operation fails with the following
message:</p><pre>logical unit in use</pre><p>If this occurs, stop all associated I/O on the logical unit, unmount the
file systems, and so on.  Then, repeat the disable or remove
operation.</p>
<hr>
</li>
<li><b>Remove the iSCSI target device.</b><p>Remove a target by specifying the logical unit number (LUN). If  you
did not specify a LUN when the target was created, a value of
0 was used. LUN  0 must be the last one removed if
there are multiple LUNs associated with a target. </p><p>For example:</p><pre># <tt><b>iscsitadm delete target --lun 0 sandbox</b></tt></pre></li></ol>

<a name="fmven"></a><h4>Accessing iSCSI Disks</h4>
<p>If you want to make the iSCSI drive available on reboot, create
the file system, and add an entry to the <tt>/etc/vfstab</tt> file as you would
with a UFS file system on a SCSI device.<a name="indexterm-273"></a><a name="indexterm-274"></a></p><p>After the devices have been discovered by the Solaris iSCSI initiator, the login
negotiation occurs automatically. The Solaris iSCSI driver determines the number of LUNs available
and creates the device nodes. Then, the iSCSI devices can be treated as
any other SCSI device.</p><p>You can view the iSCSI disks on the local system with the
<tt>format</tt> utility.</p><p>In the following <tt>format</tt> output, disks 2 and 3 are iSCSI LUNs that
are not under MPxIO control. Disks 21 and 22 are iSCSI LUNs under
MPxIO control.</p><pre># <tt><b>format</b></tt>
AVAILABLE DISK SELECTIONS:
       0. c0t1d0 &lt;SUN72G cyl 14087 alt 2 hd 24 sec 424>
          /pci@8,600000/SUNW,qlc@4/fp@0,0/ssd@w500000e010685cf1,0
       1. c0t2d0 &lt;SUN72G cyl 14087 alt 2 hd 24 sec 424>
          /pci@8,600000/SUNW,qlc@4/fp@0,0/ssd@w500000e0106e3ba1,0
       2. c3t0d0 &lt;ABCSTORAGE-100E-00-2.2 cyl 20813 alt 2 hd 16 sec 63>
          /iscsi/disk@0000iqn.2001-05.com.abcstorage%3A6-8a0900-477d70401-
           b0fff044352423a2-hostname-020000,0
       3. c3t1d0 &lt;ABCSTORAGE-100E-00-2.2 cyl 20813 alt 2 hd 16 sec 63>
           /iscsi/disk@0000iqn.2001-05.com.abcstorage%3A6-8a0900-3fcd70401 
           -085ff04434f423a2-hostname-010000,0
.
.
.
      21. c4t60A98000686F694B2F59775733426B77d0 &lt;ABCSTORAGE-LUN-0.2 cyl  
          4606 alt 2 hd 16 sec 256>
          /scsi_vhci/ssd@g60a98000686f694b2f59775733426b77
      22. c4t60A98000686F694B2F59775733434C41d0 &lt;ABCSTORAGE-LUN-0.2 cyl  
          4606 alt 2 hd 16 sec 256>
          /scsi_vhci/ssd@g60a98000686f694b2f59775733434c41</pre>

<a name="fmvey"></a><h4>Monitoring Your iSCSI Configuration</h4><p>You can display information about the iSCSI initiator and target devices by using
the <tt>iscsiadm list</tt> command.<a name="indexterm-275"></a><a name="indexterm-276"></a></p><ol>
<li><b>Become superuser.</b></li>
<li><b>Display information about the iSCSI initiator.</b><p>For example:</p><pre># <tt><b>iscsiadm list initiator-node</b></tt>
Initiator node name: iqn.1986-03.com.sun:01:0003ba4d233b.425c293c
Initiator node alias: zzr1200
        Login Parameters (Default/Configured):
                Header Digest: NONE/-
                Data Digest: NONE/-
        Authentication Type: NONE
        RADIUS Server: NONE
        RADIUS access: unknown
        Configured Sessions: 1</pre></li>
<li><b>Display information about which discovery methods are in use.<a name="indexterm-277"></a></b><p>For example:</p><pre># <tt><b>iscsiadm list discovery</b></tt>
Discovery:
    Static: enabled
    Send Targets: enabled
    iSNS: enabled</pre></li></ol><a name="fquwb"></a>Example&nbsp;14-1 Listing iSCSI Target Information<p>The following example shows how to list the parameter settings for a specific
iSCSI target.</p><pre># <tt><b>iscsiadm list target-param iqn.1992-08.com.abcstorage:sn.33592219</b></tt>
        Target: iqn.1992-08.com.abcstorage:sn.33592219</pre><p>The <tt>iscsiadm list target-param -v</tt> command displays the following information:</p>
<ul><li><p>The authentication settings for the target</p></li>
<li><p>The default settings for the target login parameters</p></li>
<li><p>The configured value for each login parameter</p></li></ul>
<p>The <tt>iscsiadm list target-param -v</tt> command displays the default parameter value before the <tt>/</tt> designator and the
configured parameter value after the <tt>/</tt> designator.  If you have not configured
any parameters, the configured parameter value displays as a hyphen (<tt>-</tt>). For more
information, see the following examples.</p><pre># <tt><b>iscsiadm list target-param -v eui.50060e8004275511 Target: eui.50060e8004275511</b></tt>
        Alias: -
        Bi-directional Authentication: disabled
        Authentication Type: NONE
        Login Parameters (Default/Configured):
                Data Sequence In Order: yes/-
                Data PDU In Order: yes/-
                Default Time To Retain: 20/-
                Default Time To Wait: 2/-
                Error Recovery Level: 0/-
                First Burst Length: 65536/-
                Immediate Data: yes/-
                Initial Ready To Transfer (R2T): yes/-
                Max Burst Length: 262144/-
                Max Outstanding R2T: 1/-
                Max Receive Data Segment Length: 65536/-
                Max Connections: 1/-
                Header Digest: NONE/-
                Data Digest: NONE/-
        Configured Sessions: 1</pre><p>The following example <tt>iscsiadm list target-param -v</tt> output displays the parameters that were negotiated between the
target and the initiator.</p><pre># <tt><b>iscsiadm list target -v eui.50060e8004275511</b></tt>
Target: eui.50060e8004275511
        TPGT: 1
        ISID: 4000002a0000
        Connections: 1
                CID: 0
                  IP address (Local): 172.90.101.71:32813
                  IP address (Peer): 172.90.101.40:3260
                  Discovery Method: Static
                  Login Parameters (Negotiated):
                        Data Sequence In Order: yes
                        Data PDU In Order: yes
                        Default Time To Retain: 0
                        Default Time To Wait: 3
                        Error Recovery Level: 0
                        First Burst Length: 65536
                        Immediate Data: yes
                        Initial Ready To Transfer (R2T): yes
                        Max Burst Length: 262144
                        Max Outstanding R2T: 1
                        Max Receive Data Segment Length: 65536
                        Max Connections: 1
                        Header Digest: NONE
                        Data Digest: NONE</pre>

<a name="fqnln"></a><h4>Modifying iSCSI Initiator and Target Parameters</h4>
<p>You can modify parameters on both the iSCSI initiator and the iSCSI target
device. However, the only parameters that can be modified on the iSCSI initiator
are the following:</p>
<ul><li><p>iSCSI initiator node name - You can change the initiator node name to a different name. If you change the initiator node name, the targets that were discovered by iSNS might be removed from the initiator's target list, depending on the discovery domain configuration on the iSNS server at the time when the name was changed. For more information, see <a href="#fmvem">How to Modify iSCSI Initiator and Target Parameters</a>.</p></li>
<li><p>Header digest &ndash; The value can be none, the default value, or CRC32.</p></li>
<li><p>Data digest &ndash; The value can be none, the default value, or CRC32.</p></li>
<li><p>Authentication and CHAP secret &ndash; For more information about setting up authentication, see <a href="#fmvea">How to Configure CHAP Authentication for Your iSCSI Initiator</a>.</p></li>
<li><p>Configured sessions &ndash; For more information about configuring multiple sessions, see <a href="#gcawf">How to Enable Multiple iSCSI Sessions for a Target</a>.</p></li></ul>
<p>The iSCSI driver provides default values for the iSCSI initiator and iSCSI target
device parameters. If you modify the parameters of the iSCSI initiator, the modified
parameters are inherited by the iSCSI target device, unless the iSCSI target device
is already set to a different value.</p>
<hr><p><b>Caution - </b>Ensure that the target software supports the parameter to be modified. Otherwise, you
might be unable to log in to the iSCSI target device. See your
array documentation for a list of supported parameters.</p>
<hr>
<p>Modifying iSCSI parameters should be done when I/O between the initiator and the
target is complete. The iSCSI driver reconnects the session after the changes are
made with the <tt>iscsiadm modify</tt> command.</p>

<a name="fmvem"></a><h5>How to Modify iSCSI Initiator and Target Parameters</h5>
<p>The first part of this procedure illustrates how modifying parameters of the iSCSI
initiator are inherited by the iSCSI target device. The second part of this
procedure shows how to actually modify parameters on the iSCSI target device.<a name="indexterm-278"></a><a name="indexterm-279"></a></p><ol>
<li><b>Become superuser.</b></li>
<li><b>List the current parameters of the iSCSI initiator and target device.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>List the current parameters of the iSCSI initiator. For example:</b><pre># <tt><b>iscsiadm list initiator-node</b></tt>
Initiator node name: iqn.1986-03.com.sun:01:0003ba4d233b.425c293c
Initiator node alias: zzr1200
        Login Parameters (Default/Configured):
                Header Digest: NONE/-
                Data Digest: NONE/-
        Authentication Type: NONE
        RADIUS Server: NONE
        RADIUS access: unknown
        Configured Sessions: 1</pre></li>
<li><b>List the current parameters of the iSCSI target device. For example:</b><pre># <tt><b>iscsiadm list target-param -v iqn.1992-08.com.abcstorage:sn.84186266</b></tt>
Target: iqn.1992-08.com.abcstorage:sn.84186266
        Alias: -
        Bi-directional Authentication: disabled
        Authentication Type: NONE
        Login Parameters (Default/Configured):
                Data Sequence In Order: yes/-
                Data PDU In Order: yes/-
                Default Time To Retain: 20/-
                Default Time To Wait: 2/-
                Error Recovery Level: 0/-
                First Burst Length: 65536/-
                Immediate Data: yes/-
                Initial Ready To Transfer (R2T): yes/-
                Max Burst Length: 262144/-
                Max Outstanding R2T: 1/-
                Max Receive Data Segment Length: 65536/-
                Max Connections: 1/-
                Header Digest: NONE/-
                Data Digest: NONE/-
         Configured Sessions: 1</pre><p>Note that both header digest and data digest parameters are currently set to
NONE for both the iSCSI initiator and the iSCSI target device.</p><p>To review the default parameters of the iSCSI target device, see the
<tt>iscsiadm list target-param</tt> output in <a href="#fquwb">Example&nbsp;14-1</a>.</p></li></ol></li>
<li><b>Modify the parameter of the iSCSI initiator.</b><p>For example, set header digest to CRC32.</p><pre># <tt><b>iscsiadm modify initiator-node -h CRC32</b></tt></pre><p>If you change the initiator node name, the targets that were discovered by
iSNS might be logged out and removed from the initiator's target list, if
the new name does not belong to the same discovery domain as
that of the targets. If, however, the targets are in use and busy,
they are not removed.  For example, if a file is opened or
a file system is mounted on these targets.</p><p>You may also see new targets after the name change if these
targets and the new initiator node name belong to the same discovery domain.</p></li>
<li><b>Verify that the parameter was modified.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Display the updated parameter information for the iSCSI initiator. For example:</b><pre># <tt><b>iscsiadm list initiator-node</b></tt>
Initiator node name: iqn.1986-03.com.sun:01:0003ba4d233b.425c293c
Initiator node alias: zzr1200
        Login Parameters (Default/Configured):
                Header Digest: NONE/CRC32
                Data Digest: NONE/-
        Authentication Type: NONE
        RADIUS Server: NONE
        RADIUS access: unknown
        Configured Sessions: 1</pre><p>Note that the header digest is now set to CRC32.</p></li>
<li><b>Display the updated parameter information for the iSCSI target device. For example:</b><pre># iscsiadm list target-param -v iqn.1992-08.com.abcstorage:sn.84186266
Target: iqn.1992-08.com.abcstorage:sn.84186266
        Alias: -
        Bi-directional Authentication: disabled
        Authentication Type: NONE
        Login Parameters (Default/Configured):
                Data Sequence In Order: yes/-
                Data PDU In Order: yes/-
                Default Time To Retain: 20/-
                Default Time To Wait: 2/-
                Error Recovery Level: 0/-
                First Burst Length: 65536/-
                Immediate Data: yes/-
                Initial Ready To Transfer (R2T): yes/-
                Max Burst Length: 262144/-
                Max Outstanding R2T: 1/-
                Max Receive Data Segment Length: 65536/-
                Max Connections: 1/-
                Header Digest: CRC32/-
                Data Digest: NONE/-
        Configured Sessions: 1</pre><p>Note that the header digest is now set to CRC32.</p></li></ol></li>
<li><b>Verify that the iSCSI initiator has reconnected to the iSCSI target. For example:</b><pre># <tt><b>iscsiadm list target -v iqn.1992-08.com.abcstorage:sn.84186266</b></tt>
Target: iqn.1992-08.com.abcstorage:sn.84186266
        TPGT: 2
        ISID: 4000002a0000
        Connections: 1
                CID: 0
                  IP address (Local): nnn.nn.nn.nnn:64369
                  IP address (Peer): nnn.nn.nn.nnn:3260
                  Discovery Method: SendTargets
                  Login Parameters (Negotiated):
                        .
                        .
                        .
                        Header Digest: CRC32
                        Data Digest: NONE </pre></li>
<li><b>Unset an iSCSI initiator parameter or an iSCSI target device parameter.</b><p>You can unset a parameter by setting it back to it's default setting
with the <tt>iscsiadm modify</tt> command. Or, you can use the <tt>iscsiadm remove</tt> command to reset
all target properties to the default settings.</p><p>The <tt>iscsiadm modify target-param</tt> command changes only the parameters that are specified on the command
line.</p><p>The following example shows how to reset the header digest to none:</p><pre># <tt><b>iscsiadm modify target-param -h none iqn.1992-08.com.abcstorage:sn...</b></tt></pre><p>For information about using the <tt>iscsiadm remove target-param</tt> command, see <a href="http://docs.sun.com/doc/819-2240/iscsiadm-1m?a=view"><tt>iscsiadm</tt>(1M)</a>.</p></li></ol>

<a name="fncpc"></a><h4>Setting Up Solaris iSCSI Multipathed Devices</h4>
<p>Keep the following guidelines in mind when you consider using Solaris iSCSI multipathed
(MPxIO) devices:</p>
<ul><li><p><b>Solaris iSCSI and MPXIO</b>: MPxIO supports target port aggregation and availability in Solaris iSCSI configurations that configure multiple sessions per target (MS/T) on the iSCSI initiator.</p>
<ul><li><p>IPMP should be used for aggregation and failover of two or more NICs.</p></li>
<li><p>A basic configuration for an iSCSI host would be a server with two NICs that are dedicated to iSCSI traffic. The NICs should be configured by using IPMP. Additional NICs should be provided for non-iSCSI traffic to optimize performance.</p></li>
<li><p>Active multipathing can only be achieved by using the Solaris iSCSI MS/T feature or the TPGT feature (?) and the failover and redundancy of an IPMP configuration:</p>
<ul><li><p>If one NIC fails in an IPMP configuration, IPMP handles the failover. The MPxIO driver does not notice the failure. In a non-IPMP configuration, the MPxIO driver fails and offlines the path.</p></li>
<li><p>If one target port fails in an IPMP configuration, the MPxIO driver notices the failure and provides the failover. In a non-IPMP configuration, the MPXIO driver notices the failure and provides the failover.</p><p>For more information about using the Solaris iSCSI MS/T feature with IPMP and multipathing, see SunSolve Infodoc 88246, <i>Understanding an iSCSI MS/T multi-path configuration</i>.</p></li></ul>
</li>
<li><p>For information about configuring multiple sessions per target, see <a href="#gcawf">How to Enable Multiple iSCSI Sessions for a Target</a>. For information about configuring IPMP, see <a href="http://docs.sun.com/doc/819-3000/ipmptm-1?a=view">Part&nbsp;IV, IPMP, in <i>System Administration Guide: IP Services</i></a>.</p></li></ul>
</li>
<li><p><b>Solaris iSCSI and FC and MPXIO</b>: The MPxIO driver provides the following behavior in more complex iSCSI/FC configurations:</p>
<ul><li><p>If you have dual iSCSI to FC bridges in a FC SAN, iSCSI presents target paths to MPxIO and MPxIO matches the unique SCSI per LUN identifier, and if they are identical, presents one path to the iSCSI driver.</p></li>
<li><p>If you have a configuration that connects a target by using both iSCSI and FC, the MPxIO driver can provide different transports to the same device. In this configuration, MPxIO utilizes both paths.</p></li>
<li><p>If you are using iSCSI and FC in combination with MPxIO, make sure that the MPxIO settings in the <tt>/kernel/drv/fp.conf</tt> file and the <tt>/kernel/drv/iscsi.conf</tt> match the MPxIO configuration that you want supported. For example, in the <tt>fp.conf</tt>, you can determine whether MPxIO is enabled globally on the HBA or on a per-port basis.</p></li></ul>
</li>
<li><p><b>Third-Party Hardware Considerations</b>: Find out if your third-party HBA is qualified to work with Solaris iSCSI and MPxIO.</p></li>
<li><p>If you are using a third-party HBA, you might need to ask your third-party HBA vendor for the symmetric-option information for the <tt>/kernel/drv/scsi_vhci.conf</tt> file.</p></li></ul>


<a name="gcawf"></a><h4>How to Enable Multiple iSCSI Sessions for a Target</h4><p>This procedure can be used to create multiple iSCSI sessions that connect to
a single target. This scenario is useful with iSCSI target devices that support
login redirection or have multiple target portals in the same target portal group.
 iSCSI multiple sessions per target support should be used in combination with
Solaris SCSI Multipathing (MPxIO). You can also get higher bandwidth if you utilize
multiple NICs on the host side to connect to multiple portals on the
same target.</p><p>The MS/T feature creates two or more sessions on the target by
varying the initiator's session ID (ISID). Enabling this feature creates two SCSI layer paths
on the network so that multiple targets are exposed up through the iSCSI
layer to the Solaris I/O layer. The MPxIO driver handles the reservations across
these paths.</p><p>Review the following items before configuring multiple sessions for an iSCSI target:</p>
<ul><li><p>A typical MS/T configuration has 2 or more configured-sessions.</p><p>However, if your storage supports multiple TPGTs and if you are using SendTarget discovery on your host system, then the number of configured sessions can be set to 1. SendTarget discovery automatically knows the existence of multiple paths and multiple target sessions are created.</p></li>
<li><p>Confirm that the <tt>mxpio</tt> configuration parameter is enabled in the <tt>/kernel/drv/iscsi.conf</tt> file.</p><pre># cd /kernel/drive
# grep mpxio iscsi.conf
iscsi.conf:mpxio-disable="no";</pre></li>
<li><p>Confirm that the multiple network connections are configured by using IPMP.</p></li>
<li><p>Confirm that the multiple network connections are available</p><pre># ifconfig -a</pre></li></ul>
<p>For more information about how iSCSI interacts with MPxIO paths, see <a href="#fncpc">Setting Up Solaris iSCSI Multipathed Devices</a></p><ol>
<li><b>Become superuser.</b></li>
<li><b>List the current parameters for the iSCSI initiator and target.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>List the current parameters for the iSCSI initiator. For example:</b><pre># <tt><b>iscsiadm list initiator-node</b></tt>
Initiator node name: iqn.1986-03.com.sun:01:0003ba4d233b.425c293c
Initiator node alias: zzr1200
        .
        .
        .
        Configured Sessions: 1</pre></li>
<li><b>List the current parameters of the iSCSI target device. For example:</b><pre># <tt><b>iscsiadm list target-param -v iqn.1992-08.com.abcstorage:sn.84186266</b></tt>
Target: iqn.1992-08.com.abcstorage:sn.84186266
        Alias: -
        .
        .
        .
        Configured Sessions: 1</pre><p>The configured sessions value is the number of configured iSCSI sessions that will
be created for each target name in a target portal group.</p></li></ol></li>
<li><b>Select one of the following to modify the number of configured sessions at
either the initiator node, to apply to all targets, at a target level,
or to apply to a specific target.</b><p>The number of sessions for a target must be between 1 and 4.</p>
<ul><li><p>Apply the parameter to the iSCSI initiator node.</p><p>For example:</p><pre># <tt><b>iscsiadm modify initiator-node -c 2</b></tt></pre></li>
<li><p>Apply the parameter to the iSCSI target.</p><p>For example:</p><pre># <tt><b>iscsiadm modify target-param -c 2 iqn.1992-08.com.abcstorage:sn.84186266</b></tt></pre></li></ul>
<p>Configured sessions can also be bound to a specific local IP address. Using
this method, one or more local IP addresses are supplied in a
comma-separated list.  Each IP address represents an iSCSI session. This method can
also be done at the initiator-node or target-param level. For example:</p><pre># <tt><b>iscsiadm modify initiator-node -c 10.0.0.1,10.0.0.2</b></tt></pre>
<hr><p><b>Note - </b>If the specified IP address is not routable, the address is ignored and
the default Solaris route and IP address is used for this session.</p>
<hr>
</li>
<li><b>Verify that the parameter was modified.</b><ol style="list-style-type: lower-alpha">
				 
<li><b>Display the updated information for the initiator node. For example:</b><pre># <tt><b>iscsiadm list initiator-node</b></tt>
Initiator node name: iqn.1986-03.com.sun:01:0003ba4d233b.425c293c
Initiator node alias: zzr1200
        .
        .
        .
        Configured Sessions: 2</pre></li>
<li><b>Display the updated information for the target node. For example:</b><pre># <tt><b>iscsiadm list target-param -v iqn.1992-08.com.abcstorage:sn.84186266</b></tt>
Target: iqn.1992-08.com.abcstorage:sn.84186266
        Alias: -
        .
        .
        .
        Configured Sessions: 2</pre></li></ol></li>
<li><b>List the multiple paths with the <tt>mpathadm list lu</tt> command to confirm that the OS
device name matches the <tt>iscsiadm list</tt> output and that the path count is 2
or more.</b></li></ol>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="fncoz.html">Previous</a>
             </td>
             <td align="right">
                 <a href="fpjwy.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

