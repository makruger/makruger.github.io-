<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Creating and Mounting a CacheFS File System (Task Map) - System Administration Guide: Devices and File Systems</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Devices and File Systems</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="fscachefs-14.html">Previous</a>
             </td>
             <td align="right">
                 <a href="fscachefs-23.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol1preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="medintro-55492.html">1.&nbsp;&nbsp;Managing Removable Media (Overview)</a></p>
<p class="toc level1 tocsp"><a href="medformat-83002.html">2.&nbsp;&nbsp;Managing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medaccess-29267.html">3.&nbsp;&nbsp;Accessing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medcdrw-1.html">4.&nbsp;&nbsp;Writing CDs and DVDs (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig-27900.html">5.&nbsp;&nbsp;Managing Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig2-1.html">6.&nbsp;&nbsp;Dynamically Configuring Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devusbover-24.html">7.&nbsp;&nbsp;Using USB Devices (Overview)</a></p>
<p class="toc level1 tocsp"><a href="devusbtasks-1.html">8.&nbsp;&nbsp;Using USB Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fncpk.html">9.&nbsp;&nbsp;Using InfiniBand Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksconcepts-29477.html">10.&nbsp;&nbsp;Managing Disks (Overview)</a></p>
<p class="toc level1 tocsp"><a href="disksprep-31030.html">11.&nbsp;&nbsp;Administering Disks (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="diskssadd-16103.html">12.&nbsp;&nbsp;SPARC: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksxadd-38159.html">13.&nbsp;&nbsp;x86: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fmvcd.html">14.&nbsp;&nbsp;Configuring Solaris iSCSI Targets and Initiators (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="gfydr.html">15.&nbsp;&nbsp;Configuring and Managing the Solaris Internet Storage Name Service (iSNS)</a></p>
<p class="toc level1 tocsp"><a href="disksformat-15833.html">16.&nbsp;&nbsp;The <tt>format</tt> Utility (Reference)</a></p>
<p class="toc level1 tocsp"><a href="fsoverview-38559.html">17.&nbsp;&nbsp;Managing File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="fscreate-96442.html">18.&nbsp;&nbsp;Creating UFS, TMPFS, and LOFS File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsmount-42780.html">19.&nbsp;&nbsp;Mounting and Unmounting File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fscachefs-70682.html">20.&nbsp;&nbsp;Using The CacheFS File System (Tasks)</a></p>
<p class="toc level2"><a href="fscachefs-16.html">High-Level View of Using the CacheFS File System (Task Map)</a></p>
<p class="toc level2"><a href="fscachefs-14.html">Overview of the CacheFS File System</a></p>
<div class="onpage">
<p class="toc level2"><a href="">Creating and Mounting a CacheFS File System (Task Map)</a></p>
<p class="toc level3"><a href="#fscachefs-15053">How to Create the Cache</a></p>
<p class="toc level3"><a href="#fscachefs-77212">How to Mount a CacheFS File System (<tt>mount</tt>)</a></p>
<p class="toc level3"><a href="#fscachefs-23416">How to Mount a CacheFS File System (<tt>/etc/vfstab</tt>)</a></p>
<p class="toc level3"><a href="#fscachefs-54948">How to Mount a CacheFS File System (AutoFS)</a></p>
</div>
<p class="toc level2 tocsp"><a href="fscachefs-23.html">Maintaining a CacheFS File System (Task Map)</a></p>
<p class="toc level2"><a href="fscachefs-24.html">Maintaining a CacheFS File System</a></p>
<p class="toc level3"><a href="fscachefs-24.html#fscachefs-58683">How to Display Information About a CacheFS File System</a></p>
<p class="toc level3"><a href="fscachefs-24.html#fscachefs-87412">How to Specify Cache Consistency Checking on Demand</a></p>
<p class="toc level3"><a href="fscachefs-24.html#fscachefs-10353">How to Delete a CacheFS File System</a></p>
<p class="toc level3"><a href="fscachefs-24.html#fscachefs-17439">How to Check the Integrity of a CacheFS File System</a></p>
<p class="toc level2 tocsp"><a href="fscachefs-15.html">Packing a Cached File System (Task Map)</a></p>
<p class="toc level2"><a href="fscachepack-80612.html">Packing a CacheFS File System</a></p>
<p class="toc level3"><a href="fscachepack-80612.html#fscachepack-80613">How to Pack Files in the Cache</a></p>
<p class="toc level3"><a href="fscachepack-80612.html#fscachepack-21">How to Display Packed Files Information</a></p>
<p class="toc level3"><a href="fscachepack-80612.html#fscachepack-17738">How to Create a Packing List</a></p>
<p class="toc level3"><a href="fscachepack-80612.html#fscachepack-5">How to Pack Files in the Cache With a Packing List</a></p>
<p class="toc level3"><a href="fscachepack-80612.html#fscachepack-18">How to Unpack Files or Packing Lists From the Cache</a></p>
<p class="toc level2 tocsp"><a href="fscachefsref-26610.html">Collecting CacheFS Statistics (Task Map)</a></p>
<p class="toc level2"><a href="fscachefsref-38278.html">Collecting CacheFS Statistics</a></p>
<p class="toc level3"><a href="fscachefsref-38278.html#fscachefs-5">How to Set Up CacheFS Logging</a></p>
<p class="toc level3"><a href="fscachefsref-38278.html#fscachefs-8">How to Locate the CacheFS Log File</a></p>
<p class="toc level3"><a href="fscachefsref-38278.html#fscachefsref-71516">How to View the Working Set (Cache) Size</a></p>
<p class="toc level3"><a href="fscachefsref-38278.html#fscachefsref-35885">How to View CacheFS Statistics</a></p>
<p class="toc level1 tocsp"><a href="fsswap-14677.html">21.&nbsp;&nbsp;Configuring Additional Swap Space (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fstroublefsck-61446.html">22.&nbsp;&nbsp;Checking UFS File System Consistency (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsfilesysappx-94408.html">23.&nbsp;&nbsp;UFS File System (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupconcepts-57422.html">24.&nbsp;&nbsp;Backing Up and Restoring File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="bkuptasks2-64128.html">25.&nbsp;&nbsp;Backing Up Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupsnapshot-2.html">26.&nbsp;&nbsp;Using UFS Snapshots (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuprestoretasks-38055.html">27.&nbsp;&nbsp;Restoring Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupref-12756.html">28.&nbsp;&nbsp;UFS Backup and Restore Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupsavefiles-17924.html">29.&nbsp;&nbsp;Copying UFS Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuptapedevice-42512.html">30.&nbsp;&nbsp;Managing Tape Drives (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="fscachefs-80158"></a><h3>Creating and Mounting a CacheFS File System (Task Map)</h3>
<p>Use the procedures in this task map to create and mount a
CacheFS file system.</p><table><col width="33*"><col width="33*"><col width="33*"><tr><th align="left" valign="top" scope="column"><p>Task</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
<th align="left" valign="top" scope="column"><p>For Instructions</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>1. Share the file system to be cached.</p></td>
<td align="left" valign="top" scope="row"><p>Verify that the
file system you want to cache is shared.</p></td>
<td align="left" valign="top" scope="row"><p><a href="http://docs.sun.com/doc/819-2240/share-1m?a=view"><tt>share</tt>(1M)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>2. Create the cache.</p></td>
<td align="left" valign="top" scope="row"><p>Use the
<tt>cfsadmin</tt> command to create the cache.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#fscachefs-15053">How to Create the Cache</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>3. Mount a file system in the
cache.</p></td>
<td align="left" valign="top" scope="row"><p>Mount a file system in a cache by using one of the
following methods:</p></td>
<td align="left" valign="top" scope="row"><p></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p></p></td>
<td align="left" valign="top" scope="row"><p>Mount a CacheFS file system by using the <tt>mount</tt> command.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#fscachefs-77212">How to Mount a CacheFS File System (<tt>mount</tt>)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p></p></td>
<td align="left" valign="top" scope="row"><p>Mount a
CacheFS file system by editing the <tt>/etc/vfstab</tt> file.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#fscachefs-23416">How to Mount a CacheFS File System (<tt>/etc/vfstab</tt>)</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p></p></td>
<td align="left" valign="top" scope="row"><p>Mount a cached file system
by using AutoFS.</p></td>
<td align="left" valign="top" scope="row"><p><a href="#fscachefs-54948">How to Mount a CacheFS File System (AutoFS)</a></p></td>
</tr>
</table>

<a name="fscachefs-15053"></a><h4>How to Create the Cache</h4><ol>
<li><a name="fscachefs-step-3"></a><b>Become superuser on the client system.</b></li>
<li><a name="fscachefs-step-4"></a><b><a name="fscachefs-ix2838"></a><a name="fscachefs-ix2839"></a>Create the cache. </b><pre># <tt><b>cfsadmin -c</b></tt> <i>/cache-directory</i></pre><p>where <i>cache-directory</i> indicates the name of the directory where the cache resides.</p><p>For more information, see <a href="http://docs.sun.com/doc/819-2240/cfsadmin-1m?a=view"><tt>cfsadmin</tt>(1M)</a>.</p>
<hr><p><b>Note - </b>After you have created the cache, do not perform any operations within the
cache directory itself. Doing so could cause conflicts within the CacheFS software.</p>
<hr>
</li></ol><a name="fncqw"></a>Example&nbsp;20-1 Creating the Cache<p>The following example shows how to create a cache in the <tt>/local/mycache</tt>
directory by using the default cache parameter values. </p><pre># <tt><b>mkdir /local</b></tt>
# <tt><b>cfsadmin -c /local/mycache</b></tt></pre>

<a name="fscachefs-11834"></a><h4>Mounting a File System in the Cache</h4>
<p>You specify a file system to be mounted in the cache so
that users can locally access files in that file system. The files do
not actually get placed in the cache until the user accesses the files.</p><p>The following table describes three ways to mount a CacheFS file system.</p><table><col width="50*"><col width="50*"><tr><th align="left" valign="top" scope="column"><p>Mount
Type for CacheFS File System</p></th>
<th align="left" valign="top" scope="column"><p>Frequency of CacheFS Mount Type</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Using the <tt>mount</tt> command</p></td>
<td align="left" valign="top" scope="row"><p>Every
time the system reboots in order to access the same file system.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Editing
the <tt>/etc/vfstab</tt> file</p></td>
<td align="left" valign="top" scope="row"><p>Only once. The <tt>/etc/vfstab</tt> file remains unchanged after the system reboots.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Using
AutoFS</p></td>
<td align="left" valign="top" scope="row"><p>Only once. AutoFS maps remain unchanged after the system reboots. </p></td>
</tr>
</table><p>Choose the method of mounting file systems that best suits your environment.</p><p>You can mount only file systems that are shared. For information on sharing
file systems, see <a href="http://docs.sun.com/doc/819-2240/share-1m?a=view"><tt>share</tt>(1M)</a>.</p>
<hr><p><b>Note - </b>The caching of the root (<tt>/</tt>) and <tt>/usr</tt> file systems is not supported
in a CacheFS file system.</p>
<hr>


<a name="fscachefs-77212"></a><h4>How to Mount a CacheFS File System (<tt>mount</tt>)</h4><ol>
<li><a name="fscachefs-step-8"></a><b>Become superuser on the client system.</b></li>
<li><a name="fscachefs-step-9"></a><b>Create the mount point, if necessary.</b><pre># <tt><b>mkdir</b></tt> <i>/mount-point</i></pre><p>You can create the mount point from anywhere, but it must be
a UFS file system. The CacheFS options used with the <tt>mount</tt> command, as shown
in the next step, determine that the mount point you create is
cached in the cache directory you specify.</p></li>
<li><a name="fscachefs-step-10"></a><b>Mount a file system in the cache.</b><pre># <tt><b>mount -F cachefs -o backfstype=</b></tt><i>fstype</i><tt><b>,cachedir=</b></tt><i>/cache-directory</i>[<tt><b>,</b></tt><i>options</i>]
<i>/back-filesystem</i> <i>/mount-point</i></pre><dl><dt><i>fstype</i></dt>
<dd><p><a name="fscachefs-ix2840"></a>Indicates the file system type of the back file system, which can be either <tt>NFS</tt> or <tt>HSFS</tt>. </p></dd>
<dt><i>/cache-directory</i></dt>
<dd><p>Indicates the name of the UFS directory where the cache resides. This name is the same name you specified when you created the cache in <a href="#fscachefs-15053">How to Create the Cache</a>.</p></dd>
<dt><i>options</i></dt>
<dd><p>Specifies other mount options that you can include when you mount a file system in a cache. For a list of CacheFS mount options, see <a href="http://docs.sun.com/doc/819-2240/mount-cachefs-1m?a=view"><tt>mount_cachefs</tt>(1M)</a>.</p></dd>
<dt><i>/back-filesystem</i></dt>
<dd><p>Specifies the mount point of the back file system to cache. If the back file system is an NFS file system, you must specify the host name of the server from which you are mounting the file system and the name of the file system to cache, separated by a colon. For example, <i>merlin: /data/abc</i>.</p></dd>
<dt><i>/mount-point</i></dt>
<dd><p>Indicates the directory where the file system is mounted.</p></dd>
</dl>
</li>
<li><a name="fscachefs-step-12"></a><b>Verify that the cache you created was actually mounted.</b><pre># <tt><b>cachefsstat</b></tt> <i>/mount-point</i></pre><p>The <i>/mount-point</i> is the CacheFS file system that you created. </p><p>For example:</p><pre># <tt><b>cachefsstat /docs</b></tt>
/docs
             cache hit rate:   100% (0 hits, 0 misses)
         consistency checks:      1 (1 pass, 0 fail)
                   modifies:      0
         garbage collection:      0</pre><p>If the file system was not mounted in the cache, an error
message similar to the following is displayed:</p><pre># <tt><b>cachefsstat</b></tt> <i>/mount-point</i>
cachefsstat: <i>mount-point</i>: not a cachefs mountpoint</pre><p>For more information about the <tt>cachefsstat</tt> command, see <a href="fscachefsref-38278.html">Collecting CacheFS Statistics</a>.</p></li></ol><a name="fncrj"></a>Example&nbsp;20-2 Mounting a CacheFS File System (<tt>mount</tt>)<p>The following example shows how to mount the NFS file system <tt>merlin:/docs</tt>
as a CacheFS file system named <tt>/docs</tt> in the cache named <tt>/local/mycache</tt>.</p><pre># <tt><b>mkdir /docs</b></tt>
# <tt><b>mount -F cachefs -o backfstype=nfs,cachedir=/local/mycache merlin:/docs /docs</b></tt></pre><p>The following example shows how to make a Solaris 9 SPARC<sup>TM</sup> CD (HSFS
file system) available as a CacheFS file system named <tt>/cfssrc</tt>. Because you cannot
write to the CD, the <tt>ro</tt> argument is specified to make the CacheFS
file system read-only. This example assumes that the removable media services are not
running.</p><pre># <tt><b>mount -F hsfs -o ro /dev/dsk/c0t6d0s0 /sol9</b></tt>
# <tt><b>mount -F cachefs -o backfstype=hsfs,cachedir=/cfs/cache,ro,noconst,</b></tt>
<tt><b>backpath=/sol9 /dev/dsk/c0t6d0s0 /cfssrc</b></tt>
# <tt><b>ls /cfssrc</b></tt>
Copyright  Solaris_9</pre><p>The following example shows how to mount a Solaris 9 SPARC CD
as a CacheFS file system with <tt>vold</tt> running.</p><pre># <tt><b>mount -F cachefs -o backfstype=hsfs,cachedir=/cfs/cache,ro,noconst,</b></tt>
<tt><b>backpath=/cdrom/sol_9_sparc/s0 /vol/dev/dsk/c0t2d0/sol_9_sparc/s0 /cfssrc</b></tt></pre><p>The following example shows how to mount a CD as a CacheFS
file system with <tt>vold</tt> running.</p><pre># <tt><b>mount -F cachefs -o backfstype=hsfs,cachedir=/cfs/cache,ro,noconst,</b></tt>
<tt><b>backpath=/cdrom/epson /vol/dev/dsk/c0t2d0/epson /drvrs</b></tt></pre><p>The following example uses the <tt>demandconst</tt> option to specify consistency checking on demand
for the NFS CacheFS file system <tt>/docs</tt>, whose back file system is
<tt>merlin:/docs</tt>. For more information, see <a href="fscachefs-24.html#fscachefsref-65406">Consistency Checking of a CacheFS File System</a>.</p><pre># <tt><b>mount -F cachefs -o backfstype=nfs,cachedir=/local/mycache,demandconst merlin:/docs /docs</b></tt></pre>

<a name="fscachefs-23416"></a><h4>How to Mount a CacheFS File System (<tt>/etc/vfstab</tt>)</h4><ol>
<li><a name="fscachefs-step-14"></a><b>Become superuser on the client system.</b></li>
<li><a name="fscachefs-step-15"></a><b>Using an editor, specify the file systems to be mounted in the <tt>/etc/vfstab</tt>
file.</b><p>See the example that follows.</p><p>For more information on the <tt>/etc/vfstab</tt> file, see <a href="fsmount-43249.html#fsmount-81772">Field Descriptions for the <tt>/etc/vfstab</tt> File</a>.</p></li>
<li><a name="fscachefs-step-16"></a><b>Mount the CacheFS file system.</b><pre># <tt><b>mount</b></tt> <i>/mount-point</i></pre><p>Or, reboot the system.</p></li></ol><a name="fncri"></a>Example&nbsp;20-3 Mounting a CacheFS File System (<tt>/etc/vfstab</tt>)<p>The following example shows the <tt>/etc/vfstab</tt> entry for the <tt>/data/abc</tt> directory from the
remote system <tt>starbug</tt> that is mounted in the cached directory, <tt>/opt/cache</tt>.</p><pre> 
#device           device             mount      FS     fsck  mount   mount
#to mount         to fsck            point      type   pass  at boot options
#
starbug:/data/abc /local/abc         /opt/cache cachefs 7    yes     local-access,bg,
nosuid,demandconst,backfstype=nfs,cachedir=/opt/cache</pre>

<a name="fscachefs-54948"></a><h4>How to Mount a CacheFS File System (AutoFS)</h4><p>You can mount a file system in a cache with AutoFS by
specifying the <tt>-fstype=cachefs</tt> mount option in your automount map. Note that the CacheFS
mount options, for example, <tt>backfstype</tt> and <tt>cachedir</tt>, are also specified in the
automount map.</p><p>For details on automount maps, see <a href="http://docs.sun.com/doc/819-1634/rfsadmin-127?a=view">Task Overview for Autofs Administration in <i>System Administration Guide: Network Services</i></a> or <a href="http://docs.sun.com/doc/819-2240/automount-1m?a=view"><tt>automount</tt>(1M)</a>.</p><ol>
<li><a name="fscachefs-step-18"></a><b>Become superuser on the client system.</b></li>
<li><a name="fscachefs-step-19"></a><b>Using an editor, add the following line to the <tt>auto_direct</tt> map:</b><pre>/<i>mount-point</i> -fstype=cachefs,cachedir=/<i>directory</i>,backfstype=nfs 
<i>server:/file-system</i></pre></li>
<li><a name="fscachefs-step-20"></a><b>Using an editor, add the following line to the <tt>auto_master</tt> map:</b><pre>/-</pre><p>The <tt>/-</tt> entry is a pointer to check the <tt>auto_direct</tt> map.</p></li>
<li><a name="fscachefs-step-21"></a><b>Reboot the system.</b></li>
<li><a name="fscachefs-step-13"></a><b>Verify that the entry was made correctly by changing to the file system
you mounted in the cache, and then list the contents.</b><pre># <tt><b>cd</b></tt> <i>/filesystem</i>
# <tt><b>ls</b></tt></pre></li></ol><a name="fncrg"></a>Example&nbsp;20-4 Mounting a CacheFS File System (AutoFS)<p>The following <tt>auto_direct</tt> entry automatically mounts the CacheFS file system in the <tt>/docs</tt>
directory.</p><pre>/docs -fstype=cachefs,cachedir=/local/mycache,backfstype=nfs merlin:/docs</pre>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="fscachefs-14.html">Previous</a>
             </td>
             <td align="right">
                 <a href="fscachefs-23.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

