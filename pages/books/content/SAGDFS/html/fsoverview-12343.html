<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>UFS File System - System Administration Guide: Devices and File Systems</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Devices and File Systems</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="fsoverview-43247.html">Previous</a>
             </td>
             <td align="right">
                 <a href="fsoverview-30598.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol1preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="medintro-55492.html">1.&nbsp;&nbsp;Managing Removable Media (Overview)</a></p>
<p class="toc level1 tocsp"><a href="medformat-83002.html">2.&nbsp;&nbsp;Managing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medaccess-29267.html">3.&nbsp;&nbsp;Accessing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medcdrw-1.html">4.&nbsp;&nbsp;Writing CDs and DVDs (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig-27900.html">5.&nbsp;&nbsp;Managing Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig2-1.html">6.&nbsp;&nbsp;Dynamically Configuring Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devusbover-24.html">7.&nbsp;&nbsp;Using USB Devices (Overview)</a></p>
<p class="toc level1 tocsp"><a href="devusbtasks-1.html">8.&nbsp;&nbsp;Using USB Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fncpk.html">9.&nbsp;&nbsp;Using InfiniBand Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksconcepts-29477.html">10.&nbsp;&nbsp;Managing Disks (Overview)</a></p>
<p class="toc level1 tocsp"><a href="disksprep-31030.html">11.&nbsp;&nbsp;Administering Disks (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="diskssadd-16103.html">12.&nbsp;&nbsp;SPARC: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksxadd-38159.html">13.&nbsp;&nbsp;x86: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fmvcd.html">14.&nbsp;&nbsp;Configuring Solaris iSCSI Targets and Initiators (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="gfydr.html">15.&nbsp;&nbsp;Configuring and Managing the Solaris Internet Storage Name Service (iSNS)</a></p>
<p class="toc level1 tocsp"><a href="disksformat-15833.html">16.&nbsp;&nbsp;The <tt>format</tt> Utility (Reference)</a></p>
<p class="toc level1 tocsp"><a href="fsoverview-38559.html">17.&nbsp;&nbsp;Managing File Systems (Overview)</a></p>
<p class="toc level2"><a href="fsoverview-63.html">What's New in File Systems?</a></p>
<p class="toc level2"><a href="fsoverview-62.html">Where to Find File System Management Tasks</a></p>
<p class="toc level2"><a href="fsoverview-51.html">Overview of File Systems</a></p>
<p class="toc level2"><a href="fsoverview-95856.html">Commands for File System Administration</a></p>
<p class="toc level2"><a href="fsoverview-43247.html">Default Solaris File Systems</a></p>
<div class="onpage">
<p class="toc level2"><a href="">UFS File System</a></p>
</div>
<p class="toc level2"><a href="fsoverview-30598.html">Mounting and Unmounting File Systems</a></p>
<p class="toc level2"><a href="fsoverview-28729.html">Determining a File System's Type</a></p>
<p class="toc level1 tocsp"><a href="fscreate-96442.html">18.&nbsp;&nbsp;Creating UFS, TMPFS, and LOFS File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsmount-42780.html">19.&nbsp;&nbsp;Mounting and Unmounting File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fscachefs-70682.html">20.&nbsp;&nbsp;Using The CacheFS File System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsswap-14677.html">21.&nbsp;&nbsp;Configuring Additional Swap Space (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fstroublefsck-61446.html">22.&nbsp;&nbsp;Checking UFS File System Consistency (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsfilesysappx-94408.html">23.&nbsp;&nbsp;UFS File System (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupconcepts-57422.html">24.&nbsp;&nbsp;Backing Up and Restoring File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="bkuptasks2-64128.html">25.&nbsp;&nbsp;Backing Up Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupsnapshot-2.html">26.&nbsp;&nbsp;Using UFS Snapshots (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuprestoretasks-38055.html">27.&nbsp;&nbsp;Restoring Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupref-12756.html">28.&nbsp;&nbsp;UFS Backup and Restore Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupsavefiles-17924.html">29.&nbsp;&nbsp;Copying UFS Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuptapedevice-42512.html">30.&nbsp;&nbsp;Managing Tape Drives (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="fsoverview-12343"></a><h3>UFS File System</h3>
<p>UFS is the default disk-based file system in Solaris OS. Most often, when
you administer a disk-based file system, you are administering UFS file systems. UFS
provides the following features.<a name="fsoverview-ix2694"></a></p><table><col width="36.36*"><col width="63.64*"><tr><th align="left" valign="top" scope="column"><p>UFS Feature</p></th>
<th align="left" valign="top" scope="column"><p>Description</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Extended fundamental types (EFT)</p></td>
<td align="left" valign="top" scope="row"><p><a name="fsoverview-ix2698"></a><a name="fsoverview-ix2699"></a>Provides 32-bit user ID (UID),
group ID (GID), and device numbers.  </p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Large file systems</p></td>
<td align="left" valign="top" scope="row"><p><a name="fsoverview-ix2700"></a>Allows files of about 1
terabyte in size in a file system that can be up to
16 terabytes in size. You can create a multiterabyte UFS file system on
a disk with an EFI disk label.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Logging</p></td>
<td align="left" valign="top" scope="row"><p><a name="indexterm-409"></a></p><p>UFS logging bundles the multiple metadata changes
that comprise a complete UFS operation into a transaction. Sets of transactions are
recorded in an on-disk log and are applied to the actual UFS file
system's metadata.</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Multiterabyte file systems</p></td>
<td align="left" valign="top" scope="row"><p><a name="fapgy"></a>A multiterabyte file system enables creation of a UFS 
file system up to  approximately 16 terabytes of usable space, minus approximately
one percent overhead</p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>State flags</p></td>
<td align="left" valign="top" scope="row"><p><a name="fsoverview-ix2696"></a><a name="fsoverview-ix2697"></a>Shows the state of the file system: clean, stable, active,
logging, or unknown.  These flags eliminate unnecessary file system checks.  If
the file system is &ldquo;clean,&rdquo; &ldquo;stable,&rdquo; or &ldquo;logging,&rdquo; file system checks are not run.
 </p></td>
</tr>
</table><p>For detailed information about the UFS file system structure, see <a href="fsfilesysappx-94408.html">Chapter&nbsp;23, UFS File System (Reference)</a>.</p>

<a name="fsoverview-46"></a><h4>Planning UFS File Systems</h4>
<p>When laying out file systems, you need to consider possible conflicting demands. 
Here are some suggestions:</p>
<ul><li><p>Distribute the workload as evenly as possible among different I/O systems and disk drives. Distribute the <tt>/export/home</tt> file system and swap space evenly across disks.</p></li>
<li><p>Keep pieces of projects or members of groups within the same file system.</p></li>
<li><p>Use as few file systems per disk as possible. On the system (or boot) disk, you should have three file systems: root (<tt>/</tt>), <tt>/usr</tt>, and swap space. On other disks, create one or at most two file systems, with one file system preferrably being additional swap space. Fewer, roomier file systems cause less file fragmentation than many small, over crowded file systems. Higher-capacity tape drives and the ability of the <tt>ufsdump</tt> command to handle multiple volumes make it easier to back up larger file systems.</p></li>
<li><p>If you have some users who consistently create very small files, consider creating a separate file system with more inodes. However, most sites do not need to keep similar types of user files in the same file system.</p></li></ul>
<p>For information on default file system parameters as well as procedures for creating
new UFS file systems, see <a href="fscreate-96442.html">Chapter&nbsp;18, Creating UFS, TMPFS, and LOFS File Systems (Tasks)</a>.</p>

<a name="fsoverview-18"></a><h4>64-bit: Support of Multiterabyte UFS File Systems</h4>
<p>This Solaris release provides support for multiterabyte UFS file systems on systems that run
a 64-bit Solaris kernel.</p><p>Previously, UFS file systems were limited to approximately 1 terabyte on both 64-bit
and 32-bit systems. All UFS file system commands and utilities have been updated
to support multiterabyte UFS file systems.</p><p>For example, the <tt>ufsdump</tt> command has been updated with a larger block size
for dumping large UFS file systems:</p><pre># <tt><b>ufsdump 0f /dev/md/rdsk/d97 /dev/md/rdsk/d98</b></tt>
  DUMP: Date of this level 0 dump: Tue Jan 07 14:23:36 2003
  DUMP: Date of last level 0 dump: the epoch
  DUMP: Dumping /dev/md/rdsk/d98 to /dev/md/rdsk/d97.
  DUMP: Mapping (Pass I) [regular files]
  DUMP: Mapping (Pass II) [directories]
  DUMP: Forcing larger tape block size (2048).
  DUMP: Writing 32 Kilobyte records
  DUMP: Estimated 4390629500 blocks (2143862.06MB).
  DUMP: Dumping (Pass III) [directories]
  DUMP: Dumping (Pass IV) [regular files]</pre><p>Administering UFS file systems that are less than 1 terabyte remains the same.
No administration differences exist between UFS file systems that are less than one
terabyte and file systems that are greater than 1 terabyte.</p><p>You can initially create a UFS file system that is less than
1 terabyte and specify that it can eventually be expanded into a multiterabyte
file system by using the <tt>newfs</tt> <tt>-T</tt> option. This option sets the inode and
fragment density to scale appropriately for a multiterabyte file system.</p><p>Using the <tt>newfs</tt> <tt>-T</tt> option when you create a UFS file system less
than 1 terabyte on a system running a 32-bit kernel enables you to
eventually expand this file system by using the <tt>growfs</tt> command when you
boot this system under a 64-bit kernel. For more information, see <a href="http://docs.sun.com/doc/819-2240/newfs-1m?a=view"><tt>newfs</tt>(1M)</a>.</p><p>You can use the <tt>fstyp</tt> <tt>-v</tt> command to identify whether a UFS file
system has multiterabyte support by checking the following value in the magic column:</p><pre># <tt><b>/usr/sbin/fstyp -v /dev/md/rdsk/d3 | head -5</b></tt>
ufs
magic   decade  format  dynamic time    Fri May 21 11:10:10 2004</pre><p>A UFS file system with no multiterabyte support has the following <tt>fstyp</tt>
output:</p><pre># <tt><b>/usr/sbin/fstyp -v /dev/md/rdsk/d0 | head -5</b></tt>
ufs
magic   11954   format  dynamic time    Fri May 21 11:46:40 2004</pre><p>You can use the <tt>growfs</tt> command to expand a UFS file system to
the size of the slice or the volume without loss of service
or data. For more information, see <a href="http://docs.sun.com/doc/819-2240/growfs-1m?a=view"><tt>growfs</tt>(1M)</a>.</p><p>Two new related features are multiterabyte volume support with the EFI disk label
and multiterabyte volume support with Solaris Volume Manager. For more information, see <a href="disksconcepts-1.html#disksconcepts-14">EFI Disk Label</a>
and the <a href="http://docs.sun.com/doc/819-2789"><i>Solaris Volume Manager Administration Guide</i></a>.</p>

<a name="fsoverview-19"></a><h5>Features of Multiterabyte UFS File Systems</h5>
<p>Multiterabyte UFS file systems include the following features:</p>
<ul><li><p>Provides the ability to create a UFS file system up to 16 terabytes in size.</p></li>
<li><p>Provides the ability to create a file system less than 16 terabytes that can later be increased in size up to 16 terabytes.</p></li>
<li><p>Multiterabyte file systems can be created on physical disks, Solaris Volume Manager's logical volumes, and Veritas' VxVM logical volumes.</p></li>
<li><p>Multiterabyte file systems benefit from the performance improvements of having UFS logging enabled. Multiterabyte file systems also benefit from the availability of logging because the <tt>fsck</tt> command might not have to be run when logging is enabled.</p></li>
<li><p>When you create a partition for your multiterabyte UFS file system, the disk will be labeled automatically with an EFI disk label. For more information on EFI disk labels, see <a href="disksconcepts-1.html#disksconcepts-14">EFI Disk Label</a>.</p></li>
<li><p>Provides the ability to snapshot a multiterabyte file system by creating multiple backing store files when a file system is over 512 Gbytes.</p></li></ul>


<a name="fsoverview-9"></a><h5>Limitations of Multiterabyte UFS File Systems</h5>
<p>Limitations of multiterabyte UFS file systems are as follows:</p>
<ul><li><p>This feature is not supported on 32-bit systems.</p></li>
<li><p>You cannot mount a file system greater than 1 terabyte on a system that is running a 32-bit Solaris kernel.</p></li>
<li><p>You cannot boot from a file system greater than 1 terabyte on a system that is running a 64-bit Solaris kernel. This limitation means that you cannot put a root (<tt>/</tt>) file system on a multiterabyte file system.</p></li>
<li><p>There is no support for individual files greater than 1 terabyte.</p></li>
<li><p>The maximum number of files is 1 million files per terabyte of a UFS file system. For example, a 4-terabyte file system can contain 4 million files.</p><p>This limit is intended to reduce the time it takes to check the file system with the <tt>fsck</tt> command.</p></li>
<li><p>The maximum quota that you can set on a multiterabyte UFS file system is 2 terabytes of 1024-byte blocks.</p></li></ul>


<a name="fpypq"></a><h5>Where to Find Multiterabyte UFS Tasks</h5>
<p>Use these references to find step-by-step instructions for working with multiterabyte UFS file
systems.</p><table><col width="50*"><col width="50*"><tr><th align="left" valign="top" scope="column"><p>Multiterabyte UFS Task</p></th>
<th align="left" valign="top" scope="column"><p>For More Information</p></th>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Create multiterabyte UFS file systems</p></td>
<td align="left" valign="top" scope="row"><p><a href="fscreate-1.html#fsoverview-14">How to Create a Multiterabyte UFS File System</a></p><p><a href="fscreate-1.html#fsoverview-17">How to Expand a Multiterabyte UFS File System</a></p><p><a href="fscreate-1.html#fsoverview-13">How to Expand a UFS File System to a Multiterabyte UFS File System</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Create a multiterabyte UFS
snapshot</p></td>
<td align="left" valign="top" scope="row"><p><a href="bkupsnapshot-5.html#fpypp">Example&nbsp;26-2</a></p></td>
</tr>
<tr><td align="left" valign="top" scope="row"><p>Troubleshoot multiterabyte UFS problems</p></td>
<td align="left" valign="top" scope="row"><p><a href="fscreate-1.html#fsoverview-15">Troubleshooting Multiterabyte UFS File System Problems</a></p></td>
</tr>
</table>

<a name="fsoverview-43"></a><h4>UFS Logging</h4>
<p><a name="indexterm-410"></a>UFS logging bundles the multiple metadata changes that comprise a complete UFS operation into
a transaction. Sets of transactions are recorded in an on-disk log. Then, they
are applied to the actual UFS file system's metadata.</p><p>At reboot, the system discards incomplete transactions, but applies the transactions for completed
operations. The file system remains consistent because only completed transactions are ever applied.
This consistency remains even when a system crashes. A system crash might interrupt
system calls and introduces inconsistencies into a UFS file system.</p><p>UFS logging provides two advantages:</p>
<ul><li><p>If the file system is already consistent due to the transaction log, you might not have to run the <tt>fsck</tt> command after a system crash or an unclean shutdown. For more information on unclean shutdowns, see <a href="fstroublefsck-51788.html">What the <tt>fsck</tt> Command Checks and Tries to Repair</a>.</p></li>
<li><p>Starting in the Solaris 9 12/02 release, the performance of UFS logging improves or exceeds the level of performance of non logging file systems. This improvement can occur because a file system with logging enabled converts multiple updates to the same data into single updates. Thus, reduces the number of overhead disk operations required.</p></li></ul>
<p>Logging is enabled by default for all UFS file systems, except under the
following conditions:</p>
<ul><li><p>When logging is explicitly disabled.</p></li>
<li><p>If there is insufficient file system space for the log.</p></li></ul>
<p>In previous Solaris releases, you had to manually enable UFS logging.</p><p>Keep the following issues in mind when using UFS logging:</p>
<ul><li><p>Ensure that you have enough disk space for your general system needs, such as for users and applications, and for UFS logging.</p></li>
<li><p>If you don't have enough disk space for logging data, a message similar to the following is displayed:</p><pre># <tt><b>mount /dev/dsk/c0t4d0s0 /mnt</b></tt>
/mnt: No space left on device
Could not enable logging for /mnt on /dev/dsk/c0t4d0s0.
#</pre><p>However, the file system is still mounted. For example:</p><pre># <tt><b>df -h /mnt</b></tt>
Filesystem             size   used  avail capacity  Mounted on
/dev/dsk/c0t4d0s0      142M   142M     0K   100%    /mnt
#</pre></li>
<li><p>A UFS file system with logging enabled that is generally empty will have some disk space consumed for the log.</p></li>
<li><p>If you upgrade to this Solaris release from a previous Solaris release, your UFS file systems will have logging enabled, even if the <tt>logging</tt> option was not specified in the <tt>/etc/vfstab</tt> file. To disable logging, add the <tt>nologging</tt> option to the UFS file system entries in the <tt>/etc/vfstab</tt> file.</p></li></ul>
<p>The UFS transaction log has the following characteristics:</p>
<ul><li><p>Is allocated from free blocks on the file system</p></li>
<li><p>Sized at approximately 1 Mbyte per 1 Gbyte of file system, up to a maximum of 64 Mbytes</p></li>
<li><p>Continually flushed as it fills up</p></li>
<li><p>Also flushed when the file system is unmounted or as a result of any <tt>lockfs</tt> command.</p></li></ul>
<p>If you need to enable UFS logging, specify the <tt>-o logging</tt> option with the
<tt>mount</tt> command in the <tt>/etc/vfstab</tt> file or when you manually mount the file
system. Logging can be enabled on any UFS file system, including the root
(<tt>/</tt>) file system. Also, the <tt>fsdb</tt> command has new debugging commands to support UFS
logging.</p><p>In some operating systems, a file system with logging enabled is known as
a <b>journaling</b> file system.</p>

<a name="fsoverview-57"></a><h4>UFS Snapshots</h4>
<p>You can use the <tt>fssnap</tt> command to create a read-only snapshot of a
file system. A <b>snapshot</b> is a file system's temporary image that is intended
for backup operations.</p><p>See <a href="bkupsnapshot-2.html">Chapter&nbsp;26, Using UFS Snapshots (Tasks)</a> for more information.</p>

<a name="fsfilesysappx-17"></a><h4>UFS Direct Input/Output (I/O)</h4>
<p><a name="indexterm-411"></a><a name="indexterm-412"></a>Direct I/O is intended to boost bulk I/O operations. Bulk I/O operations use
large buffer sizes to transfer large files (larger than 256 Kbytes).  </p><p>Using UFS direct I/O might benefit applications, such as database engines, that do
their own internal buffering. Starting with the Solaris 8 1/01 release, UFS direct
I/O has been enhanced to allow the same kind of I/O concurrency that
occurs when raw devices are accessed. Now you can get the benefit
of file system naming and flexibility with very little performance penalty. Check with your
database vendor to see if it can enable UFS direct I/O in
its product configuration options.</p><p>Direct I/O can also be enabled on a file system by using
the <tt>forcedirectio</tt> option to the <tt>mount</tt> command. Enabling direct I/O is a performance
benefit only when a file system is transferring large amounts of sequential data.
</p><p>When a file system is mounted with this option, data is transferred directly
between a user's address space and the disk. When forced direct I/O is
not enabled for a file system, data transferred between a user's address space
and the disk is first buffered in the kernel address space.</p><p>The default behavior is no forced direct I/O on a UFS file
system. For more information, see <a href="http://docs.sun.com/doc/819-2240/mount-ufs-1m?a=view"><tt>mount_ufs</tt>(1M)</a>.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="fsoverview-43247.html">Previous</a>
             </td>
             <td align="right">
                 <a href="fsoverview-30598.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

