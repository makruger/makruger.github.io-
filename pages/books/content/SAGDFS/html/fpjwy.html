<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Troubleshooting iSCSI Configuration Problems - System Administration Guide: Devices and File Systems</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2008-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo"></div>
   <div class="Title">System Administration Guide: Devices and File Systems</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="fncpi.html">Previous</a>
             </td>
             <td align="right">
                 <a href="gfydr.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="vol1preface-11.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="medintro-55492.html">1.&nbsp;&nbsp;Managing Removable Media (Overview)</a></p>
<p class="toc level1 tocsp"><a href="medformat-83002.html">2.&nbsp;&nbsp;Managing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medaccess-29267.html">3.&nbsp;&nbsp;Accessing Removable Media (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="medcdrw-1.html">4.&nbsp;&nbsp;Writing CDs and DVDs (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig-27900.html">5.&nbsp;&nbsp;Managing Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devconfig2-1.html">6.&nbsp;&nbsp;Dynamically Configuring Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="devusbover-24.html">7.&nbsp;&nbsp;Using USB Devices (Overview)</a></p>
<p class="toc level1 tocsp"><a href="devusbtasks-1.html">8.&nbsp;&nbsp;Using USB Devices (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fncpk.html">9.&nbsp;&nbsp;Using InfiniBand Devices (Overview/Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksconcepts-29477.html">10.&nbsp;&nbsp;Managing Disks (Overview)</a></p>
<p class="toc level1 tocsp"><a href="disksprep-31030.html">11.&nbsp;&nbsp;Administering Disks (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="diskssadd-16103.html">12.&nbsp;&nbsp;SPARC: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="disksxadd-38159.html">13.&nbsp;&nbsp;x86: Adding a Disk (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fmvcd.html">14.&nbsp;&nbsp;Configuring Solaris iSCSI Targets and Initiators (Tasks)</a></p>
<p class="toc level2"><a href="fncoz.html">The iSCSI Technology (Overview)</a></p>
<p class="toc level2"><a href="fncpi.html">Setting Up Solaris iSCSI Targets and Initiators (Task Map)</a></p>
<p class="toc level3"><a href="fncpi.html#fmvcc">How to Prepare for a Solaris iSCSI Configuration</a></p>
<p class="toc level3"><a href="fncpi.html#fqnlk">How to Configure iSCSI Target Discovery</a></p>
<p class="toc level3"><a href="fncpi.html#fqnls">How to Remove Discovered iSCSI Targets</a></p>
<p class="toc level3"><a href="fncpi.html#fmvey">Monitoring Your iSCSI Configuration</a></p>
<p class="toc level3"><a href="fncpi.html#gcawf">How to Enable Multiple iSCSI Sessions for a Target</a></p>
<div class="onpage">
<p class="toc level2 tocsp"><a href="">Troubleshooting iSCSI Configuration Problems</a></p>
</div>
<p class="toc level1 tocsp"><a href="gfydr.html">15.&nbsp;&nbsp;Configuring and Managing the Solaris Internet Storage Name Service (iSNS)</a></p>
<p class="toc level1 tocsp"><a href="disksformat-15833.html">16.&nbsp;&nbsp;The <tt>format</tt> Utility (Reference)</a></p>
<p class="toc level1 tocsp"><a href="fsoverview-38559.html">17.&nbsp;&nbsp;Managing File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="fscreate-96442.html">18.&nbsp;&nbsp;Creating UFS, TMPFS, and LOFS File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsmount-42780.html">19.&nbsp;&nbsp;Mounting and Unmounting File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fscachefs-70682.html">20.&nbsp;&nbsp;Using The CacheFS File System (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsswap-14677.html">21.&nbsp;&nbsp;Configuring Additional Swap Space (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fstroublefsck-61446.html">22.&nbsp;&nbsp;Checking UFS File System Consistency (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="fsfilesysappx-94408.html">23.&nbsp;&nbsp;UFS File System (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupconcepts-57422.html">24.&nbsp;&nbsp;Backing Up and Restoring File Systems (Overview)</a></p>
<p class="toc level1 tocsp"><a href="bkuptasks2-64128.html">25.&nbsp;&nbsp;Backing Up Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupsnapshot-2.html">26.&nbsp;&nbsp;Using UFS Snapshots (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuprestoretasks-38055.html">27.&nbsp;&nbsp;Restoring Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkupref-12756.html">28.&nbsp;&nbsp;UFS Backup and Restore Commands (Reference)</a></p>
<p class="toc level1 tocsp"><a href="bkupsavefiles-17924.html">29.&nbsp;&nbsp;Copying UFS Files and File Systems (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="bkuptapedevice-42512.html">30.&nbsp;&nbsp;Managing Tape Drives (Tasks)</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="fpjwy"></a><h3>Troubleshooting iSCSI Configuration Problems</h3>
<p>The following tools are available to troubleshoot general iSCSI configuration problems:<a name="indexterm-280"></a><a name="indexterm-281"></a></p>
<ul><li><p><tt>snoop</tt> &ndash; This tool has been updated to support iSCSI packets.</p></li>
<li><p><tt>ethereal</tt> &ndash; This freeware product is available from <a href="http://www.ethereal.com">http://www.ethereal.com</a>.</p></li></ul>
<p>Both tools can filter iSCSI packets on port 3260.</p><p>The following sections describe various iSCSI troubleshooting and error message resolution scenarios.</p>

<a name="fsuly"></a><h4>No Connections to the iSCSI Target From the Local System</h4>


<a name="fsume"></a><h5>How to Troubleshoot iSCSI Connection Problems</h5>
<ol>
<li><b>Become superuser.</b></li>
<li><b>List your iSCSI target information.</b><p>For example:</p><pre># <tt><b>iscsiadm list target</b></tt>
Target: iqn.2001-05.com.abcstorage:6-8a0900-37ad70401-bcfff02df8a421df-zzr1200-01
        TPGT: default
        ISID: 4000002a0000
        Connections: 0</pre></li>
<li><b>If no connections are listed in the <tt>iscsiadm list target</tt> output, check the <tt>/var/adm/messages</tt> file
for possible reasons why the connection failed.</b><p>You can also verify whether the connection is accessible by using the <tt>ping</tt>
command or by connecting to the storage device's iSCSI port with the <tt>telnet</tt>
command to ensure the iSCSI service is available. The default port is 3260.</p><p>In addition, check the storage device's log file for errors.</p></li>
<li><b>If your target is not listed in the <tt>iscsiadm list target</tt> output, check the <tt>/var/adm/messages</tt>
file for possible causes.</b><p>If you are using SendTargets as the discovery method, try listing the
<i>discovery-address</i> using the <tt>-v</tt> option to ensure that the expected targets are visible
to the host. For example:</p><pre># <tt><b>iscsiadm list discovery-address -v 10.0.0.1</b></tt>
Discovery Address: 10.0.0.1:3260
    Target name: eui.210000203787dfc0
        Target address:        10.0.0.1:11824
    Target name: eui.210000203787e07b
        Target address:        10.0.0.1:11824</pre><p>If you are using iSNS as the discovery method, try enabling the
iSNS discovery mode and listing the <i>isns-server</i> using the <tt>-v</tt> option to ensure that
the expected targets are visible to the host. For example:</p><pre># <tt><b>iscsiadm list isns-server -v</b></tt>
iSNS Server IP Address: 10.20.56.56:3205
        Target name: iqn.1992-08.com.xyz:sn.1234566
                Target address:   10.20.57.161:3260, 1
        Target name: iqn.2003-10.com.abc:group-0:154:abc-65-01
                Target address:   10.20.56.206:3260, 1
        Target name: iqn.2003-10.com.abc:group-0:154:abc-65-02
                Target address:   10.20.56.206:3260, 1
.
.
.</pre></li></ol>

<a name="fsumb"></a><h4>iSCSI Device or Disk Is Not Available on the Local System</h4>


<a name="fsumd"></a><h5>How to Troubleshoot iSCSI Device or Disk Unavailability</h5>
<ol>
<li><b>Become superuser.</b></li>
<li><b>Identify the LUNs that were discovered on this target during enumeration.</b><p>For example:</p><pre># <tt><b>iscsiadm list target -S</b></tt>
Target: iqn.2001-05.com.abcstorage:6-8a0900-37ad70401-bcfff02df8a421df-zzr1200-01
        TPGT: default
        ISID: 4000002a0000
        Connections: 1
        LUN: 0
            Vendor:  ABCSTOR
            Product: 0010 
            OS Device Name: /dev/rdsk/c3t34d0s2</pre><p>The <tt>-S</tt> option shows which LUNs where discovered on this target during enumeration.
If you think a LUN should be listed but it is not, review
the <tt>/var/adm/messages</tt> file to see if an error was reported. Check the storage
device's log files for errors. Also, ensure that any storage device LUN masking
is properly configured.</p></li></ol>

<a name="gbsct"></a><h4>Use LUN Masking When Using the iSNS Discovery Method</h4>
<p>Avoid using iSNS discovery domain as the means to control storage authorization to
specific initiators. Use LUN masking instead if you want to make sure
that only authorized initiators can access a LUN. </p><p>If you remove a target from a discovery domain while the target
is in use, the iSCSI initiator does not log out from this target.
If you do not want this initiator to access this target (and the
associated LUNs), you will have to use LUN masking. Simply removing the target
from the discovery domain is not sufficient.</p>

<a name="fsumc"></a><h4>General iSCSI Error Messages</h4>
<p>This section describes the iSCSI messages that might be found in the
<tt>/var/adm/messages</tt> file and potential solutions for recovery.<a name="indexterm-282"></a><a name="indexterm-283"></a></p><p>The message format is as follows:</p><pre>iscsi <i>TYPE</i> (<i>OID</i>) <i>STRING</i> (<i>STATUS-CLASS#</i>/<i>STATUS-DETAIL#</i>)</pre><dl><dt><i>TYPE</i></dt>
<dd><p>Is either connection or session.</p></dd>
<dt><i>OID</i></dt>
<dd><p>Is the object ID of the connection or session. This ID is unique for an OS instance.</p></dd>
<dt><i>STRING</i></dt>
<dd><p>Is a description of the condition.</p></dd>
<dt><i>&lt;STATUS-CLASS#>/&lt;STATUS-DETAIL#></i></dt>
<dd><p>These values are returned in an iSCSI login response as defined by RFC 3720.</p></dd>
</dl>
<p>iscsi connection(<i>OID</i>) login failed - Miscellaneous iSCSI initiator errors.</p>Cause: <p>The device login failed due to some form of initiator error.</p><p>iscsi connection(<i>OID</i>) login failed - Initiator could not be successfully authenticated.</p>Cause: <p>The device could not successfully authenticate the initiator.</p>Solution: <p>If applicable, verify that the settings for CHAP names, CHAP passwords or RADIUS
are correct.</p><p>iscsi connection(<i>OID</i>) login failed - Initiator is not allowed access to the given
target.</p>Cause: <p>The device will not allow the initiator access to the iSCSI target device.</p>Solution: <p>Verify your initiator name and confirm that it is properly masked or provisioned
by the storage device.</p><p>iscsi connection(<i>OID</i>) login failed - Requested ITN does not exist at this address.</p>Cause: <p>The device does not provide access to the iSCSI target name (ITN) that
you are requesting.</p>Solution: <p>Verify the initiator discovery information is entered properly and that the storage  device
is configured properly.</p><p>iscsi connection(<i>OID</i>) login failed - Requested ITN has been removed and no forwarding
address is provided.</p>Cause: <p>The device can no longer provide access to the iSCSI target name (ITN)
that you are requesting.</p>Solution: <p>Verify that the initiator discovery information has been specified properly and the storage
device has been configured properly.</p><p>iscsi connection(<i>OID</i>) login failed - Requested iSCSI version range is not supported by
the target.</p>Cause: <p>The initiator's iSCSI version is not supported  by the storage device.</p><p>iscsi connection(<i>OID</i>) login failed - No more connections can be accepted on this
Session ID (SSID).</p>Cause: <p>The storage device cannot accept another connection for this initiator node to the
iSCSI target device.</p><p>iscsi connection(<i>OID</i>) login failed - Missing parameters (e.g., iSCSI initiator and/or target name).</p>Cause: <p>The storage device is reporting that the initiator or target name has not been
properly specified.</p>Solution: <p>Properly specify the iSCSI initiator or target name.</p><p>iscsi connection(<i>OID</i>) login failed - Target hardware or software error.</p>Cause: <p>The storage device encountered a hardware or software error.</p>Solution: <p>Consult the storage documentation or contact the storage vendor for further assistance.</p><p>iscsi connection(<i>OID</i>) login failed - iSCSI service or target is not currently operational.</p>Cause: <p>The storage device is currently not  operational.</p>Solution: <p>Consult the storage documentation or contact the storage vendor for further assistance.</p><p>iscsi connection(<i>OID</i>) login failed - Target has insufficient session, connection or other resources.</p>Cause: <p>The storage device has insufficient resources.</p>Solution: <p>Consult the storage documentation or contact the storage vendor for further assistance.</p><p>iscsi connection(<i>OID</i>) login failed - unable to initialize authentication</p><p>iscsi connection(<i>OID</i>) login failed - unable to set authentication</p><p>iscsi connection(<i>OID</i>) login failed - unable to set username</p><p>iscsi connection(<i>OID</i>) login failed - unable to set password</p><p>iscsi connection(<i>OID</i>) login failed - unable to set ipsec</p><p>iscsi connection(<i>OID</i>) login failed - unable to set remote authentication</p>Cause: <p>The initiator was unable to initialize or set authentication properly.</p>Solution: <p>Verify that your initiator settings for authentication are properly configured.</p><p>iscsi connection(<i>OID</i>) login failed - unable to make login pdu</p>Cause: <p>The initiator was unable to make a login payload data unit (PDU) based
on the initiator or storage device settings.</p>Solution: <p>Try resetting any target login parameters or other nondefault settings.</p><p>iscsi connection(<i>OID</i>) login failed - failed to transfer login</p><p>iscsi connection(<i>OID</i>) login failed - failed to receive login response</p>Cause: <p>The initiator failed to transfer or receive a login payload data unit (PDU)
across the network connection.</p>Solution: <p>Verify that the network connection is reachable.</p><p>iscsi connection(<i>OID</i>) login failed - received invalid login response (<i>OP CODE</i>)</p>Cause: <p>The storage device has responded to a login with  an unexpected response.</p><p>iscsi connection(<i>OID</i>) login failed - login failed to authenticate with target</p>Cause: <p>The initiator was unable to authenticate the storage device.</p>Solution: <p>Verify that your initiator settings for authentication are properly configured.</p><p>iscsi connection(<i>OID</i>) login failed - initiator name is required</p>Cause: <p>An initiator name must be configured to perform all actions.</p>Solution: <p>Verify that the initiator name is configured.</p><p>iscsi connection(<i>OID</i>) login failed - authentication receive failed</p><p>iscsi connection(<i>OID</i>) login failed - authentication transmit failed</p>Cause: <p>The initiator was unable to transmit or receive authentication information.</p>Solution: <p>Verify the network connectivity with storage device or the RADIUS server as applicable.</p><p>iscsi connection(<i>OID</i>) login failed - login redirection invalid</p>Cause: <p>The storage device attempted to redirect the initiator to an invalid destination.</p>Solution: <p>Consult the storage documentation or contact the storage vendor for further assistance.</p><p>iscsi connection(<i>OID</i>) login failed - target protocol group tag mismatch, expected &lt;TPGT>, received &lt;TPGT></p>Cause: <p>The initiator and target had a TPGT (target portal group tag) mismatch.</p>Solution: <p>Verify your TPGT discovery settings on the initiator or the storage device.</p><p>iscsi connection(<i>OID</i>) login failed - can't accept <i>PARAMETER</i> in security stage</p>Cause: <p>The device responded with an unsupported login parameter during the security phase of
login.</p>Solution: <p>The parameter name is noted for reference. Consult the storage documentation or contact
the storage vendor for further assistance.</p><p>iscsi connection(<i>OID</i>) login failed - HeaderDigest=CRC32 is required, can't accept <i>VALUE</i></p><p>iscsi connection(<i>OID</i>) login failed - DataDigest=CRC32 is required, can't accept <i>VALUE</i></p>Cause: <p>The initiator is only configured to accept <tt>HeaderDigest</tt> or <tt>DataDigest</tt> that is
set to CRC32 for this target. The device returned the value of <i>VALUE</i>.</p>Solution: <p>Verify that the initiator and device digest settings are compatible.</p><p>iscsi connection(<i>OID</i>) login failed - HeaderDigest=None is required, can't accept <i>VALUE</i></p><p>iscsi connection(<i>OID</i>) login failed - DataDigest=None is required, can't accept <i>VALUE</i></p>Cause: <p>The initiator is only configured to accept <tt>HeaderDigest</tt> or <tt>DataDigest</tt> that is
set to none for this target. The device returned the value of <i>VALUE</i>.</p>Solution: <p>Verify that the initiator and device digest settings are compatible.</p><p>iscsi connection(<i>OID</i>) login failed - can't accept <i>PARAMETER</i></p>Cause: <p>The initiator does not support this parameter.</p><p>iscsi connection(<i>OID</i>) login failed - can't accept MaxOutstandingR2T <i>VALUE</i></p>Cause: <p>The initiator does not accept <tt>MaxOutstandingR2T</tt> of the noted <i>VALUE</i>.</p><p>iscsi connection(<i>OID</i>) login failed - can't accept MaxConnections <i>VALUE</i></p>Cause: <p>The initiator does not accept the maximum connections of the noted <i>VALUE</i>.</p><p>iscsi connection(<i>OID</i>) login failed - can't accept ErrorRecoveryLevel <i>VALUE</i></p>Cause: <p>The initiator does not accept an error recovery level of the noted <i>VALUE</i>.</p><p>iscsi session(<i>OID</i>) <i>NAME</i> offline</p>Cause: <p>All connections for this target <i>NAME</i> have been removed or failed.</p><p>iscsi connection(<i>OID</i>) failure - unable to schedule enumeration</p>Cause: <p>The initiator was unable to enumerate the LUNs on this target.</p>Solution: <p>You can force LUN enumeration by running the <tt>devfsadm -i iscsi</tt> command. For more information,
see <a href="http://docs.sun.com/doc/819-2240/devfsadm-1m?a=view"><tt>devfsadm</tt>(1M)</a>.</p><p>iscsi connection(<i>OID</i>) unable to connect to target <i>NAME</i> (errno:<i>ERRNO</i>)</p>Cause: <p>The initiator failed to establish a network connection.</p>Solution: <p>For information about the specific <i>ERRNO</i> on the connection failure, see the
<tt>/usr/include/sys/errno.h</tt> file.</p>
         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="fncpi.html">Previous</a>
             </td>
             <td align="right">
                 <a href="gfydr.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

